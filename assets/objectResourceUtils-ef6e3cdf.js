import{a as $t}from"./devEnvironmentUtils-5002a058.js";import{w as se,r as v,t as de,e as Pt,q as Ct}from"./typedArrayUtil-a8b5b3e9.js";import{y as Nt,i as qe,g as ke}from"./mat3-3fc68e72.js";import{e as De}from"./mat3f64-c6305894.js";import{h as nt,o as Fe,n as je,u as wt,G as lt}from"./mat4-44a0988f.js";import{e as me}from"./mat4f64-1e28eae0.js";import{A as Ne,p as zt,e as ae,s as Ve,_ as Bt,o as W,g as K,u as H,U as Dt,E as Ge,r as Vt,z as ut,P as Ut,S as qt,O as He,i as We}from"./vec3-a020a6f6.js";import{n as L,r as ue,t as ye,e as Ke}from"./vec3f64-2f9cef06.js";import{A as ht,c as Me}from"./aaBoundingBox-fc742a4e.js";import{c as we,x as ce,u as ct,i as fe,L as kt,O as Qe,E as Ft}from"./BufferView-646ba1de.js";import{t as jt,r as Gt,f as Ye,e as Ht}from"./vec33-ce3aa99b.js";import{u as Xe,a as Wt,m as Kt,n as Qt,o as ne,r as re,b as Yt,c as Xt,d as Je,e as Jt,t as Zt,i as es,f as ts,g as ss}from"./DefaultMaterial_COLOR_GAMMA-9831d979.js";import{t as Re,e as is}from"./mat3f32-d3d088e8.js";import{c as rs,i as os}from"./vec2f32-461e65a9.js";import{U as as}from"./request-d3e98716.js";import{b as ft}from"./asyncUtils-62e8a185.js";import{e as ns}from"./byteSizeEstimations-f0cab514.js";import{s as ls,a as us}from"./Error-653283ae.js";import{C as hs,w as dt}from"./promiseUtils-6684e352.js";import{r as pt}from"./Version-9baeb7ac.js";import{e as cs,g as fs,c as ds,E as ps,d as ms,L as gs,x as _s,B as xs}from"./VisualVariablePassParameters-5807c7dc.js";import{O as ze,a as Ie,t as ee,n as te,e as xe,C as q}from"./basicInterfaces-19ed850e.js";import{j as bs,e as m}from"./cast-7928d7aa.js";import{e as G}from"./Util-a48361c6.js";import{s as mt,R as gt}from"./sphere-4f5e644f.js";import{v as Ts}from"./lineSegment-e6f72ff2.js";import{O}from"./VertexAttribute-9c5c630d.js";import{L as _t}from"./Texture-bbae5d9d.js";import{h as vs}from"./string-cdf077e6.js";import{l as Be}from"./ViewingMode-5d7d590b.js";import{T as xt}from"./InterleavedLayout-5e9cf734.js";import{h as w}from"./Matrix3PassUniform-da8eddae.js";import{c as Os,f as As,i as _e}from"./MixExternalColor.glsl-25f0049c.js";import{i as oe}from"./Normals.glsl-90e28525.js";import{d as Se,b as ge}from"./PhysicallyBasedRendering.glsl-a986c926.js";import{t as ys}from"./ShaderBuilder-93e8045e.js";import{o as X}from"./TransparencyPassType-cd195b0e.js";import{R as Z,I as j,O as B,D as Ze,E as Le}from"./enums-64ab819c.js";import{l as Ms,s as bt,a as Tt,t as vt,e as Ss,o as Es,W as Rs,h as Is,_ as Ls}from"./EvaluateSceneLighting.glsl-3bbc6edf.js";import{S as $s}from"./quat-5b263584.js";import{e as Ps}from"./quatf64-7fd38d64.js";import{n as Cs}from"./vec3f32-c9aa289f.js";import{_ as Ot}from"./preload-helper-41c905a7.js";import{r as Ns}from"./vec4f64-e407da96.js";import{o as ws}from"./AlphaCutoff-96178e0d.js";import{i as zs}from"./ForwardLinearDepth.glsl-36f9eb3b.js";import{X as Bs}from"./DefaultMaterial.glsl-b4f4cbc5.js";import{r as Ds}from"./context-util-1e3c8cfc.js";import{e as g}from"./ShaderTechniqueConfiguration-9f5b4555.js";import{s as Vs}from"./DefaultTechniqueConfiguration-e8962072.js";import{R as Us}from"./RealisticTree.glsl-2b30ed32.js";let qs=class{constructor(e){this._material=e.material,this._techniqueRepository=e.techniqueRep,this._output=e.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}ensureTechnique(e,t,r=this._output){return this._technique=this._techniqueRepository.releaseAndAcquire(e,this._material.getConfiguration(r,t),this._technique),this._technique}ensureResources(e){return ze.LOADED}},ks=class extends qs{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textureRepository=e.textureRep,this._textureId=e.textureId,this._acquire(e.textureId,t=>this._texture=t),this._acquire(e.normalTextureId,t=>this._textureNormal=t),this._acquire(e.emissiveTextureId,t=>this._textureEmissive=t),this._acquire(e.occlusionTextureId,t=>this._textureOcclusion=t),this._acquire(e.metallicRoughnessTextureId,t=>this._textureMetallicRoughness=t)}dispose(){this._texture=se(this._texture),this._textureNormal=se(this._textureNormal),this._textureEmissive=se(this._textureEmissive),this._textureOcclusion=se(this._textureOcclusion),this._textureMetallicRoughness=se(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?ze.LOADED:ze.LOADING}get textureBindParameters(){return new Fs(v(this._texture)?this._texture.glTexture:null,v(this._textureNormal)?this._textureNormal.glTexture:null,v(this._textureEmissive)?this._textureEmissive.glTexture:null,v(this._textureOcclusion)?this._textureOcclusion.glTexture:null,v(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){(de(this._texture)||e!==this._texture.id)&&(this._texture=se(this._texture),this._textureId=e,this._acquire(this._textureId,t=>this._texture=t))}_acquire(e,t){if(de(e))return void t(null);const r=this._textureRepository.acquire(e);if(hs(r))return++this._numLoading,void r.then(i=>{if(this._disposed)return se(i),void t(null);t(i)}).finally(()=>--this._numLoading);t(r)}},Fs=class extends ys{constructor(e=null,t=null,r=null,i=null,o=null){super(),this.texture=e,this.textureNormal=t,this.textureEmissive=r,this.textureOcclusion=i,this.textureMetallicRoughness=o}};var he;(function(s){s[s.INTEGRATED_MESH=0]="INTEGRATED_MESH",s[s.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",s[s.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",s[s.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",s[s.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",s[s.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",s[s.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",s[s.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",s[s.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",s[s.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",s[s.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",s[s.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",s[s.LASERLINES=12]="LASERLINES",s[s.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",s[s.HUD_MATERIAL=14]="HUD_MATERIAL",s[s.LABEL_MATERIAL=15]="LABEL_MATERIAL",s[s.LINE_CALLOUTS=16]="LINE_CALLOUTS",s[s.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",s[s.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",s[s.DRAPED_WATER=19]="DRAPED_WATER",s[s.VOXEL=20]="VOXEL",s[s.MAX_SLOTS=21]="MAX_SLOTS"})(he||(he={}));let At=class{constructor(e,t,r,i){this.primitiveIndices=e,this._numIndexPerPrimitive=t,this.indices=r,this.position=i,this.center=L(),this._children=void 0,G(e.length>=1),G(r.length%this._numIndexPerPrimitive==0),G(r.length>=e.length*this._numIndexPerPrimitive),G(i.size===3||i.size===4);const{data:o,size:a}=i,n=e.length;let u=a*r[this._numIndexPerPrimitive*e[0]];ie.clear(),ie.push(u),this.bbMin=ue(o[u],o[u+1],o[u+2]),this.bbMax=ye(this.bbMin);for(let h=0;h<n;++h){const c=this._numIndexPerPrimitive*e[h];for(let b=0;b<this._numIndexPerPrimitive;++b){u=a*r[c+b],ie.push(u);let _=o[u];this.bbMin[0]=Math.min(_,this.bbMin[0]),this.bbMax[0]=Math.max(_,this.bbMax[0]),_=o[u+1],this.bbMin[1]=Math.min(_,this.bbMin[1]),this.bbMax[1]=Math.max(_,this.bbMax[1]),_=o[u+2],this.bbMin[2]=Math.min(_,this.bbMin[2]),this.bbMax[2]=Math.max(_,this.bbMax[2])}}Ne(this.center,this.bbMin,this.bbMax,.5),this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);let l=this.radius*this.radius;for(let h=0;h<ie.length;++h){u=ie.getItemAt(h);const c=o[u]-this.center[0],b=o[u+1]-this.center[1],_=o[u+2]-this.center[2],A=c*c+b*b+_*_;if(A<=l)continue;const E=Math.sqrt(A),p=.5*(E-this.radius);this.radius=this.radius+p,l=this.radius*this.radius;const S=p/E;this.center[0]+=c*S,this.center[1]+=b*S,this.center[2]+=_*S}ie.clear()}getCenter(){return this.center}getBSRadius(){return this.radius}getBBMin(){return this.bbMin}getBBMax(){return this.bbMax}getChildren(){if(this._children)return this._children;if(zt(this.bbMin,this.bbMax)>1){const e=Ne(L(),this.bbMin,this.bbMax,.5),t=this.primitiveIndices.length,r=new Uint8Array(t),i=new Array(8);for(let l=0;l<8;++l)i[l]=0;const{data:o,size:a}=this.position;for(let l=0;l<t;++l){let h=0;const c=this._numIndexPerPrimitive*this.primitiveIndices[l];let b=a*this.indices[c],_=o[b],A=o[b+1],E=o[b+2];for(let p=1;p<this._numIndexPerPrimitive;++p){b=a*this.indices[c+p];const S=o[b],f=o[b+1],$=o[b+2];S<_&&(_=S),f<A&&(A=f),$<E&&(E=$)}_<e[0]&&(h|=1),A<e[1]&&(h|=2),E<e[2]&&(h|=4),r[l]=h,++i[h]}let n=0;for(let l=0;l<8;++l)i[l]>0&&++n;if(n<2)return;const u=new Array(8);for(let l=0;l<8;++l)u[l]=i[l]>0?new Uint32Array(i[l]):void 0;for(let l=0;l<8;++l)i[l]=0;for(let l=0;l<t;++l){const h=r[l];u[h][i[h]++]=this.primitiveIndices[l]}this._children=new Array(8);for(let l=0;l<8;++l)u[l]!==void 0&&(this._children[l]=new At(u[l],this._numIndexPerPrimitive,this.indices,this.position))}return this._children}static prune(){ie.prune()}};const ie=new bs({deallocator:null});function js(s){return s?{p0:ye(s.p0),p1:ye(s.p1),p2:ye(s.p2)}:{p0:L(),p1:L(),p2:L()}}function Gr(s,e,t){const r=e[0]-s[0],i=e[1]-s[1],o=t[0]-s[0],a=t[1]-s[1];return .5*Math.abs(r*a-i*o)}function Gs(s,e,t){return ae($e,e,s),ae(et,t,s),Ve(Bt($e,$e,et))/2}new mt(Ts);new mt(()=>js());const $e=L(),et=L();function Hs(s,e,t){if(!s||!e)return!1;const{size:r,data:i}=s;W(t,0,0,0),W(F,0,0,0);let o=0,a=0;for(let n=0;n<e.length-2;n+=3){const u=e[n+0]*r,l=e[n+1]*r,h=e[n+2]*r;W(z,i[u+0],i[u+1],i[u+2]),W(Y,i[l+0],i[l+1],i[l+2]),W(Te,i[h+0],i[h+1],i[h+2]);const c=Gs(z,Y,Te);c?(H(z,z,Y),H(z,z,Te),K(z,z,1/3*c),H(t,t,z),o+=c):(H(F,F,z),H(F,F,Y),H(F,F,Te),a+=3)}return(a!==0||o!==0)&&(o!==0?(K(t,t,1/o),!0):a!==0&&(K(t,F,1/a),!0))}function Ws(s,e,t){if(!s||!e)return!1;const{size:r,data:i}=s;W(t,0,0,0);let o=-1,a=0;for(let n=0;n<e.length;n++){const u=e[n]*r;o!==u&&(t[0]+=i[u+0],t[1]+=i[u+1],t[2]+=i[u+2],a++),o=u}return a>1&&K(t,t,1/a),a>0}function Hr(s,e,t,r){if(!s)return!1;const{size:i,data:o}=s;W(r,0,0,0),W(F,0,0,0);let a=0,n=0;const u=e?e.length-1:o.length/i-1,l=u+(t?2:0);for(let h=0;h<l;h+=2){const c=h<u?h:u,b=h<u?h+1:0,_=(e?e[c]:c)*i,A=(e?e[b]:b)*i;z[0]=o[_+0],z[1]=o[_+1],z[2]=o[_+2],Y[0]=o[A+0],Y[1]=o[A+1],Y[2]=o[A+2],K(z,H(z,z,Y),.5);const E=Dt(z,Y);E>0?(H(r,r,K(z,z,E)),a+=E):(H(F,F,z),n++)}return a!==0?(K(r,r,1/a),!0):n!==0&&(K(r,F,1/n),!0)}const z=L(),Y=L(),Te=L(),F=L();let Ue=class extends cs{constructor(e,t=[],r=Ie.Triangle,i=null,o=-1){super(),this._primitiveType=r,this.objectAndLayerIdColor=i,this.edgeIndicesLength=o,this.type=fs.Geometry,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[a,n]of e)n&&this._vertexAttributes.set(a,{...n});if(t==null||t.length===0){const a=Ks(this._vertexAttributes),n=Xe(a);this.edgeIndicesLength=this.edgeIndicesLength<0?a:this.edgeIndicesLength;for(const u of this._vertexAttributes.keys())this._indices.set(u,n)}else for(const[a,n]of t)n&&(this._indices.set(a,Wt(n)),a===O.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(a).length:this.edgeIndicesLength))}cloneShallow(){const e=new Ue([],void 0,this._primitiveType,this.objectAndLayerIdColor,void 0),{_vertexAttributes:t,_indices:r}=e;return this._vertexAttributes.forEach((i,o)=>t.set(o,i)),this._indices.forEach((i,o)=>r.set(o,i)),e.screenToWorldRatio=this.screenToWorldRatio,e._boundingInfo=this._boundingInfo,e}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(e){const t=this._vertexAttributes.get(e);return t&&!t.exclusive&&(t.data=Array.from(t.data),t.exclusive=!0),t}get indices(){return this._indices}get indexCount(){const e=this._indices.values().next().value;return e?e.length:0}get primitiveType(){return this._primitiveType}get faceCount(){return this.indexCount/3}get boundingInfo(){return de(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return this.primitiveType===Ie.Triangle?this._computeAttachmentOriginTriangles(e):this._computeAttachmentOriginPoints(e)}_computeAttachmentOriginTriangles(e){const t=this.indices.get(O.POSITION),r=this.vertexAttributes.get(O.POSITION);return Hs(r,t,e)}_computeAttachmentOriginPoints(e){const t=this.indices.get(O.POSITION),r=this.vertexAttributes.get(O.POSITION);return Ws(r,t,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.indices.get(O.POSITION);if(!e||e.length===0)return null;const t=this.primitiveType===Ie.Triangle?3:1;G(e.length%t==0,"Indexing error: "+e.length+" not divisible by "+t);const r=Xe(e.length/t),i=this.vertexAttributes.get(O.POSITION);return i?new At(r,t,e,i):null}};function Ks(s){const e=s.values().next().value;return e==null?0:e.data.length/e.size}let Kr=class{constructor(){this._transform=me(),this._transformInverse=new ve({value:this._transform},nt,me),this._transformInverseTranspose=new ve(this._transformInverse,Fe,me),this._transformTranspose=new ve({value:this._transform},Fe,me),this._transformInverseRotation=new ve({value:this._transform},Nt,De)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){je(this._transform,e)}multiplyTransform(e){wt(this._transform,this._transform,e)}set(e){je(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this._invalidateLazyTransforms()}},ve=class{constructor(e,t,r){this._original=e,this._update=t,this._dirty=!0,this._transform=r()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},Qs=class{constructor(e=0){this.offset=e,this.tmpVertex=L()}applyToVertex(e,t,r){const i=e+this.localOrigin[0],o=t+this.localOrigin[1],a=r+this.localOrigin[2],n=this.offset/Math.sqrt(i*i+o*o+a*a);return this.tmpVertex[0]=e+i*n,this.tmpVertex[1]=t+o*n,this.tmpVertex[2]=r+a*n,this.tmpVertex}applyToAabb(e){for(let o=0;o<3;++o)J[o]=e[0+o]+this.localOrigin[o],Oe[o]=e[3+o]+this.localOrigin[o],le[o]=J[o];const t=this.applyToVertex(J[0],J[1],J[2]);for(let o=0;o<3;++o)e[o]=t[o],e[o+3]=t[o];const r=o=>{const a=this.applyToVertex(o[0],o[1],o[2]);for(let n=0;n<3;++n)e[n+0]=Math.min(e[n+0],a[n]),e[n+3]=Math.max(e[n+3],a[n])};for(let o=1;o<8;++o){for(let a=0;a<3;++a)le[a]=o&1<<a?Oe[a]:J[a];r(le)}let i=0;for(let o=0;o<3;++o)J[o]*Oe[o]<0&&(i|=1<<o);if(i!==0&&i!==7){for(let o=0;o<8;++o)if(!(i&o)){for(let a=0;a<3;++a)i[a]?le[a]=0:le[a]=o&1<<a?J[a]:Oe[a];r(le)}}for(let o=0;o<3;++o)e[o+0]-=this.localOrigin[o],e[o+3]-=this.localOrigin[o];return e}};const J=L(),Oe=L(),le=L();let Ys=class{constructor(e=0){this.componentLocalOriginLength=0,this._tmpVertex=L(),this._mbs=gt(),this._obb={center:L(),halfSize:Cs(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}applyToVertex(e,t,r){const i=e,o=t,a=r+this.componentLocalOriginLength,n=this._totalOffset/Math.sqrt(i*i+o*o+a*a);return this._tmpVertex[0]=e+i*n,this._tmpVertex[1]=t+o*n,this._tmpVertex[2]=r+a*n,this._tmpVertex}applyToAabb(e){const t=e[0],r=e[1],i=e[2]+this.componentLocalOriginLength,o=e[3],a=e[4],n=e[5]+this.componentLocalOriginLength,u=t*o<0?0:Math.min(Math.abs(t),Math.abs(o)),l=r*a<0?0:Math.min(Math.abs(r),Math.abs(a)),h=i*n<0?0:Math.min(Math.abs(i),Math.abs(n)),c=Math.sqrt(u*u+l*l+h*h);if(c<this._totalOffset)return e[0]-=t<0?this._totalOffset:0,e[1]-=r<0?this._totalOffset:0,e[2]-=i<0?this._totalOffset:0,e[3]+=o>0?this._totalOffset:0,e[4]+=a>0?this._totalOffset:0,e[5]+=n>0?this._totalOffset:0,e;const b=Math.max(Math.abs(t),Math.abs(o)),_=Math.max(Math.abs(r),Math.abs(a)),A=Math.max(Math.abs(i),Math.abs(n)),E=Math.sqrt(b*b+_*_+A*A),p=this._totalOffset/E,S=this._totalOffset/c;return e[0]+=t*(t>0?p:S),e[1]+=r*(r>0?p:S),e[2]+=i*(i>0?p:S),e[3]+=o*(o<0?p:S),e[4]+=a*(a<0?p:S),e[5]+=n*(n<0?p:S),e}applyToMbs(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),r=this._totalOffset/t;return this._mbs[0]=e[0]+e[0]*r,this._mbs[1]=e[1]+e[1]*r,this._mbs[2]=e[2]+e[2]*r,this._mbs[3]=e[3]+e[3]*this._totalOffset/t,this._mbs}applyToObb(e){const t=e.center,r=this._totalOffset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);this._obb.center[0]=t[0]+t[0]*r,this._obb.center[1]=t[1]+t[1]*r,this._obb.center[2]=t[2]+t[2]*r,Ge(this._obb.halfSize,e.halfSize,e.quaternion),H(this._obb.halfSize,this._obb.halfSize,e.center);const i=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*i,this._obb.halfSize[1]+=this._obb.halfSize[1]*i,this._obb.halfSize[2]+=this._obb.halfSize[2]*i,ae(this._obb.halfSize,this._obb.halfSize,e.center),$s(rt,e.quaternion),Ge(this._obb.halfSize,this._obb.halfSize,rt),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=e.quaternion,this._obb}};class Xs{constructor(e=0){this.offset=e,this.sphere=gt(),this.tmpVertex=L()}applyToVertex(e,t,r){const i=this.objectTransform.transform;let o=i[0]*e+i[4]*t+i[8]*r+i[12],a=i[1]*e+i[5]*t+i[9]*r+i[13],n=i[2]*e+i[6]*t+i[10]*r+i[14];const u=this.offset/Math.sqrt(o*o+a*a+n*n);o+=o*u,a+=a*u,n+=n*u;const l=this.objectTransform.inverse;return this.tmpVertex[0]=l[0]*o+l[4]*a+l[8]*n+l[12],this.tmpVertex[1]=l[1]*o+l[5]*a+l[9]*n+l[13],this.tmpVertex[2]=l[2]*o+l[6]*a+l[10]*n+l[14],this.tmpVertex}applyToMinMax(e,t){const r=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*r,e[1]+=e[1]*r,e[2]+=e[2]*r;const i=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*i,t[1]+=t[1]*i,t[2]+=t[2]*i}applyToAabb(e){const t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;const r=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*r,e[4]+=e[4]*r,e[5]+=e[5]*r,e}applyToBoundingSphere(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),r=this.offset/t;return this.sphere[0]=e[0]+e[0]*r,this.sphere[1]=e[1]+e[1]*r,this.sphere[2]=e[2]+e[2]*r,this.sphere[3]=e[3]+e[3]*this.offset/t,this.sphere}}const tt=new Xs;function Js(s){return v(s)?(tt.offset=s,tt):null}const st=new Ys;function Zr(s){return v(s)?(st.offset=s,st):null}const it=new Qs;function eo(s){return v(s)?(it.offset=s,it):null}const to="terrain",rt=Ps();function so(s,e,t,r,i=1){const o=t.typedBuffer,a=t.typedBufferStride,n=s.length;if(r*=a,i===1)for(let u=0;u<n;++u)o[r]=e[s[u]],r+=a;else for(let u=0;u<n;++u){const l=e[s[u]];for(let h=0;h<i;h++)o[r]=l,r+=a}}function Zs(s,e,t,r){const i=t.typedBuffer,o=t.typedBufferStride,a=s.length;r*=o;for(let n=0;n<a;++n){const u=2*s[n];i[r]=e[u],i[r+1]=e[u+1],r+=o}}function yt(s,e,t,r,i){const o=t.typedBuffer,a=t.typedBufferStride,n=s.length;if(r*=a,i==null||i===1)for(let u=0;u<n;++u){const l=3*s[u];o[r]=e[l],o[r+1]=e[l+1],o[r+2]=e[l+2],r+=a}else for(let u=0;u<n;++u){const l=3*s[u];for(let h=0;h<i;++h)o[r]=e[l],o[r+1]=e[l+1],o[r+2]=e[l+2],r+=a}}function ei(s,e,t,r,i=1){const o=t.typedBuffer,a=t.typedBufferStride,n=s.length;if(r*=a,i===1)for(let u=0;u<n;++u){const l=4*s[u];o[r]=e[l],o[r+1]=e[l+1],o[r+2]=e[l+2],o[r+3]=e[l+3],r+=a}else for(let u=0;u<n;++u){const l=4*s[u];for(let h=0;h<i;++h)o[r]=e[l],o[r+1]=e[l+1],o[r+2]=e[l+2],o[r+3]=e[l+3],r+=a}}function ti(s,e,t,r,i,o=1){if(!t)return void yt(s,e,r,i,o);const a=r.typedBuffer,n=r.typedBufferStride,u=s.length,l=t[0],h=t[1],c=t[2],b=t[4],_=t[5],A=t[6],E=t[8],p=t[9],S=t[10],f=t[12],$=t[13],N=t[14];i*=n;let D=0,M=0,y=0;const P=Mt(t)?T=>{D=e[T]+f,M=e[T+1]+$,y=e[T+2]+N}:T=>{const x=e[T],I=e[T+1],R=e[T+2];D=l*x+b*I+E*R+f,M=h*x+_*I+p*R+$,y=c*x+A*I+S*R+N};if(o===1)for(let T=0;T<u;++T)P(3*s[T]),a[i]=D,a[i+1]=M,a[i+2]=y,i+=n;else for(let T=0;T<u;++T){P(3*s[T]);for(let x=0;x<o;++x)a[i]=D,a[i+1]=M,a[i+2]=y,i+=n}}function si(s,e,t,r,i,o=1){if(!t)return void yt(s,e,r,i,o);const a=t,n=r.typedBuffer,u=r.typedBufferStride,l=s.length,h=a[0],c=a[1],b=a[2],_=a[4],A=a[5],E=a[6],p=a[8],S=a[9],f=a[10],$=!lt(a),N=1e-6,D=1-N;i*=u;let M=0,y=0,P=0;const T=Mt(a)?x=>{M=e[x],y=e[x+1],P=e[x+2]}:x=>{const I=e[x],R=e[x+1],C=e[x+2];M=h*I+_*R+p*C,y=c*I+A*R+S*C,P=b*I+E*R+f*C};if(o===1)if($)for(let x=0;x<l;++x){T(3*s[x]);const I=M*M+y*y+P*P;if(I<D&&I>N){const R=1/Math.sqrt(I);n[i]=M*R,n[i+1]=y*R,n[i+2]=P*R}else n[i]=M,n[i+1]=y,n[i+2]=P;i+=u}else for(let x=0;x<l;++x)T(3*s[x]),n[i]=M,n[i+1]=y,n[i+2]=P,i+=u;else for(let x=0;x<l;++x){if(T(3*s[x]),$){const I=M*M+y*y+P*P;if(I<D&&I>N){const R=1/Math.sqrt(I);M*=R,y*=R,P*=R}}for(let I=0;I<o;++I)n[i]=M,n[i+1]=y,n[i+2]=P,i+=u}}function ii(s,e,t,r,i,o=1){if(!t)return void ei(s,e,r,i,o);const a=t,n=r.typedBuffer,u=r.typedBufferStride,l=s.length,h=a[0],c=a[1],b=a[2],_=a[4],A=a[5],E=a[6],p=a[8],S=a[9],f=a[10],$=!lt(a),N=1e-6,D=1-N;if(i*=u,o===1)for(let M=0;M<l;++M){const y=4*s[M],P=e[y],T=e[y+1],x=e[y+2],I=e[y+3];let R=h*P+_*T+p*x,C=c*P+A*T+S*x,V=b*P+E*T+f*x;if($){const U=R*R+C*C+V*V;if(U<D&&U>N){const k=1/Math.sqrt(U);R*=k,C*=k,V*=k}}n[i]=R,n[i+1]=C,n[i+2]=V,n[i+3]=I,i+=u}else for(let M=0;M<l;++M){const y=4*s[M],P=e[y],T=e[y+1],x=e[y+2],I=e[y+3];let R=h*P+_*T+p*x,C=c*P+A*T+S*x,V=b*P+E*T+f*x;if($){const U=R*R+C*C+V*V;if(U<D&&U>N){const k=1/Math.sqrt(U);R*=k,C*=k,V*=k}}for(let U=0;U<o;++U)n[i]=R,n[i+1]=C,n[i+2]=V,n[i+3]=I,i+=u}}function ot(s,e,t,r,i,o=1){const a=r.typedBuffer,n=r.typedBufferStride,u=s.length;if(i*=n,t!==e.length||t!==4)if(o!==1)if(t!==4)for(let l=0;l<u;++l){const h=3*s[l];for(let c=0;c<o;++c)a[i]=e[h],a[i+1]=e[h+1],a[i+2]=e[h+2],a[i+3]=255,i+=n}else for(let l=0;l<u;++l){const h=4*s[l];for(let c=0;c<o;++c)a[i]=e[h],a[i+1]=e[h+1],a[i+2]=e[h+2],a[i+3]=e[h+3],i+=n}else{if(t===4){for(let l=0;l<u;++l){const h=4*s[l];a[i]=e[h],a[i+1]=e[h+1],a[i+2]=e[h+2],a[i+3]=e[h+3],i+=n}return}for(let l=0;l<u;++l){const h=3*s[l];a[i]=e[h],a[i+1]=e[h+1],a[i+2]=e[h+2],a[i+3]=255,i+=n}}else{a[i]=e[0],a[i+1]=e[1],a[i+2]=e[2],a[i+3]=e[3];const l=new Uint32Array(r.typedBuffer.buffer,r.start),h=n/4,c=l[i/=4];i+=h;const b=u*o;for(let _=1;_<b;++_)l[i]=c,i+=h}}function ri(s,e,t,r,i=1){const o=e.typedBuffer,a=e.typedBufferStride;if(r*=a,i===1)for(let n=0;n<t;++n)o[r]=s[0],o[r+1]=s[1],o[r+2]=s[2],o[r+3]=s[3],r+=a;else for(let n=0;n<t;++n)for(let u=0;u<i;++u)o[r]=s[0],o[r+1]=s[1],o[r+2]=s[2],o[r+3]=s[3],r+=a}function oi(s,e,t,r,i,o){for(const a of e.fieldNames){const n=s.vertexAttributes.get(a),u=s.indices.get(a);if(n&&u)switch(a){case O.POSITION:{G(n.size===3);const l=i.getField(a,fe);l&&ti(u,n.data,t,l,o);break}case O.NORMAL:{G(n.size===3);const l=i.getField(a,fe);l&&si(u,n.data,r,l,o);break}case O.UV0:{G(n.size===2);const l=i.getField(a,ct);l&&Zs(u,n.data,l,o);break}case O.COLOR:{G(n.size===3||n.size===4);const l=i.getField(a,ce);l&&ot(u,n.data,n.size,l,o);break}case O.SYMBOLCOLOR:{G(n.size===3||n.size===4);const l=i.getField(a,ce);l&&ot(u,n.data,n.size,l,o);break}case O.TANGENT:{G(n.size===4);const l=i.getField(a,we);l&&ii(u,n.data,r,l,o);break}}else if(a===O.OBJECTANDLAYERIDCOLOR&&v(s.objectAndLayerIdColor)&&s.objectAndLayerIdColor.length===4){const l=s.indices.get(O.POSITION);if(l){const h=l.length,c=i.getField(a,ce);ri(s.objectAndLayerIdColor,c,h,o)}}}}function Mt(s){return s[0]===1&&s[1]===0&&s[2]===0&&s[4]===0&&s[5]===1&&s[6]===0&&s[8]===0&&s[9]===0&&s[10]===1}const ai=Ms(Z.SRC_ALPHA,Z.ONE,Z.ONE_MINUS_SRC_ALPHA,Z.ONE_MINUS_SRC_ALPHA),ni=bt(Z.ONE,Z.ONE),li=bt(Z.ZERO,Z.ONE_MINUS_SRC_ALPHA);function ui(s){return s===X.FrontFace?null:s===X.Alpha?li:ni}function io(s){return s===X.FrontFace?Tt:null}const hi=5e5,ci={factor:-1,units:-2};function fi(s){return s?ci:null}function di(s,e=j.LESS){return s===X.NONE||s===X.FrontFace?e:j.LEQUAL}const ro={func:j.LESS},oo={func:j.ALWAYS},pi={mask:255},ao={mask:0},no=s=>({function:{func:j.NOTEQUAL,ref:s,mask:s},operation:{fail:B.KEEP,zFail:B.KEEP,zPass:B.KEEP}}),lo=s=>({function:{func:j.ALWAYS,ref:s,mask:s},operation:{fail:B.KEEP,zFail:B.KEEP,zPass:B.REPLACE}}),mi={function:{func:j.ALWAYS,ref:ee.OutlineVisualElementMask,mask:ee.OutlineVisualElementMask},operation:{fail:B.KEEP,zFail:B.KEEP,zPass:B.ZERO}},gi={function:{func:j.ALWAYS,ref:ee.OutlineVisualElementMask,mask:ee.OutlineVisualElementMask},operation:{fail:B.KEEP,zFail:B.KEEP,zPass:B.REPLACE}},uo={function:{func:j.EQUAL,ref:ee.OutlineVisualElementMask,mask:ee.OutlineVisualElementMask},operation:{fail:B.KEEP,zFail:B.KEEP,zPass:B.KEEP}},ho={function:{func:j.NOTEQUAL,ref:ee.OutlineVisualElementMask,mask:ee.OutlineVisualElementMask},operation:{fail:B.KEEP,zFail:B.KEEP,zPass:B.KEEP}};let _i=class extends As{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=ue(0,1,.5),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=te.Back,this.emissiveFactor=ue(0,0,0),this.instancedDoublePrecision=!1,this.normals="default",this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=ue(.2,.2,.2),this.diffuse=ue(.8,.8,.8),this.externalColor=Ns(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=L(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvSizeValue=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=De(),this.vvOpacityEnabled=!1,this.vvOpacityValues=[],this.vvOpacityOpacities=[],this.transparent=!1,this.writeDepth=!0,this.customDepthTest=xe.Less,this.textureAlphaMode=q.Blend,this.textureAlphaCutoff=ws,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=ds.Occlude}},fo=class extends Os{constructor(){super(...arguments),this.origin=L(),this.slicePlaneLocalOrigin=this.origin}};class be extends Ss{initializeConfiguration(e,t){t.hasWebGL2Context=e.rctx.type===Ds.WEBGL2,t.spherical=e.viewingMode===Be.Global,t.doublePrecisionRequiresObfuscation=zs(e.rctx),t.textureCoordinateType=t.hasColorTexture||t.hasMetallicRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture||t.hasNormalTexture?Se.Default:Se.None,t.objectAndLayerIdColorInstanced=t.instanced}initializeProgram(e){return this._initializeProgram(e,be.shader)}_initializeProgram(e,t){return new Es(e.rctx,t.get().build(this.configuration),ps)}_convertDepthTestFunction(e){return e===xe.Lequal?j.LEQUAL:j.LESS}_makePipeline(e,t){const r=this.configuration,i=e===X.NONE,o=e===X.FrontFace;return Rs({blending:r.output!==w.Color&&r.output!==w.Alpha||!r.transparent?null:i?ai:ui(e),culling:xi(r)&&Is(r.cullFace),depthTest:{func:di(e,this._convertDepthTestFunction(r.customDepthTest))},depthWrite:i||o?r.writeDepth&&Tt:null,colorWrite:Ls,stencilWrite:r.hasOccludees?pi:null,stencilTest:r.hasOccludees?t?gi:mi:null,polygonOffset:i||o?null:fi(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}function xi(s){return s.cullFace!==te.None||!s.hasSlicePlane&&!s.transparent&&!s.doubleSidedMode}be.shader=new vt(Bs,()=>Ot(()=>import("./DefaultMaterial.glsl-42d04dab.js"),["./DefaultMaterial.glsl-42d04dab.js","./mat4f64-1e28eae0.js","./Matrix3PassUniform-da8eddae.js","./ShaderBuilder-93e8045e.js","./typedArrayUtil-a8b5b3e9.js","./Error-653283ae.js","./string-cdf077e6.js","./mat3f64-c6305894.js","./vec3f32-c9aa289f.js","./vec3f64-2f9cef06.js","./VertexAttribute-9c5c630d.js","./mat4-44a0988f.js","./common-c186b691.js","./vec3-a020a6f6.js","./MixExternalColor.glsl-25f0049c.js","./cast-7928d7aa.js","./ensureType-cf29afa9.js","./nextTick-3ee5a785.js","./promiseUtils-6684e352.js","./ForwardLinearDepth.glsl-36f9eb3b.js","./View.glsl-8b12b8c2.js","./mat4f32-77b3d8ac.js","./Texture2DPassUniform-6e8ae673.js","./vec2-2cef68de.js","./vec2f64-30dc1443.js","./ShaderTechniqueConfiguration-9f5b4555.js","./VisualVariablePassParameters-5807c7dc.js","./enums-64ab819c.js","./VertexElementDescriptor-2925c6af.js","./FramebufferObject-50e1b68f.js","./Texture-e79b14e7.js","./mathUtils-2519596a.js","./vec4-790471c0.js","./context-util-1e3c8cfc.js","./request-d3e98716.js","./preload-helper-41c905a7.js","./aaBoundingBox-fc742a4e.js","./Extent-69509002.js","./Ellipsoid-89682c5e.js","./aaBoundingRect-4a760199.js","./basicInterfaces-19ed850e.js","./ViewingMode-5d7d590b.js","./Util-a48361c6.js","./vec4f64-e407da96.js","./symbolColorUtils-604c5345.js","./PhysicallyBasedRendering.glsl-a986c926.js","./FloatPassUniform-d2dfc562.js","./Float4PassUniform-3a47b7b3.js","./RgbaFloatEncoding.glsl-6036ca34.js","./compilerUtils-034cacb8.js","./Texture2DDrawUniform-22924c6f.js","./PiUtils.glsl-0c0898f0.js","./Slice.glsl-a612de15.js","./Transform.glsl-f15542a7.js","./ObjectAndLayerIdColor.glsl-73c19386.js","./OutputDepth.glsl-179f1d8f.js","./OutputHighlight.glsl-7364b03b.js","./VisualVariables.glsl-b8290512.js","./DiscardOrAdjustAlphaBlend.glsl-5f837994.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-cd195b0e.js","./Normals.glsl-90e28525.js","./EvaluateSceneLighting.glsl-3bbc6edf.js","./SSAOBlur.glsl-c6f142fc.js","./ScreenSpacePass-00f8c8a4.js","./ReadLinearDepth.glsl-7ff30f7d.js","./SSAO.glsl-6f3b4065.js","./mat3f32-d3d088e8.js","./DefaultMaterial.glsl-b4f4cbc5.js","./VertexColor.glsl-db21b96c.js","./VerticalOffset.glsl-86460edb.js","./MultipassTerrainTest.glsl-e79d40de.js"],import.meta.url));let d=class extends Vs{constructor(){super(...arguments),this.output=w.Color,this.alphaDiscardMode=q.Opaque,this.doubleSidedMode=oe.None,this.pbrMode=ge.Disabled,this.cullFace=te.None,this.transparencyPassType=X.NONE,this.normalType=_e.Attribute,this.textureCoordinateType=Se.None,this.customDepthTest=xe.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}};m([g({count:w.COUNT})],d.prototype,"output",void 0),m([g({count:q.COUNT})],d.prototype,"alphaDiscardMode",void 0),m([g({count:oe.COUNT})],d.prototype,"doubleSidedMode",void 0),m([g({count:ge.COUNT})],d.prototype,"pbrMode",void 0),m([g({count:te.COUNT})],d.prototype,"cullFace",void 0),m([g({count:X.COUNT})],d.prototype,"transparencyPassType",void 0),m([g({count:_e.COUNT})],d.prototype,"normalType",void 0),m([g({count:Se.COUNT})],d.prototype,"textureCoordinateType",void 0),m([g({count:xe.COUNT})],d.prototype,"customDepthTest",void 0),m([g()],d.prototype,"spherical",void 0),m([g()],d.prototype,"hasVertexColors",void 0),m([g()],d.prototype,"hasSymbolColors",void 0),m([g()],d.prototype,"hasVerticalOffset",void 0),m([g()],d.prototype,"hasSlicePlane",void 0),m([g()],d.prototype,"hasSliceHighlight",void 0),m([g()],d.prototype,"hasColorTexture",void 0),m([g()],d.prototype,"hasMetallicRoughnessTexture",void 0),m([g()],d.prototype,"hasEmissionTexture",void 0),m([g()],d.prototype,"hasOcclusionTexture",void 0),m([g()],d.prototype,"hasNormalTexture",void 0),m([g()],d.prototype,"hasScreenSizePerspective",void 0),m([g()],d.prototype,"hasVertexTangents",void 0),m([g()],d.prototype,"hasOccludees",void 0),m([g()],d.prototype,"hasMultipassTerrain",void 0),m([g()],d.prototype,"hasModelTransformation",void 0),m([g()],d.prototype,"offsetBackfaces",void 0),m([g()],d.prototype,"vvSize",void 0),m([g()],d.prototype,"vvColor",void 0),m([g()],d.prototype,"receiveShadows",void 0),m([g()],d.prototype,"receiveAmbientOcclusion",void 0),m([g()],d.prototype,"textureAlphaPremultiplied",void 0),m([g()],d.prototype,"instanced",void 0),m([g()],d.prototype,"instancedColor",void 0),m([g()],d.prototype,"objectAndLayerIdColorInstanced",void 0),m([g()],d.prototype,"instancedDoublePrecision",void 0),m([g()],d.prototype,"doublePrecisionRequiresObfuscation",void 0),m([g()],d.prototype,"writeDepth",void 0),m([g()],d.prototype,"transparent",void 0),m([g()],d.prototype,"enableOffset",void 0),m([g()],d.prototype,"cullAboveGround",void 0),m([g()],d.prototype,"snowCover",void 0),m([g()],d.prototype,"hasColorTextureTransform",void 0),m([g()],d.prototype,"hasEmissionTextureTransform",void 0),m([g()],d.prototype,"hasNormalTextureTransform",void 0),m([g()],d.prototype,"hasOcclusionTextureTransform",void 0),m([g()],d.prototype,"hasMetallicRoughnessTextureTransform",void 0),m([g({constValue:!0})],d.prototype,"hasVvInstancing",void 0),m([g({constValue:!1})],d.prototype,"useCustomDTRExponentForWater",void 0),m([g({constValue:!1})],d.prototype,"supportsTextureAtlas",void 0),m([g({constValue:!0})],d.prototype,"useFillLights",void 0);class Ee extends be{initializeConfiguration(e,t){super.initializeConfiguration(e,t),t.hasMetallicRoughnessTexture=!1,t.hasEmissionTexture=!1,t.hasOcclusionTexture=!1,t.hasNormalTexture=!1,t.hasModelTransformation=!1,t.normalType=_e.Attribute,t.doubleSidedMode=oe.WindingOrder,t.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,Ee.shader)}}Ee.shader=new vt(Us,()=>Ot(()=>import("./RealisticTree.glsl-a7d59838.js"),["./RealisticTree.glsl-a7d59838.js","./Matrix3PassUniform-da8eddae.js","./ShaderBuilder-93e8045e.js","./typedArrayUtil-a8b5b3e9.js","./Error-653283ae.js","./string-cdf077e6.js","./mat3f64-c6305894.js","./mat4f64-1e28eae0.js","./vec3f32-c9aa289f.js","./vec3f64-2f9cef06.js","./VertexAttribute-9c5c630d.js","./mat4-44a0988f.js","./common-c186b691.js","./vec3-a020a6f6.js","./MixExternalColor.glsl-25f0049c.js","./cast-7928d7aa.js","./ensureType-cf29afa9.js","./nextTick-3ee5a785.js","./promiseUtils-6684e352.js","./ForwardLinearDepth.glsl-36f9eb3b.js","./View.glsl-8b12b8c2.js","./mat4f32-77b3d8ac.js","./Texture2DPassUniform-6e8ae673.js","./vec2-2cef68de.js","./vec2f64-30dc1443.js","./ShaderTechniqueConfiguration-9f5b4555.js","./VisualVariablePassParameters-5807c7dc.js","./enums-64ab819c.js","./VertexElementDescriptor-2925c6af.js","./FramebufferObject-50e1b68f.js","./Texture-e79b14e7.js","./mathUtils-2519596a.js","./vec4-790471c0.js","./context-util-1e3c8cfc.js","./request-d3e98716.js","./preload-helper-41c905a7.js","./aaBoundingBox-fc742a4e.js","./Extent-69509002.js","./Ellipsoid-89682c5e.js","./aaBoundingRect-4a760199.js","./basicInterfaces-19ed850e.js","./ViewingMode-5d7d590b.js","./Util-a48361c6.js","./vec4f64-e407da96.js","./symbolColorUtils-604c5345.js","./PhysicallyBasedRendering.glsl-a986c926.js","./FloatPassUniform-d2dfc562.js","./Float4PassUniform-3a47b7b3.js","./RgbaFloatEncoding.glsl-6036ca34.js","./compilerUtils-034cacb8.js","./Texture2DDrawUniform-22924c6f.js","./PiUtils.glsl-0c0898f0.js","./Slice.glsl-a612de15.js","./Transform.glsl-f15542a7.js","./ObjectAndLayerIdColor.glsl-73c19386.js","./OutputDepth.glsl-179f1d8f.js","./OutputHighlight.glsl-7364b03b.js","./VisualVariables.glsl-b8290512.js","./DiscardOrAdjustAlphaBlend.glsl-5f837994.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-cd195b0e.js","./EvaluateSceneLighting.glsl-3bbc6edf.js","./SSAOBlur.glsl-c6f142fc.js","./ScreenSpacePass-00f8c8a4.js","./ReadLinearDepth.glsl-7ff30f7d.js","./SSAO.glsl-6f3b4065.js","./RealisticTree.glsl-2b30ed32.js","./VertexColor.glsl-db21b96c.js","./VerticalOffset.glsl-86460edb.js","./MultipassTerrainTest.glsl-e79d40de.js"],import.meta.url));class St extends ms{constructor(e){super(e,vi),this.supportsEdges=!0,this._configuration=new d,this._vertexBufferLayout=Ai(this.parameters),this._instanceBufferLayout=e.instanced?yi(this.parameters):null}isVisibleForOutput(e){return e!==w.Shadow&&e!==w.ShadowExludeHighlight&&e!==w.ShadowHighlight||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||e.layerOpacity===0)return!1;const{instanced:t,hasVertexColors:r,hasSymbolColors:i,vvColorEnabled:o}=e,a=v(t)&&t.includes("color"),n=e.colorMixMode==="replace",u=e.opacity>0,l=e.externalColor&&e.externalColor[3]>0;return r&&(a||o||i)?!!n||u:r?n?l:u:a||o||i?!!n||u:n?l:u}getConfiguration(e,t){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=!!this.parameters.instanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.hasVerticalOffset=v(this.parameters.verticalOffset),this._configuration.hasScreenSizePerspective=v(this.parameters.screenSizePerspective),this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normals==="screenDerivative"?_e.ScreenDerivative:_e.Attribute,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,v(this.parameters.customDepthTest)&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?te.None:this.parameters.cullFace,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=v(this.parameters.modelTransformation),e!==w.Color&&e!==w.Alpha||(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=oe.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?oe.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?oe.WindingOrder:oe.None,this._configuration.instancedColor=v(this.parameters.instanced)&&this.parameters.instanced.includes("color"),this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=!!t.ssaoHelper.ready&&this.parameters.receiveSSAO,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?ge.Schematic:ge.Normal:ge.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<hi,this._configuration.snowCover=this.hasSnowCover(t),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return v(e.weather)&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}intersect(e,t,r,i,o,a,n){if(v(this.parameters.verticalOffset)){const u=i.camera;W(Ce,r[12],r[13],r[14]);let l=null;switch(i.viewingMode){case Be.Global:l=ut(at,Ce);break;case Be.Local:l=Vt(at,Ei)}let h=0;const c=ae(Ri,Ce,u.eye),b=Ve(c),_=K(c,c,1/b);let A=null;this.parameters.screenSizePerspective&&(A=Ut(l,_)),h+=gs(u,b,this.parameters.verticalOffset,A,this.parameters.screenSizePerspective),K(l,l,h),qt(Pe,l,i.transform.inverseRotation),o=ae(Mi,o,Pe),a=ae(Si,a,Pe)}_s(e,t,i,o,a,Js(i.verticalOffset),n)}requiresSlot(e,t){return t===w.Color||t===w.Alpha||t===w.Depth||t===w.Normal||t===w.Shadow||t===w.ShadowHighlight||t===w.ShadowExludeHighlight||t===w.Highlight||t===w.ObjectAndLayerIdColor?e===(this.parameters.transparent?this.parameters.writeDepth?he.TRANSPARENT_MATERIAL:he.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:he.OPAQUE_MATERIAL)||e===he.DRAPED_MATERIAL||t===w.ObjectAndLayerIdColor:!1}createGLMaterial(e){return new bi(e)}createBufferWriter(){return new Oi(this._vertexBufferLayout,this._instanceBufferLayout)}}class bi extends ks{constructor(e){super({...e,...e.material.parameters})}_updateParameters(e){const t=this._material.parameters;this.updateTexture(t.textureId);const r=e.camera.viewInverseTransposeMatrix;return W(t.origin,r[3],r[7],r[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(t.treeRendering?Ee:be,e)}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==w.Color&&this._output!==w.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this._updateParameters(e)}}class Ti extends _i{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}}const vi=new Ti;class Oi{constructor(e,t){this.vertexBufferLayout=e,this.instanceBufferLayout=t}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(O.POSITION).length}write(e,t,r,i,o){oi(r,this.vertexBufferLayout,e,t,i,o)}}function Ai(s){const e=s.textureId||s.normalTextureId||s.metallicRoughnessTextureId||s.emissiveTextureId||s.occlusionTextureId,t=xt().vec3f(O.POSITION).vec3f(O.NORMAL);return s.hasVertexTangents&&t.vec4f(O.TANGENT),e&&t.vec2f(O.UV0),s.hasVertexColors&&t.vec4u8(O.COLOR),s.hasSymbolColors&&t.vec4u8(O.SYMBOLCOLOR),vs("enable-feature:objectAndLayerId-rendering")&&t.vec4u8(O.OBJECTANDLAYERIDCOLOR),t}function yi(s){let e=xt();return e=s.instancedDoublePrecision?e.vec3f(O.MODELORIGINHI).vec3f(O.MODELORIGINLO).mat3f(O.MODEL).mat3f(O.MODELNORMAL):e.mat4f(O.MODEL).mat4f(O.MODELNORMAL),v(s.instanced)&&s.instanced.includes("color")&&(e=e.vec4f(O.INSTANCECOLOR)),v(s.instanced)&&s.instanced.includes("featureAttribute")&&(e=e.vec4f(O.INSTANCEFEATUREATTRIBUTE)),v(s.instanced)&&s.instanced.includes("objectAndLayerIdColor")&&(e=e.vec4u8(O.OBJECTANDLAYERIDCOLOR_INSTANCED)),e}const Mi=L(),Si=L(),Ei=ue(0,0,1),at=L(),Pe=L(),Ce=L(),Ri=L();function pe(s){if(de(s))return null;const e=v(s.offset)?s.offset:rs,t=v(s.rotation)?s.rotation:0,r=v(s.scale)?s.scale:os,i=Re(1,0,0,0,1,0,e[0],e[1],1),o=Re(Math.cos(t),-Math.sin(t),0,Math.sin(t),Math.cos(t),0,0,0,1),a=Re(r[0],0,0,0,r[1],0,0,0,1),n=is();return qe(n,o,a),qe(n,i,n),n}class Ii{constructor(e,t,r,i,o){this.name=e,this.stageResources=t,this.lodThreshold=r,this.pivotOffset=i,this.numberOfVertices=o}}const Q=ls.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function Li(s,e){const t=await $i(s,e),r=await zi(t.textureDefinitions,e);let i=0;for(const o in r)if(r.hasOwnProperty(o)){const a=r[o];i+=a!=null&&a.image?a.image.width*a.image.height*4:0}return{resource:t,textures:r,size:i+ns(t)}}async function $i(s,e){const t=v(e)&&e.streamDataRequester;if(t)return Pi(s,t,e);const r=await ft(as(s,Pt(e)));if(r.ok===!0)return r.value.data;dt(r.error),Et(r.error)}async function Pi(s,e,t){const r=await ft(e.request(s,"json",t));if(r.ok===!0)return r.value;dt(r.error),Et(r.error.details.url)}function Et(s){throw new us("",`Request for object resource failed: ${s}`)}function Ci(s){const e=s.params,t=e.topology;let r=!0;switch(e.vertexAttributes||(Q.warn("Geometry must specify vertex attributes"),r=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const o=e.faces;if(o){if(e.vertexAttributes)for(const a in e.vertexAttributes){const n=o[a];n&&n.values?(n.valueType!=null&&n.valueType!=="UInt32"&&(Q.warn(`Unsupported indexed geometry indices type '${n.valueType}', only UInt32 is currently supported`),r=!1),n.valuesPerElement!=null&&n.valuesPerElement!==1&&(Q.warn(`Unsupported indexed geometry values per element '${n.valuesPerElement}', only 1 is currently supported`),r=!1)):(Q.warn(`Indexed geometry does not specify face indices for '${a}' attribute`),r=!1)}}else Q.warn("Indexed geometries must specify faces"),r=!1;break}default:Q.warn(`Unsupported topology '${t}'`),r=!1}s.params.material||(Q.warn("Geometry requires material"),r=!1);const i=s.params.vertexAttributes;for(const o in i)i[o].values||(Q.warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function Ni(s,e){const t=[],r=[],i=[],o=[],a=s.resource,n=pt.parse(a.version||"1.0","wosr");Di.validate(n);const u=a.model.name,l=a.model.geometries,h=a.materialDefinitions,c=s.textures;let b=0;const _=new Map;for(let A=0;A<l.length;A++){const E=l[A];if(!Ci(E))continue;const p=Bi(E),S=E.params.vertexAttributes,f=[];for(const T in S){const x=S[T],I=x.values;f.push([T,{data:I,size:x.valuesPerElement,exclusive:!0}])}const $=[];if(E.params.topology!=="PerAttributeArray"){const T=E.params.faces;for(const x in T)$.push([x,T[x].values])}const N=c&&c[p.texture];if(N&&!_.has(p.texture)){const{image:T,params:x}=N,I=new _t(T,x);o.push(I),_.set(p.texture,I)}const D=_.get(p.texture),M=D?D.id:void 0;let y=i[p.material]?i[p.material][p.texture]:null;if(!y){const T=h[p.material.substring(p.material.lastIndexOf("/")+1)].params;T.transparency===1&&(T.transparency=0);const x=N&&N.alphaChannelUsage,I=T.transparency>0||x==="transparency"||x==="maskAndTransparency",R=N?Rt(N.alphaChannelUsage):void 0,C={ambient:Ke(T.diffuse),diffuse:Ke(T.diffuse),opacity:1-(T.transparency||0),transparent:I,textureAlphaMode:R,textureAlphaCutoff:.33,textureId:M,initTextureTransparent:!0,doubleSided:!0,cullFace:te.None,colorMixMode:T.externalColorMixMode||"tint",textureAlphaPremultiplied:!!N&&!!N.params.preMultiplyAlpha};v(e)&&e.materialParamsMixin&&Object.assign(C,e.materialParamsMixin),y=new St(C),i[p.material]||(i[p.material]={}),i[p.material][p.texture]=y}r.push(y);const P=new Ue(f,$);b+=$.position?$.position.length:0,t.push(P)}return{engineResources:[{name:u,stageResources:{textures:o,materials:r,geometries:t},pivotOffset:a.model.pivotOffset,numberOfVertices:b,lodThreshold:null}],referenceBoundingBox:wi(t)}}function wi(s){const e=ht();return s.forEach(t=>{const r=t.boundingInfo;v(r)&&(Me(e,r.getBBMin()),Me(e,r.getBBMax()))}),e}async function zi(s,e){const t=[];for(const o in s){const a=s[o],n=a.images[0].data;if(!n){Q.warn("Externally referenced texture data is not yet supported");continue}const u=a.encoding+";base64,"+n,l="/textureDefinitions/"+o,h=a.channels==="rgba"?a.alphaChannelUsage||"transparency":"none",c={noUnpackFlip:!0,wrap:{s:Ze.REPEAT,t:Ze.REPEAT},preMultiplyAlpha:Rt(h)!==q.Opaque},b=v(e)&&e.disableTextures?Promise.resolve(null):xs(u,e);t.push(b.then(_=>({refId:l,image:_,params:c,alphaChannelUsage:h})))}const r=await Promise.all(t),i={};for(const o of r)i[o.refId]=o;return i}function Rt(s){switch(s){case"mask":return q.Mask;case"maskAndTransparency":return q.MaskBlend;case"none":return q.Opaque;default:return q.Blend}}function Bi(s){const e=s.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const Di=new pt(1,2,"wosr");async function Vi(s,e){const t=It($t(s));if(t.fileType==="wosr"){const h=await(e.cache?e.cache.loadWOSR(t.url,e):Li(t.url,e)),{engineResources:c,referenceBoundingBox:b}=Ni(h,e);return{lods:c,referenceBoundingBox:b,isEsriSymbolResource:!1,isWosr:!0}}const r=await(e.cache?e.cache.loadGLTF(t.url,e,e.usePBR):Kt(new Qt(e.streamDataRequester),t.url,e,e.usePBR)),i=Ct(r.model.meta,"ESRI_proxyEllipsoid"),o=r.meta.isEsriSymbolResource&&v(i)&&r.meta.uri.includes("/RealisticTrees/");o&&!r.customMeta.esriTreeRendering&&(r.customMeta.esriTreeRendering=!0,Fi(r,i));const a=r.meta.isEsriSymbolResource?{usePBR:e.usePBR,isSchematic:!1,treeRendering:o,mrrFactors:[0,1,.2]}:{usePBR:e.usePBR,isSchematic:!1,treeRendering:!1,mrrFactors:[0,1,.5]},n={...e.materialParamsMixin,treeRendering:o},{engineResources:u,referenceBoundingBox:l}=Lt(r,a,n,e.skipHighLods&&t.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:t.specifiedLodIndex});return{lods:u,referenceBoundingBox:l,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1}}function It(s){const e=s.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return e?{fileType:"gltf",url:e[1],specifiedLodIndex:e[4]!=null?Number(e[4]):null}:s.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:s,specifiedLodIndex:null}:{fileType:"unknown",url:s,specifiedLodIndex:null}}function Lt(s,e,t,r){const i=s.model,o=new Array,a=new Map,n=new Map,u=i.lods.length,l=ht();return i.lods.forEach((h,c)=>{const b=r.skipHighLods===!0&&(u>1&&c===0||u>3&&c===1)||r.skipHighLods===!1&&r.singleLodIndex!=null&&c!==r.singleLodIndex;if(b&&c!==0)return;const _=new Array;let A=0;if(h.parts.forEach(p=>{const{geometry:S,vertexCount:f}=Ui(p);_.push(S),A+=f;const $=S.boundingInfo;v($)&&c===0&&(Me(l,$.getBBMin()),Me(l,$.getBBMax()))}),b)return;const E=new Ii(h.name,{textures:new Array,materials:new Array,geometries:_},h.lodThreshold,[0,0,0],A);o.push(E),h.parts.forEach(p=>{const S=p.material+(p.attributes.normal?"_normal":"")+(p.attributes.color?"_color":"")+(p.attributes.texCoord0?"_texCoord0":"")+(p.attributes.tangent?"_tangent":""),f=i.materials.get(p.material),$=v(p.attributes.texCoord0),N=v(p.attributes.normal);if(de(f))return;const D=qi(f.alphaMode);if(!a.has(S)){if($){const C=(V,U=!1)=>{if(v(V)&&!n.has(V)){const k=i.textures.get(V);v(k)&&n.set(V,new _t(k.data,U?{...k.parameters,preMultiplyAlpha:U}:k.parameters))}};C(f.textureColor,D!==q.Opaque),C(f.textureNormal),C(f.textureOcclusion),C(f.textureEmissive),C(f.textureMetallicRoughness)}const M=f.color[0]**(1/ne),y=f.color[1]**(1/ne),P=f.color[2]**(1/ne),T=f.emissiveFactor[0]**(1/ne),x=f.emissiveFactor[1]**(1/ne),I=f.emissiveFactor[2]**(1/ne),R=v(f.textureColor)&&$?n.get(f.textureColor):null;a.set(S,new St({...e,transparent:D===q.Blend,customDepthTest:xe.Lequal,textureAlphaMode:D,textureAlphaCutoff:f.alphaCutoff,diffuse:[M,y,P],ambient:[M,y,P],opacity:f.opacity,doubleSided:f.doubleSided,doubleSidedType:"winding-order",cullFace:f.doubleSided?te.None:te.Back,hasVertexColors:!!p.attributes.color,hasVertexTangents:!!p.attributes.tangent,normals:N?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:v(R)?R.id:void 0,colorMixMode:f.colorMixMode,normalTextureId:v(f.textureNormal)&&$?n.get(f.textureNormal).id:void 0,textureAlphaPremultiplied:v(R)&&!!R.params.preMultiplyAlpha,occlusionTextureId:v(f.textureOcclusion)&&$?n.get(f.textureOcclusion).id:void 0,emissiveTextureId:v(f.textureEmissive)&&$?n.get(f.textureEmissive).id:void 0,metallicRoughnessTextureId:v(f.textureMetallicRoughness)&&$?n.get(f.textureMetallicRoughness).id:void 0,emissiveFactor:[T,x,I],mrrFactors:[f.metallicFactor,f.roughnessFactor,e.mrrFactors[2]],isSchematic:!1,colorTextureTransformMatrix:pe(f.colorTextureTransform),normalTextureTransformMatrix:pe(f.normalTextureTransform),occlusionTextureTransformMatrix:pe(f.occlusionTextureTransform),emissiveTextureTransformMatrix:pe(f.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:pe(f.metallicRoughnessTextureTransform),...t}))}if(E.stageResources.materials.push(a.get(S)),$){const M=y=>{v(y)&&E.stageResources.textures.push(n.get(y))};M(f.textureColor),M(f.textureNormal),M(f.textureOcclusion),M(f.textureEmissive),M(f.textureMetallicRoughness)}})}),{engineResources:o,referenceBoundingBox:l}}function Ui(s){const e=ki(s.indices||s.attributes.position.count,s.primitiveType),t=s.attributes.position.count,r=re(fe,t);jt(r,s.attributes.position,s.transform);const i=[[O.POSITION,{data:r.typedBuffer,size:r.elementCount,exclusive:!0}]],o=[[O.POSITION,e]];if(v(s.attributes.normal)){const a=re(fe,t);ke(Ae,s.transform),Gt(a,s.attributes.normal,Ae),i.push([O.NORMAL,{data:a.typedBuffer,size:a.elementCount,exclusive:!0}]),o.push([O.NORMAL,e])}if(v(s.attributes.tangent)){const a=re(we,t);ke(Ae,s.transform),Yt(a,s.attributes.tangent,Ae),i.push([O.TANGENT,{data:a.typedBuffer,size:a.elementCount,exclusive:!0}]),o.push([O.TANGENT,e])}if(v(s.attributes.texCoord0)){const a=re(ct,t);Xt(a,s.attributes.texCoord0),i.push([O.UV0,{data:a.typedBuffer,size:a.elementCount,exclusive:!0}]),o.push([O.UV0,e])}if(v(s.attributes.color)){const a=re(ce,t);if(s.attributes.color.elementCount===4)s.attributes.color instanceof we?Je(a,s.attributes.color,255):s.attributes.color instanceof ce?Jt(a,s.attributes.color):s.attributes.color instanceof kt&&Je(a,s.attributes.color,1/256);else{Zt(a,255,255,255,255);const n=new Qe(a.buffer,0,4);s.attributes.color instanceof fe?Ye(n,s.attributes.color,255):s.attributes.color instanceof Qe?Ht(n,s.attributes.color):s.attributes.color instanceof Ft&&Ye(n,s.attributes.color,1/256)}i.push([O.COLOR,{data:a.typedBuffer,size:a.elementCount,exclusive:!0}]),o.push([O.COLOR,e])}return{geometry:new Ue(i,o),vertexCount:t}}const Ae=De();function qi(s){switch(s){case"BLEND":return q.Blend;case"MASK":return q.Mask;case"OPAQUE":case null:case void 0:return q.Opaque}}function ki(s,e){switch(e){case Le.TRIANGLES:return ss(s);case Le.TRIANGLE_STRIP:return ts(s);case Le.TRIANGLE_FAN:return es(s)}}function Fi(s,e){for(let t=0;t<s.model.lods.length;++t){const r=s.model.lods[t];for(const i of r.parts){const o=i.attributes.normal;if(de(o))return;const a=i.attributes.position,n=a.count,u=L(),l=L(),h=L(),c=re(ce,n),b=re(fe,n),_=nt(me(),i.transform);for(let A=0;A<n;A++){a.getVec(A,l),o.getVec(A,u),He(l,l,i.transform),ae(h,l,e.center),We(h,h,e.radius);const E=h[2],p=Ve(h),S=Math.min(.45+.55*p*p,1);We(h,h,e.radius),_!==null&&He(h,h,_),ut(h,h),t+1!==s.model.lods.length&&s.model.lods.length>1&&Ne(h,h,u,E>-1?.2:Math.min(-4*E-3.8,1)),b.setVec(A,h),c.set(A,0,255*S),c.set(A,1,255*S),c.set(A,2,255*S),c.set(A,3,255)}i.attributes.normal=b,i.attributes.color=c}}}const go=Object.freeze(Object.defineProperty({__proto__:null,fetch:Vi,gltfToEngineResources:Lt,parseUrl:It},Symbol.toStringTag,{value:"Module"}));export{ui as A,si as B,St as C,pe as D,he as E,fo as F,yi as G,Gr as H,Li as I,no as J,lo as K,eo as L,At as M,li as N,so as O,uo as P,go as Q,hi as S,Zr as V,Vi as Y,ci as _,Ws as a,ti as b,ot as c,Ue as d,ei as e,ri as f,ai as g,ks as h,io as i,to as j,pi as k,di as l,gi as m,mi as n,Fs as o,ho as p,ao as q,ro as r,oo as s,qs as t,Kr as u,Hr as v,fi as w,oi as x,Js as y,Hs as z};
