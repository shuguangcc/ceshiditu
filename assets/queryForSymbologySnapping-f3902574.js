import"./geometry-5a216427.js";import{t as y,r as x}from"./typedArrayUtil-a8b5b3e9.js";import{f as D}from"./promiseUtils-6684e352.js";import{v as F}from"./dehydratedFeatures-4eeb381a.js";import{a as C}from"./elevationInfoUtils-427916a5.js";import{ar as G,D as q,F as z,aF as O,aG as k}from"./index-455b69b8.js";import{k as E}from"./Extent-69509002.js";import{i as P}from"./arcadeOnDemand-c6d1b9f2.js";async function N(r,p,d,I,s){const{elevationProvider:m,renderCoordsHelper:i,spatialReference:b}=r,{elevationInfo:h}=p,g=q(h,!0),v=await z(g,b,s);D(s);const c=[],f=new Set,u=new Set;for(const{objectId:e,points:n}of I){const t=d(e);if(y(t)){for(const a of n)c.push(a[2]);f.add(e);continue}t.isDraped&&u.add(e);const o=t.graphic.geometry;w.setFromElevationInfo(C(o,h)),w.updateFeatureExpressionInfoContext(v,t.graphic,p),l.spatialReference=r.spatialReference;for(const{x:a,y:R,z:$}of n)l.x=a,l.y=R,l.z=$??0,O(l,m,w,i,S),c.push(S.z)}return{elevations:c,drapedObjectIds:u,failedObjectIds:f}}const w=new G,l=F(0,0,0,E.WGS84),S=new k;async function Q(r,p,d){if(y(r)||p.candidates.length===0)return j;const I=r.graphics3DGraphicsByObjectID??r.graphics3DGraphics,s=[],m=[],{renderer:i}=r,b=x(i)&&"arcadeRequired"in i&&i.arcadeRequired?P():null,h=async(e,{graphic:n,graphics3DSymbol:t})=>{const o=await b,a=await r.getRenderingInfoAsync(n,i,o,{signal:d});return y(a)?[]:t.queryForSnapping(e,v,a,d)},{candidates:g,spatialReference:v}=p;for(let e=0;e<g.length;++e){const n=g[e],{objectId:t}=n,o=typeof t=="number"?I.get(t):void 0;if(y(o))continue;const{graphics3DSymbol:a}=o;a.symbologySnappingSupported&&(s.push(h(n,o)),m.push(e))}if(s.length===0)return j;const c=await Promise.all(s);D(d);const f=[],u=[];for(let e=0;e<c.length;++e){const n=c[e],t=m[e];for(const o of n)f.push(o),u.push(t)}return{candidates:f,sourceCandidateIndices:u}}const j={candidates:[],sourceCandidateIndices:[]};export{Q as a,N as m};
