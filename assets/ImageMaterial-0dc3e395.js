import{h as i}from"./Matrix3PassUniform-da8eddae.js";import{n as m}from"./basicInterfaces-19ed850e.js";import{A as P,l as g,i as T,k as A,m as O,n as E,w as y,S,E as u,h as v}from"./objectResourceUtils-ef6e3cdf.js";import{E as w,d as $,x as N,j as R}from"./VisualVariablePassParameters-5807c7dc.js";import{ai as x,aj as D}from"./index-455b69b8.js";import{_ as b}from"./preload-helper-41c905a7.js";import{e as s}from"./cast-7928d7aa.js";import"./ShaderBuilder-93e8045e.js";import{s as I,t as C,e as M,o as L,W as F,h as U,a as W,_ as G}from"./EvaluateSceneLighting.glsl-3bbc6edf.js";import{e as a}from"./ShaderTechniqueConfiguration-9f5b4555.js";import{o as p}from"./TransparencyPassType-cd195b0e.js";import{s as H}from"./DefaultTechniqueConfiguration-e8962072.js";import{w as B}from"./ImageMaterial.glsl-2969e37d.js";import{R as d}from"./enums-64ab819c.js";class l extends M{initializeProgram(t){return new L(t.rctx,l.shader.get().build(this.configuration),w)}_setPipelineState(t,e){const o=this.configuration,n=t===p.NONE,h=t===p.FrontFace;return F({blending:o.output!==i.Color&&o.output!==i.Alpha||!o.transparent?null:n?j:P(t),culling:U(o.cullFace),depthTest:{func:g(t)},depthWrite:n?o.writeDepth&&W:T(t),colorWrite:G,stencilWrite:o.hasOccludees?A:null,stencilTest:o.hasOccludees?e?O:E:null,polygonOffset:n||h?null:y(o.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,e){return e?this._occludeePipelineState:super.getPipelineState(t,e)}}l.shader=new C(B,()=>b(()=>import("./ImageMaterial.glsl-4b384680.js"),["./ImageMaterial.glsl-4b384680.js","./vec2f64-30dc1443.js","./Matrix3PassUniform-da8eddae.js","./ShaderBuilder-93e8045e.js","./typedArrayUtil-a8b5b3e9.js","./Error-653283ae.js","./string-cdf077e6.js","./mat4-44a0988f.js","./vec3f64-2f9cef06.js","./common-c186b691.js","./mat4f64-1e28eae0.js","./vec3-a020a6f6.js","./mat3f64-c6305894.js","./vec3f32-c9aa289f.js","./VertexAttribute-9c5c630d.js","./vec2-2cef68de.js","./Texture2DPassUniform-6e8ae673.js","./View.glsl-8b12b8c2.js","./mat4f32-77b3d8ac.js","./TransparencyPassType-cd195b0e.js","./ImageMaterial.glsl-2969e37d.js","./Slice.glsl-a612de15.js","./Transform.glsl-f15542a7.js","./ForwardLinearDepth.glsl-36f9eb3b.js","./MultipassTerrainTest.glsl-e79d40de.js","./ReadLinearDepth.glsl-7ff30f7d.js","./RgbaFloatEncoding.glsl-6036ca34.js","./AlphaCutoff-96178e0d.js","./FloatPassUniform-d2dfc562.js"],import.meta.url));const j=I(d.ONE,d.ONE_MINUS_SRC_ALPHA);class r extends H{constructor(){super(...arguments),this.output=i.Color,this.cullFace=m.None,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=p.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}s([a({count:i.COUNT})],r.prototype,"output",void 0),s([a({count:m.COUNT})],r.prototype,"cullFace",void 0),s([a()],r.prototype,"hasSlicePlane",void 0),s([a()],r.prototype,"transparent",void 0),s([a()],r.prototype,"enableOffset",void 0),s([a()],r.prototype,"writeDepth",void 0),s([a()],r.prototype,"hasOccludees",void 0),s([a({count:p.COUNT})],r.prototype,"transparencyPassType",void 0),s([a()],r.prototype,"hasMultipassTerrain",void 0),s([a()],r.prototype,"cullAboveGround",void 0);class ot extends ${constructor(t){super(t,new z),this.supportsEdges=!0,this._configuration=new r}getConfiguration(t,e){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=e.transparencyPassType,this._configuration.enableOffset=e.camera.relativeElevation<S,this._configuration.hasMultipassTerrain=e.multipassTerrain.enabled,this._configuration.cullAboveGround=e.multipassTerrain.cullAboveGround,this._configuration}intersect(t,e,o,n,h,f,_){N(t,e,n,h,f,void 0,_)}requiresSlot(t,e){return e===i.Color||e===i.Alpha||e===i.Highlight?t===u.DRAPED_MATERIAL?!0:e===i.Highlight?t===u.OPAQUE_MATERIAL:t===(this.parameters.transparent?this.parameters.writeDepth?u.TRANSPARENT_MATERIAL:u.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:u.OPAQUE_MATERIAL):!1}createGLMaterial(t){return new q(t)}createBufferWriter(){return new x(D)}}class q extends v{constructor(t){super({...t,...t.material.parameters})}_updateParameters(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(l,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&(this._material.setParameters({hasOccludees:t.hasOccludees}),this._updateParameters(t))}beginSlot(t){return this._output!==i.Color&&this._output!==i.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class z extends R{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=m.None,this.hasOccludees=!1,this.opacity=1,this.textureId=null,this.initTextureTransparent=!0}}export{ot as p};
