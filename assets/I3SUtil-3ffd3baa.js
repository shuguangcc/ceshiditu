import{U as Tt}from"./request-d3e98716.js";import{r as N,t as re,G as Et,I as Pt,M as qt,U as Nt}from"./typedArrayUtil-a8b5b3e9.js";import{a as P}from"./Error-653283ae.js";import{h as vt}from"./string-cdf077e6.js";import{E as jt}from"./promiseUtils-6684e352.js";import{p as it}from"./mat3-3fc68e72.js";import{e as st}from"./mat3f64-c6305894.js";import{h as Rt}from"./mat4-44a0988f.js";import{e as Ce}from"./mat4f64-1e28eae0.js";import{S as ae,B as Pe,y as At}from"./quat-5b263584.js";import{r as Ft,n as Ot,e as Ct,I as Vt}from"./I3SBinaryReader-3d2c2faa.js";import{e as ct}from"./quatf64-7fd38d64.js";import{E as R,r as W,e as kt,Y as Ut,u as ze,o as A,f as Le,m as _t,J as lt,s as We,g as Te,q as be,l as Dt,c as Gt,O as B}from"./vec3-a020a6f6.js";import{n as U,t as Lt,u as Wt}from"./vec3f64-2f9cef06.js";import{Z as ft,A as Bt,x as oe,j as Be}from"./projection-d7b57a6c.js";import{u as ut,a as ie}from"./unitUtils-47abac71.js";import{k as ht,T as Ke}from"./Extent-69509002.js";import{u as Ve,D as Ye,m as ve,E as Kt}from"./aaBoundingRect-4a760199.js";import{x as Yt}from"./Query-ff8c2cfb.js";import{l as Qt}from"./ViewingMode-5d7d590b.js";import{l as Jt}from"./Color-a42a8267.js";import{u as Qe}from"./screenUtils-410d12c0.js";import{r as ke,e as Ht}from"./vec4f64-e407da96.js";import{n as Zt,r as Je}from"./symbolColorUtils-604c5345.js";import{t as Xt,e as en}from"./vec3f32-c9aa289f.js";import"./vec4-790471c0.js";import{a as tn}from"./aaBoundingBox-fc742a4e.js";import{R as Ue,Y as _e}from"./plane-45609588.js";var Ee;(function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.TRANSPARENT=1]="TRANSPARENT",e[e.OPAQUE=2]="OPAQUE"})(Ee||(Ee={}));function nn(e){return e.type==="fill"}function rn(e){return e.type==="extrude"}function Ir(e){return e&&e.enabled&&(rn(e)||nn(e))&&N(e.edges)}function an(e){return e&&e.enabled&&e.edges||null}function zr(e,t){return mt(an(e),t)}function mt(e,t){if(re(e))return null;const n=N(e.color)?Ht(Jt.toUnitRGBA(e.color)):ke(0,0,0,0),r=Qe(e.size),a=Qe(e.extensionLength);switch(e.type){case"solid":return pt({color:n,size:r,extensionLength:a,...t});case"sketch":return on({color:n,size:r,extensionLength:a,...t});default:return}}function pt(e){return{...sn,...e,type:"solid"}}function on(e){return{...cn,...e,type:"sketch"}}const sn={color:ke(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Ee.OPAQUE,hasSlicePlane:!1},cn={color:ke(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Ee.OPAQUE,hasSlicePlane:!1};function ln(e,t,n,r){const a=fn(e,t,n),o=Ce();return ft(n,a,o,r),o}const dt=1,He=5-dt;function fn(e,t,n){const r=U(),a=e[3],o=2**(Math.ceil(Math.log(a)*Math.LOG2E/He)*He+dt);if(n.isGeographic){const i=o/ut(n).radius*180/Math.PI,l=Math.round(e[1]/i),u=Math.max(-90,Math.min(90,l*i)),m=i/Math.cos((Math.abs(u)-i/2)/180*Math.PI),d=Math.round(e[0]/m)*m;r[0]=d,r[1]=u}else{const i=Math.round(e[0]/o),l=Math.round(e[1]/o);r[0]=i*o,r[1]=l*o}const s=e[2]+t,c=Math.round(s/o);return r[2]=c*o,r}const se=1e-6,ce=[0,0,0],ye=[0,0,0];function un(e,t){const{data:n,size:r}=e,a=n.length/r;if(a<=0)return;const o=new Mn(e);xe(ce,o.minProj,o.maxProj),D(ce,ce,.5),T(ye,o.maxProj,o.minProj);const s=Re(ye),c=new gn;c.quality=s,a<14&&(e={data:new Float64Array(o.buffer,112,42),size:3});const i=[0,0,0],l=[0,0,0],u=[0,0,0],m=[0,0,0],d=[0,0,0],h=[0,0,0],p=[0,0,0];switch(hn(o,e,p,i,l,u,m,d,h,c)){case 1:return void tt(ce,ye,t);case 2:return void $n(e,m,t)}mn(e,p,i,l,u,m,d,h,c),bt(e,c.b0,c.b1,c.b2,te,ne);const y=[0,0,0];T(y,ne,te),c.quality=Re(y),c.quality<s?yt(c.b0,c.b1,c.b2,te,ne,y,t):tt(ce,ye,t)}function hn(e,t,n,r,a,o,s,c,i,l){return pn(e,r,a),Ae(r,a)<se?1:(T(s,r,a),S(s,s),dn(t,r,s,o)<se?2:(T(c,a,o),S(c,c),T(i,o,r),S(i,i),E(n,c,s),S(n,n),_(t,n,s,c,i,l),0))}const le=[0,0,0],fe=[0,0,0],w=[0,0,0],x=[0,0,0],I=[0,0,0],F=[0,0,0],O=[0,0,0],C=[0,0,0];function mn(e,t,n,r,a,o,s,c,i){bn(e,t,n,le,fe),le[0]!==void 0&&(T(w,le,n),S(w,w),T(x,le,r),S(x,x),T(I,le,a),S(I,I),E(F,x,o),S(F,F),E(O,I,s),S(O,O),E(C,w,c),S(C,C),_(e,F,o,x,w,i),_(e,O,s,I,x,i),_(e,C,c,w,I,i)),fe[0]!==void 0&&(T(w,fe,n),S(w,w),T(x,fe,r),S(x,x),T(I,fe,a),S(I,I),E(F,x,o),S(F,F),E(O,I,s),S(O,O),E(C,w,c),S(C,C),_(e,F,o,x,w,i),_(e,O,s,I,x,i),_(e,C,c,w,I,i))}function pn(e,t,n){let r=Ae(e.maxVert[0],e.minVert[0]),a=0;for(let o=1;o<7;++o){const s=Ae(e.maxVert[o],e.minVert[o]);s>r&&(r=s,a=o)}$(t,e.minVert[a]),$(n,e.maxVert[a])}const z=[0,0,0];function dn(e,t,n,r){const{data:a,size:o}=e;let s=Number.NEGATIVE_INFINITY,c=0;for(let i=0;i<a.length;i+=o){z[0]=a[i]-t[0],z[1]=a[i+1]-t[1],z[2]=a[i+2]-t[2];const l=n[0]*z[0]+n[1]*z[1]+n[2]*z[2],u=n[0]*n[0]+n[1]*n[1]+n[2]*n[2],m=z[0]*z[0]+z[1]*z[1]+z[2]*z[2]-l*l/u;m>s&&(s=m,c=i)}return $(r,a,c),s}const b=[0,0];function bn(e,t,n,r,a){Sn(e,t,b,a,r);const o=$t(n,t);b[1]-se<=o&&(r[0]=void 0),b[0]+se>=o&&(a[0]=void 0)}const Ze=[0,0,0],Xe=[0,0,0],et=[0,0,0],K=[0,0,0],Y=[0,0,0],Se=[0,0,0];function _(e,t,n,r,a,o){if(St(t)<se)return;E(Ze,n,t),E(Xe,r,t),E(et,a,t),ee(e,t,b),Y[1]=b[0],K[1]=b[1],Se[1]=K[1]-Y[1];const s=[n,r,a],c=[Ze,Xe,et];for(let i=0;i<3;++i){ee(e,s[i],b),Y[0]=b[0],K[0]=b[1],ee(e,c[i],b),Y[2]=b[0],K[2]=b[1],Se[0]=K[0]-Y[0],Se[2]=K[2]-Y[2];const l=Re(Se);l<o.quality&&($(o.b0,s[i]),$(o.b1,t),$(o.b2,c[i]),o.quality=l)}}const yn=[0,0,0];function ee(e,t,n){const{data:r,size:a}=e;n[0]=Number.POSITIVE_INFINITY,n[1]=Number.NEGATIVE_INFINITY;for(let o=0;o<r.length;o+=a){const s=r[o]*t[0]+r[o+1]*t[1]+r[o+2]*t[2];n[0]=Math.min(n[0],s),n[1]=Math.max(n[1],s)}}function Sn(e,t,n,r,a){const{data:o,size:s}=e;$(r,o),$(a,r),n[0]=$t(yn,t),n[1]=n[0];for(let c=s;c<o.length;c+=s){const i=o[c]*t[0]+o[c+1]*t[1]+o[c+2]*t[2];i<n[0]&&(n[0]=i,$(r,o,c)),i>n[1]&&(n[1]=i,$(a,o,c))}}function tt(e,t,n){$(n.center,e),D(n.halfSize,t,.5),n.quaternion[0]=0,n.quaternion[1]=0,n.quaternion[2]=0,n.quaternion[3]=1}const v=[0,0,0],Q=[0,0,0],ue=[0,0,0],te=[0,0,0],ne=[0,0,0],nt=[0,0,0];function $n(e,t,n){$(v,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?v[0]=0:Math.abs(t[1])>Math.abs(t[2])?v[1]=0:v[2]=0,St(v)<se&&(v[0]=v[1]=v[2]=1),E(Q,t,v),S(Q,Q),E(ue,t,Q),S(ue,ue),bt(e,t,Q,ue,te,ne),T(nt,ne,te),yt(t,Q,ue,te,ne,nt,n)}function bt(e,t,n,r,a,o){ee(e,t,b),a[0]=b[0],o[0]=b[1],ee(e,n,b),a[1]=b[0],o[1]=b[1],ee(e,r,b),a[2]=b[0],o[2]=b[1]}const $e=[0,0,0],q=[1,0,0,0,1,0,0,0,1],J=[0,0,0];function yt(e,t,n,r,a,o,s){q[0]=e[0],q[1]=e[1],q[2]=e[2],q[3]=t[0],q[4]=t[1],q[5]=t[2],q[6]=n[0],q[7]=n[1],q[8]=n[2],wn(s.quaternion,q),xe(J,r,a),D(J,J,.5),D(s.center,e,J[0]),D($e,t,J[1]),xe(s.center,s.center,$e),D($e,n,J[2]),xe(s.center,s.center,$e),D(s.halfSize,o,.5)}const M=7;let Mn=class{constructor(t){this.minVert=new Array(M),this.maxVert=new Array(M);const n=64*M;this.buffer=new ArrayBuffer(n);let r=0;this.minProj=new Float64Array(this.buffer,r,M),r+=8*M,this.maxProj=new Float64Array(this.buffer,r,M),r+=8*M;for(let i=0;i<M;++i)this.minVert[i]=new Float64Array(this.buffer,r,3),r+=24;for(let i=0;i<M;++i)this.maxVert[i]=new Float64Array(this.buffer,r,3),r+=24;for(let i=0;i<M;++i)this.minProj[i]=Number.POSITIVE_INFINITY,this.maxProj[i]=Number.NEGATIVE_INFINITY;const a=new Array(M),o=new Array(M),{data:s,size:c}=t;for(let i=0;i<s.length;i+=c){let l=s[i];l<this.minProj[0]&&(this.minProj[0]=l,a[0]=i),l>this.maxProj[0]&&(this.maxProj[0]=l,o[0]=i),l=s[i+1],l<this.minProj[1]&&(this.minProj[1]=l,a[1]=i),l>this.maxProj[1]&&(this.maxProj[1]=l,o[1]=i),l=s[i+2],l<this.minProj[2]&&(this.minProj[2]=l,a[2]=i),l>this.maxProj[2]&&(this.maxProj[2]=l,o[2]=i),l=s[i]+s[i+1]+s[i+2],l<this.minProj[3]&&(this.minProj[3]=l,a[3]=i),l>this.maxProj[3]&&(this.maxProj[3]=l,o[3]=i),l=s[i]+s[i+1]-s[i+2],l<this.minProj[4]&&(this.minProj[4]=l,a[4]=i),l>this.maxProj[4]&&(this.maxProj[4]=l,o[4]=i),l=s[i]-s[i+1]+s[i+2],l<this.minProj[5]&&(this.minProj[5]=l,a[5]=i),l>this.maxProj[5]&&(this.maxProj[5]=l,o[5]=i),l=s[i]-s[i+1]-s[i+2],l<this.minProj[6]&&(this.minProj[6]=l,a[6]=i),l>this.maxProj[6]&&(this.maxProj[6]=l,o[6]=i)}for(let i=0;i<M;++i){let l=a[i];$(this.minVert[i],s,l),l=o[i],$(this.maxVert[i],s,l)}}},gn=class{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}};function Re(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}function xe(e,t,n){e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2]}function T(e,t,n){e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2]}function D(e,t,n){e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n}function $(e,t,n=0){e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2]}function E(e,t,n){const r=t[0],a=t[1],o=t[2],s=n[0],c=n[1],i=n[2];e[0]=a*i-o*c,e[1]=o*s-r*i,e[2]=r*c-a*s}function S(e,t){const n=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(n>0){const r=1/Math.sqrt(n);e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r}}function St(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function Ae(e,t){const n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2];return n*n+r*r+a*a}function $t(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function wn(e,t){const n=t[0]+t[4]+t[8];if(n>0){let r=Math.sqrt(n+1);e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r}else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);const a=(r+1)%3,o=(r+2)%3;let s=Math.sqrt(t[3*r+r]-t[3*a+a]-t[3*o+o]+1);e[r]=.5*s,s=.5/s,e[3]=(t[3*a+o]-t[3*o+a])*s,e[a]=(t[3*a+r]+t[3*r+a])*s,e[o]=(t[3*o+r]+t[3*r+o])*s}}const me=ct(),G=U(),xn=U(),In=st();class Pr{constructor(t){const s=t*56;this.buffer=new ArrayBuffer(s),this.obbs=new Array(t);for(let c=0;c<t;c++)this.obbs[c]={center:Wt(this.buffer,56*c+0),halfSize:en(this.buffer,56*c+24),quaternion:Ot(this.buffer,56*c+36)}}}function De(e=[0,0,0],t=[-1,-1,-1],n=[0,0,0,1]){return{center:Lt(e),halfSize:Xt(t),quaternion:Ft(n)}}function qr(e){return De(e.center,e.halfSize,e.quaternion)}function Nr(e,t){W(t.center,e.center),W(t.halfSize,e.halfSize),Pe(t.quaternion,e.quaternion)}function Mt(e,t){return t=t||De(),un(e,t),t}function H(e,t){const n=Ue(t,e.center),r=Ge(e,_e(t));return n>r?1:n<-r?-1:0}function vr(e,t){t||(t=tn());const n=it(In,e.quaternion),r=e.halfSize[0]*Math.abs(n[0])+e.halfSize[1]*Math.abs(n[3])+e.halfSize[2]*Math.abs(n[6]),a=e.halfSize[0]*Math.abs(n[1])+e.halfSize[1]*Math.abs(n[4])+e.halfSize[2]*Math.abs(n[7]),o=e.halfSize[0]*Math.abs(n[2])+e.halfSize[1]*Math.abs(n[5])+e.halfSize[2]*Math.abs(n[8]);return t[0]=e.center[0]-r,t[1]=e.center[1]-a,t[2]=e.center[2]-o,t[3]=e.center[0]+r,t[4]=e.center[1]+a,t[5]=e.center[2]+o,t}function jr(e,t){return Ue(t,e.center)-Ge(e,_e(t))}function Rr(e,t){return Ue(t,e.center)+Ge(e,_e(t))}function Ar(e,t){return H(e,t[0])<=0&&H(e,t[1])<=0&&H(e,t[2])<=0&&H(e,t[3])<=0&&H(e,t[4])<=0&&H(e,t[5])<=0}function Fr(e,t,n,r=0){ae(me,e.quaternion),kt(G,t,e.center);const a=R(G,G,me),o=R(xn,n,me);let s=-1/0,c=1/0;for(let i=0;i<3;i++)if(Math.abs(o[i])>1e-6){const l=(r+e.halfSize[i]-a[i])/o[i],u=(-r-e.halfSize[i]-a[i])/o[i];s=Math.max(s,Math.min(l,u)),c=Math.min(c,Math.max(l,u))}else if(a[i]>e.halfSize[i]+r||a[i]<-e.halfSize[i]-r)return!1;return s<=c}(()=>{const e=new Int8Array(162);let t=0;const n=r=>{for(let a=0;a<r.length;a++)e[t+a]=r[a];t+=6};return n([6,2,3,1,5,4]),n([0,2,3,1,5,4]),n([0,2,3,7,5,4]),n([0,1,3,2,6,4]),n([0,1,3,2,0,0]),n([0,1,5,7,3,2]),n([0,1,3,7,6,4]),n([0,1,3,7,6,2]),n([0,1,5,7,6,2]),n([0,1,5,4,6,2]),n([0,1,5,4,0,0]),n([0,1,3,7,5,4]),n([0,2,6,4,0,0]),n([0,0,0,0,0,0]),n([1,3,7,5,0,0]),n([2,3,7,6,4,0]),n([2,3,7,6,0,0]),n([2,3,1,5,7,6]),n([0,1,5,7,6,2]),n([0,1,5,7,6,4]),n([0,1,3,7,6,4]),n([4,5,7,6,2,0]),n([4,5,7,6,0,0]),n([4,5,1,3,7,6]),n([0,2,3,7,5,4]),n([6,2,3,7,5,4]),n([6,2,3,1,5,4]),e})();function Ge(e,t){ae(me,e.quaternion),R(G,t,me);const n=e.halfSize;return Math.abs(G[0]*n[0])+Math.abs(G[1]*n[1])+Math.abs(G[2]*n[2])}function gt(e,t){for(let n=0;n<8;++n){const r=t[n];r[0]=1&n?-e.halfSize[0]:e.halfSize[0],r[1]=2&n?-e.halfSize[1]:e.halfSize[1],r[2]=4&n?-e.halfSize[2]:e.halfSize[2],R(r,r,e.quaternion),ze(r,r,e.center)}}function Or(e){return Ut(e.halfSize)}function wt(e){return e&&parseInt(e.substring(e.lastIndexOf("/")+1,e.length),10)}function Cr(e){var t;if(vt("disable-feature:i3s-draco")||!e)return!1;for(const n of e)for(const r of n.geometryBuffers)if(((t=r.compressedAttributes)==null?void 0:t.encoding)==="draco")return!0;return!1}function Vr(e,t,n,r){n.traverse(t,a=>{const o=a.mbs;return zn(e,o)!==L.OUTSIDE&&(r(a),!0)})}function kr(e,t,n){let r=0,a=0;for(let o=0;o<t.length&&r<e.length;o++)e[r]===t[o]&&(n(o)&&(e[a]=e[r],a++),r++);e.length=a}function Ur(e,t,n){let r=0,a=0;for(;r<n.length;)qt(e,n[r])>=0===t&&(n[a]=n[r],a++),r++;n.length=a}const he=Ve();function _r(e,t){if(t.rotationScale[1]===0&&t.rotationScale[2]===0&&t.rotationScale[3]===0&&t.rotationScale[5]===0&&t.rotationScale[6]===0&&t.rotationScale[7]===0)return he[0]=(e[0]-t.position[0])/t.rotationScale[0],he[1]=(e[1]-t.position[1])/t.rotationScale[4],he[2]=(e[2]-t.position[0])/t.rotationScale[0],he[3]=(e[3]-t.position[1])/t.rotationScale[4],he}var L;function zn(e,t){const n=t[0],r=t[1],a=t[3],o=e[0]-n,s=n-e[2],c=e[1]-r,i=r-e[3],l=Math.max(o,s,0),u=Math.max(c,i,0),m=l*l+u*u;return m>a*a?L.OUTSIDE:m>0?L.INTERSECTS_CENTER_OUTSIDE:-Math.max(o,s,c,i)>a?L.INSIDE:L.INTERSECTS_CENTER_INSIDE}function Tn(e,t,n){const r=[],a=n&&n.missingFields,o=n&&n.originalFields;for(const s of e){const c=s.toLowerCase();let i=!1;for(const l of t)if(c===l.name.toLowerCase()){r.push(l.name),i=!0,o&&o.push(s);break}!i&&a&&a.push(s)}return r}async function Dr(e,t,n,r,a){if(t.length===0)return[];const o=e.attributeStorageInfo;if(N(e.associatedLayer))try{return await Pn(e.associatedLayer,t,n,r)}catch(s){if(e.associatedLayer.loaded)throw s}if(o){const s=En(t,n,a);if(re(s))throw new P("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const c=e.parsedUrl.path;return(await Promise.all(s.map(i=>qn(c,o,i.node,i.indices,r).then(l=>{for(let u=0;u<i.graphics.length;u++){const m=i.graphics[u],d=l[u];if(m.attributes)for(const h in m.attributes)h in d||(d[h]=m.attributes[h]);m.attributes=d}return i.graphics})))).flat()}throw new P("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available")}function En(e,t,n){const r=new Map,a=[],o=n();for(const s of e){const c=s.attributes[t];for(let i=0;i<o.length;i++){const l=o[i],u=l.featureIds.indexOf(c);if(u>=0){let m=r.get(l.node);m||(m={node:l.node,indices:[],graphics:[]},a.push(m),r.set(l.node,m)),m.indices.push(u),m.graphics.push(s);for(let d=i;d>0;d--)o[d]=o[d-1];o[0]=l;break}}}return a}async function Pn(e,t,n,r){t.sort((i,l)=>i.attributes[n]-l.attributes[n]);const a=t.map(i=>i.attributes[n]),o=[],s=Tn(r,e.fields,{originalFields:o}),c=await xt(e,a,s);for(let i=0;i<t.length;i++){const l=t[i],u=c[i],m={};if(l.attributes)for(const d in l.attributes)m[d]=l.attributes[d];for(let d=0;d<o.length;d++)m[o[d]]=u[s[d]];l.attributes=m}return t}function xt(e,t,n){const r=e.capabilities.query.maxRecordCount;if(r!=null&&t.length>r){const o=Nt(t,r);return Promise.all(o.map(s=>xt(e,s,n))).then(s=>s.flat())}const a=new Yt({objectIds:t,outFields:n,orderByFields:[e.objectIdField]});return e.queryFeatures(a).then(o=>{if(o&&o.features&&o.features.length===t.length)return o.features.map(s=>s.attributes);throw new P("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer")})}function qn(e,t,n,r,a){return Nn(e,t,n.resources.attributes,r,a)}function Nn(e,t,n,r,a){const o=[];for(const s of t)if(s&&a.includes(s.name)){const c=`${e}/nodes/${n}/attributes/${s.key}/0`;o.push({url:c,storageInfo:s})}return jt(o.map(s=>Tt(s.url,{responseType:"array-buffer"}).then(c=>Vt(s.storageInfo,c.data)))).then(s=>{const c=[];for(const i of r){const l={};for(let u=0;u<s.length;u++)s[u].value!=null&&(l[o[u].storageInfo.name]=Rn(s[u].value,i));c.push(l)}return c})}(function(e){e[e.OUTSIDE=0]="OUTSIDE",e[e.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE",e[e.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE",e[e.INSIDE=3]="INSIDE"})(L||(L={}));const vn=-32768,jn=-(2**31);function Rn(e,t){if(!e)return null;const n=e[t];return Et(e)?n===vn?null:n:Pt(e)?n===jn?null:n:n!=n?null:n}function An(e){const t=e.store.indexCRS||e.store.geographicCRS,n=t===void 0?e.store.indexWKT:void 0;if(n){if(!e.spatialReference)throw new P("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indeWKT in the scene layer store but no layer spatial reference",{});if(n!==e.spatialReference.wkt)throw new P("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const r=t?new ht(wt(t)):e.spatialReference;return r.equals(e.spatialReference)?e.spatialReference:r}function Fn(e){const t=e.store.vertexCRS||e.store.projectedCRS,n=t===void 0?e.store.vertexWKT:void 0;if(n){if(!e.spatialReference)throw new P("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});if(n!==e.spatialReference.wkt)throw new P("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const r=t?new ht(wt(t)):e.spatialReference;return r.equals(e.spatialReference)?e.spatialReference:r}function Gr(e,t){return re(t)?"@null":t===ie(t)?"@ECEF":e.equals(t)?"":t.wkid!=null?"@"+t.wkid:null}function Fe(e,t,n){if(!Bt(e,t))throw new P("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if(n==="local"&&!On(e,t))throw new P("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{})}function On(e,t){return e.equals(t)||e.isWGS84&&t.isWebMercator||e.isWebMercator&&t.isWGS84}function Cn(e,t,n){const r=An(e),a=Fn(e);Fe(r,t,n),Fe(a,t,n)}function Vn(e){return(e.geometryType==null||e.geometryType==="triangles")&&(e.topology==null||e.topology==="PerAttributeArray")&&e.vertexAttributes!=null&&e.vertexAttributes.position!=null}function Lr(e){if(e.store==null||e.store.defaultGeometrySchema==null||!Vn(e.store.defaultGeometrySchema))throw new P("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:e.parsedUrl.path})}function Wr(e,t){Cn(e,t.spatialReference,t.viewingMode)}function kn(e){return e.geometryType!=null&&e.geometryType==="points"&&(e.topology==null||e.topology==="PerAttributeArray")&&(e.encoding==null||e.encoding===""||e.encoding==="lepcc-xyz")&&e.vertexAttributes!=null&&e.vertexAttributes.position!=null}function Br(e){if(e.store==null||e.store.defaultGeometrySchema==null||!kn(e.store.defaultGeometrySchema))throw new P("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})}function Kr(e,t){Fe(e.spatialReference,t.spatialReference,t.viewingMode)}function Un(e){return e.type==="simple"||e.type==="class-breaks"||e.type==="unique-value"}function _n(e){return e.type==="mesh-3d"}function Yr(e){if(e==null||!Un(e)||(e.type==="unique-value"||e.type==="class-breaks")&&e.defaultSymbol==null)return!0;const t=e.getSymbols();if(t.length===0)return!0;for(const n of t){if(!_n(n)||n.symbolLayers.length===0)return!0;for(const r of n.symbolLayers.items)if(r.type!=="fill"||re(r.material)||re(r.material.color)||r.material.colorMixMode!=="replace")return!0}return!1}const Qr=pt({color:[0,0,0,0],opacity:0});class Dn{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}}function Jr(e){const t=new Dn;let n=!1,r=!1;for(const a of e.symbolLayers.items)if(a.type==="fill"&&a.enabled){const o=a.material,s=a.edges;if(N(o)&&!n){const c=o.color,i=Zt(o.colorMixMode);N(c)?t.material={color:[c.r/255,c.g/255,c.b/255],alpha:c.a,colorMixMode:i}:t.material={color:[1,1,1],alpha:1,colorMixMode:Je.Multiply},t.castShadows=a.castShadows,n=!0}N(s)&&!r&&(t.edgeMaterial=mt(s,{}),r=!0)}return t.material||(t.material={color:[1,1,1],alpha:1,colorMixMode:Je.Multiply}),t}function Hr(e,t){return(0|e)+(0|t)|0}function Gn(e,t,n,r,a=0){r===ie(r)?t.isGeographic?Qn(e,n,t,a):Yn(e,n,t,a):t.isWGS84&&(r.isWebMercator||Ke(r))?Ln(t,e,r,n,a):t.isWebMercator&&Ke(r)?Kn(t,e,r,n,a):e===n?(n.center[2]+=a,oe(n.center,t,0,n.center,r,0,1)):(A(n.center,e.center[0],e.center[1],e.center[2]+a),oe(n.center,t,0,n.center,r,0,1),Pe(n.quaternion,e.quaternion),W(n.halfSize,e.halfSize))}function Zr(e,t,n,r,a){if(Pe(a.quaternion,e.quaternion),r===Qt.Global){ae(Me,e.quaternion),R(V,e.center,Me),Le(Z,V),_t(X,Z,e.halfSize),lt(X,Z,X);const o=We(X);ze(X,Z,e.halfSize);const s=We(X);if(o<n)W(a.center,e.center),A(V,n,n,n),ze(a.halfSize,e.halfSize,V);else{const c=s>0?1+t/s:1,i=o>0?1+n/o:1,l=(i+c)/2,u=(i-c)/2;Te(a.halfSize,Z,u),be(a.halfSize,a.halfSize,e.halfSize,l),Te(a.center,Z,l),be(a.center,a.center,e.halfSize,u),Dt(V,V),Gt(a.center,a.center,V),R(a.center,a.center,a.quaternion)}}else{const o=A(V,0,0,1);be(a.center,e.center,o,(n+t)/2),ae(Me,e.quaternion),R(o,o,Me),Le(o,o),be(a.halfSize,e.halfSize,o,(n-t)/2)}return a}const V=U(),Z=U(),X=U(),Me=ct();function Ln(e,t,n,r,a){W(k,t.center),k[2]+=a;const o=ie(n);oe(k,e,0,k,o,0,1),It(o,t,k,n,r)}const Ie=new Float64Array(24),Wn={data:Ie,size:3},rt=U(),k=U(),Bn=st();function Kn(e,t,n,r,a){W(k,t.center),k[2]+=a,It(e,t,k,n,r)}function It(e,t,n,r,a){const o=it(Bn,t.quaternion);for(let s=0;s<8;++s){for(let c=0;c<3;++c)rt[c]=t.halfSize[c]*(s&1<<c?-1:1);for(let c=0;c<3;++c){let i=n[c];for(let l=0;l<3;++l)i+=rt[l]*o[3*l+c];Ie[3*s+c]=i}}oe(Ie,e,0,Ie,r,0,8),Mt(Wn,a)}function Yn(e,t,n,r){gt(e,Oe),A(t.center,e.center[0],e.center[1],e.center[2]+r),ft(n,t.center,g,ie(n)),A(t.center,g[12],g[13],g[14]);const a=2*Math.sqrt(1+g[0]+g[5]+g[10]);j[0]=(g[6]-g[9])/a,j[1]=(g[8]-g[2])/a,j[2]=(g[1]-g[4])/a,j[3]=.25*a,At(t.quaternion,j,e.quaternion),ae(j,t.quaternion);let o=0,s=0,c=0;for(const i of Oe)i[2]+=r,oe(i,n,0,i,ie(n),0,1),lt(f,i,t.center),R(f,f,j),o=Math.max(o,Math.abs(f[0])),s=Math.max(s,Math.abs(f[1])),c=Math.max(c,Math.abs(f[2]));A(t.halfSize,o,s,c)}function Qn(e,t,n,r){const a=ut(n),o=1+Math.max(0,r)/(a.radius+e.center[2]);A(t.center,e.center[0],e.center[1],e.center[2]+r),oe(t.center,n,0,t.center,ie(n),0,1),Pe(t.quaternion,e.quaternion),ae(j,e.quaternion),A(f,0,0,1),R(f,f,j),A(f,e.halfSize[0]*Math.abs(f[0]),e.halfSize[1]*Math.abs(f[1]),e.halfSize[2]*Math.abs(f[2])),Te(f,f,a.inverseFlattening),ze(t.halfSize,e.halfSize,f),Te(t.halfSize,t.halfSize,o)}function Xr(e,t,n,r,a,o){if(!o||o.length===0||re(t))return null;const s=ln(e.mbs,a,n,t);let c;Rt(we,s);const i=()=>{if(!c)if(c=Oe,Ye(ge),N(e.serviceObb)){Gn(e.serviceObb,n,at,t,a),gt(at,c);for(const h of c)B(h,h,we),ve(ge,h)}else{const h=e.mbs,p=h[3];Be(h,n,f,t),B(f,f,we),f[2]+=a;for(let y=0;y<8;++y){const pe=1&y?p:-p,qe=2&y?p:-p,Ne=4&y?p:-p,de=c[y];W(de,[f[0]+pe,f[1]+qe,f[2]+Ne]),ve(ge,de)}}};let l=1/0,u=-1/0;const m=h=>{if(h.type!=="replace")return;const p=h.geometry;if(!p.hasZ)return;Ye(je);const y=p.spatialReference||r,pe=p.rings.reduce((qe,Ne)=>Ne.reduce((de,zt)=>(Be(zt,y,f,t),B(f,f,we),ve(je,f),Math.min(f[2],de)),qe),1/0);i(),Kt(ge,je)&&(l=Math.min(l,pe),u=Math.max(u,pe))};if(o.forEach(h=>m(h)),l===1/0)return null;const d=(h,p,y)=>{B(f,y,s),h[p+0]=f[0],h[p+1]=f[1],h[p+2]=f[2],p+=24,y[2]=l,B(f,y,s),h[p+0]=f[0],h[p+1]=f[1],h[p+2]=f[2],p+=24,y[2]=u,B(f,y,s),h[p+0]=f[0],h[p+1]=f[1],h[p+2]=f[2]};for(let h=0;h<8;++h)d(ot.data,3*h,c[h]);return Mt(ot)}function ea(e){return N(e)&&e.halfSize[0]>=0}function ta(e){return e[3]>=0}function na(e){N(e)&&(e.halfSize[0]=-1)}function ra(e){N(e)&&(e[3]=-1)}const g=Ce(),j=Ct(),Oe=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],je=Ve(),ge=Ve(),at=De(),f=[0,0,0],ot={data:new Array(72),size:3},we=Ce();export{Ee as A,Ar as B,Vr as C,Jr as D,De as E,qr as F,Nr as G,Pr as H,Br as I,H as J,vr as K,jr as L,Fe as M,Rr as N,Zr as O,Fr as P,Kr as Q,Cn as R,Cr as S,Fn as T,Ge as U,Mt as V,Or as W,Gn as _,Ir as a,Tn as b,Yr as c,Gr as d,ln as e,zr as f,Rn as g,fn as h,L as i,Lr as j,Hr as k,zn as l,Qr as m,ta as n,kr as o,mt as p,Ur as q,ea as r,_r as s,Xr as t,Dr as u,ra as v,An as w,Wr as x,Nn as y,na as z};
