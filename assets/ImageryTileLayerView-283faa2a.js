import{e as a,y as s,n as j}from"./cast-7928d7aa.js";import{g as F}from"./Graphic-b46e2684.js";import{a as w}from"./Error-653283ae.js";import{e as v,t as P,r as I}from"./typedArrayUtil-a8b5b3e9.js";import"./ensureType-cf29afa9.js";import{g as V}from"./OperationalLayer-24e6fa34.js";import{v as T,J as $}from"./rasterProjectionHelper-967d22a7.js";import{s as L}from"./popupUtils-e8f3d062.js";const J=b=>{let t=class extends b{constructor(){super(...arguments),this._rasterFieldPrefix="Raster.",this.layer=null,this.view=null,this.tileInfo=null}get fullExtent(){return this._getfullExtent()}_getfullExtent(){return this.projectFullExtent(this.view.spatialReference)}get hasTilingEffects(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}get datumTransformation(){return T(v(this.layer.fullExtent),this.view.spatialReference,!0)}supportsSpatialReference(r){return!!this.projectFullExtent(r)}projectFullExtent(r){const u=v(this.layer.fullExtent),e=T(u,r,!1);return $(u,r,e)}async fetchPopupFeatures(r,u){const{layer:e}=this;if(!r)throw new w("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:e});const{popupEnabled:y}=e,d=L(e,u);if(!y||P(d))throw new w("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:y,popupTemplate:d});const h=[],{value:o,magdirValue:n}=await e.identify(r,{timeExtent:this.timeExtent});let m="";if(o&&o.length){m=e.type==="imagery-tile"&&e.hasStandardTime()&&o[0]!=null?o.map(c=>e.getStandardTimeValue(c)).join(", "):o.join(", ");const l={ObjectId:0};l["Raster.ServicePixelValue"]=m;const g=e.rasterInfo.attributeTable;if(I(g)){const{fields:c,features:R}=g,E=c.find(({name:i})=>i.toLowerCase()==="value"),f=E?R.find(i=>String(i.attributes[E.name])===m):null;if(f)for(const i in f.attributes)f.attributes.hasOwnProperty(i)&&(l[this._rasterFieldPrefix+i]=f.attributes[i])}const x=e.rasterInfo.dataType;x!=="vector-magdir"&&x!=="vector-uv"||(l["Raster.Magnitude"]=n==null?void 0:n[0],l["Raster.Direction"]=n==null?void 0:n[1]);const p=new F(this.fullExtent.clone(),null,l);p.layer=e,p.sourceLayer=p.layer,h.push(p)}return h}};return a([s()],t.prototype,"layer",void 0),a([s(V)],t.prototype,"timeExtent",void 0),a([s()],t.prototype,"view",void 0),a([s()],t.prototype,"fullExtent",null),a([s()],t.prototype,"tileInfo",void 0),a([s({readOnly:!0})],t.prototype,"hasTilingEffects",null),t=a([j("esri.views.layers.ImageryTileLayerView")],t),t};export{J as f};
