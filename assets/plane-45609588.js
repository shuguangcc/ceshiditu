import{l as D,a as G}from"./mathUtils-2519596a.js";import{r as H}from"./typedArrayUtil-a8b5b3e9.js";import{z as g,P as f,_ as d,o as y,s as L,g as M,u as X,A as j,e as $,r as J,F as z}from"./vec3-a020a6f6.js";import{n as s}from"./vec3f64-2f9cef06.js";import{c as A,r as K,f as O}from"./sphere-4f5e644f.js";function ar(r){const n=r[0]*r[0]+r[4]*r[4]+r[8]*r[8],t=r[1]*r[1]+r[5]*r[5]+r[9]*r[9],c=r[2]*r[2]+r[6]*r[6]+r[10]*r[10];return Math.sqrt(Math.max(n,t,c))}function sr(r,n){const t=Math.sqrt(n[0]*n[0]+n[4]*n[4]+n[8]*n[8]),c=Math.sqrt(n[1]*n[1]+n[5]*n[5]+n[9]*n[9]),o=Math.sqrt(n[2]*n[2]+n[6]*n[6]+n[10]*n[10]);return y(r,t,c,o),r}function Ir(r,n,t){t=t||r;const c=f(r,n);y(t,r[0]-c*n[0],r[1]-c*n[1],r[2]-c*n[2]),g(t,t)}function R(r,n,t){Math.abs(r[0])>Math.abs(r[1])?y(n,0,1,0):y(n,1,0,0),d(t,r,n),g(n,n),d(n,t,r),g(t,t)}function Mr(r,n,t,c,o,e){const u=r+(n-r)*o;return u+(t+(c-t)*o-u)*e}function Nr(r,n,t,c=s()){const o=L(r),e=L(n),u=f(r,n)/(o*e);if(u<.9999999999999999){const a=Math.acos(u),i=((1-t)*o+t*e)/Math.sin(a),h=i/o*Math.sin((1-t)*a),I=i/e*Math.sin(t*a);return M(l,r,h),M(T,n,I),X(c,l,T)}return j(c,r,n,t)}function hr(r,n,t,c=s(),o=s()){const e=L(r),u=L(n),a=f(r,n)/(e*u);if(a<.9999999999999999){const i=Math.acos(a),h=Math.sin(i),I=Math.sin(t*i),p=Math.sin((1-t)*i),E=(1-t)*e+t*u;{const m=E/h,F=m/u*I;M(l,r,m/e*p),M(T,n,F),X(c,l,T)}{const m=1/e*(-Math.cos((1-t)*i)*i*E+p*(-e+u));M(l,r,m);const F=1/u*(Math.cos(t*i)*i*E+I*(-e+u));M(T,n,F),X(o,l,T),M(o,o,1/h)}return o}return j(c,r,n,t),$(o,n,r),g(o,o),o}function gr(r,n,t){r=g(l,r),n=g(T,n);const c=D(f(r,n));if(t){const o=d(W,r,n);if(f(o,t)<0)return-c}return c}function $r(r){const n=r.length;return t=>{if(t<=r[0][0])return r[0][1];if(t>=r[n-1][0])return r[n-1][1];let c=1;for(;t>r[c][0];)c++;const o=r[c-1][0],e=r[c][0],u=(e-t)/(e-o);return u*r[c-1][1]+(1-u)*r[c][1]}}function mr(r,n,t,c){$(k,n,r),$(U,t,r),d(c,k,U),g(c,c),c[3]=-f(r,c)}const k=s(),U=s(),W=s(),l=s(),T=s();function w(r=P){return[r[0],r[1],r[2],r[3]]}function Ar(r=P[0],n=P[1],t=P[2],c=P[3]){return B(r,n,t,c,K.get())}function Y(r,n){return B(n[0],n[1],n[2],n[3],r)}function B(r,n,t,c,o=w()){return o[0]=r,o[1]=n,o[2]=t,o[3]=c,o}function Er(r,n,t){return J(t,r),t[3]=n,t}function Z(r,n,t){const c=n[0]*n[0]+n[1]*n[1]+n[2]*n[2],o=Math.abs(c-1)>1e-5&&c>1e-12?1/Math.sqrt(c):1;return t[0]=n[0]*o,t[1]=n[1]*o,t[2]=n[2]*o,t[3]=-(t[0]*r[0]+t[1]*r[1]+t[2]*r[2]),t}function Q(r,n,t,c=w()){const o=t[0]-n[0],e=t[1]-n[1],u=t[2]-n[2],a=r[0]-n[0],i=r[1]-n[1],h=r[2]-n[2],I=e*h-u*i,p=u*a-o*h,E=o*i-e*a,m=I*I+p*p+E*E,F=Math.abs(m-1)>1e-5&&m>1e-12?1/Math.sqrt(m):1;return c[0]=I*F,c[1]=p*F,c[2]=E*F,c[3]=-(c[0]*r[0]+c[1]*r[1]+c[2]*r[2]),c}function S(r,n,t,c,o){if(r.count<3)return!1;r.getVec(t,q);let e=c,u=!1;for(;e<r.count-1&&!u;)r.getVec(e,b),e++,u=!z(q,b);if(!u)return!1;for(e=Math.max(e,o),u=!1;e<r.count&&!u;)r.getVec(e,_),e++,$(x,q,b),g(x,x),$(C,b,_),g(C,C),u=!z(q,_)&&!z(b,_)&&Math.abs(f(x,C))<rr;return u?(Q(q,b,_,n),!0):(t!==0||c!==1||o!==2)&&S(r,n,0,1,2)}const rr=.99619469809,q=s(),b=s(),_=s(),x=s(),C=s();function Fr(r,n,t){return n!==r&&Y(r,n),r[3]=-f(r,t),r}function _r(r,n){return n[0]=-r[0],n[1]=-r[1],n[2]=-r[2],n[3]=-r[3],n}function lr(r,n,t,c){return d(_,n,r),Z(t,_,c)}function Tr(r,n,t,c){return v(r,n,$(A.get(),t,n),tr,c)}function pr(r,n,t){return!!H(n)&&v(r,n.origin,n.direction,cr,t)}function br(r,n,t){return v(r,n.origin,n.vector,N.NONE,t)}function qr(r,n,t){return v(r,n.origin,n.vector,N.CLAMP,t)}function Pr(r,n){return V(r,n)>=0}function dr(r,n){const t=f(r,n.ray.direction),c=-V(r,n.ray.origin);if(c<0&&t>=0)return!1;if(t>-1e-6&&t<1e-6)return c>0;if((c<0||t<0)&&!(c<0&&t<0))return!0;const o=c/t;return t>0?o<n.c1&&(n.c1=o):o>n.c0&&(n.c0=o),n.c0<=n.c1}function yr(r,n){const t=f(r,n.ray.direction),c=-V(r,n.ray.origin);if(t>-1e-6&&t<1e-6)return c>0;const o=c/t;return t>0?o<n.c1&&(n.c1=o):o>n.c0&&(n.c0=o),n.c0<=n.c1}function Xr(r,n,t){const c=M(A.get(),r,-r[3]),o=nr(r,$(A.get(),n,c),A.get());return X(t,o,c),t}function xr(r,n,t,c){const o=r,e=A.get(),u=A.get();R(o,e,u);const a=$(A.get(),t,n),i=O(e,a),h=O(u,a),I=O(o,a);return y(c,i,h,I)}function nr(r,n,t){const c=M(A.get(),r,f(r,n));return $(t,n,c),t}function V(r,n){return f(r,n)+r[3]}function v(r,n,t,c,o){const e=f(r,t);if(e===0)return!1;let u=-(f(r,n)+r[3])/e;return c&N.CLAMP&&(u=G(u,0,1)),!(!(c&N.INFINITE_MIN)&&u<0||!(c&N.INFINITE_MAX)&&u>1)&&(X(o,n,M(o,t,u)),!0)}function Cr(r){return r}const P=[0,0,1,0];var N;(function(r){r[r.NONE=0]="NONE",r[r.CLAMP=1]="CLAMP",r[r.INFINITE_MIN=4]="INFINITE_MIN",r[r.INFINITE_MAX=8]="INFINITE_MAX"})(N||(N={}));const tr=N.INFINITE_MIN|N.INFINITE_MAX,cr=N.INFINITE_MAX;export{Y as A,dr as D,Ar as E,B as F,yr as G,Xr as H,xr as J,nr as K,Fr as L,lr as O,_r as P,V as R,Er as T,qr as U,Tr as V,Cr as Y,Z as _,$r as a,gr as b,sr as c,S as d,mr as e,Ir as f,Mr as g,R as h,Q as j,Nr as k,ar as l,w as p,pr as q,hr as v,br as x,Pr as z};
