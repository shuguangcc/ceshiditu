import{r as P,t as v,i as x,e as H}from"./typedArrayUtil-a8b5b3e9.js";import{n as $e,s as Fe,u as se,r as ze,h as Pe}from"./mat4-44a0988f.js";import{u as C,S as re,O as E,g as Z,r as ne,p as De,o as K,e as Le,z as ee,_ as we}from"./vec3-a020a6f6.js";import{n as L,f as xe,r as Ie}from"./vec3f64-2f9cef06.js";import{r as j}from"./vec4f64-e407da96.js";import{d as Me,c as T,e as Ce}from"./sphere-4f5e644f.js";import{bv as Ne,bd as R,bc as oe,bw as ke,bx as Q,H as Be,aP as X,bf as y,aV as We,by as Ae,be as ae,aW as Ue,bz as Ve,L as Ge,aE as qe,bA as He}from"./index-455b69b8.js";import"./geometry-5a216427.js";import{n as Qe}from"./compilerUtils-034cacb8.js";import{n as Xe}from"./Evented-515b9d9c.js";import{m as ce}from"./mathUtils-2519596a.js";import{i as Ee,x as Ye,d as Je,y as le}from"./screenUtils-410d12c0.js";import{z as Ze,e as S}from"./cast-7928d7aa.js";import{a as he}from"./mat3-3fc68e72.js";import{e as Ke}from"./mat3f64-c6305894.js";import{e as k}from"./mat4f64-1e28eae0.js";import{b as et}from"./vec2-2cef68de.js";import{A as tt,p as it,C as st,X as rt}from"./projection-d7b57a6c.js";import{u as nt}from"./unitUtils-47abac71.js";import{F as ot}from"./aaBoundingRect-4a760199.js";import{v as at,M as ct,b as ue,B as lt}from"./lineSegment-e6f72ff2.js";import{p as ht,_ as de,q as _e}from"./plane-45609588.js";import{i as ut,n as $}from"./basicInterfaces-19ed850e.js";import{w as N}from"./Extent-69509002.js";import{g as dt,A as _t,i as pt,_ as ft,E as F,t as gt,x as mt,b as bt,d as vt}from"./objectResourceUtils-ef6e3cdf.js";import{d as yt,x as pe,j as St,c as B}from"./VisualVariablePassParameters-5807c7dc.js";import{O as p}from"./VertexAttribute-9c5c630d.js";import{p as Ot}from"./ImageMaterial-0dc3e395.js";import{p as Tt,Y as Lt}from"./aaBoundingBox-fc742a4e.js";import{i as wt}from"./BufferView-646ba1de.js";import{T as At}from"./InterleavedLayout-5e9cf734.js";import{h as w}from"./Matrix3PassUniform-da8eddae.js";import{e as Et}from"./Util-a48361c6.js";import{_ as Rt}from"./preload-helper-41c905a7.js";import{t as jt,e as $t,o as Ft,W as zt,h as Pt,a as Dt,_ as xt}from"./EvaluateSceneLighting.glsl-3bbc6edf.js";import{e as O}from"./ShaderTechniqueConfiguration-9f5b4555.js";import{o as W}from"./TransparencyPassType-cd195b0e.js";import{s as It}from"./DefaultTechniqueConfiguration-e8962072.js";import{h as Mt}from"./ShadedColorMaterial.glsl-7dee9441.js";import{I as Y}from"./enums-64ab819c.js";class Re{constructor(e){this._camera=new Ne,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=[],this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=k(),this._worldFrame=null,this._renderLocation=L(),this._renderLocationDirty=!0,this._location=new N({x:0,y:0,z:0}),this._elevationAlignedLocation=new N,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.cursor=null,this.grabCursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=R.None,this._focused=!1,this.events=new Xe.EventEmitter,this._screenLocation={screenPointArray:Ee(),renderScreenPointArray:Ye(),pixelSize:0},this._screenLocationDirty=!0,this._applyObjectTransform=null,this._engineResourcesAddedToStage=!1,this._engineResources=null,this._attached=!1,this._engineLayer=null,this._materialIdReferences=null,this._location.spatialReference=e.view.spatialReference;for(const t in e)this[t]=e[t];this.view.state&&this.view.state.camera&&this._camera.copyFrom(this.view.state.camera)}destroy(){this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this._camera=null}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}set available(e){e!==this._available&&(this._available=e,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,this._noDisplayCount===1&&this._updateEngineObject(),{remove:Ze(()=>{this._noDisplayCount--,this._noDisplayCount===0&&this._updateEngineObject()})}}set radius(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}get radius(){return this._radius}set worldSized(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(e){fe(e)&&(this._screenLocationDirty=!0),$e(this._modelTransform,e),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=k()),Ct(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(e){oe(e,this._location),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(e){oe(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}_updateElevationAlignedLocation(){this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y;const e=P(this._elevation.override)?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=ke(this.location.spatialReference),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._updateEngineObject())}updateStateEnabled(e,t){t?this.state|=e:this.state&=~e}_setFocused(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:e===!0?"focus":"unfocus"}))}get focused(){return this._focused}get screenLocation(){return this._ensureScreenLocation(),this._screenLocation}_ensureScreenLocation(){if(!this._screenLocationDirty)return;this._screenLocation.pixelSize=this._camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1;let e;if(fe(this._modelTransform)){const t=this._calculateModelTransformOffset(Bt);e=C(t,t,this.renderLocation)}else e=this.renderLocation;this._camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this._camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}get attached(){return this._attached}intersectionDistance(e,t){if(!this.available)return null;const i=Je(e,Nt),s=this._getCollisionRadius(t),n=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if(et(this.screenLocation.screenPointArray,i)<s*s)return this.screenLocation.renderScreenPointArray[2]+n;break;case"line":{const o=this.collisionType.paths,a=this._getWorldToScreenObjectScale(),l=this._calculateObjectTransform(a,I),d=s*this.screenLocation.pixelSize,c=Q(this._camera,i,J);if(v(c))return null;for(const u of o){if(u.length===0)continue;const _=E(D,u[0],l);for(let f=1;f<u.length;f++){const g=E(be,u[f],l),h=lt(ue(_,g,ge),c);if(h!=null&&h<d*d){const m=C(T.get(),_,g);Z(m,m,.5);const A=le(T.get());return this._camera.projectToRenderScreen(m,A),A[2]+n}ne(_,g)}}break}case"disc":{const o=this.collisionType.direction,a=this.collisionType.offset??xe,l=this._getWorldToScreenObjectScale(),d=this._calculateObjectTransform(l,I),c=s*this.screenLocation.pixelSize,u=Q(this._camera,i,J);if(v(u))return null;const _=he(me,d),f=re(ye,o,_),g=E(Se,a,d);de(g,f,M);const h=ve;if(_e(M,u,h)&&De(h,g)<c*c)return this.screenLocation.renderScreenPointArray[2]+n;break}case"ribbon":{const{paths:o,direction:a}=this.collisionType,l=this._getWorldToScreenObjectScale(),d=this._calculateObjectTransform(l,I),c=s*this._camera.computeScreenPixelSizeAt(this.renderLocation),u=Q(this._camera,i,J);if(v(u))return null;const _=he(me,d),f=re(ye,a,_),g=this._calculateModelTransformPosition(Se);de(g,f,M);const h=ve;if(!_e(M,u,h))break;for(const m of o){if(m.length===0)continue;const A=E(D,m[0],d);for(let V=1;V<m.length;V++){const G=E(be,m[V],d),te=ct(ue(A,G,ge),h);if(te!=null&&te<c*c){const q=C(T.get(),A,G);Z(q,q,.5);const ie=le(T.get());return this._camera.projectToRenderScreen(q,ie),ie[2]+n}ne(A,G)}}break}default:Qe(this.collisionType)}return null}attach(e={manipulator3D:{}}){var i;if(!this.view._stage)return;const t=e.manipulator3D;if(v(t.engineLayerId)){const s=new Be({isPickable:!1,updatePolicy:ut.SYNC});this.view._stage.add(s),t.engineLayerId=s.id,this._engineLayer=s}else(i=this.view._stage)!=null&&i.getObject&&(this._engineLayer=this.view._stage.getObject(t.engineLayerId));t.engineLayerReferences=(t.engineLayerReferences||0)+1,this._materialIdReferences=t.materialIdReferences,v(this._materialIdReferences)&&(this._materialIdReferences=new Map,t.materialIdReferences=this._materialIdReferences),this._camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),tt(this._location.spatialReference,this.view.spatialReference)||(this.location=new N({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(e={manipulator3D:{}}){const t=e.manipulator3D;t.engineLayerReferences--;const i=t.engineLayerReferences===0;i&&(t.engineLayerId=null),this._removeResourcesFromStage(i),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this._camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(e){it(this.location,Oe,e.spatialReference),ot(e.extent,Oe)&&(this.location=this._location)}_evaluateElevationAlignment(e=this.location){if(v(this.elevationInfo))return!1;let t=null,i=0;const s=x(this.elevationInfo.offset,0);switch(this.elevationInfo.mode){case"on-the-ground":t=x(X(this.view.elevationProvider,e,"ground"),0);break;case"relative-to-ground":i=x(X(this.view.elevationProvider,e,"ground"),0)+s;break;case"relative-to-scene":i=x(X(this.view.elevationProvider,e,"scene"),0)+s;break;case"absolute-height":i=s}return(i!==this._elevation.offset||t!==this._elevation.override)&&(this._elevation.offset=i,this._elevation.override=t,!0)}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();const e=this._getWorldToScreenObjectScale(),t=I;if(this.autoScaleRenderObjects===!0){const o=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(o,t)}else this._calculateObjectTransform(e,t);const{objectsByState:i}=this._ensureEngineResources(),s=(this.focused?y.Focused:y.Unfocused)|(this.selected?y.Selected:y.Unselected),n=this._noDisplayCount>0;for(const{stateMask:o,objects:a}of i){if(n){for(const _ of a)_.setVisible(!1);continue}const l=(o&y.All)!==y.None,d=(o&R.All)!==R.None,c=!l||(s&o)==(o&y.All),u=!d||(this.state&o)==(o&R.All);if(c&&u)for(const _ of a)_.setVisible(!0),_.transformation=t;else for(const _ of a)_.setVisible(!1)}}_ensureEngineResources(){if(v(this._engineResources)){const e=H(this._engineLayer),t=[],i=new Set;this.renderObjects.forEach(({material:a})=>{i.has(a)||(t.push(a),i.add(a))});const s=(a,l)=>{const{geometry:d,material:c,transform:u}=l;Array.isArray(d)?d.forEach(_=>a.addGeometry(_,c,u)):a.addGeometry(d,c,u)},n=new Map;this._renderObjects.forEach(a=>{const l=new We({castShadow:!1});s(l,a);const d=a.stateMask||0,c=n.get(d)||[];c.push(l),n.set(d,c)});const o=[];n.forEach((a,l)=>o.push({stateMask:l,objects:a})),this._engineResources={objectsByState:o,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){if(this._engineResourcesAddedToStage||v(this._engineResources))return;const{objectsByState:e,layer:t,materials:i}=this._engineResources;i.forEach(s=>{const n=H(this._materialIdReferences),o=n.get(s.id)||0;o===0&&this.view._stage.add(s),n.set(s.id,o+1)}),e.forEach(({objects:s})=>{t.addMany(s),this.view._stage.addMany(s)}),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(e=!1){if(!this._engineResourcesAddedToStage||v(this._engineResources)||!this.view._stage)return;const{objectsByState:t,layer:i,materials:s}=this._engineResources;t.forEach(({objects:n})=>{i.removeMany(n),this.view._stage.removeMany(n)}),s.forEach(n=>{const o=H(this._materialIdReferences),a=o.get(n.id);a===1?(this.view._stage.remove(n),o.delete(n.id)):o.set(n.id,a-1)}),e&&this.view._stage.remove(i),this._engineResourcesAddedToStage=!1}_getCollisionRadius(e){return this._getFocusedSize(this.radius,!0)*(e==="touch"?this.touchMultiplier:1)}_getFocusedSize(e,t){return e*(t?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(e){const t=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(t,kt);return K(e,i[12],i[13],i[14])}_calculateModelTransformOffset(e){const t=this._calculateModelTransformPosition(e);return Le(e,t,this.renderLocation)}_calculateObjectTransform(e,t){return Fe(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&se(t,t,this._worldFrame),se(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,P(this._applyObjectTransform)&&this._applyObjectTransform(t),t}get test(){let e=!1;if(P(this._engineResources))for(const t in this._engineResources.objectsByState){const i=this._engineResources.objectsByState[t];for(const s of i.objects)if(s.isVisible){e=!0;break}if(e)break}return{areAnyResourcesVisible:e}}}function fe(r){return r[12]!==0||r[13]!==0||r[14]!==0}function Ct(r,e,t){switch(r.viewingMode){case"local":return ze(t),!0;case"global":{const i=nt(r.renderCoordsHelper.spatialReference);return st(e,0,D,0,i.radius),rt(ce(D[0]),ce(D[1]),t),!0}}}const Nt=Ee(),ge=at(),J=Me(),me=Ke(),kt=k(),I=k(),M=ht(),D=L(),be=L(),ve=L(),ye=L(),Se=L(),Bt=L(),Oe=new N({x:0,y:0,z:0,spatialReference:null});class U extends $t{initializeProgram(e){return new Ft(e.rctx,U.shader.get().build(this.configuration),je)}_setPipelineState(e){const t=this.configuration,i=e===W.NONE,s=e===W.FrontFace;return zt({blending:t.output!==w.Color&&t.output!==w.Alpha||!t.transparent?null:i?dt:_t(e),culling:Pt(t.cullFace),depthTest:{func:s?Y.LESS:t.shadingEnabled?Y.LEQUAL:Y.LESS},depthWrite:i?t.writeDepth&&Dt:pt(e),colorWrite:xt,polygonOffset:i||s?null:ft})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}U.shader=new jt(Mt,()=>Rt(()=>import("./ShadedColorMaterial.glsl-7b1abb23.js"),["./ShadedColorMaterial.glsl-7b1abb23.js","./vec4f64-e407da96.js","./View.glsl-8b12b8c2.js","./mat4-44a0988f.js","./vec3f64-2f9cef06.js","./common-c186b691.js","./mat4f32-77b3d8ac.js","./vec3-a020a6f6.js","./ShaderBuilder-93e8045e.js","./typedArrayUtil-a8b5b3e9.js","./Error-653283ae.js","./string-cdf077e6.js","./Matrix3PassUniform-da8eddae.js","./mat4f64-1e28eae0.js","./mat3f64-c6305894.js","./vec3f32-c9aa289f.js","./VertexAttribute-9c5c630d.js","./vec2-2cef68de.js","./vec2f64-30dc1443.js","./Texture2DPassUniform-6e8ae673.js","./TransparencyPassType-cd195b0e.js","./ShadedColorMaterial.glsl-7dee9441.js","./FloatPassUniform-d2dfc562.js","./Slice.glsl-a612de15.js","./Transform.glsl-f15542a7.js","./ForwardLinearDepth.glsl-36f9eb3b.js","./MultipassTerrainTest.glsl-e79d40de.js","./ReadLinearDepth.glsl-7ff30f7d.js","./RgbaFloatEncoding.glsl-6036ca34.js","./AlphaCutoff-96178e0d.js","./Float4PassUniform-3a47b7b3.js"],import.meta.url));let b=class extends It{constructor(){super(...arguments),this.output=w.Color,this.cullFace=$.None,this.transparencyPassType=W.NONE,this.hasSlicePlane=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};S([O({count:w.COUNT})],b.prototype,"output",void 0),S([O({count:$.COUNT})],b.prototype,"cullFace",void 0),S([O({count:W.COUNT})],b.prototype,"transparencyPassType",void 0),S([O()],b.prototype,"hasSlicePlane",void 0),S([O()],b.prototype,"transparent",void 0),S([O()],b.prototype,"writeDepth",void 0),S([O()],b.prototype,"screenSizeEnabled",void 0),S([O()],b.prototype,"shadingEnabled",void 0),S([O()],b.prototype,"hasMultipassTerrain",void 0),S([O()],b.prototype,"cullAboveGround",void 0);const je=new Map([[p.POSITION,0],[p.NORMAL,1],[p.OFFSET,2]]);class Wt extends yt{constructor(e){super(e,new Vt),this.supportsEdges=!0,this._configuration=new b,this._vertexAttributeLocations=je}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.screenSizeEnabled=this.parameters.screenSizeEnabled,this._configuration.shadingEnabled=this.parameters.shadingEnabled,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(e,t,i,s,n,o,a){if(this.parameters.screenSizeEnabled){const l=e.vertexAttributes.get(p.OFFSET);pe(e,t,s,n,o,{applyToVertex:(c,u,_,f)=>{const g=K(Te,l.data[3*f+0],l.data[3*f+1],l.data[3*f+2]),h=K(qt,c,u,_);return Z(g,g,this.parameters.screenSizeScale*s.camera.computeRenderPixelSizeAt(g)),C(h,h,g),[h[0],h[1],h[2]]},applyToAabb:c=>{const u=Tt(c,Te);return Lt(c,this.parameters.screenSizeScale*s.camera.computeRenderPixelSizeAt(u))}},a)}else pe(e,t,s,n,o,void 0,a)}requiresSlot(e,t){if(t===w.Highlight)return e===F.OPAQUE_MATERIAL;if(t===w.Color||t===w.Alpha||t===w.ObjectAndLayerIdColor){let i=F.OPAQUE_MATERIAL;return this.parameters.transparent&&(i=this.parameters.writeDepth?F.TRANSPARENT_MATERIAL:F.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===i||e===F.DRAPED_MATERIAL}return!1}createGLMaterial(e){return new Ut(e)}createBufferWriter(){return new Gt(this.parameters.screenSizeEnabled)}}class Ut extends gt{beginSlot(e){return this.ensureTechnique(U,e)}}let Vt=class extends St{constructor(){super(...arguments),this.color=j(1,1,1,1),this.shadingTint=j(0,0,0,.25),this.shadingDirection=ee(L(),[.5,-.5,-.5]),this.screenSizeScale=14,this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=$.None,this.screenSizeEnabled=!1,this.shadingEnabled=!0}};class Gt{constructor(e){this.screenSizeEnabled=e;const t=At().vec3f(p.POSITION).vec3f(p.NORMAL);this.screenSizeEnabled&&t.vec3f(p.OFFSET),this.vertexBufferLayout=t}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(p.POSITION).length}write(e,t,i,s,n){if(mt(i,this.vertexBufferLayout,e,t,s,n),this.screenSizeEnabled){if(!i.vertexAttributes.has(p.OFFSET))throw new Error(`${p.OFFSET} vertex attribute required for screenSizeEnabled ShadedColorMaterial`);{const o=i.vertexAttributes.get(p.OFFSET),a=i.indices.get(p.OFFSET);Et(o.size===3);const l=s.getField(p.OFFSET,wt);if(!l)throw new Error("unable to acquire view for "+p.OFFSET);bt(a,o.data,t,l,n)}}}}const Te=L(),qt=L();function Ht(r,e=B.OccludeAndTransparent,t=!0){const i=j(r[0],r[1],r[2],r.length>3?r[3]:1),s=r[3]<1;return t?new Wt({color:i,transparent:s,writeDepth:!0,cullFace:$.Back,renderOccluded:e}):new Ae({color:i,transparent:s,writeDepth:!0,cullFace:$.Back,renderOccluded:e})}function ki(r,e=B.OccludeAndTransparent){const t=j(r[0],r[1],r[2],r.length===4?r[3]:1);return new Ae({color:t,transparent:!0,writeDepth:!0,cullFace:$.Front,renderOccluded:e})}const z=Object.freeze({calloutLength:40,calloutWidth:1,discRadius:27,focusMultiplier:1.1,calloutColor:Ie(1,.5,0)});function Bi(r,e){const t=new Re({view:r,autoScaleRenderObjects:!1,collisionPriority:1,metadata:e.metadata});return Qt(t,e),t}function Qt(r,e){var g;const t=e.material??new Ot({transparent:!0,writeDepth:!1,textureId:(g=e.texture)==null?void 0:g.id,renderOccluded:B.Opaque}),i=e.focusMultiplier??z.focusMultiplier,s=e.calloutLength??z.calloutLength,n=z.discRadius*(e.discScale??1),o=n*i,a=h=>{const m=[0,1,2,2,3,0];return new vt([[p.POSITION,{size:3,data:[s-h,-h,0,s+h,-h,0,s+h,h,0,s-h,h,0],exclusive:!0}],[p.UV0,{size:2,data:[0,0,1,0,1,1,0,1]}]],[[p.POSITION,m],[p.UV0,m]])},l=ae([[0,0,0],[s-n,0,0]]),d=ae([[0,0,0],[s-o,0,0]]),c=z.calloutColor,u=e.calloutWidth??z.calloutWidth,_=new(u>1?Ue:Ve)({width:u,color:j(c[0],c[1],c[2],e.calloutOpacity??1),renderOccluded:B.OccludeAndTransparent}),f=e.customStateMask??R.None;r.collisionType={type:"disc",direction:[0,0,1],offset:[s,0,0]},r.focusMultiplier=i,r.metadata=e.metadata,r.radius=n,r.renderObjects=[{geometry:a(n),material:t,stateMask:y.Unfocused|f},{geometry:l,material:_,stateMask:y.Unfocused|f},{geometry:a(o),material:t,stateMask:y.Focused|f},{geometry:d,material:_,stateMask:y.Focused|f}]}function Wi(r,e,t,i=R.None){return new Re({view:r,renderObjects:[{geometry:He(1,32,32),material:Ht(j(e[0],e[1],e[2],t??1)),stateMask:i}]})}const Ui=Object.freeze({autoScaleRenderObjects:!1,worldSized:!0});function Vi(r,e,t,i){const s=Le(T.get(),r,t),n=Xt(s,we(T.get(),i,s),t,Ce.get());Pe(n,n);const o=E(T.get(),e,n);return Math.atan2(o[1],o[0])}function Xt(r,e,t,i){const s=ee(T.get(),r),n=ee(T.get(),e),o=we(T.get(),s,n);return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=0,i[4]=n[0],i[5]=n[1],i[6]=n[2],i[7]=0,i[8]=o[0],i[9]=o[1],i[10]=o[2],i[11]=0,i[12]=t[0],i[13]=t[1],i[14]=t[2],i[15]=1,i}function Yt(r,e){const t=r.getViewForGraphic(e);return P(t)&&"computeAttachmentOrigin"in t?t.computeAttachmentOrigin(e,r.spatialReference):null}function Gi(r,e,t){const i=Yt(r,t);P(i)?e.elevationAlignedLocation=i:Jt(e,t.geometry)}function Jt(r,e){if(v(e))return;const t=e.type==="mesh"?e.anchor:Ge(e);v(t)||(r.location=qe(t))}export{Ht as A,Gi as C,Xt as D,ki as I,Yt as N,Bi as R,Qt as T,Wi as U,Re as i,Wt as v,Ui as x,Vi as z};
