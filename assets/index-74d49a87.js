(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=i(s);fetch(s.href,n)}})();function nY(t,e){const i=Object.create(null),r=t.split(",");for(let s=0;s<r.length;s++)i[r[s]]=!0;return e?s=>!!i[s.toLowerCase()]:s=>!!i[s]}function oY(t){if(Zi(t)){const e={};for(let i=0;i<t.length;i++){const r=t[i],s=Ia(r)?fIe(r):oY(r);if(s)for(const n in s)e[n]=s[n]}return e}else{if(Ia(t))return t;if(bo(t))return t}}const hIe=/;(?![^(]*\))/g,dIe=/:([^]+)/,pIe=/\/\*.*?\*\//gs;function fIe(t){const e={};return t.replace(pIe,"").split(hIe).forEach(i=>{if(i){const r=i.split(dIe);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function aY(t){let e="";if(Ia(t))e=t;else if(Zi(t))for(let i=0;i<t.length;i++){const r=aY(t[i]);r&&(e+=r+" ")}else if(bo(t))for(const i in t)t[i]&&(e+=i+" ");return e.trim()}const mIe="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",gIe=nY(mIe);function pfe(t){return!!t||t===""}const an={},cE=[],Vp=()=>{},yIe=()=>!1,_Ie=/^on[^a-z]/,w6=t=>_Ie.test(t),lY=t=>t.startsWith("onUpdate:"),fl=Object.assign,cY=(t,e)=>{const i=t.indexOf(e);i>-1&&t.splice(i,1)},vIe=Object.prototype.hasOwnProperty,Tr=(t,e)=>vIe.call(t,e),Zi=Array.isArray,bM=t=>x6(t)==="[object Map]",bIe=t=>x6(t)==="[object Set]",rr=t=>typeof t=="function",Ia=t=>typeof t=="string",uY=t=>typeof t=="symbol",bo=t=>t!==null&&typeof t=="object",ffe=t=>bo(t)&&rr(t.then)&&rr(t.catch),wIe=Object.prototype.toString,x6=t=>wIe.call(t),xIe=t=>x6(t).slice(8,-1),TIe=t=>x6(t)==="[object Object]",hY=t=>Ia(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,YD=nY(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),T6=t=>{const e=Object.create(null);return i=>e[i]||(e[i]=t(i))},SIe=/-(\w)/g,jE=T6(t=>t.replace(SIe,(e,i)=>i?i.toUpperCase():"")),EIe=/\B([A-Z])/g,HC=T6(t=>t.replace(EIe,"-$1").toLowerCase()),mfe=T6(t=>t.charAt(0).toUpperCase()+t.slice(1)),oV=T6(t=>t?`on${mfe(t)}`:""),KF=(t,e)=>!Object.is(t,e),aV=(t,e)=>{for(let i=0;i<t.length;i++)t[i](e)},QF=(t,e,i)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value:i})},CIe=t=>{const e=parseFloat(t);return isNaN(e)?t:e};let yte;const AIe=()=>yte||(yte=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let up;class OIe{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this.parent=up,!e&&up&&(this.index=(up.scopes||(up.scopes=[])).push(this)-1)}get active(){return this._active}run(e){if(this._active){const i=up;try{return up=this,e()}finally{up=i}}}on(){up=this}off(){up=this.parent}stop(e){if(this._active){let i,r;for(i=0,r=this.effects.length;i<r;i++)this.effects[i].stop();for(i=0,r=this.cleanups.length;i<r;i++)this.cleanups[i]();if(this.scopes)for(i=0,r=this.scopes.length;i<r;i++)this.scopes[i].stop(!0);if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0,this._active=!1}}}function RIe(t,e=up){e&&e.active&&e.effects.push(t)}function MIe(){return up}const dY=t=>{const e=new Set(t);return e.w=0,e.n=0,e},gfe=t=>(t.w&jv)>0,yfe=t=>(t.n&jv)>0,PIe=({deps:t})=>{if(t.length)for(let e=0;e<t.length;e++)t[e].w|=jv},IIe=t=>{const{deps:e}=t;if(e.length){let i=0;for(let r=0;r<e.length;r++){const s=e[r];gfe(s)&&!yfe(s)?s.delete(t):e[i++]=s,s.w&=~jv,s.n&=~jv}e.length=i}},Pz=new WeakMap;let jO=0,jv=1;const Iz=30;let Ep;const tx=Symbol(""),$z=Symbol("");class pY{constructor(e,i=null,r){this.fn=e,this.scheduler=i,this.active=!0,this.deps=[],this.parent=void 0,RIe(this,r)}run(){if(!this.active)return this.fn();let e=Ep,i=Rv;for(;e;){if(e===this)return;e=e.parent}try{return this.parent=Ep,Ep=this,Rv=!0,jv=1<<++jO,jO<=Iz?PIe(this):_te(this),this.fn()}finally{jO<=Iz&&IIe(this),jv=1<<--jO,Ep=this.parent,Rv=i,this.parent=void 0,this.deferStop&&this.stop()}}stop(){Ep===this?this.deferStop=!0:this.active&&(_te(this),this.onStop&&this.onStop(),this.active=!1)}}function _te(t){const{deps:e}=t;if(e.length){for(let i=0;i<e.length;i++)e[i].delete(t);e.length=0}}let Rv=!0;const _fe=[];function qC(){_fe.push(Rv),Rv=!1}function WC(){const t=_fe.pop();Rv=t===void 0?!0:t}function eu(t,e,i){if(Rv&&Ep){let r=Pz.get(t);r||Pz.set(t,r=new Map);let s=r.get(i);s||r.set(i,s=dY()),vfe(s)}}function vfe(t,e){let i=!1;jO<=Iz?yfe(t)||(t.n|=jv,i=!gfe(t)):i=!t.has(Ep),i&&(t.add(Ep),Ep.deps.push(t))}function Fy(t,e,i,r,s,n){const o=Pz.get(t);if(!o)return;let a=[];if(e==="clear")a=[...o.values()];else if(i==="length"&&Zi(t)){const l=Number(r);o.forEach((c,h)=>{(h==="length"||h>=l)&&a.push(c)})}else switch(i!==void 0&&a.push(o.get(i)),e){case"add":Zi(t)?hY(i)&&a.push(o.get("length")):(a.push(o.get(tx)),bM(t)&&a.push(o.get($z)));break;case"delete":Zi(t)||(a.push(o.get(tx)),bM(t)&&a.push(o.get($z)));break;case"set":bM(t)&&a.push(o.get(tx));break}if(a.length===1)a[0]&&Lz(a[0]);else{const l=[];for(const c of a)c&&l.push(...c);Lz(dY(l))}}function Lz(t,e){const i=Zi(t)?t:[...t];for(const r of i)r.computed&&vte(r);for(const r of i)r.computed||vte(r)}function vte(t,e){(t!==Ep||t.allowRecurse)&&(t.scheduler?t.scheduler():t.run())}const $Ie=nY("__proto__,__v_isRef,__isVue"),bfe=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(uY)),LIe=fY(),DIe=fY(!1,!0),NIe=fY(!0),bte=FIe();function FIe(){const t={};return["includes","indexOf","lastIndexOf"].forEach(e=>{t[e]=function(...i){const r=Zr(this);for(let n=0,o=this.length;n<o;n++)eu(r,"get",n+"");const s=r[e](...i);return s===-1||s===!1?r[e](...i.map(Zr)):s}}),["push","pop","shift","unshift","splice"].forEach(e=>{t[e]=function(...i){qC();const r=Zr(this)[e].apply(this,i);return WC(),r}}),t}function UIe(t){const e=Zr(this);return eu(e,"has",t),e.hasOwnProperty(t)}function fY(t=!1,e=!1){return function(r,s,n){if(s==="__v_isReactive")return!t;if(s==="__v_isReadonly")return t;if(s==="__v_isShallow")return e;if(s==="__v_raw"&&n===(t?e?e$e:Efe:e?Sfe:Tfe).get(r))return r;const o=Zi(r);if(!t){if(o&&Tr(bte,s))return Reflect.get(bte,s,n);if(s==="hasOwnProperty")return UIe}const a=Reflect.get(r,s,n);return(uY(s)?bfe.has(s):$Ie(s))||(t||eu(r,"get",s),e)?a:rc(a)?o&&hY(s)?a:a.value:bo(a)?t?Cfe(a):yY(a):a}}const VIe=wfe(),kIe=wfe(!0);function wfe(t=!1){return function(i,r,s,n){let o=i[r];if(w3(o)&&rc(o)&&!rc(s))return!1;if(!t&&(!Dz(s)&&!w3(s)&&(o=Zr(o),s=Zr(s)),!Zi(i)&&rc(o)&&!rc(s)))return o.value=s,!0;const a=Zi(i)&&hY(r)?Number(r)<i.length:Tr(i,r),l=Reflect.set(i,r,s,n);return i===Zr(n)&&(a?KF(s,o)&&Fy(i,"set",r,s):Fy(i,"add",r,s)),l}}function BIe(t,e){const i=Tr(t,e);t[e];const r=Reflect.deleteProperty(t,e);return r&&i&&Fy(t,"delete",e,void 0),r}function zIe(t,e){const i=Reflect.has(t,e);return(!uY(e)||!bfe.has(e))&&eu(t,"has",e),i}function GIe(t){return eu(t,"iterate",Zi(t)?"length":tx),Reflect.ownKeys(t)}const xfe={get:LIe,set:VIe,deleteProperty:BIe,has:zIe,ownKeys:GIe},jIe={get:NIe,set(t,e){return!0},deleteProperty(t,e){return!0}},HIe=fl({},xfe,{get:DIe,set:kIe}),mY=t=>t,S6=t=>Reflect.getPrototypeOf(t);function jI(t,e,i=!1,r=!1){t=t.__v_raw;const s=Zr(t),n=Zr(e);i||(e!==n&&eu(s,"get",e),eu(s,"get",n));const{has:o}=S6(s),a=r?mY:i?bY:vY;if(o.call(s,e))return a(t.get(e));if(o.call(s,n))return a(t.get(n));t!==s&&t.get(e)}function HI(t,e=!1){const i=this.__v_raw,r=Zr(i),s=Zr(t);return e||(t!==s&&eu(r,"has",t),eu(r,"has",s)),t===s?i.has(t):i.has(t)||i.has(s)}function qI(t,e=!1){return t=t.__v_raw,!e&&eu(Zr(t),"iterate",tx),Reflect.get(t,"size",t)}function wte(t){t=Zr(t);const e=Zr(this);return S6(e).has.call(e,t)||(e.add(t),Fy(e,"add",t,t)),this}function xte(t,e){e=Zr(e);const i=Zr(this),{has:r,get:s}=S6(i);let n=r.call(i,t);n||(t=Zr(t),n=r.call(i,t));const o=s.call(i,t);return i.set(t,e),n?KF(e,o)&&Fy(i,"set",t,e):Fy(i,"add",t,e),this}function Tte(t){const e=Zr(this),{has:i,get:r}=S6(e);let s=i.call(e,t);s||(t=Zr(t),s=i.call(e,t)),r&&r.call(e,t);const n=e.delete(t);return s&&Fy(e,"delete",t,void 0),n}function Ste(){const t=Zr(this),e=t.size!==0,i=t.clear();return e&&Fy(t,"clear",void 0,void 0),i}function WI(t,e){return function(r,s){const n=this,o=n.__v_raw,a=Zr(o),l=e?mY:t?bY:vY;return!t&&eu(a,"iterate",tx),o.forEach((c,h)=>r.call(s,l(c),l(h),n))}}function XI(t,e,i){return function(...r){const s=this.__v_raw,n=Zr(s),o=bM(n),a=t==="entries"||t===Symbol.iterator&&o,l=t==="keys"&&o,c=s[t](...r),h=i?mY:e?bY:vY;return!e&&eu(n,"iterate",l?$z:tx),{next(){const{value:p,done:f}=c.next();return f?{value:p,done:f}:{value:a?[h(p[0]),h(p[1])]:h(p),done:f}},[Symbol.iterator](){return this}}}}function E0(t){return function(...e){return t==="delete"?!1:this}}function qIe(){const t={get(n){return jI(this,n)},get size(){return qI(this)},has:HI,add:wte,set:xte,delete:Tte,clear:Ste,forEach:WI(!1,!1)},e={get(n){return jI(this,n,!1,!0)},get size(){return qI(this)},has:HI,add:wte,set:xte,delete:Tte,clear:Ste,forEach:WI(!1,!0)},i={get(n){return jI(this,n,!0)},get size(){return qI(this,!0)},has(n){return HI.call(this,n,!0)},add:E0("add"),set:E0("set"),delete:E0("delete"),clear:E0("clear"),forEach:WI(!0,!1)},r={get(n){return jI(this,n,!0,!0)},get size(){return qI(this,!0)},has(n){return HI.call(this,n,!0)},add:E0("add"),set:E0("set"),delete:E0("delete"),clear:E0("clear"),forEach:WI(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(n=>{t[n]=XI(n,!1,!1),i[n]=XI(n,!0,!1),e[n]=XI(n,!1,!0),r[n]=XI(n,!0,!0)}),[t,i,e,r]}const[WIe,XIe,YIe,ZIe]=qIe();function gY(t,e){const i=e?t?ZIe:YIe:t?XIe:WIe;return(r,s,n)=>s==="__v_isReactive"?!t:s==="__v_isReadonly"?t:s==="__v_raw"?r:Reflect.get(Tr(i,s)&&s in r?i:r,s,n)}const JIe={get:gY(!1,!1)},KIe={get:gY(!1,!0)},QIe={get:gY(!0,!1)},Tfe=new WeakMap,Sfe=new WeakMap,Efe=new WeakMap,e$e=new WeakMap;function t$e(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function i$e(t){return t.__v_skip||!Object.isExtensible(t)?0:t$e(xIe(t))}function yY(t){return w3(t)?t:_Y(t,!1,xfe,JIe,Tfe)}function r$e(t){return _Y(t,!1,HIe,KIe,Sfe)}function Cfe(t){return _Y(t,!0,jIe,QIe,Efe)}function _Y(t,e,i,r,s){if(!bo(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const n=s.get(t);if(n)return n;const o=i$e(t);if(o===0)return t;const a=new Proxy(t,o===2?r:i);return s.set(t,a),a}function uE(t){return w3(t)?uE(t.__v_raw):!!(t&&t.__v_isReactive)}function w3(t){return!!(t&&t.__v_isReadonly)}function Dz(t){return!!(t&&t.__v_isShallow)}function Afe(t){return uE(t)||w3(t)}function Zr(t){const e=t&&t.__v_raw;return e?Zr(e):t}function Ofe(t){return QF(t,"__v_skip",!0),t}const vY=t=>bo(t)?yY(t):t,bY=t=>bo(t)?Cfe(t):t;function s$e(t){Rv&&Ep&&(t=Zr(t),vfe(t.dep||(t.dep=dY())))}function n$e(t,e){t=Zr(t);const i=t.dep;i&&Lz(i)}function rc(t){return!!(t&&t.__v_isRef===!0)}function o$e(t){return rc(t)?t.value:t}const a$e={get:(t,e,i)=>o$e(Reflect.get(t,e,i)),set:(t,e,i,r)=>{const s=t[e];return rc(s)&&!rc(i)?(s.value=i,!0):Reflect.set(t,e,i,r)}};function Rfe(t){return uE(t)?t:new Proxy(t,a$e)}var Mfe;class l$e{constructor(e,i,r,s){this._setter=i,this.dep=void 0,this.__v_isRef=!0,this[Mfe]=!1,this._dirty=!0,this.effect=new pY(e,()=>{this._dirty||(this._dirty=!0,n$e(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!s,this.__v_isReadonly=r}get value(){const e=Zr(this);return s$e(e),(e._dirty||!e._cacheable)&&(e._dirty=!1,e._value=e.effect.run()),e._value}set value(e){this._setter(e)}}Mfe="__v_isReadonly";function c$e(t,e,i=!1){let r,s;const n=rr(t);return n?(r=t,s=Vp):(r=t.get,s=t.set),new l$e(r,s,n||!s,i)}function Mv(t,e,i,r){let s;try{s=r?t(...r):t()}catch(n){E6(n,e,i)}return s}function nd(t,e,i,r){if(rr(t)){const n=Mv(t,e,i,r);return n&&ffe(n)&&n.catch(o=>{E6(o,e,i)}),n}const s=[];for(let n=0;n<t.length;n++)s.push(nd(t[n],e,i,r));return s}function E6(t,e,i,r=!0){const s=e?e.vnode:null;if(e){let n=e.parent;const o=e.proxy,a=i;for(;n;){const c=n.ec;if(c){for(let h=0;h<c.length;h++)if(c[h](t,o,a)===!1)return}n=n.parent}const l=e.appContext.config.errorHandler;if(l){Mv(l,null,10,[t,o,a]);return}}u$e(t,i,s,r)}function u$e(t,e,i,r=!0){console.error(t)}let x3=!1,Nz=!1;const nl=[];let dm=0;const hE=[];let ny=null,vw=0;const Pfe=Promise.resolve();let wY=null;function h$e(t){const e=wY||Pfe;return t?e.then(this?t.bind(this):t):e}function d$e(t){let e=dm+1,i=nl.length;for(;e<i;){const r=e+i>>>1;T3(nl[r])<t?e=r+1:i=r}return e}function xY(t){(!nl.length||!nl.includes(t,x3&&t.allowRecurse?dm+1:dm))&&(t.id==null?nl.push(t):nl.splice(d$e(t.id),0,t),Ife())}function Ife(){!x3&&!Nz&&(Nz=!0,wY=Pfe.then(Lfe))}function p$e(t){const e=nl.indexOf(t);e>dm&&nl.splice(e,1)}function f$e(t){Zi(t)?hE.push(...t):(!ny||!ny.includes(t,t.allowRecurse?vw+1:vw))&&hE.push(t),Ife()}function Ete(t,e=x3?dm+1:0){for(;e<nl.length;e++){const i=nl[e];i&&i.pre&&(nl.splice(e,1),e--,i())}}function $fe(t){if(hE.length){const e=[...new Set(hE)];if(hE.length=0,ny){ny.push(...e);return}for(ny=e,ny.sort((i,r)=>T3(i)-T3(r)),vw=0;vw<ny.length;vw++)ny[vw]();ny=null,vw=0}}const T3=t=>t.id==null?1/0:t.id,m$e=(t,e)=>{const i=T3(t)-T3(e);if(i===0){if(t.pre&&!e.pre)return-1;if(e.pre&&!t.pre)return 1}return i};function Lfe(t){Nz=!1,x3=!0,nl.sort(m$e);const e=Vp;try{for(dm=0;dm<nl.length;dm++){const i=nl[dm];i&&i.active!==!1&&Mv(i,null,14)}}finally{dm=0,nl.length=0,$fe(),x3=!1,wY=null,(nl.length||hE.length)&&Lfe()}}function g$e(t,e,...i){if(t.isUnmounted)return;const r=t.vnode.props||an;let s=i;const n=e.startsWith("update:"),o=n&&e.slice(7);if(o&&o in r){const h=`${o==="modelValue"?"model":o}Modifiers`,{number:p,trim:f}=r[h]||an;f&&(s=i.map(m=>Ia(m)?m.trim():m)),p&&(s=i.map(CIe))}let a,l=r[a=oV(e)]||r[a=oV(jE(e))];!l&&n&&(l=r[a=oV(HC(e))]),l&&nd(l,t,6,s);const c=r[a+"Once"];if(c){if(!t.emitted)t.emitted={};else if(t.emitted[a])return;t.emitted[a]=!0,nd(c,t,6,s)}}function Dfe(t,e,i=!1){const r=e.emitsCache,s=r.get(t);if(s!==void 0)return s;const n=t.emits;let o={},a=!1;if(!rr(t)){const l=c=>{const h=Dfe(c,e,!0);h&&(a=!0,fl(o,h))};!i&&e.mixins.length&&e.mixins.forEach(l),t.extends&&l(t.extends),t.mixins&&t.mixins.forEach(l)}return!n&&!a?(bo(t)&&r.set(t,null),null):(Zi(n)?n.forEach(l=>o[l]=null):fl(o,n),bo(t)&&r.set(t,o),o)}function C6(t,e){return!t||!w6(e)?!1:(e=e.slice(2).replace(/Once$/,""),Tr(t,e[0].toLowerCase()+e.slice(1))||Tr(t,HC(e))||Tr(t,e))}let Cp=null,A6=null;function e4(t){const e=Cp;return Cp=t,A6=t&&t.type.__scopeId||null,e}function y$e(t){A6=t}function _$e(){A6=null}function v$e(t,e=Cp,i){if(!e||t._n)return t;const r=(...s)=>{r._d&&Lte(-1);const n=e4(e);let o;try{o=t(...s)}finally{e4(n),r._d&&Lte(1)}return o};return r._n=!0,r._c=!0,r._d=!0,r}function lV(t){const{type:e,vnode:i,proxy:r,withProxy:s,props:n,propsOptions:[o],slots:a,attrs:l,emit:c,render:h,renderCache:p,data:f,setupState:m,ctx:y,inheritAttrs:_}=t;let b,w;const S=e4(t);try{if(i.shapeFlag&4){const E=s||r;b=um(h.call(E,E,p,n,m,f,y)),w=l}else{const E=e;b=um(E.length>1?E(n,{attrs:l,slots:a,emit:c}):E(n,null)),w=e.props?l:b$e(l)}}catch(E){xM.length=0,E6(E,t,1),b=Pv(Ty)}let T=b;if(w&&_!==!1){const E=Object.keys(w),{shapeFlag:O}=T;E.length&&O&7&&(o&&E.some(lY)&&(w=w$e(w,o)),T=Hv(T,w))}return i.dirs&&(T=Hv(T),T.dirs=T.dirs?T.dirs.concat(i.dirs):i.dirs),i.transition&&(T.transition=i.transition),b=T,e4(S),b}const b$e=t=>{let e;for(const i in t)(i==="class"||i==="style"||w6(i))&&((e||(e={}))[i]=t[i]);return e},w$e=(t,e)=>{const i={};for(const r in t)(!lY(r)||!(r.slice(9)in e))&&(i[r]=t[r]);return i};function x$e(t,e,i){const{props:r,children:s,component:n}=t,{props:o,children:a,patchFlag:l}=e,c=n.emitsOptions;if(e.dirs||e.transition)return!0;if(i&&l>=0){if(l&1024)return!0;if(l&16)return r?Cte(r,o,c):!!o;if(l&8){const h=e.dynamicProps;for(let p=0;p<h.length;p++){const f=h[p];if(o[f]!==r[f]&&!C6(c,f))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:r===o?!1:r?o?Cte(r,o,c):!0:!!o;return!1}function Cte(t,e,i){const r=Object.keys(e);if(r.length!==Object.keys(t).length)return!0;for(let s=0;s<r.length;s++){const n=r[s];if(e[n]!==t[n]&&!C6(i,n))return!0}return!1}function T$e({vnode:t,parent:e},i){for(;e&&e.subTree===t;)(t=e.vnode).el=i,e=e.parent}const S$e=t=>t.__isSuspense;function E$e(t,e){e&&e.pendingBranch?Zi(t)?e.effects.push(...t):e.effects.push(t):f$e(t)}function C$e(t,e){if(ho){let i=ho.provides;const r=ho.parent&&ho.parent.provides;r===i&&(i=ho.provides=Object.create(r)),i[t]=e}}function ZD(t,e,i=!1){const r=ho||Cp;if(r){const s=r.parent==null?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides;if(s&&t in s)return s[t];if(arguments.length>1)return i&&rr(e)?e.call(r.proxy):e}}const YI={};function cV(t,e,i){return Nfe(t,e,i)}function Nfe(t,e,{immediate:i,deep:r,flush:s,onTrack:n,onTrigger:o}=an){const a=MIe()===(ho==null?void 0:ho.scope)?ho:null;let l,c=!1,h=!1;if(rc(t)?(l=()=>t.value,c=Dz(t)):uE(t)?(l=()=>t,r=!0):Zi(t)?(h=!0,c=t.some(T=>uE(T)||Dz(T)),l=()=>t.map(T=>{if(rc(T))return T.value;if(uE(T))return VS(T);if(rr(T))return Mv(T,a,2)})):rr(t)?e?l=()=>Mv(t,a,2):l=()=>{if(!(a&&a.isUnmounted))return p&&p(),nd(t,a,3,[f])}:l=Vp,e&&r){const T=l;l=()=>VS(T())}let p,f=T=>{p=w.onStop=()=>{Mv(T,a,4)}},m;if(E3)if(f=Vp,e?i&&nd(e,a,3,[l(),h?[]:void 0,f]):l(),s==="sync"){const T=SLe();m=T.__watcherHandles||(T.__watcherHandles=[])}else return Vp;let y=h?new Array(t.length).fill(YI):YI;const _=()=>{if(w.active)if(e){const T=w.run();(r||c||(h?T.some((E,O)=>KF(E,y[O])):KF(T,y)))&&(p&&p(),nd(e,a,3,[T,y===YI?void 0:h&&y[0]===YI?[]:y,f]),y=T)}else w.run()};_.allowRecurse=!!e;let b;s==="sync"?b=_:s==="post"?b=()=>Lc(_,a&&a.suspense):(_.pre=!0,a&&(_.id=a.uid),b=()=>xY(_));const w=new pY(l,b);e?i?_():y=w.run():s==="post"?Lc(w.run.bind(w),a&&a.suspense):w.run();const S=()=>{w.stop(),a&&a.scope&&cY(a.scope.effects,w)};return m&&m.push(S),S}function A$e(t,e,i){const r=this.proxy,s=Ia(t)?t.includes(".")?Ffe(r,t):()=>r[t]:t.bind(r,r);let n;rr(e)?n=e:(n=e.handler,i=e);const o=ho;HE(this);const a=Nfe(s,n.bind(r),i);return o?HE(o):ix(),a}function Ffe(t,e){const i=e.split(".");return()=>{let r=t;for(let s=0;s<i.length&&r;s++)r=r[i[s]];return r}}function VS(t,e){if(!bo(t)||t.__v_skip||(e=e||new Set,e.has(t)))return t;if(e.add(t),rc(t))VS(t.value,e);else if(Zi(t))for(let i=0;i<t.length;i++)VS(t[i],e);else if(bIe(t)||bM(t))t.forEach(i=>{VS(i,e)});else if(TIe(t))for(const i in t)VS(t[i],e);return t}function O$e(){const t={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Bfe(()=>{t.isMounted=!0}),zfe(()=>{t.isUnmounting=!0}),t}const ah=[Function,Array],R$e={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:ah,onEnter:ah,onAfterEnter:ah,onEnterCancelled:ah,onBeforeLeave:ah,onLeave:ah,onAfterLeave:ah,onLeaveCancelled:ah,onBeforeAppear:ah,onAppear:ah,onAfterAppear:ah,onAppearCancelled:ah},setup(t,{slots:e}){const i=gLe(),r=O$e();let s;return()=>{const n=e.default&&Vfe(e.default(),!0);if(!n||!n.length)return;let o=n[0];if(n.length>1){for(const _ of n)if(_.type!==Ty){o=_;break}}const a=Zr(t),{mode:l}=a;if(r.isLeaving)return uV(o);const c=Ate(o);if(!c)return uV(o);const h=Fz(c,a,r,i);Uz(c,h);const p=i.subTree,f=p&&Ate(p);let m=!1;const{getTransitionKey:y}=c.type;if(y){const _=y();s===void 0?s=_:_!==s&&(s=_,m=!0)}if(f&&f.type!==Ty&&(!bw(c,f)||m)){const _=Fz(f,a,r,i);if(Uz(f,_),l==="out-in")return r.isLeaving=!0,_.afterLeave=()=>{r.isLeaving=!1,i.update.active!==!1&&i.update()},uV(o);l==="in-out"&&c.type!==Ty&&(_.delayLeave=(b,w,S)=>{const T=Ufe(r,f);T[String(f.key)]=f,b._leaveCb=()=>{w(),b._leaveCb=void 0,delete h.delayedLeave},h.delayedLeave=S})}return o}}},M$e=R$e;function Ufe(t,e){const{leavingVNodes:i}=t;let r=i.get(e.type);return r||(r=Object.create(null),i.set(e.type,r)),r}function Fz(t,e,i,r){const{appear:s,mode:n,persisted:o=!1,onBeforeEnter:a,onEnter:l,onAfterEnter:c,onEnterCancelled:h,onBeforeLeave:p,onLeave:f,onAfterLeave:m,onLeaveCancelled:y,onBeforeAppear:_,onAppear:b,onAfterAppear:w,onAppearCancelled:S}=e,T=String(t.key),E=Ufe(i,t),O=(P,F)=>{P&&nd(P,r,9,F)},R=(P,F)=>{const V=F[1];O(P,F),Zi(P)?P.every(B=>B.length<=1)&&V():P.length<=1&&V()},L={mode:n,persisted:o,beforeEnter(P){let F=a;if(!i.isMounted)if(s)F=_||a;else return;P._leaveCb&&P._leaveCb(!0);const V=E[T];V&&bw(t,V)&&V.el._leaveCb&&V.el._leaveCb(),O(F,[P])},enter(P){let F=l,V=c,B=h;if(!i.isMounted)if(s)F=b||l,V=w||c,B=S||h;else return;let G=!1;const te=P._enterCb=se=>{G||(G=!0,se?O(B,[P]):O(V,[P]),L.delayedLeave&&L.delayedLeave(),P._enterCb=void 0)};F?R(F,[P,te]):te()},leave(P,F){const V=String(t.key);if(P._enterCb&&P._enterCb(!0),i.isUnmounting)return F();O(p,[P]);let B=!1;const G=P._leaveCb=te=>{B||(B=!0,F(),te?O(y,[P]):O(m,[P]),P._leaveCb=void 0,E[V]===t&&delete E[V])};E[V]=t,f?R(f,[P,G]):G()},clone(P){return Fz(P,e,i,r)}};return L}function uV(t){if(O6(t))return t=Hv(t),t.children=null,t}function Ate(t){return O6(t)?t.children?t.children[0]:void 0:t}function Uz(t,e){t.shapeFlag&6&&t.component?Uz(t.component.subTree,e):t.shapeFlag&128?(t.ssContent.transition=e.clone(t.ssContent),t.ssFallback.transition=e.clone(t.ssFallback)):t.transition=e}function Vfe(t,e=!1,i){let r=[],s=0;for(let n=0;n<t.length;n++){let o=t[n];const a=i==null?o.key:String(i)+String(o.key!=null?o.key:n);o.type===bp?(o.patchFlag&128&&s++,r=r.concat(Vfe(o.children,e,a))):(e||o.type!==Ty)&&r.push(a!=null?Hv(o,{key:a}):o)}if(s>1)for(let n=0;n<r.length;n++)r[n].patchFlag=-2;return r}const JD=t=>!!t.type.__asyncLoader,O6=t=>t.type.__isKeepAlive;function P$e(t,e){kfe(t,"a",e)}function I$e(t,e){kfe(t,"da",e)}function kfe(t,e,i=ho){const r=t.__wdc||(t.__wdc=()=>{let s=i;for(;s;){if(s.isDeactivated)return;s=s.parent}return t()});if(R6(e,r,i),i){let s=i.parent;for(;s&&s.parent;)O6(s.parent.vnode)&&$$e(r,e,i,s),s=s.parent}}function $$e(t,e,i,r){const s=R6(e,t,r,!0);Gfe(()=>{cY(r[e],s)},i)}function R6(t,e,i=ho,r=!1){if(i){const s=i[t]||(i[t]=[]),n=e.__weh||(e.__weh=(...o)=>{if(i.isUnmounted)return;qC(),HE(i);const a=nd(e,i,t,o);return ix(),WC(),a});return r?s.unshift(n):s.push(n),n}}const t0=t=>(e,i=ho)=>(!E3||t==="sp")&&R6(t,(...r)=>e(...r),i),L$e=t0("bm"),Bfe=t0("m"),D$e=t0("bu"),N$e=t0("u"),zfe=t0("bum"),Gfe=t0("um"),F$e=t0("sp"),U$e=t0("rtg"),V$e=t0("rtc");function k$e(t,e=ho){R6("ec",t,e)}function O1(t,e,i,r){const s=t.dirs,n=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];n&&(a.oldValue=n[o].value);let l=a.dir[r];l&&(qC(),nd(l,i,8,[t.el,a,t,e]),WC())}}const B$e=Symbol(),Vz=t=>t?tme(t)?CY(t)||t.proxy:Vz(t.parent):null,wM=fl(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>Vz(t.parent),$root:t=>Vz(t.root),$emit:t=>t.emit,$options:t=>TY(t),$forceUpdate:t=>t.f||(t.f=()=>xY(t.update)),$nextTick:t=>t.n||(t.n=h$e.bind(t.proxy)),$watch:t=>A$e.bind(t)}),hV=(t,e)=>t!==an&&!t.__isScriptSetup&&Tr(t,e),z$e={get({_:t},e){const{ctx:i,setupState:r,data:s,props:n,accessCache:o,type:a,appContext:l}=t;let c;if(e[0]!=="$"){const m=o[e];if(m!==void 0)switch(m){case 1:return r[e];case 2:return s[e];case 4:return i[e];case 3:return n[e]}else{if(hV(r,e))return o[e]=1,r[e];if(s!==an&&Tr(s,e))return o[e]=2,s[e];if((c=t.propsOptions[0])&&Tr(c,e))return o[e]=3,n[e];if(i!==an&&Tr(i,e))return o[e]=4,i[e];kz&&(o[e]=0)}}const h=wM[e];let p,f;if(h)return e==="$attrs"&&eu(t,"get",e),h(t);if((p=a.__cssModules)&&(p=p[e]))return p;if(i!==an&&Tr(i,e))return o[e]=4,i[e];if(f=l.config.globalProperties,Tr(f,e))return f[e]},set({_:t},e,i){const{data:r,setupState:s,ctx:n}=t;return hV(s,e)?(s[e]=i,!0):r!==an&&Tr(r,e)?(r[e]=i,!0):Tr(t.props,e)||e[0]==="$"&&e.slice(1)in t?!1:(n[e]=i,!0)},has({_:{data:t,setupState:e,accessCache:i,ctx:r,appContext:s,propsOptions:n}},o){let a;return!!i[o]||t!==an&&Tr(t,o)||hV(e,o)||(a=n[0])&&Tr(a,o)||Tr(r,o)||Tr(wM,o)||Tr(s.config.globalProperties,o)},defineProperty(t,e,i){return i.get!=null?t._.accessCache[e]=0:Tr(i,"value")&&this.set(t,e,i.value,null),Reflect.defineProperty(t,e,i)}};let kz=!0;function G$e(t){const e=TY(t),i=t.proxy,r=t.ctx;kz=!1,e.beforeCreate&&Ote(e.beforeCreate,t,"bc");const{data:s,computed:n,methods:o,watch:a,provide:l,inject:c,created:h,beforeMount:p,mounted:f,beforeUpdate:m,updated:y,activated:_,deactivated:b,beforeDestroy:w,beforeUnmount:S,destroyed:T,unmounted:E,render:O,renderTracked:R,renderTriggered:L,errorCaptured:P,serverPrefetch:F,expose:V,inheritAttrs:B,components:G,directives:te,filters:se}=e;if(c&&j$e(c,r,null,t.appContext.config.unwrapInjectedRef),o)for(const $ in o){const N=o[$];rr(N)&&(r[$]=N.bind(i))}if(s){const $=s.call(i,i);bo($)&&(t.data=yY($))}if(kz=!0,n)for(const $ in n){const N=n[$],U=rr(N)?N.bind(i,i):rr(N.get)?N.get.bind(i,i):Vp,q=!rr(N)&&rr(N.set)?N.set.bind(i):Vp,Y=xLe({get:U,set:q});Object.defineProperty(r,$,{enumerable:!0,configurable:!0,get:()=>Y.value,set:Q=>Y.value=Q})}if(a)for(const $ in a)jfe(a[$],r,i,$);if(l){const $=rr(l)?l.call(i):l;Reflect.ownKeys($).forEach(N=>{C$e(N,$[N])})}h&&Ote(h,t,"c");function H($,N){Zi(N)?N.forEach(U=>$(U.bind(i))):N&&$(N.bind(i))}if(H(L$e,p),H(Bfe,f),H(D$e,m),H(N$e,y),H(P$e,_),H(I$e,b),H(k$e,P),H(V$e,R),H(U$e,L),H(zfe,S),H(Gfe,E),H(F$e,F),Zi(V))if(V.length){const $=t.exposed||(t.exposed={});V.forEach(N=>{Object.defineProperty($,N,{get:()=>i[N],set:U=>i[N]=U})})}else t.exposed||(t.exposed={});O&&t.render===Vp&&(t.render=O),B!=null&&(t.inheritAttrs=B),G&&(t.components=G),te&&(t.directives=te)}function j$e(t,e,i=Vp,r=!1){Zi(t)&&(t=Bz(t));for(const s in t){const n=t[s];let o;bo(n)?"default"in n?o=ZD(n.from||s,n.default,!0):o=ZD(n.from||s):o=ZD(n),rc(o)&&r?Object.defineProperty(e,s,{enumerable:!0,configurable:!0,get:()=>o.value,set:a=>o.value=a}):e[s]=o}}function Ote(t,e,i){nd(Zi(t)?t.map(r=>r.bind(e.proxy)):t.bind(e.proxy),e,i)}function jfe(t,e,i,r){const s=r.includes(".")?Ffe(i,r):()=>i[r];if(Ia(t)){const n=e[t];rr(n)&&cV(s,n)}else if(rr(t))cV(s,t.bind(i));else if(bo(t))if(Zi(t))t.forEach(n=>jfe(n,e,i,r));else{const n=rr(t.handler)?t.handler.bind(i):e[t.handler];rr(n)&&cV(s,n,t)}}function TY(t){const e=t.type,{mixins:i,extends:r}=e,{mixins:s,optionsCache:n,config:{optionMergeStrategies:o}}=t.appContext,a=n.get(e);let l;return a?l=a:!s.length&&!i&&!r?l=e:(l={},s.length&&s.forEach(c=>t4(l,c,o,!0)),t4(l,e,o)),bo(e)&&n.set(e,l),l}function t4(t,e,i,r=!1){const{mixins:s,extends:n}=e;n&&t4(t,n,i,!0),s&&s.forEach(o=>t4(t,o,i,!0));for(const o in e)if(!(r&&o==="expose")){const a=H$e[o]||i&&i[o];t[o]=a?a(t[o],e[o]):e[o]}return t}const H$e={data:Rte,props:gb,emits:gb,methods:gb,computed:gb,beforeCreate:Dl,created:Dl,beforeMount:Dl,mounted:Dl,beforeUpdate:Dl,updated:Dl,beforeDestroy:Dl,beforeUnmount:Dl,destroyed:Dl,unmounted:Dl,activated:Dl,deactivated:Dl,errorCaptured:Dl,serverPrefetch:Dl,components:gb,directives:gb,watch:W$e,provide:Rte,inject:q$e};function Rte(t,e){return e?t?function(){return fl(rr(t)?t.call(this,this):t,rr(e)?e.call(this,this):e)}:e:t}function q$e(t,e){return gb(Bz(t),Bz(e))}function Bz(t){if(Zi(t)){const e={};for(let i=0;i<t.length;i++)e[t[i]]=t[i];return e}return t}function Dl(t,e){return t?[...new Set([].concat(t,e))]:e}function gb(t,e){return t?fl(fl(Object.create(null),t),e):e}function W$e(t,e){if(!t)return e;if(!e)return t;const i=fl(Object.create(null),t);for(const r in e)i[r]=Dl(t[r],e[r]);return i}function X$e(t,e,i,r=!1){const s={},n={};QF(n,P6,1),t.propsDefaults=Object.create(null),Hfe(t,e,s,n);for(const o in t.propsOptions[0])o in s||(s[o]=void 0);i?t.props=r?s:r$e(s):t.type.props?t.props=s:t.props=n,t.attrs=n}function Y$e(t,e,i,r){const{props:s,attrs:n,vnode:{patchFlag:o}}=t,a=Zr(s),[l]=t.propsOptions;let c=!1;if((r||o>0)&&!(o&16)){if(o&8){const h=t.vnode.dynamicProps;for(let p=0;p<h.length;p++){let f=h[p];if(C6(t.emitsOptions,f))continue;const m=e[f];if(l)if(Tr(n,f))m!==n[f]&&(n[f]=m,c=!0);else{const y=jE(f);s[y]=zz(l,a,y,m,t,!1)}else m!==n[f]&&(n[f]=m,c=!0)}}}else{Hfe(t,e,s,n)&&(c=!0);let h;for(const p in a)(!e||!Tr(e,p)&&((h=HC(p))===p||!Tr(e,h)))&&(l?i&&(i[p]!==void 0||i[h]!==void 0)&&(s[p]=zz(l,a,p,void 0,t,!0)):delete s[p]);if(n!==a)for(const p in n)(!e||!Tr(e,p))&&(delete n[p],c=!0)}c&&Fy(t,"set","$attrs")}function Hfe(t,e,i,r){const[s,n]=t.propsOptions;let o=!1,a;if(e)for(let l in e){if(YD(l))continue;const c=e[l];let h;s&&Tr(s,h=jE(l))?!n||!n.includes(h)?i[h]=c:(a||(a={}))[h]=c:C6(t.emitsOptions,l)||(!(l in r)||c!==r[l])&&(r[l]=c,o=!0)}if(n){const l=Zr(i),c=a||an;for(let h=0;h<n.length;h++){const p=n[h];i[p]=zz(s,l,p,c[p],t,!Tr(c,p))}}return o}function zz(t,e,i,r,s,n){const o=t[i];if(o!=null){const a=Tr(o,"default");if(a&&r===void 0){const l=o.default;if(o.type!==Function&&rr(l)){const{propsDefaults:c}=s;i in c?r=c[i]:(HE(s),r=c[i]=l.call(null,e),ix())}else r=l}o[0]&&(n&&!a?r=!1:o[1]&&(r===""||r===HC(i))&&(r=!0))}return r}function qfe(t,e,i=!1){const r=e.propsCache,s=r.get(t);if(s)return s;const n=t.props,o={},a=[];let l=!1;if(!rr(t)){const h=p=>{l=!0;const[f,m]=qfe(p,e,!0);fl(o,f),m&&a.push(...m)};!i&&e.mixins.length&&e.mixins.forEach(h),t.extends&&h(t.extends),t.mixins&&t.mixins.forEach(h)}if(!n&&!l)return bo(t)&&r.set(t,cE),cE;if(Zi(n))for(let h=0;h<n.length;h++){const p=jE(n[h]);Mte(p)&&(o[p]=an)}else if(n)for(const h in n){const p=jE(h);if(Mte(p)){const f=n[h],m=o[p]=Zi(f)||rr(f)?{type:f}:Object.assign({},f);if(m){const y=$te(Boolean,m.type),_=$te(String,m.type);m[0]=y>-1,m[1]=_<0||y<_,(y>-1||Tr(m,"default"))&&a.push(p)}}}const c=[o,a];return bo(t)&&r.set(t,c),c}function Mte(t){return t[0]!=="$"}function Pte(t){const e=t&&t.toString().match(/^\s*(function|class) (\w+)/);return e?e[2]:t===null?"null":""}function Ite(t,e){return Pte(t)===Pte(e)}function $te(t,e){return Zi(e)?e.findIndex(i=>Ite(i,t)):rr(e)&&Ite(e,t)?0:-1}const Wfe=t=>t[0]==="_"||t==="$stable",SY=t=>Zi(t)?t.map(um):[um(t)],Z$e=(t,e,i)=>{if(e._n)return e;const r=v$e((...s)=>SY(e(...s)),i);return r._c=!1,r},Xfe=(t,e,i)=>{const r=t._ctx;for(const s in t){if(Wfe(s))continue;const n=t[s];if(rr(n))e[s]=Z$e(s,n,r);else if(n!=null){const o=SY(n);e[s]=()=>o}}},Yfe=(t,e)=>{const i=SY(e);t.slots.default=()=>i},J$e=(t,e)=>{if(t.vnode.shapeFlag&32){const i=e._;i?(t.slots=Zr(e),QF(e,"_",i)):Xfe(e,t.slots={})}else t.slots={},e&&Yfe(t,e);QF(t.slots,P6,1)},K$e=(t,e,i)=>{const{vnode:r,slots:s}=t;let n=!0,o=an;if(r.shapeFlag&32){const a=e._;a?i&&a===1?n=!1:(fl(s,e),!i&&a===1&&delete s._):(n=!e.$stable,Xfe(e,s)),o=e}else e&&(Yfe(t,e),o={default:1});if(n)for(const a in s)!Wfe(a)&&!(a in o)&&delete s[a]};function Zfe(){return{app:null,config:{isNativeTag:yIe,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Q$e=0;function eLe(t,e){return function(r,s=null){rr(r)||(r=Object.assign({},r)),s!=null&&!bo(s)&&(s=null);const n=Zfe(),o=new Set;let a=!1;const l=n.app={_uid:Q$e++,_component:r,_props:s,_container:null,_context:n,_instance:null,version:ELe,get config(){return n.config},set config(c){},use(c,...h){return o.has(c)||(c&&rr(c.install)?(o.add(c),c.install(l,...h)):rr(c)&&(o.add(c),c(l,...h))),l},mixin(c){return n.mixins.includes(c)||n.mixins.push(c),l},component(c,h){return h?(n.components[c]=h,l):n.components[c]},directive(c,h){return h?(n.directives[c]=h,l):n.directives[c]},mount(c,h,p){if(!a){const f=Pv(r,s);return f.appContext=n,h&&e?e(f,c):t(f,c,p),a=!0,l._container=c,c.__vue_app__=l,CY(f.component)||f.component.proxy}},unmount(){a&&(t(null,l._container),delete l._container.__vue_app__)},provide(c,h){return n.provides[c]=h,l}};return l}}function Gz(t,e,i,r,s=!1){if(Zi(t)){t.forEach((f,m)=>Gz(f,e&&(Zi(e)?e[m]:e),i,r,s));return}if(JD(r)&&!s)return;const n=r.shapeFlag&4?CY(r.component)||r.component.proxy:r.el,o=s?null:n,{i:a,r:l}=t,c=e&&e.r,h=a.refs===an?a.refs={}:a.refs,p=a.setupState;if(c!=null&&c!==l&&(Ia(c)?(h[c]=null,Tr(p,c)&&(p[c]=null)):rc(c)&&(c.value=null)),rr(l))Mv(l,a,12,[o,h]);else{const f=Ia(l),m=rc(l);if(f||m){const y=()=>{if(t.f){const _=f?Tr(p,l)?p[l]:h[l]:l.value;s?Zi(_)&&cY(_,n):Zi(_)?_.includes(n)||_.push(n):f?(h[l]=[n],Tr(p,l)&&(p[l]=h[l])):(l.value=[n],t.k&&(h[t.k]=l.value))}else f?(h[l]=o,Tr(p,l)&&(p[l]=o)):m&&(l.value=o,t.k&&(h[t.k]=o))};o?(y.id=-1,Lc(y,i)):y()}}}const Lc=E$e;function tLe(t){return iLe(t)}function iLe(t,e){const i=AIe();i.__VUE__=!0;const{insert:r,remove:s,patchProp:n,createElement:o,createText:a,createComment:l,setText:c,setElementText:h,parentNode:p,nextSibling:f,setScopeId:m=Vp,insertStaticContent:y}=t,_=(j,J,ne,ge=null,_e=null,Ce=null,Le=!1,Re=null,Ue=!!J.dynamicChildren)=>{if(j===J)return;j&&!bw(j,J)&&(ge=De(j),Q(j,_e,Ce,!0),j=null),J.patchFlag===-2&&(Ue=!1,J.dynamicChildren=null);const{type:Te,ref:Ze,shapeFlag:Se}=J;switch(Te){case M6:b(j,J,ne,ge);break;case Ty:w(j,J,ne,ge);break;case dV:j==null&&S(J,ne,ge,Le);break;case bp:G(j,J,ne,ge,_e,Ce,Le,Re,Ue);break;default:Se&1?O(j,J,ne,ge,_e,Ce,Le,Re,Ue):Se&6?te(j,J,ne,ge,_e,Ce,Le,Re,Ue):(Se&64||Se&128)&&Te.process(j,J,ne,ge,_e,Ce,Le,Re,Ue,qe)}Ze!=null&&_e&&Gz(Ze,j&&j.ref,Ce,J||j,!J)},b=(j,J,ne,ge)=>{if(j==null)r(J.el=a(J.children),ne,ge);else{const _e=J.el=j.el;J.children!==j.children&&c(_e,J.children)}},w=(j,J,ne,ge)=>{j==null?r(J.el=l(J.children||""),ne,ge):J.el=j.el},S=(j,J,ne,ge)=>{[j.el,j.anchor]=y(j.children,J,ne,ge,j.el,j.anchor)},T=({el:j,anchor:J},ne,ge)=>{let _e;for(;j&&j!==J;)_e=f(j),r(j,ne,ge),j=_e;r(J,ne,ge)},E=({el:j,anchor:J})=>{let ne;for(;j&&j!==J;)ne=f(j),s(j),j=ne;s(J)},O=(j,J,ne,ge,_e,Ce,Le,Re,Ue)=>{Le=Le||J.type==="svg",j==null?R(J,ne,ge,_e,Ce,Le,Re,Ue):F(j,J,_e,Ce,Le,Re,Ue)},R=(j,J,ne,ge,_e,Ce,Le,Re)=>{let Ue,Te;const{type:Ze,props:Se,shapeFlag:Ee,transition:Ne,dirs:Ge}=j;if(Ue=j.el=o(j.type,Ce,Se&&Se.is,Se),Ee&8?h(Ue,j.children):Ee&16&&P(j.children,Ue,null,ge,_e,Ce&&Ze!=="foreignObject",Le,Re),Ge&&O1(j,null,ge,"created"),L(Ue,j,j.scopeId,Le,ge),Se){for(const dt in Se)dt!=="value"&&!YD(dt)&&n(Ue,dt,null,Se[dt],Ce,j.children,ge,_e,xe);"value"in Se&&n(Ue,"value",null,Se.value),(Te=Se.onVnodeBeforeMount)&&df(Te,ge,j)}Ge&&O1(j,null,ge,"beforeMount");const tt=(!_e||_e&&!_e.pendingBranch)&&Ne&&!Ne.persisted;tt&&Ne.beforeEnter(Ue),r(Ue,J,ne),((Te=Se&&Se.onVnodeMounted)||tt||Ge)&&Lc(()=>{Te&&df(Te,ge,j),tt&&Ne.enter(Ue),Ge&&O1(j,null,ge,"mounted")},_e)},L=(j,J,ne,ge,_e)=>{if(ne&&m(j,ne),ge)for(let Ce=0;Ce<ge.length;Ce++)m(j,ge[Ce]);if(_e){let Ce=_e.subTree;if(J===Ce){const Le=_e.vnode;L(j,Le,Le.scopeId,Le.slotScopeIds,_e.parent)}}},P=(j,J,ne,ge,_e,Ce,Le,Re,Ue=0)=>{for(let Te=Ue;Te<j.length;Te++){const Ze=j[Te]=Re?q_(j[Te]):um(j[Te]);_(null,Ze,J,ne,ge,_e,Ce,Le,Re)}},F=(j,J,ne,ge,_e,Ce,Le)=>{const Re=J.el=j.el;let{patchFlag:Ue,dynamicChildren:Te,dirs:Ze}=J;Ue|=j.patchFlag&16;const Se=j.props||an,Ee=J.props||an;let Ne;ne&&R1(ne,!1),(Ne=Ee.onVnodeBeforeUpdate)&&df(Ne,ne,J,j),Ze&&O1(J,j,ne,"beforeUpdate"),ne&&R1(ne,!0);const Ge=_e&&J.type!=="foreignObject";if(Te?V(j.dynamicChildren,Te,Re,ne,ge,Ge,Ce):Le||N(j,J,Re,null,ne,ge,Ge,Ce,!1),Ue>0){if(Ue&16)B(Re,J,Se,Ee,ne,ge,_e);else if(Ue&2&&Se.class!==Ee.class&&n(Re,"class",null,Ee.class,_e),Ue&4&&n(Re,"style",Se.style,Ee.style,_e),Ue&8){const tt=J.dynamicProps;for(let dt=0;dt<tt.length;dt++){const Ft=tt[dt],ti=Se[Ft],yi=Ee[Ft];(yi!==ti||Ft==="value")&&n(Re,Ft,ti,yi,_e,j.children,ne,ge,xe)}}Ue&1&&j.children!==J.children&&h(Re,J.children)}else!Le&&Te==null&&B(Re,J,Se,Ee,ne,ge,_e);((Ne=Ee.onVnodeUpdated)||Ze)&&Lc(()=>{Ne&&df(Ne,ne,J,j),Ze&&O1(J,j,ne,"updated")},ge)},V=(j,J,ne,ge,_e,Ce,Le)=>{for(let Re=0;Re<J.length;Re++){const Ue=j[Re],Te=J[Re],Ze=Ue.el&&(Ue.type===bp||!bw(Ue,Te)||Ue.shapeFlag&70)?p(Ue.el):ne;_(Ue,Te,Ze,null,ge,_e,Ce,Le,!0)}},B=(j,J,ne,ge,_e,Ce,Le)=>{if(ne!==ge){if(ne!==an)for(const Re in ne)!YD(Re)&&!(Re in ge)&&n(j,Re,ne[Re],null,Le,J.children,_e,Ce,xe);for(const Re in ge){if(YD(Re))continue;const Ue=ge[Re],Te=ne[Re];Ue!==Te&&Re!=="value"&&n(j,Re,Te,Ue,Le,J.children,_e,Ce,xe)}"value"in ge&&n(j,"value",ne.value,ge.value)}},G=(j,J,ne,ge,_e,Ce,Le,Re,Ue)=>{const Te=J.el=j?j.el:a(""),Ze=J.anchor=j?j.anchor:a("");let{patchFlag:Se,dynamicChildren:Ee,slotScopeIds:Ne}=J;Ne&&(Re=Re?Re.concat(Ne):Ne),j==null?(r(Te,ne,ge),r(Ze,ne,ge),P(J.children,ne,Ze,_e,Ce,Le,Re,Ue)):Se>0&&Se&64&&Ee&&j.dynamicChildren?(V(j.dynamicChildren,Ee,ne,_e,Ce,Le,Re),(J.key!=null||_e&&J===_e.subTree)&&Jfe(j,J,!0)):N(j,J,ne,Ze,_e,Ce,Le,Re,Ue)},te=(j,J,ne,ge,_e,Ce,Le,Re,Ue)=>{J.slotScopeIds=Re,j==null?J.shapeFlag&512?_e.ctx.activate(J,ne,ge,Le,Ue):se(J,ne,ge,_e,Ce,Le,Ue):ie(j,J,Ue)},se=(j,J,ne,ge,_e,Ce,Le)=>{const Re=j.component=mLe(j,ge,_e);if(O6(j)&&(Re.ctx.renderer=qe),yLe(Re),Re.asyncDep){if(_e&&_e.registerDep(Re,H),!j.el){const Ue=Re.subTree=Pv(Ty);w(null,Ue,J,ne)}return}H(Re,j,J,ne,_e,Ce,Le)},ie=(j,J,ne)=>{const ge=J.component=j.component;if(x$e(j,J,ne))if(ge.asyncDep&&!ge.asyncResolved){$(ge,J,ne);return}else ge.next=J,p$e(ge.update),ge.update();else J.el=j.el,ge.vnode=J},H=(j,J,ne,ge,_e,Ce,Le)=>{const Re=()=>{if(j.isMounted){let{next:Ze,bu:Se,u:Ee,parent:Ne,vnode:Ge}=j,tt=Ze,dt;R1(j,!1),Ze?(Ze.el=Ge.el,$(j,Ze,Le)):Ze=Ge,Se&&aV(Se),(dt=Ze.props&&Ze.props.onVnodeBeforeUpdate)&&df(dt,Ne,Ze,Ge),R1(j,!0);const Ft=lV(j),ti=j.subTree;j.subTree=Ft,_(ti,Ft,p(ti.el),De(ti),j,_e,Ce),Ze.el=Ft.el,tt===null&&T$e(j,Ft.el),Ee&&Lc(Ee,_e),(dt=Ze.props&&Ze.props.onVnodeUpdated)&&Lc(()=>df(dt,Ne,Ze,Ge),_e)}else{let Ze;const{el:Se,props:Ee}=J,{bm:Ne,m:Ge,parent:tt}=j,dt=JD(J);if(R1(j,!1),Ne&&aV(Ne),!dt&&(Ze=Ee&&Ee.onVnodeBeforeMount)&&df(Ze,tt,J),R1(j,!0),Se&&Ye){const Ft=()=>{j.subTree=lV(j),Ye(Se,j.subTree,j,_e,null)};dt?J.type.__asyncLoader().then(()=>!j.isUnmounted&&Ft()):Ft()}else{const Ft=j.subTree=lV(j);_(null,Ft,ne,ge,j,_e,Ce),J.el=Ft.el}if(Ge&&Lc(Ge,_e),!dt&&(Ze=Ee&&Ee.onVnodeMounted)){const Ft=J;Lc(()=>df(Ze,tt,Ft),_e)}(J.shapeFlag&256||tt&&JD(tt.vnode)&&tt.vnode.shapeFlag&256)&&j.a&&Lc(j.a,_e),j.isMounted=!0,J=ne=ge=null}},Ue=j.effect=new pY(Re,()=>xY(Te),j.scope),Te=j.update=()=>Ue.run();Te.id=j.uid,R1(j,!0),Te()},$=(j,J,ne)=>{J.component=j;const ge=j.vnode.props;j.vnode=J,j.next=null,Y$e(j,J.props,ge,ne),K$e(j,J.children,ne),qC(),Ete(),WC()},N=(j,J,ne,ge,_e,Ce,Le,Re,Ue=!1)=>{const Te=j&&j.children,Ze=j?j.shapeFlag:0,Se=J.children,{patchFlag:Ee,shapeFlag:Ne}=J;if(Ee>0){if(Ee&128){q(Te,Se,ne,ge,_e,Ce,Le,Re,Ue);return}else if(Ee&256){U(Te,Se,ne,ge,_e,Ce,Le,Re,Ue);return}}Ne&8?(Ze&16&&xe(Te,_e,Ce),Se!==Te&&h(ne,Se)):Ze&16?Ne&16?q(Te,Se,ne,ge,_e,Ce,Le,Re,Ue):xe(Te,_e,Ce,!0):(Ze&8&&h(ne,""),Ne&16&&P(Se,ne,ge,_e,Ce,Le,Re,Ue))},U=(j,J,ne,ge,_e,Ce,Le,Re,Ue)=>{j=j||cE,J=J||cE;const Te=j.length,Ze=J.length,Se=Math.min(Te,Ze);let Ee;for(Ee=0;Ee<Se;Ee++){const Ne=J[Ee]=Ue?q_(J[Ee]):um(J[Ee]);_(j[Ee],Ne,ne,null,_e,Ce,Le,Re,Ue)}Te>Ze?xe(j,_e,Ce,!0,!1,Se):P(J,ne,ge,_e,Ce,Le,Re,Ue,Se)},q=(j,J,ne,ge,_e,Ce,Le,Re,Ue)=>{let Te=0;const Ze=J.length;let Se=j.length-1,Ee=Ze-1;for(;Te<=Se&&Te<=Ee;){const Ne=j[Te],Ge=J[Te]=Ue?q_(J[Te]):um(J[Te]);if(bw(Ne,Ge))_(Ne,Ge,ne,null,_e,Ce,Le,Re,Ue);else break;Te++}for(;Te<=Se&&Te<=Ee;){const Ne=j[Se],Ge=J[Ee]=Ue?q_(J[Ee]):um(J[Ee]);if(bw(Ne,Ge))_(Ne,Ge,ne,null,_e,Ce,Le,Re,Ue);else break;Se--,Ee--}if(Te>Se){if(Te<=Ee){const Ne=Ee+1,Ge=Ne<Ze?J[Ne].el:ge;for(;Te<=Ee;)_(null,J[Te]=Ue?q_(J[Te]):um(J[Te]),ne,Ge,_e,Ce,Le,Re,Ue),Te++}}else if(Te>Ee)for(;Te<=Se;)Q(j[Te],_e,Ce,!0),Te++;else{const Ne=Te,Ge=Te,tt=new Map;for(Te=Ge;Te<=Ee;Te++){const qt=J[Te]=Ue?q_(J[Te]):um(J[Te]);qt.key!=null&&tt.set(qt.key,Te)}let dt,Ft=0;const ti=Ee-Ge+1;let yi=!1,Ri=0;const Qi=new Array(ti);for(Te=0;Te<ti;Te++)Qi[Te]=0;for(Te=Ne;Te<=Se;Te++){const qt=j[Te];if(Ft>=ti){Q(qt,_e,Ce,!0);continue}let Jt;if(qt.key!=null)Jt=tt.get(qt.key);else for(dt=Ge;dt<=Ee;dt++)if(Qi[dt-Ge]===0&&bw(qt,J[dt])){Jt=dt;break}Jt===void 0?Q(qt,_e,Ce,!0):(Qi[Jt-Ge]=Te+1,Jt>=Ri?Ri=Jt:yi=!0,_(qt,J[Jt],ne,null,_e,Ce,Le,Re,Ue),Ft++)}const ri=yi?rLe(Qi):cE;for(dt=ri.length-1,Te=ti-1;Te>=0;Te--){const qt=Ge+Te,Jt=J[qt],Qr=qt+1<Ze?J[qt+1].el:ge;Qi[Te]===0?_(null,Jt,ne,Qr,_e,Ce,Le,Re,Ue):yi&&(dt<0||Te!==ri[dt]?Y(Jt,ne,Qr,2):dt--)}}},Y=(j,J,ne,ge,_e=null)=>{const{el:Ce,type:Le,transition:Re,children:Ue,shapeFlag:Te}=j;if(Te&6){Y(j.component.subTree,J,ne,ge);return}if(Te&128){j.suspense.move(J,ne,ge);return}if(Te&64){Le.move(j,J,ne,qe);return}if(Le===bp){r(Ce,J,ne);for(let Se=0;Se<Ue.length;Se++)Y(Ue[Se],J,ne,ge);r(j.anchor,J,ne);return}if(Le===dV){T(j,J,ne);return}if(ge!==2&&Te&1&&Re)if(ge===0)Re.beforeEnter(Ce),r(Ce,J,ne),Lc(()=>Re.enter(Ce),_e);else{const{leave:Se,delayLeave:Ee,afterLeave:Ne}=Re,Ge=()=>r(Ce,J,ne),tt=()=>{Se(Ce,()=>{Ge(),Ne&&Ne()})};Ee?Ee(Ce,Ge,tt):tt()}else r(Ce,J,ne)},Q=(j,J,ne,ge=!1,_e=!1)=>{const{type:Ce,props:Le,ref:Re,children:Ue,dynamicChildren:Te,shapeFlag:Ze,patchFlag:Se,dirs:Ee}=j;if(Re!=null&&Gz(Re,null,ne,j,!0),Ze&256){J.ctx.deactivate(j);return}const Ne=Ze&1&&Ee,Ge=!JD(j);let tt;if(Ge&&(tt=Le&&Le.onVnodeBeforeUnmount)&&df(tt,J,j),Ze&6)ye(j.component,ne,ge);else{if(Ze&128){j.suspense.unmount(ne,ge);return}Ne&&O1(j,null,J,"beforeUnmount"),Ze&64?j.type.remove(j,J,ne,_e,qe,ge):Te&&(Ce!==bp||Se>0&&Se&64)?xe(Te,J,ne,!1,!0):(Ce===bp&&Se&384||!_e&&Ze&16)&&xe(Ue,J,ne),ge&&X(j)}(Ge&&(tt=Le&&Le.onVnodeUnmounted)||Ne)&&Lc(()=>{tt&&df(tt,J,j),Ne&&O1(j,null,J,"unmounted")},ne)},X=j=>{const{type:J,el:ne,anchor:ge,transition:_e}=j;if(J===bp){pe(ne,ge);return}if(J===dV){E(j);return}const Ce=()=>{s(ne),_e&&!_e.persisted&&_e.afterLeave&&_e.afterLeave()};if(j.shapeFlag&1&&_e&&!_e.persisted){const{leave:Le,delayLeave:Re}=_e,Ue=()=>Le(ne,Ce);Re?Re(j.el,Ce,Ue):Ue()}else Ce()},pe=(j,J)=>{let ne;for(;j!==J;)ne=f(j),s(j),j=ne;s(J)},ye=(j,J,ne)=>{const{bum:ge,scope:_e,update:Ce,subTree:Le,um:Re}=j;ge&&aV(ge),_e.stop(),Ce&&(Ce.active=!1,Q(Le,j,J,ne)),Re&&Lc(Re,J),Lc(()=>{j.isUnmounted=!0},J),J&&J.pendingBranch&&!J.isUnmounted&&j.asyncDep&&!j.asyncResolved&&j.suspenseId===J.pendingId&&(J.deps--,J.deps===0&&J.resolve())},xe=(j,J,ne,ge=!1,_e=!1,Ce=0)=>{for(let Le=Ce;Le<j.length;Le++)Q(j[Le],J,ne,ge,_e)},De=j=>j.shapeFlag&6?De(j.component.subTree):j.shapeFlag&128?j.suspense.next():f(j.anchor||j.el),rt=(j,J,ne)=>{j==null?J._vnode&&Q(J._vnode,null,null,!0):_(J._vnode||null,j,J,null,null,null,ne),Ete(),$fe(),J._vnode=j},qe={p:_,um:Q,m:Y,r:X,mt:se,mc:P,pc:N,pbc:V,n:De,o:t};let Pe,Ye;return e&&([Pe,Ye]=e(qe)),{render:rt,hydrate:Pe,createApp:eLe(rt,Pe)}}function R1({effect:t,update:e},i){t.allowRecurse=e.allowRecurse=i}function Jfe(t,e,i=!1){const r=t.children,s=e.children;if(Zi(r)&&Zi(s))for(let n=0;n<r.length;n++){const o=r[n];let a=s[n];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[n]=q_(s[n]),a.el=o.el),i||Jfe(o,a)),a.type===M6&&(a.el=o.el)}}function rLe(t){const e=t.slice(),i=[0];let r,s,n,o,a;const l=t.length;for(r=0;r<l;r++){const c=t[r];if(c!==0){if(s=i[i.length-1],t[s]<c){e[r]=s,i.push(r);continue}for(n=0,o=i.length-1;n<o;)a=n+o>>1,t[i[a]]<c?n=a+1:o=a;c<t[i[n]]&&(n>0&&(e[r]=i[n-1]),i[n]=r)}}for(n=i.length,o=i[n-1];n-- >0;)i[n]=o,o=e[o];return i}const sLe=t=>t.__isTeleport,bp=Symbol(void 0),M6=Symbol(void 0),Ty=Symbol(void 0),dV=Symbol(void 0),xM=[];let Ap=null;function Kfe(t=!1){xM.push(Ap=t?null:[])}function nLe(){xM.pop(),Ap=xM[xM.length-1]||null}let S3=1;function Lte(t){S3+=t}function Qfe(t){return t.dynamicChildren=S3>0?Ap||cE:null,nLe(),S3>0&&Ap&&Ap.push(t),t}function oLe(t,e,i,r,s,n){return Qfe(I6(t,e,i,r,s,n,!0))}function aLe(t,e,i,r,s){return Qfe(Pv(t,e,i,r,s,!0))}function lLe(t){return t?t.__v_isVNode===!0:!1}function bw(t,e){return t.type===e.type&&t.key===e.key}const P6="__vInternal",eme=({key:t})=>t??null,KD=({ref:t,ref_key:e,ref_for:i})=>t!=null?Ia(t)||rc(t)||rr(t)?{i:Cp,r:t,k:e,f:!!i}:t:null;function I6(t,e=null,i=null,r=0,s=null,n=t===bp?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&eme(e),ref:e&&KD(e),scopeId:A6,slotScopeIds:null,children:i,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:n,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:Cp};return a?(EY(l,i),n&128&&t.normalize(l)):i&&(l.shapeFlag|=Ia(i)?8:16),S3>0&&!o&&Ap&&(l.patchFlag>0||n&6)&&l.patchFlag!==32&&Ap.push(l),l}const Pv=cLe;function cLe(t,e=null,i=null,r=0,s=null,n=!1){if((!t||t===B$e)&&(t=Ty),lLe(t)){const a=Hv(t,e,!0);return i&&EY(a,i),S3>0&&!n&&Ap&&(a.shapeFlag&6?Ap[Ap.indexOf(t)]=a:Ap.push(a)),a.patchFlag|=-2,a}if(wLe(t)&&(t=t.__vccOpts),e){e=uLe(e);let{class:a,style:l}=e;a&&!Ia(a)&&(e.class=aY(a)),bo(l)&&(Afe(l)&&!Zi(l)&&(l=fl({},l)),e.style=oY(l))}const o=Ia(t)?1:S$e(t)?128:sLe(t)?64:bo(t)?4:rr(t)?2:0;return I6(t,e,i,r,s,o,n,!0)}function uLe(t){return t?Afe(t)||P6 in t?fl({},t):t:null}function Hv(t,e,i=!1){const{props:r,ref:s,patchFlag:n,children:o}=t,a=e?dLe(r||{},e):r;return{__v_isVNode:!0,__v_skip:!0,type:t.type,props:a,key:a&&eme(a),ref:e&&e.ref?i&&s?Zi(s)?s.concat(KD(e)):[s,KD(e)]:KD(e):s,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:o,target:t.target,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==bp?n===-1?16:n|16:n,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:t.transition,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&Hv(t.ssContent),ssFallback:t.ssFallback&&Hv(t.ssFallback),el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce}}function hLe(t=" ",e=0){return Pv(M6,null,t,e)}function um(t){return t==null||typeof t=="boolean"?Pv(Ty):Zi(t)?Pv(bp,null,t.slice()):typeof t=="object"?q_(t):Pv(M6,null,String(t))}function q_(t){return t.el===null&&t.patchFlag!==-1||t.memo?t:Hv(t)}function EY(t,e){let i=0;const{shapeFlag:r}=t;if(e==null)e=null;else if(Zi(e))i=16;else if(typeof e=="object")if(r&65){const s=e.default;s&&(s._c&&(s._d=!1),EY(t,s()),s._c&&(s._d=!0));return}else{i=32;const s=e._;!s&&!(P6 in e)?e._ctx=Cp:s===3&&Cp&&(Cp.slots._===1?e._=1:(e._=2,t.patchFlag|=1024))}else rr(e)?(e={default:e,_ctx:Cp},i=32):(e=String(e),r&64?(i=16,e=[hLe(e)]):i=8);t.children=e,t.shapeFlag|=i}function dLe(...t){const e={};for(let i=0;i<t.length;i++){const r=t[i];for(const s in r)if(s==="class")e.class!==r.class&&(e.class=aY([e.class,r.class]));else if(s==="style")e.style=oY([e.style,r.style]);else if(w6(s)){const n=e[s],o=r[s];o&&n!==o&&!(Zi(n)&&n.includes(o))&&(e[s]=n?[].concat(n,o):o)}else s!==""&&(e[s]=r[s])}return e}function df(t,e,i,r=null){nd(t,e,7,[i,r])}const pLe=Zfe();let fLe=0;function mLe(t,e,i){const r=t.type,s=(e?e.appContext:t.appContext)||pLe,n={uid:fLe++,vnode:t,type:r,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,scope:new OIe(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:qfe(r,s),emitsOptions:Dfe(r,s),emit:null,emitted:null,propsDefaults:an,inheritAttrs:r.inheritAttrs,ctx:an,data:an,props:an,attrs:an,slots:an,refs:an,setupState:an,setupContext:null,suspense:i,suspenseId:i?i.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return n.ctx={_:n},n.root=e?e.root:n,n.emit=g$e.bind(null,n),t.ce&&t.ce(n),n}let ho=null;const gLe=()=>ho||Cp,HE=t=>{ho=t,t.scope.on()},ix=()=>{ho&&ho.scope.off(),ho=null};function tme(t){return t.vnode.shapeFlag&4}let E3=!1;function yLe(t,e=!1){E3=e;const{props:i,children:r}=t.vnode,s=tme(t);X$e(t,i,s,e),J$e(t,r);const n=s?_Le(t,e):void 0;return E3=!1,n}function _Le(t,e){const i=t.type;t.accessCache=Object.create(null),t.proxy=Ofe(new Proxy(t.ctx,z$e));const{setup:r}=i;if(r){const s=t.setupContext=r.length>1?bLe(t):null;HE(t),qC();const n=Mv(r,t,0,[t.props,s]);if(WC(),ix(),ffe(n)){if(n.then(ix,ix),e)return n.then(o=>{Dte(t,o,e)}).catch(o=>{E6(o,t,0)});t.asyncDep=n}else Dte(t,n,e)}else ime(t,e)}function Dte(t,e,i){rr(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:bo(e)&&(t.setupState=Rfe(e)),ime(t,i)}let Nte;function ime(t,e,i){const r=t.type;if(!t.render){if(!e&&Nte&&!r.render){const s=r.template||TY(t).template;if(s){const{isCustomElement:n,compilerOptions:o}=t.appContext.config,{delimiters:a,compilerOptions:l}=r,c=fl(fl({isCustomElement:n,delimiters:a},o),l);r.render=Nte(s,c)}}t.render=r.render||Vp}HE(t),qC(),G$e(t),WC(),ix()}function vLe(t){return new Proxy(t.attrs,{get(e,i){return eu(t,"get","$attrs"),e[i]}})}function bLe(t){const e=r=>{t.exposed=r||{}};let i;return{get attrs(){return i||(i=vLe(t))},slots:t.slots,emit:t.emit,expose:e}}function CY(t){if(t.exposed)return t.exposeProxy||(t.exposeProxy=new Proxy(Rfe(Ofe(t.exposed)),{get(e,i){if(i in e)return e[i];if(i in wM)return wM[i](t)},has(e,i){return i in e||i in wM}}))}function wLe(t){return rr(t)&&"__vccOpts"in t}const xLe=(t,e)=>c$e(t,e,E3),TLe=Symbol(""),SLe=()=>ZD(TLe),ELe="3.2.47",CLe="http://www.w3.org/2000/svg",ww=typeof document<"u"?document:null,Fte=ww&&ww.createElement("template"),ALe={insert:(t,e,i)=>{e.insertBefore(t,i||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,i,r)=>{const s=e?ww.createElementNS(CLe,t):ww.createElement(t,i?{is:i}:void 0);return t==="select"&&r&&r.multiple!=null&&s.setAttribute("multiple",r.multiple),s},createText:t=>ww.createTextNode(t),createComment:t=>ww.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>ww.querySelector(t),setScopeId(t,e){t.setAttribute(e,"")},insertStaticContent(t,e,i,r,s,n){const o=i?i.previousSibling:e.lastChild;if(s&&(s===n||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),i),!(s===n||!(s=s.nextSibling)););else{Fte.innerHTML=r?`<svg>${t}</svg>`:t;const a=Fte.content;if(r){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,i)}return[o?o.nextSibling:e.firstChild,i?i.previousSibling:e.lastChild]}};function OLe(t,e,i){const r=t._vtc;r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?t.removeAttribute("class"):i?t.setAttribute("class",e):t.className=e}function RLe(t,e,i){const r=t.style,s=Ia(i);if(i&&!s){if(e&&!Ia(e))for(const n in e)i[n]==null&&jz(r,n,"");for(const n in i)jz(r,n,i[n])}else{const n=r.display;s?e!==i&&(r.cssText=i):e&&t.removeAttribute("style"),"_vod"in t&&(r.display=n)}}const Ute=/\s*!important$/;function jz(t,e,i){if(Zi(i))i.forEach(r=>jz(t,e,r));else if(i==null&&(i=""),e.startsWith("--"))t.setProperty(e,i);else{const r=MLe(t,e);Ute.test(i)?t.setProperty(HC(r),i.replace(Ute,""),"important"):t[r]=i}}const Vte=["Webkit","Moz","ms"],pV={};function MLe(t,e){const i=pV[e];if(i)return i;let r=jE(e);if(r!=="filter"&&r in t)return pV[e]=r;r=mfe(r);for(let s=0;s<Vte.length;s++){const n=Vte[s]+r;if(n in t)return pV[e]=n}return e}const kte="http://www.w3.org/1999/xlink";function PLe(t,e,i,r,s){if(r&&e.startsWith("xlink:"))i==null?t.removeAttributeNS(kte,e.slice(6,e.length)):t.setAttributeNS(kte,e,i);else{const n=gIe(e);i==null||n&&!pfe(i)?t.removeAttribute(e):t.setAttribute(e,n?"":i)}}function ILe(t,e,i,r,s,n,o){if(e==="innerHTML"||e==="textContent"){r&&o(r,s,n),t[e]=i??"";return}if(e==="value"&&t.tagName!=="PROGRESS"&&!t.tagName.includes("-")){t._value=i;const l=i??"";(t.value!==l||t.tagName==="OPTION")&&(t.value=l),i==null&&t.removeAttribute(e);return}let a=!1;if(i===""||i==null){const l=typeof t[e];l==="boolean"?i=pfe(i):i==null&&l==="string"?(i="",a=!0):l==="number"&&(i=0,a=!0)}try{t[e]=i}catch{}a&&t.removeAttribute(e)}function $Le(t,e,i,r){t.addEventListener(e,i,r)}function LLe(t,e,i,r){t.removeEventListener(e,i,r)}function DLe(t,e,i,r,s=null){const n=t._vei||(t._vei={}),o=n[e];if(r&&o)o.value=r;else{const[a,l]=NLe(e);if(r){const c=n[e]=VLe(r,s);$Le(t,a,c,l)}else o&&(LLe(t,a,o,l),n[e]=void 0)}}const Bte=/(?:Once|Passive|Capture)$/;function NLe(t){let e;if(Bte.test(t)){e={};let r;for(;r=t.match(Bte);)t=t.slice(0,t.length-r[0].length),e[r[0].toLowerCase()]=!0}return[t[2]===":"?t.slice(3):HC(t.slice(2)),e]}let fV=0;const FLe=Promise.resolve(),ULe=()=>fV||(FLe.then(()=>fV=0),fV=Date.now());function VLe(t,e){const i=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=i.attached)return;nd(kLe(r,i.value),e,5,[r])};return i.value=t,i.attached=ULe(),i}function kLe(t,e){if(Zi(e)){const i=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{i.call(t),t._stopped=!0},e.map(r=>s=>!s._stopped&&r&&r(s))}else return e}const zte=/^on[a-z]/,BLe=(t,e,i,r,s=!1,n,o,a,l)=>{e==="class"?OLe(t,r,s):e==="style"?RLe(t,i,r):w6(e)?lY(e)||DLe(t,e,i,r,o):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):zLe(t,e,r,s))?ILe(t,e,r,n,o,a,l):(e==="true-value"?t._trueValue=r:e==="false-value"&&(t._falseValue=r),PLe(t,e,r,s))};function zLe(t,e,i,r){return r?!!(e==="innerHTML"||e==="textContent"||e in t&&zte.test(e)&&rr(i)):e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&t.tagName==="INPUT"||e==="type"&&t.tagName==="TEXTAREA"||zte.test(e)&&Ia(i)?!1:e in t}const GLe={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};M$e.props;const jLe=fl({patchProp:BLe},ALe);let Gte;function HLe(){return Gte||(Gte=tLe(jLe))}const qLe=(...t)=>{const e=HLe().createApp(...t),{mount:i}=e;return e.mount=r=>{const s=WLe(r);if(!s)return;const n=e._component;!rr(n)&&!n.render&&!n.template&&(n.template=s.innerHTML),s.innerHTML="";const o=i(s,!1,s instanceof SVGElement);return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e};function WLe(t){return Ia(t)?document.querySelector(t):t}const XLe="modulepreload",YLe=function(t,e){return new URL(t,e).href},jte={},ee=function(e,i,r){if(!i||i.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(i.map(n=>{if(n=YLe(n,r),n in jte)return;jte[n]=!0;const o=n.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let h=s.length-1;h>=0;h--){const p=s[h];if(p.href===n&&(!o||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":XLe,o||(c.as="script",c.crossOrigin=""),c.href=n,document.head.appendChild(c),o)return new Promise((h,p)=>{c.addEventListener("load",h),c.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e())};function u(t,e,i,r){var s,n=arguments.length,o=n<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,i):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(o=(n<3?s(o):n>3?s(e,i,o):s(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o}function EOt(t){const e=[];return function*(){yield*e;for(const i of t)e.push(i),yield i}}function ZLe(t,e){for(const i of t)if(i!=null&&e(i))return i}function C3(t){return t!=null&&typeof t[Symbol.iterator]=="function"}const yb=null;function v(t){return t!=null}function C(t){return t==null}function go(t,e){return v(t)?e(t):yb}function COt(t){return t}function AOt(t){return t}function Jl(t,e){return $6(t,e),t}function $6(t,e){if(C(t))throw new Error(e??"value is None")}function Gt(t,e){return v(t)?t:typeof e=="function"?e():e}function Hte(t,e){return v(t)?t:e}function Je(t){return v(t)&&t.destroy(),null}function ft(t){return v(t)&&t.dispose(),null}function Rr(t){return v(t)&&t.remove(),null}function hd(t){return v(t)&&t.abort(),null}function Wr(t){return v(t)&&t.release(),null}function JLe(t,e,i){return v(t)&&v(e)?v(i)?i(t,e):t.equals(e):t===e}function yx(t){return null}function OOt(t,e){const i=new Array;return t.forEach(r=>{const s=e(r);v(s)&&i.push(s)}),i}function ROt(t,e){const i=new Array;for(const r of t)i.push(Vu(r,null,e));return i}function MOt(t,e){for(const i of t)go(i,e)}function Vu(t,e,i){return v(t)?i(t):e}function POt(t){return t.filter(e=>v(e))}function In(t,...e){let i=t;for(let r=0;r<e.length&&i;++r)i=i[e[r]];return i}function IOt(t){return t}let Ki=class{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(i=>{e+=i.length}),e}add(e,i){if(C3(e)){const r=this._getOrCreateGroup(i);for(const s of e)this._isHandle(s)&&r.push(s)}else this._isHandle(e)&&this._getOrCreateGroup(i).push(e);return this}forEach(e,i){if(typeof e=="function")this._groups.forEach(r=>r.forEach(e));else{const r=this._getGroup(e);r&&i&&r.forEach(i)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(typeof e!="string"&&C3(e)){for(const i of e)this.remove(i);return this}return this.has(e)?(this._removeAllFromGroup(this._getGroup(e)),this._groups.delete(this._ensureGroupKey(e)),this):this}removeAll(){return this._groups.forEach(e=>this._removeAllFromGroup(e)),this._groups.clear(),this}_isHandle(e){return e&&!!e.remove}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const i=[];return this._groups.set(this._ensureGroupKey(e),i),i}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}_removeAllFromGroup(e){e.forEach(i=>i.remove())}};const rme=Symbol("Accessor-beforeDestroy");function qE(t){return Wp(()=>t.forEach(e=>v(e)&&e.remove()))}function Wp(t){return{remove:()=>{t&&(t(),t=void 0)}}}function LOt(t){return Wp(v(t)?()=>t.destroy():void 0)}let TM=class _b{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*_b._m}getInt(){return this._seed=(_b._a*this._seed+_b._c)%_b._m,this._seed}getFloat(){return this.getInt()/(_b._m-1)}getIntRange(e,i){return Math.round(this.getFloatRange(e,i))}getFloatRange(e,i){const r=i-e;return e+this.getInt()/_b._m*r}};TM._m=2147483647,TM._a=48271,TM._c=0;function kP(t,e){return e?t.filter((i,r,s)=>s.findIndex(e.bind(null,i))===r):t.filter((i,r,s)=>s.indexOf(i)===r)}function Uy(t,e,i){if(C(t)&&C(e))return!0;if(C(t)||C(e)||t.length!==e.length)return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function AY(t,e){let i=t.length!==e.length;i&&(t.length=e.length);for(let r=0;r<e.length;++r)t[r]!==e[r]&&(t[r]=e[r],i=!0);return i}function KLe(t,e,i){let r,s;return i?(r=e.filter(n=>!t.some(o=>i(o,n))),s=t.filter(n=>!e.some(o=>i(o,n)))):(r=e.filter(n=>!t.includes(n)),s=t.filter(n=>!e.includes(n))),{added:r,removed:s}}function QLe(t){return t&&typeof t.length=="number"}function DOt(t,e){const i=t.length;if(i===0)return[];const r=[];for(let s=0;s<i;s+=e)r.push(t.slice(s,s+e));return r}const eDe=!!Array.prototype.fill;function NOt(t,e){if(eDe)return new Array(t).fill(e);const i=new Array(t);for(let r=0;r<t;r++)i[r]=e;return i}function tDe(t,e){e===void 0&&(e=t,t=0);const i=new Array(e-t);for(let r=t;r<e;r++)i[r-t]=r;return i}function iDe(t,e,i){const r=t.length;let s=0,n=r-1;for(;s<n;){const a=s+Math.floor((n-s)/2);e>t[a]?s=a+1:n=a}const o=t[s];return i?e>=t[r-1]?-1:o===e?s:s-1:o===e?s:-1}let sme=class{constructor(){this.last=0}};const nme=new sme;function Hz(t,e,i,r){r=r||nme;const s=Math.max(0,r.last-10);for(let o=s;o<i;++o)if(t[o]===e)return r.last=o,o;const n=Math.min(s,i);for(let o=0;o<n;++o)if(t[o]===e)return r.last=o,o;return-1}function A3(t,e,i,r){const s=i??t.length,n=Hz(t,e,s,r);if(n!==-1)return t[n]=t[s-1],i==null&&t.pop(),e}const Pd=new Set;function rDe(t,e,i=t.length,r=e.length,s,n){if(r===0||i===0)return i;Pd.clear();for(let a=0;a<r;++a)Pd.add(e[a]);s=s||nme;const o=Math.max(0,s.last-10);for(let a=o;a<i;++a)if(Pd.has(t[a])&&(n&&n.push(t[a]),Pd.delete(t[a]),t[a]=t[i-1],--i,--a,Pd.size===0||i===0))return Pd.clear(),i;for(let a=0;a<o;++a)if(Pd.has(t[a])&&(n&&n.push(t[a]),Pd.delete(t[a]),t[a]=t[i-1],--i,--a,Pd.size===0||i===0))return Pd.clear(),i;return Pd.clear(),i}function sDe(t,e){let i=0;for(let r=0;r<t.length;++r){const s=t[r];e(s,r)&&(t[i]=s,i++)}t.length=i}function nDe(t){return t?(qte.seed=t,()=>qte.getFloat()):Math.random}function UOt(t,e){const i=nDe(e);for(let r=t.length-1;r>0;r--){const s=Math.floor(i()*(r+1)),n=t[r];t[r]=t[s],t[s]=n}return t}const qte=new TM;function OY(t,e){const i=t.indexOf(e);return i!==-1?(t.splice(i,1),e):null}function VOt(t,e){const i=new Map,r=t.length;for(let s=0;s<r;s++){const n=t[s],o=e(n,s,t),a=i.get(o);a?a.push(n):i.set(o,[n])}return i}function PA(t){return t instanceof ArrayBuffer}function oDe(t){return t&&t.constructor&&t.constructor.name==="Int8Array"}function xw(t){return t&&t.constructor&&t.constructor.name==="Uint8Array"}function aDe(t){return t&&t.constructor&&t.constructor.name==="Uint8ClampedArray"}function lDe(t){return t&&t.constructor&&t.constructor.name==="Int16Array"}function RY(t){return t&&t.constructor&&t.constructor.name==="Uint16Array"}function cDe(t){return t&&t.constructor&&t.constructor.name==="Int32Array"}function MY(t){return t&&t.constructor&&t.constructor.name==="Uint32Array"}function PY(t){return t&&t.constructor&&t.constructor.name==="Float32Array"}function IY(t){return t&&t.constructor&&t.constructor.name==="Float64Array"}function ZI(t){return v(t)?128+t.buffer.byteLength+64:0}const Nm=1024;function ome(t,e){let i;if(e)for(i in t)t.hasOwnProperty(i)&&(t[i]===void 0?delete t[i]:t[i]instanceof Object&&ome(t[i],!0));else for(i in t)t.hasOwnProperty(i)&&t[i]===void 0&&delete t[i];return t}function ae(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=ume(t);if(v(e))return e;if(ame(t))return t.clone();if(lme(t))return t.map(ae);if(cme(t))return t.clone();const i={};for(const r of Object.getOwnPropertyNames(t))i[r]=ae(t[r]);return i}function qz(t){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const e=ume(t);if(v(e))return e;if(lme(t)){let i=!0;const r=t.map(s=>{const n=qz(s);return s!=null&&n==null&&(i=!1),n});return i?r:null}if(ame(t))return t.clone();if(!cme(t)){const i=new(Object.getPrototypeOf(t)).constructor;for(const r of Object.getOwnPropertyNames(t)){const s=t[r],n=qz(s);if(s!=null&&n==null)return null;i[r]=n}return i}return null}function ame(t){return typeof t.clone=="function"}function lme(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function cme(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function Wte(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function ume(t){if(oDe(t)||xw(t)||aDe(t)||lDe(t)||RY(t)||cDe(t)||MY(t)||PY(t)||IY(t))return t.slice();if(t instanceof Date)return new Date(t.getTime());if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[i,r]of t)e.set(i,ae(r));return e}if(t instanceof Set){const e=new Set;for(const i of t)e.add(ae(i));return e}return null}function $Y(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof(t||{}).getTime=="function"&&typeof(e||{}).getTime=="function"&&t.getTime()===e.getTime()||!1}function uDe(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&Uy(t,e):t instanceof Set?e instanceof Set&&dDe(t,e):t instanceof Map?e instanceof Map&&pDe(t,e):!!Wte(t)&&Wte(e)&&hDe(t,e))}function hDe(t,e){if(t===null||e===null)return!1;const i=Object.keys(t);if(e===null||Object.keys(e).length!==i.length)return!1;for(const r of i)if(t[r]!==e[r]||!Object.prototype.hasOwnProperty.call(e,r))return!1;return!0}function dDe(t,e){if(t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}function pDe(t,e){if(t.size!==e.size)return!1;for(const[i,r]of t){const s=e.get(i);if(s!==r||s===void 0&&!e.has(i))return!1}return!0}function ml(t){return t?t.__accessor__?t.__accessor__:t.propertyInvalidated?t:null:null}function fDe(t,e){return t!=null&&t.metadatas&&t.metadatas[e]!=null}function QD(t,e,i){return i?i4(t,e,{policy:i,path:""}):i4(t,e,null)}function i4(t,e,i){return e?Object.keys(e).reduce((r,s)=>{let n=null,o="merge";if(i&&(n=i.path?`${i.path}.${s}`:s,o=i.policy(n)),o==="replace"||o==="replace-arrays"&&Array.isArray(r[s]))return r[s]=e[s],r;if(r[s]===void 0)return r[s]=ae(e[s]),r;let a=r[s],l=e[s];if(a===l)return r;if(Array.isArray(l)||Array.isArray(r))a=a?Array.isArray(a)?r[s]=a.concat():r[s]=[a]:r[s]=[],l&&(Array.isArray(l)||(l=[l]),l.forEach(c=>{a.includes(c)||a.push(c)}));else if(l&&typeof l=="object")if(i){const c=i.path;i.path=n,r[s]=i4(a,l,i),i.path=c}else r[s]=i4(a,l,null);else r.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(r[s]=l);return r},t||{}):t}function hme(t){return Array.isArray(t)?t:t.split(".")}function Xte(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function mDe(t){if(Array.isArray(t)){const e=[];for(const i of t)e.push(...Xte(i));return e}return Xte(t)}function dme(t,e,i,r){const s=mDe(e);if(s.length!==1){const n=s.map(o=>r(t,o,i));return qE(n)}return r(t,s[0],i)}function LY(t){let e=!1;return()=>{e||(e=!0,t())}}function pme(t,e){const i=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const s=parseInt(i,10);if(!isNaN(s))return Array.isArray(e)?e[s]:e.getItemAt(s)}const r=ml(e);return fDe(r,i)?r.get(i):e[i]}function fme(t,e,i){if(t==null)return t;const r=pme(e[i],t);return!r&&i<e.length-1?void 0:i===e.length-1?r:fme(r,e,i+1)}function BP(t,e,i=0){return typeof e!="string"||e.includes(".")?fme(t,hme(e),i):pme(e,t)}function r4(t,e){return BP(t,e)}function Yte(t,e){return BP(e,t)!==void 0}function zP(t){let e=t.constructor.__accessorMetadata__;const i=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!i){e=Object.create(e);for(const r in e)e[r]=ae(e[r]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function L6(t,e){const i=zP(t);let r=i[e];return r||(r=i[e]={}),r}function gDe(t,e){return QD(t,e,_De)}const yDe=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function _De(t){return yDe.test(t)?"replace":"merge"}let dv;function de(t){return typeof dv[t]=="function"?dv[t]=dv[t](globalThis):dv[t]}var nfe,ofe,afe,lfe;dv=(nfe=globalThis.dojoConfig)!=null&&nfe.has||(ofe=globalThis.esriConfig)!=null&&ofe.has?{...(afe=globalThis.dojoConfig)==null?void 0:afe.has,...(lfe=globalThis.esriConfig)==null?void 0:lfe.has}:{},de.add=(t,e,i,r)=>((r||dv[t]===void 0)&&(dv[t]=e),i&&de(t)),de.cache=dv,de.add("esri-deprecation-warnings",!0),(()=>{var e;de.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(de.add("host-browser",t),de.add("host-node",typeof globalThis.process=="object"&&((e=globalThis.process.versions)==null?void 0:e.node)&&globalThis.process.versions.v8),de.add("dom",t),de("host-browser")){const i=navigator,r=i.userAgent,s=i.appVersion,n=parseFloat(s);if(de.add("wp",parseFloat(r.split("Windows Phone")[1])||void 0),de.add("msapp",parseFloat(r.split("MSAppHost/")[1])||void 0),de.add("khtml",s.includes("Konqueror")?n:void 0),de.add("edge",parseFloat(r.split("Edge/")[1])||void 0),de.add("opr",parseFloat(r.split("OPR/")[1])||void 0),de.add("webkit",!de("wp")&&!de("edge")&&parseFloat(r.split("WebKit/")[1])||void 0),de.add("chrome",!de("edge")&&!de("opr")&&parseFloat(r.split("Chrome/")[1])||void 0),de.add("android",!de("wp")&&parseFloat(r.split("Android ")[1])||void 0),de.add("safari",!s.includes("Safari")||de("wp")||de("chrome")||de("android")||de("edge")||de("opr")?void 0:parseFloat(s.split("Version/")[1])),de.add("mac",s.includes("Macintosh")),!de("wp")&&r.match(/(iPhone|iPod|iPad)/)){const o=RegExp.$1.replace(/P/,"p"),a=r.match(/OS ([\d_]+)/)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replace(/_/g,""));de.add(o,l),de.add("ios",l)}de("webkit")||(!r.includes("Gecko")||de("wp")||de("khtml")||de("edge")||de.add("mozilla",n),de("mozilla")&&de.add("ff",parseFloat(r.split("Firefox/")[1]||r.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),i=/iPhone/i.test(t);e&&de.add("esri-mobile",e),i&&de.add("esri-iPhone",i),de.add("esri-geolocation",!!navigator.geolocation)}de.add("esri-wasm","WebAssembly"in globalThis),de.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in globalThis,e=globalThis.crossOriginIsolated===!1;return t&&!e}),de.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),de.add("esri-atomics","Atomics"in globalThis),de.add("esri-workers","Worker"in globalThis),de.add("web-feat:cache","caches"in globalThis),de.add("esri-workers-arraybuffer-transfer",!de("safari")||Number(de("safari"))>=12),de.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),de.add("featurelayer-simplify-payload-size-factors",[1,1,4]),de.add("featurelayer-snapshot-enabled",!0),de.add("featurelayer-snapshot-point-min-threshold",8e4),de.add("featurelayer-snapshot-point-max-threshold",4e5),de.add("featurelayer-snapshot-point-coverage",.1),de.add("featurelayer-advanced-symbols",!1),de.add("featurelayer-pbf",!0),de.add("featurelayer-pbf-statistics",!1),de.add("feature-layers-workers",!0),de.add("feature-polyline-generalization-factor",1),de.add("mapview-transitions-duration",200),de.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),de.add("mapserver-pbf-version-support",10.81),de.add("mapservice-popup-identify-max-tolerance",20),de.add("heatmap-allow-raster-fallback",!0),de.add("heatmap-force-raster",!1),de("host-webworker")||de("host-browser")&&(de.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),de.add("esri-image-decode",()=>{if("decode"in new Image){const t=new Image;return t.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void t.decode().then(()=>{de.add("esri-image-decode",!0,!0,!0)}).catch(()=>{de.add("esri-image-decode",!1,!0,!0)})}return!1}),de.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();function mme(t,e,i=!1){return yme(t,e,i)}function GP(t,e){if(e!=null)return e[t]||gme(t.split("."),!1,e)}function gl(t,e,i){const r=t.split("."),s=r.pop(),n=gme(r,!0,i);n&&s&&(n[s]=e)}function gme(t,e,i){let r=i;for(const s of t){if(r==null)return;if(!(s in r)){if(!e)return;r[s]={}}r=r[s]}return r}function yme(t,e,i){return e?Object.keys(e).reduce((r,s)=>{let n=r[s],o=e[s];return n===o?r:n===void 0?(r[s]=ae(o),r):(Array.isArray(o)||Array.isArray(r)?(n=n?Array.isArray(n)?r[s]=n.concat():r[s]=[n]:r[s]=[],o&&(Array.isArray(o)||(o=[o]),i?o.forEach(a=>{n.includes(a)||n.push(a)}):r[s]=o.concat())):o&&typeof o=="object"?r[s]=yme(n,o,i):r.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(r[s]=o),r)},t||{}):t}var cfe;const ar={analysisTheme:{accentColor:[255,128,0],textColor:"white"},apiKey:void 0,applicationUrl:(cfe=globalThis.location)==null?void 0:cfe.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!1,portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(mme(ar,globalThis.esriConfig,!0),delete ar.has),!ar.assetsPath){{const t="4.26.5";ar.assetsPath=`https://js.arcgis.com/${t.slice(0,-2)}/@arcgis/core/assets`}ar.defaultAssetsPath=ar.assetsPath}const vDe=/\{([^\}]+)\}/g;function Zte(t){return t??""}function Fm(t,e){return t.replace(vDe,typeof e=="object"?(i,r)=>Zte(GP(r,e)):(i,r)=>Zte(e(r)))}function kOt(t,e){return t.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,i=>e&&e.includes(i)?i:`\\${i}`)}function DY(t){let e=0;for(let i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i),e|=0;return e}function BOt(t){return new DOMParser().parseFromString(t||"","text/html").body.innerText||""}const Jte={info:0,warn:1,error:2,none:3};let oe=class Wa{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,Wa._loggers[this.module]=this;const i=this.module.lastIndexOf(".");i!==-1&&(this._parent=Wa.getLogger(this.module.slice(0,i)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){const e=this;return{loggedMessages:e._loggedMessages,clearLoggedWarnings:()=>e._loggedMessages.warn.clear()}}static get testSingleton(){return{resetLoggers(e={}){const i=Wa._loggers;return Wa._loggers=e,i},set throttlingDisabled(e){Wa._throttlingDisabled=e}}}static getLogger(e){let i=Wa._loggers[e];return i||(i=new Wa({module:e})),i}_log(e,i,...r){if(this._matchLevel(e)){if(i!=="always"&&!Wa._throttlingDisabled){const s=this._argsToKey(r),n=this._loggedMessages[e].get(s);if(i==="once"&&n!=null||i==="oncePerTick"&&n&&n>=Wa._tickCounter)return;this._loggedMessages[e].set(s,Wa._tickCounter),Wa._scheduleTickCounterIncrement()}for(const s of ar.log.interceptors)if(s(e,this.module,...r))return;this._inheritedWriter()(e,this.module,...r)}}_parentWithMember(e,i){let r=this;for(;v(r);){const s=r[e];if(v(s))return s;r=r.parent}return i}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(e,i,...r){console[e](`[${i}]`,...r)}_matchLevel(e){const i=ar.log.level?ar.log.level:"warn";return Jte[this._parentWithMember("level",i)]<=Jte[e]}_argsToKey(...e){return DY(JSON.stringify(e,(r,s)=>typeof s!="object"||Array.isArray(s)?s:"[Object]"))}static _scheduleTickCounterIncrement(){Wa._tickCounterScheduled||(Wa._tickCounterScheduled=!0,Promise.resolve().then(()=>{Wa._tickCounter++,Wa._tickCounterScheduled=!1}))}};oe._loggers={},oe._tickCounter=0,oe._tickCounterScheduled=!1,oe._throttlingDisabled=!1;function bDe(t){return t&&t.release&&typeof t.release=="function"}function wDe(t){return t&&t.acquire&&typeof t.acquire=="function"}let yo=class Wz{constructor(e,i,r,s=1,n=0){if(this._ctor=e,this._acquireFunction=i,this._releaseFunction=r,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n,this._ctor)for(let o=0;o<n;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...e){let i;if(Wz.test.disabled)i=new this._ctor;else{if(this._pool.length===0){const r=this.allocationSize;for(let s=0;s<r;s++)this._pool[s]=new this._ctor}i=this._pool.pop()}return this._acquireFunction?this._acquireFunction(i,...e):wDe(i)&&i.acquire(...e),i}release(e){e&&!Wz.test.disabled&&(this._releaseFunction?this._releaseFunction(e):bDe(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let i=e;i<this._pool.length;++i){const r=this._pool[i];this._dispose(r)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}};yo.test={disabled:!1};var fy;(function(t){t[t.INITIALIZING=0]="INITIALIZING",t[t.CONSTRUCTING=1]="CONSTRUCTING",t[t.CONSTRUCTED=2]="CONSTRUCTED"})(fy||(fy={}));let xDe=class{constructor(e,i){this._observers=e,this._observer=i}remove(){OY(this._observers,this._observer)}},_me=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return TDe;this._observers==null&&(this._observers=[]);const i=this._observers;let r=!1,s=!1;const n=i.length;for(let o=0;o<n;++o){const a=i[o];if(a.destroyed)s=!0;else if(a===e){r=!0;break}}return r||(i.push(e),s&&this._removeDestroyedObservers()),new xDe(i,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const i=e.length;let r=0;for(let s=0;s<i;++s){for(;s+r<i&&e[s+r].destroyed;)++r;if(r>0){if(!(s+r<i))break;e[s]=e[s+r]}}e.length=i-r}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const i of e)i.onCommitted();this._observers=null}}};const TDe={remove:()=>{}};var Xi;(function(t){t[t.DEFAULTS=0]="DEFAULTS",t[t.COMPUTED=1]="COMPUTED",t[t.SERVICE=2]="SERVICE",t[t.PORTAL_ITEM=3]="PORTAL_ITEM",t[t.WEB_SCENE=4]="WEB_SCENE",t[t.WEB_MAP=5]="WEB_MAP",t[t.USER=6]="USER"})(Xi||(Xi={}));const Xz=Xi.USER+1;function pv(t){switch(t){case"defaults":return Xi.DEFAULTS;case"service":return Xi.SERVICE;case"portal-item":return Xi.PORTAL_ITEM;case"web-scene":return Xi.WEB_SCENE;case"web-map":return Xi.WEB_MAP;case"user":return Xi.USER;default:return null}}function s4(t){switch(t){case Xi.DEFAULTS:return"defaults";case Xi.SERVICE:return"service";case Xi.PORTAL_ITEM:return"portal-item";case Xi.WEB_SCENE:return"web-scene";case Xi.WEB_MAP:return"web-map";case Xi.USER:return"user"}return void 0}function SDe(t){return s4(t)}var Ur;(function(t){t[t.Dirty=1]="Dirty",t[t.Overriden=2]="Overriden",t[t.Computing=4]="Computing",t[t.NonNullable=8]="NonNullable",t[t.HasDefaultValue=16]="HasDefaultValue",t[t.DepTrackingInitialized=32]="DepTrackingInitialized",t[t.AutoTracked=64]="AutoTracked",t[t.ExplicitlyTracking=128]="ExplicitlyTracking"})(Ur||(Ur={}));const n4={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},HO=[];let SM=n4;function Ai(t){SM.onObservableAccessed(t)}let eN=!1,tN=!1;function Vy(t,e,i){if(eN)return NY(t,e,i);vme(t);const r=e.call(i);return bme(),r}function EDe(t,e){return Vy(n4,t,e)}function NY(t,e,i){const r=eN;eN=!0,vme(t);let s=null;try{s=e.call(i)}catch(n){tN&&oe.getLogger("esri.core.accessorSupport.tracking").error(n)}return bme(),eN=r,s}function vme(t){SM=t,HO.push(t)}function bme(){const t=HO.length;if(t>1){const e=HO.pop();SM=HO[t-2],e.onTrackingEnd()}else if(t===1){const e=HO.pop();SM=n4,e.onTrackingEnd()}else SM=n4}function wme(t,e){const i=e.observerObject;if(i.flags&Ur.DepTrackingInitialized)return;const r=tN;tN=!1,i.flags&Ur.AutoTracked?NY(e,e.metadata.get,t):xme(t,e),tN=r}const CDe=[];function xme(t,e){const i=e.observerObject;i.flags&Ur.ExplicitlyTracking||(i.flags|=Ur.ExplicitlyTracking,NY(e,()=>{const r=e.metadata.dependsOn||CDe;for(const s of r)if(typeof s!="string"||s.includes(".")){const n=hme(s);for(let o=0,a=t;o<n.length&&a!=null&&typeof a=="object";++o)a=Kte(a,n[o],o!==n.length-1)}else Kte(t,s,!1)}),i.flags&=~Ur.ExplicitlyTracking)}function Kte(t,e,i){var n;const r=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const o=parseInt(r,10);if(!isNaN(o))return Array.isArray(t)?t[o]:t.getItemAt(o)}const s=(n=ml(t))==null?void 0:n.properties.get(r);return s&&(Ai(s.observerObject),wme(t,s)),i?t[r]:void 0}let Qte=class{constructor(e,i,r){this.properties=e,this.propertyName=i,this.metadata=r,this.observerObject=new ADe,this._accessed=null,this._handles=null,this.observerObject.flags=Ur.Dirty|(r.nonNullable?Ur.NonNullable:0)|(r.hasOwnProperty("value")?Ur.HasDefaultValue:0)|(r.get===void 0?Ur.DepTrackingInitialized:0)|(r.dependsOn===void 0?Ur.AutoTracked:0),eie.register(this,this.observerObject)}destroy(){this.observerObject.destroy(),this._accessed=null,this._clearObservationHandles(),eie.unregister(this)}getComputed(){const e=this.observerObject;Ai(e);const i=this.properties.store,r=this.propertyName,s=e.flags,n=i.get(r);if(s&Ur.Computing||~s&Ur.Dirty&&i.has(r))return n;e.flags|=Ur.Computing;const o=this.properties.host;let a;s&Ur.AutoTracked?a=Vy(this,this.metadata.get,o):(xme(o,this),a=this.metadata.get.call(o)),i.set(r,a,Xi.COMPUTED);const l=i.get(r);return l===n?e.flags&=~Ur.Dirty:EDe(this.commit,this),e.flags&=~Ur.Computing,l}onObservableAccessed(e){e!==this.observerObject&&(this._accessed===null&&(this._accessed=[]),this._accessed.includes(e)||this._accessed.push(e))}onTrackingEnd(){this._clearObservationHandles();const e=this.observerObject;e.flags|=Ur.DepTrackingInitialized;const i=this._accessed;if(i===null)return;let r=this._handles;r===null&&(r=this._handles=[]);for(let s=0;s<i.length;++s)r.push(i[s].observe(e));i.length=0}notifyChange(){const e=this.observerObject;e.onInvalidated(),e.onCommitted()}invalidate(){this.observerObject.onInvalidated()}commit(){const e=this.observerObject;e.flags&=~Ur.Dirty,e.onCommitted()}_clearObservationHandles(){const e=this._handles;if(e!==null){for(let i=0;i<e.length;++i)e[i].remove();e.length=0}}},ADe=class extends _me{constructor(){super(...arguments),this.flags=0}onInvalidated(){~this.flags&Ur.Overriden&&(this.flags|=Ur.Dirty);const e=this._observers;if(e&&e.length>0)for(const i of e)i.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onCommitted()}}destroy(){this.flags&Ur.Dirty&&this.onCommitted(),super.destroy()}};const eie=new FinalizationRegistry(t=>{t.destroy()});let ODe=class Tme{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new Tme;return this._values.forEach((r,s)=>{e&&e.has(s)||i.set(s,ae(r))}),i}get(e){return this._values.get(e)}originOf(){return Xi.USER}keys(){return[...this._values.keys()]}set(e,i){this._values.set(e,i)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}};function JI(t,e,i){return t!==void 0}function tie(t,e,i,r){return t!==void 0&&(!(i==null&&t.observerObject.flags&Ur.NonNullable)||(r.lifecycle,fy.INITIALIZING,!1))}function RDe(t){return t&&typeof t.destroy=="function"}oe.getLogger("esri.core.accessorSupport.Properties");let MDe=class{constructor(e){this.host=e,this.properties=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=fy.INITIALIZING,this.store=new ODe,this._origin=Xi.USER;const i=this.host.constructor.__accessorMetadata__;for(const r in i){const s=new Qte(this,r,i[r]);this.properties.set(r,s)}this.metadatas=i}initialize(){this.lifecycle=fy.CONSTRUCTING}constructed(){this.lifecycle=fy.CONSTRUCTED}destroy(){this.destroyed=!0;for(const[e,i]of this.properties){if(i.metadata.autoDestroy){const r=this.internalGet(e);r&&RDe(r)&&(r.destroy(),~i.observerObject.flags&Ur.NonNullable&&this._internalSet(i,null))}i.destroy()}}get initialized(){return this.lifecycle!==fy.INITIALIZING}get(e){const i=this.properties.get(e);if(i.metadata.get)return i.getComputed();Ai(i.observerObject);const r=this.store;return r.has(e)?r.get(e):i.metadata.value}originOf(e){const i=this.store.originOf(e);if(i===void 0){const r=this.properties.get(e);if(r!==void 0&&r.observerObject.flags&Ur.HasDefaultValue)return"defaults"}return s4(i)}has(e){return!!this.properties.has(e)&&this.store.has(e)}keys(){return[...this.properties.keys()]}internalGet(e){const i=this.properties.get(e);if(JI(i))return this.store.has(e)?this.store.get(e):i.metadata.value}internalSet(e,i){const r=this.properties.get(e);JI(r)&&this._internalSet(r,i)}getDependsInfo(e,i,r){const s=this.properties.get(i);if(!JI(s))return"";const n=new Set,o=Vy({onObservableAccessed:l=>n.add(l),onTrackingEnd:()=>{}},()=>{var l;return(l=s.metadata.get)==null?void 0:l.call(e)});let a=`${r}${e.declaredClass.split(".").pop()}.${i}: ${o}
`;if(n.size===0)return a;r+="  ";for(const l of n){if(!(l instanceof Qte))continue;const c=l.properties.host,h=l.propertyName,p=ml(c);a+=p?p.getDependsInfo(c,h,r):`${r}${h}: undefined
`}return a}setAtOrigin(e,i,r){const s=this.properties.get(e);if(JI(s))return this._setAtOrigin(s,i,r)}isOverridden(e){const i=this.properties.get(e);return i!==void 0&&!!(i.observerObject.flags&Ur.Overriden)}clearOverride(e){const i=this.properties.get(e),r=i==null?void 0:i.observerObject;r&&r.flags&Ur.Overriden&&(r.flags&=~Ur.Overriden,i.notifyChange())}override(e,i){const r=this.properties.get(e);if(!tie(r,e,i,this))return;const s=r.metadata.cast;if(s){const n=this._cast(s,i),{valid:o,value:a}=n;if(mV.release(n),!o)return;i=a}r.observerObject.flags|=Ur.Overriden,this._internalSet(r,i)}set(e,i){const r=this.properties.get(e);if(!tie(r,e,i,this))return;const s=r.metadata.cast;if(s){const o=this._cast(s,i),{valid:a,value:l}=o;if(mV.release(o),!a)return;i=l}const n=r.metadata.set;n?n.call(this.host,i):this._internalSet(r,i)}setDefaultOrigin(e){this._origin=pv(e)}getDefaultOrigin(){return s4(this._origin)}notifyChange(e){const i=this.properties.get(e);i!==void 0&&i.notifyChange()}invalidate(e){const i=this.properties.get(e);i!==void 0&&i.invalidate()}commit(e){const i=this.properties.get(e);i!==void 0&&i.commit()}_internalSet(e,i){const r=this.lifecycle!==fy.INITIALIZING?this._origin:Xi.DEFAULTS;this._setAtOrigin(e,i,r)}_setAtOrigin(e,i,r){const s=this.store,n=e.propertyName;s.has(n,r)&&$Y(i,s.get(n))&&~e.observerObject.flags&Ur.Overriden&&r===s.originOf(n)||(e.invalidate(),s.set(n,i,r),e.commit(),wme(this.host,e))}_cast(e,i){const r=mV.acquire();return r.valid=!0,r.value=i,e&&(r.value=e.call(this.host,i,r)),r}},PDe=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const mV=new yo(PDe);function IDe(t,e){return t.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(i,r)=>{if(r==="")return"$";const s=GP(r,e),n=s??"";if(n===void 0)throw new Error(`could not find key "${r}" in template`);return n.toString()})}let Sme=class Eme{constructor(e,i,r){this.name=e,this.details=r,this instanceof Eme&&(this.message=(i&&IDe(i,r))??"")}toString(){return"["+this.name+"]: "+this.message}},W=class iN extends Sme{constructor(e,i,r){if(super(e,i,r),!(this instanceof iN))return new iN(e,i,r)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,i)=>{if(i&&typeof i=="object"&&typeof i.toJSON=="function")return i;try{return ae(i)}catch{return"[object]"}}))}}catch(e){throw oe.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new iN(e.name,e.message,e.details)}};W.prototype.type="error";function o4(t,e,i){if(t&&e)if(typeof e=="object")for(const r of Object.getOwnPropertyNames(e))o4(t,r,e[r]);else{if(e.includes(".")){const s=e.split("."),n=s.splice(s.length-1,1)[0];return void o4(r4(t,s),n,i)}const r=t.__accessor__;r!=null&&$De(e,r),t[e]=i}}function $De(t,e){if(de("esri-unknown-property-errors")&&!LDe(t,e))throw new W("set:unknown-property",DDe(t,e))}function LDe(t,e){return e.metadatas[t]!=null}function DDe(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}function NDe(t){t.length=0}let tc=class{constructor(e=50,i=50){this._pool=new yo(Array,void 0,NDe,i,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return gV.acquire()}static release(e){return gV.release(e)}static prune(){gV.prune()}};const gV=new tc(100);let Cme=class extends yo{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=yx(this._set)}acquire(...e){const i=super.acquire(...e);return this._set.delete(i),i}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const KI=[];function WE(t){KI.push(t),KI.length===1&&queueMicrotask(()=>{const e=KI.slice();KI.length=0;for(const i of e)i()})}let vy=class{constructor(e,i=30){this.name=e,this._counter=0,this._samples=new Array(i)}record(e){v(e)&&(this._samples[++this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,i)=>e-i)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,i)=>e+i,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var Yz;(function(t){const e=(n,o,a,l)=>{let c=o,h=o;const p=a>>>1,f=n[c-1];for(;h<=p;){h=c<<1,h<a&&l(n[h-1],n[h])<0&&++h;const m=n[h-1];if(l(m,f)<=0)break;n[c-1]=m,c=h}n[c-1]=f},i=(n,o)=>n<o?-1:n>o?1:0;function r(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let h=a>>>1;h>o;h--)e(n,h,a,l);const c=o+1;for(let h=a-1;h>o;h--){const p=n[o];n[o]=n[h],n[h]=p,e(n,c,h,l)}}function*s(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let h=a>>>1;h>o;h--)e(n,h,a,l),yield;const c=o+1;for(let h=a-1;h>o;h--){const p=n[o];n[o]=n[h],n[h]=p,e(n,c,h,l),yield}}t.sort=r,t.iterableSort=s})(Yz||(Yz={}));const iie=Yz,FDe=1.5,UDe=1.1;let li=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new sme,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>rie(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const i=new Array;for(let r=0;r<this._length;r++){const s=this.data[r];e(s)&&i.push(s)}return i}getItemAt(e){if(!(e<0||e>=this._length))return this.data[e]}includes(e,i){const r=this.data.indexOf(e,i);return r!==-1&&r<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let i=e;i<this._length;++i)this.data[i]=this._deallocator(this.data[i]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,i=e.length){for(let r=0;r<i;r++)this.data[this._length++]=e[r]}fill(e,i){for(let r=0;r<i;r++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,rie(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const i=Hz(this.data,e,this.length,this._hint);if(i!==-1)return this.data.splice(i,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(Hz(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,i=e.length,r){this.length=rDe(this.data,e,this.length,i,this._hint,r),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,i){if(e>=this.length||i>=this.length||e===i)return;const r=this.data[e];this.data[e]=this.data[i],this.data[i]=r}sort(e){iie.sort(this.data,0,this.length,e)}iterableSort(e){return iie.iterableSort(this.data,0,this.length,e)}some(e,i){for(let r=0;r<this.length;++r)if(e.call(i,this.data[r],r,this.data))return!0;return!1}find(e,i){for(let r=0;r<this.length;++r){const s=this.data[r];if(e.call(i,s,r))return s}}filterInPlace(e,i){let r=0;for(let s=0;s<this._length;++s){const n=this.data[s];e.call(i,n,s,this.data)&&(this.data[s]=this.data[r],this.data[r]=n,r++)}if(this._deallocator)for(let s=r;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=r,this._shrink(),this}forAll(e,i){const r=this.length,s=this.data;for(let n=0;n<r;++n)e.call(i,s[n],n,s)}forEach(e,i){for(let r=0;r<this.length;++r)e.call(i,this.data[r],r,this.data)}map(e,i){const r=new Array(this.length);for(let s=0;s<this.length;++s)r[s]=e.call(i,this.data[s],s,this.data);return r}reduce(e,i){let r=i;for(let s=0;s<this.length;++s)r=e(r,this.data[s],s,this.data);return r}has(e){const i=this.length,r=this.data;for(let s=0;s<i;++s)if(r[s]===e)return!0;return!1}};function rie(t){t.data.length>FDe*t.length&&(t.data.length=Math.floor(t.length*UDe))}function VDe(t){return{setTimeout:(e,i)=>{const r=t.setTimeout(e,i);return{remove:()=>t.clearTimeout(r)}}}}const jP=VDe(globalThis),sie=new Set;function kDe(t,e,i=!1){i&&sie.has(e)||(i&&sie.add(e),t.warn(`🛑 DEPRECATED - ${e}`))}function Zz(t,e,i={}){if(de("esri-deprecation-warnings")){const{moduleName:r}=i;Ame(t,`Property: ${(r?r+"::":"")+e}`,i)}}function Ame(t,e,i={}){if(de("esri-deprecation-warnings")){const{replacement:r,version:s,see:n,warnOnce:o}=i;let a=e;r&&(a+=`
	🛠️ Replacement: ${r}`),s&&(a+=`
	⚙️ Version: ${s}`),n&&(a+=`
	🔗 See ${n} for more details.`),kDe(t,a,o)}}function D6(t){return t&&(typeof t.on=="function"||typeof t.addEventListener=="function")}function HP(t,e,i){if(!D6(t))throw new TypeError("target is not a Evented or EventTarget object");if("on"in t)return t.on(e,i);if(Array.isArray(e)){const r=e.slice();for(const s of r)t.addEventListener(s,i);return{remove(){for(const s of r)t.removeEventListener(s,i)}}}return t.addEventListener(e,i),{remove(){t.removeEventListener(e,i)}}}function Ome(t,e,i){if(!D6(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,i);const r=HP(t,e,s=>{r.remove(),i.call(t,s)});return{remove(){r.remove()}}}const BDe={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function Tw({key:t}){return BDe[t]||t}function Bi(t="Aborted"){return new W("AbortError",t)}function gi(t,e="Aborted"){if(qn(t))throw Bi(e)}function N6(t){return v(t)?"aborted"in t?t:t.signal:t}function qn(t){const e=N6(t);return v(e)&&e.aborted}function zc(t){if(ln(t))throw t}function Jz(t){if(!ln(t))throw t}function ca(t,e){const i=N6(t);if(!C(i)){if(!i.aborted)return Ome(i,"abort",()=>e());e()}}function F6(t,e){const i=N6(t);if(!C(i))return gi(i),Ome(i,"abort",()=>e(Bi()))}function FY(t,e){const i=N6(e);return C(i)?t:new Promise((r,s)=>{let n=ca(e,()=>s(Bi()));const o=()=>n=Rr(n);t.then(o,o),t.then(r,s)})}function ln(t){return(t==null?void 0:t.name)==="AbortError"}async function dE(t){try{return await t}catch(e){if(!ln(e))throw e;return}}async function KOt(t,e=oe.getLogger("esri")){try{return await t}catch(i){ln(i)||e.error(i)}}function ky(){let t=null;const e=new Promise((i,r)=>{t={promise:void 0,resolve:i,reject:r}});return t.promise=e,t}async function lc(t){if(!t)return;if(typeof t.forEach!="function"){const i=Object.keys(t),r=i.map(o=>t[o]),s=await lc(r),n={};return i.map((o,a)=>n[o]=s[a]),n}const e=t;return new Promise(i=>{const r=[];let s=e.length;s===0&&i(r),e.forEach(n=>{const o={promise:n||Promise.resolve(n)};r.push(o),o.promise.then(a=>{o.value=a}).catch(a=>{o.error=a}).then(()=>{--s,s===0&&i(r)})})})}async function Kz(t){return(await lc(t)).filter(e=>!!e.value).map(e=>e.value)}function _x(t,e,i){const r=new AbortController;return ca(i,()=>r.abort()),new Promise((s,n)=>{let o=setTimeout(()=>{o=0,s(e)},t);ca(r,()=>{o&&(clearTimeout(o),n(Bi()))})})}function su(t){return t&&typeof t.then=="function"}function Qz(t){return su(t)?t:Promise.resolve(t)}function Rme(t,e=-1){let i,r,s,n,o=null;const a=(...l)=>{if(i){r=l,n&&n.reject(Bi()),n=ky();const f=n.promise;if(o){const m=o;o=null,m.abort()}return f}if(s=n||ky(),n=null,e>0){const f=new AbortController;i=Qz(t(...l,f.signal));const m=i;_x(e).then(()=>{i===m&&(n?f.abort():o=f)})}else i=1,i=Qz(t(...l));const c=()=>{const f=r;r=s=i=o=null,f!=null&&a(...f)},h=i,p=s;return h.then(c,c),h.then(p.resolve,p.reject),p.promise};return a}function qv(){let t,e;const i=new Promise((s,n)=>{t=s,e=n}),r=s=>{t(s)};return r.resolve=s=>t(s),r.reject=s=>e(s),r.timeout=(s,n)=>jP.setTimeout(()=>r.reject(n),s),r.promise=i,r}function QOt(t,e){return t.then(e,e)}async function nie(t){await Promise.resolve(),gi(t)}function eRt(t){return t}function Mme(t){return 1e3*t}function UY(t){return .001*t}let zDe=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},GDe=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},e7=0,t7=0;const IA={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},i7=["prepare","preRender","render","postRender","update","finish"],r7=[],vx=new li;let jDe=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}};const a4={frameTasks:vx,willDispatch:!1,clearFrameTasks:HDe,dispatch:$me,executeFrameTasks:WDe};function rT(t){const e=new GDe(t);return r7.push(e),a4.willDispatch||(a4.willDispatch=!0,WE($me)),e}function By(t){const e=new zDe(t);return vx.push(e),l4==null&&(e7=performance.now(),l4=requestAnimationFrame(Pme)),new jDe(e)}let l4=null;function HDe(t=!1){vx.forAll(e=>{e.removed=!0}),t&&Ime()}function qDe(t){t7=Math.max(0,t)}function Pme(){const t=performance.now();l4=null,l4=vx.length>0?requestAnimationFrame(Pme):null,a4.executeFrameTasks(t)}function WDe(t){const e=t-e7;e7=t;const i=t7>0?t7:1e3/60,r=Math.max(0,e-i);IA.time=t,IA.frameDuration=i-r;for(let s=0;s<i7.length;s++){const n=performance.now(),o=i7[s];vx.forAll(a=>{var l;a.paused||a.removed||(s===0&&a.ticks++,a.phases[o]&&(IA.elapsedFrameTime=performance.now()-t,IA.deltaTime=a.ticks===0?0:e,(l=a.phases[o])==null||l.call(a,IA)))}),XDe[s].record(performance.now()-n)}Ime(),YDe.record(performance.now()-t)}const QI=new li;function Ime(){vx.forAll(t=>{t.removed&&QI.push(t)}),vx.removeUnorderedMany(QI.data,QI.length),QI.clear()}function $me(){for(;r7.length;){const t=r7.shift();t.isActive&&t.callback()}a4.willDispatch=!1}function sRt(t=1,e){const i=qv(),r=()=>{qn(e)?i.reject(Bi()):t===0?i():(--t,WE(()=>r()))};return r(),i.promise}const XDe=i7.map(t=>new vy(t)),YDe=new vy("total");function rN(t,e){for(const i of t.entries())if(e(i[0]))return!0;return!1}let ZDe=0;const JDe=0;function Zc(){return++ZDe}let U6=class{constructor(e){this._notify=e,this._accessed=[],this._handles=[],this._observerObject=new KDe(this._notify),oie.register(this,this._observerObject)}destroy(){var e;this._accessed.length=0,(e=this._observerObject)==null||e.destroy(),this.clear(),oie.unregister(this)}onObservableAccessed(e){const i=this._accessed;i.includes(e)||i.push(e)}onTrackingEnd(){const e=this._handles,i=this._accessed,r=this._observerObject;for(let s=0;s<i.length;++s)e.push(i[s].observe(r));i.length=0}clear(){const e=this._handles;for(let i=0;i<e.length;++i)e[i].remove();e.length=0}},KDe=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=QDe}};const oie=new FinalizationRegistry(t=>{t.destroy()});function QDe(){}let pE=!1;const c4=[];function Lme(t,e){let i=new U6(n),r=null,s=!1;function n(){if(!i||s)return;if(pE)return void Fme(n);const a=r;i.clear(),pE=!0,s=!0,r=Vy(i,t),s=!1,pE=!1,e(r,a),Ume()}function o(){i&&(i.destroy(),i=null,r=null)}return s=!0,r=Vy(i,t),s=!1,{remove:o}}function Dme(t,e){let i=new U6(s),r=null;function s(){e(r,o)}function n(){i&&(i.destroy(),i=null),r=null}function o(){return i?(i.clear(),r=Vy(i,t),r):null}return o(),{remove:n}}function Nme(t){let e=new U6(r),i=!1;function r(){e&&!i&&(pE?Fme(r):(e.clear(),pE=!0,i=!0,Vy(e,t),i=!1,pE=!1,Ume()))}function s(){e&&(e.destroy(),e=null)}return i=!0,Vy(e,t),i=!1,{remove:s}}function Fme(t){c4.includes(t)||c4.unshift(t)}function Ume(){for(;c4.length;)c4.pop()()}var EM;(function(t){t[t.Untracked=0]="Untracked",t[t.Tracked=1]="Tracked"})(EM||(EM={}));let O3=class{constructor(){this.uid=Zc(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,i,r,s,n){return this.pool.acquire(EM.Untracked,e,i,r,s,n,$Y)}static acquireTracked(e,i,r,s){return this.pool.acquire(EM.Tracked,e,i,r,null,null,s)}notify(e,i){this.type===EM.Untracked?this.callback.call(this.target,e,i,this.path,this.target):this.callback.call(null,e,i)}acquire(e,i,r,s,n,o,a){this.uid=Zc(),this.removed=!1,this.type=e,this.oldValue=i,this.callback=r,this.getValue=s,this.target=n,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=Zc(),this.removed=!0}};O3.pool=new Cme(O3);const sN=new tc,Sy=new Set;let u4;function h4(t){Sy.delete(t),Sy.add(t),u4||(u4=rT(iNe))}function eNe(t){if(t.removed)return;const e=t.oldValue,i=t.getValue();t.equals(e,i)||(t.oldValue=i,t.notify(i,e))}function tNe(t){for(const e of Sy.values())e.target===t&&(e.removed=!0)}function iNe(){let t=10;for(;u4&&t--;){u4=null;const e=rNe(),i=sN.acquire();for(const r of e){const s=r.uid;eNe(r),s===r.uid&&r.removed&&i.push(r)}for(const r of Sy)r.removed&&(i.push(r),Sy.delete(r));for(const r of i)O3.pool.release(r);sN.release(i),sN.release(e),s7.forEach(r=>r())}}function rNe(){const t=sN.acquire();t.length=Sy.size;let e=0;for(const i of Sy)t[e]=i,++e;return Sy.clear(),t}const s7=new Set;function Vme(t){return s7.add(t),{remove(){s7.delete(t)}}}function sNe(t,e,i){let r=dme(t,e,i,(s,n,o)=>{let a,l,c=Dme(()=>BP(s,n),(h,p)=>{s.__accessor__.destroyed||a&&a.uid!==l?r.remove():(a||(a=O3.acquireUntracked(h,o,p,s,n),l=a.uid),h4(a))});return{remove:LY(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,h4(a)),a=null),r=c=null})}});return r}function nNe(t,e,i){const r=dme(t,e,i,(s,n,o)=>{let a=!1;return Lme(()=>BP(s,n),(l,c)=>{s.__accessor__.destroyed?r.remove():a||(a=!0,$Y(c,l)||o.call(s,l,c,n,s),a=!1)})});return r}function oNe(t,e,i,r=!1){return!t.__accessor__||t.__accessor__.destroyed?{remove(){}}:r?nNe(t,e,i):sNe(t,e,i)}function aNe(t,e,i){let r,s,n=Dme(t,(o,a)=>{r&&r.uid!==s?n.remove():(r||(r=O3.acquireTracked(o,e,a,i),s=r.uid),h4(r))});return{remove:LY(()=>{n.remove(),r&&(r.uid!==s||r.removed||(r.removed=!0,h4(r)),r=null),n=null})}}function lNe(t,e,i){let r=!1;return Lme(t,(s,n)=>{r||(r=!0,i(n,s)||e(s,n),r=!1)})}function cNe(t,e,i=!1,r=uDe){return i?lNe(t,e,r):aNe(t,e,r)}function aie(t){return rN(Sy,e=>e.oldValue===t)}function Vo(t,e){for(const[i,r]of t)if(e(r,i))return!0;return!1}function lRt(t,e){for(const[i,r]of t)if(e(r,i))return r;return null}function VY(t,e,i){const r=t.get(e);if(r!==void 0)return r;const s=i();return t.set(e,s),s}const fE=oe.getLogger("esri.core.accessorSupport.ensureTypes");function uNe(t){return t==null?t:new Date(t)}function hNe(t){return t==null?t:!!t}function qP(t){return t==null?t:t.toString()}function Hh(t){return t==null?t:(t=parseFloat(t),isNaN(t)?0:t)}function kY(t){return t==null?t:Math.round(parseFloat(t))}function kme(t){return t&&t.constructor&&t.constructor.__accessorMetadata__!==void 0}function d4(t,e){return e!=null&&t&&!(e instanceof t)}function Bme(t){return t&&"isCollection"in t}function lie(t){return t&&t.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function dNe(t,e){if(!e||!e.constructor||!Bme(e.constructor))return n7(t,e)?e:new t(e);const i=lie(t.prototype.itemType),r=lie(e.constructor.prototype.itemType);return i?r?i===r?e:i.prototype.isPrototypeOf(r.prototype)?new t(e):(n7(t,e),e):new t(e):e}function n7(t,e){return!!kme(e)&&(fE.error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+V6(t)+"'"),!0)}function XE(t,e){return e==null?e:Bme(t)?dNe(t,e):d4(t,e)?n7(t,e)?e:new t(e):e}function V6(t){return t&&t.prototype&&t.prototype.declaredClass||"unknown"}const pNe=new WeakMap;function fNe(t){switch(t){case Number:return Hh;case Yr:return kY;case Boolean:return hNe;case String:return qP;case Date:return uNe;default:return VY(pNe,t,()=>XE.bind(null,t))}}function mn(t,e){const i=fNe(t);return arguments.length===1?i:i(e)}function R3(t,e,i){return arguments.length===1?R3.bind(null,t):e&&(Array.isArray(e)?e.map(r=>t(r,i)):[t(e,i)])}function mNe(t,e){return arguments.length===1?R3(mn.bind(null,t)):R3(mn.bind(null,t),e)}function zme(t,e,i){return e!==0&&Array.isArray(i)?i.map(r=>zme(t,e-1,r)):t(i)}function p4(t,e,i){if(arguments.length===2)return p4.bind(null,t,e);if(!i)return i;let r=e,s=i=zme(t,e,i);for(;r>0&&Array.isArray(s);)r--,s=s[0];if(s!==void 0)for(let n=0;n<r;n++)i=[i];return i}function gNe(t,e,i){return arguments.length===2?p4(mn.bind(null,t),e):p4(mn.bind(null,t),e,i)}function Gme(t){return!!Array.isArray(t)&&!t.some(e=>{const i=typeof e;return!(i==="string"||i==="number"||i==="function"&&t.length>1)})}function o7(t,e){if(arguments.length===2)return o7(t).call(null,e);const i=new Set,r=t.filter(a=>typeof a!="function"),s=t.filter(a=>typeof a=="function");for(const a of t)typeof a!="string"&&typeof a!="number"||i.add(a);let n=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,h=c==="string"||c==="number";return h&&(i.has(a)||s.some(p=>c==="string"&&p===String||c==="number"&&p===Number))||c==="object"&&s.some(p=>!d4(a,p))?a:(h&&r.length?(n||(n=r.map(p=>typeof p=="string"?`'${p}'`:`${p}`).join(", ")),fE.error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof a=="object"&&s.length?(o||(o=s.map(p=>V6(p)).join(", ")),fE.error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):fE.error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function Xp(t,e){if(arguments.length===2)return Xp(t).call(null,e);const i={},r=[],s=[];for(const l in t.typeMap){const c=t.typeMap[l];i[l]=mn(c),r.push(V6(c)),s.push(l)}const n=()=>`'${r.join("', '")}'`,o=()=>`'${s.join("', '")}'`,a=typeof t.key=="string"?l=>l[t.key]:t.key;return l=>{if(t.base&&!d4(t.base,l)||l==null)return l;const c=a(l)||t.defaultKeyValue,h=i[c];if(!h)return fE.error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!d4(t.typeMap[c],l))return l;if(typeof t.key=="string"&&!kme(l)){const p={};for(const f in l)f!==t.key&&(p[f]=l[f]);return h(p)}return h(l)}}let Yr=class{};const uRt={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function yNe(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function jme(t){switch(t.type){case"native":return mn(t.value);case"array":return R3(jme(t.value));case"one-of":return _Ne(t);default:return null}}function _Ne(t){let e=null;return(i,r)=>l7(i,t)?i:(e==null&&(e=a7(t)),fE.error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),r&&(r.valid=!1),null)}function a7(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Yr:return"integer";case Date:return"date";default:return V6(t.value)}case"array":return`array of ${a7(t.value)}`;case"one-of":{const e=t.values.map(i=>a7(i));return`one of ${e.slice(0,e.length-1)} or ${e[e.length-1]}`}}return"unknown"}function l7(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case Yr:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string"}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(i=>!l7(i,e.value));case"one-of":return e.values.some(i=>l7(t,i))}}function d(t={}){return(e,i)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${i}. Accessor does not support static properties.`);const r=Object.getOwnPropertyDescriptor(e,i),s=L6(e,i);r&&(r.get||r.set?(s.get=r.get||s.get,s.set=r.set||s.set):"value"in r&&("value"in t&&oe.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${i}" on "${e.constructor.name}" already defined in the metadata`,t),s.value=t.value=r.value)),t.readOnly!=null&&(s.readOnly=t.readOnly);const n=t.aliasOf;if(n){const l=typeof n=="string"?n:n.source,c=typeof n=="string"?null:n.overridable===!0;let h;s.dependsOn=[l],s.get=function(){let p=r4(this,l);if(typeof p=="function"){h||(h=l.split(".").slice(0,-1).join("."));const f=r4(this,h);f&&(p=p.bind(f))}return p},s.readOnly||(s.set=c?function(p){this._override(i,p)}:function(p){o4(this,l,p)})}const o=t.type,a=t.types;s.cast||(o?s.cast=vNe(o):a&&(Array.isArray(a)?s.cast=R3(Xp(a[0])):s.cast=Xp(a))),gDe(s,t),t.range&&(s.cast=bNe(s.cast,t.range))}}function Hme(t,e,i){const r=L6(t,i);r.json||(r.json={});let s=r.json;return e!==void 0&&(s.origins||(s.origins={}),s.origins[e]||(s.origins[e]={}),s=s.origins[e]),s}function vNe(t){let e=0,i=t;if(yNe(t))return jme(t);for(;Array.isArray(i)&&i.length===1&&typeof i[0]!="string"&&typeof i[0]!="number";)i=i[0],e++;const r=i;if(Gme(r))return e===0?o7(r):p4(o7(r),e);if(e===1)return mNe(r);if(e>1)return gNe(r,e);const s=t;return s.from?s.from:mn(s)}function bNe(t,e){return i=>{let r=+t(i);return e.step!=null&&(r=Math.round(r/e.step)*e.step),e.min!=null&&(r=Math.max(e.min,r)),e.max!=null&&(r=Math.min(e.max,r)),r}}function wNe(t){if(t.json&&t.json.origins){const e=t.json.origins,i={"web-document":["web-scene","web-map"]};for(const r in i)if(e[r]){const s=e[r];i[r].forEach(n=>{e[n]=s}),delete e[r]}}}let dd=class c7 extends Sme{constructor(e,i,r){if(super(e,i,r),!(this instanceof c7))return new c7(e,i,r)}};dd.prototype.type="warning";function qme(t){return!!t&&t.prototype&&t.prototype.declaredClass&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}const u7=oe.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function cie(t,e,i){var r,s;t&&(!i&&!e.read||(r=e.read)!=null&&r.reader||((s=e.read)==null?void 0:s.enabled)===!1||SNe(t)&&gl("read.reader",f1(t),e))}function f1(t){var i,r;const e=t.ndimArray??0;if(e>1)return TNe(t);if(e===1)return uie(t);if("type"in t&&Xme(t.type)){const s=(r=(i=t.type.prototype)==null?void 0:i.itemType)==null?void 0:r.Type,n=uie(typeof s=="function"?{type:s}:{types:s});return(o,a,l)=>{const c=n(o,a,l);return c&&new t.type(c)}}return BY(t)}function BY(t){return"type"in t?xNe(t.type):ENe(t.types)}function xNe(t){return t.prototype.read?(e,i,r)=>{if(e==null)return e;const s=typeof e;if(s!=="object")return void u7.error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${s}'`);const n=new t;return n.read(e,r),n}:t.fromJSON}function Wme(t,e,i,r){return r!==0&&Array.isArray(e)?e.map(s=>Wme(t,s,i,r-1)):t(e,void 0,i)}function TNe(t){const e=BY(t),i=Wme.bind(null,e),r=t.ndimArray??0;return(s,n,o)=>{if(s==null)return s;s=i(s,o,r);let a=r,l=s;for(;a>0&&Array.isArray(l);)a--,l=l[0];if(l!==void 0)for(let c=0;c<a;c++)s=[s];return s}}function uie(t){const e=BY(t);return(i,r,s)=>{if(i==null)return i;if(Array.isArray(i)){const o=[];for(const a of i){const l=e(a,void 0,s);l!==void 0&&o.push(l)}return o}const n=e(i,void 0,s);return n!==void 0?[n]:void 0}}function Xme(t){if(!qme(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?zY(e.Type):Yme(e.Type))}function SNe(t){return"types"in t?Yme(t.types):zY(t.type)}function zY(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||Xme(t))}function Yme(t){for(const e in t.typeMap)if(!zY(t.typeMap[e]))return!1;return!0}function ENe(t){let e=null;const i=t.errorContext??"type";return(r,s,n)=>{if(r==null)return r;const o=typeof r;if(o!=="object")return void u7.error(`Expected JSON value of type 'object' to deserialize, but got '${o}'`);e||(e=CNe(t));const a=t.key;if(typeof a!="string")return;const l=r[a],c=l?e[l]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!c){const p=`Type '${l||"unknown"}' is not supported`;return n&&n.messages&&r&&n.messages.push(new dd(`${i}:unsupported`,p,{definition:r,context:n})),void u7.error(p)}const h=new c;return h.read(r,n),h}}function CNe(t){var i,r;const e={};for(const s in t.typeMap){const n=t.typeMap[s],o=zP(n.prototype);if(typeof t.key=="function")continue;const a=o[t.key];if(!a)continue;(i=a.json)!=null&&i.type&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"&&(e[a.json.type[0]]=n);const l=(r=a.json)==null?void 0:r.write;if(!l||!l.writer){e[s]=n;continue}const c=l.target,h=typeof c=="string"?c:t.key,p={};l.writer(s,p,h),p[h]&&(e[p[h]]=n)}return e}function ANe(t){if(t.json||(t.json={}),die(t.json),pie(t.json),hie(t.json),t.json.origins)for(const e in t.json.origins)die(t.json.origins[e]),pie(t.json.origins[e]),hie(t.json.origins[e]);return!0}function hie(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function die(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function pie(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function fie(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const i=(t==null?void 0:t.ndimArray)??0;t&&(i===1||"type"in t&&qme(t.type))?e.write.writer=MNe:i>1?e.write.writer=PNe(i):e.types?Array.isArray(e.types)?e.write.writer=RNe(e.types[0]):e.write.writer=ONe(e.types):e.write.writer=M3}function ONe(t){return(e,i,r,s)=>e?Zme(e,t,s)?M3(e,i,r,s):void 0:M3(e,i,r,s)}function Zme(t,e,i){for(const r in e.typeMap)if(t instanceof e.typeMap[r])return!0;if(i!=null&&i.messages){const r=e.errorContext??"type",s=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;i&&i.messages&&t&&i.messages.push(new W(`${r}:unsupported`,s,{definition:t,context:i})),oe.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(s)}return!1}function RNe(t){return(e,i,r,s)=>!e||!Array.isArray(e)?M3(e,i,r,s):M3(e.filter(n=>Zme(n,t,s)),i,r,s)}function M3(t,e,i,r){gl(i,f4(t,r),e)}function f4(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?m4(t):t}function m4(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function MNe(t,e,i,r){let s;t===null?s=null:t&&typeof t.map=="function"?(s=t.map(n=>f4(n,r)),typeof s.toArray=="function"&&(s=s.toArray())):s=[f4(t,r)],gl(i,s,e)}function Jme(t,e,i){return i!==0&&Array.isArray(t)?t.map(r=>Jme(r,e,i-1)):f4(t,e)}function PNe(t){return(e,i,r,s)=>{let n;if(e===null)n=null;else{n=Jme(e,s,t);let o=t,a=n;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)n=[n]}gl(r,n,i)}}function h7(t,e){return GY(t,"read",e)}function Kme(t,e){return GY(t,"write",e)}function GY(t,e,i){let r=t&&t.json;if(t&&t.json&&t.json.origins&&i){const s=i.origin&&t.json.origins[i.origin];s&&(e==="any"||e in s)&&(r=s)}return r}function INe(t){const e=$Ne(t);if(t.json.origins)for(const i in t.json.origins){const r=t.json.origins[i],s=r.types?LNe(r):e;cie(s,r,!1),r.types&&!r.write&&t.json.write&&t.json.write.enabled&&(r.write={...t.json.write}),fie(s,r)}cie(e,t.json,!0),fie(e,t.json)}function $Ne(t){return t.json.types?d7(t.json):t.type?Qme(t):d7(t)}function LNe(t){return t.type?Qme(t):d7(t)}function Qme(t){if(!t.type)return;let e=0,i=t.type;for(;Array.isArray(i)&&!Gme(i);)i=i[0],e++;return{type:i,ndimArray:e}}function d7(t){if(!t.types)return;let e=0,i=t.types;for(;Array.isArray(i);)i=i[0],e++;return{types:i,ndimArray:e}}function DNe(t){ANe(t)&&(wNe(t),INe(t))}const yV=new Set,_V=new Set;function I(t){return e=>{e.prototype.declaredClass=t,FNe(e);const i=[],r=[];let s=e.prototype;for(;s;)s.hasOwnProperty("initialize")&&!yV.has(s.initialize)&&(yV.add(s.initialize),i.push(s.initialize)),s.hasOwnProperty("destroy")&&!_V.has(s.destroy)&&(_V.add(s.destroy),r.push(s.destroy)),s=Object.getPrototypeOf(s);yV.clear(),_V.clear();class n extends e{constructor(...a){if(super(...a),this.constructor===n&&typeof this.postscript=="function"){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=i.length-1;l>=0;l--)i[l].call(this)}}),r.length){let l=!1;const c=this[rme];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let h=0;h<r.length;h++)r[h].call(this)}}})}this.postscript(...a)}}}return n.__accessorMetadata__=zP(e.prototype),n.prototype.declaredClass=t,n}}function NNe(t,e){return e.get==null?function(){const i=this.__accessor__.properties.get(t);if(i===void 0)return;Ai(i.observerObject);const r=this.__accessor__.store;return r.has(t)?r.get(t):i.metadata.value}:function(){const i=this.__accessor__.properties.get(t);if(i!==void 0)return i.getComputed()}}function FNe(t){const e=t.prototype,i=zP(e),r={};for(const s of Object.getOwnPropertyNames(i)){const n=i[s];DNe(n),r[s]={enumerable:!0,configurable:!0,get:NNe(s,n),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&n.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${s}' of ${this.declaredClass}`);if(a.lifecycle===fy.CONSTRUCTED&&n.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${s}' of ${this.declaredClass}`);a.set(s,o)}}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(t.prototype,r)}var ege,tge;function UNe(t){var e;if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return(e=t.constructor)!=null&&e.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const vb=Symbol("Accessor-Handles"),p7=Symbol("Accessor-Initialized");let $e=class ige{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:i,declaredClass:r,constructor:s}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const n=this;class o extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}zP(o.prototype);for(const a in e){const l=e[a];o.prototype[a]=typeof l=="function"?function(...c){const h=this.inherited;let p;this.inherited=function(...f){if(n.prototype[a])return n.prototype[a].apply(this,f)};try{p=l.apply(this,c)}catch(f){throw this.inherited=h,f}return this.inherited=h,p}:e[a]}for(const a in i){const l=UNe(i[a]);d(l)(o.prototype,a)}return I(r)(o)}constructor(...e){if(this[ege]=null,this[tge]=!1,this.constructor===ige)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");Object.defineProperty(this,"__accessor__",{enumerable:!1,value:new MDe(this)}),e.length>0&&this.normalizeCtorArgs&&(this.__accessor__.ctorArgs=this.normalizeCtorArgs.apply(this,e))}postscript(e){const i=this.__accessor__,r=i.ctorArgs||e;i.initialize(),r&&(this.set(r),i.ctorArgs=null),i.constructed(),this.initialize(),this[p7]=!0}initialize(){}[rme](){this[vb]=Je(this[vb])}destroy(){this.destroyed||(tNe(this),this.__accessor__.destroy())}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[p7]}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(e){this.get(e)}get(e){return r4(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,i){return o4(this,e,i),this}watch(e,i,r){return oNe(this,e,i,r)}own(e){this.addHandles(e)}addHandles(e,i){let r=this[vb];C(r)&&(r=this[vb]=new Ki),r.add(e,i)}removeHandles(e){const i=this[vb];C(i)||i.remove(e)}hasHandles(e){const i=this[vb];return!!v(i)&&i.has(e)}_override(e,i){i===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,i){i==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,i){return this.__accessor__.internalSet(e,i),this}};ege=vb,tge=p7;const Cs=t=>{let e=class extends t{clone(){var l;const i=Jl(ml(this),"unable to clone instance of non-accessor class"),r=i.metadatas,s=i.store,n={},o=new Map;for(const c in r){const h=r[c],p=s==null?void 0:s.originOf(c),f=h.clonable;if(h.readOnly||f===!1||p!==Xi.USER&&p!==Xi.DEFAULTS&&p!==Xi.WEB_MAP&&p!==Xi.WEB_SCENE)continue;const m=this[c];let y=null;y=typeof f=="function"?f(m):f==="reference"?m:qz(m),m!=null&&y==null||(p===Xi.DEFAULTS?o.set(c,y):n[c]=y)}const a=new(Object.getPrototypeOf(this)).constructor(n);if(o.size){const c=(l=ml(a))==null?void 0:l.store;if(c)for(const[h,p]of o)c.set(h,p,Xi.DEFAULTS)}return a}};return e=u([I("esri.core.Clonable")],e),e};let mie=class extends Cs($e){};mie=u([I("esri.core.Clonable")],mie);function M(){return[0,0,0]}function xs(t){return[t[0],t[1],t[2]]}function Xe(t,e,i){return[t,e,i]}function Kl(t){const e=M(),i=Math.min(3,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function jY(t,e){return new Float64Array(t,e,3)}function rge(){return M()}function sge(){return Xe(1,1,1)}function nge(){return Xe(1,0,0)}function oge(){return Xe(0,1,0)}function HY(){return Xe(0,0,1)}const Ma=rge(),_m=sge(),VNe=nge(),kNe=oge(),age=HY();Object.freeze(Object.defineProperty({__proto__:null,ONES:_m,UNIT_X:VNe,UNIT_Y:kNe,UNIT_Z:age,ZEROS:Ma,clone:xs,create:M,createView:jY,fromArray:Kl,fromValues:Xe,ones:sge,unitX:nge,unitY:oge,unitZ:HY,zeros:rge},Symbol.toStringTag,{value:"Module"}));let qY=1e-6;function Fa(){return qY}function BNe(t){qY=t}const WP=Math.random,zNe=Math.PI/180,GNe=180/Math.PI;function k6(t){return t*zNe}function jNe(t){return t*GNe}function HNe(t,e){return Math.abs(t-e)<=qY*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:WP,equals:HNe,getEpsilon:Fa,setEpsilon:BNe,toDegree:jNe,toRadian:k6},Symbol.toStringTag,{value:"Module"}));function je(t){const e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)}function he(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function fe(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t}function ve(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function be(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function B6(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function g4(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function qNe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function lge(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function f7(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function cge(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function uge(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function WNe(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function XNe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function ue(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function zw(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t}function Ar(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return Math.sqrt(i*i+r*r+s*s)}function Bo(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return i*i+r*r+s*s}function Ea(t){const e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r}function Pa(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function YNe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Oe(t,e){const i=e[0],r=e[1],s=e[2];let n=i*i+r*r+s*s;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n),t}function Ae(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Et(t,e,i){const r=e[0],s=e[1],n=e[2],o=i[0],a=i[1],l=i[2];return t[0]=s*l-n*a,t[1]=n*o-r*l,t[2]=r*a-s*o,t}function tn(t,e,i,r){const s=e[0],n=e[1],o=e[2];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t[2]=o+r*(i[2]-o),t}function ZNe(t,e,i,r,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),h=o*(3-2*n);return t[0]=e[0]*a+i[0]*l+r[0]*c+s[0]*h,t[1]=e[1]*a+i[1]*l+r[1]*c+s[1]*h,t[2]=e[2]*a+i[2]*l+r[2]*c+s[2]*h,t}function JNe(t,e,i,r,s,n){const o=1-n,a=o*o,l=n*n,c=a*o,h=3*n*a,p=3*l*o,f=l*n;return t[0]=e[0]*c+i[0]*h+r[0]*p+s[0]*f,t[1]=e[1]*c+i[1]*h+r[1]*p+s[1]*f,t[2]=e[2]*c+i[2]*h+r[2]*p+s[2]*f,t}function KNe(t,e){e=e||1;const i=WP,r=2*i()*Math.PI,s=2*i()-1,n=Math.sqrt(1-s*s)*e;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t[2]=s*e,t}function ut(t,e,i){const r=e[0],s=e[1],n=e[2];return t[0]=i[0]*r+i[4]*s+i[8]*n+i[12],t[1]=i[1]*r+i[5]*s+i[9]*n+i[13],t[2]=i[2]*r+i[6]*s+i[10]*n+i[14],t}function qc(t,e,i){const r=e[0],s=e[1],n=e[2];return t[0]=r*i[0]+s*i[3]+n*i[6],t[1]=r*i[1]+s*i[4]+n*i[7],t[2]=r*i[2]+s*i[5]+n*i[8],t}function kp(t,e,i){const r=i[0],s=i[1],n=i[2],o=i[3],a=e[0],l=e[1],c=e[2];let h=s*c-n*l,p=n*a-r*c,f=r*l-s*a,m=s*f-n*p,y=n*h-r*f,_=r*p-s*h;const b=2*o;return h*=b,p*=b,f*=b,m*=2,y*=2,_*=2,t[0]=a+h+m,t[1]=l+p+y,t[2]=c+f+_,t}function QNe(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[0],n[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),n[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function eFe(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),n[1]=s[1],n[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function tFe(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),n[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),n[2]=s[2],t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function hge(t,e){he(e$,t),he(t$,e),Oe(e$,e$),Oe(t$,t$);const i=Ae(e$,t$);return i>1?0:i<-1?Math.PI:Math.acos(i)}const e$=M(),t$=M();function iFe(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function cl(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Wv(t,e){if(t===e)return!0;const i=t[0],r=t[1],s=t[2],n=e[0],o=e[1],a=e[2],l=Fa();return Math.abs(i-n)<=l*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-o)<=l*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(s-a)<=l*Math.max(1,Math.abs(s),Math.abs(a))}function i0(t,e,i){const r=i[0]-e[0],s=i[1]-e[1],n=i[2]-e[2];let o=r*r+s*s+n*n;return o>0?(o=1/Math.sqrt(o),t[0]=r*o,t[1]=s*o,t[2]=n*o,t):(t[0]=0,t[1]=0,t[2]=0,t)}const po=be,rFe=B6,sFe=g4,XP=Ar,WY=Bo,Nc=je,m7=Ea,gie=Object.freeze(Object.defineProperty({__proto__:null,abs:f7,add:ve,angle:hge,bezier:JNe,ceil:qNe,copy:he,cross:Et,direction:i0,dist:XP,distance:Ar,div:sFe,divide:g4,dot:Ae,equals:Wv,exactEquals:cl,floor:lge,hermite:ZNe,inverse:YNe,len:Nc,length:je,lerp:tn,max:WNe,min:uge,mul:rFe,multiply:B6,negate:Pa,normalize:Oe,random:KNe,rotateX:QNe,rotateY:eFe,rotateZ:tFe,round:XNe,scale:ue,scaleAndAdd:zw,set:fe,sign:cge,sqrDist:WY,sqrLen:m7,squaredDistance:Bo,squaredLength:Ea,str:iFe,sub:po,subtract:be,transformMat3:qc,transformMat4:ut,transformQuat:kp},Symbol.toStringTag,{value:"Module"}));function Op(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function nr(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}function XY(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function dge(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function pge(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function fge(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function nFe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function oFe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function aFe(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t}function lFe(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t}function cFe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function XC(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function uFe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t}function mge(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return Math.sqrt(i*i+r*r+s*s+n*n)}function y4(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return i*i+r*r+s*s+n*n}function YY(t){const e=t[0],i=t[1],r=t[2],s=t[3];return Math.sqrt(e*e+i*i+r*r+s*s)}function ZY(t){const e=t[0],i=t[1],r=t[2],s=t[3];return e*e+i*i+r*r+s*s}function hFe(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function dFe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function gge(t,e){const i=e[0],r=e[1],s=e[2],n=e[3];let o=i*i+r*r+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),t[0]=i*o,t[1]=r*o,t[2]=s*o,t[3]=n*o),t}function yge(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function z6(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=e[3];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t[2]=o+r*(i[2]-o),t[3]=a+r*(i[3]-a),t}function pFe(t,e){const i=WP;let r,s,n,o,a,l;e=e||1;do r=2*i()-1,s=2*i()-1,a=r*r+s*s;while(a>=1);do n=2*i()-1,o=2*i()-1,l=n*n+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return t[0]=e*r,t[1]=e*s,t[2]=e*n*c,t[3]=e*o*c,t}function qu(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3];return t[0]=i[0]*r+i[4]*s+i[8]*n+i[12]*o,t[1]=i[1]*r+i[5]*s+i[9]*n+i[13]*o,t[2]=i[2]*r+i[6]*s+i[10]*n+i[14]*o,t[3]=i[3]*r+i[7]*s+i[11]*n+i[15]*o,t}function fFe(t,e,i){const r=e[0],s=e[1],n=e[2],o=i[0],a=i[1],l=i[2],c=i[3],h=c*r+a*n-l*s,p=c*s+l*r-o*n,f=c*n+o*s-a*r,m=-o*r-a*s-l*n;return t[0]=h*c+m*-o+p*-l-f*-a,t[1]=p*c+m*-a+f*-o-h*-l,t[2]=f*c+m*-l+h*-a-p*-o,t[3]=e[3],t}function mFe(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function mE(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function JY(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],h=Fa();return Math.abs(i-o)<=h*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=h*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=h*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=h*Math.max(1,Math.abs(n),Math.abs(c))}const gFe=dge,yFe=pge,_Fe=fge,vFe=mge,bFe=y4,wFe=YY,xFe=ZY,_ge=Object.freeze(Object.defineProperty({__proto__:null,add:XY,ceil:nFe,copy:Op,dist:vFe,distance:mge,div:_Fe,divide:fge,dot:yge,equals:JY,exactEquals:mE,floor:oFe,inverse:dFe,len:wFe,length:YY,lerp:z6,max:lFe,min:aFe,mul:yFe,multiply:pge,negate:hFe,normalize:gge,random:pFe,round:cFe,scale:XC,scaleAndAdd:uFe,set:nr,sqrDist:bFe,sqrLen:xFe,squaredDistance:y4,squaredLength:ZY,str:mFe,sub:gFe,subtract:dge,transformMat4:qu,transformQuat:fFe},Symbol.toStringTag,{value:"Module"})),yie=new Float32Array(1);function YE(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function we(t,e,i){return Math.min(Math.max(t,e),i)}function Yp(t){return(t&t-1)==0}function dRt(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function pRt(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function Yt(t,e,i){return t+(e-t)*i}function ii(t){return t*Math.PI/180}function yl(t){return 180*t/Math.PI}function vV(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function Dn(t){return Math.acos(we(t,-1,1))}function pd(t){return Math.asin(we(t,-1,1))}function gE(t,e,i=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=i}const _4=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function TFe(t){return _4.setFloat64(0,t),_4.getBigInt64(0)}function SFe(t){return _4.setBigInt64(0,t),_4.getFloat64(0)}const bV=BigInt("1000000");EFe(1);function EFe(t){const e=TFe(t=Math.abs(t)),i=SFe(e<=bV?bV:e-bV);return Math.abs(t-i)}function CFe(t,e,i=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const r=Math.abs(t-e),s=Math.abs(t),n=Math.abs(e);if(t===0||e===0||s<1e-12&&n<1e-12){if(r>.01*i)return!1}else if(r/(s+n)>i)return!1;return!0}function AFe(t){return vge(Math.max(-g7,Math.min(t,g7)))}function vge(t){return yie[0]=t,yie[0]}function ZE(t,e,i){const r=we((i-t)/(e-t),0,1);return r*r*(3-2*r)}function _ie(t,e){const i=je(t),r=pd(t[2]/i),s=Math.atan2(t[1]/i,t[0]/i);return fe(e,i,r,s),e}function fRt(t,e,i){return nr(t,e[0],e[1],e[2],e[3]*i)}function mRt(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],r=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(gE(e,1)&&gE(i,1)&&gE(r,1))}const g7=vge(34028234663852886e22);let Xv=class{constructor(e,i){this.min=e,this.max=i,this.range=i-e}ndiff(e,i=0){return Math.ceil((e-i)/this.range)*this.range+i}_normalize(e,i,r,s=0,n=!1){return(r-=s)<e?r+=this.ndiff(e-r):r>i&&(r-=this.ndiff(r-i)),n&&r===i&&(r=e),r+s}normalize(e,i=0,r=!1){return this._normalize(this.min,this.max,e,i,r)}clamp(e,i=0){return we(e-i,this.min,this.max)+i}monotonic(e,i,r){return e<i?i:i+this.ndiff(e-i,r)}minimalMonotonic(e,i,r){return this._normalize(e,e+this.range,i,r)}center(e,i,r){return i=this.monotonic(e,i,r),this.normalize((e+i)/2,r)}diff(e,i,r){return this.monotonic(e,i,r)-e}shortestSignedDiff(e,i){e=this.normalize(e);const r=(i=this.normalize(i))-e,s=i<e?this.minimalMonotonic(e,i)-e:i-this.minimalMonotonic(i,e);return Math.abs(r)<Math.abs(s)?r:s}contains(e,i,r){return i=this.minimalMonotonic(e,i),(r=this.minimalMonotonic(e,r))>e&&r<i}};function KY(t){for(const e in t){const i=t[e];i instanceof Function&&(t[e]=i.bind(t))}return t}const OFe=KY(new Xv(0,2*Math.PI)),Yv=KY(new Xv(-Math.PI,Math.PI)),QY=KY(new Xv(0,360));let RFe=class bge{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new bge;return this._values.forEach((r,s)=>{e&&e.has(s)||i.set(s,ae(r.value),r.origin)}),i}get(e,i){i=this._normalizeOrigin(i);const r=this._values.get(e);return i==null||(r==null?void 0:r.origin)===i?r==null?void 0:r.value:void 0}originOf(e){var i;return((i=this._values.get(e))==null?void 0:i.origin)??Xi.USER}keys(e){e=this._normalizeOrigin(e);const i=[...this._values.keys()];return e==null?i:i.filter(r=>{var s;return((s=this._values.get(r))==null?void 0:s.origin)===e})}set(e,i,r){if((r=this._normalizeOrigin(r))===Xi.DEFAULTS){const s=this._values.get(e);if(s&&s.origin!=null&&s.origin>r)return}this._values.set(e,new MFe(i,r))}delete(e,i){var r;(i=this._normalizeOrigin(i))!=null&&((r=this._values.get(e))==null?void 0:r.origin)!==i||this._values.delete(e)}has(e,i){var r;return(i=this._normalizeOrigin(i))!=null?((r=this._values.get(e))==null?void 0:r.origin)===i:this._values.has(e)}forEach(e){this._values.forEach(({value:i},r)=>e(i,r))}_normalizeOrigin(e){if(e!=null)return e===Xi.DEFAULTS?e:Xi.USER}},MFe=class{constructor(e,i){this.value=e,this.origin=i}};function wge(t,e,i){e.keys().forEach(s=>{i.set(s,e.get(s),Xi.DEFAULTS)});const r=t.metadatas;Object.keys(r).forEach(s=>{t.internalGet(s)&&i.set(s,t.internalGet(s),Xi.DEFAULTS)})}function PFe(t,e,i){if(!t||!t.read||t.read.enabled===!1||!t.read.source)return!1;const r=t.read.source;if(typeof r=="string"){if(r===e||r.includes(".")&&r.indexOf(e)===0&&Yte(r,i))return!0}else for(const s of r)if(s===e||s.includes(".")&&s.indexOf(e)===0&&Yte(s,i))return!0;return!1}function IFe(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function $Fe(t,e,i,r,s){let n=h7(e[i],s);IFe(n)&&(t[i]=!0);for(const o of Object.getOwnPropertyNames(e))n=h7(e[o],s),PFe(n,i,r)&&(t[o]=!0)}function LFe(t,e,i,r){const s=i.metadatas,n=GY(s[e],"any",r),o=n&&n.default;if(o===void 0)return;const a=typeof o=="function"?o.call(t,e,r):o;a!==void 0&&i.set(e,a)}const xge={origin:"service"};function Tge(t,e,i=xge){if(!e||typeof e!="object")return;const r=ml(t),s=r.metadatas,n={};for(const o of Object.getOwnPropertyNames(e))$Fe(n,s,o,e,i);r.setDefaultOrigin(i.origin);for(const o of Object.getOwnPropertyNames(n)){const a=h7(s[o],i).read,l=a&&a.source;let c;c=l&&typeof l=="string"?BP(e,l):e[o],a&&a.reader&&(c=a.reader.call(t,c,e,i)),c!==void 0&&r.set(o,c)}if(!i||!i.ignoreDefaults){r.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(s))n[o]||LFe(t,o,r,i)}r.setDefaultOrigin("user")}function DFe(t,e,i,r=xge){var n;const s={...r,messages:[]};i(s),(n=s.messages)==null||n.forEach(o=>{o.type!=="warning"||t.loaded?r&&r.messages&&r.messages.push(o):t.loadWarnings.push(o)})}function NFe(t,e,i,r,s){var o,a;const n={};return(a=(o=e.write)==null?void 0:o.writer)==null||a.call(t,r,n,i,s),n}function Sge(t,e,i,r,s,n){if(!r||!r.write)return!1;const o=t.get(i);if(!s&&r.write.overridePolicy){const a=r.write.overridePolicy.call(t,o,i,n);a!==void 0&&(s=a)}if(s||(s=r.write),!s||s.enabled===!1)return!1;if((o===null&&!s.allowNull&&!s.writerEnsuresNonNull||o===void 0)&&s.isRequired){const a=new W("web-document-write:property-required",`Missing value for required property '${i}' on '${t.declaredClass}'`,{propertyName:i,target:t});return a&&n&&n.messages?n.messages.push(a):a&&!n&&oe.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!s.allowNull&&!s.writerEnsuresNonNull||(!e.store.multipleOriginsSupported||e.store.originOf(i)===Xi.DEFAULTS)&&FFe(t,i,n,r,o)||!s.ignoreOrigin&&n&&n.origin&&e.store.multipleOriginsSupported&&e.store.originOf(i)<pv(n.origin))}function FFe(t,e,i,r,s){const n=r.default;if(n===void 0)return!1;if(r.defaultEquals!=null)return r.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const o=n.call(t,e,i);return Uy(o,s)}return!1}return n===s}function UFe(t,e,i,r){const s=ml(t),n=s.metadatas,o=Kme(n[e],r);return!!o&&Sge(t,s,e,o,i,r)}function Ege(t,e,i){var n,o;if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return QD(e,t.toJSON(i));const r=ml(t),s=r.metadatas;for(const a in s){const l=Kme(s[a],i);if(!Sge(t,r,a,l,void 0,i))continue;const c=t.get(a),h=NFe(t,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,i);Object.keys(h).length>0&&(e=QD(e,h),(o=(n=i==null?void 0:i.resources)==null?void 0:n.pendingOperations)!=null&&o.length&&i.resources.pendingOperations.push(Promise.all(i.resources.pendingOperations).then(()=>QD(e,h,()=>"replace-arrays"))),i&&i.writtenProperties&&i.writtenProperties.push({target:t,propName:a,oldOrigin:SDe(r.store.originOf(a)),newOrigin:i.origin}))}return e}const YP=t=>{let e=class extends t{constructor(...i){super(...i);const r=ml(this),s=r.store,n=new RFe;r.store=n,wge(r,s,n)}read(i,r){Tge(this,i,r)}write(i={},r){return Ege(this,i,r)}toJSON(i){return this.write({},i)}static fromJSON(i,r){return VFe.call(this,i,r)}};return e=u([I("esri.core.JSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function VFe(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const i=new this;return i.read(t,e),i}let Ie=class extends YP($e){};Ie=u([I("esri.core.JSONSupport")],Ie);const kFe=Object.prototype.toString;function BFe(t){const e="__accessorMetadata__"in t?mn(t):t;return function(...i){if(i.push(e),typeof i[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return zFe.apply(this,i)}}function zFe(t,e,i,r){L6(t,e).cast=r}function GFe(t){return(e,i)=>{L6(e,t).cast=e[i]}}function wi(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&kFe.call(t[0])==="[object Function]"?BFe(t[0]):t.length===1&&typeof t[0]=="string"?GFe(t[0]):void 0}function Qe(t,e,i){let r,s;return e===void 0||Array.isArray(e)?(s=t,i=e,r=[void 0]):(s=e,r=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;r.forEach(l=>{const c=Hme(n,l,s);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],i&&(c.read.source=(c.read.source||[]).concat(i))})}}function lt(t,e,i){let r,s;return e===void 0?(s=t,r=[void 0]):typeof e!="string"?(s=t,r=[void 0],i=e):(s=e,r=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;for(const l of r){const c=Hme(n,l,s);c.write&&typeof c.write=="object"||(c.write={}),i&&(c.write.target=i),c.write.writer=a[o]}}}let Gi=class{constructor(e,i={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=i,this.apiValues=[],this.jsonValues=[],this._apiToJSON=this._invertMap(e),this.apiValues=this._getKeysSorted(this._apiToJSON),this.jsonValues=this._getKeysSorted(this._jsonToAPI),this.read=r=>this.fromJSON(r),this.write=(r,s,n)=>{const o=this.toJSON(r);o!==void 0&&gl(n,o,s)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const i=this._apiToJSON[e];return this._options.useNumericKeys?+i:i}return this._options.ignoreUnknown?void 0:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}_invertMap(e){const i={};for(const r in e)i[e[r]]=r;return i}_getKeysSorted(e){const i=[];for(const r in e)i.push(r);return i.sort(),i}};function Ua(){return function(t,e){return new Gi(t,{ignoreUnknown:!0,...e})}}let eZ=class{constructor(e,i,r,s){this.semiMajorAxis=e,this.flattening=i,this.outerAtmosphereRimWidth=r;const n=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*n,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=s||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const Oi=new eZ(6378137,1/298.257223563,3e5,.006694379990137799),Em=new eZ(3396190,1/169.8944472236118,23e4),zy=new eZ(1737400,0,0);var Qh;(function(t){t[t.CGCS2000=4490]="CGCS2000",t[t.GCSMARS2000=104971]="GCSMARS2000",t[t.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",t[t.GCSMOON2000=104903]="GCSMOON2000"})(Qh||(Qh={}));let g;const D={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(g=2e3;g<=2045;g++)D[g]=0;for(g=2056;g<=2065;g++)D[g]=0;for(g=2067;g<=2135;g++)D[g]=0;for(g=2137;g<=2154;g++)D[g]=0;for(g=2161;g<=2170;g++)D[g]=0;for(g=2172;g<=2193;g++)D[g]=0;for(g=2195;g<=2198;g++)D[g]=0;for(g=2200;g<=2203;g++)D[g]=0;for(g=2205;g<=2217;g++)D[g]=0;for(g=2222;g<=2224;g++)D[g]=1;for(g=2225;g<=2250;g++)D[g]=2;for(g=2251;g<=2253;g++)D[g]=1;for(g=2257;g<=2264;g++)D[g]=2;for(g=2274;g<=2279;g++)D[g]=2;for(g=2280;g<=2282;g++)D[g]=1;for(g=2283;g<=2289;g++)D[g]=2;for(g=2290;g<=2292;g++)D[g]=0;for(g=2308;g<=2313;g++)D[g]=0;for(g=2315;g<=2491;g++)D[g]=0;for(g=2494;g<=2866;g++)D[g]=0;for(g=2867;g<=2869;g++)D[g]=1;for(g=2870;g<=2888;g++)D[g]=2;for(g=2891;g<=2895;g++)D[g]=2;for(g=2896;g<=2898;g++)D[g]=1;for(g=2902;g<=2908;g++)D[g]=2;for(g=2915;g<=2920;g++)D[g]=2;for(g=2921;g<=2923;g++)D[g]=1;for(g=2924;g<=2930;g++)D[g]=2;for(g=2931;g<=2962;g++)D[g]=0;for(g=2964;g<=2968;g++)D[g]=2;for(g=2969;g<=2973;g++)D[g]=0;for(g=2975;g<=2991;g++)D[g]=0;for(g=2995;g<=3051;g++)D[g]=0;for(g=3054;g<=3079;g++)D[g]=0;for(g=3081;g<=3088;g++)D[g]=0;for(g=3092;g<=3101;g++)D[g]=0;for(g=3106;g<=3138;g++)D[g]=0;for(g=3146;g<=3151;g++)D[g]=0;for(g=3153;g<=3166;g++)D[g]=0;for(g=3168;g<=3172;g++)D[g]=0;for(g=3174;g<=3203;g++)D[g]=0;for(g=3294;g<=3358;g++)D[g]=0;for(g=3367;g<=3403;g++)D[g]=0;for(g=3408;g<=3416;g++)D[g]=0;for(g=3417;g<=3438;g++)D[g]=2;for(g=3441;g<=3446;g++)D[g]=2;for(g=3447;g<=3450;g++)D[g]=0;for(g=3451;g<=3459;g++)D[g]=2;for(g=3460;g<=3478;g++)D[g]=0;for(g=3554;g<=3559;g++)D[g]=0;for(g=3560;g<=3570;g++)D[g]=2;for(g=3571;g<=3581;g++)D[g]=0;for(g=3594;g<=3597;g++)D[g]=0;for(g=3601;g<=3604;g++)D[g]=0;for(g=3637;g<=3639;g++)D[g]=0;for(g=3665;g<=3667;g++)D[g]=0;for(g=3693;g<=3695;g++)D[g]=0;for(g=3701;g<=3727;g++)D[g]=0;for(g=3728;g<=3739;g++)D[g]=2;for(g=3740;g<=3751;g++)D[g]=0;for(g=3753;g<=3760;g++)D[g]=2;for(g=3761;g<=3773;g++)D[g]=0;for(g=3775;g<=3777;g++)D[g]=0;for(g=3779;g<=3781;g++)D[g]=0;for(g=3783;g<=3785;g++)D[g]=0;for(g=3788;g<=3791;g++)D[g]=0;for(g=3797;g<=3802;g++)D[g]=0;for(g=3814;g<=3816;g++)D[g]=0;for(g=3825;g<=3829;g++)D[g]=0;for(g=3832;g<=3841;g++)D[g]=0;for(g=3844;g<=3852;g++)D[g]=0;for(g=3873;g<=3885;g++)D[g]=0;for(g=3890;g<=3893;g++)D[g]=0;for(g=3907;g<=3912;g++)D[g]=0;for(g=3942;g<=3950;g++)D[g]=0;for(g=3968;g<=3970;g++)D[g]=0;for(g=3973;g<=3976;g++)D[g]=0;for(g=3986;g<=3989;g++)D[g]=0;for(g=3994;g<=3997;g++)D[g]=0;for(g=4048;g<=4051;g++)D[g]=0;for(g=4056;g<=4063;g++)D[g]=0;for(g=4093;g<=4096;g++)D[g]=0;for(g=4390;g<=4398;g++)D[g]=0;for(g=4399;g<=4413;g++)D[g]=2;for(g=4418;g<=4433;g++)D[g]=2;for(g=4455;g<=4457;g++)D[g]=2;for(g=4484;g<=4489;g++)D[g]=0;for(g=4491;g<=4554;g++)D[g]=0;for(g=4568;g<=4589;g++)D[g]=0;for(g=4652;g<=4656;g++)D[g]=0;for(g=4766;g<=4800;g++)D[g]=0;for(g=5014;g<=5016;g++)D[g]=0;for(g=5069;g<=5072;g++)D[g]=0;for(g=5105;g<=5130;g++)D[g]=0;for(g=5173;g<=5188;g++)D[g]=0;for(g=5253;g<=5259;g++)D[g]=0;for(g=5269;g<=5275;g++)D[g]=0;for(g=5292;g<=5311;g++)D[g]=0;for(g=5329;g<=5331;g++)D[g]=0;for(g=5343;g<=5349;g++)D[g]=0;for(g=5355;g<=5357;g++)D[g]=0;for(g=5387;g<=5389;g++)D[g]=0;for(g=5459;g<=5463;g++)D[g]=0;for(g=5479;g<=5482;g++)D[g]=0;for(g=5518;g<=5520;g++)D[g]=0;for(g=5530;g<=5539;g++)D[g]=0;for(g=5550;g<=5552;g++)D[g]=0;for(g=5562;g<=5583;g++)D[g]=0;for(g=5623;g<=5625;g++)D[g]=2;for(g=5631;g<=5639;g++)D[g]=0;for(g=5649;g<=5653;g++)D[g]=0;for(g=5663;g<=5680;g++)D[g]=0;for(g=5682;g<=5685;g++)D[g]=0;for(g=5875;g<=5877;g++)D[g]=0;for(g=5896;g<=5899;g++)D[g]=0;for(g=5921;g<=5940;g++)D[g]=0;for(g=6050;g<=6125;g++)D[g]=0;for(g=6244;g<=6275;g++)D[g]=0;for(g=6328;g<=6348;g++)D[g]=0;for(g=6350;g<=6356;g++)D[g]=0;for(g=6366;g<=6372;g++)D[g]=0;for(g=6381;g<=6387;g++)D[g]=0;for(g=6393;g<=6404;g++)D[g]=0;for(g=6480;g<=6483;g++)D[g]=0;for(g=6511;g<=6514;g++)D[g]=0;for(g=6579;g<=6581;g++)D[g]=0;for(g=6619;g<=6624;g++)D[g]=0;for(g=6625;g<=6627;g++)D[g]=2;for(g=6628;g<=6632;g++)D[g]=0;for(g=6634;g<=6637;g++)D[g]=0;for(g=6669;g<=6692;g++)D[g]=0;for(g=6707;g<=6709;g++)D[g]=0;for(g=6720;g<=6723;g++)D[g]=0;for(g=6732;g<=6738;g++)D[g]=0;for(g=6931;g<=6933;g++)D[g]=0;for(g=6956;g<=6959;g++)D[g]=0;for(g=7005;g<=7007;g++)D[g]=0;for(g=7057;g<=7070;g++)D[g]=2;for(g=7074;g<=7082;g++)D[g]=0;for(g=7109;g<=7118;g++)D[g]=0;for(g=7119;g<=7127;g++)D[g]=1;for(g=7374;g<=7376;g++)D[g]=0;for(g=7528;g<=7586;g++)D[g]=0;for(g=7587;g<=7645;g++)D[g]=2;for(g=7692;g<=7696;g++)D[g]=0;for(g=7755;g<=7787;g++)D[g]=0;for(g=7791;g<=7795;g++)D[g]=0;for(g=7799;g<=7801;g++)D[g]=0;for(g=7803;g<=7805;g++)D[g]=0;for(g=7825;g<=7831;g++)D[g]=0;for(g=7845;g<=7859;g++)D[g]=0;for(g=8013;g<=8032;g++)D[g]=0;for(g=8065;g<=8068;g++)D[g]=1;for(g=8518;g<=8529;g++)D[g]=2;for(g=8533;g<=8536;g++)D[g]=2;for(g=8538;g<=8540;g++)D[g]=2;for(g=8677;g<=8679;g++)D[g]=0;for(g=8836;g<=8840;g++)D[g]=0;for(g=8857;g<=8859;g++)D[g]=0;for(g=8908;g<=8910;g++)D[g]=0;for(g=9154;g<=9159;g++)D[g]=0;for(g=9205;g<=9218;g++)D[g]=0;for(g=9271;g<=9273;g++)D[g]=0;for(g=9295;g<=9297;g++)D[g]=0;for(g=9356;g<=9360;g++)D[g]=0;for(g=9404;g<=9407;g++)D[g]=0;for(g=9476;g<=9482;g++)D[g]=0;for(g=9487;g<=9494;g++)D[g]=0;for(g=9697;g<=9699;g++)D[g]=0;for(g=9821;g<=9865;g++)D[g]=0;for(g=20002;g<=20032;g++)D[g]=0;for(g=20047;g<=20049;g++)D[g]=0;for(g=20062;g<=20092;g++)D[g]=0;for(g=20135;g<=20138;g++)D[g]=0;for(g=20248;g<=20258;g++)D[g]=0;for(g=20348;g<=20358;g++)D[g]=0;for(g=20436;g<=20440;g++)D[g]=0;for(g=20822;g<=20824;g++)D[g]=0;for(g=20904;g<=20932;g++)D[g]=0;for(g=20934;g<=20936;g++)D[g]=0;for(g=21004;g<=21032;g++)D[g]=0;for(g=21035;g<=21037;g++)D[g]=0;for(g=21095;g<=21097;g++)D[g]=0;for(g=21148;g<=21150;g++)D[g]=0;for(g=21207;g<=21264;g++)D[g]=0;for(g=21307;g<=21364;g++)D[g]=0;for(g=21413;g<=21423;g++)D[g]=0;for(g=21453;g<=21463;g++)D[g]=0;for(g=21473;g<=21483;g++)D[g]=0;for(g=21780;g<=21782;g++)D[g]=0;for(g=21891;g<=21894;g++)D[g]=0;for(g=21896;g<=21899;g++)D[g]=0;for(g=22171;g<=22177;g++)D[g]=0;for(g=22181;g<=22187;g++)D[g]=0;for(g=22191;g<=22197;g++)D[g]=0;for(g=22207;g<=22222;g++)D[g]=0;for(g=22234;g<=22236;g++)D[g]=0;for(g=22243;g<=22250;g++)D[g]=0;for(g=22262;g<=22265;g++)D[g]=0;for(g=22307;g<=22322;g++)D[g]=0;for(g=22348;g<=22357;g++)D[g]=0;for(g=22407;g<=22422;g++)D[g]=0;for(g=22462;g<=22465;g++)D[g]=0;for(g=22521;g<=22525;g++)D[g]=0;for(g=22607;g<=22622;g++)D[g]=0;for(g=22641;g<=22646;g++)D[g]=0;for(g=22648;g<=22657;g++)D[g]=0;for(g=22707;g<=22722;g++)D[g]=0;for(g=22762;g<=22765;g++)D[g]=0;for(g=22991;g<=22994;g++)D[g]=0;for(g=23028;g<=23038;g++)D[g]=0;for(g=23830;g<=23853;g++)D[g]=0;for(g=23866;g<=23872;g++)D[g]=0;for(g=23877;g<=23884;g++)D[g]=0;for(g=23886;g<=23894;g++)D[g]=0;for(g=23946;g<=23948;g++)D[g]=0;for(g=24311;g<=24313;g++)D[g]=0;for(g=24342;g<=24347;g++)D[g]=0;for(g=24370;g<=24374;g++)D[g]=10;for(g=24375;g<=24381;g++)D[g]=0;for(g=24718;g<=24721;g++)D[g]=0;for(g=24817;g<=24821;g++)D[g]=0;for(g=24877;g<=24882;g++)D[g]=0;for(g=24891;g<=24893;g++)D[g]=0;for(g=25391;g<=25395;g++)D[g]=0;for(g=25828;g<=25838;g++)D[g]=0;for(g=26191;g<=26195;g++)D[g]=0;for(g=26391;g<=26393;g++)D[g]=0;for(g=26701;g<=26722;g++)D[g]=0;for(g=26729;g<=26799;g++)D[g]=2;for(g=26801;g<=26803;g++)D[g]=2;for(g=26811;g<=26813;g++)D[g]=2;for(g=26847;g<=26870;g++)D[g]=2;for(g=26891;g<=26899;g++)D[g]=0;for(g=26901;g<=26923;g++)D[g]=0;for(g=26929;g<=26946;g++)D[g]=0;for(g=26948;g<=26998;g++)D[g]=0;for(g=27037;g<=27040;g++)D[g]=0;for(g=27205;g<=27232;g++)D[g]=0;for(g=27258;g<=27260;g++)D[g]=0;for(g=27391;g<=27398;g++)D[g]=0;for(g=27561;g<=27564;g++)D[g]=0;for(g=27571;g<=27574;g++)D[g]=0;for(g=27581;g<=27584;g++)D[g]=0;for(g=27591;g<=27594;g++)D[g]=0;for(g=28191;g<=28193;g++)D[g]=0;for(g=28348;g<=28358;g++)D[g]=0;for(g=28402;g<=28432;g++)D[g]=0;for(g=28462;g<=28492;g++)D[g]=0;for(g=29118;g<=29122;g++)D[g]=0;for(g=29168;g<=29172;g++)D[g]=0;for(g=29177;g<=29185;g++)D[g]=0;for(g=29187;g<=29195;g++)D[g]=0;for(g=29900;g<=29903;g++)D[g]=0;for(g=30161;g<=30179;g++)D[g]=0;for(g=30491;g<=30494;g++)D[g]=0;for(g=30729;g<=30732;g++)D[g]=0;for(g=31251;g<=31259;g++)D[g]=0;for(g=31265;g<=31268;g++)D[g]=0;for(g=31275;g<=31279;g++)D[g]=0;for(g=31281;g<=31297;g++)D[g]=0;for(g=31461;g<=31469;g++)D[g]=0;for(g=31491;g<=31495;g++)D[g]=0;for(g=31917;g<=31922;g++)D[g]=0;for(g=31965;g<=32e3;g++)D[g]=0;for(g=32001;g<=32003;g++)D[g]=2;for(g=32005;g<=32031;g++)D[g]=2;for(g=32033;g<=32060;g++)D[g]=2;for(g=32064;g<=32067;g++)D[g]=2;for(g=32074;g<=32077;g++)D[g]=2;for(g=32081;g<=32086;g++)D[g]=0;for(g=32107;g<=32130;g++)D[g]=0;for(g=32133;g<=32159;g++)D[g]=0;for(g=32164;g<=32167;g++)D[g]=2;for(g=32180;g<=32199;g++)D[g]=0;for(g=32201;g<=32260;g++)D[g]=0;for(g=32301;g<=32360;g++)D[g]=0;for(g=32601;g<=32662;g++)D[g]=0;for(g=32664;g<=32667;g++)D[g]=2;for(g=32701;g<=32761;g++)D[g]=0;for(g=53001;g<=53004;g++)D[g]=0;for(g=53008;g<=53019;g++)D[g]=0;for(g=53021;g<=53032;g++)D[g]=0;for(g=53034;g<=53037;g++)D[g]=0;for(g=53042;g<=53046;g++)D[g]=0;for(g=53074;g<=53080;g++)D[g]=0;for(g=54001;g<=54004;g++)D[g]=0;for(g=54008;g<=54019;g++)D[g]=0;for(g=54021;g<=54032;g++)D[g]=0;for(g=54034;g<=54037;g++)D[g]=0;for(g=54042;g<=54046;g++)D[g]=0;for(g=54048;g<=54053;g++)D[g]=0;for(g=54074;g<=54080;g++)D[g]=0;for(g=54098;g<=54101;g++)D[g]=0;for(g=102001;g<=102040;g++)D[g]=0;for(g=102042;g<=102063;g++)D[g]=0;for(g=102065;g<=102067;g++)D[g]=0;for(g=102070;g<=102117;g++)D[g]=0;for(g=102122;g<=102216;g++)D[g]=0;for(g=102221;g<=102377;g++)D[g]=0;for(g=102382;g<=102388;g++)D[g]=0;for(g=102389;g<=102398;g++)D[g]=2;for(g=102399;g<=102444;g++)D[g]=0;for(g=102445;g<=102447;g++)D[g]=2;for(g=102448;g<=102458;g++)D[g]=0;for(g=102459;g<=102468;g++)D[g]=2;for(g=102469;g<=102499;g++)D[g]=0;for(g=102500;g<=102519;g++)D[g]=1;for(g=102520;g<=102524;g++)D[g]=0;for(g=102525;g<=102529;g++)D[g]=2;for(g=102530;g<=102588;g++)D[g]=0;for(g=102590;g<=102598;g++)D[g]=0;for(g=102601;g<=102603;g++)D[g]=0;for(g=102605;g<=102628;g++)D[g]=0;for(g=102629;g<=102646;g++)D[g]=2;for(g=102648;g<=102700;g++)D[g]=2;for(g=102701;g<=102703;g++)D[g]=0;for(g=102707;g<=102730;g++)D[g]=2;for(g=102733;g<=102758;g++)D[g]=2;for(g=102767;g<=102900;g++)D[g]=0;for(g=102901;g<=102933;g++)D[g]=2;for(g=102934;g<=102950;g++)D[g]=13;for(g=102951;g<=102955;g++)D[g]=0;for(g=102961;g<=102963;g++)D[g]=0;for(g=102965;g<=102969;g++)D[g]=0;for(g=102971;g<=102973;g++)D[g]=0;for(g=102975;g<=102989;g++)D[g]=0;for(g=102990;g<=102992;g++)D[g]=1;for(g=102997;g<=103002;g++)D[g]=0;for(g=103003;g<=103008;g++)D[g]=2;for(g=103009;g<=103011;g++)D[g]=0;for(g=103012;g<=103014;g++)D[g]=2;for(g=103019;g<=103021;g++)D[g]=0;for(g=103022;g<=103024;g++)D[g]=2;for(g=103029;g<=103031;g++)D[g]=0;for(g=103032;g<=103034;g++)D[g]=2;for(g=103065;g<=103068;g++)D[g]=0;for(g=103074;g<=103076;g++)D[g]=0;for(g=103077;g<=103079;g++)D[g]=1;for(g=103080;g<=103082;g++)D[g]=0;for(g=103083;g<=103085;g++)D[g]=2;for(g=103090;g<=103093;g++)D[g]=0;for(g=103097;g<=103099;g++)D[g]=0;for(g=103100;g<=103102;g++)D[g]=2;for(g=103107;g<=103109;g++)D[g]=0;for(g=103110;g<=103112;g++)D[g]=2;for(g=103113;g<=103116;g++)D[g]=0;for(g=103117;g<=103120;g++)D[g]=2;for(g=103153;g<=103157;g++)D[g]=0;for(g=103158;g<=103162;g++)D[g]=2;for(g=103163;g<=103165;g++)D[g]=0;for(g=103166;g<=103168;g++)D[g]=1;for(g=103169;g<=103171;g++)D[g]=2;for(g=103186;g<=103188;g++)D[g]=0;for(g=103189;g<=103191;g++)D[g]=2;for(g=103192;g<=103195;g++)D[g]=0;for(g=103196;g<=103199;g++)D[g]=2;for(g=103200;g<=103224;g++)D[g]=0;for(g=103225;g<=103227;g++)D[g]=1;for(g=103232;g<=103237;g++)D[g]=0;for(g=103238;g<=103243;g++)D[g]=2;for(g=103244;g<=103246;g++)D[g]=0;for(g=103247;g<=103249;g++)D[g]=2;for(g=103254;g<=103256;g++)D[g]=0;for(g=103257;g<=103259;g++)D[g]=2;for(g=103264;g<=103266;g++)D[g]=0;for(g=103267;g<=103269;g++)D[g]=2;for(g=103300;g<=103375;g++)D[g]=0;for(g=103381;g<=103383;g++)D[g]=0;for(g=103384;g<=103386;g++)D[g]=1;for(g=103387;g<=103389;g++)D[g]=0;for(g=103390;g<=103392;g++)D[g]=2;for(g=103397;g<=103399;g++)D[g]=0;for(g=103400;g<=103471;g++)D[g]=2;for(g=103476;g<=103478;g++)D[g]=0;for(g=103479;g<=103481;g++)D[g]=2;for(g=103486;g<=103488;g++)D[g]=0;for(g=103489;g<=103491;g++)D[g]=2;for(g=103492;g<=103495;g++)D[g]=0;for(g=103496;g<=103499;g++)D[g]=2;for(g=103528;g<=103543;g++)D[g]=0;for(g=103544;g<=103548;g++)D[g]=2;for(g=103549;g<=103551;g++)D[g]=0;for(g=103552;g<=103554;g++)D[g]=1;for(g=103555;g<=103557;g++)D[g]=2;for(g=103558;g<=103560;g++)D[g]=0;for(g=103571;g<=103573;g++)D[g]=0;for(g=103574;g<=103576;g++)D[g]=2;for(g=103577;g<=103580;g++)D[g]=0;for(g=103581;g<=103583;g++)D[g]=2;for(g=103595;g<=103694;g++)D[g]=0;for(g=103696;g<=103699;g++)D[g]=0;for(g=103700;g<=103793;g++)D[g]=2;for(g=103794;g<=103890;g++)D[g]=0;for(g=103891;g<=103896;g++)D[g]=2;for(g=103900;g<=103971;g++)D[g]=2;for(g=103972;g<=103977;g++)D[g]=0;for(g=112e3;g<=112101;g++)D[g]=0;const jFe={102113:!0,102100:!0,3857:!0,3785:!0},HFe={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},vie='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',i$=[-20037508342788905e-9,20037508342788905e-9],r$=[-20037508342787e-6,20037508342787e-6],Cge={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:i$,origin:r$,dx:1e-5},102100:{wkTemplate:vie,valid:i$,origin:r$,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:i$,origin:r$,dx:1e-5},3857:{wkTemplate:vie,valid:i$,origin:r$,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function rn(t,e){return t===e||!C(t)&&!C(e)&&(t.wkid!=null||e.wkid!=null?t.wkid===e.wkid||bx(t)&&bx(e)||e.latestWkid!=null&&t.wkid===e.latestWkid||t.latestWkid!=null&&e.wkid===t.latestWkid:!(!t.wkt||!e.wkt)&&t.wkt.toUpperCase()===e.wkt.toUpperCase())}function Bp(t){return sa(t)&&t.wkid&&Cge[t.wkid]||null}function Age(t){return!!sa(t)&&(t.wkid?D[t.wkid]==null:!!t.wkt&&!!/^\s*GEOGCS/i.test(t.wkt))}function P3(t){return!(Zm(t)||Jm(t))}function I3(t){return sa(t)&&t.wkid===4326}function Oge(t){return sa(t)&&t.wkid===Qh.CGCS2000}function bx(t){return sa(t)&&t.wkid!=null&&jFe[t.wkid]===!0}function tZ(t){return sa(t)&&t.wkid===32662}function iZ(t){return t===Qh.GCSMARS2000||t===Qh.GCSMARS2000_SPHERE}function Zm(t){return sa(t)&&t.wkid!=null&&iZ(t.wkid)}function rZ(t){return t===Qh.GCSMOON2000}function Jm(t){return sa(t)&&t.wkid!=null&&rZ(t.wkid)}function qFe(t){return sa(t)&&t.wkid!=null&&HFe[t.wkid]===!0}function sa(t){return v(t)&&(t.wkid!=null&&t.wkid>=2e3||t.wkt!=null)}const WFe={wkid:4326,wkt:Fm(Cge[4326].wkTemplate,{Central_Meridian:"0.0"})},XFe={wkid:102100,latestWkid:3857},YFe={wkid:32662};function sZ(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const Rge=sZ(Oi),nZ=sZ(Em),oZ=sZ(zy),Mge={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${Oi.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`};function tr(t){return v(t)&&(Zm(t)||rn(t,nZ))?Em:v(t)&&(Jm(t)||rn(t,oZ))?zy:Oi}function wRt(t){return iZ(t)?Em:rZ(t)?zy:Oi}const aZ=39.37,ZFe=Oi.radius*Math.PI/200,Pge=/UNIT\[([^\]]+)\]\]$/i,rx=D,Ige=/UNIT\[([^\]]+)\]/i,JFe=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),KFe=Ua()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),pf=t=>t*t,C0=t=>t*t*t,$3={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:pf(.001)},"square-centimeters":{inBaseUnits:pf(.01)},"square-decimeters":{inBaseUnits:pf(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:pf(1e3)},"square-inches":{inBaseUnits:pf(.0254)},"square-feet":{inBaseUnits:pf(.3048)},"square-yards":{inBaseUnits:pf(.9144)},"square-miles":{inBaseUnits:pf(1609.344)},"square-us-feet":{inBaseUnits:pf(1200/3937)},acres:{inBaseUnits:.0015625*pf(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*C0(.001)},"cubic-centimeters":{inBaseUnits:1e3*C0(.01)},"cubic-decimeters":{inBaseUnits:1e3*C0(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*C0(1e3)},"cubic-inches":{inBaseUnits:1e3*C0(.0254)},"cubic-feet":{inBaseUnits:1e3*C0(.3048)},"cubic-yards":{inBaseUnits:1e3*C0(.9144)},"cubic-miles":{inBaseUnits:1e3*C0(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},QFe=(()=>{const t={};for(const e in $3)for(const i in $3[e].units)t[i]=e;return t})();function e4e(t,e,i){return t*$3[i].units[e].inBaseUnits}function t4e(t,e,i){return t/$3[i].units[e].inBaseUnits}const i4e=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function y7(t){const e=QFe[t];if(!e)throw new Error("unknown type");return e}function bie(t,e=null){return e=e||y7(t),$3[e].baseUnit===t}function An(t,e,i){if(e===i)return t;const r=y7(e);if(r!==y7(i))throw new Error("incompatible units");const s=bie(e,r)?t:e4e(t,e,r);return bie(i,r)?s:t4e(s,i,r)}function xRt(t,e,i){switch(i){case"metric":return $ge(t,e);case"imperial":return Dge(t,e);default:return i}}function TRt(t,e,i){switch(i){case"metric":return Lge(t,e);case"imperial":return Nge(t,e);default:return i}}function $ge(t,e){const i=An(t,e,"meters");return Math.abs(i)<3e3?"meters":"kilometers"}function Lge(t,e){const i=An(t,e,"meters");return Math.abs(i)<1e5?"meters":"kilometers"}function Dge(t,e){const i=An(t,e,"feet");return Math.abs(i)<1e3?"feet":"miles"}function Nge(t,e){const i=An(t,e,"feet");return Math.abs(i)<1e5?"feet":"miles"}function SRt(t,e){const i=An(t,e,"square-meters");return Math.abs(i)<3e6?"square-meters":"square-kilometers"}function ERt(t,e){const i=An(t,e,"square-feet");return Math.abs(i)<1e6?"square-feet":"square-miles"}function r4e(t,e,i){return An(t,e,"meters")/(i*Math.PI/180)}function Fge(t){return KFe.fromJSON(t.toLowerCase())||null}function wx(t){if(v(t)&&!P3(t))return 1;const e=_l(t);return e>1e5?1:e}function s4e(t){return _l(t)>=tr(t).metersPerDegree?"meters":G6(t)}function _l(t,e=Oi.metersPerDegree){return Gt(n4e(t,!0),e)}function n4e(t,e=!1){const i=v(t)?t.wkid:null,r=v(t)?t.wkt:null;let s=null;if(i){if(iZ(i))return Em.metersPerDegree;if(rZ(i))return zy.metersPerDegree;s=rx.values[rx[i]],!s&&e&&JFe.has(i)&&(s=ZFe)}else r&&(kge(r)?s=wie(Pge.exec(r),s):Vge(r)&&(s=wie(Ige.exec(r),s)));return s}function wie(t,e){return t&&t[1]?Uge(t[1]):e}function Uge(t){return parseFloat(t.split(",")[1])}function G6(t){const e=v(t)?t.wkid:null,i=v(t)?t.wkt:null;let r=null;if(e)r=rx.units[rx[e]];else if(i){const s=kge(i)?Pge:Vge(i)?Ige:null;if(s){const n=s.exec(i);n&&n[1]&&(r=a4e(n[1]))}}return v(r)?Fge(r):null}function CRt(t){const e=G6(t);return C(e)||!i4e.includes(e)?null:e}function Vge(t){return/^GEOCCS/i.test(t)}function kge(t){return/^PROJCS/i.test(t)}const o4e=1e-7;function a4e(t){const e=/[\\"\\']{1}([^\\"\\']+)/.exec(t);let i=e&&e[1];if(!i||!rx.units.includes(i)){const r=Uge(t);i=null;const s=rx.values;for(let n=0;n<s.length;++n)if(Math.abs(r-s[n])<o4e){i=rx.units[n];break}}return i}function ARt(t){const e=G6(t);if(C(e))return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const l4e={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},c4e={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},u4e={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},h4e=Ua()(l4e),d4e=Ua()(c4e),ORt=Ua()(u4e);var If;let Pr=If=class extends Ie{static fromJSON(t){if(!t)return null;if(t.wkid){if(t.wkid===102100)return If.WebMercator;if(t.wkid===4326)return If.WGS84}const e=new If;return e.read(t),e}constructor(t){super(t),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(t){return t&&typeof t=="object"?t:{[typeof t=="string"?"wkt":"wkid"]:t}}get isWGS84(){return I3(this)}get isWebMercator(){return bx(this)}get isGeographic(){return Age(this)}get isWrappable(){return qFe(this)}get metersPerUnit(){return _l(this)}get unit(){return G6(this)||(this.isGeographic?"degrees":null)}writeWkt(t,e){this.wkid||(e.wkt=t)}clone(){if(this===If.WGS84)return If.WGS84;if(this===If.WebMercator)return If.WebMercator;const t=new If;return this.wkid!=null?(t.wkid=this.wkid,this.latestWkid!=null&&(t.latestWkid=this.latestWkid),this.vcsWkid!=null&&(t.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(t.latestVcsWkid=this.latestVcsWkid)):this.wkt!=null&&(t.wkt=this.wkt),this.imageCoordinateSystem&&(t.imageCoordinateSystem=ae(this.imageCoordinateSystem)),t}equals(t){if(t==null)return!1;if(this.imageCoordinateSystem||t.imageCoordinateSystem){if(this.imageCoordinateSystem==null||t.imageCoordinateSystem==null)return!1;const{id:e,referenceServiceName:i}=t.imageCoordinateSystem,{geodataXform:r}=t.imageCoordinateSystem,s=this.imageCoordinateSystem;return e==null||r?JSON.stringify(s)===JSON.stringify(t.imageCoordinateSystem):i?s.id===e&&s.referenceServiceName===i:s.id===e}return rn(this,t)}toJSON(t){return this.write(void 0,t)}};Pr.GCS_NAD_1927=null,Pr.WGS84=null,Pr.WebMercator=null,Pr.PlateCarree=null,u([d({readOnly:!0})],Pr.prototype,"isWGS84",null),u([d({readOnly:!0})],Pr.prototype,"isWebMercator",null),u([d({readOnly:!0})],Pr.prototype,"isGeographic",null),u([d({readOnly:!0})],Pr.prototype,"isWrappable",null),u([d({type:Yr,json:{write:!0}})],Pr.prototype,"latestWkid",void 0),u([d({readOnly:!0})],Pr.prototype,"metersPerUnit",null),u([d({readOnly:!0})],Pr.prototype,"unit",null),u([d({type:Yr,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt===null}}}}}}})],Pr.prototype,"wkid",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid===null}}}}}}})],Pr.prototype,"wkt",void 0),u([lt("wkt"),lt("web-scene","wkt")],Pr.prototype,"writeWkt",null),u([d({type:Yr,json:{write:!0}})],Pr.prototype,"vcsWkid",void 0),u([d({type:Yr,json:{write:!0}})],Pr.prototype,"latestVcsWkid",void 0),u([d()],Pr.prototype,"imageCoordinateSystem",void 0),Pr=If=u([I("esri.geometry.SpatialReference")],Pr),Pr.prototype.toJSON.isDefaultToJSON=!0,Pr.GCS_NAD_1927=new Pr({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),Pr.WGS84=new Pr(WFe),Pr.WebMercator=new Pr(XFe),Pr.PlateCarree=new Pr(YFe),Object.freeze&&(Object.freeze(Pr.GCS_NAD_1927),Object.freeze(Pr.WGS84),Object.freeze(Pr.WebMercator));const mt=Pr;let $f=class extends Ie{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=mt.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,i){if(e instanceof mt)return e;if(e!=null){const r=new mt;return r.read(e,i),r}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,i){this.cache[e]=i}};u([d()],$f.prototype,"type",void 0),u([d({readOnly:!0})],$f.prototype,"cache",null),u([d({readOnly:!0})],$f.prototype,"extent",null),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],$f.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],$f.prototype,"hasZ",void 0),u([d({type:mt,json:{write:!0},value:mt.WGS84})],$f.prototype,"spatialReference",void 0),u([Qe("spatialReference")],$f.prototype,"readSpatialReference",null),$f=u([I("esri.geometry.Geometry")],$f);const r0=$f;function p4e(t,e){const i=t.x-e.x,r=t.y-e.y,s=t.hasZ&&e.hasZ?t.z-e.z:0;return Math.sqrt(i*i+r*r+s*s)}const f4e=57.29577951308232,m4e=.017453292519943;function xie(t){return t*f4e}function Tie(t){return t*m4e}function Sie(t){return t/Oi.radius}function v4(t){return Math.PI/2-2*Math.atan(Math.exp(-t/Oi.radius))}function _7(t){return t.wkid!=null||t.wkt!=null}const wV=[0,0];function b4(t,e,i,r,s){const n=t,o=s;if(o.spatialReference=i,"x"in n&&"x"in o)[o.x,o.y]=e(n.x,n.y,wV,r);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=e(n.xmin,n.ymin,wV,r),[o.xmax,o.ymax]=e(n.xmax,n.ymax,wV,r);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const a="paths"in n?n.paths:n.rings,l=[];let c;for(let h=0;h<a.length;h++){const p=a[h];c=[],l.push(c);for(let f=0;f<p.length;f++)c.push(e(p[f][0],p[f][1],[0,0],r)),p[f].length>2&&c[f].push(p[f][2]),p[f].length>3&&c[f].push(p[f][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in n&&"points"in o){const a=n.points,l=[];for(let c=0;c<a.length;c++)l[c]=e(a[c][0],a[c][1],[0,0],r),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return s}function Iv(t,e){const i=t&&(_7(t)?t:t.spatialReference),r=e&&(_7(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!i||!r)&&(!!rn(r,i)||bx(r)&&I3(i)||bx(i)&&I3(r))}function sT(t,e){if(C(t))return null;const i=t.spatialReference,r=e&&(_7(e)?e:e.spatialReference);return Iv(i,r)?rn(i,r)?ae(t):bx(r)?b4(t,kS,mt.WebMercator,!1,ae(t)):I3(r)?b4(t,CM,mt.WGS84,!1,ae(t)):null:null}function kS(t,e,i=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const r=Tie(e);return i[0]=Tie(t)*Oi.radius,i[1]=Oi.halfSemiMajorAxis*Math.log((1+Math.sin(r))/(1-Math.sin(r))),i}function CM(t,e,i=[0,0],r=!1){const s=xie(t/Oi.radius);return i[0]=r?s:s-360*Math.floor((s+180)/360),i[1]=xie(Math.PI/2-2*Math.atan(Math.exp(-e/Oi.radius))),i}function Ey(t,e=!1,i=ae(t)){return b4(t,kS,mt.WebMercator,e,i)}function BS(t,e=!1,i=ae(t)){return b4(t,CM,mt.WGS84,e,i)}var nN;const $A=[0,0];function Eie(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let Nl=nN=class extends r0{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const i=t._get("spatialReference");e._set("spatialReference",Object.isFrozen(i)?i:i.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,i,r,s){let n;if(Array.isArray(t))n=t,s=e,t=n[0],e=n[1],i=n[2],r=n[3];else if(t&&typeof t=="object"){if(n=t,t=n.x!=null?n.x:n.longitude,e=n.y!=null?n.y:n.latitude,i=n.z,r=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new mt(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)oe.getLogger(this.declaredClass).warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)oe.getLogger(this.declaredClass).warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&s&&s.isWebMercator){const a=kS(n.longitude,n.latitude,$A);t=a[0],e=a[1]}}}else Eie(i)?(s=i,i=null):Eie(r)&&(s=r,r=null);const o={x:t,y:e};return o.x==null&&o.y!=null?oe.getLogger(this.declaredClass).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&oe.getLogger(this.declaredClass).warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(o.spatialReference=s),i!=null&&(o.z=i),r!=null&&(o.m=r),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){const{spatialReference:t,x:e,y:i}=this;if(t){if(t.isWebMercator)return CM(e,i,$A)[1];if(t.isGeographic)return i}return null}set latitude(t){const{spatialReference:e,x:i}=this;t!=null&&e&&(e.isWebMercator?this._set("y",kS(i,t,$A)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){const{x:t,y:e,spatialReference:i}=this;if(i){if(i.isWebMercator)return CM(t,e,$A)[0];if(i.isGeographic)return t}return null}set longitude(t){const{y:e,spatialReference:i}=this;t!=null&&i&&(i.isWebMercator?this._set("x",kS(t,e,$A)[0]):i.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,i){e[i]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new nN;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return nN.copy(t,this),this}equals(t){if(C(t))return!1;const{x:e,y:i,z:r,m:s,spatialReference:n}=this,{z:o,m:a}=t;let{x:l,y:c,spatialReference:h}=t;if(!n.equals(h))if(n.isWebMercator&&h.isWGS84)[l,c]=kS(l,c),h=n;else{if(!n.isWGS84||!h.isWebMercator)return!1;[l,c]=CM(l,c),h=n}return e===l&&i===c&&r===o&&s===a&&n.wkid===h.wkid}offset(t,e,i){return this.x+=t,this.y+=e,i!=null&&(this.z=(this.z??0)+i),this}normalize(){if(!this.spatialReference)return this;const t=Bp(this.spatialReference);if(!t)return this;let e=this.x;const[i,r]=t.valid,s=2*r;let n;return e>r?(n=Math.ceil(Math.abs(e-r)/s),e-=n*s):e<i&&(n=Math.ceil(Math.abs(e-i)/s),e+=n*s),this._set("x",e),this}distance(t){return p4e(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};u([d({readOnly:!0})],Nl.prototype,"cache",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Nl.prototype,"hasM",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Nl.prototype,"hasZ",null),u([d({type:Number})],Nl.prototype,"latitude",null),u([d({type:Number})],Nl.prototype,"longitude",null),u([d({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),wi(t=>isNaN(t)?t:Hh(t))],Nl.prototype,"x",void 0),u([lt("x")],Nl.prototype,"writeX",null),u([Qe("x")],Nl.prototype,"readX",null),u([d({type:Number,json:{write:!0}})],Nl.prototype,"y",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Nl.prototype,"z",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],Nl.prototype,"m",void 0),Nl=nN=u([I("esri.geometry.Point")],Nl),Nl.prototype.toJSON.isDefaultToJSON=!0;const pt=Nl;let $g=class extends Cs(Ie){constructor(...e){super(...e),this.position=new pt([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,i,r,s){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const n={position:e};return i!=null&&(n.heading=i),r!=null&&(n.tilt=r),s!=null&&(n.fov=s),n}return e}writePosition(e,i,r,s){const n=e.clone();n.x=Hh(e.x||0),n.y=Hh(e.y||0),n.z=e.hasZ?Hh(e.z||0):e.z,i[r]=n.write({},s)}readPosition(e,i){const r=new pt;return r.read(e,i),r.x=Hh(r.x||0),r.y=Hh(r.y||0),r.z=r.hasZ?Hh(r.z||0):r.z,r}equals(e){return!C(e)&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};u([d({type:pt,json:{write:{isRequired:!0}}})],$g.prototype,"position",void 0),u([lt("position")],$g.prototype,"writePosition",null),u([Qe("position")],$g.prototype,"readPosition",null),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),wi(t=>QY.normalize(Hh(t)))],$g.prototype,"heading",void 0),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),wi(t=>we(Hh(t),-180,180))],$g.prototype,"tilt",void 0),u([d({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],$g.prototype,"fov",void 0),$g=u([I("esri.Camera")],$g);const fd=$g,xV=[0,0];function j6(t,e){return!!v(e)&&rl(t,e.x,e.y,e.z)}function PRt(t,e){if(!e.points||e.points.length)return!1;for(const i of e.points)if(!JE(t,i))return!1;return!0}function g4e(t,e){const{xmin:i,ymin:r,zmin:s,xmax:n,ymax:o,zmax:a}=e;return t.hasZ&&e.hasZ?rl(t,i,r,s)&&rl(t,i,o,s)&&rl(t,n,o,s)&&rl(t,n,r,s)&&rl(t,i,r,a)&&rl(t,i,o,a)&&rl(t,n,o,a)&&rl(t,n,r,a):rl(t,i,r)&&rl(t,i,o)&&rl(t,n,o)&&rl(t,n,r)}function JE(t,e){return rl(t,e[0],e[1])}function y4e(t,e){return rl(t,e[0],e[1],e[2])}function rl(t,e,i,r){return e>=t.xmin&&e<=t.xmax&&i>=t.ymin&&i<=t.ymax&&(r==null||!t.hasZ||r>=t.zmin&&r<=t.zmax)}function Bge(t,e){return xV[1]=e.y,xV[0]=e.x,_4e(t,xV)}function _4e(t,e){return zge(t.rings,e)}function zge(t,e){if(!t)return!1;if(v4e(t))return Cie(!1,t,e);let i=!1;for(let r=0,s=t.length;r<s;r++)i=Cie(i,t[r],e);return i}function v4e(t){return!Array.isArray(t[0][0])}function Cie(t,e,i){const[r,s]=i;let n=t,o=0;for(let a=0,l=e.length;a<l;a++){o++,o===l&&(o=0);const[c,h]=e[a],[p,f]=e[o];(h<s&&f>=s||f<s&&h>=s)&&c+(s-h)/(f-h)*(p-c)<r&&(n=!n)}return n}function b4e(t,e){return j6(t,e)}function w4e(t,e){const i=t.hasZ&&e.hasZ;let r,s,n;if(t.xmin<=e.xmin){if(r=e.xmin,t.xmax<r)return!1}else if(r=t.xmin,e.xmax<r)return!1;if(t.ymin<=e.ymin){if(s=e.ymin,t.ymax<s)return!1}else if(s=t.ymin,e.ymax<s)return!1;if(i&&e.hasZ){if(t.zmin<=e.zmin){if(n=e.zmin,t.zmax<n)return!1}else if(n=t.zmin,e.zmax<n)return!1}return!0}function x4e(t,e){const{points:i,hasZ:r}=e,s=r?y4e:JE;for(const n of i)if(s(t,n))return!0;return!1}const xx=[0,0],Tx=[0,0],Sx=[0,0],Ex=[0,0],T4e=[xx,Tx,Sx,Ex],Gge=[[Sx,xx],[xx,Tx],[Tx,Ex],[Ex,Sx]];function S4e(t,e){return E4e(t,e.rings)}function E4e(t,e){xx[0]=t.xmin,xx[1]=t.ymax,Tx[0]=t.xmax,Tx[1]=t.ymax,Sx[0]=t.xmin,Sx[1]=t.ymin,Ex[0]=t.xmax,Ex[1]=t.ymin;for(const i of T4e)if(zge(e,i))return!0;for(const i of e){if(!i.length)continue;let r=i[0];if(JE(t,r))return!0;for(let s=1;s<i.length;s++){const n=i[s];if(JE(t,n)||jge(r,n,Gge))return!0;r=n}}return!1}function C4e(t,e){xx[0]=t.xmin,xx[1]=t.ymax,Tx[0]=t.xmax,Tx[1]=t.ymax,Sx[0]=t.xmin,Sx[1]=t.ymin,Ex[0]=t.xmax,Ex[1]=t.ymin;const i=e.paths;for(const r of i){if(!i.length)continue;let s=r[0];if(JE(t,s))return!0;for(let n=1;n<r.length;n++){const o=r[n];if(JE(t,o)||jge(s,o,Gge))return!0;s=o}}return!1}const Yo=[0,0];function A4e(t){for(let e=0;e<t.length;e++){const i=t[e];for(let s=0;s<i.length-1;s++){const n=i[s],o=i[s+1];for(let a=e+1;a<t.length;a++)for(let l=0;l<t[a].length-1;l++){const c=t[a][l],h=t[a][l+1];if(v7(n,o,c,h,Yo)&&!(Yo[0]===n[0]&&Yo[1]===n[1]||Yo[0]===c[0]&&Yo[1]===c[1]||Yo[0]===o[0]&&Yo[1]===o[1]||Yo[0]===h[0]&&Yo[1]===h[1]))return!0}}const r=i.length;if(!(r<=4))for(let s=0;s<r-3;s++){let n=r-1;s===0&&(n=r-2);const o=i[s],a=i[s+1];for(let l=s+2;l<n;l++){const c=i[l],h=i[l+1];if(v7(o,a,c,h,Yo)&&!(Yo[0]===o[0]&&Yo[1]===o[1]||Yo[0]===c[0]&&Yo[1]===c[1]||Yo[0]===a[0]&&Yo[1]===a[1]||Yo[0]===h[0]&&Yo[1]===h[1]))return!0}}}return!1}function jge(t,e,i){for(let r=0;r<i.length;r++)if(v7(t,e,i[r][0],i[r][1]))return!0;return!1}function v7(t,e,i,r,s){const[n,o]=t,[a,l]=e,[c,h]=i,[p,f]=r,m=p-c,y=n-c,_=a-n,b=f-h,w=o-h,S=l-o,T=b*_-m*S;if(T===0)return!1;const E=(m*w-b*y)/T,O=(_*w-S*y)/T;return E>=0&&E<=1&&O>=0&&O<=1&&(s&&(s[0]=n+E*(a-n),s[1]=o+E*(l-o)),!0)}function O4e(t){switch(t){case"esriGeometryEnvelope":case"extent":return w4e;case"esriGeometryMultipoint":case"multipoint":return x4e;case"esriGeometryPoint":case"point":return b4e;case"esriGeometryPolygon":case"polygon":return S4e;case"esriGeometryPolyline":case"polyline":return C4e}}var xh;function R4e(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function A0(t,e,i){return e==null?i:i==null?e:t(e,i)}let So=xh=class extends r0{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,i,r,s){return R4e(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?mt.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:i,ymax:r,spatialReference:s??mt.WGS84}}static fromBounds(t,e){return new xh({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}static fromPoint(t){return new xh({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new pt({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new xh;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&Iv(e,i)&&(t=e.isWebMercator?Ey(t):BS(t,!0)),t.type==="point"?j6(this,t):t.type==="extent"&&g4e(this,t)}equals(t){if(this===t)return!0;if(C(t))return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&Iv(e,i)&&(t=e.isWebMercator?Ey(t):BS(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),i=this.width*e,r=this.height*e;if(this.xmin+=i,this.ymin+=r,this.xmax-=i,this.ymax-=r,this.hasZ){const s=(this.zmax-this.zmin)*e;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*e;this.mmin+=s,this.mmax-=s}return this}intersects(t){if(C(t))return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,i=t.spatialReference;return e&&i&&!rn(e,i)&&Iv(e,i)&&(t=e.isWebMercator?Ey(t):BS(t,!0)),O4e(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,i){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,i!=null&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=A0(Math.min,this.zmin,t.zmin),this.zmax=A0(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=A0(Math.min,this.mmin,t.mmin),this.mmax=A0(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:C(t)||!this.intersects(t)?null:(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=A0(Math.max,this.zmin,t.zmin),this.zmax=A0(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=A0(Math.max,this.mmin,t.mmin),this.mmax=A0(Math.min,this.mmax,t.mmax)),this)}toJSON(t){return this.write({},t)}_shiftCM(t=Bp(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,i=this._getCM(t);if(i){const r=e.isWebMercator?BS(i):i;this.xmin-=i.x,this.xmax-=i.x,e.isWebMercator||(r.x=this._normalizeX(r.x,t).x),this.spatialReference=new mt(Fm((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:r.x}))}return this}_getCM(t){let e=null;const[i,r]=t.valid,s=this.xmin,n=this.xmax;return s>=i&&s<=r&&n>=i&&n<=r||(e=this.center),e}_normalize(t,e,i){const r=this.spatialReference;if(!r)return this;const s=i??Bp(r);if(s==null)return this;const n=this._getParts(s).map(l=>l.extent);if(n.length<2)return n[0]||this;if(n.length>2)return t?this._shiftCM(s):this.set({xmin:s.valid[0],xmax:s.valid[1]});if(t)return this._shiftCM(s);if(e)return n;let o=!0,a=!0;return n.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:n.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const h=(l.zmax-l.zmin)/2;for(let p=0;p<c.length;p++)c[p].push(h)}if(a){const h=(l.mmax-l.mmin)/2;for(let p=0;p<c.length;p++)c[p].push(h)}return c}),hasZ:o,hasM:a,spatialReference:r}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:s,ymax:n,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let h;t=t||Bp(o);const[p,f]=t.valid;h=this._normalizeX(this.xmin,t);const m=h.x,y=h.frameId;h=this._normalizeX(this.xmax,t);const _=h.x,b=h.frameId,w=m===_&&a>0;if(a>2*f){const S=new xh(l<c?m:_,s,f,n,o),T=new xh(p,s,l<c?_:m,n,o),E=new xh(0,s,f,n,o),O=new xh(p,s,0,n,o),R=[],L=[];S.contains(E)&&R.push(y),S.contains(O)&&L.push(y),T.contains(E)&&R.push(b),T.contains(O)&&L.push(b);for(let P=y+1;P<b;P++)R.push(P),L.push(P);e.push({extent:S,frameIds:[y]},{extent:T,frameIds:[b]},{extent:E,frameIds:R},{extent:O,frameIds:L})}else m>_||w?e.push({extent:new xh(m,s,f,n,o),frameIds:[y]},{extent:new xh(p,s,_,n,o),frameIds:[b]}):e.push({extent:new xh(m,s,_,n,o),frameIds:[y]});this.cache._parts=e}const i=this.hasZ,r=this.hasM;if(i||r){const s={};i&&(s.zmin=this.zmin,s.zmax=this.zmax),r&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<e.length;n++)e[n].extent.set(s)}return e}_normalizeX(t,e){const[i,r]=e.valid,s=2*r;let n,o=0;return t>r?(n=Math.ceil(Math.abs(t-r)/s),t-=n*s,o=n):t<i&&(n=Math.ceil(Math.abs(t-i)/s),t+=n*s,o=-n),{x:t,frameId:o}}};u([d({readOnly:!0})],So.prototype,"cache",null),u([d({readOnly:!0})],So.prototype,"center",null),u([d({readOnly:!0})],So.prototype,"extent",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],So.prototype,"hasM",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],So.prototype,"hasZ",null),u([d({readOnly:!0})],So.prototype,"height",null),u([d({readOnly:!0})],So.prototype,"width",null),u([d({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],So.prototype,"xmin",void 0),u([d({type:Number,json:{write:!0}})],So.prototype,"ymin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],So.prototype,"mmin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],So.prototype,"zmin",void 0),u([d({type:Number,json:{write:!0}})],So.prototype,"xmax",void 0),u([d({type:Number,json:{write:!0}})],So.prototype,"ymax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],So.prototype,"mmax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],So.prototype,"zmax",void 0),So=xh=u([I("esri.geometry.Extent")],So),So.prototype.toJSON.isDefaultToJSON=!0;const Pi=So;function KE(t,e,i=!1){let{hasM:r,hasZ:s}=t;Array.isArray(e)?e.length!==4||r||s?e.length===3&&i&&!r?(s=!0,r=!1):e.length===3&&r&&s&&(r=!1,s=!1):(r=!0,s=!0):(s=!s&&e.hasZ&&(!r||e.hasM),r=!r&&e.hasM&&(!s||e.hasZ)),t.hasZ=s,t.hasM=r}var b7;function Aie(t){return(e,i)=>e==null?i:i==null?e:t(e,i)}function M4e(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let f_=b7=class extends r0{constructor(...t){super(...t),this.points=[],this.type="multipoint"}normalizeCtorArgs(t,e){if(!t&&!e)return{};const i={};Array.isArray(t)?(i.points=t,i.spatialReference=e):M4e(t)?i.spatialReference=t:(t.points&&(i.points=t.points),t.spatialReference&&(i.spatialReference=t.spatialReference),t.hasZ&&(i.hasZ=t.hasZ),t.hasM&&(i.hasM=t.hasM));const r=i.points&&i.points[0];return r&&(i.hasZ===void 0&&i.hasM===void 0?(i.hasZ=r.length>2,i.hasM=!1):i.hasZ===void 0?i.hasZ=r.length>3:i.hasM===void 0&&(i.hasM=r.length>3)),i}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=this.points;if(!t.length)return null;const e=new Pi,i=this.hasZ,r=this.hasM,s=i?3:2,n=t[0],o=Aie(Math.min),a=Aie(Math.max);let l,c,h,p,[f,m]=n,[y,_]=n;for(let b=0,w=t.length;b<w;b++){const S=t[b],[T,E]=S;if(f=o(f,T),m=o(m,E),y=a(y,T),_=a(_,E),i&&S.length>2){const O=S[2];l=o(l,O),h=a(h,O)}if(r&&S.length>s){const O=S[s];c=o(c,O),p=a(p,O)}}return e.xmin=f,e.ymin=m,e.xmax=y,e.ymax=_,e.spatialReference=this.spatialReference,i?(e.zmin=l,e.zmax=h):(e.zmin=void 0,e.zmax=void 0),r?(e.mmin=c,e.mmax=p):(e.mmin=void 0,e.mmax=void 0),e}writePoints(t,e){e.points=ae(this.points)}addPoint(t){return KE(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}clone(){const t={points:ae(this.points),spatialReference:this.spatialReference};return this.hasZ&&(t.hasZ=!0),this.hasM&&(t.hasM=!0),new b7(t)}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],i={x:e[0],y:e[1],spatialReference:this.spatialReference};let r=2;return this.hasZ&&(i.z=e[2],r=3),this.hasM&&(i.m=e[r]),new pt(i)}removePoint(t){if(!this._validateInputs(t))return null;const e=new pt(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?(KE(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};u([d({readOnly:!0})],f_.prototype,"cache",null),u([d()],f_.prototype,"extent",null),u([d({type:[[Number]],json:{write:{isRequired:!0}}})],f_.prototype,"points",void 0),u([lt("points")],f_.prototype,"writePoints",null),f_=b7=u([I("esri.geometry.Multipoint")],f_),f_.prototype.toJSON.isDefaultToJSON=!0;const ZP=f_;function lZ(t,e){const i=e[0]-t[0],r=e[1]-t[1];if(t.length>2&&e.length>2){const s=t[2]-e[2];return Math.sqrt(i*i+r*r+s*s)}return Math.sqrt(i*i+r*r)}function Hge(t,e,i){const r=t[0]+i*(e[0]-t[0]),s=t[1]+i*(e[1]-t[1]);return t.length>2&&e.length>2?[r,s,t[2]+i*(e[2]-t[2])]:[r,s]}function P4e(t,e,i,r){const[s,n]=e,[o,a]=i[r],[l,c]=i[r+1],h=l-o,p=c-a,f=h*h+p*p,m=(s-o)*h+(n-a)*p,y=Math.min(1,Math.max(0,m/f));return t[0]=o+h*y,t[1]=a+p*y,t}function IRt(t,e,i){const r=i.rings;let s,n,o=!1,a=1/0;for(let l=0;l<r.length;l++){const c=r[l];for(let h=0,p=c.length-1;h<c.length;p=h++)s=c[h],n=c[p],s[1]>e!=n[1]>e&&t<(n[0]-s[0])*(e-s[1])/(n[1]-s[1])+s[0]&&(o=!o),a=Math.min(a,I4e(t,e,s,n))}return a===0?0:(o?1:-1)*Math.sqrt(a)}function I4e(t,e,i,r){let s=i[0],n=i[1],o=r[0]-s,a=r[1]-n;if(o!==0||a!==0){const l=((t-s)*o+(e-n)*a)/(o*o+a*a);l>1?(s=r[0],n=r[1]):l>0&&(s+=o*l,n+=a*l)}return o=t-s,a=e-n,o*o+a*a}function $4e(t,e){return Hge(t,e,.5)}function qge(t){const e=t.length;let i=0;for(let r=0;r<e-1;++r)i+=lZ(t[r],t[r+1]);return i}function Wge(t,e){if(e<=0)return t[0];const i=t.length;let r=0;for(let s=0;s<i-1;++s){const n=lZ(t[s],t[s+1]);if(e-r<n){const o=(e-r)/n;return Hge(t[s],t[s+1],o)}r+=n}return t[i-1]}function cZ(t,e,i){const r=t.length;let s=0,n=0,o=0;for(let a=0;a<r;a++){const l=t[a],c=t[(a+1)%r];let h=2;s+=l[0]*c[1]-c[0]*l[1],l.length>2&&c.length>2&&i&&(n+=l[0]*c[2]-c[0]*l[2],h=3),l.length>h&&c.length>h&&e&&(o+=l[0]*c[h]-c[0]*l[h])}return s<=0&&n<=0&&o<=0}function L4e(t){const e=t.length;return e>2&&Uy(t[0],t[e-1])}function $Rt(t){if("rings"in t&&(D4e(t),t.rings.length>0&&!cZ(t.rings[0],t.hasM??!1,t.hasZ??!1)))for(const e of t.rings)e.reverse()}function D4e(t){if("rings"in t)for(const e of t.rings)L4e(e)||e.push(e[0].slice())}function Xge(t){if(!t||t.length<3)return 0;let e=0;const i=t.length-1;for(let r=0;r<i;r++)e+=(t[r][0]-t[r+1][0])*(t[r][1]+t[r+1][1]);return e+=(t[i][0]-t[0][0])*(t[i][1]+t[0][1]),-.5*e}function LRt(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function N4e(t){return t?uZ(t.rings,t.hasZ??!1):null}function uZ(t,e){if(!t||!t.length)return null;const i=[],r=[],s=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=t.length;n<o;n++){const a=F4e(t[n],e,s);a&&r.push(a)}if(r.sort((n,o)=>{let a=n[2]-o[2];return a===0&&e&&(a=n[4]-o[4]),a}),r.length&&(i[0]=r[0][0],i[1]=r[0][1],e&&(i[2]=r[0][3]),(i[0]<s[0]||i[0]>s[1]||i[1]<s[2]||i[1]>s[3]||e&&(i[2]<s[4]||i[2]>s[5]))&&(i.length=0)),!i.length){const n=t[0]&&t[0].length?U4e(t[0],e):null;if(!n)return null;i[0]=n[0],i[1]=n[1],e&&n.length>2&&(i[2]=n[2])}return i}function F4e(t,e,i){let r=0,s=0,n=0,o=0,a=0;const l=t.length?t[0][0]:0,c=t.length?t[0][1]:0,h=t.length&&e?t[0][2]:0;for(let f=0;f<t.length;f++){const m=t[f],y=t[(f+1)%t.length],[_,b,w]=m,S=_-l,T=b-c,[E,O,R]=y,L=E-l,P=O-c,F=S*P-L*T;if(o+=F,r+=(S+L)*F,s+=(T+P)*F,e&&m.length>2&&y.length>2){const V=w-h,B=R-h,G=S*B-L*V;n+=(V+B)*G,a+=G}_<i[0]&&(i[0]=_),_>i[1]&&(i[1]=_),b<i[2]&&(i[2]=b),b>i[3]&&(i[3]=b),e&&(w<i[4]&&(i[4]=w),w>i[5]&&(i[5]=w))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const p=[r/(6*o)+l,s/(6*o)+c,o];return e&&(i[4]===i[5]||a===0?(p[3]=(i[4]+i[5])/2,p[4]=0):(p[3]=n/(6*a)+h,p[4]=a)),p}function U4e(t,e){const i=e?[0,0,0]:[0,0],r=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;for(let l=0,c=t.length;l<c-1;l++){const h=t[l],p=t[l+1];if(h&&p){i[0]=h[0],i[1]=h[1],r[0]=p[0],r[1]=p[1],e&&h.length>2&&p.length>2&&(i[2]=h[2],r[2]=p[2]);const f=lZ(i,r);if(f){s+=f;const m=$4e(h,p);n+=f*m[0],o+=f*m[1],e&&m.length>2&&(a+=f*m[2])}}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.length?t[0]:null}const V4e=1e-6;function DRt(t){if(!t||!t.rings)return null;const{rings:e}=t;let i=0;for(let n=0;n<e.length;n++)i+=Xge(e[n]);if(i<V4e)return uZ(e,!1);const r=[0,0],s=e[0][0];for(let n=0;n<e.length;n++)B4e(r,s,e[n]);return r[0]*=1/i,r[1]*=1/i,r[0]+=s[0],r[1]+=s[1],r}const k4e=1/3;function B4e(t,e,i){if(!t||!i||i.length<3)return null;const r=i[0],s=[0,0],n=[i[1][0]-r[0],i[1][1]-r[1]];let o;for(let c=2;c<i.length;c++)s[0]=i[c][0]-r[0],s[1]=i[c][1]-r[1],o=.5*k4e*(s[0]*n[1]-s[1]*n[0]),t[0]+=o*(n[0]+s[0]),t[1]+=o*(n[1]+s[1]),n[0]=s[0],n[1]=s[1];const a=Xge(i),l=[r[0],r[1]];return l[0]-=e[0],l[1]-=e[1],l[0]*=a,l[1]*=a,t[0]+=l[0],t[1]+=l[1],t}function Yge(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function Zge(t){return t.points!==void 0}function Jge(t){return t.x!==void 0&&t.y!==void 0}function Kge(t){return t.paths!==void 0}function Qge(t){return t.rings!==void 0}function eye(t){function e(i,r){return i==null?r:r==null?i:t(i,r)}return e}const fv=eye(Math.min),mv=eye(Math.max);function NRt(t,e){return Kge(e)?QE(t,e.paths,!1,!1):Qge(e)?QE(t,e.rings,!1,!1):Zge(e)?hZ(t,e.points,!1,!1,!1,!1):Yge(e)?tye(t,e):(Jge(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function FRt(t,e){return Kge(e)?QE(t,e.paths,!0,!1):Qge(e)?QE(t,e.rings,!0,!1):Zge(e)?hZ(t,e.points,!0,!1,!0,!1):Yge(e)?tye(t,e,!0,!1,!0,!1):(Jge(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function QE(t,e,i,r){const s=i?3:2;if(!e.length||!e[0].length)return null;let n,o,a,l,[c,h]=e[0][0],[p,f]=e[0][0];for(let m=0;m<e.length;m++){const y=e[m];for(let _=0;_<y.length;_++){const b=y[_],[w,S]=b;if(c=fv(c,w),h=fv(h,S),p=mv(p,w),f=mv(f,S),i&&b.length>2){const T=b[2];n=fv(n,T),o=mv(o,T)}if(r&&b.length>s){const T=b[s];a=fv(n,T),l=mv(o,T)}}}return i?r?(t[0]=c,t[1]=h,t[2]=n,t[3]=a,t[4]=p,t[5]=f,t[6]=o,t[7]=l,t.length=8,t):(t[0]=c,t[1]=h,t[2]=n,t[3]=p,t[4]=f,t[5]=o,t.length=6,t):r?(t[0]=c,t[1]=h,t[2]=a,t[3]=p,t[4]=f,t[5]=l,t.length=6,t):(t[0]=c,t[1]=h,t[2]=p,t[3]=f,t.length=4,t)}function tye(t,e,i,r,s,n){const o=e.xmin,a=e.xmax,l=e.ymin,c=e.ymax;let h=e.zmin,p=e.zmax,f=e.mmin,m=e.mmax;return s?(h=h||0,p=p||0,n?(f=f||0,m=m||0,t[0]=o,t[1]=l,t[2]=h,t[3]=f,t[4]=a,t[5]=c,t[6]=p,t[7]=m,t):(t[0]=o,t[1]=l,t[2]=h,t[3]=a,t[4]=c,t[5]=p,t)):n?(f=f||0,m=m||0,t[0]=o,t[1]=l,t[2]=f,t[3]=a,t[4]=c,t[5]=m,t):(t[0]=o,t[1]=l,t[2]=a,t[3]=c,t)}function hZ(t,e,i,r,s,n){const o=i?3:2,a=r&&n,l=i&&s;if(!e.length||!e[0].length)return null;let c,h,p,f,[m,y]=e[0],[_,b]=e[0];for(let w=0;w<e.length;w++){const S=e[w],[T,E]=S;if(m=fv(m,T),y=fv(y,E),_=mv(_,T),b=mv(b,E),l&&S.length>2){const O=S[2];c=fv(c,O),h=mv(h,O)}if(a&&S.length>o){const O=S[o];p=fv(c,O),f=mv(h,O)}}return s?(c=c||0,h=h||0,n?(p=p||0,f=f||0,t[0]=m,t[1]=y,t[2]=c,t[3]=p,t[4]=_,t[5]=b,t[6]=h,t[7]=f,t):(t[0]=m,t[1]=y,t[2]=c,t[3]=_,t[4]=b,t[5]=h,t)):n?(p=p||0,f=f||0,t[0]=m,t[1]=y,t[2]=p,t[3]=_,t[4]=b,t[5]=f,t):(t[0]=m,t[1]=y,t[2]=_,t[3]=b,t)}function z4e(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function G4e(t){return t.points!==void 0}function j4e(t){return t.x!==void 0&&t.y!==void 0}function H4e(t){return t.paths!==void 0}function q4e(t){return t.rings!==void 0}const dZ=[];function iye(t,e,i,r){return{xmin:t,ymin:e,xmax:i,ymax:r}}function rye(t,e,i,r,s,n){return{xmin:t,ymin:e,zmin:i,xmax:r,ymax:s,zmax:n}}function sye(t,e,i,r,s,n){return{xmin:t,ymin:e,mmin:i,xmax:r,ymax:s,mmax:n}}function nye(t,e,i,r,s,n,o,a){return{xmin:t,ymin:e,zmin:i,mmin:r,xmax:s,ymax:n,zmax:o,mmax:a}}function pZ(t,e=!1,i=!1){return e?i?nye(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):rye(t[0],t[1],t[2],t[3],t[4],t[5]):i?sye(t[0],t[1],t[2],t[3],t[4],t[5]):iye(t[0],t[1],t[2],t[3])}function URt(t){return t?z4e(t)?t:j4e(t)?X4e(t):q4e(t)?oye(t):H4e(t)?aye(t):G4e(t)?W4e(t):null:null}function W4e(t){const{hasZ:e,hasM:i,points:r}=t;return pZ(hZ(dZ,r,e??!1,i??!1),e,i)}function X4e(t){const{x:e,y:i,z:r,m:s}=t,n=s!=null;return r!=null?n?nye(e,i,r,s,e,i,r,s):rye(e,i,r,e,i,r):n?sye(e,i,s,e,i,s):iye(e,i,e,i)}function oye(t){const{hasZ:e,hasM:i,rings:r}=t,s=QE(dZ,r,e??!1,i??!1);return s?pZ(s,e,i):null}function aye(t){const{hasZ:e,hasM:i,paths:r}=t,s=QE(dZ,r,e??!1,i??!1);return s?pZ(s,e,i):null}var oN;function Oie(t){return!Array.isArray(t[0])}let Lf=oN=class extends r0{static fromExtent(t){const e=t.clone().normalize(),i=t.spatialReference;let r=!1,s=!1;for(const o of e)o.hasZ&&(r=!0),o.hasM&&(s=!0);const n={rings:e.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(r&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(s&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:i};return r&&(n.hasZ=!0),s&&(n.hasM=!0),new oN(n)}constructor(...t){super(...t),this.rings=[],this.type="polygon"}normalizeCtorArgs(t,e){let i,r,s=null,n=null;return t&&!Array.isArray(t)?(s=t.rings?t.rings:null,e||(t.spatialReference?e=t.spatialReference:t.rings||(e=t)),i=t.hasZ,r=t.hasM):s=t,s=s||[],e=e||mt.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=n.length>3):i===void 0?i=r?n.length>3:n.length>2:r===void 0&&(r=i?n.length>3:n.length>2)),{rings:s,spatialReference:e,hasZ:i,hasM:r}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const t=N4e(this);if(!t||isNaN(t[0])||isNaN(t[1])||this.hasZ&&isNaN(t[2]))return null;const e=new pt;return e.x=t[0],e.y=t[1],e.spatialReference=this.spatialReference,this.hasZ&&(e.z=t[2]),e}get extent(){const{spatialReference:t}=this,e=oye(this);if(!e)return null;const i=new Pi(e);return i.spatialReference=t,i}get isSelfIntersecting(){return A4e(this.rings)}writeRings(t,e){e.rings=ae(this.rings)}addRing(t){if(!t)return;const e=this.rings,i=e.length;if(Oie(t)){const r=[];for(let s=0,n=t.length;s<n;s++)r[s]=t[s].toArray();e[i]=r}else e[i]=t.concat();return this.notifyChange("rings"),this}clone(){const t=new oN;return t.spatialReference=this.spatialReference,t.rings=ae(this.rings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(C(t))return!1;const e=this.spatialReference,i=t.spatialReference;if(v(e)!==v(i)||v(e)&&v(i)&&!e.equals(i)||this.rings.length!==t.rings.length)return!1;const r=([s,n,o,a],[l,c,h,p])=>s===l&&n===c&&(o==null&&h==null||o===h)&&(a==null&&p==null||a===p);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],o=t.rings[s];if(!Uy(n,o,r))return!1}return!0}contains(t){if(!t)return!1;const e=sT(t,this.spatialReference);return Bge(this,v(e)?e:t)}isClockwise(t){let e;return e=Oie(t)?t.map(i=>this.hasZ?this.hasM?[i.x,i.y,i.z,i.m]:[i.x,i.y,i.z]:[i.x,i.y]):t,cZ(e,this.hasM,this.hasZ)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.rings[t][e],r=this.hasZ,s=this.hasM;return r&&!s?new pt(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new pt(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new pt(i[0],i[1],i[2],i[3],this.spatialReference):new pt(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(KE(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t].splice(e,0,i),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new pt(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),i}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],i=this.spatialReference,r=e.map(s=>new pt(s,i));return this.notifyChange("rings"),r}setPoint(t,e,i){return this._validateInputs(t,e)?(KE(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t][e]=i,this.notifyChange("rings"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const r=this.rings[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};u([d({readOnly:!0})],Lf.prototype,"cache",null),u([d({readOnly:!0})],Lf.prototype,"centroid",null),u([d({readOnly:!0})],Lf.prototype,"extent",null),u([d({readOnly:!0})],Lf.prototype,"isSelfIntersecting",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],Lf.prototype,"rings",void 0),u([lt("rings")],Lf.prototype,"writeRings",null),Lf=oN=u([I("esri.geometry.Polygon")],Lf),Lf.prototype.toJSON.isDefaultToJSON=!0;const md=Lf;var w7;function Y4e(t){return!Array.isArray(t[0])}let m_=w7=class extends r0{constructor(...t){super(...t),this.paths=[],this.type="polyline"}normalizeCtorArgs(t,e){let i,r,s=null,n=null;return t&&!Array.isArray(t)?(s=t.paths?t.paths:null,e||(t.spatialReference?e=t.spatialReference:t.paths||(e=t)),i=t.hasZ,r=t.hasM):s=t,s=s||[],e=e||mt.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=!1):i===void 0?i=!r&&n.length>3:r===void 0&&(r=!i&&n.length>3)),{paths:s,spatialReference:e,hasZ:i,hasM:r}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:t}=this,e=aye(this);if(!e)return null;const i=new Pi(e);return i.spatialReference=t,i}writePaths(t,e){e.paths=ae(this.paths)}addPath(t){if(!t)return;const e=this.paths,i=e.length;if(Y4e(t)){const r=[];for(let s=0,n=t.length;s<n;s++)r[s]=t[s].toArray();e[i]=r}else e[i]=t.concat();return this.notifyChange("paths"),this}clone(){const t=new w7;return t.spatialReference=this.spatialReference,t.paths=ae(this.paths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.paths[t][e],r=this.hasZ,s=this.hasM;return r&&!s?new pt(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new pt(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new pt(i[0],i[1],i[2],i[3],this.spatialReference):new pt(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(KE(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t].splice(e,0,i),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],i=this.spatialReference,r=e.map(s=>new pt(s,i));return this.notifyChange("paths"),r}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new pt(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),i}setPoint(t,e,i){return this._validateInputs(t,e)?(KE(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t][e]=i,this.notifyChange("paths"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const r=this.paths[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};u([d({readOnly:!0})],m_.prototype,"cache",null),u([d({readOnly:!0})],m_.prototype,"extent",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],m_.prototype,"paths",void 0),u([lt("paths")],m_.prototype,"writePaths",null),m_=w7=u([I("esri.geometry.Polyline")],m_),m_.prototype.toJSON.isDefaultToJSON=!0;const Rp=m_,lye=Ua()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),Rie=Ua()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function fZ(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function H6(t){return t.points!==void 0}function q6(t){return t.x!==void 0&&t.y!==void 0}function W6(t){return t.paths!==void 0}function $v(t){return t.rings!==void 0}function Gy(t){return C(t)?null:t instanceof r0?t:q6(t)?pt.fromJSON(t):W6(t)?Rp.fromJSON(t):$v(t)?md.fromJSON(t):H6(t)?ZP.fromJSON(t):fZ(t)?Pi.fromJSON(t):null}function YC(t){return t?q6(t)?"esriGeometryPoint":W6(t)?"esriGeometryPolyline":$v(t)?"esriGeometryPolygon":fZ(t)?"esriGeometryEnvelope":H6(t)?"esriGeometryMultipoint":null:null}const Z4e={esriGeometryPoint:pt,esriGeometryPolyline:Rp,esriGeometryPolygon:md,esriGeometryEnvelope:Pi,esriGeometryMultipoint:ZP};function J4e(t){return t&&Z4e[t]||null}const nT={base:r0,key:"type",typeMap:{extent:Pi,multipoint:ZP,point:pt,polyline:Rp,polygon:md}};Xp(nT);let aN=class cye{constructor(){this._emitter=new cye.EventEmitter(this)}emit(e,i){return this._emitter.emit(e,i)}on(e,i){return this._emitter.on(e,i)}once(e,i){return this._emitter.once(e,i)}hasEventListener(e){return this._emitter.hasEventListener(e)}};(function(t){class e{constructor(s=null){this._target=s,this._listenersMap=null}clear(){this._listenersMap&&this._listenersMap.clear(),this._listenersMap=null}emit(s,n){const o=this._listenersMap&&this._listenersMap.get(s);if(!o)return!1;const a=this._target||this;return[...o].forEach(l=>{l.call(a,n)}),o.length>0}on(s,n){if(Array.isArray(s)){const a=s.map(l=>this.on(l,n));return qE(a)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const o=this._listenersMap.get(s)||[];return o.push(n),this._listenersMap.set(s,o),{remove:()=>{const a=this._listenersMap&&this._listenersMap.get(s)||[],l=a.indexOf(n);l>=0&&a.splice(l,1)}}}once(s,n){const o=this.on(s,a=>{o.remove(),n.call(null,a)});return o}hasEventListener(s){const n=this._listenersMap&&this._listenersMap.get(s);return n!=null&&n.length>0}}t.EventEmitter=e,t.EventedMixin=r=>{let s=class extends r{constructor(){super(...arguments),this._emitter=new e}destroy(){this._emitter.clear()}emit(n,o){return this._emitter.emit(n,o)}on(n,o){return this._emitter.on(n,o)}once(n,o){return this._emitter.once(n,o)}hasEventListener(n){return this._emitter.hasEventListener(n)}};return s=u([I("esri.core.Evented")],s),s};let i=class extends $e{constructor(){super(...arguments),this._emitter=new aN.EventEmitter(this)}destroy(){this._emitter.clear()}emit(r,s){return this._emitter.emit(r,s)}on(r,s){return this._emitter.on(r,s)}once(r,s){return this._emitter.once(r,s)}hasEventListener(r){return this._emitter.hasEventListener(r)}};i=u([I("esri.core.Evented")],i),t.EventedAccessor=i})(aN||(aN={}));const As=aN;var _r;(function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"})(_r||(_r={}));function mZ(t){return(e,i)=>{e[i]=t}}let gZ=class extends _me{notify(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onInvalidated(),r.onCommitted()}}};var uy;let K4e=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}};const lh=new yo(K4e,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1}),Q4e=()=>{};function TV(t){return t?t instanceof Sw?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function SV(t){if(t&&t.length)return t[0]}function e5e(t,e,i,r){const s=Math.min(t.length-i,e.length-r);let n=0;for(;n<s&&t[i+n]===e[r+n];)n++;return n}function uye(t,e,i,r){e&&e.forEach((s,n,o)=>{t.push(s),uye(t,i.call(r,s,n,o),i,r)})}const O0=new Set,R0=new Set,M0=new Set,EV=new Map;let t5e=0,Sw=uy=class extends As.EventedAccessor{static isCollection(t){return t!=null&&t instanceof uy}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new gZ,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:t5e++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof uy?{items:t}:t:{}}destroy(){this.removeAll()}*[Symbol.iterator](){yield*this.items}get items(){return Ai(this._observable),this._items}set items(t){this._emitBeforeChanges(_r.ADD)||(this._splice(0,this.length,TV(t)),this._emitAfterChanges(_r.ADD))}hasEventListener(t){return t==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(t)}on(t,e){if(t==="change"){const i=this._chgListeners,r={removed:!1,callback:e};return i.push(r),this._notifications&&this._notifications.push({listeners:i.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=Q4e,r.removed=!0,i.splice(i.indexOf(r),1)}}}return this._emitter.on(t,e)}once(t,e){const i=this.on(t,e);return{remove(){i.remove()}}}add(t,e){if(Ai(this._observable),this._emitBeforeChanges(_r.ADD))return this;const i=this.getNextIndex(e??null);return this._splice(i,0,[t]),this._emitAfterChanges(_r.ADD),this}addMany(t,e=this._items.length){if(Ai(this._observable),!t||!t.length)return this;if(this._emitBeforeChanges(_r.ADD))return this;const i=this.getNextIndex(e);return this._splice(i,0,TV(t)),this._emitAfterChanges(_r.ADD),this}at(t){if(Ai(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(Ai(this._observable),!this.length||this._emitBeforeChanges(_r.REMOVE))return[];const t=this._splice(0,this.length)||[];return this._emitAfterChanges(_r.REMOVE),t}clone(){return Ai(this._observable),this._createNewInstance({items:this._items.map(ae)})}concat(...t){Ai(this._observable);const e=t.map(TV);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(Ai(this._observable),!this.length||this._emitBeforeChanges(_r.REMOVE))return;const i=this._splice(0,this.length),r=i.length;for(let s=0;s<r;s++)t.call(e,i[s],s,i);this._emitAfterChanges(_r.REMOVE)}every(t,e){return Ai(this._observable),this._items.every(t,e)}filter(t,e){let i;return Ai(this._observable),i=arguments.length===2?this._items.filter(t,e):this._items.filter(t),this._createNewInstance({items:i})}find(t,e){return Ai(this._observable),this._items.find(t,e)}findIndex(t,e){return Ai(this._observable),this._items.findIndex(t,e)}flatten(t,e){Ai(this._observable);const i=[];return uye(i,this,t,e),new uy(i)}forEach(t,e){return Ai(this._observable),this._items.forEach(t,e)}getItemAt(t){return Ai(this._observable),this._items[t]}getNextIndex(t){Ai(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return Ai(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return Ai(this._observable),this._items.indexOf(t,e)}join(t=","){return Ai(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return Ai(this._observable),this._items.lastIndexOf(t,e)}map(t,e){Ai(this._observable);const i=this._items.map(t,e);return new uy({items:i})}reorder(t,e=this.length-1){Ai(this._observable);const i=this.indexOf(t);if(i!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),i!==e){if(this._emitBeforeChanges(_r.MOVE))return t;this._splice(i,1),this._splice(e,0,[t]),this._emitAfterChanges(_r.MOVE)}return t}}pop(){if(Ai(this._observable),!this.length||this._emitBeforeChanges(_r.REMOVE))return;const t=SV(this._splice(this.length-1,1));return this._emitAfterChanges(_r.REMOVE),t}push(...t){return Ai(this._observable),this._emitBeforeChanges(_r.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(_r.ADD)),this.length}reduce(t,e){Ai(this._observable);const i=this._items;return arguments.length===2?i.reduce(t,e):i.reduce(t)}reduceRight(t,e){Ai(this._observable);const i=this._items;return arguments.length===2?i.reduceRight(t,e):i.reduceRight(t)}remove(t){return Ai(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(Ai(this._observable),t<0||t>=this.length||this._emitBeforeChanges(_r.REMOVE))return;const e=SV(this._splice(t,1));return this._emitAfterChanges(_r.REMOVE),e}removeMany(t){if(Ai(this._observable),!t||!t.length||this._emitBeforeChanges(_r.REMOVE))return[];const e=t instanceof uy?t.toArray():t,i=this._items,r=[],s=e.length;for(let n=0;n<s;n++){const o=e[n],a=i.indexOf(o);if(a>-1){const l=1+e5e(e,i,n+1,a+1),c=this._splice(a,l);c&&c.length>0&&r.push.apply(r,c),n+=l-1}}return this._emitAfterChanges(_r.REMOVE),r}reverse(){if(Ai(this._observable),this._emitBeforeChanges(_r.MOVE))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(_r.MOVE),this}shift(){if(Ai(this._observable),!this.length||this._emitBeforeChanges(_r.REMOVE))return;const t=SV(this._splice(0,1));return this._emitAfterChanges(_r.REMOVE),t}slice(t=0,e=this.length){return Ai(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return Ai(this._observable),this._items.some(t,e)}sort(t){if(Ai(this._observable),!this.length||this._emitBeforeChanges(_r.MOVE))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(_r.MOVE),this}splice(t,e,...i){Ai(this._observable);const r=(e?_r.REMOVE:0)|(i.length?_r.ADD:0);if(this._emitBeforeChanges(r))return[];const s=this._splice(t,e,i)||[];return this._emitAfterChanges(r),s}toArray(){return Ai(this._observable),this._items.slice()}toJSON(){return Ai(this._observable),this.toArray()}toLocaleString(){return Ai(this._observable),this._items.toLocaleString()}toString(){return Ai(this._observable),this._items.toString()}unshift(...t){return Ai(this._observable),!t.length||this._emitBeforeChanges(_r.ADD)||(this._splice(0,0,t),this._emitAfterChanges(_r.ADD)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,i){const r=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=rT(()=>this._dispatchChange())),e){if(o=r.splice(t,e),this.hasEventListener("before-remove")){const a=lh.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)n=o[l],a.reset(n),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),r.splice(t,0,n),t+=1,l-=1,c-=1);lh.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=lh.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);lh.release(a)}}if(i&&i.length){if(s){const h=[];for(const p of i){const f=s.ensureType(p);f==null&&p!=null||h.push(f)}i=h}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=t===this.length;if(a||l){const h=lh.acquire();h.target=this,h.cancellable=!0;const p=lh.acquire();p.target=this,p.cancellable=!1;for(const f of i)a?(h.reset(f),this.emit("before-add",h),h.defaultPrevented||(c?r.push(f):r.splice(t++,0,f),this._set("length",r.length),l&&(p.reset(f),this.emit("after-add",p)))):(c?r.push(f):r.splice(t++,0,f),this._set("length",r.length),p.reset(f),this.emit("after-add",p));lh.release(p),lh.release(h)}else{if(c)for(const h of i)r.push(h);else r.splice(t,0,...i);this._set("length",r.length)}}return(i&&i.length||o&&o.length)&&this._notifyChangeEvent(i,o),o}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const i=lh.acquire();i.target=this,i.cancellable=!0,i.type=t,this.emit("before-changes",i),e=i.defaultPrevented,lh.release(i)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=lh.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),lh.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const i=e.changes;O0.clear(),R0.clear(),M0.clear();for(const{added:l,removed:c}of i){if(l)if(M0.size===0&&R0.size===0)for(const h of l)O0.add(h);else for(const h of l)R0.has(h)?(M0.add(h),R0.delete(h)):M0.has(h)||O0.add(h);if(c)if(M0.size===0&&O0.size===0)for(const h of c)R0.add(h);else for(const h of c)O0.has(h)?O0.delete(h):(M0.delete(h),R0.add(h))}const r=tc.acquire();O0.forEach(l=>{r.push(l)});const s=tc.acquire();R0.forEach(l=>{s.push(l)});const n=this._items,o=e.items,a=tc.acquire();if(M0.forEach(l=>{o.indexOf(l)!==n.indexOf(l)&&a.push(l)}),e.listeners&&(r.length||s.length||a.length)){const l={target:this,added:r,removed:s,moved:a},c=e.listeners.length;for(let h=0;h<c;h++){const p=e.listeners[h];p.removed||p.callback.call(this,l)}}tc.release(r),tc.release(s),tc.release(a)}O0.clear(),R0.clear(),M0.clear()}};Sw.ofType=t=>{if(!t)return uy;if(EV.has(t))return EV.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const r in t.typeMap){const s=t.typeMap[r].prototype.declaredClass;e?e+=` | ${s}`:e=s}let i=class extends uy{};return u([mZ({Type:t,ensureType:typeof t=="function"?mn(t):Xp(t)})],i.prototype,"itemType",void 0),i=u([I(`esri.core.Collection<${e}>`)],i),EV.set(t,i),i},u([d()],Sw.prototype,"length",void 0),u([d()],Sw.prototype,"items",null),Sw=uy=u([I("esri.core.Collection")],Sw);const Nt=Sw;var eC;function i5e(t,e){switch(t.type){case"range":{const i="range"in t?t.range[0]:t.minValue,r="range"in t?t.range[1]:t.maxValue;if(i!=null&&+e<i||r!=null&&+e>r)return eC.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(t.codedValues==null||t.codedValues.every(i=>i==null||i.code!==e))return eC.INVALID_CODED_VALUE}return null}(function(t){t.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",t.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(eC||(eC={}));const r5e=oe.getLogger("esri.support.arcadeOnDemand");let CV;function Um(){return CV||(CV=(async()=>{const t=await ee(()=>import("./arcadeUtils-37f87c1a.js").then(e=>e.ax),["./arcadeUtils-37f87c1a.js","./arcadeTimeUtils-999b74fd.js","./executionError-fb3f283a.js","./number-9ca1111c.js","./hash-0ddfbf4b.js"],import.meta.url);return{arcade:t.arcade,arcadeUtils:t,Dictionary:t.Dictionary,Feature:t.arcadeFeature}})()),CV}const s5e=(t,e,i)=>yZ.create(t,e,i,null,["$feature"]),n5e=(t,e,i)=>yZ.create(t,e,i,null,["$feature","$view"]),o5e=(t,e,i,r)=>yZ.create(t,e,i,r,["$feature","$view"]);let yZ=class hye{constructor(e,i,r,s,n,o,a){this.script=e,this.evaluate=s;const l=Array.isArray(o)?o:o.fields;this.fields=l,this._syntaxTree=r,this._arcade=i,this._arcadeFeature=n,this._spatialReference=a,this._referencesGeometry=i.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,i,r,s,n,o){const{arcade:a,Feature:l,Dictionary:c}=await Um(),h=mt.fromJSON(i);let p;try{p=a.parseScript(e,o)}catch(P){return r5e.error(new W("arcade-bad-expression","Failed to parse arcade script",{script:e,error:P})),null}const f=n.reduce((P,F)=>({...P,[F]:null}),{});let m=null;v(s)&&(m=new c(s),m.immutable=!0,f.$config=null);const y=a.scriptUsesGeometryEngine(p),_=y&&a.enableGeometrySupport(),b=a.scriptUsesFeatureSet(p)&&a.enableFeatureSetSupport(),w=a.scriptIsAsync(p),S=w&&a.enableAsyncSupport(),T={vars:f,spatialReference:h,useAsync:!!S};await Promise.all([_,b,S]);const E=new Set;await a.loadDependentModules(E,p,null,w,y);const O=new c;O.immutable=!1,O.setField("scale",0);const R=a.compileScript(p,T),L=P=>("$view"in P&&P.$view&&(O.setField("scale",typeof P.$view=="object"?P.$view.scale:void 0),P.$view=O),m&&(P.$config=m),R({vars:P,spatialReference:h}));return new hye(e,a,p,L,new l,r,h)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}};const a5e=/^([0-9])/,l5e=/[^a-z0-9_\u0080-\uffff]/gi,c5e=/_{2,}/g,u5e=/^_/,h5e=/_$/;function d5e(t){return t==null?null:t.trim().replace(l5e,"_").replace(c5e,"_").replace(u5e,"").replace(h5e,"").replace(a5e,"F$1")||null}const p5e=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],f5e=["field","normalizationField"];function Mie(t,e){if(t!=null&&e!=null){for(const i of Array.isArray(t)?t:[t])if(Pie(p5e,i,e),"visualVariables"in i&&i.visualVariables)for(const r of i.visualVariables)Pie(f5e,r,e)}}function Pie(t,e,i){if(t)for(const r of t){const s=GP(r,e),n=s&&typeof s!="function"&&i.get(s);n&&gl(r,n.name,e)}}function dye(t,e){var i;if(t!=null&&((i=e==null?void 0:e.fields)!=null&&i.length))if("startField"in t){const r=e.get(t.startField),s=e.get(t.endField);t.startField=(r==null?void 0:r.name)??null,t.endField=(s==null?void 0:s.name)??null}else{const r=e.get(t.startTimeField),s=e.get(t.endTimeField);t.startTimeField=(r==null?void 0:r.name)??null,t.endTimeField=(s==null?void 0:s.name)??null}}const AV=new Set;function pye(t,e){return t&&e?(AV.clear(),L3(AV,t,e),Array.from(AV).sort()):[]}function L3(t,e,i){var r;if(i)if((r=e==null?void 0:e.fields)!=null&&r.length)if(i.includes("*"))for(const{name:s}of e.fields)t.add(s);else for(const s of i)Xu(t,e,s);else{if(i.includes("*"))return t.clear(),void t.add("*");for(const s of i)s!=null&&t.add(s)}}function Xu(t,e,i){if(typeof i=="string")if(e){const r=e.get(i);r&&t.add(r.name)}else t.add(i)}function BRt(t,e){return C(e)||C(t)?[]:e.includes("*")?(t.fields??[]).map(i=>i.name):e}async function cc(t,e,i){var n;if(!i)return;const{arcadeUtils:r}=await Um(),s=r.extractFieldNames(i,(n=e==null?void 0:e.fields)==null?void 0:n.map(o=>o.name));for(const o of s)Xu(t,e,o)}async function fye(t,e,i){if(i&&i!=="1=1"){const r=(await ee(()=>import("./WhereClause-d3d68e94.js").then(s=>s.W),["./WhereClause-d3d68e94.js","./executionError-fb3f283a.js"],import.meta.url)).WhereClause.create(i,e);if(!r.isStandardized)throw new W("fieldUtils:collectFilterFields","Where clause is not standardized",{where:i});L3(t,e,r.fieldNames)}}function m5e({displayField:t,fields:e}){return t||(e&&e.length?OV(e,"name-or-title")||OV(e,"unique-identifier")||OV(e,"type-or-category")||g5e(e):null)}function g5e(t){for(const e of t){if(!e||!e.name)continue;const i=e.name.toLowerCase();if(i.includes("name")||i.includes("title"))return e.name}return null}function OV(t,e){for(const i of t)if(i&&i.valueType&&i.valueType===e)return i.name;return null}async function zRt(t,e){var r;if(!e)return;const i=(r=e.elevationInfo)==null?void 0:r.featureExpressionInfo;return i?i.collectRequiredFields(t,e.fieldsIndex):void 0}function y5e(t,e,i){i.onStatisticExpression?cc(t,e,i.onStatisticExpression.expression):t.add(i.onStatisticField)}async function GRt(t,e,i){if(!e||!i||!("fields"in i))return;const r=[],s=i.popupTemplate;r.push(_5e(t,e,s)),i.fields&&r.push(...i.fields.map(async n=>y5e(t,e.fieldsIndex,n))),await Promise.all(r)}async function _5e(t,e,i){const r=[];i!=null&&i.expressionInfos&&r.push(...i.expressionInfos.map(n=>cc(t,e.fieldsIndex,n.expression)));const s=i==null?void 0:i.content;if(Array.isArray(s))for(const n of s)n.type==="expression"&&n.expressionInfo&&r.push(cc(t,e.fieldsIndex,n.expressionInfo.expression));await Promise.all(r)}async function jRt(t,e,i){e&&(e.timeInfo&&v(i)&&i.timeExtent&&L3(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&L3(t,e.fieldsIndex,[e.floorInfo.floorField]),v(i)&&v(i.where)&&await fye(t,e.fieldsIndex,i.where))}async function HRt(t,e,i){e&&i&&await Promise.all(i.map(r=>v5e(t,e,r)))}async function v5e(t,e,i){e&&i&&(i.valueExpression?await cc(t,e.fieldsIndex,i.valueExpression):i.field&&Xu(t,e.fieldsIndex,i.field))}function qRt(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;return e?pye(t.fieldsIndex,[e&&e.creatorField,e&&e.creationDateField,e&&e.editorField,e&&e.editDateField]):[]}async function WRt(t,e){const{labelingInfo:i,fieldsIndex:r}=e;i&&i.length&&await Promise.all(i.map(s=>b5e(t,r,s)))}async function b5e(t,e,i){if(!i)return;const r=i.getLabelExpression(),s=i.where;if(r.type==="arcade")await cc(t,e,r.expression);else{const n=r.expression.match(/{[^}]*}/g);n&&n.forEach(o=>{Xu(t,e,o.slice(1,-1))})}await fye(t,e,s)}function w5e(t){const e=t.defaultValue;return e!==void 0&&yye(t,e)?e:t.nullable?null:void 0}function mye(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function x5e(t){return t===null||mye(t)}const _Z="isInteger"in Number?Number.isInteger:t=>typeof t=="number"&&isFinite(t)&&Math.floor(t)===t;function T5e(t){return t===null||_Z(t)}function gye(t){return t!=null&&typeof t=="string"}function S5e(t){return t===null||gye(t)}function E5e(){return!0}function yye(t,e){let i;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":i=t.nullable?T5e:_Z;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=t.nullable?x5e:mye;break;case"string":case"esriFieldTypeString":i=t.nullable?S5e:gye;break;default:i=E5e}return arguments.length===1?i:i(e)}const C5e=["integer","small-integer","single","double"],A5e=new Set([...C5e,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);function X6(t){return t!=null&&A5e.has(t.type)}function XRt(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}var w4,x4;function YRt(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function ZRt(t,e){return t==null||t.nullable&&e===null?null:X6(t)&&!O5e(t.type,Number(e))?w4.OUT_OF_RANGE:yye(t,e)?t.domain?i5e(t.domain,e):null:x4.INVALID_TYPE}function O5e(t,e){const i=typeof t=="string"?_ye(t):t;if(!i)return!1;const r=i.min,s=i.max;return i.isInteger?_Z(e)&&e>=r&&e<=s:e>=r&&e<=s}function _ye(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return R5e;case"esriFieldTypeInteger":case"integer":return M5e;case"esriFieldTypeSingle":case"single":return P5e;case"esriFieldTypeDouble":case"double":return I5e}}(function(t){t.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(w4||(w4={})),function(t){t.INVALID_TYPE="type-validation-error::invalid-type"}(x4||(x4={}));const R5e={min:-32768,max:32767,isInteger:!0},M5e={min:-2147483648,max:2147483647,isInteger:!0},P5e={min:-34e37,max:12e37,isInteger:!1},I5e={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function JRt(t,e,i){switch(t){case eC.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case eC.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case x4.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case w4.OUT_OF_RANGE:{const{min:r,max:s}=_ye(e.type);return`Value ${i} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${r} to ${s}`}}}function $5e(t,e){return!L5e(t,e,null)}function L5e(t,e,i){if(!e||!e.attributes||!t){if(v(i))for(const n of t??[])i.add(n);return!0}const r=e.attributes;let s=!1;for(const n of t)if(!(n in r)){if(s=!0,!v(i))break;i.add(n)}return s}function vye(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}let lN=class extends Ie{constructor(e){super(e),this.type=null}};u([d({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],lN.prototype,"type",void 0),lN=u([I("esri.popup.content.Content")],lN);const m1=lN;var x7;let bb=x7=class extends m1{constructor(t){super(t),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new x7({description:this.description,displayType:this.displayType,title:this.title})}};u([d({type:String,json:{write:!0}})],bb.prototype,"description",void 0),u([d({type:["auto","preview","list"],json:{write:!0}})],bb.prototype,"displayType",void 0),u([d({type:String,json:{write:!0}})],bb.prototype,"title",void 0),u([d({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],bb.prototype,"type",void 0),bb=x7=u([I("esri.popup.content.AttachmentsContent")],bb);const D3=bb;var T7;let wb=T7=class extends m1{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new T7({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?ae(this.outFields):null})}};u([d()],wb.prototype,"creator",void 0),u([d()],wb.prototype,"destroyer",void 0),u([d()],wb.prototype,"outFields",void 0),u([d({type:["custom"],readOnly:!0})],wb.prototype,"type",void 0),wb=T7=u([I("esri.popup.content.CustomContent")],wb);const D5e=wb;var S7;let F2=S7=class extends Ie{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new S7({title:this.title,expression:this.expression})}};u([d({type:String,json:{write:!0}})],F2.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],F2.prototype,"expression",void 0),u([d({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],F2.prototype,"returnType",void 0),F2=S7=u([I("esri.popup.ElementExpressionInfo")],F2);const bye=F2;var E7;let qO=E7=class extends m1{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){var t;return new E7({expressionInfo:(t=this.expressionInfo)==null?void 0:t.clone()})}};u([d({type:bye,json:{write:!0}})],qO.prototype,"expressionInfo",void 0),u([d({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],qO.prototype,"type",void 0),qO=E7=u([I("esri.popup.content.ExpressionContent")],qO);const vZ=qO;function At(t,e={}){const i=t instanceof Gi?t:new Gi(t,e),r={type:(e==null?void 0:e.ignoreUnknown)??1?i.apiValues:String,json:{type:i.jsonValues,read:!(e!=null&&e.readOnly)&&{reader:i.read},write:{writer:i.write}}};return(e==null?void 0:e.readOnly)!==void 0&&(r.readOnly=!!e.readOnly),(e==null?void 0:e.default)!==void 0&&(r.json.default=e.default),(e==null?void 0:e.name)!==void 0&&(r.json.name=e.name),(e==null?void 0:e.nonNullable)!==void 0&&(r.nonNullable=e.nonNullable),d(r)}const N3=Ua()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});N3.toJSON.bind(N3);N3.fromJSON.bind(N3);let AM;var ufe,hfe;const N5e=((ufe=globalThis.esriConfig)==null?void 0:ufe.locale)??((hfe=globalThis.dojoConfig)==null?void 0:hfe.locale);function wye(){var t;return N5e??((t=globalThis.navigator)==null?void 0:t.language)??"en"}function od(){return AM===void 0&&(AM=wye()),AM}const OM=[];function xye(t){return OM.push(t),{remove(){OM.splice(OM.indexOf(t),1)}}}const C7=[];function bZ(t){return C7.push(t),{remove(){OM.splice(C7.indexOf(t),1)}}}function F5e(){const t=wye();AM!==t&&(AM=t,[...C7].forEach(e=>{e.call(null,t)}),[...OM].forEach(e=>{e.call(null,t)}))}var dfe;(dfe=globalThis.addEventListener)==null||dfe.call(globalThis,"languagechange",F5e);const ff={year:"numeric",month:"numeric",day:"numeric"},LA={year:"numeric",month:"long",day:"numeric"},DA={year:"numeric",month:"short",day:"numeric"},NA={year:"numeric",month:"long",weekday:"long",day:"numeric"},Th={hour:"numeric",minute:"numeric"},Id={...Th,second:"numeric"},wZ={"short-date":ff,"short-date-short-time":{...ff,...Th},"short-date-short-time-24":{...ff,...Th,hour12:!1},"short-date-long-time":{...ff,...Id},"short-date-long-time-24":{...ff,...Id,hour12:!1},"short-date-le":ff,"short-date-le-short-time":{...ff,...Th},"short-date-le-short-time-24":{...ff,...Th,hour12:!1},"short-date-le-long-time":{...ff,...Id},"short-date-le-long-time-24":{...ff,...Id,hour12:!1},"long-month-day-year":LA,"long-month-day-year-short-time":{...LA,...Th},"long-month-day-year-short-time-24":{...LA,...Th,hour12:!1},"long-month-day-year-long-time":{...LA,...Id},"long-month-day-year-long-time-24":{...LA,...Id,hour12:!1},"day-short-month-year":DA,"day-short-month-year-short-time":{...DA,...Th},"day-short-month-year-short-time-24":{...DA,...Th,hour12:!1},"day-short-month-year-long-time":{...DA,...Id},"day-short-month-year-long-time-24":{...DA,...Id,hour12:!1},"long-date":NA,"long-date-short-time":{...NA,...Th},"long-date-short-time-24":{...NA,...Th,hour12:!1},"long-date-long-time":{...NA,...Id},"long-date-long-time-24":{...NA,...Id,hour12:!1},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":Th,"long-time":Id},F3=Ua()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});F3.apiValues;F3.toJSON.bind(F3);F3.fromJSON.bind(F3);const U5e={ar:"ar-u-nu-latn-ca-gregory"};let A7=new WeakMap,Tye=wZ["short-date-short-time"];function V5e(t){const e=t||Tye;let i=A7.get(e);if(!i){const r=od(),s=U5e[od()]||r;i=new Intl.DateTimeFormat(s,e),A7.set(e,i)}return i}function Y6(t){return t?wZ[t]:null}function Vm(t,e){return V5e(e).format(t)}bZ(()=>{A7=new WeakMap,Tye=wZ["short-date-short-time"]});const k5e={ar:"ar-u-nu-latn"};let cN=new WeakMap,Sye={};function B5e(t){const e=t||Sye;if(!cN.has(e)){const i=od(),r=k5e[od()]||i;cN.set(e,new Intl.NumberFormat(r,t))}return cN.get(e)}function Eye(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function km(t,e){return t===-0&&(t=0),B5e(e).format(t)}bZ(()=>{cN=new WeakMap,Sye={}});var O7;let xb=O7=class extends Ie{constructor(t){super(t),this.dateFormat=null,this.dateTimeFormatOptions=null,this.digitSeparator=!1,this.places=null}clone(){return new O7({dateFormat:this.dateFormat,digitSeparator:this.digitSeparator,places:this.places})}format(t){return this.dateFormat?Vm(t,{...Y6(this.dateFormat),...this.dateTimeFormatOptions}):km(t,Eye(this))}formatRasterPixelValue(t){if(t.includes("-"))return t;let e,i;return t.trim().includes(",")?(e=",",i=e+" ",this._formatDelimitedString(t,e,i,this)):t.trim().includes(";")?(e=";",i=e+" ",this._formatDelimitedString(t,e,i,this)):t.trim().includes(" ")?(e=i=" ",this._formatDelimitedString(t,e,i,this)):this.format(Number(t))}_formatDelimitedString(t,e,i,r){return t&&e&&i&&r?t.trim().split(e).map(s=>this.format(Number(s))).join(i):t}};u([At(N3)],xb.prototype,"dateFormat",void 0),u([d({type:Object,json:{read:!1}})],xb.prototype,"dateTimeFormatOptions",void 0),u([d({type:Boolean,json:{write:!0}})],xb.prototype,"digitSeparator",void 0),u([d({type:Yr,json:{write:!0}})],xb.prototype,"places",void 0),xb=O7=u([I("esri.popup.support.FieldInfoFormat")],xb);const zS=xb;var R7;let jd=R7=class extends Ie{constructor(t){super(t),this.fieldName=null,this.format=null,this.isEditable=!1,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new R7({fieldName:this.fieldName,format:this.format?ae(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};u([d({type:String,json:{write:!0}})],jd.prototype,"fieldName",void 0),u([d({type:zS,json:{write:!0}})],jd.prototype,"format",void 0),u([d({type:Boolean,json:{write:!0,default:!1}})],jd.prototype,"isEditable",void 0),u([d({type:String,json:{write:!0}})],jd.prototype,"label",void 0),u([At(new Gi({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],jd.prototype,"stringFieldOption",void 0),u([d({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],jd.prototype,"statisticType",void 0),u([d({type:String,json:{write:!0}})],jd.prototype,"tooltip",void 0),u([d({type:Boolean,json:{write:!0}})],jd.prototype,"visible",void 0),jd=R7=u([I("esri.popup.FieldInfo")],jd);const JP=jd;var M7;let Lg=M7=class extends m1{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,e){e.fieldInfos=t&&t.map(i=>i.toJSON())}clone(){return new M7(ae({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};u([d({type:Object,json:{write:!0}})],Lg.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],Lg.prototype,"description",void 0),u([d({type:[JP]})],Lg.prototype,"fieldInfos",void 0),u([lt("fieldInfos")],Lg.prototype,"writeFieldInfos",null),u([d({type:String,json:{write:!0}})],Lg.prototype,"title",void 0),u([d({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],Lg.prototype,"type",void 0),Lg=M7=u([I("esri.popup.content.FieldsContent")],Lg);const tC=Lg;let Tb=class extends Ie{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};u([d({type:String,json:{write:!0}})],Tb.prototype,"altText",void 0),u([d({type:String,json:{write:!0}})],Tb.prototype,"caption",void 0),u([d({type:String,json:{write:!0}})],Tb.prototype,"title",void 0),u([d({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],Tb.prototype,"type",void 0),Tb=u([I("esri.popup.content.mixins.MediaInfo")],Tb);const xZ=Tb;var P7;let U2=P7=class extends $e{constructor(t){super(t),this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new P7({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};u([d()],U2.prototype,"fieldName",void 0),u([d()],U2.prototype,"tooltip",void 0),u([d()],U2.prototype,"value",void 0),U2=P7=u([I("esri.popup.content.support.ChartMediaInfoValueSeries")],U2);const Cye=U2;var I7;let Sb=I7=class extends Ie{constructor(t){super(t),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new I7({fields:ae(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};u([d({type:[String],json:{write:!0}})],Sb.prototype,"fields",void 0),u([d({type:String,json:{write:!0}})],Sb.prototype,"normalizeField",void 0),u([d({type:[Cye],json:{read:!1}})],Sb.prototype,"series",void 0),u([d({type:String,json:{write:!0}})],Sb.prototype,"tooltipField",void 0),Sb=I7=u([I("esri.popup.content.support.ChartMediaInfoValue")],Sb);const z5e=Sb;let WO=class extends xZ{constructor(e){super(e),this.type=null,this.value=null}};u([d({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],WO.prototype,"type",void 0),u([d({type:z5e,json:{write:!0}})],WO.prototype,"value",void 0),WO=u([I("esri.popup.content.mixins.ChartMediaInfo")],WO);const Z6=WO,J6=Ua()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var $7;let uN=$7=class extends Z6{constructor(t){super(t),this.type="bar-chart"}clone(){return new $7({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:J6.write}})],uN.prototype,"type",void 0),uN=$7=u([I("esri.popup.content.BarChartMediaInfo")],uN);const Aye=uN;var L7;let hN=L7=class extends Z6{constructor(t){super(t),this.type="column-chart"}clone(){return new L7({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:J6.write}})],hN.prototype,"type",void 0),hN=L7=u([I("esri.popup.content.ColumnChartMediaInfo")],hN);const Oye=hN;var D7;let XO=D7=class extends Ie{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new D7({linkURL:this.linkURL,sourceURL:this.sourceURL})}};u([d({type:String,json:{write:!0}})],XO.prototype,"linkURL",void 0),u([d({type:String,json:{write:!0}})],XO.prototype,"sourceURL",void 0),XO=D7=u([I("esri.popup.content.support.ImageMediaInfoValue")],XO);const G5e=XO;var N7;let V2=N7=class extends xZ{constructor(t){super(t),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new N7({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};u([d({type:Number,json:{write:!0}})],V2.prototype,"refreshInterval",void 0),u([d({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],V2.prototype,"type",void 0),u([d({type:G5e,json:{write:!0}})],V2.prototype,"value",void 0),V2=N7=u([I("esri.popup.content.ImageMediaInfo")],V2);const Rye=V2;var F7;let dN=F7=class extends Z6{constructor(t){super(t),this.type="line-chart"}clone(){return new F7({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:J6.write}})],dN.prototype,"type",void 0),dN=F7=u([I("esri.popup.content.LineChartMediaInfo")],dN);const Mye=dN;var U7;let pN=U7=class extends Z6{constructor(t){super(t),this.type="pie-chart"}clone(){return new U7({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:J6.write}})],pN.prototype,"type",void 0),pN=U7=u([I("esri.popup.content.PieChartMediaInfo")],pN);const Pye=pN,Iye={base:xZ,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":Aye,"column-chart":Oye,"line-chart":Mye,"pie-chart":Pye,image:Rye}};var V7;let Hd=V7=class extends m1{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?Rye.fromJSON(e):e.type==="barchart"?Aye.fromJSON(e):e.type==="columnchart"?Oye.fromJSON(e):e.type==="linechart"?Mye.fromJSON(e):e.type==="piechart"?Pye.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(i=>i.toJSON())}clone(){return new V7(ae({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};u([d()],Hd.prototype,"activeMediaInfoIndex",void 0),u([d({type:Object,json:{write:!0}})],Hd.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],Hd.prototype,"description",void 0),u([d({types:[Iye]})],Hd.prototype,"mediaInfos",void 0),u([Qe("mediaInfos")],Hd.prototype,"readMediaInfos",null),u([lt("mediaInfos")],Hd.prototype,"writeMediaInfos",null),u([d({type:String,json:{write:!0}})],Hd.prototype,"title",void 0),u([d({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],Hd.prototype,"type",void 0),Hd=V7=u([I("esri.popup.content.MediaContent")],Hd);const U3=Hd;var k7;let YO=k7=class extends Ie{constructor(t){super(t),this.field=null,this.order=null}clone(){return new k7({field:this.field,order:this.order})}};u([d({type:String,json:{write:!0}})],YO.prototype,"field",void 0),u([d({type:["asc","desc"],json:{write:!0}})],YO.prototype,"order",void 0),YO=k7=u([I("esri.popup.support.RelatedRecordsInfoFieldOrder")],YO);const TZ=YO;let Df=class extends Cs(m1){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};u([d({type:String,json:{write:!0}})],Df.prototype,"description",void 0),u([d({type:Number,json:{type:Yr,write:!0}})],Df.prototype,"displayCount",void 0),u([d({type:["list"],json:{write:!0}})],Df.prototype,"displayType",void 0),u([d({type:[TZ],json:{write:!0}})],Df.prototype,"orderByFields",void 0),u([d({type:Number,json:{type:Yr,write:!0}})],Df.prototype,"relationshipId",void 0),u([d({type:String,json:{write:!0}})],Df.prototype,"title",void 0),u([d({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],Df.prototype,"type",void 0),Df=u([I("esri.popup.content.RelationshipContent")],Df);const T4=Df;var B7;let ZO=B7=class extends m1{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new B7({text:this.text})}};u([d({type:String,json:{write:!0}})],ZO.prototype,"text",void 0),u([d({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],ZO.prototype,"type",void 0),ZO=B7=u([I("esri.popup.content.TextContent")],ZO);const iC=ZO,j5e={base:null,key:"type",typeMap:{attachment:D3,media:U3,text:iC,expression:vZ,field:tC,relationship:T4}};var z7;let Eb=z7=class extends Ie{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new z7({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],Eb.prototype,"name",void 0),u([d({type:String,json:{write:!0}})],Eb.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],Eb.prototype,"expression",void 0),u([d({type:["string","number"],json:{write:!0}})],Eb.prototype,"returnType",void 0),Eb=z7=u([I("esri.popup.ExpressionInfo")],Eb);const $ye=Eb;var G7;let JO=G7=class extends Ie{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new G7({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};u([d({type:Boolean,json:{write:!0}})],JO.prototype,"returnTopmostRaster",void 0),u([d({type:Boolean,json:{write:!0}})],JO.prototype,"showNoDataRecords",void 0),JO=G7=u([I("esri.popup.LayerOptions")],JO);const H5e=JO;var j7;let KO=j7=class extends Ie{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new j7({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?ae(this.orderByFields):null})}};u([d({type:Boolean,json:{write:!0}})],KO.prototype,"showRelatedRecords",void 0),u([d({type:[TZ],json:{write:!0}})],KO.prototype,"orderByFields",void 0),KO=j7=u([I("esri.popup.RelatedRecordsInfo")],KO);const q5e=KO;let Lye=0;const KP=t=>{let e=class extends t{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+Lye++})}};return e=u([I("esri.core.Identifiable")],e),e},SZ=t=>{let e=class extends t{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Lye++})}};return e=u([I("esri.core.NumericIdentifiable")],e),e};let Iie=class extends KP(class{}){};Iie=u([I("esri.core.Identifiable")],Iie);var H7;let qd=H7=class extends KP($e){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new H7({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};u([d()],qd.prototype,"active",void 0),u([d()],qd.prototype,"className",void 0),u([d()],qd.prototype,"disabled",void 0),u([d()],qd.prototype,"id",void 0),u([d()],qd.prototype,"indicator",void 0),u([d()],qd.prototype,"title",void 0),u([d()],qd.prototype,"type",void 0),u([d()],qd.prototype,"visible",void 0),qd=H7=u([I("esri.support.actions.ActionBase")],qd);const K6=qd;var q7;let fN=q7=class extends K6{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new q7({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};u([d()],fN.prototype,"image",void 0),fN=q7=u([I("esri.support.Action.ActionButton")],fN);const ZC=fN;var W7;let QO=W7=class extends K6{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new W7({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};u([d()],QO.prototype,"image",void 0),u([d()],QO.prototype,"value",void 0),QO=W7=u([I("esri.support.Action.ActionToggle")],QO);const Dye=QO,W5e="esri.PopupTemplate",X5e=oe.getLogger(W5e),FA="relationships/",$ie="expression/",Y5e=Nt.ofType({key:"type",defaultKeyValue:"button",base:K6,typeMap:{button:ZC,toggle:Dye}}),Z5e={base:m1,key:"type",typeMap:{media:U3,custom:D5e,text:iC,attachments:D3,fields:tC,expression:vZ,relationship:T4}},J5e=["attachments","fields","media","text","expression","relationship"];let Eo=class extends Cs(Ie){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(i=>Xp(Z5e,i)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||su(e)?e:(X5e.error("content error","unsupported content value",{value:e}),null)}readContent(e,i){const{popupElements:r}=i;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(i.description,i.mediaInfos,r):this._readPopupInfo(i)}writeContent(e,i,r,s){typeof e!="string"?Array.isArray(e)&&(i.popupElements=e.filter(n=>J5e.includes(n.type)).map(n=>n&&n.toJSON(s)),i.popupElements.forEach(n=>{n.type==="attachments"?this._writeAttachmentContent(i):n.type==="media"?this._writeMediaContent(n,i):n.type==="text"?this._writeTextContent(n,i):n.type==="relationship"&&this._writeRelationshipContent(n,i)})):i.description=e}writeFieldInfos(e,i,r,s){const{content:n}=this,o=Array.isArray(n)?n:null;if(e){const a=o?o.filter(c=>c.type==="fields"):[],l=a.length&&a.every(c=>{var h;return(h=c.fieldInfos)==null?void 0:h.length});i.fieldInfos=e.filter(Boolean).map(c=>{const h=c.toJSON(s);return l&&(h.visible=!1),h})}if(o)for(const a of o)a.type==="fields"&&this._writeFieldsContent(a,i)}writeLayerOptions(e,i,r,s){i[r]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(s)}writeTitle(e,i){i.title=e||""}async collectRequiredFields(e,i){const r=this.expressionInfos||[];await this._collectExpressionInfoFields(e,i,[...r,...this._getContentExpressionInfos(this.content,r)]),L3(e,i,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const i=new Set;return await this.collectRequiredFields(i,e),[...i].sort()}_writeFieldsContent(e,i){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const r=ae(e.fieldInfos);Array.isArray(i.fieldInfos)?r.forEach(s=>{const n=i.fieldInfos.find(o=>o.fieldName.toLowerCase()===s.fieldName.toLowerCase());n?n.visible=!0:i.fieldInfos.push(s)}):i.fieldInfos=r}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,i){var n,o;const r=((n=e.orderByFields)==null?void 0:n.map(a=>this._toFieldOrderJSON(a,e.relationshipId)))||[],s=[...((o=i.relatedRecordsInfo)==null?void 0:o.orderByFields)||[],...r];i.relatedRecordsInfo={showRelatedRecords:!0,...(s==null?void 0:s.length)&&{orderByFields:s}}}_writeTextContent(e,i){!i.description&&e.text&&(i.description=e.text)}_writeMediaContent(e,i){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const r=ae(e.mediaInfos);Array.isArray(i.mediaInfos)?i.mediaInfos=[...i.mediaInfos,...r]:i.mediaInfos=r}_readPopupInfoElements(e,i,r){const s={description:!1,mediaInfos:!1};return r.map(n=>n.type==="media"?(n.mediaInfos||!i||s.mediaInfos||(n.mediaInfos=i,s.mediaInfos=!0),U3.fromJSON(n)):n.type==="text"?(n.text||!e||s.description||(n.text=e,s.description=!0),iC.fromJSON(n)):n.type==="attachments"?D3.fromJSON(n):n.type==="fields"?tC.fromJSON(n):n.type==="expression"?vZ.fromJSON(n):n.type==="relationship"?T4.fromJSON(n):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:i,order:r}=e;if(!(i!=null&&i.startsWith(FA)))return null;const s=i.replace(FA,"").split("/");if(s.length!==2)return null;const n=parseInt(s[0],10),o=s[1];return typeof n=="number"&&o?T4.fromJSON({relationshipId:n,orderByFields:[{field:o,order:r}]}):null}_toFieldOrderJSON(e,i){const{order:r,field:s}=e;return{field:`${FA}${i}/${s}`,order:r}}_readPopupInfo({description:e,mediaInfos:i,showAttachments:r,relatedRecordsInfo:s={showRelatedRecords:!1}}){const n=[];e?n.push(new iC({text:e})):n.push(new tC),Array.isArray(i)&&i.length&&n.push(U3.fromJSON({mediaInfos:i})),r&&n.push(D3.fromJSON({displayType:"auto"}));const{showRelatedRecords:o,orderByFields:a}=s;return o&&(a!=null&&a.length)&&a.forEach(l=>{const c=this._toRelationshipContent(l);c&&n.push(c)}),n.length?n:e}_getContentElementFields(e){const i=e==null?void 0:e.type;if(i==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(i==="custom")return e.outFields||[];if(i==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(i==="media"){const r=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...r.reduce((s,n)=>[...s,...this._getMediaInfoFields(n)],[])]}return i==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:i,title:r,value:s}=e,n=s||{},{fields:o,normalizeField:a,tooltipField:l,sourceURL:c,linkURL:h}=n,p=[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(c),...this._extractFieldNames(h),...o??[]];return a&&p.push(a),l&&p.push(l),p}_getContentExpressionInfos(e,i){return Array.isArray(e)?e.reduce((r,s)=>[...r,...s.type==="expression"&&s.expressionInfo?[s.expressionInfo]:[]],i):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((i,r)=>[...i,...this._getContentElementFields(r)],[]):[]}async _collectExpressionInfoFields(e,i,r){r&&await Promise.all(r.map(s=>cc(e,i,s.expression)))}_getFieldInfoFields(e){return e?e.filter(i=>i.visible===void 0||!!i.visible).map(i=>i.fieldName).filter(i=>!i.startsWith(FA)&&!i.startsWith($ie)):[]}_getActionsFields(e){return e?e.toArray().reduce((i,r)=>[...i,...this._getActionFields(r)],[]):[]}_getActionFields(e){const{className:i,title:r,type:s}=e,n=s==="button"||s==="toggle"?e.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(n)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const i=/{[^}]*}/g,r=e.match(i);if(!r)return[];const s=/\{(\w+):.+\}/,n=r.filter(o=>!(o.indexOf(`{${FA}`)===0||o.indexOf(`{${$ie}`)===0)).map(o=>o.replace(s,"{$1}"));return n?n.map(o=>o.slice(1,-1)):[]}};u([d({type:Y5e})],Eo.prototype,"actions",void 0),u([d()],Eo.prototype,"content",void 0),u([wi("content")],Eo.prototype,"castContent",null),u([Qe("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],Eo.prototype,"readContent",null),u([lt("content",{popupElements:{type:Nt.ofType(j5e)},showAttachments:{type:Boolean},mediaInfos:{type:Nt.ofType(Iye)},description:{type:String},relatedRecordsInfo:{type:q5e}})],Eo.prototype,"writeContent",null),u([d({type:[$ye],json:{write:!0}})],Eo.prototype,"expressionInfos",void 0),u([d({type:[JP]})],Eo.prototype,"fieldInfos",void 0),u([lt("fieldInfos")],Eo.prototype,"writeFieldInfos",null),u([d({type:H5e})],Eo.prototype,"layerOptions",void 0),u([lt("layerOptions")],Eo.prototype,"writeLayerOptions",null),u([d({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],Eo.prototype,"lastEditInfoEnabled",void 0),u([d()],Eo.prototype,"outFields",void 0),u([d()],Eo.prototype,"overwriteActions",void 0),u([d()],Eo.prototype,"returnGeometry",void 0),u([d({json:{type:String}})],Eo.prototype,"title",void 0),u([lt("title")],Eo.prototype,"writeTitle",null),Eo=u([I("esri.PopupTemplate")],Eo);const QP=Eo,S4={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function Nye(t){return S4[t]||S4[t.toLowerCase()]}function EZ(t){return S4[t]??S4[t.toLowerCase()]}function K5e(t){return[...EZ(t)]}function RV(t,e,i){i<0&&++i,i>1&&--i;const r=6*i;return r<1?t+(e-t)*r:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}function Fye(t,e,i,r=1){const s=(t%360+360)%360/360,n=i<=.5?i*(e+1):i+e-i*e,o=2*i-n;return[Math.round(255*RV(o,n,s+1/3)),Math.round(255*RV(o,n,s)),Math.round(255*RV(o,n,s-1/3)),r]}function Q5e(t){const e=t.length>5,i=e?8:4,r=(1<<i)-1,s=e?1:17,n=e?t.length===9:t.length===5;let o=Number("0x"+t.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&r,o>>=i,a[3]=s*l/255),l=o&r,o>>=i,a[2]=s*l,l=o&r,o>>=i,a[1]=s*l,l=o&r,o>>=i,a[0]=s*l,a}function s$(t){return we(kY(t),0,255)}function n$(t,e,i){return t=Number(t),isNaN(t)?i:t<e?e:t>i?i:t}let mN=class va{static blendColors(e,i,r,s=new va){return s.r=Math.round(e.r+(i.r-e.r)*r),s.g=Math.round(e.g+(i.g-e.g)*r),s.b=Math.round(e.b+(i.b-e.b)*r),s.a=e.a+(i.a-e.a)*r,s._sanitize()}static fromRgb(e,i){const r=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(r){const s=r[2].split(/\s*,\s*/),n=r[1];if(n==="rgb"&&s.length===3||n==="rgba"&&s.length===4){const o=s[0];if(o.charAt(o.length-1)==="%"){const a=s.map(l=>2.56*parseFloat(l));return s.length===4&&(a[3]=parseFloat(s[3])),va.fromArray(a,i)}return va.fromArray(s.map(a=>parseFloat(a)),i)}if(n==="hsl"&&s.length===3||n==="hsla"&&s.length===4)return va.fromArray(Fye(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),i)}return null}static fromHex(e,i=new va){if(e.length!==4&&e.length!==7||e[0]!=="#")return null;const r=e.length===4?4:8,s=(1<<r)-1;let n=Number("0x"+e.substr(1));return isNaN(n)?null:(["b","g","r"].forEach(o=>{const a=n&s;n>>=r,i[o]=r===4?17*a:a}),i.a=1,i)}static fromArray(e,i=new va){return i._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(i.a)&&(i.a=1),i._sanitize()}static fromString(e,i){const r=Nye(e)?EZ(e):null;return r&&va.fromArray(r,i)||va.fromRgb(e,i)||va.fromHex(e,i)}static fromJSON(e){return e&&new va([e[0],e[1],e[2],e[3]/255])}static toUnitRGB(e){return v(e)?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return v(e)?[e.r/255,e.g/255,e.b/255,e.a!=null?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?va.fromString(e,this):Array.isArray(e)?va.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof va||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const e=this.r.toString(16),i=this.g.toString(16),r=this.b.toString(16);return`#${e.length<2?"0"+e:e}${i.length<2?"0"+i:i}${r.length<2?"0"+r:r}`}toCss(e=!1){const i=this.r+", "+this.g+", "+this.b;return e?`rgba(${i}, ${this.a})`:`rgb(${i})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=va.AlphaMode.ALWAYS){const i=s$(this.r),r=s$(this.g),s=s$(this.b);return e===va.AlphaMode.ALWAYS||this.a!==1?[i,r,s,s$(255*this.a)]:[i,r,s]}clone(){return new va(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return v(e)&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(n$(this.r,0,255)),this.g=Math.round(n$(this.g,0,255)),this.b=Math.round(n$(this.b,0,255)),this.a=n$(this.a,0,1),this}_set(e,i,r,s){this.r=e,this.g=i,this.b=r,this.a=s}};mN.prototype.declaredClass="esri.Color",function(t){var e;(e=t.AlphaMode||(t.AlphaMode={}))[e.ALWAYS=0]="ALWAYS",e[e.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(mN||(mN={}));const ot=mN,Lie=new Gi({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let e6e=0,k2=class extends Ie{constructor(e){super(e),this.id="sym"+e6e++,this.type=null,this.color=new ot([0,0,0,1])}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,i){}hash(){return JSON.stringify(this.toJSON())}clone(){}};u([d({type:Lie.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:Lie.write}}})],k2.prototype,"type",void 0),u([d({type:ot,json:{write:{allowNull:!0}}})],k2.prototype,"color",void 0),u([Qe("color")],k2.prototype,"readColor",null),k2=u([I("esri.symbols.Symbol")],k2);const nu=k2;var X7;let g_=X7=class extends nu{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){if(t)for(const i in t)e[i]=t[i]}async collectRequiredFields(t,e){var i;if(((i=this.data)==null?void 0:i.type)==="CIMSymbolReference"){const r=this.data.primitiveOverrides;if(r){const s=r.map(n=>{const o=n.valueExpressionInfo;return cc(t,e,o.expression)});await Promise.all(s)}}}clone(){return new X7({data:ae(this.data)})}hash(){return DY(JSON.stringify(this.data)).toString()}};u([d({json:{write:!1}})],g_.prototype,"color",void 0),u([d({json:{write:!0}})],g_.prototype,"data",void 0),u([Qe("data",["symbol"])],g_.prototype,"readData",null),u([lt("data",{})],g_.prototype,"writeData",null),u([At({CIMSymbolReference:"cim"},{readOnly:!0})],g_.prototype,"type",void 0),g_=X7=u([I("esri.symbols.CIMSymbol")],g_);const JC=g_;let B2=class extends Ie{constructor(e){super(e),this.enabled=!0,this.type=null}writeEnabled(e,i,r){e||(i[r]=e)}};u([d({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],B2.prototype,"enabled",void 0),u([lt("enabled")],B2.prototype,"writeEnabled",null),u([d({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],B2.prototype,"type",void 0),B2=u([I("esri.symbols.Symbol3DLayer")],B2);const Km=B2,t6e=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,i6e="screenUtils.toPt: input not recognized!",Uye=96;function ko(t){return t?t/72*Uye:0}function gd(t){return t?72*t/Uye:0}function mr(t){if(typeof t=="string"){const e=t.match(t6e);if(e){const i=Number(e[1]),r=e[3]&&e[3].toLowerCase(),s=t.charAt(0)==="-",n=r==="px"?gd(i):i;return s?-n:n}return console.warn(i6e),null}return t}function Ra(t=0,e=0){return{x:t,y:e}}function ms(t=0,e=0){return[t,e]}function Vye(t=0,e=0){return[t,e]}function na(t=0,e=0,i=0){return[t,e,i]}function oMt(t){return t}function aMt(t){return t}function lMt(t){return t}function pm(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}function Q6(t){const e=kY(100*(1-t));return Math.max(0,Math.min(e,100))}function V3(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}function r6e(t,e){const i=e.transparency!=null?V3(e.transparency):1,r=e.color;return r&&Array.isArray(r)?new ot([r[0]||0,r[1]||0,r[2]||0,i]):null}function s6e(t,e){e.color=t.toJSON().slice(0,3);const i=Q6(t.a);i!==0&&(e.transparency=i)}const s0={type:ot,json:{type:[Yr],default:null,read:{source:["color","transparency"],reader:r6e},write:{target:{color:{type:[Yr]},transparency:{type:Yr}},writer:s6e}}},Bm={type:Number,cast:mr,json:{write:!0}};let Cb=class extends Ie{constructor(e){super(e),this.color=new ot([0,0,0,1]),this.extensionLength=0,this.size=gd(1)}clone(){}cloneProperties(){return{color:ae(this.color),size:this.size,extensionLength:this.extensionLength}}};u([d({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Cb.prototype,"type",void 0),u([d(s0)],Cb.prototype,"color",void 0),u([d({...Bm,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],Cb.prototype,"extensionLength",void 0),u([d(Bm)],Cb.prototype,"size",void 0),Cb=u([I("esri.symbols.edges.Edges3D")],Cb);const CZ=Cb;var Y7;let gN=Y7=class extends CZ{constructor(t){super(t),this.type="sketch"}clone(){return new Y7(this.cloneProperties())}};u([At({sketch:"sketch"},{readOnly:!0})],gN.prototype,"type",void 0),gN=Y7=u([I("esri.symbols.edges.SketchEdges3D")],gN);const n6e=gN;var Z7;let yN=Z7=class extends CZ{constructor(t){super(t),this.type="solid"}clone(){return new Z7(this.cloneProperties())}};u([At({solid:"solid"},{readOnly:!0})],yN.prototype,"type",void 0),yN=Z7=u([I("esri.symbols.support.SolidEdges3D")],yN);const o6e=yN,kye={types:{key:"type",base:CZ,typeMap:{solid:o6e,sketch:n6e}},json:{write:!0}};var J7;let Yu=J7=class extends Ie{constructor(t){super(t),this.color=null}clone(){const t={color:v(this.color)?this.color.clone():null};return new J7(t)}};u([d(s0)],Yu.prototype,"color",void 0),Yu=J7=u([I("esri.symbols.support.Symbol3DMaterial")],Yu);var K7;let y_=K7=class extends Km{constructor(t){super(t),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new K7({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:v(this.material)?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};u([At({Extrude:"extrude"},{readOnly:!0})],y_.prototype,"type",void 0),u([d({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],y_.prototype,"size",void 0),u([d({type:Yu,json:{write:!0}})],y_.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],y_.prototype,"castShadows",void 0),u([d(kye)],y_.prototype,"edges",void 0),y_=K7=u([I("esri.symbols.ExtrudeSymbol3DLayer")],y_);const Bye=y_;let eR=class extends nu{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};u([At({esriSLS:"simple-line"},{readOnly:!0})],eR.prototype,"type",void 0),u([d({type:Number,cast:mr,json:{write:!0}})],eR.prototype,"width",void 0),eR=u([I("esri.symbols.LineSymbol")],eR);const a6e=eR,l6e=["begin","end","begin-end"],zye=["arrow","circle","square","diamond","cross","x"];var Q7;let Nf=Q7=class extends Ie{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,i,r){e[i]=(r==null?void 0:r.origin)==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return t&&t[0]!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,i,r){(r==null?void 0:r.origin)==="web-map"||(e[i]=t)}clone(){return new Q7({color:ae(this.color),placement:this.placement,style:this.style})}hash(){var t;return`${this.placement}.${(t=this.color)==null?void 0:t.hash()}.${this.style}`}};u([d({type:["begin","end","begin-end"],json:{write:!0}})],Nf.prototype,"placement",void 0),u([At({"line-marker":"line-marker"},{readOnly:!0}),d({json:{origins:{"web-map":{write:!1}}}})],Nf.prototype,"type",void 0),u([d({type:zye})],Nf.prototype,"style",void 0),u([lt("style")],Nf.prototype,"writeStyle",null),u([d({type:ot,value:null,json:{write:{allowNull:!0}}})],Nf.prototype,"color",null),u([Qe("color")],Nf.prototype,"readColor",null),u([lt("color")],Nf.prototype,"writeColor",null),Nf=Q7=u([I("esri.symbols.LineSymbolMarker")],Nf);const c6e=Nf;var eG;const MV=new Gi({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let Dg=eG=class extends a6e{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,i,r,s,n){if(t&&typeof t!="string")return t;const o={};return t!=null&&(o.style=t),e!=null&&(o.color=e),i!=null&&(o.width=mr(i)),r!=null&&(o.cap=r),s!=null&&(o.join=s),n!=null&&(o.miterLimit=mr(n)),o}clone(){var t;return new eG({color:ae(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(t=this.marker)==null?void 0:t.clone()})}hash(){var t,e;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(e=this.marker)==null?void 0:e.hash()}`}};u([At({esriSLS:"simple-line"},{readOnly:!0})],Dg.prototype,"type",void 0),u([d({type:MV.apiValues,json:{read:MV.read,write:MV.write}})],Dg.prototype,"style",void 0),u([d({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&(i==null||i.origin==null)})}}})],Dg.prototype,"cap",void 0),u([d({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&(i==null||i.origin==null)})}}})],Dg.prototype,"join",void 0),u([d({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":c6e}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],Dg.prototype,"marker",void 0),u([d({type:Number,json:{read:!1,write:!1}})],Dg.prototype,"miterLimit",void 0),Dg=eG=u([I("esri.symbols.SimpleLineSymbol")],Dg);const Ed=Dg;let tR=class extends nu{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Ed}},json:{default:null,write:!0}})],tR.prototype,"outline",void 0),u([d({type:["simple-fill","picture-fill"],readOnly:!0})],tR.prototype,"type",void 0),tR=u([I("esri.symbols.FillSymbol")],tR);const Gye=tR;let _N=class extends Ie{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],_N.prototype,"type",void 0),_N=u([I("esri.symbols.patterns.LinePattern3D")],_N);const jye=_N,u6e=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var tG;const h6e=Ua()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let iR=tG=class extends jye{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new tG(t)}};u([d({type:["style"]})],iR.prototype,"type",void 0),u([At(h6e),d({type:u6e})],iR.prototype,"style",void 0),iR=tG=u([I("esri.symbols.patterns.LineStylePattern3D")],iR);const AZ=iR;let vN=class extends Ie{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],vN.prototype,"type",void 0),vN=u([I("esri.symbols.patterns.Pattern3D")],vN);const Hye=vN,d6e=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var iG;let rR=iG=class extends Hye{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new iG(t)}};u([d({type:["style"]})],rR.prototype,"type",void 0),u([d({type:d6e,json:{read:!0,write:!0}})],rR.prototype,"style",void 0),rR=iG=u([I("esri.symbols.patterns.StylePattern3D")],rR);const qye=rR,p6e={types:{key:"type",base:Hye,typeMap:{style:qye}},json:{write:!0}},Wye={types:{key:"type",base:jye,typeMap:{style:AZ}},json:{write:!0}},RM=new ot("white");new ot("black");const f6e=new ot([255,255,255,0]);function m6e(t){return t.r===0&&t.g===0&&t.b===0}var rG;let MM=rG=class extends Yu{constructor(t){super(t),this.colorMixMode=null}clone(){const t={color:v(this.color)?this.color.clone():null,colorMixMode:this.colorMixMode};return new rG(t)}};u([At({multiply:"multiply",replace:"replace",tint:"tint"})],MM.prototype,"colorMixMode",void 0),MM=rG=u([I("esri.symbols.support.Symbol3DFillMaterial")],MM);function ci(t=v6e){return[t[0],t[1],t[2],t[3]]}function fMt(t){return[t[0],t[1],t[2],t[3]]}function jy(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function OZ(t,e,i,r,s=ci()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function Xye(t,e=ci()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function eU(t,e){return new Pi({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}function RZ(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function Lv(t,e,i){if(C(e))jy(i,t);else if("length"in e)aG(e)?(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[2]),i[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[0]),i[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":i[0]=Math.min(t[0],e.xmin),i[1]=Math.min(t[1],e.ymin),i[2]=Math.max(t[2],e.xmax),i[3]=Math.max(t[3],e.ymax);break;case"point":i[0]=Math.min(t[0],e.x),i[1]=Math.min(t[1],e.y),i[2]=Math.max(t[2],e.x),i[3]=Math.max(t[3],e.y)}}function PV(t,e,i=t){const r=e.length;let s=t[0],n=t[1],o=t[2],a=t[3];for(let l=0;l<r;l++){const c=e[l];s=Math.min(s,c[0]),n=Math.min(n,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return i[0]=s,i[1]=n,i[2]=o,i[3]=a,i}function sG(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function zu(t){return C(t)||t[0]>=t[2]?0:t[2]-t[0]}function Zp(t){return t[1]>=t[3]?0:t[3]-t[1]}function Yye(t){return zu(t)*Zp(t)}function MZ(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function Zye(t,e){return tU(t,e[0],e[1])}function Die(t,e){const i=e[3],r=.5*(t[0]+t[2]),s=Math.abs(e[0]-r),n=.5*(t[2]-t[0]);if(s>i+n)return!1;const o=.5*(t[1]+t[3]),a=.5*(t[3]-t[1]),l=Math.abs(e[1]-o);if(l>i+a)return!1;if(s<n||l<a)return!0;const c=s-n,h=l-a;return c*c+h*h<=i*i}function mMt(t,e,i){const r=t[0],s=t[1],n=t[2],o=t[3],{x:a,y:l}=e,{x:c,y:h}=i,p=(b,w)=>(h-l)*b+(a-c)*w+(c*l-a*h)<0,f=p(r,o),m=p(n,o),y=p(n,s),_=p(r,s);return!(f===m&&m===y&&y===_&&_===f||a<r&&c<r||a>n&&c>n||l>o&&h>o||l<s&&h<s)}function gMt(t,e){return tU(t,e.x,e.y)}function tU(t,e,i){return e>=t[0]&&i>=t[1]&&e<=t[2]&&i<=t[3]}function g6e(t,e,i){return e[0]>=t[0]-i&&e[1]>=t[1]-i&&e[0]<=t[2]+i&&e[1]<=t[3]+i}function iU(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function nG(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function oG(t,e,i){if(C(e))return jy(i,t);const r=e[0],s=e[1],n=e[2],o=e[3];return i[0]=we(t[0],r,n),i[1]=we(t[1],s,o),i[2]=we(t[2],r,n),i[3]=we(t[3],s,o),i}function y6e(t,e){const i=(t[0]+t[2])/2,r=(t[1]+t[3])/2,s=Math.max(Math.abs(e[0]-i)-zu(t)/2,0),n=Math.max(Math.abs(e[1]-r)-Zp(t)/2,0);return Math.sqrt(s*s+n*n)}function E4(t,e,i,r=t){return r[0]=t[0]+e,r[1]=t[1]+i,r[2]=t[2]+e,r[3]=t[3]+i,r}function yd(t){return t?jy(t,lG):ci(lG)}function aG(t){return t!=null&&t.length===4}function _6e(t){return!(zu(t)!==0&&isFinite(t[0])||Zp(t)!==0&&isFinite(t[1]))}function sx(t,e){return aG(t)&&aG(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const yMt=[-1/0,-1/0,1/0,1/0],lG=[1/0,1/0,-1/0,-1/0],v6e=[0,0,0,0];function Nn(t=t0e){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function Cx(t,e,i,r,s,n,o=Nn()){return o[0]=t,o[1]=e,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function _Mt(t,e){const i=isFinite(t[2])||isFinite(t[5]);return new Pi(i?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function rC(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function b6e(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function zm(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function Wu(t,e,i=0,r=e.length/3){let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];for(let h=0;h<r;h++)s=Math.min(s,e[i+3*h]),n=Math.min(n,e[i+3*h+1]),o=Math.min(o,e[i+3*h+2]),a=Math.max(a,e[i+3*h]),l=Math.max(l,e[i+3*h+1]),c=Math.max(c,e[i+3*h+2]);t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function IV(t,e,i){const r=e.length;let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];if(i)for(let h=0;h<r;h++){const p=e[h];s=Math.min(s,p[0]),n=Math.min(n,p[1]),o=Math.min(o,p[2]),a=Math.max(a,p[0]),l=Math.max(l,p[1]),c=Math.max(c,p[2])}else for(let h=0;h<r;h++){const p=e[h];s=Math.min(s,p[0]),n=Math.min(n,p[1]),a=Math.max(a,p[0]),l=Math.max(l,p[1])}t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function w6e(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function oT(t){return t[0]>=t[3]?0:t[3]-t[0]}function aT(t){return t[1]>=t[4]?0:t[4]-t[1]}function g1(t){return t[2]>=t[5]?0:t[5]-t[2]}function Jye(t){const e=oT(t),i=g1(t),r=aT(t);return Math.sqrt(e*e+i*i+r*r)}function Mp(t,e=[0,0,0]){return e[0]=t[0]+oT(t)/2,e[1]=t[1]+aT(t)/2,e[2]=t[2]+g1(t)/2,e}function o$(t,e=[0,0,0]){return e[0]=oT(t),e[1]=aT(t),e[2]=g1(t),e}function PZ(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function vMt(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function x6e(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function Pp(t,e){return!!C(e)||x6e(t,e)}function Kye(t,e,i,r,s=t){return s[0]=t[0]+e,s[1]=t[1]+i,s[2]=t[2]+r,s[3]=t[3]+e,s[4]=t[4]+i,s[5]=t[5]+r,s}function bMt(t,e,i=t){const r=t[0]+oT(t)/2,s=t[1]+aT(t)/2,n=t[2]+g1(t)/2;return i[0]=r+(t[0]-r)*e,i[1]=s+(t[1]-s)*e,i[2]=n+(t[2]-n)*e,i[3]=r+(t[3]-r)*e,i[4]=s+(t[4]-s)*e,i[5]=n+(t[5]-n)*e,i}function Qye(t,e,i=t){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i!==t&&(i[3]=t[3],i[4]=t[4],i[5]=t[5]),i}function e0e(t,e,i=t){return i[3]=e[0],i[4]=e[1],i[5]=e[2],i!==t&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),t}function rU(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function $r(t){return t?rU(t,Nie):Nn(Nie)}function IZ(t,e){return e||(e=ci()),e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function wMt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function T6e(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=Number.NEGATIVE_INFINITY,t[3]=r,t[4]=s,t[5]=Number.POSITIVE_INFINITY,t}function cG(t){return t.length===6}function $Z(t){return oT(t)===0&&aT(t)===0&&g1(t)===0}function xMt(t,e,i){if(C(t)||C(e))return t===e;if(!cG(t)||!cG(e))return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function S6e(t,e,i,r,s,n){return Cx(t,e,i,r,s,n,E6e)}const TMt=[-1/0,-1/0,-1/0,1/0,1/0,1/0],Nie=[1/0,1/0,1/0,-1/0,-1/0,-1/0],t0e=[0,0,0,0,0,0],E6e=Nn();function $V(t,{isPrimitive:e,width:i,depth:r,height:s}){const n=e?10:1;if(i==null&&s==null&&r==null)return[n*t[0],n*t[1],n*t[2]];const o=Xe(i,r,s);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/t[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=t[l]*a);return o}const C6e=Cx(-.5,-.5,-.5,.5,.5,.5),A6e=Cx(-.5,-.5,0,.5,.5,1),O6e=Cx(-.5,-.5,0,.5,.5,.5);function R6e(t){switch(t){case"sphere":case"cube":case"diamond":return C6e;case"cylinder":case"cone":case"inverted-cone":return A6e;case"tetrahedron":return O6e;default:return}}const LZ=["butt","square","round"],M6e=[...LZ,"none"],i0e=["miter","bevel","round"];var uG;let Ab=uG=class extends Ie{constructor(t){super(t),this.color=new ot([0,0,0,1]),this.size=gd(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:v(this.color)?this.color.clone():null,size:this.size,pattern:v(this.pattern)?this.pattern.clone():null,patternCap:this.patternCap};return new uG(t)}};u([d(s0)],Ab.prototype,"color",void 0),u([d(Bm)],Ab.prototype,"size",void 0),u([d(Wye)],Ab.prototype,"pattern",void 0),u([d({type:LZ,json:{default:"butt",write:{overridePolicy(){return{enabled:v(this.pattern)}}}}})],Ab.prototype,"patternCap",void 0),Ab=uG=u([I("esri.symbols.support.Symbol3DOutline")],Ab);var bN;let Ng=bN=class extends Km{constructor(t){super(t),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const t={edges:v(this.edges)?this.edges.clone():null,enabled:this.enabled,material:v(this.material)?this.material.clone():null,pattern:v(this.pattern)?this.pattern.clone():null,castShadows:this.castShadows,outline:v(this.outline)?this.outline.clone():null};return new bN(t)}static fromSimpleFillSymbol(t){var r,s,n;const e=t.outline&&t.outline.style&&t.outline.style!=="inside-frame"&&t.outline.style!=="solid"?new AZ({style:t.outline.style}):null,i={size:((r=t.outline)==null?void 0:r.width)??0,color:(((s=t.outline)==null?void 0:s.color)??RM).clone(),pattern:e};return e&&((n=t.outline)!=null&&n.cap)&&(i.patternCap=t.outline.cap),new bN({material:new MM({color:(t.color??f6e).clone()}),pattern:t.style&&t.style!=="solid"?new qye({style:t.style}):null,outline:i})}};u([At({Fill:"fill"},{readOnly:!0})],Ng.prototype,"type",void 0),u([d({type:MM,json:{write:!0}})],Ng.prototype,"material",void 0),u([d(p6e)],Ng.prototype,"pattern",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Ng.prototype,"castShadows",void 0),u([d({type:Ab,json:{write:!0}})],Ng.prototype,"outline",void 0),u([d(kye)],Ng.prototype,"edges",void 0),Ng=bN=u([I("esri.symbols.FillSymbol3DLayer")],Ng);const eI=Ng,P6e=["none","underline","line-through"],I6e=["normal","italic","oblique"],$6e=["normal","lighter","bold","bolder"],r0e={type:Number,cast:t=>{const e=Hh(t);return e===0?1:we(e,.1,4)},nonNullable:!0},L6e=["left","right","center"],D6e=["baseline","top","middle","bottom"],s0e={type:L6e,nonNullable:!0},n0e={type:D6e,nonNullable:!0};var hG;let Fg=hG=class extends Ie{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return mr(t)}clone(){return new hG({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};u([d({type:P6e,json:{default:"none",write:!0}})],Fg.prototype,"decoration",void 0),u([d({type:String,json:{write:!0}})],Fg.prototype,"family",void 0),u([d({type:Number,json:{write:{overridePolicy:(t,e,i)=>({enabled:!i||!i.textSymbol3D})}}})],Fg.prototype,"size",void 0),u([wi("size")],Fg.prototype,"castSize",null),u([d({type:I6e,json:{default:"normal",write:!0}})],Fg.prototype,"style",void 0),u([d({type:$6e,json:{default:"normal",write:!0}})],Fg.prototype,"weight",void 0),Fg=hG=u([I("esri.symbols.Font")],Fg);const sU=Fg,N6e=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,F6e={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function Fie(t){const e=t==null?void 0:t.match(N6e);if(!e)return null;const[,i,r,s]=e;if(!i)return null;let n=null,o=null,a=null;const{devext:l,qaext:c,www:h}=F6e;if(r)if(n=i,s)switch(s.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=h);else switch(i.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=h);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:n}}function U6e(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}const V6e=oe.getLogger("esri.core.urlUtils"),KC=ar.request,Uie="esri/config: esriConfig.request.proxyUrl is not set.",o0e=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,a0e=/^\s*http:/i,k6e=/^\s*https:/i,B6e=/^\s*file:/i,z6e=/:\d+$/,G6e=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,j6e=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),H6e=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");let yE=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let i=this.uri.match(j6e);this.scheme=i[2]||(i[1]?"":null),this.authority=i[4]||(i[3]?"":null),this.path=i[5],this.query=i[7]||(i[6]?"":null),this.fragment=i[9]||(i[8]?"":null),this.authority!=null&&(i=this.authority.match(H6e),this.user=i[3]||null,this.password=i[4]||null,this.host=i[6]||i[7],this.port=i[9]||null)}toString(){return this.uri}};const a$={},q6e=new yE(ar.applicationUrl);let ol=q6e;const W6e=X6e();let DZ=W6e;const NZ=()=>ol,EMt=()=>DZ;function X6e(){const t=ol.path,e=t.substring(0,t.lastIndexOf(t.split("/")[t.split("/").length-1]));return`${`${ol.scheme}://${ol.host}${ol.port!=null?`:${ol.port}`:""}`}${e}`}function vl(t){if(!t)return null;const e={path:null,query:null},i=new yE(t),r=t.indexOf("?");return i.query===null?e.path=t:(e.path=t.substring(0,r),e.query=l0e(i.query)),i.fragment&&(e.hash=i.fragment,i.query===null&&(e.path=e.path.substring(0,e.path.length-(i.fragment.length+1)))),e}function l0e(t){const e=t.split("&"),i={};for(const r of e){if(!r)continue;const s=r.indexOf("=");let n,o;s<0?(n=decodeURIComponent(r),o=""):(n=decodeURIComponent(r.slice(0,s)),o=decodeURIComponent(r.slice(s+1)));let a=i[n];typeof a=="string"&&(a=i[n]=[a]),Array.isArray(a)?a.push(o):i[n]=o}return i}function Vie(t){return t&&typeof t=="object"&&"toJSON"in t&&typeof t.toJSON=="function"}function k3(t,e){return t?e&&typeof e=="function"?Object.keys(t).map(i=>encodeURIComponent(i)+"="+encodeURIComponent(e(i,t[i]))).join("&"):Object.keys(t).map(i=>{const r=t[i];if(r==null)return"";const s=encodeURIComponent(i)+"=",n=e&&e[i];return n?s+encodeURIComponent(n(r)):Array.isArray(r)?r.map(o=>Vie(o)?s+encodeURIComponent(JSON.stringify(o)):s+encodeURIComponent(o)).join("&"):Vie(r)?s+encodeURIComponent(JSON.stringify(r)):s+encodeURIComponent(r)}).filter(i=>i).join("&"):""}function Y6e(t=!1){let e,i=KC.proxyUrl;if(typeof t=="string"){e=iUe(t);const r=nU(t);r&&(i=r.proxyUrl)}else e=!!t;if(!i)throw V6e.warn(Uie),new W("urlutils:proxy-not-set",Uie);return e&&dG()&&(i=zZ(i)),vl(i)}function CMt(t){const e=nU(t);let i,r;if(e){const s=FZ(e.proxyUrl);i=s.path,r=s.query?l0e(s.query):null}if(i){const s=vl(t);t=i+"?"+s.path;const n=k3({...r,...s.query});n&&(t=`${t}?${n}`)}return t}const UA={path:"",query:""};function FZ(t){const e=t.indexOf("?");return e!==-1?(UA.path=t.slice(0,e),UA.query=t.slice(e+1)):(UA.path=t,UA.query=null),UA}function c0e(t){return t=(t=A4(t=lUe(t=FZ(t).path),!0)).toLowerCase()}function Z6e(t){const e={proxyUrl:t.proxyUrl,urlPrefix:c0e(t.urlPrefix)},i=KC.proxyRules,r=e.urlPrefix;let s=i.length;for(let n=0;n<i.length;n++){const o=i[n].urlPrefix;if(r.indexOf(o)===0){if(r.length===o.length)return-1;s=n;break}o.indexOf(r)===0&&(s=n+1)}return i.splice(s,0,e),s}function nU(t){const e=KC.proxyRules,i=c0e(t);for(let r=0;r<e.length;r++)if(i.indexOf(e[r].urlPrefix)===0)return e[r]}function J6e(t,e){if(!t||!e)return!1;t=C4(t),e=C4(e);const i=Fie(t),r=Fie(e);return v(i)&&v(r)?i.portalHostname===r.portalHostname:!v(i)&&!v(r)&&sC(t,e,!0)}function u0e(t,e){return t=C4(t),e=C4(e),A4(t)===A4(e)}function C4(t){const e=(t=zp(t)).indexOf("/sharing");return e>0?t.substring(0,e):t.replace(/\/+$/,"")}function h0e(t){const e=r=>r==null||r instanceof RegExp&&r.test(t)||typeof r=="string"&&t.startsWith(r),i=KC.interceptors;if(i){for(const r of i)if(Array.isArray(r.urls)){if(r.urls.some(e))return r}else if(e(r.urls))return r}return null}function sC(t,e,i=!1){if(!t||!e)return!1;const r=fG(t),s=fG(e);return!(!i&&r.scheme!==s.scheme)&&r.host!=null&&s.host!=null&&r.host.toLowerCase()===s.host.toLowerCase()&&r.port===s.port}function UZ(t){if(typeof t=="string"){if(!Zu(t))return!0;t=fG(t)}if(sC(t,ol))return!0;const e=KC.trustedServers||[];for(let i=0;i<e.length;i++){const r=K6e(e[i]);for(let s=0;s<r.length;s++)if(sC(t,r[s]))return!0}return!1}function K6e(t){return a$[t]||(BZ(t)||Gm(t)?a$[t]=[new yE(Gu(t))]:a$[t]=[new yE(`http://${t}`),new yE(`https://${t}`)]),a$[t]}function Gu(t,e=DZ,i){return Gm(t)?i&&i.preserveProtocolRelative?t:ol.scheme==="http"&&ol.authority===Gp(t).slice(2)?`http:${t}`:`https:${t}`:BZ(t)?t:Ax(t[0]==="/"?oUe(e):e,t)}function VZ(t,e=DZ,i){if(t==null||!Zu(t))return t;const r=zp(t),s=r.toLowerCase(),n=zp(e).toLowerCase().replace(/\/+$/,""),o=i?zp(i).toLowerCase().replace(/\/+$/,""):null;if(o&&n.indexOf(o)!==0)return t;const a=(p,f,m)=>(m=p.indexOf(f,m))===-1?p.length:m;let l=a(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=a(s,"/",l+1);if(c===-1||o&&c<o.length)return t;t=r.slice(c);const h=n.slice(c-1).replace(/[^/]+/g,"").length;if(h>0)for(let p=0;p<h;p++)t=`../${t}`;else t=`./${t}`;return t}function zp(t){return t=hUe(t=uUe(t=cUe(t=Gu(t=t.trim()))))}function Ax(...t){const e=t.filter(v);if(!e||!e.length)return;const i=[];if(Zu(e[0])){const s=e[0],n=s.indexOf("//");n!==-1&&(i.push(s.slice(0,n+1)),sUe(e[0])&&(i[0]+="/"),e[0]=s.slice(n+2))}else e[0][0]==="/"&&i.push("");const r=e.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<r.length;s++){const n=r[s];n===".."&&i.length>0&&i[i.length-1]!==".."?i.pop():(!n&&s===r.length-1||n&&(n!=="."||i.length===0))&&i.push(n)}return i.join("/")}function Gp(t,e=!1){if(t==null||nC(t)||Qm(t))return null;let i=t.indexOf("://");if(i===-1&&Gm(t))i=2;else{if(i===-1)return null;i+=3}const r=t.indexOf("/",i);return r!==-1&&(t=t.slice(0,r)),e&&(t=A4(t,!0)),t}function Zu(t){return Gm(t)||BZ(t)}function nC(t){return t!=null&&t.slice(0,5)==="blob:"}function Qm(t){return t!=null&&t.slice(0,5)==="data:"}function kZ(t){const e=tI(t);if(!e||!e.isBase64)return null;const i=atob(e.data),r=new Uint8Array(i.length);for(let s=0;s<i.length;s++)r[s]=i.charCodeAt(s);return r.buffer}function AMt(t){return btoa(String.fromCharCode.apply(null,t)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const Q6e=/^data:(.*?)(;base64)?,(.*)$/;function tI(t){const e=t.match(Q6e);if(!e)return null;const[,i,r,s]=e;return{mediaType:i,isBase64:!!r,data:s}}function d0e(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}function OMt(t){const e=kZ(t);if(!e)return null;const i=tI(t);return new Blob([e],{type:i.mediaType})}function RMt(t,e){eUe(t,e)||tUe(t,e)}function eUe(t,e){if(!t)return!1;const i=document.createElement("a");if(!("download"in i))return!1;const r=URL.createObjectURL(t);return i.download=e,i.href=r,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r),!0}function tUe(t,e){return!!window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveOrOpenBlob(t,e)}function Gm(t){return t!=null&&t[0]==="/"&&t[1]==="/"}function BZ(t){return t!=null&&o0e.test(t)}function iUe(t){return t!=null&&k6e.test(t)||ol.scheme==="https"&&Gm(t)}function rUe(t){return t!=null&&a0e.test(t)||ol.scheme==="http"&&Gm(t)}function sUe(t){return t!=null&&B6e.test(t)}function zZ(t){return Gm(t)?`https:${t}`:t.replace(a0e,"https:")}function nUe(){return ol.scheme==="http"}function dG(){return ol.scheme==="https"}function A4(t,e=!1){return Gm(t)?t.slice(2):(t=t.replace(o0e,""),e&&t.length>1&&t[0]==="/"&&t[1]==="/"&&(t=t.slice(2)),t)}function oUe(t){const e=t.indexOf("//"),i=t.indexOf("/",e+2);return i===-1?t:t.slice(0,i)}function aUe(t){let e=0;if(Zu(t)){const r=t.indexOf("//");r!==-1&&(e=r+2)}const i=t.lastIndexOf("/");return i<e?t:t.slice(0,i+1)}function MMt(t,e){if(!t)return"";const i=vl(t).path.replace(/\/+$/,""),r=i.substring(i.lastIndexOf("/")+1);if(!(e!=null&&e.length))return r;const s=new RegExp(`.(${e.join("|")})$`,"ig");return r.replace(s,"")}function lUe(t){return t&&t[t.length-1]==="/"?t:`${t}/`}function p0e(t){return t.replace(/\/+$/,"")}function cUe(t){if(/^https?:\/\//i.test(t)){const e=FZ(t);t=(t=e.path.replace(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function uUe(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function hUe(t){const e=KC.httpsDomains;if(!rUe(t))return t;const i=t.indexOf("/",7);let r;if(r=i===-1?t:t.slice(0,i),r=r.toLowerCase().slice(7),z6e.test(r)){if(!r.endsWith(":80"))return t;r=r.slice(0,-3),t=t.replace(":80","")}return nUe()&&r===ol.authority&&!G6e.test(t)||(dG()&&r===ol.authority||e&&e.some(s=>r===s||r.endsWith(`.${s}`))||dG()&&!nU(t))&&(t=zZ(t)),t}function pG(t,e,i){if(!(e&&i&&t&&Zu(t)))return t;const r=t.indexOf("//"),s=t.indexOf("/",r+2),n=t.indexOf(":",r+2),o=Math.min(s<0?t.length:s,n<0?t.length:n);return t.slice(r+2,o).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,r+2)}${i}${t.slice(o)}`}function fG(t){return typeof t=="string"?new yE(Gu(t)):(t.scheme||(t.scheme=ol.scheme),t)}function f0e(t){return dUe.test(t)}function m0e(t,e){const i=vl(t),r=Object.keys(i.query||{});return r.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${r.join(", ")}.`),i.path}function g0e(t,e,i){const r=vl(t),s=r.query||{};return s[e]=String(i),`${r.path}?${k3(s)}`}function LV(t,e){const i=vl(t),r=i.query||{};for(const n in e)r[n]=e[n];const s=k3(r);return s?`${i.path}?${s}`:i.path}function PMt(t){if(C(t))return null;const e=t.match(y0e);return e?e[2]:null}function kie(t){if(C(t))return null;const e=t.match(y0e);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}const y0e=/([^.]*)\.([^\/]*)$/,dUe=/(^data:image\/svg|\.svg$)/i;function QC(t,e){const i=e&&e.url&&e.url.path;if(t&&i&&(t=Gu(t,i,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const r=VZ(t,e.portalItem.itemUrl);r!=null&&pUe.test(r)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(r).path)}return mG(t,e&&e.portal)}function Ox(t,e,i=B3.YES){if(t==null)return t;!Zu(t)&&e&&e.blockedRelativeUrls&&e.blockedRelativeUrls.push(t);let r=Gu(t);if(e){const s=e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.rootPath||e.url&&e.url.path;if(s){const n=mG(s,e.portal),o=mG(r,e.portal);r=VZ(o,n,n),r!=null&&r!==o&&r!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(r)}}return r=v0e(r,e==null?void 0:e.portal),Zu(r)&&(r=zp(r)),e!=null&&e.resources&&(e!=null&&e.portalItem)&&!Zu(r)&&!Qm(r)&&i===B3.YES&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(r),compress:!1}),r}function GZ(t,e,i){return QC(t,i)}function Zv(t,e,i,r){const s=Ox(t,r);s!==void 0&&(e[i]=s)}const _0e=/\/items\/([^\/]+)\/resources\/(.*)/,pUe=/^\.\/resources\//;function fUe(t){var e;return((e=(t==null?void 0:t.match(_0e))??null)==null?void 0:e[1])??null}function mUe(t){const e=(t==null?void 0:t.match(_0e))??null;if(e==null)return null;const i=e[2],r=i.lastIndexOf("/");if(r===-1){const{path:o,extension:a}=kie(i);return{prefix:null,filename:o,extension:a}}const{path:s,extension:n}=kie(i.slice(r+1));return{prefix:i.slice(0,r),filename:s,extension:n}}function v0e(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?pG(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function mG(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const i=`${e.urlKey}.${e.customBaseUrl}`,r=NZ();return sC(r,`${r.scheme}://${i}`)?pG(t,e.portalHostname,i):pG(t,i,e.portalHostname)}var B3;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})(B3||(B3={}));const IMt=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return B3},ensureMainOnlineDomain:v0e,fromJSON:QC,itemIdFromResourceUrl:fUe,prefixAndFilenameFromResourceUrl:mUe,read:GZ,toJSON:Ox,write:Zv},Symbol.toStringTag,{value:"Module"}));var gG;const gUe=Ua()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let Ob=gG=class extends Ie{constructor(t){super(t)}readHref(t,e,i){return t?QC(t,i):e.dataURI}writeHref(t,e,i,r){t&&(Qm(t)?e.dataURI=t:(e.href=Ox(t,r),Zu(e.href)&&(e.href=zp(e.href))))}clone(){return new gG({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],Ob.prototype,"href",void 0),u([Qe("href")],Ob.prototype,"readHref",null),u([lt("href",{href:{type:String},dataURI:{type:String}})],Ob.prototype,"writeHref",null),u([At(gUe)],Ob.prototype,"primitive",void 0),Ob=gG=u([I("esri.symbols.support.IconSymbol3DLayerResource")],Ob);const yUe="circle";var yG;let GS=yG=class extends $e{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new yG({x:this.x,y:this.y})}};u([d({type:Number})],GS.prototype,"x",void 0),u([d({type:Number})],GS.prototype,"y",void 0),GS=yG=u([I("esri.symbols.support.Symbol3DAnchorPosition2D")],GS);var _G;let sR=_G=class extends Ie{constructor(t){super(t),this.color=new ot([0,0,0,1]),this.size=gd(1)}clone(){const t={color:v(this.color)?this.color.clone():null,size:this.size};return new _G(t)}};u([d(s0)],sR.prototype,"color",void 0),u([d(Bm)],sR.prototype,"size",void 0),sR=_G=u([I("esri.symbols.support.Symbol3DIconOutline")],sR);var z2;const b0e="esri.symbols.IconSymbol3DLayer";let Ff=z2=class extends Km{constructor(t){super(t),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new z2({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:v(this.material)?this.material.clone():null,outline:v(this.outline)?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(t){const e=t.color||RM,i=Bie(t),r=t.outline&&t.outline.width>0?{size:t.outline.width,color:(t.outline.color||RM).clone()}:null;return new z2({size:t.size,resource:{primitive:vUe(t.style)},material:{color:e},outline:r,anchor:i?"relative":void 0,anchorPosition:i})}static fromPictureMarkerSymbol(t){const e=!t.color||m6e(t.color)?RM:t.color,i=Bie(t);return new z2({size:t.width<=t.height?t.height:t.width,resource:{href:t.url},material:{color:e.clone()},anchor:i?"relative":void 0,anchorPosition:i})}static fromCIMSymbol(t){return new z2({resource:{href:d0e({mediaType:"application/json",data:JSON.stringify(t.data)})}})}};function Bie(t){const e="width"in t?t.width:t.size,i="height"in t?t.height:t.size,r=zie(t.xoffset),s=zie(t.yoffset);return(r||s)&&e&&i?{x:-r/e,y:s/i}:null}function zie(t){return isFinite(t)?t:0}u([d({type:Yu,json:{write:!0}})],Ff.prototype,"material",void 0),u([d({type:Ob,json:{write:!0}})],Ff.prototype,"resource",void 0),u([At({Icon:"icon"},{readOnly:!0})],Ff.prototype,"type",void 0),u([d(Bm)],Ff.prototype,"size",void 0),u([At({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),d({json:{default:"center"}})],Ff.prototype,"anchor",void 0),u([d({type:GS,json:{type:[Number],read:{reader:t=>new GS({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Ff.prototype,"anchorPosition",void 0),u([d({type:sR,json:{write:!0}})],Ff.prototype,"outline",void 0),Ff=z2=u([I(b0e)],Ff);const _Ue={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function vUe(t){return _Ue[t]||(oe.getLogger(b0e).warn(`${t} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const gv=Ff;function Rx(t,e,i=Nt){return e||(e=new i),e===t||(e.removeAll(),bUe(t)?e.addMany(t):t&&e.add(t)),e}function w0e(t){return t}function bUe(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}const x0e="20230301",T0e="2657e728c1857e6d94c324181c0788310bb0958a",S0e="4.26",wUe={async request(t,e){var a,l;const{default:i}=await ee(()=>Promise.resolve().then(()=>FUe),void 0,import.meta.url),r=t.options,s=r.responseType;r.signal=e==null?void 0:e.signal,r.responseType=s==="native"||s==="native-request-init"?"native-request-init":s&&["blob","json","text"].includes(s)&&((a=h0e(t.url))!=null&&a.after)?s:"array-buffer";const n=await i(t.url,r),o={data:n.data,httpStatus:n.httpStatus,ssl:n.ssl};switch((l=n.requestOptions)==null?void 0:l.responseType){case"native-request-init":return delete o.data.signal,o;case"blob":o.data=await o.data.arrayBuffer();break;case"json":o.data=new TextEncoder().encode(JSON.stringify(o.data)).buffer;break;case"text":o.data=new TextEncoder().encode(o.data).buffer}return{result:o,transferList:[o.data]}}};let Cr;function $Mt(t){Cr=t}function LMt(t){const e=Cr&&Cr.findCredential(t);return e&&e.token?g0e(t,"token",e.token):t}de("host-webworker");const xUe=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function E0e(t){const e=Gp(t,!0);return!!e&&e.endsWith(".arcgis.com")&&!xUe.includes(e)&&!t.endsWith("/sharing/rest/generateToken")}function C0e(t,e,i=!1,r){return new Promise((s,n)=>{if(qn(r))return void n(Gie());let o=()=>{c(),n(new Error(`Unable to load ${e}`))},a=()=>{const h=t;c(),s(h)},l=()=>{if(!t)return;const h=t;c(),h.src="",n(Gie())};const c=()=>{de("esri-image-decode")||(t.removeEventListener("error",o),t.removeEventListener("load",a)),o=null,a=null,t=null,v(r)&&r.removeEventListener("abort",l),l=null,i&&URL.revokeObjectURL(e)};v(r)&&r.addEventListener("abort",l),de("esri-image-decode")?t.decode().then(a,o):(t.addEventListener("error",o),t.addEventListener("load",a))})}function Gie(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}function TUe(t){ar.request.crossOriginNoCorsDomains||(ar.request.crossOriginNoCorsDomains={});const e=ar.request.crossOriginNoCorsDomains;for(let i of t)i=i.toLowerCase(),/^https?:\/\//.test(i)?e[Gp(i)??""]=0:(e[Gp("http://"+i)??""]=0,e[Gp("https://"+i)??""]=0)}function SUe(t){const e=ar.request.crossOriginNoCorsDomains;if(e){let i=Gp(t);if(i)return i=i.toLowerCase(),!sC(i,NZ())&&e[i]<Date.now()-36e5}return!1}async function EUe(t){var s;const e=ar.request.crossOriginNoCorsDomains,i=Gp(t);e&&i&&(e[i.toLowerCase()]=Date.now());const r=vl(t);t=r.path,((s=r.query)==null?void 0:s.f)==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}}async function zr(t,e){var c;const i=Qm(t),r=nC(t);r||i||(t=zp(t));const s={url:t,requestOptions:{...e}};let n=h0e(t);if(n){const h=await $Ue(n,s);if(h!=null)return{data:h,getHeader:jZ,httpStatus:200,requestOptions:s.requestOptions,url:s.url};n.after||n.error||(n=null)}if(t=s.url,(e=s.requestOptions).responseType==="image"){if(de("host-webworker")||de("host-node"))throw Ip("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s)}else if(i)throw Ip("request:invalid-parameters",new Error("Data URLs are not supported for responseType = "+e.responseType),s);if(e.method==="head"){if(e.body)throw Ip("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(i||r)throw Ip("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await MUe(),O4)return O4.execute(t,e);const o=new AbortController;ca(e,()=>o.abort());const a={controller:o,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:n,params:s,redoRequest:!1,useIdentity:gp.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await DUe(a);return(c=n==null?void 0:n.after)==null||c.call(n,l),l}let O4;const gp=ar.request,A0e="FormData"in globalThis,CUe=[499,498,403,401],AUe=["COM_0056","COM_0057","SB_0008"],OUe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],jZ=()=>null,R4=Symbol();function RUe(t){const e=Gp(t);e&&!zr._corsServers.includes(e)&&zr._corsServers.push(e)}function jie(t){const e=Gp(t);return!e||e.endsWith(".arcgis.com")||zr._corsServers.includes(e)||UZ(e)}function Ip(t,e,i,r){let s="Error";const n={url:i.url,requestOptions:i.requestOptions,getHeader:jZ,ssl:!1};if(e instanceof W)return e.details?(e.details=ae(e.details),e.details.url=i.url,e.details.requestOptions=i.requestOptions):e.details=n,e;if(e){const o=r&&(c=>r.headers.get(c)),a=r&&r.status,l=e.message;l&&(s=l),o&&(n.getHeader=o),n.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||a||0,n.subCode=e.subcode,n.messageCode=e.messageCode,typeof e.details=="string"?n.messages=[e.details]:n.messages=e.details,n.raw=R4 in e?e[R4]:e}return ln(e)?Bi():new W(t,s,n)}async function MUe(){de("host-webworker")?O4||(O4=await ee(()=>import("./request-85ab49f7.js"),[],import.meta.url)):zr._abortableFetch||(zr._abortableFetch=globalThis.fetch.bind(globalThis))}async function vG(){Cr||await ee(()=>import("./IdentityManager-6159d8bd.js"),[],import.meta.url)}async function PUe(t){var a;const e=t.params.url,i=t.params.requestOptions,r=t.controller.signal,s=i.body;let n=null,o=null;if(A0e&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(n=new FormData(s))),typeof s=="string"&&(o=s),t.fetchOptions={cache:i.cacheBust&&!zr._abortableFetch.polyfill?"no-cache":"default",credentials:"same-origin",headers:i.headers||{},method:i.method==="head"?"HEAD":"GET",mode:"cors",priority:gp.priority,redirect:"follow",signal:r},(n||o)&&(t.fetchOptions.body=n||o),i.authMode==="anonymous"&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||(a=i.query)!=null&&a.token||n!=null&&n.get("token")),!t.hasToken&&ar.apiKey&&E0e(e)&&(i.query||(i.query={}),i.query.token=ar.apiKey,t.hasToken=!0),t.useIdentity&&!t.hasToken&&!t.credentialToken&&!O0e(e)&&!qn(r)){let l;i.authMode==="immediate"?(await vG(),l=await Cr.getCredential(e,{signal:r}),t.credential=l):i.authMode==="no-prompt"?(await vG(),l=await Cr.getCredential(e,{prompt:!1,signal:r}).catch(()=>{}),t.credential=l):Cr&&(l=Cr.findCredential(e)),l&&(t.credentialToken=l.token,t.useSSL=!!l.ssl)}}function O0e(t){return OUe.some(e=>e.test(t))}async function IUe(t){let e=t.params.url;const i=t.params.requestOptions,r=t.fetchOptions??{},s=nC(e)||Qm(e),n=i.responseType||"json",o=s?0:i.timeout!=null?i.timeout:gp.timeout;let a=!1;if(!s){t.useSSL&&(e=zZ(e)),i.cacheBust&&r.cache==="default"&&(e=g0e(e,"request.preventCache",Date.now()));let f={...i.query};t.credentialToken&&(f.token=t.credentialToken);let m=k3(f);de("esri-url-encodes-apostrophe")&&(m=m.replace(/'/g,"%27"));const y=e.length+1+m.length;let _;a=i.method==="delete"||i.method==="post"||i.method==="put"||!!i.body||y>gp.maxUrlLength;const b=i.useProxy||!!nU(e);if(b){const w=Y6e(e);_=w.path,!a&&_.length+1+y>gp.maxUrlLength&&(a=!0),w.query&&(f={...w.query,...f})}if(r.method==="HEAD"&&(a||b)){if(a)throw y>gp.maxUrlLength?Ip("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):Ip("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if(b)throw Ip("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}if(a?(r.method=i.method==="delete"?"DELETE":i.method==="put"?"PUT":"POST",i.body?e=LV(e,f):(r.body=k3(f),r.headers||(r.headers={}),r.headers["Content-Type"]="application/x-www-form-urlencoded")):e=LV(e,f),b&&(t.useProxy=!0,e=`${_}?${e}`),f.token&&A0e&&r.body instanceof FormData&&!U6e(e)&&r.body.set("token",f.token),i.hasOwnProperty("withCredentials"))t.withCredentials=i.withCredentials;else if(!sC(e,NZ())){if(UZ(e))t.withCredentials=!0;else if(Cr){const w=Cr.findServerInfo(e);w&&w.webTierAuth&&(t.withCredentials=!0)}}t.withCredentials&&(r.credentials="include",SUe(e)&&await EUe(a?LV(e,f):e))}let l,c,h=0,p=!1;o>0&&(h=setTimeout(()=>{p=!0,t.controller.abort()},o));try{if(i.responseType==="native-request-init")c=r,c.url=e;else if(i.responseType!=="image"||r.cache!=="default"||r.method!=="GET"||a||LUe(i.headers)||!s&&!t.useProxy&&gp.proxyUrl&&!jie(e)){if(l=await zr._abortableFetch(e,r),t.useProxy||RUe(e),i.responseType==="native")c=l;else if(r.method!=="HEAD")if(l.ok){switch(n){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(h&&(clearTimeout(h),h=0),n==="json"||n==="xml"||n==="document")if(c)switch(n){case"json":c=JSON.parse(c);break;case"xml":c=Hie(c,"application/xml");break;case"document":c=Hie(c,"text/html")}else c=null;if(c){if(n==="array-buffer"||n==="blob"){const f=l.headers.get("Content-Type");if(f&&/application\/json|text\/plain/i.test(f)&&c[n==="blob"?"size":"byteLength"]<=750)try{const m=await new Response(c).json();m.error&&(c=m)}catch{}}n==="image"&&c instanceof Blob&&(c=await qie(URL.createObjectURL(c),t,!0))}}else c=await l.text()}else c=await qie(e,t)}catch(f){if(f.name==="AbortError")throw p?new Error("Timeout exceeded"):Bi("Request canceled");if(!(!l&&f instanceof TypeError&&gp.proxyUrl)||i.body||i.method==="delete"||i.method==="head"||i.method==="post"||i.method==="put"||t.useProxy||jie(e))throw f;t.redoRequest=!0,Z6e({proxyUrl:gp.proxyUrl,urlPrefix:Gp(e)??""})}finally{h&&clearTimeout(h)}return[l,c]}async function $Ue(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let i,r;try{r=await t.before(e)}catch(s){i=Ip("request:interceptor",s,e)}if((r instanceof Error||r instanceof W)&&(i=Ip("request:interceptor",r,e)),i)throw t.error&&t.error(i),i;return r}}function LUe(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function Hie(t,e){let i;try{i=new DOMParser().parseFromString(t,e)}catch{}if(!i||i.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return i}async function DUe(t){var n;let e,i;await PUe(t);try{do[e,i]=await IUe(t);while(!await NUe(t,e,i))}catch(o){const a=Ip("request:server",o,t.params,e);throw a.details.ssl=t.useSSL,t.interceptor&&t.interceptor.error&&t.interceptor.error(a),a}const r=t.params.url;if(i&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(r)){if(!t.hasToken&&!t.credentialToken&&((n=i.user)!=null&&n.username)&&!UZ(r)){const o=Gp(r,!0);o&&gp.trustedServers.push(o)}Array.isArray(i.authorizedCrossOriginNoCorsDomains)&&TUe(i.authorizedCrossOriginNoCorsDomains)}const s=t.credential;if(s&&Cr){const o=Cr.findServerInfo(s.server);let a=o&&o.owningSystemUrl;if(a){a=a.replace(/\/?$/,"/sharing");const l=Cr.findCredential(a,s.userId);l&&Cr._getIdenticalSvcIdx(a,l)===-1&&l.resources.unshift(a)}}return{data:i,getHeader:e?o=>e==null?void 0:e.headers.get(o):jZ,httpStatus:(e==null?void 0:e.status)??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function NUe(t,e,i){if(t.redoRequest)return t.redoRequest=!1,!1;const r=t.params.requestOptions;if(!e||r.responseType==="native"||r.responseType==="native-request-init")return!0;let s,n;if(!e.ok)throw s=new Error(`Unable to load ${e.url} status: ${e.status}`),s[R4]=i,s;i&&(i.error?s=i.error:i.status==="error"&&Array.isArray(i.messages)&&(s={...i},s[R4]=i,s.details=i.messages));let o,a=null;s&&(n=Number(s.code),a=s.hasOwnProperty("subcode")?Number(s.subcode):null,o=s.messageCode,o=o&&o.toUpperCase());const l=r.authMode;if(n===403&&(a===4||s.message&&s.message.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(l!=="no-prompt"||n===498)&&n!==void 0&&CUe.includes(n)&&!O0e(t.params.url)&&(n!==403||o&&!AUe.includes(o)&&(a==null||a===2&&t.credentialToken))){await vG();try{const c=await Cr.getCredential(t.params.url,{error:Ip("request:server",s,t.params),prompt:l!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=c,t.credentialToken=c.token,t.useSSL=t.useSSL||c.ssl,!1}catch(c){if(l==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;s=c}}if(s)throw s;return!0}function qie(t,e,i=!1){const r=e.controller.signal,s=new Image;return e.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=gp.priority,s.src=t,C0e(s,t,i,r)}zr._abortableFetch=null,zr._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];const FUe=Object.freeze(Object.defineProperty({__proto__:null,default:zr},Symbol.toStringTag,{value:"Module"}));var W_;(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})(W_||(W_={}));let UUe=class{constructor(e){this.instance=e,this._resolver=ky(),this._status=W_.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=W_.RESOLVED,this._cleanUp()},()=>{this._status=W_.REJECTED,this._cleanUp()})}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===W_.RESOLVED}isRejected(){return this._status===W_.REJECTED}isFulfilled(){return this._status!==W_.PENDING}abort(){this._resolver.reject(Bi())}when(e,i){return this._resolver.promise.then(e,i)}_cleanUp(){this._allPromise=this._resolvingPromises=this._allPromise=null}_tryResolve(){if(this.isFulfilled())return;const e=ky(),i=[...this._resolvingPromises,e.promise],r=this._allPromise=Promise.all(i);r.then(()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve(this.instance)},s=>{this.isFulfilled()||this._allPromise!==r||ln(s)||this._resolver.reject(s)}),e.resolve()}};const oU=t=>{let e=class extends t{constructor(...i){super(...i),this._promiseProps=new UUe(this),this.addResolvingPromise(Promise.resolve())}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(i,r){return new Promise((s,n)=>{this._promiseProps.when(s,n)}).then(i,r)}catch(i){return this.when(null,i)}addResolvingPromise(i){i&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in i?i.when():i)}};return e=u([I("esri.core.Promise")],e),e};let M4=class extends oU($e){};M4=u([I("esri.core.Promise")],M4);const VUe="not-loaded",kUe="loading",BUe="failed",Wie="loaded",R0e=t=>{let e=class extends t{constructor(...i){super(...i),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(r=>{const s=this.load.bind(this);this.load=n=>{const o=new Promise((a,l)=>{const c=F6(n,l);this.destroyed&&l(new W("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this._promiseProps.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===VUe){this._set("loadStatus",kUe);const a=this._loadController=new AbortController;s({signal:a.signal}),ca(a.signal,()=>{this._promiseProps.abort()})}return r(),o}})),this.when(()=>{this._set("loadStatus",Wie),this._loadController=null},r=>{this._set("loadStatus",BUe),this._set("loadError",r),this._loadController=null})}get loaded(){return this.loadStatus===Wie}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var i;return this.isFulfilled()||(this._set("loadError",new W("load:cancelled","Cancelled")),(i=this._loadController)==null||i.abort()),this}};return u([d({readOnly:!0})],e.prototype,"loaded",null),u([d({readOnly:!0})],e.prototype,"loadError",void 0),u([d({clonable:!1})],e.prototype,"loadStatus",void 0),u([d({type:[dd],readOnly:!0})],e.prototype,"loadWarnings",null),e=u([I("esri.core.Loadable")],e),e};let nR=class extends R0e(M4){};nR=u([I("esri.core.Loadable")],nR),function(t){function e(i){return!(!i||!i.load)}t.LoadableMixin=R0e,t.isLoadable=e}(nR||(nR={}));const Hy=nR;var bG;const zUe=new Gi({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let Sh=bG=class extends $e{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new bG({categories:this.categories?ae(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let i=[];this.categories&&(i=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let r="";if(this.extent){const o=sT(this.extent,mt.WGS84);v(o)&&(r=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let s=this.query;!this.disableExtraQuery&&t.extraQuery&&(s="("+s+")"+t.extraQuery);const n={categories:i,bbox:r,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(o=>zUe.toJSON(o.trim())).join(","),n.sortOrder=this.sortOrder),{query:{...e,...n}}}};u([d()],Sh.prototype,"categories",void 0),u([d()],Sh.prototype,"disableExtraQuery",void 0),u([d({type:Pi})],Sh.prototype,"extent",void 0),u([d()],Sh.prototype,"filter",void 0),u([d()],Sh.prototype,"num",void 0),u([d()],Sh.prototype,"query",void 0),u([d()],Sh.prototype,"sortField",void 0),u([d()],Sh.prototype,"sortOrder",null),u([d()],Sh.prototype,"start",void 0),Sh=bG=u([I("esri.portal.PortalQueryParams")],Sh);const my=Sh;let Rb=class extends $e{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};u([d()],Rb.prototype,"nextQueryParams",void 0),u([d()],Rb.prototype,"queryParams",void 0),u([d()],Rb.prototype,"results",void 0),u([d()],Rb.prototype,"total",void 0),Rb=u([I("esri.portal.PortalQueryResult")],Rb);const GUe=Rb;let Ug=class extends Ie{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new W("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};u([d({type:Date})],Ug.prototype,"created",void 0),u([d()],Ug.prototype,"id",void 0),u([d()],Ug.prototype,"portal",void 0),u([d()],Ug.prototype,"title",void 0),u([d({readOnly:!0})],Ug.prototype,"url",null),u([d()],Ug.prototype,"username",void 0),Ug=u([I("esri.portal.PortalFolder")],Ug);const jUe=Ug;let Co=class extends Ie{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){var r;const e=this.url,i=this.thumbnail;return e&&i&&this.portal?(r=this.portal)==null?void 0:r.normalizeUrl(`${e}/info/${i}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return Jl(this.portal).request(this.url+"/categorySchema",e).then(i=>{const r=i.categorySchema||[];return r.some(s=>s.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",e):r})}fetchMembers(e){return Jl(this.portal).request(this.url+"/users",e)}getThumbnailUrl(e){let i=this.thumbnailUrl;return i&&e&&(i+=`&w=${e}`),i}toJSON(){throw new W("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,i){let r=mn(my,e);const s=Jl(this.portal);return parseFloat(s.currentVersion)>5?(r=r||new my,s.queryPortal(`/content/groups/${this.id}/search`,r,"PortalItem",i)):(r=r?r.clone():new my,r.query="group:"+this.id+(r.query?" "+r.query:""),s.queryItems(r,i))}_fetchCategorySchemaSet(e,i){const r=Jl(this.portal);return r.fetchSelf(r.authMode,!0,i).then(s=>{const n=s.contentCategorySetsGroupQuery;if(n){const o=new my;return o.disableExtraQuery=!0,o.num=1,o.query=n,r.queryGroups(o,i)}throw new W("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(s=>{if(s.total){const n=s.results[0],o=new my;return o.num=1,o.query=`typekeywords:"${e}"`,n.queryItems(o,i)}throw new W("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(s=>s.total?s.results[0].fetchData("json",i).then(n=>{const o=n&&n.categorySchema;return o&&o.length?o:[]}):[])}};u([d()],Co.prototype,"access",void 0),u([d({type:Date})],Co.prototype,"created",void 0),u([d()],Co.prototype,"description",void 0),u([d()],Co.prototype,"id",void 0),u([d()],Co.prototype,"isInvitationOnly",void 0),u([d({type:Date})],Co.prototype,"modified",void 0),u([d()],Co.prototype,"owner",void 0),u([d()],Co.prototype,"portal",void 0),u([d()],Co.prototype,"snippet",void 0),u([d()],Co.prototype,"sortField",void 0),u([d()],Co.prototype,"sortOrder",void 0),u([d()],Co.prototype,"tags",void 0),u([d()],Co.prototype,"thumbnail",void 0),u([d({readOnly:!0})],Co.prototype,"thumbnailUrl",null),u([d()],Co.prototype,"title",void 0),u([d({readOnly:!0})],Co.prototype,"url",null),Co=u([I("esri.portal.PortalGroup")],Co);const wG=Co,HUe=Object.freeze(Object.defineProperty({__proto__:null,default:wG},Symbol.toStringTag,{value:"Module"}));var xG;let Is=xG=class extends Ie{constructor(...t){super(...t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){const t=this.get("portal.restUrl");return t?`${t}/content/users/${this.username}`:null}get url(){const t=this.get("portal.restUrl");return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,i=t&&t.data,r=t&&t.folder,s={method:"post"};e&&(s.query=e.createPostQuery(),i!=null&&(typeof i=="string"?s.query.text=i:typeof i=="object"&&(s.query.text=JSON.stringify(i))));let n=this.userContentUrl;return r&&(n+="/"+(typeof r=="string"?r:r.id)),this.portal.request(n+"/addItem",s).then(o=>(e.id=o.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}deleteItem(t){let e=this.userContentUrl;return t.ownerFolder&&(e+="/"+t.ownerFolder),this.portal.request(e+`/items/${t.id}/delete`,{method:"post"}).then(()=>{t.id=null,t.portal=null})}deleteItems(t){const e=this.userContentUrl+"/deleteItems",i=t.map(r=>r.id);if(i.length){const r={method:"post",query:{items:i.join(",")}};return this.portal.request(e,r).then(()=>{t.forEach(s=>{s.id=null,s.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let i;return i=e&&e.folders?e.folders.map(r=>{const s=jUe.fromJSON(r);return s.portal=this.portal,s}):[],i})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(i=>{const r=wG.fromJSON(i);return r.portal=this.portal,r}):[],e})}fetchItems(t){const e=t??{};let i,r=this.userContentUrl??"";return e.folder&&(r+="/"+e.folder.id),ee(()=>Promise.resolve().then(()=>Kxe),void 0,import.meta.url).then(({default:s})=>{i=s;const n={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal.request(r,{query:n})}).then(s=>{let n;return s&&s.items?(n=s.items.map(o=>{const a=i.fromJSON(o);return a.portal=this.portal,a}),Promise.all(n.map(o=>o.load())).catch(o=>o).then(()=>({items:n,nextStart:s.nextStart,total:s.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new wG({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new W("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new W("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new xG;return e.sourceJSON=t,e.read(t),e}};u([d()],Is.prototype,"access",void 0),u([d({type:Date})],Is.prototype,"created",void 0),u([d()],Is.prototype,"culture",void 0),u([d()],Is.prototype,"description",void 0),u([d()],Is.prototype,"email",void 0),u([d()],Is.prototype,"favGroupId",void 0),u([d()],Is.prototype,"fullName",void 0),u([d({type:Date})],Is.prototype,"modified",void 0),u([d()],Is.prototype,"orgId",void 0),u([d()],Is.prototype,"portal",void 0),u([d()],Is.prototype,"preferredView",void 0),u([d()],Is.prototype,"privileges",void 0),u([d()],Is.prototype,"region",void 0),u([d()],Is.prototype,"role",void 0),u([d()],Is.prototype,"roleId",void 0),u([d()],Is.prototype,"sourceJSON",void 0),u([d()],Is.prototype,"thumbnail",void 0),u([d({readOnly:!0})],Is.prototype,"thumbnailUrl",null),u([d()],Is.prototype,"units",void 0),u([d({readOnly:!0})],Is.prototype,"userContentUrl",null),u([d({readOnly:!0})],Is.prototype,"url",null),u([d()],Is.prototype,"username",void 0),u([d()],Is.prototype,"userType",void 0),Is=xG=u([I("esri.portal.PortalUser")],Is);const HZ=Is,qUe=Object.freeze(Object.defineProperty({__proto__:null,default:HZ},Symbol.toStringTag,{value:"Module"}));var vu;let DV;const Xie={PortalGroup:()=>ee(()=>Promise.resolve().then(()=>HUe),void 0,import.meta.url),PortalItem:()=>ee(()=>Promise.resolve().then(()=>Kxe),void 0,import.meta.url),PortalUser:()=>ee(()=>Promise.resolve().then(()=>qUe),void 0,import.meta.url)};let nt=vu=class extends YP(Hy){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=ar.portalUrl,this.urlKey=null,this.user=null,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){this._esriIdCredentialCreateHandle=Rr(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const e of t)ar.request.trustedServers.includes(e)||ar.request.trustedServers.push(e);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){const t=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!t?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const e=t.indexOf("/sharing");t=e>0?t.substring(0,e):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,e=this.thumbnail;return t&&e?this._normalizeSSL(t+"/portals/self/resources/"+e):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let e=null;return t&&(e=HZ.fromJSON(t),e.portal=this),e}load(t){const e=ee(()=>Promise.resolve().then(()=>kQe),void 0,import.meta.url).then(({default:i})=>{gi(t),DV=i}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(i=>{if(Cr){const r=Cr;this.credential=r.findCredential(this.restUrl),this.credential||this.authMode!==vu.AUTH_MODE_AUTO||(this._esriIdCredentialCreateHandle=r.on("credential-create",()=>{r.findCredential(this.restUrl)&&this.signIn().catch(()=>{})}))}this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(e),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),e=(await ee(()=>import("./ElevationLayer-30257950.js"),["./ElevationLayer-30257950.js","./ArcGISCachedService-70f1031e.js","./TilemapCache-a4070bd3.js"],import.meta.url)).default;return t?t.map(i=>new e({id:i.id,url:i.url})):[]}fetchBasemaps(t,e){const i=new my;return i.query=t||(ar.apiKey&&E0e(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),i.disableExtraQuery=!0,this.queryGroups(i,e).then(r=>{if(i.num=100,i.query='type:"Web Map" -type:"Web Application"',r.total){const s=r.results[0];return i.sortField=s.sortField||"name",i.sortOrder=s.sortOrder||"desc",s.queryItems(i,e)}return null}).then(r=>{let s;return s=r&&r.total?r.results.filter(n=>n.type==="Web Map").map(n=>new DV({portalItem:n})):[],s})}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(e=>e.categorySchema):qn(t)?Promise.reject(Bi()):Promise.resolve([])}fetchFeaturedGroups(t){const e=this.featuredGroups,i=new my;if(i.num=100,i.sortField="title",e&&e.length){const r=[];for(const s of e)r.push(`(title:"${s.title}" AND owner:${s.owner})`);return i.query=r.join(" OR "),this.queryGroups(i,t).then(s=>s.results)}return qn(t)?Promise.reject(Bi()):Promise.resolve([])}fetchRegions(t){var i;const e=((i=this.user)==null?void 0:i.culture)||this.culture||od();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:e}})}fetchSettings(t){var i;const e=((i=this.user)==null?void 0:i.culture)||this.culture||od();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:e}})}static getDefault(){return vu._default&&!vu._default.destroyed||(vu._default=new vu),vu._default}queryGroups(t,e){return this.queryPortal("/community/groups",t,"PortalGroup",e)}queryItems(t,e){return this.queryPortal("/search",t,"PortalItem",e)}queryUsers(t,e){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",e)}fetchSelf(t=this.authMode,e=!1,i){const r=this.restUrl+"/portals/self",s={authMode:t,query:{culture:od().toLowerCase()},...i};return s.authMode==="auto"&&(s.authMode="no-prompt"),e&&(s.query.default=!0),this.request(r,s)}queryPortal(t,e,i,r){const s=mn(my,e),n=o=>this.request(this.restUrl+t,{...s.toRequestOptions(this),...r}).then(a=>{const l=s.clone();return l.start=a.nextStart,new GUe({nextQueryParams:l,queryParams:s,total:a.total,results:vu._resultsToTypedArray(o,{portal:this},a,r)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(zc(l),a)));return i&&Xie[i]?Xie[i]().then(({default:o})=>(gi(r),n(o))):n()}signIn(){if(this.authMode===vu.AUTH_MODE_ANONYMOUS)return Promise.reject(new W("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=e=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(e||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(i=>{i&&(this.sourceJSON=i,this.read(i))});return Cr?Cr.getCredential(this.restUrl).then(e=>t(e)):t(this.credential)}normalizeUrl(t){const e=this.credential&&this.credential.token;return this._normalizeSSL(e?t+(t.includes("?")?"&":"?")+"token="+e:t)}requestToTypedArray(t,e,i){return this.request(t,e).then(r=>{const s=vu._resultsToTypedArray(i,{portal:this},r);return Promise.all(s.map(n=>typeof n.when=="function"?n.when():r)).then(()=>s,()=>s)})}request(t,e={}){const i={f:"json",...e.query},{authMode:r=this.authMode===vu.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:s=null,cacheBust:n=!1,method:o="auto",responseType:a="json",signal:l}=e,c={authMode:r,body:s,cacheBust:n,method:o,query:i,responseType:a,timeout:0,signal:l};return zr(this._normalizeSSL(t),c).then(h=>h.data)}toJSON(){throw new W("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new vu({sourceJSON:t})}_getHelperService(t){const e=this.helperServices&&this.helperServices[t];if(!e)throw new W("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return e}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const e=DV.fromJSON(t);return e.portalItem={portal:this},e}return null}static _resultsToTypedArray(t,e,i,r){let s=[];if(i){const n=v(r)?r.signal:null;s=i.listings||i.notifications||i.userInvitations||i.tags||i.items||i.groups||i.comments||i.provisions||i.results||i.relatedItems||i,(t||e)&&(s=s.map(o=>{const a=Object.assign(t?t.fromJSON(o):o,e);return typeof a.load=="function"&&a.load(n),a}))}else s=[];return s}};nt.AUTH_MODE_ANONYMOUS="anonymous",nt.AUTH_MODE_AUTO="auto",nt.AUTH_MODE_IMMEDIATE="immediate",u([d()],nt.prototype,"access",void 0),u([d()],nt.prototype,"allSSL",void 0),u([d()],nt.prototype,"authMode",void 0),u([d()],nt.prototype,"authorizedCrossOriginDomains",void 0),u([Qe("authorizedCrossOriginDomains")],nt.prototype,"readAuthorizedCrossOriginDomains",null),u([d()],nt.prototype,"basemapGalleryGroupQuery",void 0),u([d()],nt.prototype,"bingKey",void 0),u([d()],nt.prototype,"canListApps",void 0),u([d()],nt.prototype,"canListData",void 0),u([d()],nt.prototype,"canListPreProvisionedItems",void 0),u([d()],nt.prototype,"canProvisionDirectPurchase",void 0),u([d()],nt.prototype,"canSearchPublic",void 0),u([d()],nt.prototype,"canShareBingPublic",void 0),u([d()],nt.prototype,"canSharePublic",void 0),u([d()],nt.prototype,"canSignInArcGIS",void 0),u([d()],nt.prototype,"canSignInIDP",void 0),u([d()],nt.prototype,"colorSetsGroupQuery",void 0),u([d()],nt.prototype,"commentsEnabled",void 0),u([d({type:Date})],nt.prototype,"created",void 0),u([d()],nt.prototype,"credential",void 0),u([d()],nt.prototype,"culture",void 0),u([d()],nt.prototype,"currentVersion",void 0),u([d()],nt.prototype,"customBaseUrl",void 0),u([d()],nt.prototype,"defaultBasemap",void 0),u([Qe("defaultBasemap")],nt.prototype,"readDefaultBasemap",null),u([d()],nt.prototype,"defaultDevBasemap",void 0),u([Qe("defaultDevBasemap")],nt.prototype,"readDefaultDevBasemap",null),u([d({type:Pi})],nt.prototype,"defaultExtent",void 0),u([d()],nt.prototype,"defaultVectorBasemap",void 0),u([Qe("defaultVectorBasemap")],nt.prototype,"readDefaultVectorBasemap",null),u([d()],nt.prototype,"description",void 0),u([d()],nt.prototype,"devBasemapGalleryGroupQuery",void 0),u([d()],nt.prototype,"eueiEnabled",void 0),u([d({readOnly:!0})],nt.prototype,"extraQuery",null),u([d()],nt.prototype,"featuredGroups",void 0),u([d()],nt.prototype,"featuredItemsGroupQuery",void 0),u([d()],nt.prototype,"galleryTemplatesGroupQuery",void 0),u([d()],nt.prototype,"livingAtlasGroupQuery",void 0),u([d()],nt.prototype,"hasCategorySchema",void 0),u([d()],nt.prototype,"helpBase",void 0),u([d()],nt.prototype,"helperServices",void 0),u([d()],nt.prototype,"helpMap",void 0),u([d()],nt.prototype,"homePageFeaturedContent",void 0),u([d()],nt.prototype,"homePageFeaturedContentCount",void 0),u([d()],nt.prototype,"httpPort",void 0),u([d()],nt.prototype,"httpsPort",void 0),u([d()],nt.prototype,"id",void 0),u([d()],nt.prototype,"ipCntryCode",void 0),u([d({readOnly:!0})],nt.prototype,"isOrganization",null),u([d()],nt.prototype,"isPortal",void 0),u([d()],nt.prototype,"isReadOnly",void 0),u([d({readOnly:!0})],nt.prototype,"itemPageUrl",null),u([d()],nt.prototype,"layerTemplatesGroupQuery",void 0),u([d()],nt.prototype,"maxTokenExpirationMinutes",void 0),u([d({type:Date})],nt.prototype,"modified",void 0),u([d()],nt.prototype,"name",void 0),u([d()],nt.prototype,"portalHostname",void 0),u([d()],nt.prototype,"portalMode",void 0),u([d()],nt.prototype,"portalProperties",void 0),u([d()],nt.prototype,"region",void 0),u([d({readOnly:!0})],nt.prototype,"restUrl",null),u([d()],nt.prototype,"rotatorPanels",void 0),u([d()],nt.prototype,"showHomePageDescription",void 0),u([d()],nt.prototype,"sourceJSON",void 0),u([d()],nt.prototype,"staticImagesUrl",void 0),u([d({json:{name:"2DStylesGroupQuery"}})],nt.prototype,"stylesGroupQuery2d",void 0),u([d({json:{name:"stylesGroupQuery"}})],nt.prototype,"stylesGroupQuery3d",void 0),u([d()],nt.prototype,"supportsHostedServices",void 0),u([d()],nt.prototype,"symbolSetsGroupQuery",void 0),u([d()],nt.prototype,"templatesGroupQuery",void 0),u([d()],nt.prototype,"thumbnail",void 0),u([d({readOnly:!0})],nt.prototype,"thumbnailUrl",null),u([d()],nt.prototype,"units",void 0),u([d()],nt.prototype,"url",void 0),u([d()],nt.prototype,"urlKey",void 0),u([Qe("urlKey")],nt.prototype,"readUrlKey",null),u([d()],nt.prototype,"user",void 0),u([Qe("user")],nt.prototype,"readUser",null),u([d()],nt.prototype,"useStandardizedQuery",void 0),u([d()],nt.prototype,"useVectorBasemaps",void 0),u([d()],nt.prototype,"vectorBasemapGalleryGroupQuery",void 0),nt=vu=u([I("esri.portal.Portal")],nt);const uc=nt;let Mb=class extends Cs(Ie){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return v(e)&&e.placement===this.placement&&e.style===this.style&&(C(this.color)&&C(e.color)||v(this.color)&&v(e.color)&&this.color.toJSON()===e.color.toJSON())}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Mb.prototype,"type",void 0),u([d({type:l6e,json:{default:"begin-end",write:!0}})],Mb.prototype,"placement",void 0),u([d({type:zye,json:{default:"arrow",write:!0}})],Mb.prototype,"style",void 0),u([d({type:ot,json:{type:[Yr],default:null,write:!0}})],Mb.prototype,"color",void 0),Mb=u([I("esri.symbols.LineStyleMarker3D")],Mb);const TG=Mb;var wN;let Uf=wN=class extends Km{constructor(t){super(t),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=gd(1),this.pattern=null,this.marker=null}clone(){const t={enabled:this.enabled,material:v(this.material)?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:v(this.pattern)?this.pattern.clone():null,marker:v(this.marker)?this.marker.clone():null};return new wN(t)}static fromSimpleLineSymbol(t){var i;const e={enabled:!0,size:t.width??gd(1),cap:t.cap||"butt",join:t.join||"miter",pattern:t.style&&t.style!=="inside-frame"?new AZ({style:t.style}):null,material:new Yu({color:(t.color||RM).clone()}),marker:t.marker?new TG({placement:t.marker.placement,style:t.marker.style,color:((i=t.marker.color)==null?void 0:i.clone())??null}):null};return new wN(e)}};u([d({type:Yu,json:{write:!0}})],Uf.prototype,"material",void 0),u([At({Line:"line"},{readOnly:!0})],Uf.prototype,"type",void 0),u([d({type:i0e,json:{write:!0,default:"miter"}})],Uf.prototype,"join",void 0),u([d({type:LZ,json:{write:!0,default:"butt"}})],Uf.prototype,"cap",void 0),u([d(Bm)],Uf.prototype,"size",void 0),u([d(Wye)],Uf.prototype,"pattern",void 0),u([d({types:{key:"type",base:TG,typeMap:{style:TG}},json:{write:!0}})],Uf.prototype,"marker",void 0),Uf=wN=u([I("esri.symbols.LineSymbol3DLayer")],Uf);const iI=Uf;var SG;const WUe=Ua()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let oR=SG=class extends Ie{clone(){return new SG({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{read:GZ,write:Zv}})],oR.prototype,"href",void 0),u([At(WUe)],oR.prototype,"primitive",void 0),oR=SG=u([I("esri.symbols.support.ObjectSymbol3DLayerResource")],oR);const M0e="sphere";var EG;let Ew=EG=class extends $e{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new EG({x:this.x,y:this.y,z:this.z})}};u([d({type:Number})],Ew.prototype,"x",void 0),u([d({type:Number})],Ew.prototype,"y",void 0),u([d({type:Number})],Ew.prototype,"z",void 0),Ew=EG=u([I("esri.symbols.support.Symbol3DAnchorPosition3D")],Ew);var CG;let Xa=CG=class extends Km{constructor(t){super(t),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new CG({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:v(this.material)?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};u([d({type:Yu,json:{write:!0}})],Xa.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Xa.prototype,"castShadows",void 0),u([d({type:oR,json:{write:!0}})],Xa.prototype,"resource",void 0),u([At({Object:"object"},{readOnly:!0})],Xa.prototype,"type",void 0),u([d({type:Number,json:{write:!0}})],Xa.prototype,"width",void 0),u([d({type:Number,json:{write:!0}})],Xa.prototype,"height",void 0),u([d({type:Number,json:{write:!0}})],Xa.prototype,"depth",void 0),u([At({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),d({json:{default:"origin"}})],Xa.prototype,"anchor",void 0),u([d({type:Ew,json:{type:[Number],read:{reader:t=>new Ew({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Xa.prototype,"anchorPosition",void 0),u([d({type:Number,json:{write:!0}})],Xa.prototype,"heading",void 0),u([d({type:Number,json:{write:!0}})],Xa.prototype,"tilt",void 0),u([d({type:Number,json:{write:!0}})],Xa.prototype,"roll",void 0),u([d({readOnly:!0})],Xa.prototype,"isPrimitive",null),Xa=CG=u([I("esri.symbols.ObjectSymbol3DLayer")],Xa);const qZ=Xa;var AG;let Fl=AG=class extends Km{constructor(t){super(t),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(t,e){return t??(e.height==null&&e.size!=null?e.size:void 0)}readHeight(t,e){return t??(e.width==null&&e.size!=null?e.size:void 0)}clone(){return new AG({enabled:this.enabled,material:v(this.material)?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};u([d({type:Yu,json:{write:!0}})],Fl.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Fl.prototype,"castShadows",void 0),u([At({Path:"path"},{readOnly:!0})],Fl.prototype,"type",void 0),u([d({type:["circle","quad"],json:{write:!0,default:"circle"}})],Fl.prototype,"profile",void 0),u([d({type:i0e,json:{write:!0,default:"miter"}})],Fl.prototype,"join",void 0),u([d({type:M6e,json:{write:!0,default:"butt"}})],Fl.prototype,"cap",void 0),u([d({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],Fl.prototype,"width",void 0),u([Qe("width",["width","size","height"])],Fl.prototype,"readWidth",null),u([d({type:Number,json:{write:!0}})],Fl.prototype,"height",void 0),u([Qe("height",["height","size","width"])],Fl.prototype,"readHeight",null),u([d({type:["center","bottom","top"],json:{write:!0,default:"center"}})],Fl.prototype,"anchor",void 0),u([d({type:["heading","all"],json:{write:!0,default:"all"}})],Fl.prototype,"profileRotation",void 0),Fl=AG=u([I("esri.symbols.PathSymbol3DLayer")],Fl);const WZ=Fl;var OG;let jS=OG=class extends Ie{constructor(){super(...arguments),this.color=new ot([0,0,0,1]),this.size=0}clone(){const t={color:ae(this.color),size:this.size};return new OG(t)}};u([d(s0)],jS.prototype,"color",void 0),u([d(Bm)],jS.prototype,"size",void 0),jS=OG=u([I("esri.symbols.support.Symbol3DHalo")],jS);let PM=class extends Cs(Ie){constructor(e){super(e),this.color=null}};u([d(s0)],PM.prototype,"color",void 0),PM=u([I("esri.symbols.support.Symbol3DTextBackground")],PM);var xN;let wc=xN=class extends Km{constructor(t){super(t),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(t){v(t)&&v(this._userSize)&&(t.size=this._userSize),this._set("font",t)}writeFont(t,e,i,r){const s={...r,textSymbol3D:!0};e.font=t.write({},s),delete e.font.size}get size(){return v(this._userSize)?this._userSize:v(this.font)&&this.font.size!=null?this.font.size:9}set size(t){this._userSize=t,v(this.font)&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const t=new xN({enabled:this.enabled,font:this.font&&ae(this.font),halo:this.halo&&ae(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:v(this.material)?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:ae(this.background)});return t._userSize=this._userSize,t}static fromTextSymbol(t){return new xN({font:v(t.font)?t.font.clone():new sU,halo:XUe(t.haloColor,t.haloSize),horizontalAlignment:t.horizontalAlignment,lineHeight:t.lineHeight,material:t.color?new Yu({color:t.color.clone()}):null,text:t.text,verticalAlignment:t.verticalAlignment,background:t.backgroundColor?new PM({color:t.backgroundColor.clone()}):null})}};function XUe(t,e){return t&&e!=null&&e>0?new jS({color:ae(t),size:e}):null}u([d({type:sU,json:{write:!0}})],wc.prototype,"font",null),u([lt("font")],wc.prototype,"writeFont",null),u([d({type:jS,json:{write:!0}})],wc.prototype,"halo",void 0),u([d({...s0e,json:{default:"center",write:!0}})],wc.prototype,"horizontalAlignment",void 0),u([d({...r0e,json:{default:1,write:!0}})],wc.prototype,"lineHeight",void 0),u([d({type:Yu,json:{write:!0}})],wc.prototype,"material",void 0),u([d({type:PM,json:{write:!0}})],wc.prototype,"background",void 0),u([d(Bm)],wc.prototype,"size",null),u([d({type:String,json:{write:!0}})],wc.prototype,"text",void 0),u([At({Text:"text"},{readOnly:!0})],wc.prototype,"type",void 0),u([d({...n0e,json:{default:"baseline",write:!0}})],wc.prototype,"verticalAlignment",void 0),wc=xN=u([I("esri.symbols.TextSymbol3DLayer")],wc);const lT=wc;var RG;let __=RG=class extends Km{constructor(t){super(t),this.color=MG.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new RG({color:ae(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};u([d({type:ot,nonNullable:!0,json:{type:[Yr],write:(t,e,i)=>e[i]=t.toArray(ot.AlphaMode.UNLESS_OPAQUE),default:()=>MG.clone(),defaultEquals:t=>t.toCss(!0)===MG.toCss(!0)}})],__.prototype,"color",void 0),u([At({Water:"water"},{readOnly:!0})],__.prototype,"type",void 0),u([d({type:["small","medium","large"],json:{write:!0,default:"medium"}})],__.prototype,"waterbodySize",void 0),u([d({type:Number,json:{write:!0,default:null}})],__.prototype,"waveDirection",void 0),u([d({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],__.prototype,"waveStrength",void 0),__=RG=u([I("esri.symbols.WaterSymbol3DLayer")],__);const MG=new ot([0,119,190]),P0e=__;var PG;let Pb=PG=class extends $e{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new PG({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};u([d({type:String})],Pb.prototype,"name",void 0),u([d({type:String})],Pb.prototype,"styleUrl",void 0),u([d({type:String})],Pb.prototype,"styleName",void 0),u([d({type:uc})],Pb.prototype,"portal",void 0),Pb=PG=u([I("esri.symbols.support.StyleOrigin")],Pb);const IG=Pb;var $G;let IM=$G=class extends $e{constructor(){super(...arguments),this.url=""}clone(){return new $G({url:this.url})}};u([d({type:String})],IM.prototype,"url",void 0),IM=$G=u([I("esri.symbols.support.Thumbnail")],IM);const I0e={icon:gv,object:qZ,line:iI,path:WZ,fill:eI,extrude:Bye,text:lT,water:P0e},YUe=Nt.ofType({base:Km,key:"type",typeMap:I0e,errorContext:"symbol-layer"});let Vf=class extends nu{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const i=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,r=i&&i.type||Nt;this._set("symbolLayers",new r)}get color(){return null}set color(e){this.constructed&&oe.getLogger(this.declaredClass).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){Rx(e,this._get("symbolLayers"))}readStyleOrigin(e,i,r){if(e.styleUrl&&e.name){const s=QC(e.styleUrl,r);return new IG({styleUrl:s,name:e.name})}if(e.styleName&&e.name)return new IG({portal:r&&r.portal||uc.getDefault(),styleName:e.styleName,name:e.name});r&&r.messages&&r.messages.push(new dd("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:r,definition:e}))}writeStyleOrigin(e,i,r,s){if(e.styleUrl&&e.name){let n=Ox(e.styleUrl,s);Zu(n)&&(n=zp(n)),i.styleOrigin={styleUrl:n,name:e.name}}else e.styleName&&e.name&&(e.portal&&s&&s.portal&&!u0e(e.portal.restUrl,s.portal.restUrl)?s&&s.messages&&s.messages.push(new dd("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):i.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof Km||e&&I0e[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};u([d({json:{read:!1,write:!1}})],Vf.prototype,"color",null),u([d({type:YUe,nonNullable:!0,json:{write:!0}}),wi(w0e)],Vf.prototype,"symbolLayers",null),u([d({type:IG})],Vf.prototype,"styleOrigin",void 0),u([Qe("styleOrigin")],Vf.prototype,"readStyleOrigin",null),u([lt("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],Vf.prototype,"writeStyleOrigin",null),u([d({type:IM,json:{read:!1}})],Vf.prototype,"thumbnail",void 0),u([d({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],Vf.prototype,"type",void 0),Vf=u([I("esri.symbols.Symbol3D")],Vf);const eA=Vf;let aR=class extends Ie{constructor(e){super(e),this.visible=!0}clone(){}};u([d({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],aR.prototype,"type",void 0),u([d({readOnly:!0})],aR.prototype,"visible",void 0),aR=u([I("esri.symbols.callouts.Callout3D")],aR);const $0e=aR;var LG;let TN=LG=class extends Ie{constructor(){super(...arguments),this.color=new ot("white")}clone(){return new LG({color:ae(this.color)})}};u([d(s0)],TN.prototype,"color",void 0),TN=LG=u([I("esri.symbols.callouts.LineCallout3DBorder")],TN);const L0e=TN;Object.freeze(Object.defineProperty({__proto__:null,default:L0e},Symbol.toStringTag,{value:"Module"}));var DG;let v_=DG=class extends $0e{constructor(t){super(t),this.type="line",this.color=new ot([0,0,0,1]),this.size=gd(1),this.border=null}get visible(){return this.size>0&&v(this.color)&&this.color.a>0}clone(){return new DG({color:ae(this.color),size:this.size,border:ae(this.border)})}};u([At({line:"line"},{readOnly:!0})],v_.prototype,"type",void 0),u([d(s0)],v_.prototype,"color",void 0),u([d(Bm)],v_.prototype,"size",void 0),u([d({type:L0e,json:{write:!0}})],v_.prototype,"border",void 0),u([d({readOnly:!0})],v_.prototype,"visible",null),v_=DG=u([I("esri.symbols.callouts.LineCallout3D")],v_);const ZUe=v_;function XZ(t){if(!t)return!1;const e=t.verticalOffset;return!!e&&!(e.screenLength<=0||v(e.maxWorldLength)&&e.maxWorldLength<=0)}function D0e(t){if(!t||!t.supportsCallout||!t.supportsCallout())return!1;const e=t.callout;return!!e&&!!e.visible&&!!XZ(t)}function YZ(t){return t.type==="point-3d"||t.type==="label-3d"}function N0e(t){return t.horizontalAlignment==="center"}const F0e={types:{key:"type",base:$0e,typeMap:{line:ZUe}},json:{write:!0}};var NG;let G2=NG=class extends Ie{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new NG({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};u([d(Bm)],G2.prototype,"screenLength",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0,default:0}})],G2.prototype,"minWorldLength",void 0),u([d({type:Number,json:{write:!0}})],G2.prototype,"maxWorldLength",void 0),G2=NG=u([I("esri.symbols.support.Symbol3DVerticalOffset")],G2);const U0e=G2;var SN;const V0e=Nt.ofType({base:null,key:"type",typeMap:{text:lT}});let b_=SN=class extends eA{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new V0e,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return D0e(this)}hasVisibleVerticalOffset(){return XZ(this)}clone(){return new SN({styleOrigin:ae(this.styleOrigin),symbolLayers:ae(this.symbolLayers),thumbnail:ae(this.thumbnail),callout:ae(this.callout),verticalOffset:ae(this.verticalOffset)})}static fromTextSymbol(t){return new SN({symbolLayers:[lT.fromTextSymbol(t)]})}};u([d({type:U0e,json:{write:!0}})],b_.prototype,"verticalOffset",void 0),u([d(F0e)],b_.prototype,"callout",void 0),u([d({json:{read:!1,write:!1}})],b_.prototype,"styleOrigin",void 0),u([d({type:V0e})],b_.prototype,"symbolLayers",void 0),u([At({LabelSymbol3D:"label-3d"},{readOnly:!0})],b_.prototype,"type",void 0),b_=SN=u([I("esri.symbols.LabelSymbol3D")],b_);const aU=b_;var EN;const k0e=Nt.ofType({base:null,key:"type",typeMap:{line:iI,path:WZ}}),JUe=Nt.ofType({base:null,key:"type",typeMap:{line:iI,path:WZ}});let lR=EN=class extends eA{constructor(t){super(t),this.symbolLayers=new k0e,this.type="line-3d"}clone(){return new EN({styleOrigin:ae(this.styleOrigin),symbolLayers:ae(this.symbolLayers),thumbnail:ae(this.thumbnail)})}static fromSimpleLineSymbol(t){return new EN({symbolLayers:[iI.fromSimpleLineSymbol(t)]})}};u([d({type:k0e,json:{type:JUe}})],lR.prototype,"symbolLayers",void 0),u([At({LineSymbol3D:"line-3d"},{readOnly:!0})],lR.prototype,"type",void 0),lR=EN=u([I("esri.symbols.LineSymbol3D")],lR);const lU=lR;let w_=class extends nu{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};u([d({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],w_.prototype,"angle",void 0),u([d({type:["simple-marker","picture-marker"],readOnly:!0})],w_.prototype,"type",void 0),u([d({type:Number,cast:mr,json:{write:!0}})],w_.prototype,"xoffset",void 0),u([d({type:Number,cast:mr,json:{write:!0}})],w_.prototype,"yoffset",void 0),u([d({type:Number,cast:t=>t==="auto"?t:mr(t),json:{write:!0}})],w_.prototype,"size",void 0),w_=u([I("esri.symbols.MarkerSymbol")],w_);const B0e=w_;var CN;const z0e=Nt.ofType({base:null,key:"type",typeMap:{fill:eI}});let cR=CN=class extends eA{constructor(t){super(t),this.symbolLayers=new z0e,this.type="mesh-3d"}clone(){return new CN({styleOrigin:ae(this.styleOrigin),symbolLayers:ae(this.symbolLayers),thumbnail:ae(this.thumbnail)})}static fromSimpleFillSymbol(t){return new CN({symbolLayers:[eI.fromSimpleFillSymbol(t)]})}};u([d({type:z0e})],cR.prototype,"symbolLayers",void 0),u([At({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],cR.prototype,"type",void 0),cR=CN=u([I("esri.symbols.MeshSymbol3D")],cR);const cU=cR;function KUe(t,e,i){return e.imageData?d0e({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):G0e(e.url,i)}function G0e(t,e){var i;return e8e(e)&&!Zu(t)&&((i=e==null?void 0:e.layer)!=null&&i.parsedUrl)?Ax(e.layer.parsedUrl.path,"images",t):QC(t,e)}function QUe(t,e,i,r){if(Qm(t)){const s=tI(t);if(!s)return;e.contentType=s.mediaType,e.imageData=s.data,i&&i.imageData===e.imageData&&i.url&&Zv(i.url,e,"url",r)}else Zv(t,e,"url",r)}const j0e={json:{read:{source:["imageData","url"],reader:KUe},write:{writer(t,e,i,r){QUe(t,e,this.source,r)}}}},H0e={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,i){const r={};return e.imageData&&(r.imageData=e.imageData),e.contentType&&(r.contentType=e.contentType),e.url&&(r.url=G0e(e.url,i)),r}}}};function e8e(t){var e,i;return!(t==null||t.origin!=="service"&&t.origin!=="portal-item"||((e=t.layer)==null?void 0:e.type)!=="feature"&&((i=t.layer)==null?void 0:i.type)!=="stream")}var FG;let Eh=FG=class extends Gye{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const s={};return t&&(s.url=t),e&&(s.outline=e),i!=null&&(s.width=mr(i)),r!=null&&(s.height=mr(r)),s}clone(){const t=new FG({color:ae(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",ae(this.source)),t}hash(){var t;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};u([At({esriPFS:"picture-fill"},{readOnly:!0})],Eh.prototype,"type",void 0),u([d(j0e)],Eh.prototype,"url",void 0),u([d({type:Number,json:{write:!0}})],Eh.prototype,"xscale",void 0),u([d({type:Number,json:{write:!0}})],Eh.prototype,"yscale",void 0),u([d({type:Number,cast:mr,json:{write:!0}})],Eh.prototype,"width",void 0),u([d({type:Number,cast:mr,json:{write:!0}})],Eh.prototype,"height",void 0),u([d({type:Number,cast:mr,json:{write:!0}})],Eh.prototype,"xoffset",void 0),u([d({type:Number,cast:mr,json:{write:!0}})],Eh.prototype,"yoffset",void 0),u([d(H0e)],Eh.prototype,"source",void 0),Eh=FG=u([I("esri.symbols.PictureFillSymbol")],Eh);const q0e=Eh;var UG;let Wd=UG=class extends B0e{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const r={};return t&&(r.url=t),e!=null&&(r.width=mr(e)),i!=null&&(r.height=mr(i)),r}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new UG({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",ae(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};u([d({json:{write:!1}})],Wd.prototype,"color",void 0),u([At({esriPMS:"picture-marker"},{readOnly:!0})],Wd.prototype,"type",void 0),u([d(j0e)],Wd.prototype,"url",void 0),u([d(H0e)],Wd.prototype,"source",void 0),u([d({type:Number,cast:mr,json:{write:!0}})],Wd.prototype,"height",void 0),u([Qe("height",["height","size"])],Wd.prototype,"readHeight",null),u([d({type:Number,cast:mr,json:{write:!0}})],Wd.prototype,"width",void 0),u([d({json:{write:!1}})],Wd.prototype,"size",void 0),Wd=UG=u([I("esri.symbols.PictureMarkerSymbol")],Wd);const uU=Wd;var Ib;const W0e=Nt.ofType({base:null,key:"type",typeMap:{icon:gv,object:qZ,text:lT}});let $b=Ib=class extends eA{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new W0e,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return D0e(this)}hasVisibleVerticalOffset(){return XZ(this)}clone(){return new Ib({verticalOffset:ae(this.verticalOffset),callout:ae(this.callout),styleOrigin:ae(this.styleOrigin),symbolLayers:ae(this.symbolLayers),thumbnail:ae(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new Ib({symbolLayers:[gv.fromSimpleMarkerSymbol(t)]})}static fromPictureMarkerSymbol(t){return new Ib({symbolLayers:[gv.fromPictureMarkerSymbol(t)]})}static fromCIMSymbol(t){var r,s;if(((s=(r=t.data)==null?void 0:r.symbol)==null?void 0:s.type)!=="CIMPointSymbol")return null;const i=t.data.symbol;return new Ib(i!=null&&i.callout?{symbolLayers:[gv.fromCIMSymbol(t)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}:{symbolLayers:[gv.fromCIMSymbol(t)]})}static fromTextSymbol(t){return new Ib({symbolLayers:[lT.fromTextSymbol(t)]})}};u([d({type:U0e,json:{write:!0}})],$b.prototype,"verticalOffset",void 0),u([d(F0e)],$b.prototype,"callout",void 0),u([d({type:W0e,json:{origins:{"web-scene":{write:!0}}}})],$b.prototype,"symbolLayers",void 0),u([At({PointSymbol3D:"point-3d"},{readOnly:!0})],$b.prototype,"type",void 0),$b=Ib=u([I("esri.symbols.PointSymbol3D")],$b);const yv=$b;var uR;const X0e=Nt.ofType({base:null,key:"type",typeMap:{extrude:Bye,fill:eI,icon:gv,line:iI,object:qZ,text:lT,water:P0e}});let hR=uR=class extends eA{constructor(t){super(t),this.symbolLayers=new X0e,this.type="polygon-3d"}clone(){return new uR({styleOrigin:ae(this.styleOrigin),symbolLayers:ae(this.symbolLayers),thumbnail:ae(this.thumbnail)})}static fromJSON(t){const e=new uR;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.getItemAt(0).type==="fill"&&e.symbolLayers.getItemAt(1).type==="line"){const i=e.symbolLayers.getItemAt(0),r=e.symbolLayers.getItemAt(1);!r.enabled||t.symbolLayers&&t.symbolLayers[1]&&t.symbolLayers[1].enable===!1||(i.outline={size:r.size,color:v(r.material)?r.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new uR({symbolLayers:[eI.fromSimpleFillSymbol(t)]})}};u([d({type:X0e,json:{write:!0}})],hR.prototype,"symbolLayers",void 0),u([At({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],hR.prototype,"type",void 0),hR=uR=u([I("esri.symbols.PolygonSymbol3D")],hR);const rI=hR;var VG;const NV=new Gi({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let Lb=VG=class extends Gye{constructor(...t){super(...t),this.color=new ot([0,0,0,.25]),this.outline=new Ed,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.style=t),e&&(r.outline=e),i&&(r.color=i),r}clone(){return new VG({color:ae(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};u([d()],Lb.prototype,"color",void 0),u([d()],Lb.prototype,"outline",void 0),u([At({esriSFS:"simple-fill"},{readOnly:!0})],Lb.prototype,"type",void 0),u([d({type:NV.apiValues,json:{read:NV.read,write:NV.write}})],Lb.prototype,"style",void 0),Lb=VG=u([I("esri.symbols.SimpleFillSymbol")],Lb);const y1=Lb;var kG;const FV=new Gi({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let kf=kG=class extends B0e{constructor(...t){super(...t),this.color=new ot([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new Ed}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string")return t;const s={};return t&&(s.style=t),e!=null&&(s.size=mr(e)),i&&(s.outline=i),r&&(s.color=r),s}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new kG({angle:this.angle,color:ae(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(t=this.outline)==null?void 0:t.hash()}`}};u([d()],kf.prototype,"color",void 0),u([lt("color")],kf.prototype,"writeColor",null),u([At({esriSMS:"simple-marker"},{readOnly:!0})],kf.prototype,"type",void 0),u([d()],kf.prototype,"size",void 0),u([d({type:FV.apiValues,json:{read:FV.read,write:FV.write}})],kf.prototype,"style",void 0),u([d({type:String,json:{write:!0}})],kf.prototype,"path",null),u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Ed}},json:{default:null,write:!0}})],kf.prototype,"outline",void 0),kf=kG=u([I("esri.symbols.SimpleMarkerSymbol")],kf);const _1=kf;var BG;let js=BG=class extends nu{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new sU,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.text=t),e&&(r.font=e),i&&(r.color=i),r}writeLineWidth(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}castLineWidth(t){return mr(t)}writeLineHeight(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}clone(){return new BG({angle:this.angle,backgroundColor:ae(this.backgroundColor),borderLineColor:ae(this.borderLineColor),borderLineSize:this.borderLineSize,color:ae(this.color),font:this.font&&this.font.clone(),haloColor:ae(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${(t=this.color)==null?void 0:t.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};u([d({type:ot,json:{write:!0}})],js.prototype,"backgroundColor",void 0),u([d({type:ot,json:{write:!0}})],js.prototype,"borderLineColor",void 0),u([d({type:Number,json:{write:!0},cast:mr})],js.prototype,"borderLineSize",void 0),u([d({type:sU,json:{write:!0}})],js.prototype,"font",void 0),u([d({...s0e,json:{write:!0}})],js.prototype,"horizontalAlignment",void 0),u([d({type:Boolean,json:{write:!0}})],js.prototype,"kerning",void 0),u([d({type:ot,json:{write:!0}})],js.prototype,"haloColor",void 0),u([d({type:Number,cast:mr,json:{write:!0}})],js.prototype,"haloSize",void 0),u([d({type:Boolean,json:{write:!0}})],js.prototype,"rightToLeft",void 0),u([d({type:Boolean,json:{write:!0}})],js.prototype,"rotated",void 0),u([d({type:String,json:{write:!0}})],js.prototype,"text",void 0),u([At({esriTS:"text"},{readOnly:!0})],js.prototype,"type",void 0),u([d({...n0e,json:{write:!0}})],js.prototype,"verticalAlignment",void 0),u([d({type:Number,cast:mr,json:{write:!0}})],js.prototype,"xoffset",void 0),u([d({type:Number,cast:mr,json:{write:!0}})],js.prototype,"yoffset",void 0),u([d({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],js.prototype,"angle",void 0),u([d({type:Number,json:{write:!0}})],js.prototype,"width",void 0),u([d({type:Number})],js.prototype,"lineWidth",void 0),u([lt("lineWidth")],js.prototype,"writeLineWidth",null),u([wi("lineWidth")],js.prototype,"castLineWidth",null),u([d(r0e)],js.prototype,"lineHeight",void 0),u([lt("lineHeight")],js.prototype,"writeLineHeight",null),js=BG=u([I("esri.symbols.TextSymbol")],js);const tA=js;var zG;let Xd=zG=class extends nu{constructor(t){super(t),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=v(this.portal)?this.portal:uc.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e==null?void 0:e.portal,super.read(t,e)}clone(){return new zG({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){return this._fetchSymbol("webRef",t)}fetchCIMSymbol(t){return this._fetchSymbol("cimRef",t)}async _fetchSymbol(t,e){const i=v(e)?e.cache:null,r=i?this._fetchCacheKey:null;if(v(i)){const a=r&&i.get(r);if(a)return a.clone()}const s=await t8e();gi(e);const n=s.resolveWebStyleSymbol(this,{portal:this.portal},t,e);n.catch(a=>{oe.getLogger(this.declaredClass).error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await n;return t==="webRef"&&o.type==="point-3d"||t==="cimRef"&&o.type==="cim"?(v(i)&&i.set(r,o.clone()),o):null}};function t8e(){return ee(()=>import("./webStyleSymbolUtils-b7d09968.js"),[],import.meta.url)}u([d({json:{write:!1}})],Xd.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],Xd.prototype,"styleName",void 0),u([d({type:uc,json:{write:!1}})],Xd.prototype,"portal",void 0),u([d({type:String,json:{read:GZ,write:Zv}})],Xd.prototype,"styleUrl",void 0),u([d({type:IM,json:{read:!1}})],Xd.prototype,"thumbnail",void 0),u([d({type:String,json:{write:!0}})],Xd.prototype,"name",void 0),u([At({styleSymbolReference:"web-style"},{readOnly:!0})],Xd.prototype,"type",void 0),u([d()],Xd.prototype,"_fetchCacheKey",null),Xd=zG=u([I("esri.symbols.WebStyleSymbol")],Xd);const cT=Xd;function hU(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function oC(t){if(!t)return!1;switch(t.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const nx={base:nu,key:"type",typeMap:{"simple-fill":y1,"picture-fill":q0e,"picture-marker":uU,"simple-line":Ed,"simple-marker":_1,text:tA,"label-3d":aU,"line-3d":lU,"mesh-3d":cU,"point-3d":yv,"polygon-3d":rI,"web-style":cT,cim:JC},errorContext:"symbol"},i8e={base:nu,key:"type",typeMap:{"picture-marker":uU,"simple-marker":_1,text:tA,"web-style":cT,cim:JC},errorContext:"symbol"},r8e=f1({types:nx}),dU={base:nu,key:"type",typeMap:{"simple-fill":y1,"picture-fill":q0e,"picture-marker":uU,"simple-line":Ed,"simple-marker":_1,text:tA,"line-3d":lU,"mesh-3d":cU,"point-3d":yv,"polygon-3d":rI,"web-style":cT,cim:JC},errorContext:"symbol"},s8e={base:nu,key:"type",typeMap:{text:tA,"label-3d":aU},errorContext:"symbol"},Yie={base:nu,key:"type",typeMap:{"line-3d":lU,"mesh-3d":cU,"point-3d":yv,"polygon-3d":rI,"web-style":cT,cim:JC},errorContext:"symbol"},n8e={base:nu,key:"type",typeMap:{"label-3d":aU},errorContext:"symbol"},Y0e=Xp(nx);function o8e(t){if(!t)return null;const e={};for(const i in t){const r=Gy(t[i]);r&&(e[i]=r)}return Object.keys(e).length!==0?e:null}function a8e(t){if(!v(t))return null;const e={};for(const i in t){const r=t[i];r&&(e[i]=r.toJSON())}return Object.keys(e).length!==0?e:null}let xc=class extends Cs(Ie){constructor(...e){super(...e),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:Zc(),configurable:!0})}normalizeCtorArgs(e,i,r,s){return e&&!e.declaredClass?e:{geometry:e,symbol:i,attributes:r,popupTemplate:s}}set aggregateGeometries(e){const i=this._get("aggregateGeometries");JSON.stringify(i)!==JSON.stringify(e)&&this._set("aggregateGeometries",e)}set attributes(e){const i=this._get("attributes");i!==e&&(this._set("attributes",e),this._notifyLayer("attributes",i,e))}set geometry(e){const i=this._get("geometry");i!==e&&(this._set("geometry",e),this._notifyLayer("geometry",i,e))}set symbol(e){const i=this._get("symbol");i!==e&&(this._set("symbol",e),this._notifyLayer("symbol",i,e))}set visible(e){const i=this._get("visible");i!==e&&(this._set("visible",e),this._notifyLayer("visible",i,e))}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;for(const i of[this.sourceLayer,this.layer])if(i){if("popupTemplate"in i&&i.popupTemplate)return i.popupTemplate;if(e&&"defaultPopupTemplate"in i&&v(i.defaultPopupTemplate))return i.defaultPopupTemplate}return null}getAttribute(e){var i;return(i=this.attributes)==null?void 0:i[e]}setAttribute(e,i){if(this.attributes){const r=this.getAttribute(e);this.attributes[e]=i,this._notifyLayer("attributes",r,i,e)}else this.attributes={[e]:i},this._notifyLayer("attributes",void 0,i,e)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:a8e(this.aggregateGeometries),geometry:v(this.geometry)?this.geometry.toJSON():null,symbol:v(this.symbol)?this.symbol.toJSON():null,attributes:{...this.attributes},popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(){v(this.geometry)&&this.geometry.type==="mesh"&&this._notifyLayer("transform",this.geometry.transform,this.geometry.transform)}_notifyLayer(e,i,r,s){if(!this.layer||!("graphicChanged"in this.layer))return;const n={graphic:this,property:e,oldValue:i,newValue:r};e==="attributes"&&(n.attributeName=s),this.layer.graphicChanged(n)}};u([d({value:null,json:{read:o8e}})],xc.prototype,"aggregateGeometries",null),u([d({value:null})],xc.prototype,"attributes",null),u([d({value:null,types:nT,json:{read:Gy}})],xc.prototype,"geometry",null),u([d({type:Boolean})],xc.prototype,"isAggregate",void 0),u([d({clonable:"reference"})],xc.prototype,"layer",void 0),u([d({type:QP})],xc.prototype,"popupTemplate",void 0),u([d({clonable:"reference"})],xc.prototype,"sourceLayer",void 0),u([d({value:null,types:nx})],xc.prototype,"symbol",null),u([d({type:Boolean,value:!0})],xc.prototype,"visible",null),xc=u([I("esri.Graphic")],xc),function(t){t.generateUID=Zc}(xc||(xc={}));const ha=xc;var GG;let x_=GG=class extends Ie{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new GG({rotation:this.rotation,scale:this.scale,targetGeometry:v(this.targetGeometry)?this.targetGeometry.clone():null,camera:v(this.camera)?this.camera.clone():null})}};function UV(){return{enabled:!this.camera}}u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:UV}}}}})],x_.prototype,"rotation",void 0),u([wi("rotation")],x_.prototype,"castRotation",null),u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:UV}}}}})],x_.prototype,"scale",void 0),u([d({types:nT,json:{read:Gy,write:!0,origins:{"web-scene":{read:Gy,write:{overridePolicy:UV}}}}})],x_.prototype,"targetGeometry",void 0),u([d({type:fd,json:{write:!0}})],x_.prototype,"camera",void 0),x_=GG=u([I("esri.Viewpoint")],x_);const zo=x_;function pU(t){return typeof t=="string"?document.getElementById(t):t??null}function Z0e(t){for(;t.hasChildNodes();)t.removeChild(t.firstChild)}function Zie(t,e){const i=e.parentNode;i&&i.insertBefore(t,e)}function Jie(t,e){for(;;){const i=t.firstChild;if(!i)break;e.appendChild(i)}}function re(t,e,i={}){return ZZ(t,e,i,J0e)}function qo(t,e,i={}){return ZZ(t,e,i,K0e)}function ZZ(t,e,i={},r){let s=null;const n=i.once?(o,a)=>{r(o)&&(Rr(s),e(o,a))}:(o,a)=>{r(o)&&e(o,a)};if(s=cNe(t,n,i.sync,i.equals),i.initial){const o=t();n(o,o)}return s}function pn(t,e,i,r={}){let s=null,n=null,o=null;function a(){var h;s&&n&&(n.remove(),(h=r.onListenerRemove)==null||h.call(r,s),s=null,n=null)}function l(h){r.once&&r.once&&Rr(o),i(h)}const c=re(t,(h,p)=>{var f;a(),D6(h)&&(s=h,n=HP(h,e,l),(f=r.onListenerAdd)==null||f.call(r,h))},{sync:r.sync,initial:!0});return o=Wp(()=>{c.remove(),a()}),o}function aC(t,e){return l8e(t,K0e,e)}function l8e(t,e,i){if(qn(i))return Promise.reject(Bi());const r=t();if(e!=null&&e(r))return Promise.resolve(r);let s=null;function n(){s=Rr(s)}return new Promise((o,a)=>{s=qE([ca(i,()=>{n(),a(Bi())}),ZZ(t,l=>{n(),o(l)},{sync:!1,once:!0},e??J0e)])})}function J0e(t){return!0}function K0e(t){return!!t}const Wi={sync:!0},Zt={initial:!0},Br={sync:!0,initial:!0};let P4=class{constructor(e=i=>i.values().next().value){this._peeker=e,this._items=new Set}get length(){return this._items.size}clear(){this._items.clear()}last(){if(this._items.size===0)return;let e;for(e of this._items);return e}peek(){if(this._items.size!==0)return this._peeker(this._items)}push(e){this.contains(e)||this._items.add(e)}contains(e){return this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),e}remove(e){this._items.delete(e)}filter(e){return this._items.forEach(i=>{e(i)||this._items.delete(i)}),this}};var ra;(function(t){t[t.HANDSHAKE=0]="HANDSHAKE",t[t.OPEN=1]="OPEN",t[t.OPENED=2]="OPENED",t[t.RESPONSE=3]="RESPONSE",t[t.INVOKE=4]="INVOKE",t[t.ABORT=5]="ABORT",t[t.CLOSE=6]="CLOSE",t[t.OPEN_PORT=7]="OPEN_PORT",t[t.ON=8]="ON"})(ra||(ra={}));let c8e=0;function Q0e(){return c8e++}function u8e(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function z3(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function JZ(t,e,i,r){if(e.type===ra.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==ra.INVOKE&&e.type!==ra.RESPONSE)return void t.postMessage(e);let s;if(u8e(i)?(s=Kie(i.transferList),e.data=i.result):(s=Kie(r),e.data=i),s){if(de("ff")){for(const n of s)if("byteLength"in n&&n.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case ra.INVOKE:throw o;case ra.RESPONSE:return void JZ(t,{type:ra.RESPONSE,jobId:e.jobId,error:z3(o)})}}}t.postMessage(e,s)}else t.postMessage(e)}function G3(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function Kie(t){if(!t||!t.length)return null;if(de("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(i=>!h8e(i));return e.length?e:null}function h8e(t){return t instanceof ArrayBuffer||t&&t.constructor&&t.constructor.name==="ArrayBuffer"}const d8e={statsWorker:()=>ee(()=>import("./statsWorker-73d66fcc.js"),["./statsWorker-73d66fcc.js","./utils-2505602d.js","./generateRendererUtils-dce0e007.js"],import.meta.url),geometryEngineWorker:()=>ee(()=>import("./geometryEngineWorker-8a57eda3.js"),["./geometryEngineWorker-8a57eda3.js","./geometryEngineJSON-3f330436.js","./geometryEngineBase-e1a33b0a.js","./json-48e3ea08.js"],import.meta.url),CSVSourceWorker:()=>ee(()=>import("./CSVSourceWorker-7042841a.js"),["./CSVSourceWorker-7042841a.js","./json-48e3ea08.js","./FeatureStore-7c5009b6.js","./BoundsStore-b6bb441e.js","./PooledRBush-83d0be85.js","./optimizedFeatureQueryEngineAdapter-dc9b72d8.js","./centroid-d1553553.js","./utils-7cfc8659.js","./projectionSupport-23b402d8.js","./QueryEngine-a3138f9c.js","./QueryEngineResult-10a77c28.js","./WhereClause-d3d68e94.js","./executionError-fb3f283a.js","./utils-2505602d.js","./generateRendererUtils-dce0e007.js","./QueryEngineCapabilities-42e44ded.js","./timeSupport-6a05419e.js","./number-9ca1111c.js","./clientSideDefaults-b0c27b52.js"],import.meta.url),EdgeProcessingWorker:()=>ee(()=>import("./EdgeProcessingWorker-ae9156bf.js"),[],import.meta.url),ElevationSamplerWorker:()=>ee(()=>import("./ElevationSamplerWorker-0aba1a52.js"),["./ElevationSamplerWorker-0aba1a52.js","./PooledRBush-83d0be85.js","./georeference-4ba130cc.js"],import.meta.url),FeatureServiceSnappingSourceWorker:()=>ee(()=>import("./FeatureServiceSnappingSourceWorker-10b6c10f.js"),["./FeatureServiceSnappingSourceWorker-10b6c10f.js","./FeatureStore-7c5009b6.js","./BoundsStore-b6bb441e.js","./PooledRBush-83d0be85.js","./optimizedFeatureQueryEngineAdapter-dc9b72d8.js","./centroid-d1553553.js","./utils-7cfc8659.js","./projectionSupport-23b402d8.js","./json-48e3ea08.js","./QueryEngine-a3138f9c.js","./QueryEngineResult-10a77c28.js","./WhereClause-d3d68e94.js","./executionError-fb3f283a.js","./utils-2505602d.js","./generateRendererUtils-dce0e007.js","./QueryEngineCapabilities-42e44ded.js","./timeSupport-6a05419e.js","./symbologySnappingCandidates-ea3ae5fa.js"],import.meta.url),GeoJSONSourceWorker:()=>ee(()=>import("./GeoJSONSourceWorker-7c93f79e.js"),["./GeoJSONSourceWorker-7c93f79e.js","./FeatureStore-7c5009b6.js","./BoundsStore-b6bb441e.js","./PooledRBush-83d0be85.js","./optimizedFeatureQueryEngineAdapter-dc9b72d8.js","./centroid-d1553553.js","./utils-7cfc8659.js","./projectionSupport-23b402d8.js","./json-48e3ea08.js","./QueryEngine-a3138f9c.js","./QueryEngineResult-10a77c28.js","./WhereClause-d3d68e94.js","./executionError-fb3f283a.js","./utils-2505602d.js","./generateRendererUtils-dce0e007.js","./QueryEngineCapabilities-42e44ded.js","./timeSupport-6a05419e.js","./geojson-66693584.js","./clientSideDefaults-b0c27b52.js","./sourceUtils-7fb8cb7e.js"],import.meta.url),LercWorker:()=>ee(()=>import("./LercWorker-88297893.js"),[],import.meta.url),MemorySourceWorker:()=>ee(()=>import("./MemorySourceWorker-8714c5a7.js"),["./MemorySourceWorker-8714c5a7.js","./objectIdUtils-789e911a.js","./FeatureStore-7c5009b6.js","./BoundsStore-b6bb441e.js","./PooledRBush-83d0be85.js","./optimizedFeatureQueryEngineAdapter-dc9b72d8.js","./centroid-d1553553.js","./utils-7cfc8659.js","./projectionSupport-23b402d8.js","./json-48e3ea08.js","./QueryEngine-a3138f9c.js","./QueryEngineResult-10a77c28.js","./WhereClause-d3d68e94.js","./executionError-fb3f283a.js","./utils-2505602d.js","./generateRendererUtils-dce0e007.js","./QueryEngineCapabilities-42e44ded.js","./timeSupport-6a05419e.js","./clientSideDefaults-b0c27b52.js","./sourceUtils-7fb8cb7e.js"],import.meta.url),PBFDecoderWorker:()=>ee(()=>import("./PBFDecoderWorker-1f3c4fe8.js"),[],import.meta.url),Pipeline:()=>ee(()=>import("./Pipeline-95673b7a.js"),["./Pipeline-95673b7a.js","./QueryEngine-a3138f9c.js","./QueryEngineResult-10a77c28.js","./WhereClause-d3d68e94.js","./executionError-fb3f283a.js","./utils-2505602d.js","./generateRendererUtils-dce0e007.js","./projectionSupport-23b402d8.js","./json-48e3ea08.js","./utils-7cfc8659.js","./QueryEngineCapabilities-42e44ded.js","./timeSupport-6a05419e.js","./FeatureStore2D-592e07fd.js","./CircularArray-c86c79de.js","./ComputedAttributeStorage-167c4551.js","./arcadeTimeUtils-999b74fd.js","./centroid-d1553553.js","./definitions-19bfb61c.js","./visualVariablesUtils-2780c14d.js","./color-803f68ad.js","./enums-4b2a86a0.js","./enums-b1d611e3.js","./number-b10bd8f5.js","./visualVariablesUtils-6ff5fadd.js","./ogcFeatureUtils-e881452c.js","./geojson-66693584.js","./clientSideDefaults-b0c27b52.js","./StreamFeatureManager-5a55bc70.js","./createConnection-908723de.js"],import.meta.url),PointCloudWorker:()=>ee(()=>import("./PointCloudWorker-c69680ce.js"),["./PointCloudWorker-c69680ce.js","./PointCloudWorkerUtil-bc670b7f.js","./PointCloudUniqueValueRenderer-c509ec1e.js","./I3SBinaryReader-fdd4f4f3.js"],import.meta.url),RasterWorker:()=>ee(()=>import("./RasterWorker-af45f13b.js"),["./RasterWorker-af45f13b.js","./dataUtils-aa03c744.js","./RasterSymbolizer-71d6a220.js","./colorUtils-c0f43caf.js","./utils-be6ab046.js","./rasterProjectionHelper-2a66ec39.js"],import.meta.url),SceneLayerSnappingSourceWorker:()=>ee(()=>import("./SceneLayerSnappingSourceWorker-8f20edfa.js"),["./SceneLayerSnappingSourceWorker-8f20edfa.js","./QueryEngineResult-10a77c28.js","./WhereClause-d3d68e94.js","./executionError-fb3f283a.js","./utils-2505602d.js","./generateRendererUtils-dce0e007.js","./projectionSupport-23b402d8.js","./json-48e3ea08.js","./utils-7cfc8659.js"],import.meta.url),SceneLayerWorker:()=>ee(()=>import("./SceneLayerWorker-4cd3d6b3.js").then(t=>t.S),["./SceneLayerWorker-4cd3d6b3.js","./I3SNode-724578f8.js"],import.meta.url),WFSSourceWorker:()=>ee(()=>import("./WFSSourceWorker-be3ce24b.js"),["./WFSSourceWorker-be3ce24b.js","./FeatureStore-7c5009b6.js","./BoundsStore-b6bb441e.js","./PooledRBush-83d0be85.js","./optimizedFeatureQueryEngineAdapter-dc9b72d8.js","./centroid-d1553553.js","./utils-7cfc8659.js","./projectionSupport-23b402d8.js","./json-48e3ea08.js","./QueryEngine-a3138f9c.js","./QueryEngineResult-10a77c28.js","./WhereClause-d3d68e94.js","./executionError-fb3f283a.js","./utils-2505602d.js","./generateRendererUtils-dce0e007.js","./QueryEngineCapabilities-42e44ded.js","./timeSupport-6a05419e.js","./geojson-66693584.js","./sourceUtils-7fb8cb7e.js","./wfsUtils-6262e060.js","./xmlUtils-444cb4c0.js"],import.meta.url),WorkerTileHandler:()=>ee(()=>import("./WorkerTileHandler-a2689afc.js"),["./WorkerTileHandler-a2689afc.js","./GeometryUtils-53652037.js","./Rect-ea14f53a.js","./StyleDefinition-7d58136b.js","./enums-4b2a86a0.js","./TurboLine-24df9e47.js","./definitions-19bfb61c.js","./StyleRepository-063ad8a0.js","./colorUtils-c0f43caf.js","./BidiEngine-836b7ef6.js"],import.meta.url)},{CLOSE:Qie,ABORT:ere,INVOKE:tre,RESPONSE:VA,OPEN_PORT:ire,ON:p8e}=ra,f8e=2;let m8e=class{constructor(e){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=e,this._timer=null,this._process=this._process.bind(this)}push(e){e.type===ra.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},Jv=class j2{static connect(e){const i=new MessageChannel;let r;r=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const s=new j2(i.port1,{channel:i,client:r},()=>null);return typeof r=="object"&&"remoteClient"in r&&(r.remoteClient=s),j2.clients.set(s,r),i.port2}static loadWorker(e){const i=d8e[e];return i?i():Promise.resolve(null)}constructor(e,i,r){this._port=e,this._getNextJob=r,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new m8e(s=>this._onInvokeMessage(s)),this._client=i.client,this._onMessage=this._onMessage.bind(this),this._channel=i.channel,this._schedule=i.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:Qie}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,i,r){const s=r&&r.signal,n=r&&r.transferList;if(!this._port)return Promise.reject(new W("worker:port-closed",`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:i}));const o=Q0e();return new Promise((a,l)=>{if(qn(s))return this._processWork(),void l(Bi());const c=ca(s,()=>{const p=this._outJobs.get(o);p&&(this._outJobs.delete(o),this._processWork(),Rr(p.abortHandle),this._post({type:ere,jobId:o}),l(Bi()))}),h={resolve:a,reject:l,abortHandle:c,debugInfo:e};this._outJobs.set(o,h),this._post({type:tre,jobId:o,methodName:e,abortable:s!=null},i,n)})}on(e,i){const r=new MessageChannel;function s(n){i(n.data)}return this._port.postMessage({type:ra.ON,eventType:e,port:r.port2},[r.port2]),r.port1.addEventListener("message",s),r.port1.start(),{remove(){r.port1.postMessage({type:ra.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",s)}}}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:ire,port:e.port2}),e.port1}_processWork(){if(this._outJobs.size>=f8e)return;const e=this._getNextJob();if(!e)return;const{methodName:i,data:r,invokeOptions:s,deferred:n}=e;this.invoke(i,r,s).then(o=>n.resolve(o)).catch(o=>n.reject(o))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{Rr(e.abortHandle),e.reject(Bi(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=this._client=this._schedule=null}_onMessage(e){v(this._schedule)?this._schedule(()=>this._processMessage(e)):this._processMessage(e)}_processMessage(e){const i=G3(e);if(i)switch(i.type){case VA:this._onResponseMessage(i);break;case tre:this._invokeQueue.push(i);break;case ere:this._onAbortMessage(i);break;case Qie:this._onCloseMessage();break;case ire:this._onOpenPortMessage(i);break;case p8e:this._onOnMessage(i)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,s=i.get(r);this._invokeQueue.push(e),s&&(s.controller&&s.controller.abort(),i.delete(r))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&j2.clients.get(this)===e&&e.destroy(),j2.clients.delete(this),e&&e.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:i,jobId:r,data:s,abortable:n}=e,o=n?new AbortController:null,a=this._inJobs;let l,c=this._client,h=c[i];try{if(!h&&i&&i.includes(".")){const p=i.split(".");for(let f=0;f<p.length-1;f++)c=c[p[f]],h=c[p[f+1]]}if(typeof h!="function")throw new TypeError(`${i} is not a function`);l=h.call(c,s,{client:this,signal:o?o.signal:null})}catch(p){return void this._post({type:VA,jobId:r,error:z3(p)})}su(l)?(a.set(r,{controller:o,promise:l}),l.then(p=>{a.has(r)&&(a.delete(r),this._post({type:VA,jobId:r},p))},p=>{a.has(r)&&(a.delete(r),ln(p)||this._post({type:VA,jobId:r,error:z3(p||{message:`Error encountered at method ${i}`})}))})):this._post({type:VA,jobId:r},l)}_onOpenPortMessage(e){new j2(e.port,{client:this._client},()=>null)}_onOnMessage(e){const{port:i}=e,r=this._client.on(e.eventType,n=>{i.postMessage(n)}),s=HP(e.port,"message",n=>{var o;((o=G3(n))==null?void 0:o.type)===ra.CLOSE&&(s.remove(),r.remove(),i.close())})}_onResponseMessage(e){const{jobId:i,error:r,data:s}=e,n=this._outJobs;if(!n.has(i))return;const o=n.get(i);n.delete(i),this._processWork(),Rr(o.abortHandle),r?o.reject(W.fromJSON(JSON.parse(r))):o.resolve(s)}_post(e,i,r){return JZ(this._port,e,i,r)}};Jv.kernelInfo={revision:T0e,version:S0e,buildDate:x0e},Jv.clients=new Map;let g8e=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new P4}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(e,i){return new Promise((r,s)=>{let n=!0;const o=a=>{gi(i.signal),n&&(n=!1,a())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const l=e[a];su(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new Jv(c,i,()=>this._ongoingJobsQueue.pop()??null),o(r),this._clients[a]),()=>(o(s),null)):(this._clients[a]=new Jv(l,i,()=>this._ongoingJobsQueue.pop()??null),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(r))}})}broadcast(e,i,r){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const o=this._clientPromises[n];s[n]=o.then(a=>a==null?void 0:a.invoke(e,i,r))}return s}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.deferred.reject(Bi(`Worker closing, aborting job calling '${e.methodName}'`));for(const i of this._clientPromises)i.then(r=>r==null?void 0:r.close());this._clients.length=0,this._clientPromises.length=0}invoke(e,i,r){let s;Array.isArray(r)?(oe.getLogger("esri.core.workers.Connection").warn("invoke()","The transferList parameter is deprecated, use the options object instead"),s={transferList:r}):s=r;const n=ky();this._ongoingJobsQueue.push({methodName:e,data:i,invokeOptions:s,deferred:n});for(let o=0;o<this._clientPromises.length;o++){const a=this._clients[o];a?a.jobAdded():this._clientPromises[o].then(l=>l==null?void 0:l.jobAdded())}return n.promise}on(e,i){return Promise.all(this._clientPromises).then(()=>qE(this._clients.map(r=>r.on(e,i))))}openPorts(){return new Promise(e=>{const i=new Array(this._clientPromises.length);let r=i.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{n&&(i[s]=n.openPort()),--r==0&&e(i)})})}get test(){return{numClients:this._clients.length}}};const y8e=oe.getLogger("esri.assets");function _8e(t,e){return zr(ir(t),e)}function ir(t){if(!ar.assetsPath)throw y8e.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new W("assets:path-not-set","config.assetsPath is not set");return Ax(ar.assetsPath,t)}const e_e=oe.getLogger("esri.intl.substitute");function rm(t,e,i={}){const{format:r={}}=i;return Fm(t,s=>v8e(s,e,r))}function v8e(t,e,i){let r,s;const n=t.indexOf(":");if(n===-1?r=t.trim():(r=t.slice(0,n).trim(),s=t.slice(n+1).trim()),!r)return"";const o=GP(r,e);if(o==null)return"";const a=(s?i==null?void 0:i[s]:null)??(i==null?void 0:i[r]);return a?b8e(o,a):s?w8e(o,s):KZ(o)}function b8e(t,e){switch(e.type){case"date":return Vm(t,e.intlOptions);case"number":return km(t,e.intlOptions);default:return e_e.warn("missing format descriptor for key {key}"),KZ(t)}}function w8e(t,e){switch(e.toLowerCase()){case"dateformat":return Vm(t);case"numberformat":return km(t);default:return e_e.warn(`inline format is unsupported since 4.12: ${e}`),/^(dateformat|datestring)/i.test(e)?Vm(t):/^numberformat/i.test(e)?km(t):KZ(t)}}function KZ(t){switch(typeof t){case"string":return t;case"number":return km(t);case"boolean":return""+t;default:return t instanceof Date?Vm(t):""}}const rre=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,x8e={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function sre(t){return x8e[t]??!1}const dR=[],_E=new Map;function nre(t){for(const e of _E.keys())i_e(t.pattern,e)&&_E.delete(e)}function T8e(t){return dR.includes(t)||(nre(t),dR.unshift(t)),{remove(){const e=dR.indexOf(t);e>-1&&(dR.splice(e,1),nre(t))}}}async function t_e(t){const e=od();_E.has(t)||_E.set(t,E8e(t,e));const i=_E.get(t);return i&&await C8e.add(i),i}function S8e(t){if(!rre.test(t))return null;const e=rre.exec(t);if(e===null)return null;const[,i,r]=e,s=i+(r?"-"+r.toUpperCase():"");return sre(s)?s:sre(i)?i:null}async function E8e(t,e){const i=[];for(const r of dR)if(i_e(r.pattern,t))try{return await r.fetchMessageBundle(t,e)}catch(s){i.push(s)}throw i.length?new W("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:i}):new W("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function i_e(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}bZ(()=>{_E.clear()});const C8e=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=ky())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function A8e(t,e,i,r){const s=e.exec(i);if(!s)throw new W("esri-intl:invalid-bundle",`Bundle id "${i}" is not compatible with the pattern "${e}"`);const n=s[1]?`${s[1]}/`:"",o=s[2],a=S8e(r),l=`${n}${o}.json`,c=a?`${n}${o}_${a}.json`:l;let h;try{h=await ore(t(c))}catch(p){if(c===l)throw new W("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:p});try{h=await ore(t(l))}catch(f){throw new W("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:f})}}return h}async function ore(t){if(v(are.fetchBundleAsset))return are.fetchBundleAsset(t);const e=await zr(t,{responseType:"text"});return JSON.parse(e.data)}let O8e=class{constructor({base:e="",pattern:i,location:r=new URL(window.location.href)}){let s;s=typeof r=="string"?n=>new URL(n,new URL(r,window.location.href)).href:r instanceof URL?n=>new URL(n,r).href:r,this.pattern=typeof i=="string"?new RegExp(`^${i}`):i,this.getAssetUrl=s,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)/)?(.*)$`)}fetchMessageBundle(e,i){return A8e(this.getAssetUrl,this.matcher,e,i)}};function R8e(t){return new O8e(t)}const are={};T8e(R8e({pattern:"esri/",location:ir}));const M8e={};function P8e(t){const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:t.packages&&t.packages.concat()||[],paths:{...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=M8e.baseUrl),e}let I8e=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(i=>{this[i]=(...r)=>e[i](...r)})}},AN=class{constructor(){this._dispatcher=new I8e,this._workerPostMessage({type:ra.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){WE(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,i,r){this._dispatcher.addEventListener(e,i,r)}removeEventListener(e,i,r){this._dispatcher.removeEventListener(e,i,r)}_workerPostMessage(e){WE(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const i=G3(e);if(i&&i.type===ra.OPEN){const{modulePath:r,jobId:s}=i;let n=await Jv.loadWorker(r);n||(n=await ee(()=>import(r),[],import.meta.url));const o=Jv.connect(n);this._workerPostMessage({type:ra.OPENED,jobId:s,data:o})}}};const jG=oe.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:$8e}=ra,L8e='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,version:r}=configuration.kernelInfo,{revision:t,version:n}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS API for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\\nModules version: ${r}\\nAssets version: ${n}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const i=outgoing.get(r);outgoing.delete(r),o.error?i.reject(JSON.parse(o.error)):i.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let l$,c$;const lre="Failed to create Worker. Fallback to execute module in main thread";async function D8e(){if(!de("esri-workers")||(de("mozilla"),0))return cre(new AN);if(!l$&&!c$)try{const e=L8e.split('"{CONFIGURATION}"').join(`'${N8e()}'`);l$=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){c$=e||{}}let t;if(l$)try{t=new Worker(l$,{name:"esri-worker-"+F8e++})}catch{jG.warn(lre,c$),t=new AN}else jG.warn(lre,c$),t=new AN;return cre(t)}async function cre(t){return new Promise(e=>{function i(s){const n=G3(s);n&&n.type===$8e&&(t.removeEventListener("message",i),t.removeEventListener("error",r),e(t))}function r(s){s.preventDefault(),t.removeEventListener("message",i),t.removeEventListener("error",r),jG.warn("Failed to create Worker. Fallback to execute module in main thread",s),(t=new AN).addEventListener("message",i),t.addEventListener("error",r)}t.addEventListener("message",i),t.addEventListener("error",r)})}function N8e(){let t;if(ar.default!=null){const s={...ar};delete s.default,t=JSON.parse(JSON.stringify(s))}else t=JSON.parse(JSON.stringify(ar));t.assetsPath=Gu(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?Gu(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=od(),t.has={"esri-csp-restrictions":de("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":de("esri-2d-update-debug"),"featurelayer-pbf":de("featurelayer-pbf"),"featurelayer-simplify-thresholds":de("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":de("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":de("featurelayer-simplify-mobile-factor"),"esri-atomics":de("esri-atomics"),"esri-shared-array-buffer":de("esri-shared-array-buffer"),"esri-tiles-debug":de("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":de("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":de("feature-polyline-generalization-factor"),"host-webworker":1,"polylabel-placement-enabled":de("polylabel-placement-enabled")},t.workers.loaderUrl&&(t.workers.loaderUrl=Gu(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=Gu(t.workers.workerPath):t.workers.workerPath=Gu(ir("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=ar.workers.loaderConfig,i=P8e({baseUrl:e==null?void 0:e.baseUrl,locale:od(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e==null?void 0:e.has},map:{...e==null?void 0:e.map},paths:{...e==null?void 0:e.paths},packages:(e==null?void 0:e.packages)||[]});return JSON.stringify({esriConfig:t,loaderConfig:i,kernelInfo:{version:S0e,buildDate:x0e,revision:T0e}})}let F8e=0;const{ABORT:ure,INVOKE:U8e,OPEN:V8e,OPENED:k8e,RESPONSE:kA}=ra;let B8e=class r_e{static async create(e){const i=await D8e();return new r_e(i,e)}constructor(e,i){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=i,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",r=>{r.preventDefault(),oe.getLogger("esri.core.workers.WorkerOwner").error(r)})}terminate(){this.worker.terminate()}async open(e,i={}){const{signal:r}=i,s=Q0e();return new Promise((n,o)=>{const a={resolve:n,reject:o,abortHandle:F6(r,()=>{this._outJobs.delete(s),this._post({type:ure,jobId:s})})};this._outJobs.set(s,a),this._post({type:V8e,jobId:s,modulePath:e})})}_onMessage(e){const i=G3(e);if(i)switch(i.type){case k8e:this._onOpenedMessage(i);break;case kA:this._onResponseMessage(i);break;case ure:this._onAbortMessage(i);break;case U8e:this._onInvokeMessage(i)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,s=i.get(r);s&&(s.controller&&s.controller.abort(),i.delete(r))}_onInvokeMessage(e){const{methodName:i,jobId:r,data:s,abortable:n}=e,o=n?new AbortController:null,a=this._inJobs,l=wUe[i];let c;try{if(typeof l!="function")throw new TypeError(`${i} is not a function`);c=l.call(null,s,{signal:o?o.signal:null})}catch(h){return void this._post({type:kA,jobId:r,error:z3(h)})}su(c)?(a.set(r,{controller:o,promise:c}),c.then(h=>{a.has(r)&&(a.delete(r),this._post({type:kA,jobId:r},h))},h=>{a.has(r)&&(a.delete(r),h||(h={message:"Error encountered at method"+i}),ln(h)||this._post({type:kA,jobId:r,error:z3(h||{message:`Error encountered at method ${i}`})}))})):this._post({type:kA,jobId:r},c)}_onOpenedMessage(e){const{jobId:i,data:r}=e,s=this._outJobs.get(i);s&&(this._outJobs.delete(i),Rr(s.abortHandle),s.resolve(r))}_onResponseMessage(e){const{jobId:i,error:r,data:s}=e,n=this._outJobs.get(i);n&&(this._outJobs.delete(i),Rr(n.abortHandle),r?n.reject(W.fromJSON(JSON.parse(r))):n.resolve(s))}_post(e,i,r){return JZ(this.worker,e,i,r)}},Gw=de("esri-workers-debug")?1:de("esri-mobile")?Math.min(navigator.hardwareConcurrency-1,3):de("host-browser")?navigator.hardwareConcurrency-1:0;Gw||(Gw=de("safari")&&de("mac")?7:2);let hre=0;const ON=[];function s_e(){o_e()}async function u$(t,e){const i=new g8e;return await i.open(t,e),i}async function n_e(t,e={}){if(typeof t!="string")throw new W("workers:undefined-module","modulePath is missing");let i=e.strategy||"distributed";if(de("host-webworker")&&!de("esri-workers")&&(i="local"),i==="local"){let r=await Jv.loadWorker(t);r||(r=await ee(()=>import(t),[],import.meta.url)),gi(e.signal);const s=e.client||r;return u$([Jv.connect(r)],{...e,client:s})}if(await o_e(),gi(e.signal),i==="dedicated"){const r=hre++%Gw;return u$([await ON[r].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const r=Math.min(e.maxNumWorkers,Gw);if(r<Gw){const s=new Array(r);for(let n=0;n<r;++n){const o=hre++%Gw;s[n]=ON[o].open(t,e)}return u$(s,e)}}return u$(ON.map(r=>r.open(t,e)),e)}let h$=null;async function o_e(){if(h$)return h$;new AbortController;const t=[];for(let e=0;e<Gw;e++){const i=B8e.create(e).then(r=>(ON[e]=r,r));t.push(i)}return h$=Promise.all(t),h$}let Cm=class extends $e{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._handles=new Ki,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll(),this._handles.destroy()}add(e,i,r={}){return this._installWatch(e,i,r,re)}addWhen(e,i,r={}){return this._installWatch(e,i,r,qo)}addOnCollectionChange(e,i,{initial:r=!1,final:s=!1}={}){const n=++this._handleId;return this._handles.add([pn(e,"after-changes",this._createSyncUpdatingCallback(),Wi),pn(e,"change",i,{onListenerAdd:r?o=>i({added:o.toArray(),removed:[]}):void 0,onListenerRemove:s?o=>i({added:[],removed:o.toArray()}):void 0})],n),{remove:()=>this._handles.remove(n)}}addPromise(e){if(C(e))return e;const i=++this._handleId;this._handles.add({remove:()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this._handles.has(d$)||this._set("updating",!1))}},i),this._pendingPromises.add(e),this._set("updating",!0);const r=()=>this._handles.remove(i);return e.then(r,r),e}removeAll(){this._pendingPromises.clear(),this._handles.removeAll(),this._set("updating",!1)}_installWatch(e,i,r={},s){const n=++this._handleId;r.sync||this._installSyncUpdatingWatch(e,n);const o=s(e,i,r);return this._handles.add(o,n),{remove:()=>this._handles.remove(n)}}_installSyncUpdatingWatch(e,i){const r=this._createSyncUpdatingCallback(),s=re(e,r,{sync:!0,equals:()=>!1});return this._handles.add(s,i),s}_createSyncUpdatingCallback(){return()=>{this._handles.remove(d$),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this._handles.add(rT(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this._handles.remove(d$))}),d$)}}};u([d({readOnly:!0})],Cm.prototype,"updating",void 0),Cm=u([I("esri.core.support.WatchUpdatingTracking")],Cm);const d$=-42,uT=t=>{let e=class extends t{destroy(){var i,r;this.destroyed||((i=this._get("handles"))==null||i.destroy(),(r=this._get("updatingHandles"))==null||r.destroy())}get handles(){return this._get("handles")||new Ki}get updatingHandles(){return this._get("updatingHandles")||new Cm}};return u([d({readOnly:!0})],e.prototype,"handles",null),u([d({readOnly:!0})],e.prototype,"updatingHandles",null),e=u([I("esri.core.HandleOwner")],e),e};let j3=class extends uT($e){};j3=u([I("esri.core.HandleOwner")],j3);let $M=class extends uT(Nt){constructor(e){super(e),this.handles.add([this.on("before-add",i=>{C(i.item)&&i.preventDefault()}),this.on("after-add",i=>this._own(i.item)),this.on("after-remove",i=>this._release(i.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(Nt.ofType(this.itemType.Type))(e):new Nt(e)}};function HG(t,e){return{type:t,cast:w0e,set(i){const r=Rx(i,this._get(e),t);r.owner=this,this._set(e,r)}}}u([d()],$M.prototype,"owner",null),$M=u([I("esri.core.support.OwningCollection")],$M);var pR;const I4=Ua()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),a_e=I4.jsonValues.slice();A3(a_e,"orthometric");const LM=Ua()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let Yd=pR=class extends Ie{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,i){return I4.write(t,e,i)}readHeightModel(t,e,i){return I4.read(t)||(i&&i.messages&&i.messages.push(z8e(t,{context:i})),null)}readHeightUnit(t,e,i){return LM.read(t)||(i&&i.messages&&i.messages.push(dre(t,{context:i})),null)}readHeightUnitService(t,e,i){return Fge(t)||LM.read(t)||(i&&i.messages&&i.messages.push(dre(t,{context:i})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new pR({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const i=s4e(e);return new pR({heightModel:t.heightModel,heightUnit:i,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new pR;return e.read(t,{origin:"web-scene"}),e}};function dre(t,e){return new dd("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function z8e(t,e){return new dd("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}u([d({type:I4.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:a_e,default:"ellipsoidal"}}}})],Yd.prototype,"heightModel",void 0),u([lt("web-scene","heightModel")],Yd.prototype,"writeHeightModel",null),u([Qe(["web-scene","service"],"heightModel")],Yd.prototype,"readHeightModel",null),u([d({type:LM.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:LM.jsonValues,write:LM.write}}}})],Yd.prototype,"heightUnit",void 0),u([Qe("web-scene","heightUnit")],Yd.prototype,"readHeightUnit",null),u([Qe("service","heightUnit")],Yd.prototype,"readHeightUnitService",null),u([d({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],Yd.prototype,"vertCRS",void 0),u([Qe("service","vertCRS",["vertCRS","ellipsoid","geoid"])],Yd.prototype,"readVertCRS",null),Yd=pR=u([I("esri.geometry.HeightModelInfo")],Yd);const iA=Yd;function Xn(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function eg(t,e,i,r,s,n,o,a,l,c,h,p,f,m,y,_,b){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t[9]=h,t[10]=p,t[11]=f,t[12]=m,t[13]=y,t[14]=_,t[15]=b,t}function _d(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function tu(t,e){if(t===e){const i=e[1],r=e[2],s=e[3],n=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=n,t[11]=e[14],t[12]=s,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function rA(t,e){return Go(t,e)||_d(t),t}function Go(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],m=e[11],y=e[12],_=e[13],b=e[14],w=e[15],S=i*a-r*o,T=i*l-s*o,E=i*c-n*o,O=r*l-s*a,R=r*c-n*a,L=s*c-n*l,P=h*_-p*y,F=h*b-f*y,V=h*w-m*y,B=p*b-f*_,G=p*w-m*_,te=f*w-m*b;let se=S*te-T*G+E*B+O*V-R*F+L*P;return se?(se=1/se,t[0]=(a*te-l*G+c*B)*se,t[1]=(s*G-r*te-n*B)*se,t[2]=(_*L-b*R+w*O)*se,t[3]=(f*R-p*L-m*O)*se,t[4]=(l*V-o*te-c*F)*se,t[5]=(i*te-s*V+n*F)*se,t[6]=(b*E-y*L-w*T)*se,t[7]=(h*L-f*E+m*T)*se,t[8]=(o*G-a*V+c*P)*se,t[9]=(r*V-i*G-n*P)*se,t[10]=(y*R-_*E+w*S)*se,t[11]=(p*E-h*R-m*S)*se,t[12]=(a*F-o*B-l*P)*se,t[13]=(i*B-r*F+s*P)*se,t[14]=(_*T-y*O-b*S)*se,t[15]=(h*O-p*T+f*S)*se,t):null}function G8e(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],m=e[11],y=e[12],_=e[13],b=e[14],w=e[15];return t[0]=a*(f*w-m*b)-p*(l*w-c*b)+_*(l*m-c*f),t[1]=-(r*(f*w-m*b)-p*(s*w-n*b)+_*(s*m-n*f)),t[2]=r*(l*w-c*b)-a*(s*w-n*b)+_*(s*c-n*l),t[3]=-(r*(l*m-c*f)-a*(s*m-n*f)+p*(s*c-n*l)),t[4]=-(o*(f*w-m*b)-h*(l*w-c*b)+y*(l*m-c*f)),t[5]=i*(f*w-m*b)-h*(s*w-n*b)+y*(s*m-n*f),t[6]=-(i*(l*w-c*b)-o*(s*w-n*b)+y*(s*c-n*l)),t[7]=i*(l*m-c*f)-o*(s*m-n*f)+h*(s*c-n*l),t[8]=o*(p*w-m*_)-h*(a*w-c*_)+y*(a*m-c*p),t[9]=-(i*(p*w-m*_)-h*(r*w-n*_)+y*(r*m-n*p)),t[10]=i*(a*w-c*_)-o*(r*w-n*_)+y*(r*c-n*a),t[11]=-(i*(a*m-c*p)-o*(r*m-n*p)+h*(r*c-n*a)),t[12]=-(o*(p*b-f*_)-h*(a*b-l*_)+y*(a*f-l*p)),t[13]=i*(p*b-f*_)-h*(r*b-s*_)+y*(r*f-s*p),t[14]=-(i*(a*b-l*_)-o*(r*b-s*_)+y*(r*l-s*a)),t[15]=i*(a*f-l*p)-o*(r*f-s*p)+h*(r*l-s*a),t}function j8e(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],p=t[10],f=t[11],m=t[12],y=t[13],_=t[14],b=t[15];return(e*o-i*n)*(p*b-f*_)-(e*a-r*n)*(h*b-f*y)+(e*l-s*n)*(h*_-p*y)+(i*a-r*o)*(c*b-f*m)-(i*l-s*o)*(c*_-p*m)+(r*l-s*a)*(c*y-h*m)}function Ts(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],f=e[9],m=e[10],y=e[11],_=e[12],b=e[13],w=e[14],S=e[15];let T=i[0],E=i[1],O=i[2],R=i[3];return t[0]=T*r+E*a+O*p+R*_,t[1]=T*s+E*l+O*f+R*b,t[2]=T*n+E*c+O*m+R*w,t[3]=T*o+E*h+O*y+R*S,T=i[4],E=i[5],O=i[6],R=i[7],t[4]=T*r+E*a+O*p+R*_,t[5]=T*s+E*l+O*f+R*b,t[6]=T*n+E*c+O*m+R*w,t[7]=T*o+E*h+O*y+R*S,T=i[8],E=i[9],O=i[10],R=i[11],t[8]=T*r+E*a+O*p+R*_,t[9]=T*s+E*l+O*f+R*b,t[10]=T*n+E*c+O*m+R*w,t[11]=T*o+E*h+O*y+R*S,T=i[12],E=i[13],O=i[14],R=i[15],t[12]=T*r+E*a+O*p+R*_,t[13]=T*s+E*l+O*f+R*b,t[14]=T*n+E*c+O*m+R*w,t[15]=T*o+E*h+O*y+R*S,t}function hc(t,e,i){const r=i[0],s=i[1],n=i[2];if(e===t)t[12]=e[0]*r+e[4]*s+e[8]*n+e[12],t[13]=e[1]*r+e[5]*s+e[9]*n+e[13],t[14]=e[2]*r+e[6]*s+e[10]*n+e[14],t[15]=e[3]*r+e[7]*s+e[11]*n+e[15];else{const o=e[0],a=e[1],l=e[2],c=e[3],h=e[4],p=e[5],f=e[6],m=e[7],y=e[8],_=e[9],b=e[10],w=e[11];t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=h,t[5]=p,t[6]=f,t[7]=m,t[8]=y,t[9]=_,t[10]=b,t[11]=w,t[12]=o*r+h*s+y*n+e[12],t[13]=a*r+p*s+_*n+e[13],t[14]=l*r+f*s+b*n+e[14],t[15]=c*r+m*s+w*n+e[15]}return t}function fU(t,e,i){const r=i[0],s=i[1],n=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Wc(t,e,i,r){let s,n,o,a,l,c,h,p,f,m,y,_,b,w,S,T,E,O,R,L,P,F,V,B,G=r[0],te=r[1],se=r[2],ie=Math.sqrt(G*G+te*te+se*se);return ie<Fa()?null:(ie=1/ie,G*=ie,te*=ie,se*=ie,s=Math.sin(i),n=Math.cos(i),o=1-n,a=e[0],l=e[1],c=e[2],h=e[3],p=e[4],f=e[5],m=e[6],y=e[7],_=e[8],b=e[9],w=e[10],S=e[11],T=G*G*o+n,E=te*G*o+se*s,O=se*G*o-te*s,R=G*te*o-se*s,L=te*te*o+n,P=se*te*o+G*s,F=G*se*o+te*s,V=te*se*o-G*s,B=se*se*o+n,t[0]=a*T+p*E+_*O,t[1]=l*T+f*E+b*O,t[2]=c*T+m*E+w*O,t[3]=h*T+y*E+S*O,t[4]=a*R+p*L+_*P,t[5]=l*R+f*L+b*P,t[6]=c*R+m*L+w*P,t[7]=h*R+y*L+S*P,t[8]=a*F+p*V+_*B,t[9]=l*F+f*V+b*B,t[10]=c*F+m*V+w*B,t[11]=h*F+y*V+S*B,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function lC(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*s+c*r,t[5]=o*s+h*r,t[6]=a*s+p*r,t[7]=l*s+f*r,t[8]=c*s-n*r,t[9]=h*s-o*r,t[10]=p*s-a*r,t[11]=f*s-l*r,t}function mU(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[0],o=e[1],a=e[2],l=e[3],c=e[8],h=e[9],p=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s-c*r,t[1]=o*s-h*r,t[2]=a*s-p*r,t[3]=l*s-f*r,t[8]=n*r+c*s,t[9]=o*r+h*s,t[10]=a*r+p*s,t[11]=l*r+f*s,t}function cC(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[0],o=e[1],a=e[2],l=e[3],c=e[4],h=e[5],p=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s+c*r,t[1]=o*s+h*r,t[2]=a*s+p*r,t[3]=l*s+f*r,t[4]=c*s-n*r,t[5]=h*s-o*r,t[6]=p*s-a*r,t[7]=f*s-l*r,t}function gU(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function H8e(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function eh(t,e,i){if(e===0)return _d(t);let r,s,n,o=i[0],a=i[1],l=i[2],c=Math.sqrt(o*o+a*a+l*l);return c<Fa()?null:(c=1/c,o*=c,a*=c,l*=c,r=Math.sin(e),s=Math.cos(e),n=1-s,t[0]=o*o*n+s,t[1]=a*o*n+l*r,t[2]=l*o*n-a*r,t[3]=0,t[4]=o*a*n-l*r,t[5]=a*a*n+s,t[6]=l*a*n+o*r,t[7]=0,t[8]=o*l*n+a*r,t[9]=a*l*n-o*r,t[10]=l*l*n+s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function l_e(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function q8e(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function c_e(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function u_e(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=r+r,l=s+s,c=n+n,h=r*a,p=r*l,f=r*c,m=s*l,y=s*c,_=n*c,b=o*a,w=o*l,S=o*c;return t[0]=1-(m+_),t[1]=p+S,t[2]=f-w,t[3]=0,t[4]=p-S,t[5]=1-(h+_),t[6]=y+b,t[7]=0,t[8]=f+w,t[9]=y-b,t[10]=1-(h+m),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function W8e(t,e){const i=X8e,r=-e[0],s=-e[1],n=-e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=r*r+s*s+n*n+o*o;return p>0?(i[0]=2*(a*o+h*r+l*n-c*s)/p,i[1]=2*(l*o+h*s+c*r-a*n)/p,i[2]=2*(c*o+h*n+a*s-l*r)/p):(i[0]=2*(a*o+h*r+l*n-c*s),i[1]=2*(l*o+h*s+c*r-a*n),i[2]=2*(c*o+h*n+a*s-l*r)),u_e(t,e,i),t}const X8e=M();function Y8e(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function h_e(t,e){const i=e[0],r=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10];return t[0]=Math.sqrt(i*i+r*r+s*s),t[1]=Math.sqrt(n*n+o*o+a*a),t[2]=Math.sqrt(l*l+c*c+h*h),t}function Z8e(t,e){const i=e[0]+e[5]+e[10];let r=0;return i>0?(r=2*Math.sqrt(i+1),t[3]=.25*r,t[0]=(e[6]-e[9])/r,t[1]=(e[8]-e[2])/r,t[2]=(e[1]-e[4])/r):e[0]>e[5]&&e[0]>e[10]?(r=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/r,t[0]=.25*r,t[1]=(e[1]+e[4])/r,t[2]=(e[8]+e[2])/r):e[5]>e[10]?(r=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/r,t[0]=(e[1]+e[4])/r,t[1]=.25*r,t[2]=(e[6]+e[9])/r):(r=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/r,t[0]=(e[8]+e[2])/r,t[1]=(e[6]+e[9])/r,t[2]=.25*r),t}function J8e(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=e[3],l=s+s,c=n+n,h=o+o,p=s*l,f=s*c,m=s*h,y=n*c,_=n*h,b=o*h,w=a*l,S=a*c,T=a*h,E=r[0],O=r[1],R=r[2];return t[0]=(1-(y+b))*E,t[1]=(f+T)*E,t[2]=(m-S)*E,t[3]=0,t[4]=(f-T)*O,t[5]=(1-(p+b))*O,t[6]=(_+w)*O,t[7]=0,t[8]=(m+S)*R,t[9]=(_-w)*R,t[10]=(1-(p+y))*R,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function K8e(t,e,i,r,s){const n=e[0],o=e[1],a=e[2],l=e[3],c=n+n,h=o+o,p=a+a,f=n*c,m=n*h,y=n*p,_=o*h,b=o*p,w=a*p,S=l*c,T=l*h,E=l*p,O=r[0],R=r[1],L=r[2],P=s[0],F=s[1],V=s[2],B=(1-(_+w))*O,G=(m+E)*O,te=(y-T)*O,se=(m-E)*R,ie=(1-(f+w))*R,H=(b+S)*R,$=(y+T)*L,N=(b-S)*L,U=(1-(f+_))*L;return t[0]=B,t[1]=G,t[2]=te,t[3]=0,t[4]=se,t[5]=ie,t[6]=H,t[7]=0,t[8]=$,t[9]=N,t[10]=U,t[11]=0,t[12]=i[0]+P-(B*P+se*F+$*V),t[13]=i[1]+F-(G*P+ie*F+N*V),t[14]=i[2]+V-(te*P+H*F+U*V),t[15]=1,t}function Q8e(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=i+i,a=r+r,l=s+s,c=i*o,h=r*o,p=r*a,f=s*o,m=s*a,y=s*l,_=n*o,b=n*a,w=n*l;return t[0]=1-p-y,t[1]=h+w,t[2]=f-b,t[3]=0,t[4]=h-w,t[5]=1-c-y,t[6]=m+_,t[7]=0,t[8]=f+b,t[9]=m-_,t[10]=1-c-p,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function d_e(t,e,i,r,s,n,o){const a=1/(i-e),l=1/(s-r),c=1/(n-o);return t[0]=2*n*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*n*l,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(s+r)*l,t[10]=(o+n)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*n*2*c,t[15]=0,t}function eVe(t,e,i,r,s){const n=1/Math.tan(e/2);let o;return t[0]=n/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(o=1/(r-s),t[10]=(s+r)*o,t[14]=2*s*r*o):(t[10]=-1,t[14]=-2*r),t}function tVe(t,e,i,r){const s=Math.tan(e.upDegrees*Math.PI/180),n=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+n);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*l*.5,t[9]=(s-n)*c*.5,t[10]=r/(i-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*i/(i-r),t[15]=0,t}function p_e(t,e,i,r,s,n,o){const a=1/(e-i),l=1/(r-s),c=1/(n-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*a,t[13]=(s+r)*l,t[14]=(o+n)*c,t[15]=1,t}function yU(t,e,i,r){let s,n,o,a,l,c,h,p,f,m;const y=e[0],_=e[1],b=e[2],w=r[0],S=r[1],T=r[2],E=i[0],O=i[1],R=i[2],L=Fa();return Math.abs(y-E)<L&&Math.abs(_-O)<L&&Math.abs(b-R)<L?_d(t):(h=y-E,p=_-O,f=b-R,m=1/Math.sqrt(h*h+p*p+f*f),h*=m,p*=m,f*=m,s=S*f-T*p,n=T*h-w*f,o=w*p-S*h,m=Math.sqrt(s*s+n*n+o*o),m?(m=1/m,s*=m,n*=m,o*=m):(s=0,n=0,o=0),a=p*o-f*n,l=f*s-h*o,c=h*n-p*s,m=Math.sqrt(a*a+l*l+c*c),m?(m=1/m,a*=m,l*=m,c*=m):(a=0,l=0,c=0),t[0]=s,t[1]=a,t[2]=h,t[3]=0,t[4]=n,t[5]=l,t[6]=p,t[7]=0,t[8]=o,t[9]=c,t[10]=f,t[11]=0,t[12]=-(s*y+n*_+o*b),t[13]=-(a*y+l*_+c*b),t[14]=-(h*y+p*_+f*b),t[15]=1,t)}function f_e(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=r[0],l=r[1],c=r[2];let h=s-i[0],p=n-i[1],f=o-i[2],m=h*h+p*p+f*f;m>0&&(m=1/Math.sqrt(m),h*=m,p*=m,f*=m);let y=l*f-c*p,_=c*h-a*f,b=a*p-l*h;return m=y*y+_*_+b*b,m>0&&(m=1/Math.sqrt(m),y*=m,_*=m,b*=m),t[0]=y,t[1]=_,t[2]=b,t[3]=0,t[4]=p*b-f*_,t[5]=f*y-h*b,t[6]=h*_-p*y,t[7]=0,t[8]=h,t[9]=p,t[10]=f,t[11]=0,t[12]=s,t[13]=n,t[14]=o,t[15]=1,t}function iVe(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function rVe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function sVe(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t}function m_e(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}function nVe(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t}function oVe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t[9]=e[9]+i[9]*r,t[10]=e[10]+i[10]*r,t[11]=e[11]+i[11]*r,t[12]=e[12]+i[12]*r,t[13]=e[13]+i[13]*r,t[14]=e[14]+i[14]*r,t[15]=e[15]+i[15]*r,t}function g_e(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function QZ(t,e){if(t===e)return!0;const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],m=t[11],y=t[12],_=t[13],b=t[14],w=t[15],S=e[0],T=e[1],E=e[2],O=e[3],R=e[4],L=e[5],P=e[6],F=e[7],V=e[8],B=e[9],G=e[10],te=e[11],se=e[12],ie=e[13],H=e[14],$=e[15],N=Fa();return Math.abs(i-S)<=N*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(r-T)<=N*Math.max(1,Math.abs(r),Math.abs(T))&&Math.abs(s-E)<=N*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(n-O)<=N*Math.max(1,Math.abs(n),Math.abs(O))&&Math.abs(o-R)<=N*Math.max(1,Math.abs(o),Math.abs(R))&&Math.abs(a-L)<=N*Math.max(1,Math.abs(a),Math.abs(L))&&Math.abs(l-P)<=N*Math.max(1,Math.abs(l),Math.abs(P))&&Math.abs(c-F)<=N*Math.max(1,Math.abs(c),Math.abs(F))&&Math.abs(h-V)<=N*Math.max(1,Math.abs(h),Math.abs(V))&&Math.abs(p-B)<=N*Math.max(1,Math.abs(p),Math.abs(B))&&Math.abs(f-G)<=N*Math.max(1,Math.abs(f),Math.abs(G))&&Math.abs(m-te)<=N*Math.max(1,Math.abs(m),Math.abs(te))&&Math.abs(y-se)<=N*Math.max(1,Math.abs(y),Math.abs(se))&&Math.abs(_-ie)<=N*Math.max(1,Math.abs(_),Math.abs(ie))&&Math.abs(b-H)<=N*Math.max(1,Math.abs(b),Math.abs(H))&&Math.abs(w-$)<=N*Math.max(1,Math.abs(w),Math.abs($))}function eJ(t){const e=Fa(),i=t[0],r=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10];return Math.abs(1-(i*i+n*n+l*l))<=e&&Math.abs(1-(r*r+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+h*h))<=e}function _U(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const aVe=Ts,lVe=m_e;Object.freeze(Object.defineProperty({__proto__:null,add:sVe,adjoint:G8e,copy:Xn,determinant:j8e,equals:QZ,exactEquals:g_e,frob:rVe,fromQuat:Q8e,fromQuat2:W8e,fromRotation:eh,fromRotationTranslation:u_e,fromRotationTranslationScale:J8e,fromRotationTranslationScaleOrigin:K8e,fromScaling:H8e,fromTranslation:gU,fromXRotation:l_e,fromYRotation:q8e,fromZRotation:c_e,frustum:d_e,getRotation:Z8e,getScaling:h_e,getTranslation:Y8e,hasIdentityRotation:_U,identity:_d,invert:Go,invertOrIdentity:rA,isOrthoNormal:eJ,lookAt:yU,mul:aVe,multiply:Ts,multiplyScalar:nVe,multiplyScalarAndAdd:oVe,ortho:p_e,perspective:eVe,perspectiveFromFieldOfView:tVe,rotate:Wc,rotateX:lC,rotateY:mU,rotateZ:cC,scale:fU,set:eg,str:iVe,sub:lVe,subtract:m_e,targetTo:f_e,translate:hc,transpose:tu},Symbol.toStringTag,{value:"Module"}));let VV,ce=null;function y_e(){return!!ce}function cVe(){return!!de("esri-wasm")}function __e(){return VV||(VV=ee(()=>import("./pe-wasm-815c1904.js"),[],import.meta.url).then(t=>t.p).then(({default:t})=>t({locateFile:e=>ir(`esri/geometry/support/${e}`)})).then(t=>{b_e(t)}),VV)}var qG,Ws,WG;(function(t){function e(n,o,a){ce.ensureCache.prepare();const l=Cw(a),c=a===l,h=ce.ensureFloat64(l),p=ce._pe_geog_to_proj(ce.getPointer(n),o,h);return p&&sv(a,o,h,c),p}function i(n,o,a,l){switch(l){case Ws.PE_TRANSFORM_P_TO_G:return r(n,o,a);case Ws.PE_TRANSFORM_G_TO_P:return e(n,o,a)}return 0}function r(n,o,a){return s(n,o,a,0)}function s(n,o,a,l){ce.ensureCache.prepare();const c=Cw(a),h=a===c,p=ce.ensureFloat64(c),f=ce._pe_proj_to_geog_center(ce.getPointer(n),o,p,l);return f&&sv(a,o,p,h),f}t.geogToProj=e,t.projGeog=i,t.projToGeog=r,t.projToGeogCenter=s})(qG||(qG={})),function(t){function e(){t.PE_BUFFER_MAX=ce.PeDefs.prototype.PE_BUFFER_MAX,t.PE_NAME_MAX=ce.PeDefs.prototype.PE_NAME_MAX,t.PE_MGRS_MAX=ce.PeDefs.prototype.PE_MGRS_MAX,t.PE_USNG_MAX=ce.PeDefs.prototype.PE_USNG_MAX,t.PE_DD_MAX=ce.PeDefs.prototype.PE_DD_MAX,t.PE_DDM_MAX=ce.PeDefs.prototype.PE_DDM_MAX,t.PE_DMS_MAX=ce.PeDefs.prototype.PE_DMS_MAX,t.PE_UTM_MAX=ce.PeDefs.prototype.PE_UTM_MAX,t.PE_PARM_MAX=ce.PeDefs.prototype.PE_PARM_MAX,t.PE_TYPE_NONE=ce.PeDefs.prototype.PE_TYPE_NONE,t.PE_TYPE_GEOGCS=ce.PeDefs.prototype.PE_TYPE_GEOGCS,t.PE_TYPE_PROJCS=ce.PeDefs.prototype.PE_TYPE_PROJCS,t.PE_TYPE_GEOGTRAN=ce.PeDefs.prototype.PE_TYPE_GEOGTRAN,t.PE_TYPE_COORDSYS=ce.PeDefs.prototype.PE_TYPE_COORDSYS,t.PE_TYPE_UNIT=ce.PeDefs.prototype.PE_TYPE_UNIT,t.PE_TYPE_LINUNIT=ce.PeDefs.prototype.PE_TYPE_LINUNIT,t.PE_STR_OPTS_NONE=ce.PeDefs.prototype.PE_STR_OPTS_NONE,t.PE_STR_AUTH_NONE=ce.PeDefs.prototype.PE_STR_AUTH_NONE,t.PE_STR_AUTH_TOP=ce.PeDefs.prototype.PE_STR_AUTH_TOP,t.PE_STR_NAME_CANON=ce.PeDefs.prototype.PE_STR_NAME_CANON,t.PE_PARM_X0=ce.PeDefs.prototype.PE_PARM_X0,t.PE_PARM_ND=ce.PeDefs.prototype.PE_PARM_ND,t.PE_TRANSFORM_1_TO_2=ce.PeDefs.prototype.PE_TRANSFORM_1_TO_2,t.PE_TRANSFORM_2_TO_1=ce.PeDefs.prototype.PE_TRANSFORM_2_TO_1,t.PE_TRANSFORM_P_TO_G=ce.PeDefs.prototype.PE_TRANSFORM_P_TO_G,t.PE_TRANSFORM_G_TO_P=ce.PeDefs.prototype.PE_TRANSFORM_G_TO_P,t.PE_HORIZON_RECT=ce.PeDefs.prototype.PE_HORIZON_RECT,t.PE_HORIZON_POLY=ce.PeDefs.prototype.PE_HORIZON_POLY,t.PE_HORIZON_LINE=ce.PeDefs.prototype.PE_HORIZON_LINE,t.PE_HORIZON_DELTA=ce.PeDefs.prototype.PE_HORIZON_DELTA}t.init=e}(Ws||(Ws={})),function(t){const e={},i={},r=m=>{if(m){const y=m.getType();switch(y){case Ws.PE_TYPE_GEOGCS:m=ce.castObject(m,ce.PeGeogcs);break;case Ws.PE_TYPE_PROJCS:m=ce.castObject(m,ce.PeProjcs);break;case Ws.PE_TYPE_GEOGTRAN:m=ce.castObject(m,ce.PeGeogtran);break;default:y&Ws.PE_TYPE_UNIT&&(m=ce.castObject(m,ce.PeUnit))}}return m};function s(){ce.PeFactory.prototype.initialize(null)}function n(m){return o(Ws.PE_TYPE_COORDSYS,m)}function o(m,y){let _=null,b=e[m];if(b||(b={},e[m]=b),b.hasOwnProperty(String(y)))_=b[y];else{const w=ce.PeFactory.prototype.factoryByType(m,y);ce.compare(w,ce.NULL)||(_=w,b[y]=_)}return _=r(_),_}function a(m,y){let _=null,b=i[m];if(b||(b={},i[m]=b),b.hasOwnProperty(y))_=b[y];else{const w=ce.PeFactory.prototype.fromString(m,y);ce.compare(w,ce.NULL)||(_=w,b[y]=_)}return _=r(_),_}function l(m){return o(Ws.PE_TYPE_GEOGCS,m)}function c(m){return o(Ws.PE_TYPE_GEOGTRAN,m)}function h(m){return ce.PeFactory.prototype.getCode(m)}function p(m){return o(Ws.PE_TYPE_PROJCS,m)}function f(m){return o(Ws.PE_TYPE_UNIT,m)}t.initialize=s,t.coordsys=n,t.factoryByType=o,t.fromString=a,t.geogcs=l,t.geogtran=c,t.getCode=h,t.projcs=p,t.unit=f}(WG||(WG={}));let v_e=null;var $4,XG,YG,ZG,L4,JG,D4,N4,KG;function b_e(t){function e(n,o,a){n[o]=a(n[o])}ce=t,Ws.init(),$4.init(),L4.init(),D4.init(),N4.init(),v_e=class extends ce.PeGCSExtent{destroy(){ce.destroy(this)}};const i=[ce.PeDatum,ce.PeGeogcs,ce.PeGeogtran,ce.PeObject,ce.PeParameter,ce.PePrimem,ce.PeProjcs,ce.PeSpheroid,ce.PeUnit];for(const n of i)e(n.prototype,"getName",o=>function(){return o.call(this,new Array(Ws.PE_NAME_MAX))});for(const n of[ce.PeGeogtran,ce.PeProjcs])e(n.prototype,"getParameters",o=>function(){const a=new Array(Ws.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const h=ce.getValue(l,"*");a[c]=h?ce.wrapPointer(h,ce.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});e(ce.PeHorizon.prototype,"getCoord",n=>function(){const o=this.getSize();if(!o)return null;const a=[];return sv(a,o,n.call(this)),a}),e(ce.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const o=ce._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=n.call(this);if(!ce.compare(l,ce.NULL)){a=[l];const c=this.getSteps();if(c>1){const h=ce.getPointer(l);for(let p=1;p<c;p++)a.push(ce.wrapPointer(h+o*p,ce.PeGTlistExtendedGTs))}}return a}});const r=ce._pe_getPeHorizonSize(),s=n=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(n))return o.get(n);let a=null;const l=n.call(this);if(!ce.compare(l,ce.NULL)){a=[l];const c=l.getNump();if(c>1){const h=ce.getPointer(l);for(let p=1;p<c;p++)a.push(ce.wrapPointer(h+r*p,ce.PeHorizon))}}return o.set(n,a),a};e(ce.PeProjcs.prototype,"horizonGcsGenerate",s),e(ce.PeProjcs.prototype,"horizonPcsGenerate",s),ce.PeObject.prototype.toString=function(n=Ws.PE_STR_OPTS_NONE){ce.ensureCache.prepare();const o=ce.getPointer(this),a=ce.ensureInt8(new Array(Ws.PE_BUFFER_MAX));return ce.UTF8ToString(ce._pe_object_to_string_ext(o,n,a))}}function dg(t){if(!t)return;const e=ce.getClass(t);if(!e)return;const i=ce.getCache(e);if(!i)return;const r=ce.getPointer(t);r&&delete i[r]}function p$(t,e){const i=[],r=new Array(e);for(let s=0;s<t;s++)i.push(ce.ensureInt8(r));return i}function Cw(t){let e;return Array.isArray(t[0])?(e=[],t.forEach(i=>{e.push(i[0],i[1])})):e=t,e}function sv(t,e,i,r=!1){if(r)for(let s=0;s<2*e;s++)t[s]=ce.getValue(i+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=t.length===0;for(let n=0;n<e;n++)s&&(t[n]=new Array(2)),t[n][0]=ce.getValue(i,"double"),t[n][1]=ce.getValue(i+Float64Array.BYTES_PER_ELEMENT,"double"),i+=2*Float64Array.BYTES_PER_ELEMENT}}(function(t){let e;function i(){t.PE_GTLIST_OPTS_COMMON=ce.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,e=ce._pe_getPeGTlistExtendedEntrySize()}function r(s,n,o,a,l,c){let h=null;const p=new ce.PeInteger(c);try{const f=ce.PeGTlistExtended.prototype.getGTlist(s,n,o,a,l,p);if((c=p.val)&&(h=[f],c>1)){const m=ce.getPointer(f);for(let y=1;y<c;y++)h.push(ce.wrapPointer(m+e*y,ce.PeGTlistExtendedEntry))}}finally{ce.destroy(p)}return h}t.init=i,t.getGTlist=r})($4||($4={})),function(t){function e(i){if(i&&i.length){for(const r of i)dg(r),r.getEntries().forEach(s=>{dg(s);const n=s.getGeogtran();dg(n),n.getParameters().forEach(dg),[n.getGeogcs1(),n.getGeogcs2()].forEach(o=>{dg(o);const a=o.getDatum();dg(a),dg(a.getSpheroid()),dg(o.getPrimem()),dg(o.getUnit())})});ce.PeGTlistExtendedEntry.prototype.Delete(i[0])}}t.destroy=e}(XG||(XG={})),function(t){function e(i,r,s,n,o){ce.ensureCache.prepare();const a=Cw(s),l=s===a,c=ce.ensureFloat64(a);let h=0;n&&(h=ce.ensureFloat64(n));const p=ce._pe_geog_to_geog(ce.getPointer(i),r,c,h,o);return p&&sv(s,r,c,l),p}t.geogToGeog=e}(YG||(YG={})),function(t){const e=(c,h,p,f,m,y)=>{let _,b;switch(ce.ensureCache.prepare(),c){case"dd":_=ce._pe_geog_to_dd,b=Ws.PE_DD_MAX;break;case"ddm":_=ce._pe_geog_to_ddm,b=Ws.PE_DDM_MAX;break;case"dms":_=ce._pe_geog_to_dms,b=Ws.PE_DMS_MAX}let w=0;h&&(w=ce.getPointer(h));const S=Cw(f),T=ce.ensureFloat64(S),E=p$(p,b),O=_(w,p,T,m,ce.ensureInt32(E));if(O)for(let R=0;R<p;R++)y[R]=ce.UTF8ToString(E[R]);return O},i=(c,h,p,f,m)=>{let y;switch(ce.ensureCache.prepare(),c){case"dd":y=ce._pe_dd_to_geog;break;case"ddm":y=ce._pe_ddm_to_geog;break;case"dms":y=ce._pe_dms_to_geog}let _=0;h&&(_=ce.getPointer(h));const b=f.map(E=>ce.ensureString(E)),w=ce.ensureInt32(b),S=ce.ensureFloat64(new Array(2*p)),T=y(_,p,w,S);return T&&sv(m,p,S),T};function r(c,h,p,f,m){return e("dms",c,h,p,f,m)}function s(c,h,p,f){return i("dms",c,h,p,f)}function n(c,h,p,f,m){return e("ddm",c,h,p,f,m)}function o(c,h,p,f){return i("ddm",c,h,p,f)}function a(c,h,p,f,m){return e("dd",c,h,p,f,m)}function l(c,h,p,f){return i("dd",c,h,p,f)}t.geogToDms=r,t.dmsToGeog=s,t.geogToDdm=n,t.ddmToGeog=o,t.geogToDd=a,t.ddToGeog=l}(ZG||(ZG={})),function(t){function e(){t.PE_MGRS_STYLE_NEW=ce.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,t.PE_MGRS_STYLE_OLD=ce.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,t.PE_MGRS_STYLE_AUTO=ce.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,t.PE_MGRS_180_ZONE_1_PLUS=ce.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,t.PE_MGRS_ADD_SPACES=ce.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function i(s,n,o,a,l,c,h){ce.ensureCache.prepare();let p=0;s&&(p=ce.getPointer(s));const f=Cw(o),m=ce.ensureFloat64(f),y=p$(n,Ws.PE_MGRS_MAX),_=ce.ensureInt32(y),b=ce._pe_geog_to_mgrs_extended(p,n,m,a,l,c,_);if(b)for(let w=0;w<n;w++)h[w]=ce.UTF8ToString(y[w]);return b}function r(s,n,o,a,l){ce.ensureCache.prepare();let c=0;s&&(c=ce.getPointer(s));const h=o.map(y=>ce.ensureString(y)),p=ce.ensureInt32(h),f=ce.ensureFloat64(new Array(2*n)),m=ce._pe_mgrs_to_geog_extended(c,n,p,a,f);return m&&sv(l,n,f),m}t.init=e,t.geogToMgrsExtended=i,t.mgrsToGeogExtended=r}(L4||(L4={})),function(t){function e(r,s,n,o,a,l,c){ce.ensureCache.prepare();let h=0;r&&(h=ce.getPointer(r));const p=Cw(n),f=ce.ensureFloat64(p),m=p$(s,Ws.PE_MGRS_MAX),y=ce.ensureInt32(m),_=ce._pe_geog_to_usng(h,s,f,o,a,l,y);if(_)for(let b=0;b<s;b++)c[b]=ce.UTF8ToString(m[b]);return _}function i(r,s,n,o){ce.ensureCache.prepare();let a=0;r&&(a=ce.getPointer(r));const l=n.map(f=>ce.ensureString(f)),c=ce.ensureInt32(l),h=ce.ensureFloat64(new Array(2*s)),p=ce._pe_usng_to_geog(a,s,c,h);return p&&sv(o,s,h),p}t.geogToUsng=e,t.usngToGeog=i}(JG||(JG={})),function(t){function e(){t.PE_UTM_OPTS_NONE=ce.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,t.PE_UTM_OPTS_ADD_SPACES=ce.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,t.PE_UTM_OPTS_NS=ce.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function i(s,n,o,a,l){ce.ensureCache.prepare();let c=0;s&&(c=ce.getPointer(s));const h=Cw(o),p=ce.ensureFloat64(h),f=p$(n,Ws.PE_UTM_MAX),m=ce.ensureInt32(f),y=ce._pe_geog_to_utm(c,n,p,a,m);if(y)for(let _=0;_<n;_++)l[_]=ce.UTF8ToString(f[_]);return y}function r(s,n,o,a,l){ce.ensureCache.prepare();let c=0;s&&(c=ce.getPointer(s));const h=o.map(y=>ce.ensureString(y)),p=ce.ensureInt32(h),f=ce.ensureFloat64(new Array(2*n)),m=ce._pe_utm_to_geog(c,n,p,a,f);return m&&sv(l,n,f),m}t.init=e,t.geogToUtm=i,t.utmToGeog=r}(D4||(D4={})),function(t){const e=new Map;function i(){t.PE_PCSINFO_OPTION_NONE=ce.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,t.PE_PCSINFO_OPTION_DOMAIN=ce.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,t.PE_POLE_OUTSIDE_BOUNDARY=ce.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,t.PE_POLE_POINT=ce.PePCSInfo.prototype.PE_POLE_POINT}function r(s,n=t.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return e.has(s)&&(a=e.get(s),a[n]&&(o=a[n])),o||(o=ce.PePCSInfo.prototype.generate(s,n),a||(a=[],e.set(s,a)),a[n]=o),o}t.init=i,t.generate=r}(N4||(N4={})),function(t){function e(){return ce.PeVersion.prototype.version_string()}t.versionString=e}(KG||(KG={}));const uVe=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return qG},get PeDefs(){return Ws},get PeFactory(){return WG},get PeGCSExtent(){return v_e},get PeGTTransformations(){return YG},get PeGTlistExtended(){return $4},get PeGTlistExtendedEntry(){return XG},get PeNotationDms(){return ZG},get PeNotationMgrs(){return L4},get PeNotationUsng(){return JG},get PeNotationUtm(){return D4},get PePCSInfo(){return N4},get PeVersion(){return KG},_init:b_e,get _pe(){return ce},isLoaded:y_e,isSupported:cVe,load:__e},Symbol.toStringTag,{value:"Module"})),i3t=Math.PI/180,r3t=/SPHEROID\[([^\]]+)]/i,P0=Oi.radius,$d=Oi.eccentricitySquared,hVe={a1:P0*$d,a2:P0*$d*P0*$d,a3:P0*$d*$d/2,a4:P0*$d*P0*$d*2.5,a5:P0*$d+P0*$d*$d/2,a6:1-$d},s3t={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:Oi.radius,f:Oi.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:zy.radius,f:zy.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:Em.radius,f:Em.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:Em.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};let f$=0,kV=class QG{static fromGE(e){const i=new QG;return i._wkt=e.wkt,i._wkid=e.wkid,i._isInverse=e.isInverse,i}constructor(e){this.uid=f$++,e?(this._wkt=e.wkt!=null?e.wkt:null,this._wkid=e.wkid!=null?e.wkid:-1,this._isInverse=e.isInverse!=null&&e.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=f$++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=f$++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=f$++}getInverse(){const e=new QG;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}},ej=class fR{static cacheKey(e,i){return[e.wkid!==void 0&&e.wkid!==null?e.wkid.toString():"-1",e.wkt!==void 0&&e.wkt!==null?e.wkt.toString():"",i.wkid!==void 0&&i.wkid!==null?i.wkid.toString():"-1",i.wkt!==void 0&&i.wkt!==null?i.wkt.toString():""].join(",")}static fromGE(e){const i=new fR;let r="";for(const s of e.steps){const n=kV.fromGE(s);i.steps.push(n),r+=n.uid.toString()+","}return i._cachedProjection={},i._gtlistentry=null,i._chain=r,i}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e&&e.steps)for(const i of e.steps)i instanceof kV?this.steps.push(i):this.steps.push(new kV({wkid:i.wkid,wkt:i.wkt,isInverse:i.isInverse}))}getInverse(){const e=new fR;e.steps=[];for(let i=this.steps.length-1;i>=0;i--){const r=this.steps[i];e.steps.push(r.getInverse())}return e}getGTListEntry(){let e="";for(const i of this.steps)e+=i.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,i,r){this._cachedProjection[fR.cacheKey(e,i)]=r}getCachedGeTransformation(e,i){let r="";for(const n of this.steps)r+=n.uid.toString()+",";r!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=r);const s=this._cachedProjection[fR.cacheKey(e,i)];return s===void 0?null:s}};function w_e(t,e,i){if(C(e)||C(i)||i.vcsWkid||rn(e,i))return null;const r=wx(e)/wx(i);if(r===1)return null;switch(t){case"point":case"esriGeometryPoint":return s=>dVe(s,r);case"polyline":case"esriGeometryPolyline":return s=>fVe(s,r);case"polygon":case"esriGeometryPolygon":return s=>pVe(s,r);case"multipoint":case"esriGeometryMultipoint":return s=>mVe(s,r);case"extent":case"esriGeometryExtent":return s=>gVe(s,r);default:return null}}function dVe(t,e){t&&t.z!=null&&(t.z*=e)}function pVe(t,e){if(t)for(const i of t.rings)for(const r of i)r.length>2&&(r[2]*=e)}function fVe(t,e){if(t)for(const i of t.paths)for(const r of i)r.length>2&&(r[2]*=e)}function mVe(t,e){if(t)for(const i of t.points)i.length>2&&(i[2]*=e)}function gVe(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}let Dv=null,H3=null,BV=null,zV={};const x_e=new gZ;function Mx(){return!!Dv&&y_e()}function Px(t){return C(BV)&&(BV=Promise.all([__e(),ee(()=>import("./geometryEngineBase-e1a33b0a.js"),[],import.meta.url).then(e=>e.g),ee(()=>import("./hydrated-42ff4796.js"),[],import.meta.url)])),BV.then(([,e,{hydratedAdapter:i}])=>{gi(t),H3=i,Dv=e.default,Dv._enableProjection(uVe),x_e.notify()})}function tg(t,e,i=null,r=null){return Array.isArray(t)?t.length===0?[]:pre(H3,t,t[0].spatialReference,e,i,r):pre(H3,[t],t.spatialReference,e,i,r)[0]}function pre(t,e,i,r,s=null,n=null){if(C(i)||C(r))return e;if(jm(i,r,s))return e.map(o=>T_e(o,i,r));if(C(s)){const o=ej.cacheKey(i,r);zV[o]!==void 0?s=zV[o]:(s=_Ve(i,r,void 0),C(s)&&(s=new ej),zV[o]=s)}if(C(Dv)||C(t))throw new tJ;return v(n)?Dv._project(t,e,i,r,s,n):Dv._project(t,e,i,r,s)}function n3t(t,e){const i=yVe([t],e);return v(i.pending)?{pending:i.pending,geometry:null}:v(i.geometries)?{pending:null,geometry:i.geometries[0]}:{pending:null,geometry:null}}function yVe(t,e){if(!Mx()){for(const i of t)if(v(i)&&!rn(i.spatialReference,e)&&sa(i.spatialReference)&&sa(e)&&!jm(i.spatialReference,e))return Ai(x_e),{pending:Px(),geometries:null}}return{pending:null,geometries:t.map(i=>C(i)?null:rn(i.spatialReference,e)?i:sa(i.spatialReference)&&sa(e)?vVe(i,e):null)}}function _Ve(t,e,i=null){if(C(t)||C(e))return null;if(C(Dv)||C(H3))throw new tJ;const r=Dv._getTransformation(H3,t,e,i,i==null?void 0:i.spatialReference);return r!==null?ej.fromGE(r):null}class tJ extends W{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var K;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",t[t.WGS84=2]="WGS84",t[t.WEB_MERCATOR=3]="WEB_MERCATOR",t[t.WGS84_ECEF=4]="WGS84_ECEF",t[t.CGCS2000=5]="CGCS2000",t[t.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",t[t.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",t[t.GCSMARS2000=8]="GCSMARS2000",t[t.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",t[t.GCSMOON2000=10]="GCSMOON2000",t[t.LON_LAT=11]="LON_LAT",t[t.PLATE_CARREE=12]="PLATE_CARREE"})(K||(K={}));function vVe(t,e){try{const i=tg(t,e);if(i==null)return null;"xmin"in t&&"xmin"in i&&(i.zmin=t.zmin,i.zmax=t.zmax);const r=w_e(i.type,t.spatialReference,e);return v(r)&&r(i),i}catch(i){if(!(i instanceof tJ))throw i;return null}}function jm(t,e,i){return!i&&(!!rn(t,e)||sa(t)&&sa(e)&&!!nJ(t,e,aJ))}async function bVe(t,e,i,r){if(Mx())return nie(r);if(Array.isArray(t)){for(const{source:s,dest:n,geographicTransformation:o}of t)if(!jm(s,n,o))return Px(r)}else if(!jm(t,e,i))return Px(r);return nie(r)}function o3t(t,e){switch(nJ(t,e,aJ)){case Fr:return"copy3";case vv:return"wgs84ToSphericalECEF";case Ix:return"wgs84ToWebMercator";case _v:return"wgs84ToPlateCarree";case wv:return"wgs84ToWGS84ECEF";case ox:return"webMercatorToWGS84";case R_e:return"webMercatorToSphericalECEF";case M_e:return"webMercatorToWGS84ECEF";case P_e:return"webMercatorToPlateCarree";case xv:return"wgs84ECEFToWGS84";case L_e:return"wgs84ECEFToSphericalECEF";case D_e:return"wgs84ECEFToWebMercator";case bv:return"sphericalECEFToWGS84";case I_e:return"sphericalECEFToWebMercator";case sj:return"sphericalMarsPCPFToMars2000";case rj:return"sphericalMoonPCPFToMoon2000";case $_e:return"sphericalECEFToWGS84ECEF";case ij:return"mars2000ToSphericalPCPF";case tj:return"moon2000ToSphericalPCPF";default:return null}}function T_e(t,e,i){return t?"x"in t?S_e(t,e,new pt,i,0):"xmin"in t?SVe(t,e,new Pi,i,0):"rings"in t?E_e(t,e,new md,i,0):"paths"in t?TVe(t,e,new Rp,i,0):"points"in t?xVe(t,e,new ZP,i,0):null:null}function wVe(t,e,i=e.spatialReference,r=0){return v(i)&&v(t.spatialReference)&&v(S_e(t,t.spatialReference,e,i,r))}function S_e(t,e,i,r,s){or[0]=t.x,or[1]=t.y;const n=t.z;return or[2]=n!==void 0?n:s,Es(or,e,0,or,r,0,1)?(i.x=or[0],i.y=or[1],i.spatialReference=r,n===void 0?(i.z=void 0,i.hasZ=!1):(i.z=or[2],i.hasZ=!0),t.m===void 0?(i.m=void 0,i.hasM=!1):(i.m=t.m,i.hasM=!0),i):null}function xVe(t,e,i,r,s){const{points:n,hasZ:o,hasM:a}=t,l=[],c=n.length,h=[];for(const p of n)h.push(p[0],p[1],o?p[2]:s);if(!Es(h,e,0,h,r,0,c))return null;for(let p=0;p<c;++p){const f=3*p,m=h[f],y=h[f+1];o&&a?l.push([m,y,h[f+2],n[p][3]]):o?l.push([m,y,h[f+2]]):a?l.push([m,y,n[p][2]]):l.push([m,y])}return i.points=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i}function TVe(t,e,i,r,s){const{paths:n,hasZ:o,hasM:a}=t,l=[];return A_e(n,o??!1,a??!1,e,l,r,s)?(i.paths=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i):null}function a3t(t,e,i=e.spatialReference,r=0){return v(t.spatialReference)&&v(i)&&v(E_e(t,t.spatialReference,e,i,r))}function E_e(t,e,i,r,s){const{rings:n,hasZ:o,hasM:a}=t,l=[];return A_e(n,o??!1,a??!1,e,l,r,s)?(i.rings=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i):null}function SVe(t,e,i,r,s){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:h}=t;return fre(n,o,c?t.zmin:s,e,or,r)?(i.xmin=or[0],i.ymin=or[1],c&&(i.zmin=or[2]),fre(a,l,c?t.zmax:s,e,or,r)?(i.xmax=or[0],i.ymax=or[1],c&&(i.zmax=or[2]),h&&(i.mmin=t.mmin,i.mmax=t.mmax),i.spatialReference=r,i):null):null}function Kv(t,e,i){if(C(e)||C(i))return null;const r=new pt({spatialReference:i});return Es(t,e,0,or,i,0,1)?(r.x=or[0],r.y=or[1],r.z=or[2],r):null}function C_e(t,e,i){return Es(t,e,0,or,i.spatialReference,0,1)?(i.x=or[0],i.y=or[1],i.z=or[2],i):null}function da(t,e,i,r=0){or[0]=t.x,or[1]=t.y;const s=t.z;return or[2]=s!==void 0?s:r,Es(or,t.spatialReference,0,e,i,0,1)}function fre(t,e,i,r,s,n){return bs[0]=t,bs[1]=e,bs[2]=i,Es(bs,r,0,s,n,0,1)}function _o(t,e,i,r){return!(C(e)||C(r)||t.length<2)&&(t.length===2&&(bs[0]=t[0],bs[1]=t[1],bs[2]=0,t=bs),Es(t,e,0,i,r,0,1))}function EVe(t,e){or[0]=t.x,or[1]=t.y;const i=t.z;return or[2]=i!==void 0?i:0,CVe(or,t.spatialReference,e)}function CVe(t,e,i){return AVe(t,e,i)}function AVe(t,e,i){if(C(e))return!1;const r=Qv(e,bU),s=vm[r][K.WGS84_COMPARABLE_LON_LAT];return!C(s)&&(s(t,0,bs,0),i!==bs&&(i[0]=bs[0],i[1]=bs[1],i.length>2&&(i[2]=bs[2])),!0)}function Es(t,e,i,r,s,n,o=1){const a=nJ(e,s,aJ);if(C(a))return!1;if(a===Fr){if(t===r&&i===n)return!0;const c=i+3*o;for(let h=i,p=n;h<c;h++,p++)r[p]=t[h];return!0}const l=i+3*o;for(let c=i,h=n;c<l;c+=3,h+=3)a(t,c,r,h);return!0}function l3t(t,e,i,r,s){he(or,t),ve(m$,t,e),_o(or,i,or,s),_o(m$,i,m$,s),be(r,m$,or),Oe(r,r)}function A_e(t,e,i,r,s,n,o=0){const a=new Array;for(const c of t)for(const h of c)a.push(h[0],h[1],e?h[2]:o);if(!Es(a,r,0,a,n,0,a.length/3))return!1;let l=0;s.length=0;for(const c of t){const h=new Array;for(const p of c)e&&i?h.push([a[l++],a[l++],a[l++],p[3]]):e?h.push([a[l++],a[l++],a[l++]]):i?(h.push([a[l++],a[l++],p[2]]),l++):(h.push([a[l++],a[l++]]),l++);s.push(h)}return!0}function c3t(t,e,i,r){if(C(e)||C(r))return!1;const s=N_e(e,r,NVe);if(s.projector===Fr)return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],!0;if(C(s.projector))return!1;const{source:n,dest:o}=s;if(o.spatialReferenceId===K.WEB_MERCATOR){const a=vm[n.spatialReferenceId][K.WGS84];return!C(a)&&(a(t,0,fp,0),Ix(fp,0,i,0),i[3]=mre(fp[1],t[2],t[3],Oi.radius),!0)}if(n.spatialReferenceId!==K.WGS84&&n.spatialReferenceId!==K.CGCS2000||o.spatialReferenceId!==K.PLATE_CARREE){s.projector(t,0,i,0);const a=n.metersPerUnit??1,l=o.metersPerUnit??1;i[3]=t[3]*a/l}else{const a=vm[n.spatialReferenceId][K.SPHERICAL_ECEF],l=vm[K.SPHERICAL_ECEF][K.PLATE_CARREE];let c=t[3];v(a)&&v(l)&&(c=mre(t[1],t[2],t[3],Oi.radius)),s.projector(t,0,i,0),i[3]=c}return!0}function mre(t,e,i,r){const s=r+e;if(s<r/2||i>s)return Number.MAX_VALUE;const n=Math.abs($p*t)+Math.asin(i/s);return n>=Math.PI/2?Number.MAX_VALUE:i/Math.cos(n)}function vU(t,e,i,r){return t!=null&&(rn(e,r)?(jy(i,t),!0):(bs[0]=t[0],bs[1]=t[1],bs[2]=0,!!Es(bs,e,0,bs,r,0,1)&&(i[0]=bs[0],i[1]=bs[1],bs[0]=t[2],bs[1]=t[3],bs[2]=0,!!Es(bs,e,0,bs,r,0,1)&&(i[2]=bs[0],i[3]=bs[1],!0))))}function u3t(t,e,i,r){if(C(e)||C(r))return!1;const s=Qv(e,bU),n=Qv(r,F_e);if(s===n&&s!==K.UNKNOWN||rn(e,r))return i[0]=1,i[1]=1,i[2]=1,!0;if(s===K.SPHERICAL_ECEF){const o=je(t),a=o/Math.sqrt(t[0]*t[0]+t[1]*t[1]),l=o/Oi.radius;if(n===K.WEB_MERCATOR)return i[0]=a*l,i[1]=a*l,i[2]=1,!0;if(n===K.WGS84||n===K.CGCS2000){const c=DM;return i[0]=c*a*l,i[1]=c*l,i[2]=1,!0}}else if(s===K.PLATE_CARREE){if(n===K.WGS84||n===K.CGCS2000)return i[0]=DM,i[1]=DM,i[2]=1,!0;if(n===K.WEB_MERCATOR){const o=t[1]/Oi.radius;return i[0]=1,i[1]=1/Math.cos(o),i[2]=1,!0}}return!1}function Jp(t,e,i,r){if(C(t)||C(r))return!1;const s=Qv(t,bU),n=Qv(r,F_e);if(s===n&&!gre(n)&&(s!==K.UNKNOWN||rn(t,r)))return gU(i,e),!0;if(gre(n)){const o=vm[s][K.LON_LAT],a=vm[K.LON_LAT][n];return!C(o)&&!C(a)&&(o(e,0,fp,0),a(fp,0,I0,0),O_e($p*fp[0],$p*fp[1],i),i[12]=I0[0],i[13]=I0[1],i[14]=I0[2],!0)}if((n===K.WEB_MERCATOR||n===K.PLATE_CARREE)&&(s===K.WGS84||s===K.CGCS2000&&n===K.PLATE_CARREE||s===K.SPHERICAL_ECEF||s===K.WEB_MERCATOR)){const o=vm[s][K.LON_LAT],a=vm[K.LON_LAT][n];return!C(o)&&!C(a)&&(o(e,0,fp,0),a(fp,0,I0,0),s===K.SPHERICAL_ECEF?OVe($p*fp[0],$p*fp[1],i):_d(i),i[12]=I0[0],i[13]=I0[1],i[14]=I0[2],!0)}return!1}function gre(t){return t===K.SPHERICAL_ECEF||t===K.SPHERICAL_MARS_PCPF||t===K.SPHERICAL_MOON_PCPF}function O_e(t,e,i){const r=Math.sin(t),s=Math.cos(t),n=Math.sin(e),o=Math.cos(e),a=i;return a[0]=-r,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*r,a[9]=o*r,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function OVe(t,e,i){return O_e(t,e,i),tu(i,i),i}function Qv(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=_l(t,1)),t.wkt===Rge.wkt?e.spatialReferenceId=K.SPHERICAL_ECEF:I3(t)?e.spatialReferenceId=K.WGS84:bx(t)?e.spatialReferenceId=K.WEB_MERCATOR:tZ(t)?e.spatialReferenceId=K.PLATE_CARREE:t.wkt===Mge.wkt?e.spatialReferenceId=K.WGS84_ECEF:t.wkid===Qh.CGCS2000?e.spatialReferenceId=K.CGCS2000:t.wkt===nZ.wkt?e.spatialReferenceId=K.SPHERICAL_MARS_PCPF:t.wkt===oZ.wkt?e.spatialReferenceId=K.SPHERICAL_MOON_PCPF:Zm(t)?e.spatialReferenceId=K.GCSMARS2000:Jm(t)?e.spatialReferenceId=K.GCSMOON2000:e.spatialReferenceId=K.UNKNOWN):K.UNKNOWN}function Fr(t,e,i,r){t!==i&&(i[r++]=t[e++],i[r++]=t[e++],i[r]=t[e])}function ox(t,e,i,r){i[r++]=uC*(t[e++]/Oi.radius),i[r++]=uC*(Math.PI/2-2*Math.atan(Math.exp(-t[e++]/Oi.radius))),i[r]=t[e]}function R_e(t,e,i,r){ox(t,e,i,r),vv(i,r,i,r)}function M_e(t,e,i,r){ox(t,e,i,r),wv(i,r,i,r)}function iJ(t,e,i,r,s){const n=.4999999*Math.PI,o=we($p*t[e+1],-n,n),a=Math.sin(o);i[r++]=$p*t[e]*s.radius,i[r++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),i[r]=t[e+2]}function Ix(t,e,i,r){iJ(t,e,i,r,Oi)}const yre=Oi.radius*Math.PI/180,DM=180/(Oi.radius*Math.PI);function _v(t,e,i,r){i[r]=t[e]*yre,i[r+1]=t[e+1]*yre,i[r+2]=t[e+2]}function jw(t,e,i,r){i[r]=t[e]*DM,i[r+1]=t[e+1]*DM,i[r+2]=t[e+2]}function P_e(t,e,i,r){ox(t,e,i,r),_v(i,r,i,r)}function RVe(t,e,i,r){xv(t,e,i,r),_v(i,r,i,r)}function MVe(t,e,i,r){bv(t,e,i,r),_v(i,r,i,r)}function PVe(t,e,i,r){jw(t,e,i,r),vv(i,r,i,r)}function IVe(t,e,i,r){jw(t,e,i,r),Ix(i,r,i,r)}function $Ve(t,e,i,r){jw(t,e,i,r),wv(i,r,i,r)}function $x(t){if(C(t))return!1;const e=Qv(t,bU);return!!vm[e][K.WGS84_COMPARABLE_LON_LAT]}function LVe(t,e,i,r){const s=Math.cos(i);t[0]=Math.cos(e)*s*r,t[1]=Math.sin(e)*s*r,t[2]=Math.sin(i)*r}function rJ(t,e,i,r,s){const n=s+t[e+2],o=$p*t[e+1],a=$p*t[e],l=Math.cos(o);i[r++]=Math.cos(a)*l*n,i[r++]=Math.sin(a)*l*n,i[r]=Math.sin(o)*n}function tj(t,e,i,r){rJ(t,e,i,r,zy.radius)}function ij(t,e,i,r){rJ(t,e,i,r,Em.radius)}function vv(t,e,i,r){rJ(t,e,i,r,Oi.radius)}function sJ(t,e,i,r,s){const n=t[e],o=t[e+1],a=t[e+2],l=Math.sqrt(n*n+o*o+a*a),c=pd(a/(l===0?1:l)),h=Math.atan2(o,n);i[r++]=uC*h,i[r++]=uC*c,i[r]=l-s}function rj(t,e,i,r){sJ(t,e,i,r,zy.radius)}function sj(t,e,i,r){sJ(t,e,i,r,Em.radius)}function bv(t,e,i,r){sJ(t,e,i,r,Oi.radius)}function I_e(t,e,i,r){bv(t,e,i,r),Ix(i,r,i,r)}function $_e(t,e,i,r){bv(t,e,i,r),wv(i,r,i,r)}function DVe(t,e,i,r,s){const n=$p*t[e],o=$p*t[e+1],a=t[e+2],l=Math.sin(o),c=Math.cos(o),h=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);i[r++]=(h+a)*c*Math.cos(n),i[r++]=(h+a)*c*Math.sin(n),i[r++]=(h*(1-s.eccentricitySquared)+a)*l}function wv(t,e,i,r){DVe(t,e,i,r,Oi)}function xv(t,e,i,r){const s=hVe,n=t[e],o=t[e+1],a=t[e+2];let l,c,h,p,f,m,y,_,b,w,S,T,E,O,R,L,P,F,V,B,G;l=Math.abs(a),c=n*n+o*o,h=Math.sqrt(c),p=c+a*a,f=Math.sqrt(p),B=Math.atan2(o,n),m=a*a/p,y=c/p,O=s.a2/f,R=s.a3-s.a4/f,y>.3?(_=l/f*(1+y*(s.a1+O+m*R)/f),V=Math.asin(_),w=_*_,b=Math.sqrt(1-w)):(b=h/f*(1-m*(s.a5-O-y*R)/f),V=Math.acos(b),w=1-b*b,_=Math.sqrt(w)),S=1-Oi.eccentricitySquared*w,T=Oi.radius/Math.sqrt(S),E=s.a6*T,O=h-T*b,R=l-E*_,P=b*O+_*R,L=b*R-_*O,F=L/(E/S+P),V+=F,G=P+L*F/2,a<0&&(V=-V),i[r++]=uC*B,i[r++]=uC*V,i[r]=G}function L_e(t,e,i,r){xv(t,e,i,r),vv(i,r,i,r)}function D_e(t,e,i,r){xv(t,e,i,r),Ix(i,r,i,r)}const vm={[K.WGS84]:{[K.CGCS2000]:null,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:Fr,[K.WGS84_COMPARABLE_LON_LAT]:Fr,[K.SPHERICAL_ECEF]:vv,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:Ix,[K.PLATE_CARREE]:_v,[K.WGS84]:Fr,[K.WGS84_ECEF]:wv},[K.CGCS2000]:{[K.CGCS2000]:Fr,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:Fr,[K.WGS84_COMPARABLE_LON_LAT]:Fr,[K.SPHERICAL_ECEF]:vv,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:null,[K.PLATE_CARREE]:_v,[K.WGS84]:null,[K.WGS84_ECEF]:wv},[K.GCSMARS2000]:{[K.CGCS2000]:null,[K.GCSMARS2000]:Fr,[K.GCSMOON2000]:null,[K.LON_LAT]:Fr,[K.WGS84_COMPARABLE_LON_LAT]:null,[K.SPHERICAL_ECEF]:null,[K.SPHERICAL_MARS_PCPF]:ij,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:null,[K.PLATE_CARREE]:null,[K.WGS84]:null,[K.WGS84_ECEF]:null},[K.GCSMOON2000]:{[K.CGCS2000]:null,[K.GCSMARS2000]:null,[K.GCSMOON2000]:Fr,[K.LON_LAT]:Fr,[K.WGS84_COMPARABLE_LON_LAT]:null,[K.SPHERICAL_ECEF]:null,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:tj,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:null,[K.PLATE_CARREE]:null,[K.WGS84]:null,[K.WGS84_ECEF]:null},[K.WEB_MERCATOR]:{[K.CGCS2000]:null,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:ox,[K.WGS84_COMPARABLE_LON_LAT]:ox,[K.SPHERICAL_ECEF]:R_e,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:Fr,[K.PLATE_CARREE]:P_e,[K.WGS84]:ox,[K.WGS84_ECEF]:M_e},[K.WGS84_ECEF]:{[K.CGCS2000]:xv,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:xv,[K.WGS84_COMPARABLE_LON_LAT]:xv,[K.SPHERICAL_ECEF]:L_e,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:D_e,[K.PLATE_CARREE]:RVe,[K.WGS84]:xv,[K.WGS84_ECEF]:Fr},[K.SPHERICAL_ECEF]:{[K.CGCS2000]:bv,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:bv,[K.WGS84_COMPARABLE_LON_LAT]:bv,[K.SPHERICAL_ECEF]:Fr,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:I_e,[K.PLATE_CARREE]:MVe,[K.WGS84]:bv,[K.WGS84_ECEF]:$_e},[K.SPHERICAL_MARS_PCPF]:{[K.CGCS2000]:null,[K.GCSMARS2000]:sj,[K.GCSMOON2000]:null,[K.LON_LAT]:sj,[K.WGS84_COMPARABLE_LON_LAT]:null,[K.SPHERICAL_ECEF]:null,[K.SPHERICAL_MARS_PCPF]:Fr,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:null,[K.PLATE_CARREE]:null,[K.WGS84]:null,[K.WGS84_ECEF]:null},[K.SPHERICAL_MOON_PCPF]:{[K.CGCS2000]:null,[K.GCSMARS2000]:null,[K.GCSMOON2000]:rj,[K.LON_LAT]:rj,[K.WGS84_COMPARABLE_LON_LAT]:null,[K.SPHERICAL_ECEF]:null,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:Fr,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:null,[K.PLATE_CARREE]:null,[K.WGS84]:null,[K.WGS84_ECEF]:null},[K.UNKNOWN]:{[K.CGCS2000]:null,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:null,[K.WGS84_COMPARABLE_LON_LAT]:null,[K.SPHERICAL_ECEF]:null,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:Fr,[K.WEB_MERCATOR]:null,[K.PLATE_CARREE]:null,[K.WGS84]:null,[K.WGS84_ECEF]:null},[K.LON_LAT]:{[K.CGCS2000]:Fr,[K.GCSMARS2000]:Fr,[K.GCSMOON2000]:Fr,[K.LON_LAT]:Fr,[K.WGS84_COMPARABLE_LON_LAT]:Fr,[K.SPHERICAL_ECEF]:vv,[K.SPHERICAL_MARS_PCPF]:ij,[K.SPHERICAL_MOON_PCPF]:tj,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:Ix,[K.PLATE_CARREE]:_v,[K.WGS84]:Fr,[K.WGS84_ECEF]:wv},[K.WGS84_COMPARABLE_LON_LAT]:{[K.CGCS2000]:null,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:Fr,[K.WGS84_COMPARABLE_LON_LAT]:Fr,[K.SPHERICAL_ECEF]:vv,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:null,[K.PLATE_CARREE]:_v,[K.WGS84]:Fr,[K.WGS84_ECEF]:wv},[K.PLATE_CARREE]:{[K.CGCS2000]:jw,[K.GCSMARS2000]:null,[K.GCSMOON2000]:null,[K.LON_LAT]:jw,[K.WGS84_COMPARABLE_LON_LAT]:jw,[K.SPHERICAL_ECEF]:PVe,[K.SPHERICAL_MARS_PCPF]:null,[K.SPHERICAL_MOON_PCPF]:null,[K.UNKNOWN]:null,[K.WEB_MERCATOR]:IVe,[K.PLATE_CARREE]:Fr,[K.WGS84]:jw,[K.WGS84_ECEF]:$Ve}};function nJ(t,e,i=oJ()){return C(t)||C(e)?null:N_e(t,e,i).projector}function N_e(t,e,i){if(C(t)||C(e)||i.source.spatialReference===t&&i.dest.spatialReference===e)return i;const r=Qv(t,i.source),s=Qv(e,i.dest);return r===K.UNKNOWN&&s===K.UNKNOWN?rn(t,e)?i.projector=Fr:i.projector=null:i.projector=vm[r][s],i}function oJ(){return{source:{spatialReference:null,spatialReferenceId:K.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:K.UNKNOWN,metersPerUnit:1},projector:Fr}}const bU={spatialReference:null,spatialReferenceId:K.UNKNOWN},F_e={spatialReference:null,spatialReferenceId:K.UNKNOWN},aJ=oJ(),NVe=oJ(),$p=ii(1),uC=yl(1),bs=M(),fp=M(),I0=M(),or=M(),m$=M();let n0=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&WE(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*_re);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,_re));e++)this._items.push(this._allocator())}};const _re=1024;function We(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function hC(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function lJ(t,e,i,r,s,n,o,a,l,c,h,p,f,m,y,_){return[t,e,i,r,s,n,o,a,l,c,h,p,f,m,y,_]}function U_e(t,e){return new Float64Array(t,e,16)}const th=We();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:th,clone:hC,create:We,createView:U_e,fromValues:lJ},Symbol.toStringTag,{value:"Module"}));var Xc;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"})(Xc||(Xc={}));function V_e(t){return 32+t.length}function k_e(t){return 16}function B_e(t){if(!t)return 0;let e=j_e;for(const i in t)if(t.hasOwnProperty(i)){const r=t[i];switch(typeof r){case"string":e+=V_e(r);break;case"number":e+=k_e();break;case"boolean":e+=4}}return e}function z_e(t){if(!t)return 0;if(Array.isArray(t))return FVe(t);let e=j_e;for(const i in t)t.hasOwnProperty(i)&&(e+=G_e(t[i]));return e}function FVe(t){const e=t.length;if(e===0||typeof t[0]=="number")return 32+8*e;let i=H_e;for(let r=0;r<e;r++)i+=G_e(t[r]);return i}function G_e(t){switch(typeof t){case"object":return z_e(t);case"string":return V_e(t);case"number":return k_e();case"boolean":return 4;default:return 8}}function d3t(t,e){return H_e+t.length*e}const j_e=32,H_e=32;var dC;(function(t){t[t.KILOBYTES=1024]="KILOBYTES",t[t.MEGABYTES=1048576]="MEGABYTES",t[t.GIGABYTES=1073741824]="GIGABYTES"})(dC||(dC={}));function ls(){return[1,0,0,0,1,0,0,0,1]}function UVe(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function VVe(t,e,i,r,s,n,o,a,l){return[t,e,i,r,s,n,o,a,l]}function q_e(t,e){return new Float64Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:UVe,create:ls,createView:q_e,fromValues:VVe},Symbol.toStringTag,{value:"Module"}));function Cd(){return[0,0,0,1]}function kVe(t){return[t[0],t[1],t[2],t[3]]}function BVe(t,e,i,r){return[t,e,i,r]}function W_e(t,e){return new Float64Array(t,e,4)}const zVe=Cd();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:zVe,clone:kVe,create:Cd,createView:W_e,fromValues:BVe},Symbol.toStringTag,{value:"Module"}));function et(){return[0,0]}function mR(t){return[t[0],t[1]]}function Ni(t,e){return[t,e]}function X_e(t){const e=et(),i=Math.min(2,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function Y_e(t,e){return new Float64Array(t,e,2)}function Z_e(){return et()}function J_e(){return Ni(1,1)}function K_e(){return Ni(1,0)}function Q_e(){return Ni(0,1)}const dc=Z_e(),eve=J_e(),GVe=K_e(),jVe=Q_e();Object.freeze(Object.defineProperty({__proto__:null,ONES:eve,UNIT_X:GVe,UNIT_Y:jVe,ZEROS:dc,clone:mR,create:et,createView:Y_e,fromArray:X_e,fromValues:Ni,ones:J_e,unitX:K_e,unitY:Q_e,zeros:Z_e},Symbol.toStringTag,{value:"Module"}));function fi(){return[0,0,0,0]}function sI(t){return[t[0],t[1],t[2],t[3]]}function si(t,e,i,r){return[t,e,i,r]}function cJ(t){const e=fi(),i=Math.min(4,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function tve(t,e){return new Float64Array(t,e,4)}function ive(){return fi()}function rve(){return si(1,1,1,1)}function sve(){return si(1,0,0,0)}function nve(){return si(0,1,0,0)}function ove(){return si(0,0,1,0)}function ave(){return si(0,0,0,1)}const Am=ive(),ed=rve(),HVe=sve(),qVe=nve(),WVe=ove(),XVe=ave();Object.freeze(Object.defineProperty({__proto__:null,ONES:ed,UNIT_W:XVe,UNIT_X:HVe,UNIT_Y:qVe,UNIT_Z:WVe,ZEROS:Am,clone:sI,create:fi,createView:tve,fromArray:cJ,fromValues:si,ones:rve,unitW:ave,unitX:sve,unitY:nve,unitZ:ove,zeros:ive},Symbol.toStringTag,{value:"Module"}));let sA=class Db{constructor(e,i,r){this._itemByteSize=e,this._itemCreate=i,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(r/this._itemByteSize)}get(){this._itemsPtr===0&&WE(()=>this._reset());const e=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=e;){const i=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let r=0;r<this._itemsPerBuffer;++r)this._items.push(this._itemCreate(i,r*this._itemByteSize));this._buffers.push(i)}return this._items[this._itemsPtr++]}_reset(){const e=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>e;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(e=xT){return new Db(16,Y_e,e)}static createVec3f64(e=xT){return new Db(24,jY,e)}static createVec4f64(e=xT){return new Db(32,tve,e)}static createMat3f64(e=xT){return new Db(72,q_e,e)}static createMat4f64(e=xT){return new Db(128,U_e,e)}static createQuatf64(e=xT){return new Db(32,W_e,e)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}};const xT=4*dC.KILOBYTES,p3t=sA.createVec2f64(),at=sA.createVec3f64(),uJ=sA.createVec4f64();sA.createMat3f64();const hJ=sA.createMat4f64(),f3t=sA.createQuatf64();function nf(t){return t?{origin:xs(t.origin),vector:xs(t.vector)}:{origin:M(),vector:M()}}function YVe(t,e){const i=JVe.get();return i.origin=t,i.vector=e,i}function m3t(t,e=nf()){return ZVe(t.origin,t.vector,e)}function ZVe(t,e,i=nf()){return he(i.origin,t),he(i.vector,e),i}function ax(t,e,i=nf()){return he(i.origin,t),be(i.vector,e,t),i}function dJ(t,e){const i=be(at.get(),e,t.origin),r=Ae(t.vector,i),s=Ae(t.vector,t.vector),n=we(r/s,0,1),o=be(at.get(),ue(at.get(),t.vector,n),i);return Ae(o,o)}function g3t(t,e,i){return nj(t,e,0,1,i)}function y3t(t,e,i){return ve(i,t.origin,ue(i,t.vector,e))}function nj(t,e,i,r,s){const{vector:n,origin:o}=t,a=be(at.get(),e,o),l=Ae(n,a)/Ea(n);return ue(s,n,we(l,i,r)),ve(s,s,t.origin)}function _3t(t,e){if(cve(t,YVe(e.origin,e.direction),!1,F4)){const{tA:i,pB:r,distance2:s}=F4;if(i>=0&&i<=1)return s;if(i<0)return Bo(t.origin,r);if(i>1)return Bo(ve(at.get(),t.origin,t.vector),r)}return null}function lve(t,e,i){return!!cve(t,e,!0,F4)&&(he(i,F4.pA),!0)}function cve(t,e,i,r){const n=t.origin,o=ve(at.get(),n,t.vector),a=e.origin,l=ve(at.get(),a,e.vector),c=at.get(),h=at.get();if(c[0]=n[0]-a[0],c[1]=n[1]-a[1],c[2]=n[2]-a[2],h[0]=l[0]-a[0],h[1]=l[1]-a[1],h[2]=l[2]-a[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const p=at.get();if(p[0]=o[0]-n[0],p[1]=o[1]-n[1],p[2]=o[2]-n[2],Math.abs(p[0])<1e-6&&Math.abs(p[1])<1e-6&&Math.abs(p[2])<1e-6)return!1;const f=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],m=h[0]*p[0]+h[1]*p[1]+h[2]*p[2],y=c[0]*p[0]+c[1]*p[1]+c[2]*p[2],_=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],b=(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])*_-m*m;if(Math.abs(b)<1e-6)return!1;let w=(f*m-y*_)/b,S=(f+m*w)/_;i&&(w=we(w,0,1),S=we(S,0,1));const T=at.get(),E=at.get();return T[0]=n[0]+w*p[0],T[1]=n[1]+w*p[1],T[2]=n[2]+w*p[2],E[0]=a[0]+S*h[0],E[1]=a[1]+S*h[1],E[2]=a[2]+S*h[2],r.tA=w,r.tB=S,r.pA=T,r.pB=E,r.distance2=Bo(T,E),!0}const F4={tA:0,tB:0,pA:M(),pB:M(),distance2:0},JVe=new n0(()=>nf());function fo(t){return t?vre(xs(t.origin),xs(t.direction)):vre(M(),M())}function vre(t,e){return{origin:t,direction:e}}function v3t(t,e){return Uy(t.origin,e.origin)&&Uy(t.direction,e.direction)}function ih(t,e){const i=tke.get();return i.origin=t,i.direction=e,i}function U4(t,e=fo()){return uve(t.origin,t.direction,e)}function KVe(t,e,i=fo()){return he(i.origin,t),be(i.direction,e,t),i}function uve(t,e,i=fo()){return he(i.origin,t),he(i.direction,e),i}function QVe(t,e){const i=Et(at.get(),Oe(at.get(),t.direction),be(at.get(),e,t.origin));return Ae(i,i)}function eke(t,e,i){const r=Ae(t.direction,be(i,e,t.origin));return ve(i,t.origin,ue(i,t.direction,r)),i}const tke=new n0(()=>fo());function NM(t,e){return Ae(t,e)/je(t)}function pJ(t,e){const i=Ae(t,e)/(je(t)*je(e));return-Dn(i)}function hve(t,e,i){Oe(g$,t),Oe(GV,e);const r=Ae(g$,GV),s=Dn(r),n=Et(g$,g$,GV);return Ae(n,i)<0?2*Math.PI-s:s}const g$=M(),GV=M();function gn(){return fi()}function pC(t,e=gn()){return Op(e,t)}function dve(t,e){return si(t[0],t[1],t[2],e)}function ike(t){return t}function pve(t){t[0]=t[1]=t[2]=t[3]=0}function wU(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function Cy(t){return t[3]}function rke(t){return t}function fve(t,e,i,r){return si(t,e,i,r)}function ske(t,e,i){return t!==i&&he(i,t),i[3]=t[3]+e,i}function nke(t,e,i){return oe.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported"),t===i?i:pC(t,i)}function v1(t,e,i){if(C(e))return!1;const{origin:r,direction:s}=e,n=oke;n[0]=r[0]-t[0],n[1]=r[1]-t[1],n[2]=r[2]-t[2];const o=s[0]*s[0]+s[1]*s[1]+s[2]*s[2];if(o===0)return!1;const a=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=a*a-4*o*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-t[3]*t[3]);if(l<0)return!1;const c=Math.sqrt(l);let h=(-a-c)/(2*o);const p=(-a+c)/(2*o);return(h<0||p<h&&p>0)&&(h=p),!(h<0)&&(i&&(i[0]=r[0]+s[0]*h,i[1]=r[1]+s[1]*h,i[2]=r[2]+s[2]*h),!0)}const oke=M();function oj(t,e){return v1(t,e,null)}function ake(t,e,i){if(v1(t,e,i))return i;const r=nA(t,e,at.get());return ve(i,e.origin,ue(at.get(),e.direction,Ar(e.origin,r)/je(e.direction))),i}function nA(t,e,i){const r=at.get(),s=hJ.get();Et(r,e.origin,e.direction);const n=Cy(t);Et(i,r,e.origin),ue(i,i,1/je(i)*n);const o=yve(t,e.origin),a=pJ(e.origin,i);return eh(s,a+o,r),ut(i,i,s),i}function lke(t,e,i){return v1(t,e,i)?i:(eke(e,t,i),mve(t,i,i))}function mve(t,e,i){const r=be(at.get(),e,t),s=ue(at.get(),r,t[3]/je(r));return ve(i,s,t)}function gve(t,e){const i=be(at.get(),e,t),r=Ea(i),s=t[3]*t[3];return Math.sqrt(Math.abs(r-s))}function yve(t,e){const i=be(at.get(),e,t),r=je(i),s=Cy(t),n=s+Math.abs(s-r);return Dn(s/n)}const jV=M();function _ve(t,e,i,r){const s=be(jV,e,t);switch(i){case Xc.X:{const n=_ie(s,jV)[2];return fe(r,-Math.sin(n),Math.cos(n),0)}case Xc.Y:{const n=_ie(s,jV),o=n[1],a=n[2],l=Math.sin(o);return fe(r,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case Xc.Z:return Oe(r,s);default:return}}function vve(t,e){const i=be(aj,e,t);return je(i)-t[3]}function cke(t,e,i,r){const s=vve(t,e),n=_ve(t,e,Xc.Z,aj),o=ue(aj,n,i-s);return ve(r,e,o)}function uke(t,e){const i=Bo(t,e),r=Cy(t);return i<=r*r}const aj=M(),xU=gn(),hke=Object.freeze(Object.defineProperty({__proto__:null,altitudeAt:vve,angleToSilhouette:yve,axisAt:_ve,clear:pve,closestPoint:lke,closestPointOnSilhouette:nA,containsPoint:uke,copy:pC,create:gn,distanceToSilhouette:gve,elevate:ske,fromCenterAndRadius:dve,fromRadius:wU,fromValues:fve,getCenter:rke,getRadius:Cy,intersectRay:v1,intersectRayClosestSilhouette:ake,intersectsRay:oj,projectPoint:mve,setAltitudeAt:cke,setExtent:nke,tmpSphere:xU,wrap:ike},Symbol.toStringTag,{value:"Module"}));function Lx(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],i=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],r=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,i,r))}function dke(t,e){const i=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),r=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),s=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return fe(t,i,r,s),t}function b3t(t,e,i){i=i||t;const r=Ae(t,e);fe(i,t[0]-r*e[0],t[1]-r*e[1],t[2]-r*e[2]),Oe(i,i)}function w3t(t,e,i){Math.abs(t[0])>Math.abs(t[1])?fe(e,0,1,0):fe(e,1,0,0),Et(i,t,e),Oe(e,e),Et(e,i,t),Oe(i,i)}function y$(t,e,i,r,s,n){const o=t+(e-t)*s;return o+(i+(r-i)*s-o)*n}function pke(t,e,i,r=M()){const s=je(t),n=je(e),o=Ae(t,e)/(s*n);if(o<.9999999999999999){const a=Math.acos(o),l=((1-i)*s+i*n)/Math.sin(a),c=l/s*Math.sin((1-i)*a),h=l/n*Math.sin(i*a);return ue(Hw,t,c),ue(qw,e,h),ve(r,Hw,qw)}return tn(r,t,e,i)}function x3t(t,e,i,r=M(),s=M()){const n=je(t),o=je(e),a=Ae(t,e)/(n*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),h=Math.sin(i*l),p=Math.sin((1-i)*l),f=(1-i)*n+i*o;{const m=f/c,y=m/o*h;ue(Hw,t,m/n*p),ue(qw,e,y),ve(r,Hw,qw)}{const m=1/n*(-Math.cos((1-i)*l)*l*f+p*(-n+o));ue(Hw,t,m);const y=1/o*(Math.cos(i*l)*l*f+h*(-n+o));ue(qw,e,y),ve(s,Hw,qw),ue(s,s,1/c)}return s}return tn(r,t,e,i),be(s,e,t),Oe(s,s),s}function RN(t,e,i){t=Oe(Hw,t),e=Oe(qw,e);const r=Dn(Ae(t,e));if(i){const s=Et(fke,t,e);if(Ae(s,i)<0)return-r}return r}function MN(t){const e=t.length;return i=>{if(i<=t[0][0])return t[0][1];if(i>=t[e-1][0])return t[e-1][1];let r=1;for(;i>t[r][0];)r++;const s=t[r-1][0],n=t[r][0],o=(n-i)/(n-s);return o*t[r-1][1]+(1-o)*t[r][1]}}function T3t(t,e,i,r){be(bre,e,t),be(wre,i,t),Et(r,bre,wre),Oe(r,r),r[3]=-Ae(t,r)}const bre=M(),wre=M(),fke=M(),Hw=M(),qw=M();function qi(t=gR){return[t[0],t[1],t[2],t[3]]}function mke(t=gR[0],e=gR[1],i=gR[2],r=gR[3]){return fJ(t,e,i,r,uJ.get())}function TU(t,e){return fJ(e[0],e[1],e[2],e[3],t)}function fJ(t,e,i,r,s=qi()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function bve(t,e,i){return he(i,t),i[3]=e,i}function nI(t,e,i){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function Ta(t,e,i,r=qi()){const s=i[0]-e[0],n=i[1]-e[1],o=i[2]-e[2],a=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2],h=n*c-o*l,p=o*a-s*c,f=s*l-n*a,m=h*h+p*p+f*f,y=Math.abs(m-1)>1e-5&&m>1e-12?1/Math.sqrt(m):1;return r[0]=h*y,r[1]=p*y,r[2]=f*y,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function wve(t,e,i,r,s){const n=t.length/3;if(n<3)return!1;fe(BA,t[3*i],t[3*i+1],t[3*i+2]);let o=r,a=!1;for(;o<n-1&&!a;){const l=3*o;fe(TT,t[l],t[l+1],t[l+2]),o++,a=!cl(BA,TT)}if(!a)return!1;for(o=Math.max(o,s),a=!1;o<n&&!a;){const l=3*o;fe(Aw,t[l],t[l+1],t[l+2]),o++,be(_$,BA,TT),Oe(_$,_$),be(v$,TT,Aw),Oe(v$,v$),a=!cl(BA,Aw)&&!cl(TT,Aw)&&Math.abs(Ae(_$,v$))<gke}return a?(Ta(BA,TT,Aw,e),!0):(i!==0||r!==1||s!==2)&&wve(t,e,0,1,2)}const gke=.99619469809,BA=M(),TT=M(),Aw=M(),_$=M(),v$=M();function lj(t,e,i){return e!==t&&TU(t,e),t[3]=-Ae(t,i),t}function cj(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function q3(t,e,i,r){return Et(Aw,e,t),nI(i,Aw,r)}function S3t(t,e,i,r){return SU(t,e,be(at.get(),i,e),xke,r)}function hT(t,e,i){return!!v(e)&&SU(t,e.origin,e.direction,Tke,i)}function yke(t,e,i){return SU(t,e.origin,e.vector,Om.NONE,i)}function _ke(t,e,i){return SU(t,e.origin,e.vector,Om.CLAMP,i)}function xve(t,e){return Er(t,e)>=0}function vke(t,e){const i=Ae(t,e.ray.direction),r=-Er(t,e.ray.origin);if(r<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return r>0;if((r<0||i<0)&&!(r<0&&i<0))return!0;const s=r/i;return i>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function bke(t,e){const i=Ae(t,e.ray.direction),r=-Er(t,e.ray.origin);if(i>-1e-6&&i<1e-6)return r>0;const s=r/i;return i>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function wke(t,e,i){const r=ue(at.get(),t,-t[3]),s=uj(t,be(at.get(),e,r),at.get());return ve(i,s,r),i}function uj(t,e,i){const r=ue(at.get(),t,Ae(t,e));return be(i,e,r),i}function Er(t,e){return Ae(t,e)+t[3]}function SU(t,e,i,r,s){const n=Ae(t,i);if(n===0)return!1;let o=-(Ae(t,e)+t[3])/n;return r&Om.CLAMP&&(o=we(o,0,1)),!(!(r&Om.INFINITE_MIN)&&o<0||!(r&Om.INFINITE_MAX)&&o>1)&&(ve(s,e,ue(s,i,o)),!0)}function E3t(t){return t}const gR=[0,0,1,0];var Om;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"})(Om||(Om={}));const xke=Om.INFINITE_MIN|Om.INFINITE_MAX,Tke=Om.INFINITE_MAX,HV=oe.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");let Ske=class{constructor(){this.plane=qi(),this.origin=M(),this.basis1=M(),this.basis2=M()}};const Tve=Ske;function o0(t=Lve){return{plane:qi(t.plane),origin:xs(t.origin),basis1:xs(t.basis1),basis2:xs(t.basis2)}}function Eke(t,e,i){const r=Fke.get();return r.origin=t,r.basis1=e,r.basis2=i,r.plane=mke(0,0,0,0),EU(r),r}function dT(t,e=o0()){return mJ(t.origin,t.basis1,t.basis2,e)}function Cke(t,e){he(e.origin,t.origin),he(e.basis1,t.basis1),he(e.basis2,t.basis2),TU(e.plane,t.plane)}function mJ(t,e,i,r=o0()){return he(r.origin,t),he(r.basis1,e),he(r.basis2,i),EU(r),Dke(r,"fromValues()"),r}function EU(t){q3(t.basis2,t.basis1,t.origin,t.plane)}function Sve(t,e,i){t!==i&&dT(t,i);const r=ue(at.get(),qy(t),e);return ve(i.origin,i.origin,r),i.plane[3]-=e,i}function Ake(t,e,i){return Eve(e,i),Sve(i,vJ(t,t.origin),i),i}function Eve(t,e=o0()){const i=(t[2]-t[0])/2,r=(t[3]-t[1])/2;return fe(e.origin,t[0]+i,t[1]+r,0),fe(e.basis1,i,0,0),fe(e.basis2,0,r,0),fJ(0,0,1,0,e.plane),e}function gJ(t,e,i){return!!hT(t.plane,e,i)&&Ive(t,i)}function Oke(t,e,i){if(gJ(t,e,i))return i;const r=Cve(t,e,at.get());return ve(i,e.origin,ue(at.get(),e.direction,Ar(e.origin,r)/je(e.direction))),i}function Cve(t,e,i){const r=V4.get();$ve(t,e,r,V4.get());let s=Number.POSITIVE_INFINITY;for(const n of wJ){const o=bJ(t,n,CU.get()),a=at.get();if(yke(r,o,a)){const l=i0(at.get(),e.origin,a),c=Math.abs(Dn(Ae(e.direction,l)));c<s&&(s=c,he(i,a))}}return s===Number.POSITIVE_INFINITY?Ave(t,e,i):i}function Ave(t,e,i){if(gJ(t,e,i))return i;const r=V4.get(),s=V4.get();$ve(t,e,r,s);let n=Number.POSITIVE_INFINITY;for(const o of wJ){const a=bJ(t,o,CU.get()),l=at.get();if(_ke(r,a,l)){const c=QVe(e,l);if(!xve(s,l))continue;c<n&&(n=c,he(i,l))}}return yJ(t,e.origin)<n&&Ove(t,e.origin,i),i}function Ove(t,e,i){const r=wke(t.plane,e,at.get()),s=nj(xre(t,t.basis1),r,-1,1,at.get()),n=nj(xre(t,t.basis2),r,-1,1,at.get());return be(i,ve(at.get(),s,n),t.origin),i}function Rve(t,e,i){const{origin:r,basis1:s,basis2:n}=t,o=be(at.get(),e,r),a=NM(s,o),l=NM(n,o),c=NM(qy(t),o);return fe(i,a,l,c)}function yJ(t,e){const i=Rve(t,e,at.get()),{basis1:r,basis2:s}=t,n=je(r),o=je(s),a=Math.max(Math.abs(i[0])-n,0),l=Math.max(Math.abs(i[1])-o,0),c=i[2];return a*a+l*l+c*c}function Rke(t,e){return Math.sqrt(yJ(t,e))}function Mke(t,e){let i=Number.NEGATIVE_INFINITY;for(const r of wJ){const s=bJ(t,r,CU.get()),n=dJ(s,e);n>i&&(i=n)}return Math.sqrt(i)}function _J(t,e){return xve(t.plane,e)&&Ive(t,e)}function Pke(t,e,i,r){return Lke(t,i,r)}function vJ(t,e){const i=-t.plane[3];return NM(qy(t),e)-i}function Ike(t,e,i,r){const s=vJ(t,e),n=ue(Nke,qy(t),i-s);return ve(r,e,n),r}function Mve(t,e){return cl(t.basis1,e.basis1)&&cl(t.basis2,e.basis2)&&cl(t.origin,e.origin)}function Pve(t,e,i){return t!==i&&dT(t,i),Go(ST,e),tu(ST,ST),ut(i.basis1,t.basis1,ST),ut(i.basis2,t.basis2,ST),ut(i.plane,t.plane,ST),ut(i.origin,t.origin,e),lj(i.plane,i.plane,i.origin),i}function $ke(t,e,i,r){return t!==r&&dT(t,r),eh(qV,e,i),ut(r.basis1,t.basis1,qV),ut(r.basis2,t.basis2,qV),EU(r),r}function qy(t){return t.plane}function Lke(t,e,i){switch(e){case Xc.X:he(i,t.basis1),Oe(i,i);break;case Xc.Y:he(i,t.basis2),Oe(i,i);break;case Xc.Z:he(i,qy(t))}return i}function Ive(t,e){const i=be(at.get(),e,t.origin),r=Ea(t.basis1),s=Ea(t.basis2),n=Ae(t.basis1,i),o=Ae(t.basis2,i);return-n-r<0&&n-r<0&&-o-s<0&&o-s<0}function xre(t,e){const i=CU.get();return he(i.origin,t.origin),he(i.vector,e),i}function bJ(t,e,i){const{basis1:r,basis2:s,origin:n}=t,o=ue(at.get(),r,e.origin[0]),a=ue(at.get(),s,e.origin[1]);ve(i.origin,o,a),ve(i.origin,i.origin,n);const l=ue(at.get(),r,e.direction[0]),c=ue(at.get(),s,e.direction[1]);return ue(i.vector,ve(l,l,c),2),i}function Dke(t,e){Math.abs(Ae(t.basis1,t.basis2)/(je(t.basis1)*je(t.basis2)))>1e-6&&HV.warn(e,"Provided basis vectors are not perpendicular"),Math.abs(Ae(t.basis1,qy(t)))>1e-6&&HV.warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-Ae(qy(t),t.origin)-t.plane[3])>1e-6&&HV.warn(e,"Plane offset is not consistent with plane origin")}function $ve(t,e,i,r){const s=qy(t);q3(s,e.direction,e.origin,i),q3(i,s,e.origin,r)}const Lve={plane:qi(),origin:Xe(0,0,0),basis1:Xe(1,0,0),basis2:Xe(0,1,0)},V4=new n0(qi),CU=new n0(nf),Nke=M(),Fke=new n0(()=>o0()),wJ=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],ST=We(),qV=We(),Uke=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:Tve,UP:Lve,altitudeAt:vJ,axisAt:Pke,closestPoint:Ave,closestPointOnSilhouette:Cve,copy:dT,copyWithoutVerify:Cke,create:o0,distance:Rke,distance2:yJ,distanceToSilhouette:Mke,elevate:Sve,equals:Mve,extrusionContainsPoint:_J,fromAABoundingRect:Eve,fromValues:mJ,intersectRay:gJ,intersectRayClosestSilhouette:Oke,normal:qy,projectPoint:Ove,projectPointLocal:Rve,rotate:$ke,setAltitudeAt:Ike,setExtent:Ake,transform:Pve,updateUnboundedPlane:EU,wrap:Eke},Symbol.toStringTag,{value:"Module"})),Vke=new mt(Rge),Tre=new mt(nZ),Sre=new mt(oZ),A3t=new mt(Mge);function AU(t){return t&&(Zm(t)||rn(t,Tre))?Tre:t&&(Jm(t)||rn(t,Sre))?Sre:Vke}function kke(t){const{value:e,operations:i}=t;return{operations:i,value:i.create(e)}}function Bke(t,e,i){return t.operations.setExtent(t.value,e,i.value),i}function zke(t){return{operations:t,value:t.create()}}function Dve(t,e,i=zke(t)){return i.operations=t,t.copy(e,i.value),i}function Gke(t){return Dve(hke,fve(0,0,0,tr(t).radius))}const Ere=2**50;function jke(){return Dve(Uke,mJ([0,0,0],[Ere,0,0],[0,Ere,0]))}function Hke(t,e,i){return t.operations.axisAt(t.value,e,Xc.Z,i)}function qke(t,e,i,r){return t.operations.axisAt(t.value,e,i,r)}function Wke(t,e,i){return t.operations.intersectRay(t.value,e,i)}function Xke(t,e,i){return t.operations.intersectRayClosestSilhouette(t.value,e,i)}function Yke(t,e){return t.operations.altitudeAt(t.value,e)}function Nve(t,e,i,r){return t.operations.setAltitudeAt(t.value,e,i,r)}function Zke(t,e,i,r){return e!==r&&Xn(r,e),fe(ET,r[12],r[13],r[14]),Nve(t,ET,i,ET),r[12]=ET[0],r[13]=ET[1],r[14]=ET[2],r}function WV(t,e,i){return t.operations.elevate(t.value,e,i.value)}const ET=M();function Cre(t,e,i,r,s){return s[0]=Ae(t,e),s[1]=Ae(t,i),s[2]=Ae(t,r),s}function hj(t,e,i,r,s){he(i,t),he(b$,e),Oe(b$,b$),Et(r,b$,i),Et(s,r,i)}function Fve(t,e){return t?AU(e):e.isGeographic?mt.PlateCarree:e}const b$=M(),xJ=96;function O3t(t,e){const i=e||t.extent,r=t.width,s=_l(i&&i.spatialReference);return i&&r?i.width/r*s*aZ*xJ:0}function Jke(t,e){return t/(_l(e)*aZ*xJ)}function Kke(t){return t/(aZ*xJ)}const Uve="OBJECTID";function FM(t){const e=t==null?void 0:t.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function fC(t){return t!=null&&"type"in t&&t.type==="group"}const R3t={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function Vve(t){const e=t==null?void 0:t.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function Are(t){return(t==null?void 0:t.type)==="voxel"}function Ore(t){return(t==null?void 0:t.type)==="imagery-tile"}function kve(t){return t!=null&&t.parent!=null&&"declaredClass"in t.parent&&t.parent.declaredClass==="esri.Basemap"&&t.parent.baseLayers.includes(t)}function TJ(t){var e;return(t==null?void 0:t.type)==="feature"&&!t.url&&((e=t.source)==null?void 0:e.type)==="memory"}function M3t(t){var e;return(t==null?void 0:t.type)==="feature"&&((e=t.source)==null?void 0:e.type)==="feature-layer"}function Qke(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const i=t.activeLayer.tileMatrixSets;if(i)return i}return null}async function Bve(t,e){const i=Cr==null?void 0:Cr.findServerInfo(t);if((i==null?void 0:i.currentVersion)!=null)return i.owningSystemUrl||null;const r=t.toLowerCase().indexOf("/rest/services");if(r===-1)return null;const s=`${t.substring(0,r)}/rest/info`,n=v(e)?e.signal:null,{data:o}=await zr(s,{query:{f:"json"},responseType:"json",signal:n});return(o==null?void 0:o.owningSystemUrl)||null}function e9e(t){if(!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function zve(t){return e9e(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function t9e(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function i9e(t){return!!t9e(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}let mC=class extends $M{constructor(e){super(e),this.handles.add(this.on("before-add",i=>{C(i.item)||i.item.parent===this.owner&&(oe.getLogger(this.declaredClass).warn("Analysis inside the collection must be unique. Not adding this element again."),i.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};mC=u([I("esri.support.AnalysesCollection")],mC);const PN={widthBreakpoint:{getValue(t){const e=t.viewSize[0],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,i=e[0],r=e[1],s=this.values;return r>=i?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},XV={xsmall:544,small:768,medium:992,large:1200};function r9e(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function YV(t,e){return e?PN[t].valueToClassName[e].split(" "):[]}const Gve=t=>{let e=class extends t{constructor(...i){super(...i),this._breakpointsHandles=new Ki,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=XV}initialize(){this._breakpointsHandles.add(re(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Zt))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=Je(this._breakpointsHandles))}set breakpoints(i){if(i===this._get("breakpoints"))return;const r=r9e(i);if(!r){const s=JSON.stringify(XV,null,2);console.warn("provided breakpoints are not valid, using defaults:"+s)}i=r?i:XV,this._set("breakpoints",{...i})}_updateClassNames(){if(!this.container)return;const i=tc.acquire(),r=tc.acquire();let s,n=!1;for(s in PN){const o=this[s],a=PN[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(n=!0,this[s]=a,YV(s,o).forEach(l=>r.push(l)),YV(s,a).forEach(l=>i.push(l)))}n&&(this._applyClassNameChanges(i,r),tc.release(i),tc.release(r))}_applyClassNameChanges(i,r){const s=this.container;s&&(r.forEach(n=>s.classList.remove(n)),i.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const i=this.container;if(!i)return;let r;for(r in PN)YV(r,this[r]).forEach(s=>i.classList.remove(s))}};return u([d()],e.prototype,"breakpoints",null),u([d()],e.prototype,"orientation",void 0),u([d()],e.prototype,"widthBreakpoint",void 0),u([d()],e.prototype,"heightBreakpoint",void 0),e=u([I("esri.views.BreakpointsOwner")],e),e};/*!
 * @esri/arcgis-html-sanitizer - v3.0.1 - Tue Nov 15 2022 09:46:54 GMT-0800 (Pacific Standard Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei(雷宗民) <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 */var s9e=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},Ow={exports:{}},yn={},W3={exports:{}},pT={};function jve(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function n9e(t,e,i){}function o9e(t,e,i){}var a9e=/javascript\s*\:/img;function l9e(t,e){return a9e.test(e)?"":e}pT.whiteList=jve();pT.getDefaultWhiteList=jve;pT.onAttr=n9e;pT.onIgnoreAttr=o9e;pT.safeAttrValue=l9e;var c9e={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,s;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,s=t.length;r<s;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},zA=c9e;function u9e(t,e){t=zA.trimRight(t),t[t.length-1]!==";"&&(t+=";");var i=t.length,r=!1,s=0,n=0,o="";function a(){if(!r){var h=zA.trim(t.slice(s,n)),p=h.indexOf(":");if(p!==-1){var f=zA.trim(h.slice(0,p)),m=zA.trim(h.slice(p+1));if(f){var y=e(s,o.length,f,m,h);y&&(o+=y+"; ")}}}s=n+1}for(;n<i;n++){var l=t[n];if(l==="/"&&t[n+1]==="*"){var c=t.indexOf("*/",n+2);if(c===-1)break;n=c+1,s=n+1,r=!1}else l==="("?r=!0:l===")"?r=!1:l===";"?r||a():l===`
`&&a()}return zA.trim(o)}var h9e=u9e,w$=pT,d9e=h9e;function Rre(t){return t==null}function p9e(t){var e={};for(var i in t)e[i]=t[i];return e}function Hve(t){t=p9e(t||{}),t.whiteList=t.whiteList||w$.whiteList,t.onAttr=t.onAttr||w$.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||w$.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||w$.safeAttrValue,this.options=t}Hve.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,s=i.onAttr,n=i.onIgnoreAttr,o=i.safeAttrValue,a=d9e(t,function(l,c,h,p,f){var m=r[h],y=!1;if(m===!0?y=m:typeof m=="function"?y=m(p):m instanceof RegExp&&(y=m.test(p)),y!==!0&&(y=!1),p=o(h,p),!!p){var _={position:c,sourcePosition:l,source:f,isWhite:y};if(y){var b=s(h,p,_);return Rre(b)?h+":"+p:b}else{var b=n(h,p,_);if(!Rre(b))return b}}});return a};var f9e=Hve;(function(t,e){var i=pT,r=f9e;function s(o,a){var l=new r(a);return l.process(o)}e=t.exports=s,e.FilterCSS=r;for(var n in i)e[n]=i[n]})(W3,W3.exports);var SJ={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,s;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,s=t.length;r<s;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,i=e.exec(t);return i?i.index:-1}},m9e=W3.exports.FilterCSS,g9e=W3.exports.getDefaultWhiteList,k4=SJ;function qve(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var Wve=new m9e;function y9e(t,e,i){}function _9e(t,e,i){}function v9e(t,e,i){}function b9e(t,e,i){}function Xve(t){return t.replace(x9e,"&lt;").replace(T9e,"&gt;")}function w9e(t,e,i,r){if(i=e1e(i),e==="href"||e==="src"){if(i=k4.trim(i),i==="#")return"#";if(!(i.substr(0,7)==="http://"||i.substr(0,8)==="https://"||i.substr(0,7)==="mailto:"||i.substr(0,4)==="tel:"||i.substr(0,11)==="data:image/"||i.substr(0,6)==="ftp://"||i.substr(0,2)==="./"||i.substr(0,3)==="../"||i[0]==="#"||i[0]==="/"))return""}else if(e==="background"){if(x$.lastIndex=0,x$.test(i))return""}else if(e==="style"){if(Mre.lastIndex=0,Mre.test(i)||(Pre.lastIndex=0,Pre.test(i)&&(x$.lastIndex=0,x$.test(i))))return"";r!==!1&&(r=r||Wve,i=r.process(i))}return i=t1e(i),i}var x9e=/</g,T9e=/>/g,S9e=/"/g,E9e=/&quot;/g,C9e=/&#([a-zA-Z0-9]*);?/gim,A9e=/&colon;?/gim,O9e=/&newline;?/gim,x$=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,Mre=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,Pre=/u\s*r\s*l\s*\(.*/gi;function Yve(t){return t.replace(S9e,"&quot;")}function Zve(t){return t.replace(E9e,'"')}function Jve(t){return t.replace(C9e,function(i,r){return r[0]==="x"||r[0]==="X"?String.fromCharCode(parseInt(r.substr(1),16)):String.fromCharCode(parseInt(r,10))})}function Kve(t){return t.replace(A9e,":").replace(O9e," ")}function Qve(t){for(var e="",i=0,r=t.length;i<r;i++)e+=t.charCodeAt(i)<32?" ":t.charAt(i);return k4.trim(e)}function e1e(t){return t=Zve(t),t=Jve(t),t=Kve(t),t=Qve(t),t}function t1e(t){return t=Yve(t),t=Xve(t),t}function R9e(){return""}function M9e(t,e){typeof e!="function"&&(e=function(){});var i=!Array.isArray(t);function r(o){return i?!0:k4.indexOf(t,o)!==-1}var s=[],n=!1;return{onIgnoreTag:function(o,a,l){if(r(o))if(l.isClosing){var c="[/removed]",h=l.position+c.length;return s.push([n!==!1?n:l.position,h]),n=!1,c}else return n||(n=l.position),"[removed]";else return e(o,a,l)},remove:function(o){var a="",l=0;return k4.forEach(s,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function P9e(t){for(var e="",i=0;i<t.length;){var r=t.indexOf("<!--",i);if(r===-1){e+=t.slice(i);break}e+=t.slice(i,r);var s=t.indexOf("-->",r);if(s===-1)break;i=s+3}return e}function I9e(t){var e=t.split("");return e=e.filter(function(i){var r=i.charCodeAt(0);return r===127?!1:r<=31?r===10||r===13:!0}),e.join("")}yn.whiteList=qve();yn.getDefaultWhiteList=qve;yn.onTag=y9e;yn.onIgnoreTag=_9e;yn.onTagAttr=v9e;yn.onIgnoreTagAttr=b9e;yn.safeAttrValue=w9e;yn.escapeHtml=Xve;yn.escapeQuote=Yve;yn.unescapeQuote=Zve;yn.escapeHtmlEntities=Jve;yn.escapeDangerHtml5Entities=Kve;yn.clearNonPrintableCharacter=Qve;yn.friendlyAttrValue=e1e;yn.escapeAttrValue=t1e;yn.onIgnoreTagStripAll=R9e;yn.StripTagBody=M9e;yn.stripCommentTag=P9e;yn.stripBlankChar=I9e;yn.cssFilter=Wve;yn.getDefaultCSSWhiteList=g9e;var OU={},X_=SJ;function $9e(t){var e=X_.spaceIndex(t),i;return e===-1?i=t.slice(1,-1):i=t.slice(1,e+1),i=X_.trim(i).toLowerCase(),i.slice(0,1)==="/"&&(i=i.slice(1)),i.slice(-1)==="/"&&(i=i.slice(0,-1)),i}function L9e(t){return t.slice(0,2)==="</"}function D9e(t,e,i){var r="",s=0,n=!1,o=!1,a=0,l=t.length,c="",h="";e:for(a=0;a<l;a++){var p=t.charAt(a);if(n===!1){if(p==="<"){n=a;continue}}else if(o===!1){if(p==="<"){r+=i(t.slice(s,a)),n=a,s=a;continue}if(p===">"){r+=i(t.slice(s,n)),h=t.slice(n,a+1),c=$9e(h),r+=e(n,r.length,c,h,L9e(h)),s=a+1,n=!1;continue}if(p==='"'||p==="'")for(var f=1,m=t.charAt(a-f);m.trim()===""||m==="=";){if(m==="="){o=p;continue e}m=t.charAt(a-++f)}}else if(p===o){o=!1;continue}}return s<t.length&&(r+=i(t.substr(s))),r}var N9e=/[^a-zA-Z0-9\\_:.-]/gim;function F9e(t,e){var i=0,r=0,s=[],n=!1,o=t.length;function a(f,m){if(f=X_.trim(f),f=f.replace(N9e,"").toLowerCase(),!(f.length<1)){var y=e(f,m||"");y&&s.push(y)}}for(var l=0;l<o;l++){var c=t.charAt(l),h,p;if(n===!1&&c==="="){n=t.slice(i,l),i=l+1,r=t.charAt(i)==='"'||t.charAt(i)==="'"?i:V9e(t,l+1);continue}if(n!==!1&&l===r){if(p=t.indexOf(c,l+1),p===-1)break;h=X_.trim(t.slice(r+1,p)),a(n,h),n=!1,l=p,i=l+1;continue}if(/\s|\n|\t/.test(c))if(t=t.replace(/\s|\n|\t/g," "),n===!1)if(p=U9e(t,l),p===-1){h=X_.trim(t.slice(i,l)),a(h),n=!1,i=l+1;continue}else{l=p-1;continue}else if(p=k9e(t,l-1),p===-1){h=X_.trim(t.slice(i,l)),h=Ire(h),a(n,h),n=!1,i=l+1;continue}else continue}return i<t.length&&(n===!1?a(t.slice(i)):a(n,Ire(X_.trim(t.slice(i))))),X_.trim(s.join(" "))}function U9e(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="="?e:-1}}function V9e(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="'"||i==='"'?e:-1}}function k9e(t,e){for(;e>0;e--){var i=t[e];if(i!==" ")return i==="="?e:-1}}function B9e(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function Ire(t){return B9e(t)?t.substr(1,t.length-2):t}OU.parseTag=D9e;OU.parseAttr=F9e;var z9e=W3.exports.FilterCSS,mp=yn,i1e=OU,G9e=i1e.parseTag,j9e=i1e.parseAttr,IN=SJ;function T$(t){return t==null}function H9e(t){var e=IN.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=IN.trim(t.slice(e+1,-1));var i=t[t.length-1]==="/";return i&&(t=IN.trim(t.slice(0,-1))),{html:t,closing:i}}function q9e(t){var e={};for(var i in t)e[i]=t[i];return e}function W9e(t){var e={};for(var i in t)Array.isArray(t[i])?e[i.toLowerCase()]=t[i].map(function(r){return r.toLowerCase()}):e[i.toLowerCase()]=t[i];return e}function r1e(t){t=q9e(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=mp.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=W9e(t.whiteList||t.allowList):t.whiteList=mp.whiteList,t.onTag=t.onTag||mp.onTag,t.onTagAttr=t.onTagAttr||mp.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||mp.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||mp.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||mp.safeAttrValue,t.escapeHtml=t.escapeHtml||mp.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new z9e(t.css))}r1e.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,s=i.onTag,n=i.onIgnoreTag,o=i.onTagAttr,a=i.onIgnoreTagAttr,l=i.safeAttrValue,c=i.escapeHtml,h=e.cssFilter;i.stripBlankChar&&(t=mp.stripBlankChar(t)),i.allowCommentTag||(t=mp.stripCommentTag(t));var p=!1;i.stripIgnoreTagBody&&(p=mp.StripTagBody(i.stripIgnoreTagBody,n),n=p.onIgnoreTag);var f=G9e(t,function(m,y,_,b,w){var S={sourcePosition:m,position:y,isClosing:w,isWhite:Object.prototype.hasOwnProperty.call(r,_)},T=s(_,b,S);if(!T$(T))return T;if(S.isWhite){if(S.isClosing)return"</"+_+">";var E=H9e(b),O=r[_],R=j9e(E.html,function(L,P){var F=IN.indexOf(O,L)!==-1,V=o(_,L,P,F);return T$(V)?F?(P=l(_,L,P,h),P?L+'="'+P+'"':L):(V=a(_,L,P,F),T$(V)?void 0:V):V});return b="<"+_,R&&(b+=" "+R),E.closing&&(b+=" /"),b+=">",b}else return T=n(_,b,S),T$(T)?c(b):T},c);return p&&(f=p.remove(f)),f};var X9e=r1e;(function(t,e){var i=yn,r=OU,s=X9e;function n(a,l){var c=new s(l);return c.process(a)}e=t.exports=n,e.filterXSS=n,e.FilterXSS=s,function(){for(var a in i)e[a]=i[a];for(var l in r)e[l]=r[l]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=t.exports)})(Ow,Ow.exports);var Y9e=function(){function t(e,i){var r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,o,a,l){return n==="a"&&o==="href"||(n==="img"||n==="source")&&o==="src"?r.sanitizeUrl(a):Ow.exports.safeAttrValue(n,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var s;e&&!i?s=e:e&&i?(s=Object.create(this.arcgisFilterOptions),Object.keys(e).forEach(function(n){n==="whiteList"?s.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,e.whiteList||{}]):s[n]=e[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList),this.xssFilterOptions=s,this._xssFilter=new Ow.exports.FilterXSS(s)}return t.prototype.sanitize=function(e,i){switch(i===void 0&&(i={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,i);default:return i.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,i){var r=(i??{}).isProtocolRequired,s=r===void 0?!0:r,n=this._trim(e.substring(0,e.indexOf(":"))),o=e==="/",a=/^#/.test(e),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return o||a||l?Ow.exports.escapeAttrValue(e):!n&&!s?Ow.exports.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,i,r,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,i,r,s):Ow.exports.safeAttrValue(e,i,r,s)},t.prototype.validate=function(e,i){i===void 0&&(i={});var r=this.sanitize(e,i);return{isValid:e===r,sanitized:r}},t.prototype.encodeHTML=function(e){var i=this;return String(e).replace(/[&<>"'\/]/g,function(r){return i._entityMap[r]})},t.prototype.encodeAttrValue=function(e){var i=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(r,s){return i.test(r)?r:"&#x".concat(Number(e.charCodeAt(s)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var i={};return e.forEach(function(r){Object.keys(r).forEach(function(s){Array.isArray(r[s])&&Array.isArray(i[s])?i[s]=i[s].concat(r[s]):i[s]=r[s]})}),i},t.prototype._iterateOverObject=function(e,i){var r=this;i===void 0&&(i={});try{var s=!1,n=void 0;if(Array.isArray(e))n=e.reduce(function(a,l){var c=r.validate(l,i);return c.isValid?a.concat([l]):(s=!0,a.concat([c.sanitized]))},[]);else if(s9e(e)){var o=Object.keys(e);n=o.reduce(function(a,l){var c=e[l],h=r.validate(c,i);return h.isValid?a[l]=c:(s=!0,a[l]=h.sanitized),a},{})}else return i.allowUndefined&&typeof e>"u"?void 0:null;return s?n:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t}();const RU=new Map;function s1e(){RU.clear()}function Z9e(t){return RU.get(t)}function J9e(t,e){RU.set(t,e)}function ZV(t){RU.delete(t)}var Dx,gC,K9e=function(t){if("WebkitTransition"in t.style)Dx="webkitTransitionEnd",gC="webkitAnimationEnd";else{if(!("transition"in t.style))throw new Error("Your browser is not supported!");Dx="transitionend",gC="animationend"}},n1e=function(t){Dx||K9e(t)},Q9e=function(t,e){return e===void 0&&(e=t+"-active"),function(i){n1e(i);var r=!1,s=function(n){r||(r=!0,i.removeEventListener(Dx,s),i.removeEventListener(gC,s),i.classList.remove(t),i.classList.remove(e))};i.classList.add(t),i.addEventListener(Dx,s),i.addEventListener(gC,s),requestAnimationFrame(function(){i.classList.add(e)})}},eBe=function(t,e){return e===void 0&&(e=t+"-active"),function(i,r){n1e(i);var s=!1,n=function(o){s||(s=!0,i.removeEventListener(Dx,n),i.removeEventListener(gC,n),r())};i.classList.add(t),i.addEventListener(Dx,n),i.addEventListener(gC,n),requestAnimationFrame(function(){i.classList.add(e)})}};const tBe=oe.getLogger("esri.widgets.support.widgetUtils");function o1e(t){const e=tc.acquire();for(let r=0;r<arguments.length;r++){const s=arguments[r],n=typeof s;if(n==="string")e.push(s);else if(Array.isArray(s))e.push.apply(e,s);else if(n==="object")for(const o in s)s[o]&&e.push(o)}const i=e.join(" ");return tc.release(e),i}(()=>{const t=new Map,e=new ResizeObserver(i=>{var r;s1e();for(const s of i)(r=t.get(s.target))==null||r(s)});return(i,r,s)=>(t.has(i)&&tBe.error("Already observing element",i),t.set(i,r),e.observe(i,s),Wp(()=>{e.unobserve(i),t.delete(i)}))})();function bm(t){const e=t==null?void 0:t.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function $re(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function B4(t){const e="data-node-ref";this[t.getAttribute(e)]=t}function iBe(t,e){return(t==="enter"?Q9e:eBe)(e)}const rBe=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],sBe=rBe.reduce((t,e)=>(t[e]=[],t),{}),nBe=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],a1e=new Y9e({whiteList:sBe,onTagAttr:(t,e,i)=>{const r=`${e}="${i}"`;if(nBe.includes(e))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function oBe(t){return t==="Enter"||t===" "}const l1e="http://www.w3.org/",MU=`${l1e}2000/svg`,c1e=`${l1e}1999/xlink`;let Lre=[],EJ=(t,e)=>{let i={};return Object.keys(t).forEach(r=>{i[r]=t[r]}),e&&Object.keys(e).forEach(r=>{i[r]=e[r]}),i},CJ=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),u1e=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},aBe=(t,e,i)=>{if(e.vnodeSelector!==""){for(let r=i;r<t.length;r++)if(CJ(t[r],e))return r}return-1},JV=(t,e,i,r)=>{let s=t[e];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n&&(n.key===void 0?n.bind:n.key))){for(let o=0;o<t.length;o++)if(o!==e){let a=t[o];if(CJ(a,s))throw new Error(`${i.vnodeSelector} had a ${s.vnodeSelector} child ${r==="added"?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},lBe=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},dj=[],pj=!1,h1e=t=>{(t.children||[]).forEach(h1e),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},Dre=()=>{pj=!1,dj.forEach(h1e),dj.length=0},Nre=t=>{dj.push(t),pj||(pj=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(Dre,{timeout:16}):setTimeout(Dre,16))},Fre=t=>{let e=t.domNode;if(t.properties){let i=t.properties.exitAnimation;if(i)return e.style.pointerEvents="none",void i(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),Nre(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),Nre(t))},cBe=(t,e,i)=>{if(!e)return;let r=i.eventHandlerInterceptor,s=Object.keys(e),n=s.length;for(let o=0;o<n;o++){let a=s[o],l=e[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")fj(t,l,!0);else if(a==="classes"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let f=c[p];l[f]&&t.classList.add(f)}}else if(a==="styles"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let f=c[p],m=l[f];m&&(u1e(m),i.styleApplyer(t,f,m))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(r&&(l=r(a,l,t,e)),a==="oninput"&&function(){let h=l;l=function(p){h.apply(this,[p]),p.target["oninput-value"]=p.target.value}}()),t[a]=l):i.namespace===MU?a==="href"?t.setAttributeNS(c1e,a,l):t.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?t[a]=a1e.sanitize(l):d1e(t)&&a in t?t[a]=l:t.setAttribute(a,l):t[a]=l}}};function d1e(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let z4,uBe=(t,e,i)=>{if(e)for(let r of e)HS(r,t,void 0,i)},p1e=(t,e,i)=>{uBe(t,e.children,i),e.text&&(t.textContent=e.text),cBe(t,e.properties,i),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,i,e.vnodeSelector,e.properties,e.children])},HS=(t,e,i,r)=>{let s,n=0,o=t.vnodeSelector,a=e.ownerDocument;if(o==="")s=t.domNode=a.createTextNode(t.text),i!==void 0?e.insertBefore(s,i):e.appendChild(s);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let h=o.charAt(n-1),p=o.slice(n,l);h==="."?s.classList.add(p):h==="#"?s.id=p:(p==="svg"&&(r=EJ(r,{namespace:MU})),r.namespace!==void 0?s=t.domNode=a.createElementNS(r.namespace,p):(s=t.domNode=t.domNode||a.createElement(p),p==="input"&&t.properties&&t.properties.type!==void 0&&s.setAttribute("type",t.properties.type)),i!==void 0?e.insertBefore(s,i):s.parentNode!==e&&e.appendChild(s)),n=l+1}}p1e(s,t,r)}},fj=(t,e,i)=>{e&&e.split(" ").forEach(r=>{r&&t.classList.toggle(r,i)})},hBe=(t,e,i,r)=>{if(!i)return;let s=!1,n=Object.keys(i),o=n.length;for(let a=0;a<o;a++){let l=n[a],c=i[l],h=e[l];if(l==="class")h!==c&&(fj(t,h,!1),fj(t,c,!0));else if(l==="classes"){let p=t.classList,f=Object.keys(c),m=f.length;for(let y=0;y<m;y++){let _=f[y],b=!!c[_];b!==!!h[_]&&(s=!0,b?p.add(_):p.remove(_))}}else if(l==="styles"){let p=Object.keys(c),f=p.length;for(let m=0;m<f;m++){let y=p[m],_=c[y];_!==h[y]&&(s=!0,_?(u1e(_),r.styleApplyer(t,y,_)):r.styleApplyer(t,y,""))}}else if(c||typeof h!="string"||(c=""),l==="value"){let p=t[l];p!==c&&(t["oninput-value"]?p===t["oninput-value"]:c!==h)&&(t[l]=c,t["oninput-value"]=void 0),c!==h&&(s=!0)}else if(c!==h){let p=typeof c;p==="function"&&r.eventHandlerInterceptor||(r.namespace===MU?l==="href"?t.setAttributeNS(c1e,l,c):t.setAttribute(l,c):p==="string"?l==="innerHTML"?t[l]=a1e.sanitize(c):l==="role"&&c===""?t.removeAttribute(l):d1e(t)&&l in t?t[l]=c:t.setAttribute(l,c):t[l]!==c&&(t[l]=c),s=!0)}}return s},dBe=(t,e,i,r,s)=>{if(i===r)return!1;r=r||Lre;let n,o=(i=i||Lre).length,a=r.length,l=0,c=0,h=!1;for(;c<a;){let p=l<o?i[l]:void 0,f=r[c];if(p!==void 0&&CJ(p,f))h=z4(p,f,s)||h,l++;else{let m=aBe(i,f,l+1);if(m>=0){for(n=l;n<m;n++)Fre(i[n]),JV(i,n,t,"removed");h=z4(i[m],f,s)||h,l=m+1}else HS(f,e,l<o?i[l].domNode:void 0,s),lBe(f),JV(r,c,t,"added")}c++}if(o>l)for(n=l;n<o;n++)Fre(i[n]),JV(i,n,t,"removed");return h};z4=(t,e,i)=>{let r=t.domNode,s=!1;if(t===e)return!1;let n=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let o=r.ownerDocument.createTextNode(e.text);return r.parentNode.replaceChild(o,r),e.domNode=o,s=!0,s}e.domNode=r}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(i=EJ(i,{namespace:MU})),t.text!==e.text&&(n=!0,e.text===void 0?r.removeChild(r.firstChild):r.textContent=e.text),e.domNode=r,n=dBe(e,r,t.children,e.children,i)||n,n=hBe(r,t.properties,e.properties,i)||n,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[r,i,e.vnodeSelector,e.properties,e.children]);return n&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(r,e.properties,t.properties),s};let GA=(t,e)=>({getLastRender:()=>t,update:i=>{if(t.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=t;t=i,z4(r,i,e)},domNode:t.domNode});const pBe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{e.charAt(0)==="-"?t.style.setProperty(e,i):t.style[e]=i}};let H2=t=>EJ(pBe,t),Tv={create:(t,e)=>(e=H2(e),HS(t,document.createElement("div"),void 0,e),GA(t,e)),append:(t,e,i)=>(i=H2(i),HS(e,t,void 0,i),GA(e,i)),insertBefore:(t,e,i)=>(i=H2(i),HS(e,t.parentNode,t,i),GA(e,i)),merge:(t,e,i)=>(i=H2(i),e.domNode=t,p1e(t,e,i),GA(e,i)),replace:(t,e,i)=>(i=H2(i),HS(e,t.parentNode,t,i),t.parentNode.removeChild(t),GA(e,i))},f1e,fBe=(t,e)=>{let i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i};f1e=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let mBe=(t,e)=>{let i=t;return e.forEach(r=>{i=i&&i.children?f1e(i.children,s=>s.domNode===r):void 0}),i},gBe=(t,e,i)=>{let r=function(s){i("domEvent",s);let n=e(),o=fBe(s.currentTarget,n.domNode);o.reverse();let a,l=mBe(n.getLastRender(),o);return t.scheduleRender(),l&&(a=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),i("domEventProcessed",s),a};return(s,n,o,a)=>r},mj=t=>{let e,i,r=H2(t),s=r.performanceLogger,n=!0,o=!1,a=[],l=[],c=(p,f,m)=>{let y,_=()=>y;r.eventHandlerInterceptor=gBe(e,_,s),y=p(f,m(),r),a.push(y),l.push(m)},h=()=>{if(i=void 0,n){n=!1,s("renderStart",void 0);for(let p=0;p<a.length;p++){let f=l[p]();s("rendered",void 0),a[p].update(f),s("patched",void 0)}s("renderDone",void 0),n=!0}};return e={renderNow:h,scheduleRender:()=>{i||o||(i=requestAnimationFrame(h))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),o=!0},resume:()=>{o=!1,n=!0,e.scheduleRender()},append:(p,f)=>{c(Tv.append,p,f)},insertBefore:(p,f)=>{c(Tv.insertBefore,p,f)},merge:(p,f)=>{c(Tv.merge,p,f)},replace:(p,f)=>{c(Tv.replace,p,f)},detach:p=>{for(let f=0;f<l.length;f++)if(l[f]===p)return l.splice(f,1),a.splice(f,1)[0];throw new Error("renderFunction was not found")}},e},T_=class extends $e{constructor(){super(...arguments),this.items=new Nt,this._watchUpdatingTracking=new Cm,this._callbacks=new Map,this._projector=mj(),this._hiddenProjector=mj()}get needsRender(){return this.items.length>0}get updating(){var e;return((e=this._watchUpdatingTracking)==null?void 0:e.updating)??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,i=>{for(const r of i.added){const s=()=>r.render();this._callbacks.set(r,s),this._projector.append(this.surface,s)}for(const r of i.removed){const s=this._projector.detach(this._callbacks.get(r));this.surface.removeChild(s.domNode),this._callbacks.delete(r)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const i=this._hiddenSurface,r=this._hiddenProjector;let s;const n=()=>(s=e.render(),s);r.append(i,n),r.renderNow();const o={left:0,top:0,right:0,bottom:0};if(s&&s.domNode){const a=s.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(r.detach(n);i.firstChild;)i.removeChild(i.firstChild);return o}overlaps(e,i){const r=this.computeBoundingRect(e),s=this.computeBoundingRect(i);return Math.max(r.left,s.left)<=Math.min(r.right,s.right)&&Math.max(r.top,s.top)<=Math.min(r.bottom,s.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e){if(!this.items.some(r=>r.visible))return;const i=e.getContext("2d");i.save(),i.font=this._fontString(),this.items.forEach(r=>{i.save(),r.renderCanvas(i),i.restore()}),i.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};u([d({readOnly:!0})],T_.prototype,"surface",void 0),u([d({readOnly:!0})],T_.prototype,"items",void 0),u([d({readOnly:!0})],T_.prototype,"needsRender",null),u([d({readOnly:!0})],T_.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0})],T_.prototype,"updating",null),T_=u([I("esri.views.overlay.ViewOverlay")],T_);const Ure=T_;function vE(t,e,i,r){let s=null,n=1e3;typeof e=="number"?(n=e,r=i):(s=e??null,n=i);let o,a=0;const l=()=>{a=0,t.apply(r,o)},c=(...h)=>{s&&s.apply(r,h),o=h,n?a||(a=setTimeout(l,n)):l()};return c.remove=()=>{a&&(clearTimeout(a),a=0)},c.forceUpdate=()=>{a&&(clearTimeout(a),l())},c.hasPendingUpdates=()=>!!a,c}const yBe="randomUUID"in crypto;function _Be(){if(yBe)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=i=>t[i].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}const vBe={handleInterceptedEvent:(t,e,i,r)=>(t.scheduleRender(),e.properties[`on${r.type}`].apply(e.properties.bind||i,[r]))},bBe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{t.style[e]=i}},wBe=t=>({...bBe,...t}),xBe=(t,e)=>{const i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i},TBe=(t,e)=>t.find(e),Vre=(t,e,i=!1)=>{let r=t;return e.forEach((s,n)=>{const o=r!=null&&r.children?TBe(r.children,a=>a.domNode===s):void 0;i&&!o&&n!==e.length-1||(r=o)}),r},SBe=t=>{let e;const i={...vBe,...t},r=wBe(i),s=r.performanceLogger;let n,o=!0,a=!1;const l=[],c=[],h=(f,m,y)=>{var w;let _;r.eventHandlerInterceptor=(S,T,E,O)=>function(R){let L;s("domEvent",R);const P=xBe(R.currentTarget,_.domNode),F=P.some(B=>{var G;return customElements.get((G=B==null?void 0:B.tagName)==null?void 0:G.toLowerCase())});if(R.eventPhase===Event.CAPTURING_PHASE||!F)P.reverse(),L=Vre(_.getLastRender(),P);else{const B=R.composedPath(),G=B.slice(B.indexOf(R.currentTarget),B.indexOf(_.domNode)).filter(te=>te.getRootNode()===te.ownerDocument).reverse();L=Vre(_.getLastRender(),G,!0)}let V;return L&&(V=i.handleInterceptedEvent(e,L,this,R)),s("domEventProcessed",R),V},(w=i.postProcessProjectionOptions)==null||w.call(i,r);const b=y();_=f(m,b,r),l.push(_),c.push(y),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered(_,b)};let p=()=>{if(n=void 0,o){o=!1,s("renderStart",void 0);for(let f=0;f<l.length;f++){const m=c[f]();s("rendered",void 0),l[f].update(m),s("patched",void 0)}s("renderDone",void 0),o=!0}};return i.modifyDoRenderImplementation&&(p=i.modifyDoRenderImplementation(p,l,c)),e={renderNow:p,scheduleRender:()=>{n||a||(n=requestAnimationFrame(p))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,o=!0,e.scheduleRender()},append:(f,m)=>{h(Tv.append,f,m)},insertBefore:(f,m)=>{h(Tv.insertBefore,f,m)},merge:(f,m)=>{h(Tv.merge,f,m)},replace:(f,m)=>{h(Tv.replace,f,m)},detach:f=>{for(let m=0;m<c.length;m++)if(c[m]===f)return c.splice(m,1),l.splice(m,1)[0];throw new Error("renderFunction was not found")}},e},q2={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let W2,m1e,PU,g1e=!1,G4=!1,AJ=!1,Iu=!1,kre=null,gj=!1;const $3t=t=>{const e=new URL(t,$a.$resourcesUrl$);return e.origin!==lI.location.origin?e.href:e.pathname},EBe=t=>$a.$resourcesUrl$=t,Nx=(t,e="")=>()=>{},Bre="http://www.w3.org/1999/xlink",zre={},CBe="http://www.w3.org/2000/svg",ABe="http://www.w3.org/1999/xhtml",OBe=t=>t!=null,OJ=t=>(t=typeof t,t==="object"||t==="function"),y1e=(t,e,...i)=>{let r=null,s=null,n=null,o=!1,a=!1;const l=[],c=p=>{for(let f=0;f<p.length;f++)r=p[f],Array.isArray(r)?c(r):r!=null&&typeof r!="boolean"&&((o=typeof t!="function"&&!OJ(r))&&(r=String(r)),o&&a?l[l.length-1].$text$+=r:l.push(o?j4(null,r):r),a=o)};if(c(i),e){e.key&&(s=e.key),e.name&&(n=e.name);{const p=e.className||e.class;p&&(e.class=typeof p!="object"?p:Object.keys(p).filter(f=>p[f]).join(" "))}}if(typeof t=="function")return t(e===null?{}:e,l,PBe);const h=j4(t,null);return h.$attrs$=e,l.length>0&&(h.$children$=l),h.$key$=s,h.$name$=n,h},j4=(t,e)=>{const i={$flags$:0,$tag$:t,$text$:e,$elm$:null,$children$:null};return i.$attrs$=null,i.$key$=null,i.$name$=null,i},RBe={},MBe=t=>t&&t.$tag$===RBe,PBe={forEach:(t,e)=>t.map(Gre).forEach(e),map:(t,e)=>t.map(Gre).map(e).map(IBe)},Gre=t=>({vattrs:t.$attrs$,vchildren:t.$children$,vkey:t.$key$,vname:t.$name$,vtag:t.$tag$,vtext:t.$text$}),IBe=t=>{if(typeof t.vtag=="function"){const i=Object.assign({},t.vattrs);return t.vkey&&(i.key=t.vkey),t.vname&&(i.name=t.vname),y1e(t.vtag,i,...t.vchildren||[])}const e=j4(t.vtag,t.vtext);return e.$attrs$=t.vattrs,e.$children$=t.vchildren,e.$key$=t.vkey,e.$name$=t.vname,e},$Be=t=>oze.map(e=>e(t)).find(e=>!!e),LBe=(t,e)=>t!=null&&!OJ(t)?e&4?t==="false"?!1:t===""||!!t:e&2?parseFloat(t):e&1?String(t):t:t,DBe=t=>t,L3t=(t,e,i)=>{const r=DBe(t);return{emit:s=>NBe(r,e,{bubbles:!!(i&4),composed:!!(i&2),cancelable:!!(i&1),detail:s})}},NBe=(t,e,i)=>{const r=$a.ce(e,i);return t.dispatchEvent(r),r},jre=new WeakMap,FBe=(t,e,i)=>{let r=q4.get(t);cze&&i?(r=r||new CSSStyleSheet,typeof r=="string"?r=e:r.replaceSync(e)):r=e,q4.set(t,r)},UBe=(t,e,i,r)=>{let s=_1e(e,i);const n=q4.get(s);if(t=t.nodeType===11?t:Rm,n)if(typeof n=="string"){t=t.head||t;let o=jre.get(t),a;o||jre.set(t,o=new Set),o.has(s)||(a=Rm.createElement("style"),a.innerHTML=n,t.insertBefore(a,t.querySelector("link")),o&&o.add(s))}else t.adoptedStyleSheets.includes(n)||(t.adoptedStyleSheets=[...t.adoptedStyleSheets,n]);return s},VBe=t=>{const e=t.$cmpMeta$,i=t.$hostElement$,r=e.$flags$,s=Nx("attachStyles",e.$tagName$),n=UBe(i.shadowRoot?i.shadowRoot:i.getRootNode(),e,t.$modeName$);r&10&&(i["s-sc"]=n,i.classList.add(n+"-h"),r&2&&i.classList.add(n+"-s")),s()},_1e=(t,e)=>"sc-"+(e&&t.$flags$&32?t.$tagName$+"-"+e:t.$tagName$),Hre=(t,e,i,r,s,n)=>{if(i!==r){let o=Yre(t,e),a=e.toLowerCase();if(e==="class"){const l=t.classList,c=qre(i),h=qre(r);l.remove(...c.filter(p=>p&&!h.includes(p))),l.add(...h.filter(p=>p&&!c.includes(p)))}else if(e==="style"){for(const l in i)(!r||r[l]==null)&&(l.includes("-")?t.style.removeProperty(l):t.style[l]="");for(const l in r)(!i||r[l]!==i[l])&&(l.includes("-")?t.style.setProperty(l,r[l]):t.style[l]=r[l])}else if(e!=="key")if(e==="ref")r&&r(t);else if(!t.__lookupSetter__(e)&&e[0]==="o"&&e[1]==="n")e[2]==="-"?e=e.slice(3):Yre(lI,a)?e=a.slice(2):e=a[2]+e.slice(3),i&&$a.rel(t,e,i,!1),r&&$a.ael(t,e,r,!1);else{const l=OJ(r);if((o||l&&r!==null)&&!s)try{if(t.tagName.includes("-"))t[e]=r;else{const h=r??"";e==="list"?o=!1:(i==null||t[e]!=h)&&(t[e]=h)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(e=a,c=!0),r==null||r===!1?(r!==!1||t.getAttribute(e)==="")&&(c?t.removeAttributeNS(Bre,e):t.removeAttribute(e)):(!o||n&4||s)&&!l&&(r=r===!0?"":r,c?t.setAttributeNS(Bre,e,r):t.setAttribute(e,r))}}},kBe=/\s/,qre=t=>t?t.split(kBe):[],v1e=(t,e,i,r)=>{const s=e.$elm$.nodeType===11&&e.$elm$.host?e.$elm$.host:e.$elm$,n=t&&t.$attrs$||zre,o=e.$attrs$||zre;for(r in n)r in o||Hre(s,r,n[r],void 0,i,e.$flags$);for(r in o)Hre(s,r,n[r],o[r],i,e.$flags$)},H4=(t,e,i,r)=>{const s=e.$children$[i];let n=0,o,a,l;if(g1e||(AJ=!0,s.$tag$==="slot"&&(W2&&r.classList.add(W2+"-s"),s.$flags$|=s.$children$?2:1)),s.$text$!==null)o=s.$elm$=Rm.createTextNode(s.$text$);else if(s.$flags$&1)o=s.$elm$=Rm.createTextNode("");else{if(Iu||(Iu=s.$tag$==="svg"),o=s.$elm$=Rm.createElementNS(Iu?CBe:ABe,s.$flags$&2?"slot-fb":s.$tag$),Iu&&s.$tag$==="foreignObject"&&(Iu=!1),v1e(null,s,Iu),OBe(W2)&&o["s-si"]!==W2&&o.classList.add(o["s-si"]=W2),s.$children$)for(n=0;n<s.$children$.length;++n)a=H4(t,s,n,o),a&&o.appendChild(a);s.$tag$==="svg"?Iu=!1:o.tagName==="foreignObject"&&(Iu=!0)}return o["s-hn"]=PU,s.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=m1e,o["s-sn"]=s.$name$||"",l=t&&t.$children$&&t.$children$[i],l&&l.$tag$===s.$tag$&&t.$elm$&&X3(t.$elm$,!1)),o},X3=(t,e)=>{$a.$flags$|=1;const i=t.childNodes;for(let r=i.length-1;r>=0;r--){const s=i[r];s["s-hn"]!==PU&&s["s-ol"]&&(x1e(s).insertBefore(s,RJ(s)),s["s-ol"].remove(),s["s-ol"]=void 0,AJ=!0),e&&X3(s,e)}$a.$flags$&=-2},b1e=(t,e,i,r,s,n)=>{let o=t["s-cr"]&&t["s-cr"].parentNode||t,a;for(o.shadowRoot&&o.tagName===PU&&(o=o.shadowRoot);s<=n;++s)r[s]&&(a=H4(null,i,s,t),a&&(r[s].$elm$=a,o.insertBefore(a,RJ(e))))},w1e=(t,e,i,r,s)=>{for(;e<=i;++e)(r=t[e])&&(s=r.$elm$,E1e(r),G4=!0,s["s-ol"]?s["s-ol"].remove():X3(s,!0),s.remove())},BBe=(t,e,i,r)=>{let s=0,n=0,o=0,a=0,l=e.length-1,c=e[0],h=e[l],p=r.length-1,f=r[0],m=r[p],y,_;for(;s<=l&&n<=p;)if(c==null)c=e[++s];else if(h==null)h=e[--l];else if(f==null)f=r[++n];else if(m==null)m=r[--p];else if(S$(c,f))X2(c,f),c=e[++s],f=r[++n];else if(S$(h,m))X2(h,m),h=e[--l],m=r[--p];else if(S$(c,m))(c.$tag$==="slot"||m.$tag$==="slot")&&X3(c.$elm$.parentNode,!1),X2(c,m),t.insertBefore(c.$elm$,h.$elm$.nextSibling),c=e[++s],m=r[--p];else if(S$(h,f))(c.$tag$==="slot"||m.$tag$==="slot")&&X3(h.$elm$.parentNode,!1),X2(h,f),t.insertBefore(h.$elm$,c.$elm$),h=e[--l],f=r[++n];else{for(o=-1,a=s;a<=l;++a)if(e[a]&&e[a].$key$!==null&&e[a].$key$===f.$key$){o=a;break}o>=0?(_=e[o],_.$tag$!==f.$tag$?y=H4(e&&e[n],i,o,t):(X2(_,f),e[o]=void 0,y=_.$elm$),f=r[++n]):(y=H4(e&&e[n],i,n,t),f=r[++n]),y&&x1e(c.$elm$).insertBefore(y,RJ(c.$elm$))}s>l?b1e(t,r[p+1]==null?null:r[p+1].$elm$,i,r,n,p):n>p&&w1e(e,s,l)},S$=(t,e)=>t.$tag$===e.$tag$?t.$tag$==="slot"?t.$name$===e.$name$:t.$key$===e.$key$:!1,RJ=t=>t&&t["s-ol"]||t,x1e=t=>(t["s-ol"]?t["s-ol"]:t).parentNode,X2=(t,e)=>{const i=e.$elm$=t.$elm$,r=t.$children$,s=e.$children$,n=e.$tag$,o=e.$text$;let a;o===null?(Iu=n==="svg"?!0:n==="foreignObject"?!1:Iu,n==="slot"||v1e(t,e,Iu),r!==null&&s!==null?BBe(i,r,e,s):s!==null?(t.$text$!==null&&(i.textContent=""),b1e(i,null,e,s,0,s.length-1)):r!==null&&w1e(r,0,r.length-1),Iu&&n==="svg"&&(Iu=!1)):(a=i["s-cr"])?a.parentNode.textContent=o:t.$text$!==o&&(i.data=o)},T1e=t=>{const e=t.childNodes;let i,r,s,n,o,a;for(r=0,s=e.length;r<s;r++)if(i=e[r],i.nodeType===1){if(i["s-sr"]){for(o=i["s-sn"],i.hidden=!1,n=0;n<s;n++)if(a=e[n].nodeType,e[n]["s-hn"]!==i["s-hn"]||o!==""){if(a===1&&o===e[n].getAttribute("slot")){i.hidden=!0;break}}else if(a===1||a===3&&e[n].textContent.trim()!==""){i.hidden=!0;break}}T1e(i)}},wp=[],S1e=t=>{let e,i,r,s,n,o,a=0;const l=t.childNodes,c=l.length;for(;a<c;a++){if(e=l[a],e["s-sr"]&&(i=e["s-cr"])&&i.parentNode)for(r=i.parentNode.childNodes,s=e["s-sn"],o=r.length-1;o>=0;o--)i=r[o],!i["s-cn"]&&!i["s-nr"]&&i["s-hn"]!==e["s-hn"]&&(Wre(i,s)?(n=wp.find(h=>h.$nodeToRelocate$===i),G4=!0,i["s-sn"]=i["s-sn"]||s,n?n.$slotRefNode$=e:wp.push({$slotRefNode$:e,$nodeToRelocate$:i}),i["s-sr"]&&wp.map(h=>{Wre(h.$nodeToRelocate$,i["s-sn"])&&(n=wp.find(p=>p.$nodeToRelocate$===i),n&&!h.$slotRefNode$&&(h.$slotRefNode$=n.$slotRefNode$))})):wp.some(h=>h.$nodeToRelocate$===i)||wp.push({$nodeToRelocate$:i}));e.nodeType===1&&S1e(e)}},Wre=(t,e)=>t.nodeType===1?t.getAttribute("slot")===null&&e===""||t.getAttribute("slot")===e:t["s-sn"]===e?!0:e==="",E1e=t=>{t.$attrs$&&t.$attrs$.ref&&t.$attrs$.ref(null),t.$children$&&t.$children$.map(E1e)},zBe=(t,e)=>{const i=t.$hostElement$,r=t.$cmpMeta$,s=t.$vnode$||j4(null,null),n=MBe(e)?e:y1e(null,null,e);PU=i.tagName,r.$attrsToReflect$&&(n.$attrs$=n.$attrs$||{},r.$attrsToReflect$.map(([o,a])=>n.$attrs$[a]=i[o])),n.$tag$=null,n.$flags$|=4,t.$vnode$=n,n.$elm$=s.$elm$=i.shadowRoot||i,W2=i["s-sc"],m1e=i["s-cr"],g1e=(r.$flags$&1)!==0,G4=!1,X2(s,n);{if($a.$flags$|=1,AJ){S1e(n.$elm$);let o,a,l,c,h,p,f=0;for(;f<wp.length;f++)o=wp[f],a=o.$nodeToRelocate$,a["s-ol"]||(l=Rm.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(f=0;f<wp.length;f++)if(o=wp[f],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,h=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(p=l["s-nr"],p&&p["s-sn"]===a["s-sn"]&&c===p.parentNode&&(p=p.nextSibling,!p||!p["s-nr"])){h=p;break}(!h&&c!==a.parentNode||a.nextSibling!==h)&&a!==h&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,h))}else a.nodeType===1&&(a.hidden=!0)}G4&&T1e(n.$elm$),$a.$flags$&=-2,wp.length=0}},GBe=(t,e)=>{},MJ=(t,e)=>(t.$flags$|=16,GBe(t,t.$ancestorComponent$),dze(()=>jBe(t,e))),jBe=(t,e)=>{const i=t.$hostElement$,r=Nx("scheduleUpdate",t.$cmpMeta$.$tagName$),s=i;let n;return e?n=bE(s,"componentWillLoad"):n=bE(s,"componentWillUpdate"),n=Xre(n,()=>bE(s,"componentWillRender")),r(),Xre(n,()=>HBe(t,s,e))},HBe=async(t,e,i)=>{const r=t.$hostElement$,s=Nx("update",t.$cmpMeta$.$tagName$);r["s-rc"],i&&VBe(t);const n=Nx("render",t.$cmpMeta$.$tagName$);qBe(t,e,r),n(),s(),WBe(t)},qBe=(t,e,i)=>{try{kre=e,e=e.render&&e.render(),t.$flags$&=-17,t.$flags$|=2,(q2.hasRenderFn||q2.reflect)&&(q2.vdomRender||q2.reflect)&&(q2.hydrateServerSide||zBe(t,e))}catch(a){aI(a,t.$hostElement$)}return kre=null,null},WBe=t=>{const e=t.$cmpMeta$.$tagName$,i=t.$hostElement$,r=Nx("postUpdate",e),s=i;t.$ancestorComponent$,bE(s,"componentDidRender"),t.$flags$&64?(bE(s,"componentDidUpdate"),r()):(t.$flags$|=64,bE(s,"componentDidLoad"),r())},D3t=t=>{{const e=oI(t),i=e.$hostElement$.isConnected;return i&&(e.$flags$&18)===2&&MJ(e,!1),i}},bE=(t,e,i)=>{if(t&&t[e])try{return t[e](i)}catch(r){aI(r)}},Xre=(t,e)=>t&&t.then?t.then(e):e(),XBe=(t,e)=>oI(t).$instanceValues$.get(e),YBe=(t,e,i,r)=>{const s=oI(t),n=t,o=s.$instanceValues$.get(e),a=s.$flags$,l=n;i=LBe(i,r.$members$[e][0]);const c=Number.isNaN(o)&&Number.isNaN(i);if(i!==o&&!c){s.$instanceValues$.set(e,i);{if(r.$watchers$&&a&128){const p=r.$watchers$[e];p&&p.map(f=>{try{l[f](i,o,e)}catch(m){aI(m,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(i,o,e)===!1)return;MJ(s,!1)}}}},ZBe=(t,e,i)=>{if(e.$members$){t.watchers&&(e.$watchers$=t.watchers);const r=Object.entries(e.$members$),s=t.prototype;r.map(([n,[o]])=>{(o&31||o&32)&&Object.defineProperty(s,n,{get(){return XBe(this,n)},set(a){YBe(this,n,a,e)},configurable:!0,enumerable:!0})});{const n=new Map;s.attributeChangedCallback=function(o,a,l){$a.jmp(()=>{const c=n.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(s.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},t.observedAttributes=r.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return n.set(l,o),a[0]&512&&e.$attrsToReflect$.push([o,l]),l})}}return t},JBe=async(t,e,i,r,s)=>{if(!(e.$flags$&32)&&(s=t.constructor,e.$flags$|=32,customElements.whenDefined(i.$tagName$).then(()=>e.$flags$|=128),s.style)){let o=s.style;typeof o!="string"&&(o=o[e.$modeName$=$Be(t)]);const a=_1e(i,e.$modeName$);if(!q4.has(a)){const l=Nx("registerStyles",i.$tagName$);FBe(a,o,!!(i.$flags$&1)),l()}}e.$ancestorComponent$,(()=>MJ(e,!0))()},KBe=t=>{},QBe=t=>{if(!($a.$flags$&1)){const e=oI(t),i=e.$cmpMeta$,r=Nx("connectedCallback",i.$tagName$);e.$flags$&1?(C1e(t,e,i.$listeners$),KBe(e.$lazyInstance$)):(e.$flags$|=1,i.$flags$&12&&eze(t),i.$members$&&Object.entries(i.$members$).map(([s,[n]])=>{if(n&31&&t.hasOwnProperty(s)){const o=t[s];delete t[s],t[s]=o}}),JBe(t,e,i)),r()}},eze=t=>{const e=t["s-cr"]=Rm.createComment("");e["s-cn"]=!0,t.insertBefore(e,t.firstChild)},tze=t=>{if(!($a.$flags$&1)){const e=oI(t);e.$rmListeners$&&(e.$rmListeners$.map(i=>i()),e.$rmListeners$=void 0)}},N3t=(t,e)=>{const i={$flags$:e[0],$tagName$:e[1]};i.$members$=e[2],i.$listeners$=e[3],i.$watchers$=t.$watchers$,i.$attrsToReflect$=[],!Zre&&i.$flags$&1&&(i.$flags$|=8);const r=t.prototype.connectedCallback,s=t.prototype.disconnectedCallback;return Object.assign(t.prototype,{__registerHost(){nze(this,i)},connectedCallback(){QBe(this),r&&r.call(this)},disconnectedCallback(){tze(this),s&&s.call(this)},__attachShadow(){Zre?this.attachShadow({mode:"open",delegatesFocus:!!(i.$flags$&16)}):this.shadowRoot=this}}),t.is=i.$tagName$,ZBe(t,i)},F3t=(t,e)=>e,C1e=(t,e,i,r)=>{i&&i.map(([s,n,o])=>{const a=rze(t,s),l=ize(e,o),c=sze(s);$a.ael(a,n,l,c),(e.$rmListeners$=e.$rmListeners$||[]).push(()=>$a.rel(a,n,l,c))})},ize=(t,e)=>i=>{try{q2.lazyLoad||t.$hostElement$[e](i)}catch(r){aI(r)}},rze=(t,e)=>e&4?Rm:e&8?lI:e&16?Rm.body:t,sze=t=>aze?{passive:(t&1)!==0,capture:(t&2)!==0}:(t&2)!==0,A1e=new WeakMap,oI=t=>A1e.get(t),nze=(t,e)=>{const i={$flags$:0,$hostElement$:t,$cmpMeta$:e,$instanceValues$:new Map};return C1e(t,i,e.$listeners$),A1e.set(t,i)},Yre=(t,e)=>e in t,aI=(t,e)=>(0,console.error)(t,e),q4=new Map,oze=[],lI=typeof window<"u"?window:{},Rm=lI.document||{head:{}},U3t=lI.HTMLElement||class{},$a={$flags$:0,$resourcesUrl$:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,e,i,r)=>t.addEventListener(e,i,r),rel:(t,e,i,r)=>t.removeEventListener(e,i,r),ce:(t,e)=>new CustomEvent(t,e)},Zre=!0,aze=(()=>{let t=!1;try{Rm.addEventListener("e",null,Object.defineProperty({},"passive",{get(){t=!0}}))}catch{}return t})(),lze=t=>Promise.resolve(t),cze=(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})(),Jre=[],O1e=[],uze=(t,e)=>i=>{t.push(i),gj||(gj=!0,e&&$a.$flags$&4?hze(yj):$a.raf(yj))},Kre=t=>{for(let e=0;e<t.length;e++)try{t[e](performance.now())}catch(i){aI(i)}t.length=0},yj=()=>{Kre(Jre),Kre(O1e),(gj=Jre.length>0)&&$a.raf(yj)},hze=t=>lze().then(t),dze=uze(O1e,!0);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.8-next.4
 */const R1e="calcite-mode-auto",M1e="calcite-mode-dark",pze="calcite-mode-light",V3t={autoMode:R1e,darkMode:M1e,lightMode:pze,rtl:"calcite--rtl"};/*!
* tabbable 6.0.1
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var P1e=["input","select","textarea","a[href]","button","[tabindex]:not(slot)","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])',"details>summary:first-of-type","details"],W4=P1e.join(","),I1e=typeof Element>"u",Fx=I1e?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,X4=!I1e&&Element.prototype.getRootNode?function(t){return t.getRootNode()}:function(t){return t.ownerDocument},$1e=function(e,i,r){var s=Array.prototype.slice.apply(e.querySelectorAll(W4));return i&&Fx.call(e,W4)&&s.unshift(e),s=s.filter(r),s},L1e=function t(e,i,r){for(var s=[],n=Array.from(e);n.length;){var o=n.shift();if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=t(l,!0,r);r.flatten?s.push.apply(s,c):s.push({scopeParent:o,candidates:c})}else{var h=Fx.call(o,W4);h&&r.filter(o)&&(i||!e.includes(o))&&s.push(o);var p=o.shadowRoot||typeof r.getShadowRoot=="function"&&r.getShadowRoot(o),f=!r.shadowRootFilter||r.shadowRootFilter(o);if(p&&f){var m=t(p===!0?o.children:p.children,!0,r);r.flatten?s.push.apply(s,m):s.push({scopeParent:o,candidates:m})}else n.unshift.apply(n,o.children)}}return s},D1e=function(e,i){return e.tabIndex<0&&(i||/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||e.isContentEditable)&&isNaN(parseInt(e.getAttribute("tabindex"),10))?0:e.tabIndex},fze=function(e,i){return e.tabIndex===i.tabIndex?e.documentOrder-i.documentOrder:e.tabIndex-i.tabIndex},N1e=function(e){return e.tagName==="INPUT"},mze=function(e){return N1e(e)&&e.type==="hidden"},gze=function(e){var i=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(r){return r.tagName==="SUMMARY"});return i},yze=function(e,i){for(var r=0;r<e.length;r++)if(e[r].checked&&e[r].form===i)return e[r]},_ze=function(e){if(!e.name)return!0;var i=e.form||X4(e),r=function(a){return i.querySelectorAll('input[type="radio"][name="'+a+'"]')},s;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")s=r(window.CSS.escape(e.name));else try{s=r(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var n=yze(s,e.form);return!n||n===e},vze=function(e){return N1e(e)&&e.type==="radio"},bze=function(e){return vze(e)&&!_ze(e)},wze=function(e){for(var i,r=X4(e).host,s=!!((i=r)!==null&&i!==void 0&&i.ownerDocument.contains(r)||e.ownerDocument.contains(e));!s&&r;){var n;r=X4(r).host,s=!!((n=r)!==null&&n!==void 0&&n.ownerDocument.contains(r))}return s},Qre=function(e){var i=e.getBoundingClientRect(),r=i.width,s=i.height;return r===0&&s===0},xze=function(e,i){var r=i.displayCheck,s=i.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var n=Fx.call(e,"details>summary:first-of-type"),o=n?e.parentElement:e;if(Fx.call(o,"details:not([open]) *"))return!0;if(!r||r==="full"||r==="legacy-full"){if(typeof s=="function"){for(var a=e;e;){var l=e.parentElement,c=X4(e);if(l&&!l.shadowRoot&&s(l)===!0)return Qre(e);e.assignedSlot?e=e.assignedSlot:!l&&c!==e.ownerDocument?e=c.host:e=l}e=a}if(wze(e))return!e.getClientRects().length;if(r!=="legacy-full")return!0}else if(r==="non-zero-area")return Qre(e);return!1},Tze=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var i=e.parentElement;i;){if(i.tagName==="FIELDSET"&&i.disabled){for(var r=0;r<i.children.length;r++){var s=i.children.item(r);if(s.tagName==="LEGEND")return Fx.call(i,"fieldset[disabled] *")?!0:!s.contains(e)}return!0}i=i.parentElement}return!1},Y4=function(e,i){return!(i.disabled||mze(i)||xze(i,e)||gze(i)||Tze(i))},_j=function(e,i){return!(bze(i)||D1e(i)<0||!Y4(e,i))},Sze=function(e){var i=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(i)||i>=0)},Eze=function t(e){var i=[],r=[];return e.forEach(function(s,n){var o=!!s.scopeParent,a=o?s.scopeParent:s,l=D1e(a,o),c=o?t(s.candidates):a;l===0?o?i.push.apply(i,c):i.push(a):r.push({documentOrder:n,tabIndex:l,item:s,isScope:o,content:c})}),r.sort(fze).reduce(function(s,n){return n.isScope?s.push.apply(s,n.content):s.push(n.content),s},[]).concat(i)},Cze=function(e,i){i=i||{};var r;return i.getShadowRoot?r=L1e([e],i.includeContainer,{filter:_j.bind(null,i),flatten:!1,getShadowRoot:i.getShadowRoot,shadowRootFilter:Sze}):r=$1e(e,i.includeContainer,_j.bind(null,i)),Eze(r)},k3t=function(e,i){i=i||{};var r;return i.getShadowRoot?r=L1e([e],i.includeContainer,{filter:Y4.bind(null,i),flatten:!0,getShadowRoot:i.getShadowRoot}):r=$1e(e,i.includeContainer,Y4.bind(null,i)),r},B3t=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return Fx.call(e,W4)===!1?!1:_j(i,e)},Aze=P1e.concat("iframe").join(","),z3t=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return Fx.call(e,Aze)===!1?!1:Y4(i,e)};const Oze={getShadowRoot:!0};function G3t(t){const e="dir",i=`[${e}]`,r=Rze(t,i);return r?r.getAttribute(e):"ltr"}function j3t(t,e,i){const r=`[${e}]`,s=t.closest(r);return s?s.getAttribute(e):i}function F1e(t){return t.getRootNode()}function U1e(t){return t.host||null}function H3t(t,{selector:e,id:i}){function r(s){if(!s)return null;s.assignedSlot&&(s=s.assignedSlot);const n=F1e(s),o=i?"getElementById"in n?n.getElementById(i):null:e?n.querySelector(e):null,a=U1e(n);return o||(a?r(a):null)}return r(t)}function Rze(t,e){function i(r){return r?r.closest(e)||i(U1e(F1e(r))):null}return i(t)}function Mze(t,e){return V1e(t,e)}function V1e(t,e){if(!t)return;const i=e(t);if(i!==void 0)return i;const{parentNode:r}=t;return V1e(r instanceof ShadowRoot?r.host:r,e)}function q3t(t,e){return!!Mze(e,i=>i===t?!0:void 0)}function Pze(t){return typeof(t==null?void 0:t.setFocus)=="function"}async function W3t(t){if(t)return Pze(t)?t.setFocus():t.focus()}function X3t(t){(Cze(t,Oze)[0]||t).focus()}const Y3=":not([slot])";function Y3t(t,e,i){e&&!Array.isArray(e)&&typeof e!="string"&&(i=e,e=null);const r=e?Array.isArray(e)?e.map(s=>`[slot="${s}"]`).join(","):`[slot="${e}"]`:Y3;return i!=null&&i.all?Ize(t,r,i):$ze(t,r,i)}function k1e(t,e){return t?Array.from(t.children||[]).filter(i=>i==null?void 0:i.matches(e)):[]}function Ize(t,e,i){let r=e===Y3?k1e(t,Y3):Array.from(t.querySelectorAll(e));r=i&&i.direct===!1?r:r.filter(n=>n.parentElement===t),r=i!=null&&i.matches?r.filter(n=>n==null?void 0:n.matches(i.matches)):r;const s=i==null?void 0:i.selector;return s?r.map(n=>Array.from(n.querySelectorAll(s))).reduce((n,o)=>[...n,...o],[]).filter(n=>!!n):r}function $ze(t,e,i){let r=e===Y3?k1e(t,Y3)[0]||null:t.querySelector(e);r=i&&i.direct===!1||(r==null?void 0:r.parentElement)===t?r:null,r=i!=null&&i.matches?r!=null&&r.matches(i.matches)?r:null:r;const s=i==null?void 0:i.selector;return s?r==null?void 0:r.querySelector(s):r}function Z3t(t,e,i){if(typeof e=="string"&&e!=="")return e;if(e==="")return t[i]}function J3t(t){return Boolean(t).toString()}function K3t(t){return!!Lze(t).length}function Lze(t){return t.target.assignedElements({flatten:!0})}function Q3t(t){return!!(t.isPrimary&&t.button===0)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.8-next.4
 */function ese(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,i=()=>t.contains(M1e)||t.contains(R1e)&&e?"dark":"light",r=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),s=o=>{n!==o&&r(o),n=o};let n=i();r(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>s(o.matches?"dark":"light")),new MutationObserver(()=>s(i())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function Dze(){typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?ese():document.addEventListener("DOMContentLoaded",()=>ese(),{once:!0}))}const Nze=Dze;Nze();let B1e;function Fze(){EBe(Gu(ir(B1e)))}B1e="components/assets";const z1e=Symbol("widget"),Uze=Symbol("widget-test-data"),Vze=[],kze={},Z4=new WeakMap;function G1e(t,e){let i=e.children;if(i&&i.length)for(let s=0;s<i.length;++s)i[s]=G1e(t,i[s]);else i=Vze;const r=e.vnodeSelector;if(PJ(r)){const s=e.properties||kze,n=s.key||r;return{vnodeSelector:"div",properties:{key:n,afterCreate:Bze,afterUpdate:zze,afterRemoved:j1e,parentWidget:t,widgetConstructor:r,widgetProperties:{...s,key:n,children:i}},children:void 0,text:void 0,domNode:null}}return e}function Bze(t,e,i,{parentWidget:r,widgetConstructor:s,widgetProperties:n}){var a;const o=new s(n);o.container=t,Z4.set(t,o),(a=o.afterCreate)==null||a.call(o,o,t),r._internalHandles.add(Wp(()=>j1e(t)))}function zze(t,e,i,{widgetProperties:r}){var n;const s=Z4.get(t);s&&(s.set(r),(n=s.afterUpdate)==null||n.call(s,s,t))}function j1e(t){var i;const e=Z4.get(t);e&&((i=e.afterRemoved)==null||i.call(e,e,t),e.destroy(),Z4.delete(t))}function PJ(t){return typeof t=="function"&&t[z1e]}const tse=new Set;function Gze(t){tse.add(t),t.finally(()=>tse.delete(t))}var H1e;const jze="esri.widgets.Widget";let Hze=0;const qze={widgetIcon:"esri-icon-checkbox-unchecked"};function q1e(t,e){for(const i in e)t[i]!=null&&(typeof t[i]=="object"&&typeof e[i]=="object"?q1e(t[i],e==null?void 0:e[i]):t[i]=e[i]);return t}const Wze=SBe({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,i=/capture$/i;t.eventHandlerInterceptor=(r,s,n,o)=>{const a=e==null?void 0:e(r,s,n,o),l=i.test(r);if(!((r=r.replace(i,"")).toLowerCase()in n)||l){const c=r[2].toLowerCase()+r.slice(3),h=m=>a==null?void 0:a.call(n,m);n.addEventListener(c,h,l);const p=()=>n.removeEventListener(c,h,l),f=o.afterRemoved;o.afterRemoved=m=>{f==null||f(m),p()}}return a}},handleInterceptedEvent(t,e,i,r){const{eventPhase:s,type:n}=r,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=e.properties;(l&&a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,l&&a in l))&&(s1e(),t.scheduleRender(),l[a].call(l.bind||i,r))}});let KV=!1,Ao=class extends oU(As.EventedAccessor){constructor(e,i){super(e,i),this._attached=!1,this._internalHandles=new Ki,this._projector=Wze,this._readyForTrueRender=!1,this.iconClass=qze.widgetIcon,this.key=this,this._loadLocale=Rme(async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const o=await lc(this._messageBundleProps.map(async({bundlePath:a,propertyName:l})=>{let c=await t_e(a);this.uiStrings&&Object.keys(this.uiStrings)&&(c=q1e(ae(c),this.uiStrings)),this[l]=c}));for(const a of o)a.error&&oe.getLogger(this.declaredClass).error("widget-intl:locale-error",this.declaredClass,a.error)}await this.loadLocale()}),Fze();const r="esri-widget-uid-"+_Be(),s=this.render.bind(this);this._trackingTarget=new U6(()=>this.scheduleRender());const n=()=>{var p;if(!this._readyForTrueRender||this.destroyed)return null;if(!this.visible)return{vnodeSelector:"div",properties:{key:r,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0};const o=s();let{properties:a}=o;a||(o.properties=a={});let{key:l,styles:c}=a;l||(a.key=r),c||(a.styles=c={}),c.display||(c.display="");let h=0;return(p=o.children)==null||p.forEach(f=>{if(PJ(f.vnodeSelector))return;let{properties:m}=f;m||(f.properties=m={}),m.key||(m.key=`${this.id}--${h++}`)}),G1e(this,o)};this.render=()=>{if(KV)return n();let o=Z9e(this)??null;if(o)return o;this._trackingTarget.clear(),KV=!0;try{o=Vy(this._trackingTarget,n)}catch(a){throw console.error(a),a}finally{KV=!1}return o&&J9e(this,o),o},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()})),Gze(this._resourcesFetch)}normalizeCtorArgs(e,i){const r={...e};return i&&(r.container=i),r}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(Jz)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(Je(this._trackingTarget),Je(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,ZV(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return pU(e)}get domNode(){return this.container}set domNode(e){this.container=e}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+Hze++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(H1e=z1e,Uze)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(ZV(this),this._projector.scheduleRender())}classes(...e){return o1e.apply(this,e)}renderNow(){ZV(this),this._projector.renderNow()}_postInitialize(){var i;if(this.destroyed)return;this.scheduleRender(),(i=this._delegatedEventNames)!=null&&i.length&&this._internalHandles.add(re(()=>this.viewModel,(r,s)=>{s&&this._internalHandles.remove("delegated-events"),r&&D6(r)&&this._internalHandles.add(this._delegatedEventNames.map(n=>HP(r,n,o=>{this.emit(n,o)})),"delegated-events")},Zt)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(Jz),this.scheduleRender()};this._internalHandles.add([xye(e),re(()=>this.uiStrings,e),qo(()=>this.container,r=>{this.destroyed||this._attach(r)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){var i;this._attached&&(this._projector.detach(this.render),this._attached=!1),(i=e==null?void 0:e.parentNode)==null||i.removeChild(e)}};Ao[H1e]=!0,u([d()],Ao.prototype,"_readyForTrueRender",void 0),u([d({value:null})],Ao.prototype,"container",null),u([wi("container")],Ao.prototype,"castContainer",null),u([d()],Ao.prototype,"iconClass",void 0),u([d()],Ao.prototype,"id",null),u([d()],Ao.prototype,"label",null),u([d()],Ao.prototype,"renderable",null),u([d()],Ao.prototype,"uiStrings",void 0),u([d()],Ao.prototype,"viewModel",void 0),u([d({value:!0})],Ao.prototype,"visible",null),u([d()],Ao.prototype,"key",void 0),u([d()],Ao.prototype,"children",void 0),u([d()],Ao.prototype,"afterCreate",void 0),u([d()],Ao.prototype,"afterUpdate",void 0),u([d()],Ao.prototype,"afterRemoved",void 0),Ao=u([I(jze)],Ao);const bl=Ao;function Xze(t,e,i){return t.units[e][i]}function IU(t,e,i,r=2,s="abbr"){return`${km(e,{minimumFractionDigits:r,maximumFractionDigits:r,signDisplay:e>0?"never":"exceptZero"})} ${Xze(t,i,s)}`}function tPt(t,e,i,r=2,s="abbr"){const n=$ge(e,i);return IU(t,An(e,i,n),n,r,s)}function iPt(t,e,i,r=2,s="abbr"){const n=Lge(e,i);return IU(t,An(e,i,n),n,r,s)}function rPt(t,e,i,r=2,s="abbr"){const n=Dge(e,i);return IU(t,An(e,i,n),n,r,s)}function sPt(t,e,i,r=2,s="abbr"){const n=Nge(e,i);return IU(t,An(e,i,n),n,r,s)}const ise=["B","kB","MB","GB","TB"];function Yze(t,e){let i=e===0?0:Math.floor(Math.log(e)/Math.log(dC.KILOBYTES));i=we(i,0,ise.length-1);const r=km(e/dC.KILOBYTES**i,{maximumFractionDigits:2});return Fm(t.units.bytes[ise[i]],{fileSize:r})}function Zze(t){const{exifInfo:e,exifName:i,tagName:r}=t;if(!e||!i||!r)return null;const s=e.find(n=>n.name===i);return s?Jze({tagName:r,tags:s.tags}):null}function Jze(t){const{tagName:e,tags:i}=t;if(!i||!e)return null;const r=i.find(s=>s.name===e);return r&&r.value||null}var vj;const Kze={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let Tc=vj=class extends Ie{constructor(t){super(t),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:t}=this,e=Zze({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:t});return Kze[e]||null}clone(){return new vj({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};u([d({type:String})],Tc.prototype,"contentType",void 0),u([d()],Tc.prototype,"exifInfo",void 0),u([d({readOnly:!0})],Tc.prototype,"orientationInfo",null),u([d({type:Yr})],Tc.prototype,"id",void 0),u([d({type:String})],Tc.prototype,"globalId",void 0),u([d({type:String})],Tc.prototype,"keywords",void 0),u([d({type:String})],Tc.prototype,"name",void 0),u([d({json:{read:!1}})],Tc.prototype,"parentGlobalId",void 0),u([d({json:{read:!1}})],Tc.prototype,"parentObjectId",void 0),u([d({type:Yr})],Tc.prototype,"size",void 0),u([d({json:{read:!1}})],Tc.prototype,"url",void 0),Tc=vj=u([I("esri.layers.support.AttachmentInfo")],Tc);const Qze=Tc;var bj;let Ko=bj=class extends Ie{constructor(t){super(t),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new bj(ae({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};u([d({type:[String],json:{write:!0}})],Ko.prototype,"attachmentTypes",void 0),u([d({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],Ko.prototype,"attachmentsWhere",void 0),u([d({type:Boolean,json:{write:!0}})],Ko.prototype,"cacheHint",void 0),u([d({type:[String],json:{write:!0}})],Ko.prototype,"keywords",void 0),u([d({type:[Number],json:{write:!0}})],Ko.prototype,"globalIds",void 0),u([d({json:{write:!0}})],Ko.prototype,"name",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],Ko.prototype,"num",void 0),u([d({type:[Number],json:{write:!0}})],Ko.prototype,"objectIds",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Ko.prototype,"returnMetadata",void 0),u([d({type:[Number],json:{write:!0}})],Ko.prototype,"size",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],Ko.prototype,"start",void 0),u([lt("start"),lt("num")],Ko.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Ko.prototype,"where",void 0),Ko=bj=u([I("esri.rest.support.AttachmentQuery")],Ko),Ko.from=mn(Ko);const wj=Ko,e7e="esri.widgets.Feature.support.featureUtils",rse=oe.getLogger(e7e),t7e=/href=(""|'')/gi,i7e=/(\{([^\{\r\n]+)\})/g,r7e=/\'/g,W1e=/^\s*expression\//i,s7e=/(\n)/gi,n7e=/[\u00A0-\u9999<>\&]/gim,o7e=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,a7e=/^(?:mailto:|tel:)/,X1e="relationships/",xj=Y6("short-date-short-time");function Y1e(t){if(!C(t))return t.get("sourceLayer")||t.get("layer")}async function J4(t,e){return typeof t=="function"?t.call(null,e):t}function Z1e(t=""){if(t)return!a7e.test(t.trim().toLowerCase())}function IJ(t){return!!t&&W1e.test(t)}function l7e(t,e){if(!IJ(e)||!t)return null;const i=e.replace(W1e,"").toLowerCase();let r=null;return t.some(s=>s.name.toLowerCase()===i&&(r=s,!0)),r}function J1e(t,e){const i=l7e(e,t==null?void 0:t.fieldName);return i?i.title||null:t?t.label||t.fieldName:null}function c7e(t,e){const i=e.get(t.toLowerCase());return`{${i&&i.fieldName||t}}`}function u7e(t){return t.replace(t7e,"")}function Z3(t,e){const i=$J(e,t);return i?i.name:t}function h7e(t,e){return t&&t.map(i=>Z3(i,e))}function $J(t,e){return t&&typeof t.getField=="function"&&e?t.getField(e)??null:null}function K1e(t){return`${t}`.trim()}function Ww({attributes:t,globalAttributes:e,layer:i,text:r,expressionAttributes:s,fieldInfoMap:n}){return r?Tj({formattedAttributes:e,template:m7e(r,{...e,...s,...t},i),fieldInfoMap:n}):""}function Tj({formattedAttributes:t,template:e,fieldInfoMap:i}){return K1e(u7e(Fm(Fm(e,r=>c7e(r,i)),t)))}function d7e(t,e,i=!1){const r=e[t];if(typeof r=="string"){const s="%27",n=(i?encodeURIComponent(r):r).replace(r7e,s);e[t]=n}}function p7e(t,e=!1){const i={...t};return Object.keys(i).forEach(r=>d7e(r,i,e)),i}function f7e(t,e,i){const r=(e=K1e(e))&&e[0]!=="{";return Fm(t,p7e(i,r||!1))}function Sj(t,e){return t.replace(i7e,(i,r,s)=>{const n=$J(e,s);return n?`{${n.name}}`:r})}function m7e(t,e,i){const r=Sj(t,i);return r&&r.replace(o7e,(s,n,o)=>f7e(s,n||o,e))}function g7e(t,e){if(typeof t=="string"&&e&&e.dateFormat==null&&(e.places!=null||e.digitSeparator!=null)){const i=Number(t);if(!isNaN(i))return i}return t}function y7e(t){return(t==null?void 0:t.type)==="feature"}function sse(t){return!!(t!=null&&t.layer)}function _7e(t){return(t==null?void 0:t.type)==="map-image"}function v7e(t,e){var c;const i=e.fieldInfos,r=e.fieldName,s=(c=Q1e(i,r))==null?void 0:c.clone(),n=e.preventPlacesFormatting,o=e.layer,a=$J(o,r);if(s&&(a==null?void 0:a.type)==="date"){const h=s.format||new zS;h.dateFormat=h.dateFormat||"short-date-short-time",h.dateTimeFormatOptions=!sse(o)&&y7e(o)&&o.datesInUnknownTimezone||sse(o)&&_7e(o.layer)&&o.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,s.format=h}const l=s&&s.format;return typeof t=="string"&&vye(r)&&l?l.formatRasterPixelValue(t):typeof(t=g7e(t,l))=="string"||t==null||l==null?cI(t):n?km(t,{...Eye(l),minimumFractionDigits:0,maximumFractionDigits:20}):l.format(t)}function Q1e(t,e){if(!t||!t.length||!e)return;const i=e.toLowerCase();let r;return t.some(s=>!(!s.fieldName||s.fieldName.toLowerCase()!==i)&&(r=s,!0)),r}function b7e({fieldName:t,graphic:e,layer:i}){if(by(t)||!i||typeof i.getFeatureType!="function")return null;const{typeIdField:r}=i;if(!r||t!==r)return null;const s=i.getFeatureType(e);return s?s.name:null}function w7e({fieldName:t,value:e,graphic:i,layer:r}){if(by(t)||!r||typeof r.getFieldDomain!="function")return null;const s=i&&r.getFieldDomain(t,{feature:i});return s&&s.type==="coded-value"?s.getName(e):null}function x7e(t,e){const{creatorField:i,creationDateField:r,editorField:s,editDateField:n}=t;if(!e)return;const o=e[n];if(typeof o=="number"){const l=e[s];return{type:"edit",date:Vm(o,xj),user:l}}const a=e[r];if(typeof a=="number"){const l=e[i];return{type:"create",date:Vm(a,xj),user:l}}return null}function T7e(t,e){const i=new Map;return t&&t.forEach(r=>{const s=Z3(r.fieldName,e);r.fieldName=s,i.set(s.toLowerCase(),r)}),i}function nse(t){const e=[];if(!t)return e;const{fieldInfos:i,content:r}=t;return i&&e.push(...i),r&&Array.isArray(r)&&r.forEach(s=>{if(s.type==="fields"){const n=s&&s.fieldInfos;n&&e.push(...n)}}),e}function LJ(t){return t.replace(n7e,e=>`&#${e.charCodeAt(0)};`)}function cI(t){return typeof t=="string"?t.replace(s7e,'<br class="esri-text-new-line" />'):t}function ebe(t){const{value:e,fieldName:i,fieldInfos:r,fieldInfoMap:s,layer:n,graphic:o}=t;if(e==null)return"";const a=w7e({fieldName:i,value:e,graphic:o,layer:n});if(a)return a;const l=b7e({fieldName:i,graphic:o,layer:n});if(l)return l;if(s.get(i.toLowerCase()))return v7e(e,{fieldInfos:r||Array.from(s.values()),fieldName:i,layer:n});const c=n&&n.fieldsIndex;return c&&c.isDateField(i)?Vm(e,xj):cI(e)}function QV({fieldInfos:t,attributes:e,layer:i,graphic:r,fieldInfoMap:s,relatedInfos:n}){const o={};return n==null||n.forEach(a=>A7e({attributes:o,relatedInfo:a,fieldInfoMap:s,fieldInfos:t,layer:i})),e&&Object.keys(e).forEach(a=>{const l=e[a];o[a]=ebe({fieldName:a,fieldInfos:t,fieldInfoMap:s,layer:i,value:l,graphic:r})}),o}async function tbe(t,e){var h,p;const{layer:i,graphic:r,outFields:s,objectIds:n,returnGeometry:o,spatialReference:a}=t,l=n[0];if(typeof l!="number"&&typeof l!="string"){const f="Could not query required fields for the specified feature. The feature's ID is invalid.",m={layer:i,graphic:r,objectId:l,requiredFields:s};return rse.warn(f,m),null}if(!((p=(h=zve(i))==null?void 0:h.operations)!=null&&p.supportsQuery)){const f="The specified layer cannot be queried. The following fields will not be available.",m={layer:i,graphic:r,requiredFields:s,returnGeometry:o};return rse.warn(f,m),null}const c=i.createQuery();return c.objectIds=n,c.outFields=s!=null&&s.length?s:[i.objectIdField],c.returnGeometry=!!o,c.returnZ=!!o,c.returnM=!!o,c.outSpatialReference=a,(await i.queryFeatures(c,e)).features[0]}async function S7e(t){var r;if(!((r=t.expressionInfos)!=null&&r.length))return!1;const e=await Um(),{arcadeUtils:{hasGeometryFunctions:i}}=e;return i(t)}async function E7e({graphic:t,popupTemplate:e,layer:i,spatialReference:r},s){if(!i||!e||(typeof i.load=="function"&&await i.load(s),!t.attributes))return;const n=t.attributes[i.objectIdField];if(n==null)return;const o=[n],a=await e.getRequiredFields(i.fieldsIndex),l=$5e(a,t),c=l?[]:a,h=e.returnGeometry||await S7e(e);if(l&&!h)return;const p=await tbe({layer:i,graphic:t,outFields:c,objectIds:o,returnGeometry:h,spatialReference:r},s);p&&(p.geometry&&(t.geometry=p.geometry),p.attributes&&(t.attributes={...t.attributes,...p.attributes}))}function by(t=""){return!!t&&t.includes(X1e)}function C7e(t){return t?`${X1e}${t.layerId}/${t.fieldName}`:""}function ose({attributes:t,graphic:e,relatedInfo:i,fieldInfos:r,fieldInfoMap:s,layer:n}){t&&e&&i&&Object.keys(e.attributes).forEach(o=>{const a=C7e({layerId:i.relation.id.toString(),fieldName:o}),l=e.attributes[o];t[a]=ebe({fieldName:a,fieldInfos:r,fieldInfoMap:s,layer:n,value:l,graphic:e})})}function A7e({attributes:t,relatedInfo:e,fieldInfoMap:i,fieldInfos:r,layer:s}){t&&e&&(e.relatedFeatures&&e.relatedFeatures&&e.relatedFeatures.forEach(n=>ose({attributes:t,graphic:n,relatedInfo:e,fieldInfoMap:i,fieldInfos:r,layer:s})),e.relatedStatsFeatures&&e.relatedStatsFeatures&&e.relatedStatsFeatures.forEach(n=>ose({attributes:t,graphic:n,relatedInfo:e,fieldInfoMap:i,fieldInfos:r,layer:s})))}const ase=t=>{if(!t)return!1;const e=t.toUpperCase();return e.includes("CURRENT_TIMESTAMP")||e.includes("CURRENT_DATE")||e.includes("CURRENT_TIME")},ibe=({layer:t,method:e,query:i,definitionExpression:r})=>{var o,a;if(!((a=(o=t.capabilities)==null?void 0:o.query)!=null&&a.supportsCacheHint)||e==="attachments")return;const s=v(i.where)?i.where:null,n=v(i.geometry)?i.geometry:null;ase(r)||ase(s)||(n==null?void 0:n.type)==="extent"||i.resultType==="tile"||(i.cacheHint=!0)},O7e=({query:t,layer:e,method:i})=>{ibe({layer:e,method:i,query:t,definitionExpression:`${e.definitionExpression} ${e.serviceDefinitionExpression}`})},R7e=({queryPayload:t,layer:e,method:i})=>{ibe({layer:e,method:i,query:t,definitionExpression:`${e.definitionExpression} ${e.serviceDefinitionExpression}`})};function M7e(t,e,i){return t&&e&&i?lse(t.allLayers,e,i)||lse(t.allTables,e,i):null}function lse(t,e,i){return t.find(r=>r!==e&&r.type==="feature"&&r.url===e.url&&r.layerId===i.relatedTableId)}const cse={editing:!1,operations:{add:!0,update:!0,delete:!0}},rbe=Nt.ofType(Qze);let Sc=class extends $e{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities={...cse},this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new rbe,this.fileInfos=new Nt,this.graphic=null,this.mode="view",this.filesEnabled=!1,this.addHandles(re(()=>this.graphic,()=>this._graphicChanged(),Zt))}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(e){return{...cse,...e}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){const{graphic:e}=this;if(!e)return!1;const i=e.layer||e.sourceLayer;return(i==null?void 0:i.loaded)&&"capabilities"in i&&i.capabilities&&"operations"in i.capabilities&&"supportsResizeAttachments"in i.capabilities.operations&&i.capabilities.operations.supportsResizeAttachments||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:i}=this;if(!e||typeof e.queryAttachments!="function")throw new W("invalid-layer","getAttachments(): A valid layer is required.");const r=this._getObjectId(),s=new wj({objectIds:[r],returnMetadata:!0}),n=[],o=e.queryAttachments(s).then(l=>l[r]||n).catch(()=>n);this._getAttachmentsPromise=o,this.notifyChange("state");const a=await o;return i.removeAll(),a.length&&i.addMany(a),this._getAttachmentsPromise=null,this.notifyChange("state"),a}async addAttachment(e,i=this.graphic){var l;const{_attachmentLayer:r,attachmentInfos:s,abilities:n}=this;if(!i)throw new W("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:i});if(!e)throw new W("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!((l=n.operations)!=null&&l.add))throw new W("invalid-abilities","addAttachment(): add abilities are required.");if(!r||typeof r.addAttachment!="function")throw new W("invalid-layer","addAttachment(): A valid layer is required.");const o=r.addAttachment(i,e).then(c=>this._queryAttachment(c.objectId,i)),a=await o;return s.add(a),a}async deleteAttachment(e){var l;const{_attachmentLayer:i,attachmentInfos:r,graphic:s,abilities:n}=this;if(!e)throw new W("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!((l=n.operations)!=null&&l.delete))throw new W("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!i||typeof i.deleteAttachments!="function")throw new W("invalid-layer","deleteAttachment(): A valid layer is required.");if(!s)throw new W("invalid-graphic","deleteAttachment(): A graphic is required.");const o=i.deleteAttachments(s,[e.id]).then(()=>e),a=await o;return r.remove(a),a}async updateAttachment(e,i=this.activeAttachmentInfo){var h;const{_attachmentLayer:r,attachmentInfos:s,graphic:n,abilities:o}=this;if(!e)throw new W("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!i)throw new W("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:i});if(!((h=o.operations)!=null&&h.update))throw new W("invalid-abilities","updateAttachment(): Update abilities are required.");const a=s.findIndex(p=>p===i);if(!r||typeof r.updateAttachment!="function")throw new W("invalid-layer","updateAttachment(): A valid layer is required.");if(!n)throw new W("invalid-graphic","updateAttachment(): A graphic is required.");const l=r.updateAttachment(n,i.id,e).then(p=>this._queryAttachment(p.objectId)),c=await l;return s.splice(a,1,c),c}async commitFiles(){return await Promise.all(this.fileInfos.items.map(e=>this.addAttachment(e.form))),this.fileInfos.removeAll(),this.getAttachments()}addFile(e,i){if(!e||!i)return null;const r={file:e,form:i};return this.fileInfos.add(r),r}updateFile(e,i,r=this.activeFileInfo){if(!e||!i||!r)return null;const s=this.fileInfos.findIndex(n=>r===n);return s>-1&&this.fileInfos.splice(s,1,{file:e,form:i}),this.fileInfos.items[s]}deleteFile(e){const i=this.fileInfos.find(r=>r.file===e);return i?(this.fileInfos.remove(i),i):null}async _queryAttachment(e,i){const{_attachmentLayer:r}=this;if(!e||!(r!=null&&r.queryAttachments))throw new W("invalid-attachment-id","Could not query attachment.");const s=this._getObjectId(i),n=new wj({objectIds:[s],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return r.queryAttachments(n).then(o=>o[s][0])}_getObjectId(e=this.graphic){return(e==null?void 0:e.getObjectId())??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:e}=this,i=Y1e(e);this._attachmentLayer=i?i.type==="scene"&&v(i.associatedLayer)?i.associatedLayer:i:null}};u([d()],Sc.prototype,"abilities",void 0),u([wi("abilities")],Sc.prototype,"castAbilities",null),u([d()],Sc.prototype,"activeAttachmentInfo",void 0),u([d()],Sc.prototype,"activeFileInfo",void 0),u([d({readOnly:!0,type:rbe})],Sc.prototype,"attachmentInfos",void 0),u([d()],Sc.prototype,"fileInfos",void 0),u([d({type:ha})],Sc.prototype,"graphic",void 0),u([d()],Sc.prototype,"mode",void 0),u([d({readOnly:!0})],Sc.prototype,"state",null),u([d()],Sc.prototype,"filesEnabled",void 0),u([d({readOnly:!0})],Sc.prototype,"supportsResizeAttachments",null),Sc=u([I("esri.widgets.Attachments.AttachmentsViewModel")],Sc);const DJ=Sc;function use(t){const e=t.toLowerCase();return e==="image/bmp"||e==="image/emf"||e==="image/exif"||e==="image/gif"||e==="image/x-icon"||e==="image/jpeg"||e==="image/png"||e==="image/tiff"||e==="image/x-wmf"}function P7e(t){const e=ir("esri/themes/base/images/files/");return t?t==="text/plain"?`${e}text-32.svg`:t==="application/pdf"?`${e}pdf-32.svg`:t==="text/csv"?`${e}csv-32.svg`:t==="application/gpx+xml"?`${e}gpx-32.svg`:t==="application/x-dwf"?`${e}cad-32.svg`:t==="application/postscript"||t==="application/json"||t==="text/xml"||t==="model/vrml"?`${e}code-32.svg`:t==="application/x-zip-compressed"||t==="application/x-7z-compressed"||t==="application/x-gzip"||t==="application/x-tar"||t==="application/x-gtar"||t==="application/x-bzip2"||t==="application/gzip"||t==="application/x-compress"||t==="application/x-apple-diskimage"||t==="application/x-rar-compressed"||t==="application/zip"?`${e}zip-32.svg`:t.includes("image/")?`${e}image-32.svg`:t.includes("audio/")?`${e}sound-32.svg`:t.includes("video/")?`${e}video-32.svg`:t.includes("msexcel")||t.includes("ms-excel")||t.includes("spreadsheetml")?`${e}excel-32.svg`:t.includes("msword")||t.includes("ms-word")||t.includes("wordprocessingml")?`${e}word-32.svg`:t.includes("powerpoint")||t.includes("presentationml")?`${e}report-32.svg`:`${e}generic-32.svg`:`${e}generic-32.svg`}function dl(t){return(e,i)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:i})}}var I7e=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},sbe=function(t,e){for(var i=0,r=t.length;i<r;i++){var s=t[i];Array.isArray(s)?sbe(s,e):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=I7e(s)),e.push(s))}},$7e=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(i.length===1&&typeof i[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:i[0],domNode:null};var s=[];return sbe(i,s),{vnodeSelector:t,properties:e||void 0,children:s,text:void 0,domNode:null}};function le(t,e,...i){return typeof t!="function"||PJ(t)?$7e(t,e,...i):t(e,...i)}const hse={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},dr="esri-attachments",M1="esri-button",ct={base:dr,loaderContainer:`${dr}__loader-container`,loader:`${dr}__loader`,fadeIn:`${dr}--fade-in`,container:`${dr}__container`,containerList:`${dr}__container--list`,containerPreview:`${dr}__container--preview`,actions:`${dr}__actions`,deleteButton:`${dr}__delete-button`,addAttachmentButton:`${dr}__add-attachment-button`,errorMessage:`${dr}__error-message`,items:`${dr}__items`,item:`${dr}__item`,itemButton:`${dr}__item-button`,itemMask:`${dr}__item-mask`,itemMaskIcon:`${dr}__item-mask--icon`,itemImage:`${dr}__image`,itemImageResizable:`${dr}__image--resizable`,itemLabel:`${dr}__label`,itemFilename:`${dr}__filename`,itemChevronIcon:`${dr}__item-chevron-icon`,itemLink:`${dr}__item-link`,itemLinkOverlay:`${dr}__item-link-overlay`,itemLinkOverlayIcon:`${dr}__item-link-overlay-icon`,itemEditIcon:`${dr}__item-edit-icon`,itemAddIcon:`${dr}__item-add-icon`,itemAddButton:`${dr}__item-add-button`,formNode:`${dr}__form-node`,fileFieldset:`${dr}__file-fieldset`,fileLabel:`${dr}__file-label`,fileName:`${dr}__file-name`,fileInput:`${dr}__file-input`,metadata:`${dr}__metadata`,metadataFieldset:`${dr}__metadata-fieldset`,progressBar:`${dr}__progress-bar`,esriWidget:"esri-widget",esriButton:M1,buttonDisabled:`${M1}--disabled`,esriButtonSecondary:`${M1}--secondary`,esriButtonTertiary:`${M1}--tertiary`,esriButtonThird:`${M1}--third`,esriButtonSmall:`${M1}--small`,esriButtonHalf:`${M1}--half`,empty:"esri-widget__content--empty",iconExternalLink:"esri-icon-link-external",iconEdit:"esri-icon-edit",iconRight:"esri-icon-right",iconLeft:"esri-icon-left",iconPlus:"esri-icon-plus"},ek=window.CSS;let Ya=class extends bl{constructor(e,i){super(e,i),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements={...hse},this._supportsImageOrientation=ek&&ek.supports&&ek.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.viewModel||(this.viewModel=new DJ),this.addHandles([pn(()=>{var e;return(e=this.viewModel)==null?void 0:e.attachmentInfos},"change",()=>this.scheduleRender()),pn(()=>{var e;return(e=this.viewModel)==null?void 0:e.fileInfos},"change",()=>this.scheduleRender()),re(()=>{var e;return(e=this.viewModel)==null?void 0:e.mode},()=>this._modeChanged(),Zt)])}loadDependencies(){return Promise.all([ee(()=>import("./calcite-icon-1a5b9b53.js"),["./calcite-icon-1a5b9b53.js","./icon-f7d88fe1.js","./observers-4f67f1fb.js"],import.meta.url)])}get abilities(){return this.viewModel.abilities}set abilities(e){this.viewModel.abilities=e}get effectiveDisplayType(){const{displayType:e}=this;return e&&e!=="auto"?e:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}castVisibleElements(e){return{...hse,...e}}addAttachment(){const{_addAttachmentForm:e,viewModel:i}=this;return this._set("submitting",!0),this._set("error",null),i.addAttachment(e).then(r=>(this._set("submitting",!1),this._set("error",null),i.mode="view",r)).catch(r=>{throw this._set("submitting",!1),this._set("error",new W("attachments:add-attachment",this.messages.addErrorMessage,r)),r})}deleteAttachment(e){const{viewModel:i}=this;return this._set("submitting",!0),this._set("error",null),i.deleteAttachment(e).then(r=>(this._set("submitting",!1),this._set("error",null),i.mode="view",r)).catch(r=>{throw this._set("submitting",!1),this._set("error",new W("attachments:delete-attachment",this.messages.deleteErrorMessage,r)),r})}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:i}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(i).then(r=>(this._set("submitting",!1),this._set("error",null),e.mode="view",r)).catch(r=>{throw this._set("submitting",!1),this._set("error",new W("attachments:update-attachment",this.messages.updateErrorMessage,r)),r})}addFile(){const e=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",e}updateFile(){const{viewModel:e}=this,i=e.updateFile(this.selectedFile,this._updateAttachmentForm,e.activeFileInfo);return e.mode="view",i}deleteFile(e){var r;const i=this.viewModel.deleteFile(e||((r=this.viewModel.activeFileInfo)==null?void 0:r.file));return this.viewModel.mode="view",i}render(){const{submitting:e,viewModel:i}=this,{state:r}=i;return le("div",{class:this.classes(ct.base,ct.esriWidget)},e?this.renderProgressBar():null,r==="loading"?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:e,visibleElements:i}=this;return e&&i.errorMessage?le("div",{key:"error-message",class:ct.errorMessage},e.message):null}renderAttachments(){const{activeFileInfo:e,mode:i,activeAttachmentInfo:r}=this.viewModel;return i==="add"?this.renderAddForm():i==="edit"?this.renderDetailsForm(r||e):this.renderAttachmentContainer()}renderLoading(){return le("div",{class:ct.loaderContainer,key:"loader"},le("div",{class:ct.loader}))}renderProgressBar(){return this.visibleElements.progressBar?le("div",{class:ct.progressBar,key:"progress-bar"}):null}renderAddForm(){const{submitting:e,selectedFile:i}=this,r=e||!i,s=this.visibleElements.cancelAddButton?le("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(ct.esriButton,ct.esriButtonTertiary,ct.esriButtonSmall,ct.esriButtonHalf,e&&ct.buttonDisabled)},this.messages.cancel):null,n=this.visibleElements.addSubmitButton?le("button",{type:"submit",disabled:r,class:this.classes(ct.esriButton,ct.esriButtonSecondary,ct.esriButtonSmall,ct.esriButtonHalf,{[ct.buttonDisabled]:r})},this.messages.add):null,o=i?le("span",{key:"file-name",class:ct.fileName},i.name):null,a=le("form",{bind:this,afterCreate:B4,afterRemoved:$re,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},le("fieldset",{class:ct.fileFieldset},o,le("label",{class:this.classes(ct.fileLabel,ct.esriButton,ct.esriButtonSecondary)},i?this.messages.changeFile:this.messages.selectFile,le("input",{class:ct.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),n,s);return le("div",{key:"add-form-container",class:ct.formNode},a)}renderDetailsForm(e){var E,O,R;const{visibleElements:i,viewModel:r,selectedFile:s,submitting:n}=this,{abilities:o}=r,a=n||!s;let l,c,h,p;s?(l=s.type,c=s.name,h=s.size):e&&"file"in e?(l=e.file.type,c=e.file.name,h=e.file.size):e&&"contentType"in e&&(l=e.contentType,c=e.name,h=e.size,p=e.url);const f=o.editing&&((E=o.operations)!=null&&E.delete)&&i.deleteButton?le("button",{key:"delete-button",type:"button",disabled:n,bind:this,onclick:L=>this._submitDeleteAttachment(L,e),class:this.classes(ct.esriButton,ct.esriButtonSmall,ct.esriButtonTertiary,ct.deleteButton,{[ct.buttonDisabled]:n})},this.messages.delete):void 0,m=o.editing&&((O=o.operations)!=null&&O.update)&&i.updateButton?le("button",{disabled:a,key:"update-button",type:"submit",class:this.classes(ct.esriButton,ct.esriButtonSmall,ct.esriButtonThird,{[ct.buttonDisabled]:a})},this.messages.update):void 0,y=this.visibleElements.cancelUpdateButton?le("button",{disabled:n,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(ct.esriButton,ct.esriButtonSmall,ct.esriButtonTertiary,ct.esriButtonThird,{[ct.buttonDisabled]:n})},this.messages.cancel):void 0,_=o.editing&&((R=o.operations)!=null&&R.update)?le("fieldset",{key:"file",class:ct.fileFieldset},le("span",{key:"file-name",class:ct.fileName},c),le("label",{class:this.classes(ct.fileLabel,ct.esriButton,ct.esriButtonSecondary)},this.messages.changeFile,le("input",{class:ct.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):void 0,b=le("fieldset",{key:"size",class:ct.metadataFieldset},le("label",null,Yze(this.messagesUnits,h??0))),w=le("fieldset",{key:"content-type",class:ct.metadataFieldset},le("label",null,l)),S=v(p)?le("a",{class:ct.itemLink,href:p,rel:"noreferrer",target:"_blank"},this.renderImageMask(e,400),le("div",{class:ct.itemLinkOverlay},le("span",{class:ct.itemLinkOverlayIcon},le("calcite-icon",{icon:"launch"})))):this.renderImageMask(e,400),T=le("form",{bind:this,afterCreate:B4,afterRemoved:$re,"data-node-ref":"_updateAttachmentForm",onsubmit:L=>this._submitUpdateAttachment(L,e)},le("div",{class:ct.metadata},b,w),_,le("div",{class:ct.actions},f,y,m));return le("div",{key:"edit-form-container",class:ct.formNode},S,T)}renderImageMask(e,i){return e?"file"in e?this.renderGenericImageMask(e.file.name,e.file.type):this.renderImageMaskForAttachment(e,i):null}renderGenericImageMask(e,i){const{supportsResizeAttachments:r}=this.viewModel,s=P7e(i),n={[ct.itemImageResizable]:r};return le("div",{class:this.classes(ct.itemMaskIcon,ct.itemMask)},le("img",{title:e,alt:e,src:s,class:this.classes(n,ct.itemImage)}))}renderImageMaskForAttachment(e,i){const{supportsResizeAttachments:r}=this.viewModel;if(!e)return null;const{contentType:s,name:n,url:o}=e;if(!r||!use(s))return this.renderGenericImageMask(n,s);const a=this._getCSSTransform(e),l=a?{transform:a,"image-orientation":"none"}:{},c=`${o}${o!=null&&o.includes("?")?"&":"?"}w=${i}`,h={[ct.itemImageResizable]:r};return le("div",{class:this.classes(ct.itemMask)},le("img",{styles:l,alt:n,title:n,src:c,class:this.classes(h,ct.itemImage)}))}renderFile(e){const{file:i}=e;return le("li",{class:ct.item,key:i},le("button",{key:"details-button",bind:this,class:ct.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,onclick:()=>this._startEditFile(e),type:"button"},this.renderImageMask(e),le("label",{class:ct.itemLabel},le("span",{class:ct.itemFilename},i.name||this.messages.noTitle),le("span",{"aria-hidden":"true",class:this.classes(ct.itemChevronIcon,bm(this.container)?ct.iconLeft:ct.iconRight)}))))}renderAttachmentInfo({attachmentInfo:e,displayType:i}){const{viewModel:r,effectiveDisplayType:s}=this,{abilities:n,supportsResizeAttachments:o}=r,{contentType:a,name:l,url:c}=e,h=this.renderImageMask(e,i==="list"?48:400),p=n.editing?le("span",{"aria-hidden":"true",class:this.classes(ct.itemChevronIcon,bm(this.container)?ct.iconLeft:ct.iconRight)}):null,f=[h,s==="preview"&&o&&use(a)?null:le("label",{class:ct.itemLabel},le("span",{class:ct.itemFilename},l||this.messages.noTitle),p)],m=n.editing?le("button",{key:"details-button",bind:this,class:ct.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":e.id,onclick:()=>this._startEditAttachment(e),type:"button"},f):le("a",{key:"details-link",class:ct.itemButton,href:c??void 0,target:"_blank"},f);return le("li",{class:ct.item,key:e},m)}renderAttachmentContainer(){var y;const{effectiveDisplayType:e,viewModel:i,visibleElements:r}=this,{attachmentInfos:s,abilities:n,fileInfos:o}=i,a=!!(s!=null&&s.length),l=!!(o!=null&&o.length),c={[ct.containerList]:e!=="preview",[ct.containerPreview]:e==="preview"},h=n.editing&&((y=n.operations)!=null&&y.add)&&r.addButton?le("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes(ct.esriButton,ct.esriButtonTertiary,ct.addAttachmentButton),type:"button"},le("span",{"aria-hidden":"true",class:this.classes(ct.itemAddIcon,ct.iconPlus)}),this.messages.add):void 0,p=a?le("ul",{key:"attachments-list",class:ct.items},s.toArray().map(_=>this.renderAttachmentInfo({attachmentInfo:_,displayType:e}))):void 0,f=l?le("ul",{key:"file-list",class:ct.items},o.toArray().map(_=>this.renderFile(_))):void 0,m=l||a?void 0:le("div",{class:ct.empty},this.messages.noAttachments);return le("div",{key:"attachments-container",class:this.classes(ct.container,c)},p,f,m,h)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){const i=e.target,r=i&&i.files&&i.files.item(0);this._set("selectedFile",r)}_submitDeleteAttachment(e,i){e.preventDefault(),i&&("file"in i?this.deleteFile(i.file):i&&this.deleteAttachment(i))}_submitAddAttachment(e){e.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(e,i){e.preventDefault(),i&&"file"in i?this.updateFile():this.updateAttachment()}_startEditAttachment(e){const{viewModel:i}=this;i.activeFileInfo=null,i.activeAttachmentInfo=e,i.mode="edit"}_startEditFile(e){const{viewModel:i}=this;i.activeAttachmentInfo=null,i.activeFileInfo=e,i.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e){const{orientationInfo:i}=e;return!this._supportsImageOrientation&&i?[i.rotation?`rotate(${i.rotation}deg)`:"",i.mirrored?"scaleX(-1)":""].join(" "):""}};u([d()],Ya.prototype,"abilities",null),u([d()],Ya.prototype,"displayType",void 0),u([d({readOnly:!0})],Ya.prototype,"effectiveDisplayType",null),u([d()],Ya.prototype,"graphic",null),u([d()],Ya.prototype,"label",null),u([d(),dl("esri/widgets/Attachments/t9n/Attachments")],Ya.prototype,"messages",void 0),u([d(),dl("esri/core/t9n/Units")],Ya.prototype,"messagesUnits",void 0),u([d({readOnly:!0})],Ya.prototype,"selectedFile",void 0),u([d({readOnly:!0})],Ya.prototype,"submitting",void 0),u([d({readOnly:!0})],Ya.prototype,"error",void 0),u([d({type:DJ})],Ya.prototype,"viewModel",void 0),u([d()],Ya.prototype,"visibleElements",void 0),u([wi("visibleElements")],Ya.prototype,"castVisibleElements",null),Ya=u([I("esri.widgets.Attachments")],Ya);const L7e=Ya;let yR=class extends DJ{constructor(e){super(e),this.description=null,this.title=null}};u([d()],yR.prototype,"description",void 0),u([d()],yR.prototype,"title",void 0),yR=u([I("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],yR);const NJ=yR,D7e={heading:"esri-widget__heading"};function FJ({level:t,class:e,...i},r){const s=N7e(t);return le(`h${s}`,{...i,class:o1e(D7e.heading,e),role:"heading","aria-level":String(s)},r)}function N7e(t){return we(Math.ceil(t),1,6)}const tk="esri-feature-element-info",ik={base:tk,title:`${tk}__title`,description:`${tk}__description`};let Y2=class extends bl{constructor(e,i){super(e,i),this.description=null,this.headingLevel=2,this.title=null}render(){return le("div",{class:ik.base},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:e}=this;return e?le(FJ,{level:this.headingLevel,class:ik.title},e):null}renderDescription(){const{description:e}=this;return e?le("div",{key:"description",class:ik.description},e):null}};u([d()],Y2.prototype,"description",void 0),u([d()],Y2.prototype,"headingLevel",void 0),u([d()],Y2.prototype,"title",void 0),Y2=u([I("esri.widgets.Feature.support.FeatureElementInfo")],Y2);const $U=Y2,F7e={base:"esri-feature-attachments"};let Bf=class extends bl{constructor(e,i){super(e,i),this._featureElementInfo=null,this.attachmentsWidget=new L7e,this.headingLevel=2,this.viewModel=new NJ}initialize(){this._featureElementInfo=new $U,this.addHandles([re(()=>{var e,i;return[(e=this.viewModel)==null?void 0:e.description,(i=this.viewModel)==null?void 0:i.title,this.headingLevel]},()=>this._setupFeatureElementInfo(),Zt),re(()=>this.viewModel,e=>this.attachmentsWidget.viewModel=e,Zt)])}destroy(){var e;this.attachmentsWidget.destroy(),(e=this._featureElementInfo)==null||e.destroy()}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get displayType(){return this.attachmentsWidget.displayType}set displayType(e){this.attachmentsWidget.displayType=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var i;const{attachmentsWidget:e}=this;return le("div",{class:F7e.base},(i=this._featureElementInfo)==null?void 0:i.render(),e==null?void 0:e.render())}_setupFeatureElementInfo(){var s;const{description:e,title:i,headingLevel:r}=this;(s=this._featureElementInfo)==null||s.set({description:e,title:i,headingLevel:r})}};u([d({readOnly:!0})],Bf.prototype,"attachmentsWidget",void 0),u([d()],Bf.prototype,"description",null),u([d()],Bf.prototype,"displayType",null),u([d()],Bf.prototype,"graphic",null),u([d()],Bf.prototype,"headingLevel",void 0),u([d()],Bf.prototype,"title",null),u([d({type:NJ})],Bf.prototype,"viewModel",void 0),Bf=u([I("esri.widgets.Feature.FeatureAttachments")],Bf);const U7e=Bf;let S_=class extends uT($e){constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add(re(()=>this.creator,i=>{this._destroyContent(),this._createContent(i)},Zt))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:i,destroyer:r}=this;e&&i&&(J4(r,{graphic:i}).catch(()=>null),this._set("created",null))}async _createContent(e){const i=this.graphic;if(!i||!e)return;const r=J4(e,{graphic:i}).catch(()=>null);this._loadingPromise=r,this.notifyChange("state");const s=await r;r===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",s))}};u([d({readOnly:!0})],S_.prototype,"created",void 0),u([d()],S_.prototype,"creator",void 0),u([d()],S_.prototype,"destroyer",void 0),u([d({type:ha})],S_.prototype,"graphic",void 0),u([d({readOnly:!0})],S_.prototype,"state",null),S_=u([I("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],S_);const K4=S_;function Fh(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${e}'`);return{value:k7e(t[e])}}}function V7e(t){const e=t==null?void 0:t.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function k7e(t){return function(e,...i){V7e(e)?oBe(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...i)}}function B7e(t){return e=>{e.hasOwnProperty("_delegatedEventNames")||(e._delegatedEventNames=e._delegatedEventNames?e._delegatedEventNames.slice():[]);const i=e._delegatedEventNames,r=Array.isArray(t)?t:z7e(t);i.push(...r)}}function z7e(t){return t.split(",").map(e=>e.trim())}const nbe="calcite-mode-";function G7e(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replace(/\s|'|"/g,"")}function Q4(){return G7e().startsWith("dark")}function j7e(){return`${nbe}${Q4()?"dark":"light"}`}function H7e(t){q7e(t),t.classList.add(j7e())}function q7e(t){Array.from(t.classList).forEach(e=>{e.startsWith(nbe)&&t.classList.remove(e)})}function obe(t){return t&&typeof t.render=="function"}function W7e(t){return t&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}const rk="esri-feature-content",sk={base:rk,loaderContainer:`${rk}__loader-container`,loader:`${rk}__loader`};let Z2=class extends bl{constructor(e,i){super(e,i),this.viewModel=null,this._addTargetToAnchors=r=>{Array.from(r.querySelectorAll("a")).forEach(s=>{Z1e(s.href)&&!s.hasAttribute("target")&&s.setAttribute("target","_blank")})}}get creator(){var e;return(e=this.viewModel)==null?void 0:e.creator}set creator(e){this.viewModel&&(this.viewModel.creator=e)}get graphic(){var e;return(e=this.viewModel)==null?void 0:e.graphic}set graphic(e){this.viewModel&&(this.viewModel.graphic=e)}renderLoading(){return le("div",{class:sk.loaderContainer,key:"loader"},le("div",{class:sk.loader}))}renderCreated(){var i;const e=(i=this.viewModel)==null?void 0:i.created;return e?e instanceof HTMLElement?le("div",{key:e,bind:e,afterCreate:this._attachToNode}):obe(e)?le("div",{key:e},!e.destroyed&&e.render()):le("div",{key:e,innerHTML:e,afterCreate:this._addTargetToAnchors}):null}render(){var i;const e=(i=this.viewModel)==null?void 0:i.state;return le("div",{class:sk.base},e==="loading"?this.renderLoading():this.renderCreated())}_attachToNode(e){const i=this;e.appendChild(i)}};u([d()],Z2.prototype,"creator",null),u([d()],Z2.prototype,"graphic",null),u([d({type:K4})],Z2.prototype,"viewModel",void 0),Z2=u([I("esri.widgets.Feature.FeatureContent")],Z2);const $N=Z2;let Vg=class extends $e{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:i}=this,r=[];return i==null||i.forEach(s=>{if(!(!s.hasOwnProperty("visible")||s.visible))return;const n=s.clone();n.label=J1e(n,e),r.push(n)}),r}};u([d()],Vg.prototype,"attributes",void 0),u([d({type:[$ye]})],Vg.prototype,"expressionInfos",void 0),u([d()],Vg.prototype,"description",void 0),u([d({type:[JP]})],Vg.prototype,"fieldInfos",void 0),u([d({readOnly:!0})],Vg.prototype,"formattedFieldInfos",null),u([d()],Vg.prototype,"title",void 0),Vg=u([I("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],Vg);const LU=Vg,X7e=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function Y7e(t){let e=null;return X7e.some(i=>(i.pattern.test(t)&&(e=i),!!e)),e}function Z7e(t,e){if(typeof e!="string"||!e)return e;const i=Y7e(e);if(!i)return e;const r=e.match(i.pattern),s=r&&r[2],n=Fm(Fm(i.label,{messages:t,hierPart:s}),{appName:i.appName}),o=i.target?` target="${i.target}"`:"",a=i.target==="_blank"?' rel="noreferrer"':"";return e.replace(i.pattern,`<a${o} href="$1"${a}>${n}</a>`)}const E$="esri-feature-fields",jA={base:E$,fieldHeader:`${E$}__field-header`,fieldData:`${E$}__field-data`,fieldDataDate:`${E$}__field-data--date`,esriTable:"esri-widget__table"};let Zd=class extends bl{constructor(e,i){super(e,i),this._featureElementInfo=null,this.viewModel=new LU,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new $U,this.addHandles(re(()=>{var e,i;return[(e=this.viewModel)==null?void 0:e.description,(i=this.viewModel)==null?void 0:i.title]},()=>this._setupFeatureElementInfo(),Zt))}destroy(){var e;(e=this._featureElementInfo)==null||e.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(e){this.viewModel.expressionInfos=e}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(e){this.viewModel.fieldInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}renderFieldInfo(e,i){const{attributes:r}=this.viewModel,s=e.fieldName,n=e.label||s,o=r?r[s]==null?"":r[s]:"",a=!(!e.format||!e.format.dateFormat),l=typeof o=="number"&&!a?this._forceLTR(o):Z7e(this.messagesURIUtils,o),c={[jA.fieldDataDate]:a};return le("tr",{key:`fields-element-info-row-${s}-${i}`},le("th",{key:`fields-element-info-row-header-${s}-${i}`,class:jA.fieldHeader,innerHTML:n}),le("td",{key:`fields-element-info-row-data-${s}-${i}`,class:this.classes(jA.fieldData,c),innerHTML:l}))}renderFields(){const{formattedFieldInfos:e}=this.viewModel;return e!=null&&e.length?le("table",{class:jA.esriTable,summary:this.messages.fieldsSummary},le("tbody",null,e.map((i,r)=>this.renderFieldInfo(i,r)))):null}render(){var e;return le("div",{class:jA.base},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderFields())}_setupFeatureElementInfo(){var r;const{description:e,title:i}=this;(r=this._featureElementInfo)==null||r.set({description:e,title:i})}_forceLTR(e){return`&lrm;${e}`}};u([d()],Zd.prototype,"attributes",null),u([d()],Zd.prototype,"description",null),u([d()],Zd.prototype,"expressionInfos",null),u([d()],Zd.prototype,"fieldInfos",null),u([d()],Zd.prototype,"title",null),u([d({type:LU,nonNullable:!0})],Zd.prototype,"viewModel",void 0),u([d(),dl("esri/widgets/Feature/t9n/Feature")],Zd.prototype,"messages",void 0),u([d(),dl("esri/widgets/support/t9n/uriUtils")],Zd.prototype,"messagesURIUtils",void 0),Zd=u([I("esri.widgets.Feature.FeatureFields")],Zd);const abe=Zd,J7e={maximumFractionDigits:20};function K7e(t){return km(t,J7e)}var Ej;let Nb=Ej=class extends Ie{constructor(t){super(t),this.color=null,this.label=null,this.value=null}writeValue(t,e,i){e[i]=t??0}clone(){return new Ej({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};u([d({type:ot,json:{type:[Yr],write:!0}})],Nb.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],Nb.prototype,"label",void 0),u([d({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],Nb.prototype,"value",void 0),u([lt("value")],Nb.prototype,"writeValue",null),Nb=Ej=u([I("esri.renderers.visualVariables.support.ColorStop")],Nb);const Q7e=Nb;function DU(t,e,i){return lc(t.map((r,s)=>e.apply(i,[r,s])))}async function eGe(t,e,i){return(await lc(t.map((r,s)=>e.apply(i,[r,s])))).map(r=>r.value)}function UJ(t){return{ok:!0,value:t}}function VJ(t){return{ok:!1,error:t}}function tGe(t){return v(t)&&t.ok===!0?t.value:null}function iGe(t){return v(t)&&t.ok===!1?t.error:null}async function Kp(t){if(C(t))return{ok:!1,error:new Error("no promise provided")};try{return UJ(await t)}catch(e){return VJ(e)}}async function fPt(t){try{return UJ(await t)}catch(e){return zc(e),VJ(e)}}function mPt(t){if(t.ok===!0)return t.value;throw t.error}function uI(t,e){return new E_(t,e)}let E_=class extends $e{get value(){return tGe(this._result)}get error(){return iGe(this._result)}get finished(){return v(this._result)}constructor(e,i){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=hd(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:r}=this._abortController;this.promise=e(r),this.promise.then(s=>{this._result=UJ(s),this._cleanup()},s=>{this._result=VJ(s),this._cleanup()}),this._abortHandle=ca(i,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=Rr(this._abortHandle),this._abortController=null}};u([d()],E_.prototype,"value",null),u([d()],E_.prototype,"error",null),u([d()],E_.prototype,"finished",null),u([d()],E_.prototype,"promise",void 0),u([d()],E_.prototype,"_result",void 0),E_=u([I("esri.core.asyncUtils.ReactiveTask")],E_);function hI(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function rGe(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function sGe(t,e,i,r,s,n,o,a,l,c,h,p,f,m,y,_){const b=new Float32Array(16);return b[0]=t,b[1]=e,b[2]=i,b[3]=r,b[4]=s,b[5]=n,b[6]=o,b[7]=a,b[8]=l,b[9]=c,b[10]=h,b[11]=p,b[12]=f,b[13]=m,b[14]=y,b[15]=_,b}function nGe(t,e){return new Float32Array(t,e,16)}const oGe=hI();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:oGe,clone:rGe,create:hI,createView:nGe,fromValues:sGe},Symbol.toStringTag,{value:"Module"}));const aGe=(t,e)=>{const i=eg(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return tu(i,i)},lGe=(t,e)=>{const i=eg(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return tu(i,i)},cGe=(t,e)=>{const i=1-e,r=eg(t,.2126+.7874*i,.7152-.7152*i,.0722-.0722*i,0,.2126-.2126*i,.7152+.2848*i,.0722-.0722*i,0,.2126-.2126*i,.7152-.7152*i,.0722+.9278*i,0,0,0,0,1);return tu(r,r)},uGe=(t,e)=>{const i=Math.sin(e*Math.PI/180),r=Math.cos(e*Math.PI/180),s=eg(t,.213+.787*r-.213*i,.715-.715*r-.715*i,.072-.072*r+.928*i,0,.213-.213*r+.143*i,.715+.285*r+.14*i,.072-.072*r-.283*i,0,.213-.213*r-.787*i,.715-.715*r+.715*i,.072+.928*r+.072*i,0,0,0,0,1);return tu(s,s)},hGe=(t,e)=>{const i=1-2*e,r=eg(t,i,0,0,e,0,i,0,e,0,0,i,e,0,0,0,1);return tu(r,r)},dGe=(t,e)=>{const i=eg(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return tu(i,i)},pGe=(t,e)=>{const i=1-e,r=eg(t,.393+.607*i,.769-.769*i,.189-.189*i,0,.349-.349*i,.686+.314*i,.168-.168*i,0,.272-.272*i,.534-.534*i,.131+.869*i,0,0,0,0,1);return tu(r,r)};let lbe=class cbe{constructor(e,i,r){this.strength=e,this.radius=i,this.threshold=r,this.type="bloom"}interpolate(e,i,r){this.strength=Vc(e.strength,i.strength,r),this.radius=Vc(e.radius,i.radius,r),this.threshold=Vc(e.threshold,i.threshold,r)}clone(){return new cbe(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:UM(this.radius),strength:this.strength,threshold:this.threshold}}},ube=class hbe{constructor(e){this.radius=e,this.type="blur"}interpolate(e,i,r){this.radius=Math.round(Vc(e.radius,i.radius,r))}clone(){return new hbe(this.radius)}toJSON(){return{type:"blur",radius:UM(this.radius)}}},Cj=class dbe{constructor(e,i){this.type=e,this.amount=i,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.amount=Vc(e.amount,i.amount,r),this._updateMatrix()}clone(){return new dbe(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||hI();switch(this.type){case"brightness":this._colorMatrix=aGe(e,this.amount);break;case"contrast":this._colorMatrix=lGe(e,this.amount);break;case"grayscale":this._colorMatrix=cGe(e,this.amount);break;case"invert":this._colorMatrix=hGe(e,this.amount);break;case"saturate":this._colorMatrix=dGe(e,this.amount);break;case"sepia":this._colorMatrix=pGe(e,this.amount)}}},pbe=class fbe{constructor(e,i,r,s){this.offsetX=e,this.offsetY=i,this.blurRadius=r,this.color=s,this.type="drop-shadow"}interpolate(e,i,r){this.offsetX=Vc(e.offsetX,i.offsetX,r),this.offsetY=Vc(e.offsetY,i.offsetY,r),this.blurRadius=Vc(e.blurRadius,i.blurRadius,r),this.color[0]=Math.round(Vc(e.color[0],i.color[0],r)),this.color[1]=Math.round(Vc(e.color[1],i.color[1],r)),this.color[2]=Math.round(Vc(e.color[2],i.color[2],r)),this.color[3]=Vc(e.color[3],i.color[3],r)}clone(){return new fbe(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:UM(this.offsetX),yoffset:UM(this.offsetY),blurRadius:UM(this.blurRadius),color:e}}},mbe=class gbe{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.angle=Vc(e.angle,i.angle,r),this._updateMatrix()}clone(){return new gbe(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||hI();this._colorMatrix=uGe(e,this.angle)}},ybe=class _be{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,i,r){this.amount=Vc(e.amount,i.amount,r)}clone(){return new _be(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function Vc(t,e,i){return t+(e-t)*i}function UM(t){return Math.round(1e3*gd(t))/1e3}function fGe(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new Cj(t.type,0);case"saturate":case"brightness":case"contrast":return new Cj(t.type,1);case"opacity":return new ybe(1);case"hue-rotate":return new mbe(0);case"blur":return new ube(0);case"drop-shadow":return new pbe(0,0,0,[...EZ("transparent")]);case"bloom":return new lbe(0,0,1)}}function mGe(t,e){const i=t.length>e.length?t:e;return(t.length>e.length?e:t).every((r,s)=>r.type===i[s].type)}function gGe(t,e){const i=t.length>e.length?t:e,r=t.length>e.length?e:t;for(let s=r.length;s<i.length;s++)r.push(fGe(i[s]))}function yGe(t){const e=t[0];return!!e&&"type"in e}var dse,pse,Aj={};function vbe(t){if(!t||t.length===0)return null;if(typeof t=="string"){const i=fse(t);return i&&i.length!==0?i:null}const e=t.map(i=>{if(!Number.isFinite(i.scale)||i.scale<=0)throw new W("effect:invalid-scale","scale must be finite and greater than 0",{stop:i});return{scale:i.scale,effects:fse(i.value)}});e.sort((i,r)=>r.effects.length-i.effects.length);for(let i=0;i<e.length-1;i++){if(!mGe(e[i].effects,e[i+1].effects))throw new W("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[i].effects,b:e[i+1].effects});gGe(e[i].effects,e[i+1].effects)}return e.sort((i,r)=>r.scale-i.scale),e}function fse(t){let e;if(!t)return[];try{e=Aj.parse(t)}catch(i){throw new W("effect:invalid-syntax","Invalid effect syntax",{value:t,error:i})}return e.map(i=>_Ge(i))}function _Ge(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return vGe(t);case"opacity":return bGe(t);case"hue-rotate":return wGe(t);case"blur":return xGe(t);case"drop-shadow":return TGe(t);case"bloom":return SGe(t)}}catch(e){throw e.details.filter=t,e}throw new W("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function vGe(t){let e=1;return oA(t.parameters,1),t.parameters.length===1&&(e=yp(t.parameters[0])),new Cj(t.name,e)}function bGe(t){let e=1;return oA(t.parameters,1),t.parameters.length===1&&(e=yp(t.parameters[0])),new ybe(e)}function wGe(t){let e=0;return oA(t.parameters,1),t.parameters.length===1&&(e=MGe(t.parameters[0])),new mbe(e)}function xGe(t){let e=0;return oA(t.parameters,1),t.parameters.length===1&&(e=zJ(t.parameters[0]),dI(e,t.parameters[0])),new ube(e)}function TGe(t){const e=[];let i=null;for(const r of t.parameters)if(r.type==="color"){if(e.length&&Object.freeze(e),i)throw new W("effect:type-error","Accepts only one color",{});i=PGe(r)}else{const s=zJ(r);if(Object.isFrozen(e))throw new W("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(s),e.length===3&&dI(s,r)}if(e.length<2||e.length>3)throw new W("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new pbe(e[0],e[1],e[2]||0,i||bbe("black"))}function SGe(t){let e=1,i=0,r=0;return oA(t.parameters,3),t.parameters[0]&&(e=yp(t.parameters[0])),t.parameters[1]&&(i=zJ(t.parameters[1]),dI(i,t.parameters[1])),t.parameters[2]&&(r=yp(t.parameters[2])),new lbe(e,i,r)}function oA(t,e){if(t.length>e)throw new W("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function NU(t){if(t.type==="color")return"<color>";if(t.unit){if(BJ[t.unit])return"<length>";if(kJ[t.unit])return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function dI(t,e){if(t<0)throw new W("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function EGe(t){if(t.type!=="quantity"||t.unit!==null)throw new W("effect:type-error",`Expected <double>, Actual: ${NU(t)}`,{term:t})}function CGe(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new W("effect:type-error",`Expected <double> or <percentage>, Actual: ${NU(t)}`,{term:t})}pse=function(){function t(s,n){function o(){this.constructor=s}o.prototype=n.prototype,s.prototype=new o}function e(s,n,o,a){var l=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(l,e.prototype),l.expected=n,l.found=o,l.location=a,l.name="SyntaxError",l}function i(s,n,o){return o=o||" ",s.length>n?s:(n-=s.length,s+(o+=o.repeat(n)).slice(0,n))}function r(s,n){var o,a={},l=(n=n!==void 0?n:{}).grammarSource,c={start:ug},h=ug,p="none",f=")",m=",",y="(",_="%",b="px",w="cm",S="mm",T="in",E="pt",O="pc",R="deg",L="rad",P="grad",F="turn",V="#",B=".",G="e",te=/^[ \t\n\r]/,se=/^[a-z\-]/,ie=/^[0-9a-fA-F]/,H=/^[+\-]/,$=/^[0-9]/,N=xl("none"),U=us("none",!1),q=us(")",!1),Y=us(",",!1),Q=xl("whitespace"),X=E1([" ","	",`
`,"\r"],!1,!1),pe=xl("function"),ye=us("(",!1),xe=xl("identifier"),De=E1([["a","z"],"-"],!1,!1),rt=xl("percentage"),qe=us("%",!1),Pe=xl("length"),Ye=us("px",!1),j=us("cm",!1),J=us("mm",!1),ne=us("in",!1),ge=us("pt",!1),_e=us("pc",!1),Ce=xl("angle"),Le=us("deg",!1),Re=us("rad",!1),Ue=us("grad",!1),Te=us("turn",!1),Ze=xl("number"),Se=xl("color"),Ee=us("#",!1),Ne=E1([["0","9"],["a","f"],["A","F"]],!1,!1),Ge=E1(["+","-"],!1,!1),tt=E1([["0","9"]],!1,!1),dt=us(".",!1),Ft=us("e",!1),ti=function(){return[]},yi=function(Z,Me){return{type:"function",name:Z,parameters:Me||[]}},Ri=function(Z,Me){return Me.length>0?MA(Z,Me,3):[Z]},Qi=function(Z){return{type:"quantity",value:Z.value,unit:Z.unit}},ri=function(Z){return{type:"color",colorType:Z.type,value:Z.value}},qt=function(Z){return Z},Jt=function(){return fc()},Qr=function(Z){return{value:Z,unit:"%"}},cr=function(Z){return{value:Z,unit:"px"}},es=function(Z){return{value:Z,unit:"cm"}},Mr=function(Z){return{value:Z,unit:"mm"}},Gr=function(Z){return{value:Z,unit:"in"}},_s=function(Z){return{value:Z,unit:"pt"}},zs=function(Z){return{value:Z,unit:"pc"}},wo=function(Z){return{value:Z,unit:"deg"}},Zn=function(Z){return{value:Z,unit:"rad"}},Rs=function(Z){return{value:Z,unit:"grad"}},ts=function(Z){return{value:Z,unit:"turn"}},is=function(Z){return{value:Z,unit:null}},Ms=function(){return{type:"hex",value:fc()}},ur=function(Z){return{type:"function",value:Z}},Wo=function(){return{type:"named",value:fc()}},wl=function(){return parseFloat(fc())},me=0,br=0,Md=[{line:1,column:1}],pa=0,lu=[],Tt=0;if("startRule"in n){if(!(n.startRule in c))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');h=c[n.startRule]}function fc(){return s.substring(br,me)}function us(Z,Me){return{type:"literal",text:Z,ignoreCase:Me}}function E1(Z,Me,ze){return{type:"class",parts:Z,inverted:Me,ignoreCase:ze}}function sV(){return{type:"end"}}function xl(Z){return{type:"other",description:Z}}function b0(Z){var Me,ze=Md[Z];if(ze)return ze;for(Me=Z-1;!Md[Me];)Me--;for(ze={line:(ze=Md[Me]).line,column:ze.column};Me<Z;)s.charCodeAt(Me)===10?(ze.line++,ze.column=1):ze.column++,Me++;return Md[Z]=ze,ze}function cg(Z,Me){var ze=b0(Z),xi=b0(Me);return{source:l,start:{offset:Z,line:ze.line,column:ze.column},end:{offset:Me,line:xi.line,column:xi.column}}}function hi(Z){me<pa||(me>pa&&(pa=me,lu=[]),lu.push(Z))}function zI(Z,Me,ze){return new e(e.buildMessage(Z,Me),Z,Me,ze)}function ug(){var Z;return(Z=w0())===a&&(Z=x0()),Z}function w0(){var Z,Me;return Tt++,Z=me,hr(),s.substr(me,4)===p?(Me=p,me+=4):(Me=a,Tt===0&&hi(U)),Me!==a?(hr(),br=Z,Z=ti()):(me=Z,Z=a),Tt--,Z===a&&Tt===0&&hi(N),Z}function x0(){var Z,Me;if(Z=[],(Me=Xo())!==a)for(;Me!==a;)Z.push(Me),Me=Xo();else Z=a;return Z}function Xo(){var Z,Me,ze,xi;return Z=me,hr(),(Me=hf())!==a?(hr(),(ze=nh())===a&&(ze=null),hr(),s.charCodeAt(me)===41?(xi=f,me++):(xi=a,Tt===0&&hi(q)),xi!==a?(hr(),br=Z,Z=yi(Me,ze)):(me=Z,Z=a)):(me=Z,Z=a),Z}function nh(){var Z,Me,ze,xi,Jn,Ps,Sl,S0;if(Z=me,(Me=oh())!==a){for(ze=[],xi=me,Jn=hr(),s.charCodeAt(me)===44?(Ps=m,me++):(Ps=a,Tt===0&&hi(Y)),Ps===a&&(Ps=null),Sl=hr(),(S0=oh())!==a?xi=Jn=[Jn,Ps,Sl,S0]:(me=xi,xi=a);xi!==a;)ze.push(xi),xi=me,Jn=hr(),s.charCodeAt(me)===44?(Ps=m,me++):(Ps=a,Tt===0&&hi(Y)),Ps===a&&(Ps=null),Sl=hr(),(S0=oh())!==a?xi=Jn=[Jn,Ps,Sl,S0]:(me=xi,xi=a);br=Z,Z=Ri(Me,ze)}else me=Z,Z=a;return Z}function oh(){var Z,Me;return Z=me,(Me=bT())===a&&(Me=C1())===a&&(Me=wT())===a&&(Me=A1()),Me!==a&&(br=Z,Me=Qi(Me)),(Z=Me)===a&&(Z=me,(Me=T0())!==a&&(br=Z,Me=ri(Me)),Z=Me),Z}function hr(){var Z,Me;for(Tt++,Z=[],te.test(s.charAt(me))?(Me=s.charAt(me),me++):(Me=a,Tt===0&&hi(X));Me!==a;)Z.push(Me),te.test(s.charAt(me))?(Me=s.charAt(me),me++):(Me=a,Tt===0&&hi(X));return Tt--,Me=a,Tt===0&&hi(Q),Z}function hf(){var Z,Me,ze;return Tt++,Z=me,(Me=hg())!==a?(s.charCodeAt(me)===40?(ze=y,me++):(ze=a,Tt===0&&hi(ye)),ze!==a?(br=Z,Z=qt(Me)):(me=Z,Z=a)):(me=Z,Z=a),Tt--,Z===a&&(Me=a,Tt===0&&hi(pe)),Z}function hg(){var Z,Me,ze;if(Tt++,Z=me,Me=[],se.test(s.charAt(me))?(ze=s.charAt(me),me++):(ze=a,Tt===0&&hi(De)),ze!==a)for(;ze!==a;)Me.push(ze),se.test(s.charAt(me))?(ze=s.charAt(me),me++):(ze=a,Tt===0&&hi(De));else Me=a;return Me!==a&&(br=Z,Me=Jt()),Tt--,(Z=Me)===a&&(Me=a,Tt===0&&hi(xe)),Z}function bT(){var Z,Me,ze;return Tt++,Z=me,hr(),(Me=Tl())!==a?(s.charCodeAt(me)===37?(ze=_,me++):(ze=a,Tt===0&&hi(qe)),ze!==a?(br=Z,Z=Qr(Me)):(me=Z,Z=a)):(me=Z,Z=a),Tt--,Z===a&&Tt===0&&hi(rt),Z}function C1(){var Z,Me,ze;return Tt++,Z=me,hr(),(Me=Tl())!==a?(s.substr(me,2)===b?(ze=b,me+=2):(ze=a,Tt===0&&hi(Ye)),ze!==a?(br=Z,Z=cr(Me)):(me=Z,Z=a)):(me=Z,Z=a),Z===a&&(Z=me,hr(),(Me=Tl())!==a?(s.substr(me,2)===w?(ze=w,me+=2):(ze=a,Tt===0&&hi(j)),ze!==a?(br=Z,Z=es(Me)):(me=Z,Z=a)):(me=Z,Z=a),Z===a&&(Z=me,hr(),(Me=Tl())!==a?(s.substr(me,2)===S?(ze=S,me+=2):(ze=a,Tt===0&&hi(J)),ze!==a?(br=Z,Z=Mr(Me)):(me=Z,Z=a)):(me=Z,Z=a),Z===a&&(Z=me,hr(),(Me=Tl())!==a?(s.substr(me,2)===T?(ze=T,me+=2):(ze=a,Tt===0&&hi(ne)),ze!==a?(br=Z,Z=Gr(Me)):(me=Z,Z=a)):(me=Z,Z=a),Z===a&&(Z=me,hr(),(Me=Tl())!==a?(s.substr(me,2)===E?(ze=E,me+=2):(ze=a,Tt===0&&hi(ge)),ze!==a?(br=Z,Z=_s(Me)):(me=Z,Z=a)):(me=Z,Z=a),Z===a&&(Z=me,hr(),(Me=Tl())!==a?(s.substr(me,2)===O?(ze=O,me+=2):(ze=a,Tt===0&&hi(_e)),ze!==a?(br=Z,Z=zs(Me)):(me=Z,Z=a)):(me=Z,Z=a)))))),Tt--,Z===a&&Tt===0&&hi(Pe),Z}function wT(){var Z,Me,ze;return Tt++,Z=me,(Me=Tl())!==a?(s.substr(me,3)===R?(ze=R,me+=3):(ze=a,Tt===0&&hi(Le)),ze!==a?(br=Z,Z=wo(Me)):(me=Z,Z=a)):(me=Z,Z=a),Z===a&&(Z=me,(Me=Tl())!==a?(s.substr(me,3)===L?(ze=L,me+=3):(ze=a,Tt===0&&hi(Re)),ze!==a?(br=Z,Z=Zn(Me)):(me=Z,Z=a)):(me=Z,Z=a),Z===a&&(Z=me,(Me=Tl())!==a?(s.substr(me,4)===P?(ze=P,me+=4):(ze=a,Tt===0&&hi(Ue)),ze!==a?(br=Z,Z=Rs(Me)):(me=Z,Z=a)):(me=Z,Z=a),Z===a&&(Z=me,(Me=Tl())!==a?(s.substr(me,4)===F?(ze=F,me+=4):(ze=a,Tt===0&&hi(Te)),ze!==a?(br=Z,Z=ts(Me)):(me=Z,Z=a)):(me=Z,Z=a)))),Tt--,Z===a&&(Me=a,Tt===0&&hi(Ce)),Z}function A1(){var Z,Me;return Tt++,Z=me,hr(),(Me=Tl())!==a?(br=Z,Z=is(Me)):(me=Z,Z=a),Tt--,Z===a&&Tt===0&&hi(Ze),Z}function T0(){var Z,Me,ze,xi;if(Tt++,Z=me,s.charCodeAt(me)===35?(Me=V,me++):(Me=a,Tt===0&&hi(Ee)),Me!==a){if(ze=[],ie.test(s.charAt(me))?(xi=s.charAt(me),me++):(xi=a,Tt===0&&hi(Ne)),xi!==a)for(;xi!==a;)ze.push(xi),ie.test(s.charAt(me))?(xi=s.charAt(me),me++):(xi=a,Tt===0&&hi(Ne));else ze=a;ze!==a?(br=Z,Z=Ms()):(me=Z,Z=a)}else me=Z,Z=a;return Z===a&&(Z=me,(Me=Xo())!==a&&(br=Z,Me=ur(Me)),(Z=Me)===a&&(Z=me,(Me=hg())!==a&&(br=Z,Me=Wo()),Z=Me)),Tt--,Z===a&&(Me=a,Tt===0&&hi(Se)),Z}function Tl(){var Z,Me,ze,xi,Jn,Ps,Sl;for(Z=me,H.test(s.charAt(me))?(s.charAt(me),me++):Tt===0&&hi(Ge),Me=me,ze=[],$.test(s.charAt(me))?(xi=s.charAt(me),me++):(xi=a,Tt===0&&hi(tt));xi!==a;)ze.push(xi),$.test(s.charAt(me))?(xi=s.charAt(me),me++):(xi=a,Tt===0&&hi(tt));if(s.charCodeAt(me)===46?(xi=B,me++):(xi=a,Tt===0&&hi(dt)),xi!==a){if(Jn=[],$.test(s.charAt(me))?(Ps=s.charAt(me),me++):(Ps=a,Tt===0&&hi(tt)),Ps!==a)for(;Ps!==a;)Jn.push(Ps),$.test(s.charAt(me))?(Ps=s.charAt(me),me++):(Ps=a,Tt===0&&hi(tt));else Jn=a;Jn!==a?Me=ze=[ze,xi,Jn]:(me=Me,Me=a)}else me=Me,Me=a;if(Me===a)if(Me=[],$.test(s.charAt(me))?(ze=s.charAt(me),me++):(ze=a,Tt===0&&hi(tt)),ze!==a)for(;ze!==a;)Me.push(ze),$.test(s.charAt(me))?(ze=s.charAt(me),me++):(ze=a,Tt===0&&hi(tt));else Me=a;if(Me!==a){if(ze=me,s.charCodeAt(me)===101?(xi=G,me++):(xi=a,Tt===0&&hi(Ft)),xi!==a){if(H.test(s.charAt(me))?(Jn=s.charAt(me),me++):(Jn=a,Tt===0&&hi(Ge)),Jn===a&&(Jn=null),Ps=[],$.test(s.charAt(me))?(Sl=s.charAt(me),me++):(Sl=a,Tt===0&&hi(tt)),Sl!==a)for(;Sl!==a;)Ps.push(Sl),$.test(s.charAt(me))?(Sl=s.charAt(me),me++):(Sl=a,Tt===0&&hi(tt));else Ps=a;Ps!==a?ze=xi=[xi,Jn,Ps]:(me=ze,ze=a)}else me=ze,ze=a;ze===a&&(ze=null),br=Z,Z=wl()}else me=Z,Z=a;return Z}function GI(Z,Me){return Z.map(function(ze){return ze[Me]})}function MA(Z,Me,ze){return[Z].concat(GI(Me,ze))}if((o=h())!==a&&me===s.length)return o;throw o!==a&&me<s.length&&hi(sV()),zI(lu,pa<s.length?s.charAt(pa):null,pa<s.length?cg(pa,pa+1):cg(pa,pa))}return t(e,Error),e.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<s.length;o++)if(s[o].source===this.location.source){a=s[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source+":"+l.line+":"+l.column;if(a){var h=this.location.end,p=i("",l.line.toString().length," "),f=a[l.line-1],m=(l.line===h.line?h.column:f.length+1)-l.column||1;n+=`
 --> `+c+`
`+p+` |
`+l.line+" | "+f+`
`+p+" | "+i("",l.column-1," ")+i("",m,"^")}else n+=`
 at `+c}return n},e.buildMessage=function(s,n){var o={literal:function(m){return'"'+l(m.text)+'"'},class:function(m){var y=m.parts.map(function(_){return Array.isArray(_)?c(_[0])+"-"+c(_[1]):c(_)});return"["+(m.inverted?"^":"")+y.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(m){return m.description}};function a(m){return m.charCodeAt(0).toString(16).toUpperCase()}function l(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function c(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function h(m){return o[m.type](m)}function p(m){var y,_,b=m.map(h);if(b.sort(),b.length>0){for(y=1,_=1;y<b.length;y++)b[y-1]!==b[y]&&(b[_]=b[y],_++);b.length=_}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}function f(m){return m?'"'+l(m)+'"':"end of input"}return"Expected "+p(s)+" but "+f(n)+" found."},{SyntaxError:e,parse:r}},(dse={get exports(){return Aj},set exports(t){Aj=t}}).exports&&(dse.exports=pse());const kJ={deg:1,grad:.9,rad:180/Math.PI,turn:360};function AGe(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&kJ[t.unit]!=null))throw new W("effect:type-error",`Expected <angle>, Actual: ${NU(t)}`,{term:t})}const BJ={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function OGe(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&BJ[t.unit]!=null))throw new W("effect:type-error",`Expected <length>, Actual: ${NU(t)}`,{term:t})}function yp(t){CGe(t);const e=t.value;return dI(e,t),t.unit==="%"?.01*e:e}function RGe(t){return EGe(t),dI(t.value,t),t.value}function MGe(t){return AGe(t),t.value*kJ[t.unit]||0}function zJ(t){return OGe(t),t.value*BJ[t.unit]||0}function PGe(t){switch(t.colorType){case"hex":return Q5e(t.value);case"named":return bbe(t.value);case"function":return LGe(t.value)}}function bbe(t){if(!Nye(t))throw new W("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return K5e(t)}const IGe=/^rgba?/i,$Ge=/^hsla?/i;function LGe(t){if(oA(t.parameters,4),IGe.test(t.name))return[yp(t.parameters[0]),yp(t.parameters[1]),yp(t.parameters[2]),t.parameters[3]?yp(t.parameters[3]):1];if($Ge.test(t.name))return Fye(RGe(t.parameters[0]),yp(t.parameters[1]),yp(t.parameters[2]),t.parameters[3]?yp(t.parameters[3]):1);throw new W("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function GJ(t,e,i){var r;try{return NGe(t)}catch(s){(r=i==null?void 0:i.messages)==null||r.push(s)}return null}function jJ(t,e,i,r){try{const s=DGe(t);gl(i,s,e)}catch(s){r.messages&&r.messages.push(s)}}function DGe(t){const e=vbe(t);return e?yGe(e)?e.map(i=>i.toJSON()):e.map(({scale:i,effects:r})=>({scale:i,value:r.map(s=>s.toJSON())})):null}function NGe(t){if(!t||t.length===0)return null;if(FGe(t)){const e=[];for(const i of t)e.push({scale:i.scale,value:mse(i.value)});return e}return mse(t)}function FGe(t){const e=t[0];return!!e&&"scale"in e}function mse(t){if(!t||!t.length)return"";const e=[];for(const i of t){let r=[];switch(i.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":r=[pg(i,"amount")];break;case"blur":r=[pg(i,"radius","pt")];break;case"hue-rotate":r=[pg(i,"angle","deg")];break;case"drop-shadow":r=[pg(i,"xoffset","pt"),pg(i,"yoffset","pt"),pg(i,"blurRadius","pt"),UGe(i,"color")];break;case"bloom":r=[pg(i,"strength"),pg(i,"radius","pt"),pg(i,"threshold")]}const s=`${i.type}(${r.filter(Boolean).join(" ")})`;vbe(s),e.push(s)}return e.join(" ")}function pg(t,e,i){if(t[e]==null)throw new W("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});return i?t[e]+i:""+t[e]}function UGe(t,e){if(t[e]==null)throw new W("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});const i=t[e];return`rgba(${i[0]||0}, ${i[1]||0}, ${i[2]||0}, ${i[3]/255||0})`}const LN=-3;var hy;(function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"})(hy||(hy={}));let VGe=class{constructor(e,i,r){this._namespace=e,this._storage=i,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",r&&(this._storage.registerRemoveFunc(this._namespace,r),this._removeFunc=!0)}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}put(e,i,r,s=0){this._storage.put(this._namespace+e,i,r,s)}get(e){const i=this._storage.get(this._namespace+e);return i===void 0?++this._miss:++this._hit,i}pop(e){const i=this._storage.pop(this._namespace+e);return i===void 0?++this._miss:++this._hit,i}updateSize(e,i,r){this._storage.updateSize(this._namespace+e,i,r)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}},HJ=class{constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new li,this._users=new li}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,i){this._removeFuncs.push([e,i])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(i=>i[0]!==e)}get size(){return this._size}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,0),this._checkSizeLimit()}put(e,i,r,s){const n=this._db.get(e);if(n&&(this._size-=n.size,this._db.delete(e),n.entry!==i&&this._notifyRemove(e,n.entry,hy.ALL)),r>this._maxSize)return void this._notifyRemove(e,i,hy.ALL);if(i===void 0)return void console.warn("Refusing to cache undefined entry ");if(!r||r<0)return void console.warn("Refusing to cache entry with invalid size "+r);const o=1+Math.max(s,LN)-LN;this._db.set(e,{entry:i,size:r,lifetime:o,lives:o}),this._size+=r,this._checkSizeLimit()}updateSize(e,i,r){const s=this._db.get(e);if(s&&s.entry===i){for(this._size-=s.size;r>this._maxSize;){const n=this._notifyRemove(e,i,hy.SOME);if(!(v(n)&&n>0))return void this._db.delete(e);r=n}s.size=r,this._size+=r,this._checkSizeLimit()}}pop(e){const i=this._db.get(e);if(i)return this._size-=i.size,this._db.delete(e),++this._hit,i.entry;++this._miss}get(e){const i=this._db.get(e);if(i!==void 0)return this._db.delete(e),i.lives=i.lifetime,this._db.set(e,i),++this._hit,i.entry;++this._miss}getStats(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},r=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;r[l]=(r[l]||0)+o.size,this._users.forAll(c=>{const h=c.namespace;if(a.startsWith(h)){const p=i[h]||0;i[h]=p+o.size}})});const s={};this._users.forAll(o=>{const a=o.namespace;if(!isNaN(o.hitRate)&&o.hitRate>0){const l=i[a]||0;i[a]=l,s[a]=Math.round(100*o.hitRate)+"%"}else s[a]="0%"});const n=Object.keys(i);n.sort((o,a)=>i[a]-i[o]),n.forEach(o=>e[o]=Math.round(i[o]/2**20)+"MB / "+s[o]);for(let o=r.length-1;o>=0;--o){const a=r[o];a&&(e["Priority "+(o+LN-1)]=Math.round(a/this.size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){this._db.forEach((i,r)=>{r.startsWith(e)&&(this._size-=i.size,this._db.delete(r),this._notifyRemove(r,i.entry,hy.ALL))})}clearAll(){this._db.forEach((e,i)=>this._notifyRemove(i,e.entry,hy.ALL)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,i,r){let s;return this._removeFuncs.some(n=>{if(e.startsWith(n[0])){const o=n[1](i,r);return typeof o=="number"&&(s=o),!0}return!1}),s}_checkSizeLimit(){if(!(this._size<=this._maxSize))for(const[e,i]of this._db){if(this._db.delete(e),i.lives<=1){this._size-=i.size;const r=this._notifyRemove(e,i.entry,hy.SOME);v(r)&&r>0&&(this._size+=r,i.lives=i.lifetime,i.size=r,this._db.set(e,i))}else--i.lives,this._db.set(e,i);if(this._size<=.9*this.maxSize)return}}},kGe=class{constructor(e,i){this._storage=new HJ,this._storage.maxSize=e,i&&this._storage.registerRemoveFunc("",i)}put(e,i){this._storage.put(e,i,1,1)}pop(e){return this._storage.pop(e)}get(e){return this._storage.get(e)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}};new kGe(1e3);new ot([128,128,128]);const BGe=new ot("white");function zGe(t){return Jl(t.resource).href}function CT(t,e){if(!t)return null;let i=null;return oC(t)?i=GGe(t):hU(t)&&(i=t.color?new ot(t.color):null),i?J3(i,e):null}function GGe(t){const e=t.symbolLayers;if(!e)return null;let i=null;return e.forEach(r=>{var s;r.type==="object"&&((s=r.resource)==null?void 0:s.href)!=null||(i=r.type==="water"?r.color:v(r.material)?r.material.color:null)}),i?new ot(i):null}function J3(t,e){if(e==null||t==null)return t;const i=t.toRgba();return i[3]=i[3]*e,new ot(i)}function jGe(t,e,i){const r=t.symbolLayers;if(!r)return;const s=n=>{const o=v(n)?n:null;return J3(e=e??o??(i!=null?BGe:null),i)};r.forEach(n=>{var o;if(n.type!=="object"||((o=n.resource)==null?void 0:o.href)==null||e)if(n.type==="water")n.color=s(n.color);else{const a=v(n.material)?n.material.color:null,l=s(a);C(n.material)?n.material=new Yu({color:l}):n.material.color=l,i!=null&&"outline"in n&&v(n.outline)&&v(n.outline.color)&&(n.outline.color=J3(n.outline.color,i))}})}function HGe(t,e,i){(e=e??t.color)&&(t.color=J3(e,i)),i!=null&&"outline"in t&&t.outline&&t.outline.color&&(t.outline.color=J3(t.outline.color,i))}function nk(t,e,i){t&&(e||i!=null)&&(e&&(e=new ot(e)),oC(t)?jGe(t,e,i):hU(t)&&HGe(t,e,i))}async function qGe(t,e){const i=t.symbolLayers;i&&await DU(i,async r=>WGe(r,e))}async function WGe(t,e){switch(t.type){case"extrude":YGe(t,e);break;case"icon":case"line":case"text":XGe(t,e);break;case"path":JGe(t,e);break;case"object":await ZGe(t,e)}}function XGe(t,e){const i=wbe(e);v(i)&&(t.size=i)}function wbe(t){for(const e of t)if(typeof e=="number")return e;return null}function YGe(t,e){t.size=typeof e[2]=="number"?e[2]:0}async function ZGe(t,e){const{resourceSize:i,symbolSize:r}=await KGe(t),s=xbe(e,i,r);t.width=VM(e[0],r[0],i[0],s),t.depth=VM(e[1],r[1],i[1],s),t.height=VM(e[2],r[2],i[2],s)}function JGe(t,e){const i=xbe(e,_m,[t.width,void 0,t.height]);t.width=VM(e[0],t.width,1,i),t.height=VM(e[2],t.height,1,i)}function xbe(t,e,i){for(let r=0;r<3;r++){const s=t[r];switch(s){case"symbol-value":{const n=i[r];return n!=null?n/e[r]:1}case"proportional":break;default:if(s&&e[r])return s/e[r]}}return 1}async function KGe(t){const e=await ee(()=>import("./symbolLayerUtils-d484f9bd.js"),[],import.meta.url),i=await e.computeObjectLayerResourceSize(t,10),{width:r,height:s,depth:n}=t,o=[r,n,s];let a=1;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/i[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=i[l]*a);return{resourceSize:i,symbolSize:o}}function VM(t,e,i,r){switch(t){case"proportional":return i*r;case"symbol-value":return e??i;default:return t}}function QGe(t,e){const i=wbe(e);if(!C(i))switch(t.type){case"simple-marker":t.size=i;break;case"picture-marker":{const r=t.width/t.height;r>1?(t.width=i,t.height=i*r):(t.width=i*r,t.height=i);break}case"simple-line":t.width=i;break;case"text":t.font.size=i}}async function eje(t,e){if(t&&e)return oC(t)?qGe(t,e):void(hU(t)&&QGe(t,e))}function tje(t,e,i){if(t&&e!=null)if(oC(t)){const r=t.symbolLayers;r&&r.forEach(s=>{if(s&&s.type==="object")switch(i){case"tilt":s.tilt=e;break;case"roll":s.roll=e;break;default:s.heading=e}})}else hU(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle=e))}function bPt(t){return v(t)&&t.type==="polygon-3d"&&t.symbolLayers.some(e=>e.type==="extrude")}async function ije(t,e){return await t.fetchSymbol(e)||t.fetchCIMSymbol(e)}const rje="<",sje=">",nje=Y6("short-date");function oje(t,e,i,r){let s="";e===0?s=`${rje} `:e===i&&(s=`${sje} `);let n=null;return n=r?Vm(t,nje):K7e(t),s+n}const aje=new ot([64,64,64]);function lje(t,e){const i=[],r=t.length-1;return t.length===5?i.push(0,2,4):i.push(0,r),t.map((s,n)=>i.includes(n)?oje(s,n,r,e):null)}async function cje(t,e,i){let r=!1,s=[],n=[];if(t.stops){const c=t.stops;s=c.map(h=>h.value),r=c.some(h=>!!h.label),r&&(n=c.map(h=>h.label))}const o=s[0],a=s[s.length-1];if(o==null&&a==null)return null;const l=r?null:lje(s,i??!1);return(await Promise.all(s.map(async(c,h)=>({value:c,color:t.type==="opacity"?await uje(c,t,e):(await ee(()=>Promise.resolve().then(()=>oK),void 0,import.meta.url)).getColor(t,c),label:r?n[h]:(l==null?void 0:l[h])??""})))).reverse()}async function uje(t,e,i=aje){const r=new ot(i),s=(await ee(()=>Promise.resolve().then(()=>oK),void 0,import.meta.url)).getOpacity(e,t);return s!=null&&(r.a=s),r}var Oj;let _R=Oj=class extends Ie{constructor(t){super(t),this.color=null,this.ratio=null}clone(){return new Oj({color:this.color,ratio:this.ratio})}};u([d({type:ot,json:{type:[Yr],default:null,write:!0}})],_R.prototype,"color",void 0),u([d({type:Number,json:{write:!0}})],_R.prototype,"ratio",void 0),_R=Oj=u([I("esri.renderers.support.HeatmapColorStop")],_R);const kM=_R;function hje(t){if(!t.colorStops)return[];const e=[...t.colorStops].filter(r=>{var s;return((s=r.color)==null?void 0:s.a)>0});let i=e.length-1;if(e&&e[0]){const r=e[i];r&&r.ratio!==1&&(e.push(new kM({ratio:1,color:r.color})),i++)}return e.map((r,s)=>{var o,a;let n="";return s===0?n=((o=t.legendOptions)==null?void 0:o.minLabel)||"low":s===i&&(n=((a=t.legendOptions)==null?void 0:a.maxLabel)||"high"),{color:r.color,label:n,ratio:r.ratio}}).reverse()}oe.getLogger("esri.renderers.support.utils");async function cu(t,e,i){VY(t,e,()=>[]).push(...i)}async function dje(t){var i,r;const e=new Map;if(!t)return e;if("visualVariables"in t&&t.visualVariables){const s=t.visualVariables.filter(n=>n.type==="color");for(const n of s){const o=(await cje(n)??[]).map(a=>a.color);await cu(e,n.field||n.valueExpression,o)}}if(t.type==="heatmap"){const s=hje(t).map(n=>n.color);await cu(e,t.field||t.valueExpression,s)}else if(t.type==="pie-chart"){for(const s of t.attributes)await cu(e,s.field||s.valueExpression,[s.color]);await cu(e,"default",[(i=t==null?void 0:t.othersCategory)==null?void 0:i.color,CT(t.backgroundFillSymbol,null)])}else if(t.type==="dot-density"){for(const s of t.attributes)await cu(e,s.field||s.valueExpression,[s.color]);await cu(e,"default",[t.backgroundColor])}else if(t.type==="unique-value")if(((r=t.authoringInfo)==null?void 0:r.type)==="predominance")for(const s of t.uniqueValueInfos??[])await cu(e,s.value.toString(),[CT(s.symbol,null)]);else{const s=(t.uniqueValueInfos??[]).map(c=>CT(c.symbol,null)),{field:n,field2:o,field3:a,valueExpression:l}=t;(n||l)&&await cu(e,n||l,s),o&&await cu(e,o,s),a&&await cu(e,a,s)}else if(t.type==="class-breaks"){const s=t.classBreakInfos.map(a=>CT(a.symbol,null)),{field:n,valueExpression:o}=t;await cu(e,n??o,s)}else t.type==="simple"&&await cu(e,"default",[CT(t.symbol,null)]);return"defaultSymbol"in t&&t.defaultSymbol&&await cu(e,"default",[CT(t.defaultSymbol,null)]),e.forEach((s,n)=>{const o=kP(s.filter(Boolean),(a,l)=>JSON.stringify(a)===JSON.stringify(l));e.set(n,o)}),e}var Rj;let vR=Rj=class extends Ie{constructor(t){super(t),this.name=null,this.code=null}clone(){return new Rj({name:this.name,code:this.code})}};u([d({type:String,json:{write:!0}})],vR.prototype,"name",void 0),u([d({type:[String,Number],json:{write:!0}})],vR.prototype,"code",void 0),vR=Rj=u([I("esri.layers.support.CodedValue")],vR);const pje=new Gi({inherited:"inherited",codedValue:"coded-value",range:"range"});let bR=class extends Ie{constructor(e){super(e),this.name=null,this.type=null}};u([d({type:String,json:{write:!0}})],bR.prototype,"name",void 0),u([At(pje)],bR.prototype,"type",void 0),bR=u([I("esri.layers.support.Domain")],bR);const FU=bR;var Mj;let wR=Mj=class extends FU{constructor(t){super(t),this.codedValues=null,this.type="coded-value"}getName(t){let e=null;if(this.codedValues){const i=String(t);this.codedValues.some(r=>(String(r.code)===i&&(e=r.name),!!e))}return e}clone(){return new Mj({codedValues:ae(this.codedValues),name:this.name})}};u([d({type:[vR],json:{write:!0}})],wR.prototype,"codedValues",void 0),u([At({codedValue:"coded-value"})],wR.prototype,"type",void 0),wR=Mj=u([I("esri.layers.support.CodedValueDomain")],wR);const Tbe=wR;var Pj;let DN=Pj=class extends FU{constructor(t){super(t),this.type="inherited"}clone(){return new Pj}};u([At({inherited:"inherited"})],DN.prototype,"type",void 0),DN=Pj=u([I("esri.layers.support.InheritedDomain")],DN);const Sbe=DN;var Ij;let J2=Ij=class extends FU{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new Ij({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range&&e.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,i){e[i]=[this.minValue||0,t]}}}})],J2.prototype,"maxValue",void 0),u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range&&e.range[0]},write:{target:"range",writer(t,e,i){e[i]=[t,this.maxValue||0]}}}})],J2.prototype,"minValue",void 0),u([At({range:"range"})],J2.prototype,"type",void 0),J2=Ij=u([I("esri.layers.support.RangeDomain")],J2);const Ebe=J2,Cbe={key:"type",base:FU,typeMap:{range:Ebe,"coded-value":Tbe,inherited:Sbe}};function qJ(t){if(!t||!t.type)return null;switch(t.type){case"range":return Ebe.fromJSON(t);case"codedValue":return Tbe.fromJSON(t);case"inherited":return Sbe.fromJSON(t)}return null}const fje=new Gi({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"});var $j;const mje=new Gi({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let Za=$j=class extends Ie{constructor(t){super(t),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(t,{description:e}){let i=null;try{i=e?JSON.parse(e):null}catch{}return(i==null?void 0:i.value)??null}readValueType(t,{description:e}){let i=null;try{i=e?JSON.parse(e):null}catch{}return i?mje.fromJSON(i.fieldValueType):null}clone(){return new $j({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};u([d({type:String,json:{write:!0}})],Za.prototype,"alias",void 0),u([d({type:[String,Number],json:{write:{allowNull:!0}}})],Za.prototype,"defaultValue",void 0),u([d()],Za.prototype,"description",void 0),u([Qe("description")],Za.prototype,"readDescription",null),u([d({types:Cbe,json:{read:{reader:qJ},write:!0}})],Za.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],Za.prototype,"editable",void 0),u([d({type:Yr,json:{write:!0}})],Za.prototype,"length",void 0),u([d({type:String,json:{write:!0}})],Za.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0}})],Za.prototype,"nullable",void 0),u([At(fje)],Za.prototype,"type",void 0),u([d()],Za.prototype,"valueType",void 0),u([Qe("valueType",["description"])],Za.prototype,"readValueType",null),u([d({type:Boolean,json:{read:!1}})],Za.prototype,"visible",void 0),Za=$j=u([I("esri.layers.support.Field")],Za);const UU=Za;var Lj;let K2=Lj=class extends Ie{constructor(t){super(t),this.type="map-layer"}clone(){const{mapLayerId:t,gdbVersion:e}=this;return new Lj({mapLayerId:t,gdbVersion:e})}};u([At({mapLayer:"map-layer"})],K2.prototype,"type",void 0),u([d({type:Yr,json:{write:!0}})],K2.prototype,"mapLayerId",void 0),u([d({type:String,json:{write:!0}})],K2.prototype,"gdbVersion",void 0),K2=Lj=u([I("esri.layers.support.source.MapLayerSource")],K2);var Dj;let kg=Dj=class extends Ie{constructor(t){super(t),this.type="query-table"}clone(){const{workspaceId:t,query:e,oidFields:i,spatialReference:r,geometryType:s}=this,n={workspaceId:t,query:e,oidFields:i,spatialReference:(r==null?void 0:r.clone())??void 0,geometryType:s};return new Dj(n)}};u([At({queryTable:"query-table"})],kg.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],kg.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],kg.prototype,"query",void 0),u([d({type:String,json:{write:!0}})],kg.prototype,"oidFields",void 0),u([d({type:mt,json:{write:!0}})],kg.prototype,"spatialReference",void 0),u([At(lye)],kg.prototype,"geometryType",void 0),kg=Dj=u([I("esri.layers.support.source.QueryTableDataSource")],kg);var Nj;let Q2=Nj=class extends Ie{constructor(t){super(t),this.type="raster"}clone(){const{workspaceId:t,dataSourceName:e}=this;return new Nj({workspaceId:t,dataSourceName:e})}};u([At({raster:"raster"})],Q2.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Q2.prototype,"dataSourceName",void 0),u([d({type:String,json:{write:!0}})],Q2.prototype,"workspaceId",void 0),Q2=Nj=u([I("esri.layers.support.source.RasterDataSource")],Q2);var Fj;let Fb=Fj=class extends Ie{constructor(t){super(t),this.type="table"}clone(){const{workspaceId:t,gdbVersion:e,dataSourceName:i}=this;return new Fj({workspaceId:t,gdbVersion:e,dataSourceName:i})}};u([At({table:"table"})],Fb.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Fb.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],Fb.prototype,"gdbVersion",void 0),u([d({type:String,json:{write:!0}})],Fb.prototype,"dataSourceName",void 0),Fb=Fj=u([I("esri.layers.support.source.TableDataSource")],Fb);var Uj,Vj;const gje=Ua()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let bu=Uj=class extends Ie{constructor(t){super(t),this.type="join-table"}readLeftTableSource(t,e,i){return gse()(t,e,i)}castLeftTableSource(t){return Xp(kj(),t)}readRightTableSource(t,e,i){return gse()(t,e,i)}castRightTableSource(t){return Xp(kj(),t)}clone(){const{leftTableKey:t,rightTableKey:e,leftTableSource:i,rightTableSource:r,joinType:s}=this,n={leftTableKey:t,rightTableKey:e,leftTableSource:(i==null?void 0:i.clone())??void 0,rightTableSource:(r==null?void 0:r.clone())??void 0,joinType:s};return new Uj(n)}};u([At({joinTable:"join-table"})],bu.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],bu.prototype,"leftTableKey",void 0),u([d({type:String,json:{write:!0}})],bu.prototype,"rightTableKey",void 0),u([d({json:{write:!0}})],bu.prototype,"leftTableSource",void 0),u([Qe("leftTableSource")],bu.prototype,"readLeftTableSource",null),u([wi("leftTableSource")],bu.prototype,"castLeftTableSource",null),u([d({json:{write:!0}})],bu.prototype,"rightTableSource",void 0),u([Qe("rightTableSource")],bu.prototype,"readRightTableSource",null),u([wi("rightTableSource")],bu.prototype,"castRightTableSource",null),u([At(gje)],bu.prototype,"joinType",void 0),bu=Uj=u([I("esri.layers.support.source.JoinTableDataSource")],bu);let ok=null;function gse(){return ok||(ok=f1({types:kj()})),ok}let ak=null;function kj(){return ak||(ak={key:"type",base:null,typeMap:{"data-layer":_p,"map-layer":K2}}),ak}const yje={key:"type",base:null,typeMap:{"join-table":bu,"query-table":kg,raster:Q2,table:Fb}};let _p=Vj=class extends Ie{constructor(t){super(t),this.type="data-layer"}clone(){const{fields:t,dataSource:e}=this;return new Vj({fields:t,dataSource:e})}};u([At({dataLayer:"data-layer"})],_p.prototype,"type",void 0),u([d({type:[UU],json:{write:!0}})],_p.prototype,"fields",void 0),u([d({types:yje,json:{write:!0}})],_p.prototype,"dataSource",void 0),_p=Vj=u([I("esri.layers.support.source.DataLayerSource")],_p),_p.from=mn(_p);function _je(t,e){return e?{...e,query:{...t??{},...e.query}}:{query:t}}function WJ(t){return typeof t=="string"?vl(t):ae(t)}function vje(t,e,i){const r={};for(const s in t){if(s==="declaredClass")continue;const n=t[s];if(n!=null&&typeof n!="function")if(Array.isArray(n)){r[s]=[];for(let o=0;o<n.length;o++)r[s][o]=vje(n[o])}else if(typeof n=="object")if(n.toJSON){const o=n.toJSON(i&&i[s]);r[s]=e?o:JSON.stringify(o)}else r[s]=e?n:JSON.stringify(n);else r[s]=n}return r}const C$={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new Rp({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:mt.WebMercator}),minus180Line:new Rp({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:mt.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new Rp({paths:[[[180,-180],[180,180]]],spatialReference:mt.WGS84}),minus180Line:new Rp({paths:[[[-180,-180],[-180,180]]],spatialReference:mt.WGS84})}};function Xw(t,e){return Math.ceil((t-e)/(2*e))}function Abe(t,e){const i=BM(t);for(const r of i)for(const s of r)s[0]+=e;return t}function BM(t){return $v(t)?t.rings:t.paths}async function bje(t,e,i,r){const s=WJ(t),n=e[0].spatialReference,o={...r,query:{...s.query,f:"json",sr:JSON.stringify(n),target:JSON.stringify({geometryType:YC(e[0]),geometries:e}),cutter:JSON.stringify(i)}},a=await zr(s.path+"/cut",o),{cutIndexes:l,geometries:c=[]}=a.data;return{cutIndexes:l,geometries:c.map(h=>{const p=Gy(h);return p.spatialReference=n,p})}}function wje(t){return{geometryType:YC(t[0]),geometries:t.map(e=>e.toJSON())}}function Obe(t,e,i){const r=J4e(e);return t.map(s=>{const n=r.fromJSON(s);return n.spatialReference=i,n})}async function xje(t,e,i){const r=typeof t=="string"?vl(t):t,s=e[0].spatialReference,n=YC(e[0]),o={...i,query:{...r.query,f:"json",sr:s.wkid?s.wkid:JSON.stringify(s),geometries:JSON.stringify(wje(e))}},{data:a}=await zr(r.path+"/simplify",o);return Obe(a.geometries,n,s)}const Rbe=oe.getLogger("esri.geometry.support.normalizeUtils");function Tje(t){return t.type==="polygon"}function Sje(t){return t[0].type==="polygon"}function Eje(t){return t[0].type==="polyline"}function Cje(t,e){if(!(t instanceof Rp||t instanceof md)){const s="straightLineDensify: the input geometry is neither polyline nor polygon";throw Rbe.error(s),new W(s)}const i=BM(t),r=[];for(const s of i){const n=[];r.push(n),n.push([s[0][0],s[0][1]]);for(let o=0;o<s.length-1;o++){const a=s[o][0],l=s[o][1],c=s[o+1][0],h=s[o+1][1],p=Math.sqrt((c-a)*(c-a)+(h-l)*(h-l)),f=(h-l)/p,m=(c-a)/p,y=p/e;if(y>1){for(let S=1;S<=y-1;S++){const T=S*e,E=m*T+a,O=f*T+l;n.push([E,O])}const _=(p+Math.floor(y-1)*e)/2,b=m*_+a,w=f*_+l;n.push([b,w])}n.push([c,h])}}return Tje(t)?new md({rings:r,spatialReference:t.spatialReference}):new Rp({paths:r,spatialReference:t.spatialReference})}function yse(t,e,i){if(e){const r=Cje(t,1e6);t=BS(r,!0)}return i&&(t=Abe(t,i)),t}function _se(t,e,i){if(Array.isArray(t)){const r=t[0];if(r>e){const s=Xw(r,e);t[0]=r+s*(-2*e)}else if(r<i){const s=Xw(r,i);t[0]=r+s*(-2*i)}}else{const r=t.x;if(r>e){const s=Xw(r,e);t=t.clone().offset(s*(-2*e),0)}else if(r<i){const s=Xw(r,i);t=t.clone().offset(s*(-2*i),0)}}return t}function Aje(t,e){let i=-1;for(let r=0;r<e.cutIndexes.length;r++){const s=e.cutIndexes[r],n=e.geometries[r],o=BM(n);for(let a=0;a<o.length;a++){const l=o[a];l.some(c=>{if(c[0]<180)return!0;{let h=0;for(let f=0;f<l.length;f++){const m=l[f][0];h=m>h?m:h}h=Number(h.toFixed(9));const p=-360*Xw(h,180);for(let f=0;f<l.length;f++){const m=n.getPoint(a,f);n.setPoint(a,f,m.clone().offset(p,0))}return!0}})}if(s===i){if(Sje(t))for(const a of BM(n))t[s]=t[s].addRing(a);else if(Eje(t))for(const a of BM(n))t[s]=t[s].addPath(a)}else i=s,t[s]=n}return t}async function Mbe(t,e,i){if(!Array.isArray(t))return Mbe([t],e);e&&typeof e!="string"&&Rbe.warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const r=typeof e=="string"?e:(e==null?void 0:e.url)??ar.geometryServiceUrl;let s,n,o,a,l,c,h,p,f=0;const m=[],y=[];for(const E of t)if(C(E))y.push(E);else if(s||(s=E.spatialReference,n=Bp(s),o=s.isWebMercator,c=o?102100:4326,a=C$[c].maxX,l=C$[c].minX,h=C$[c].plus180Line,p=C$[c].minus180Line),n)if(E.type==="mesh")y.push(E);else if(E.type==="point")y.push(_se(E.clone(),a,l));else if(E.type==="multipoint"){const O=E.clone();O.points=O.points.map(R=>_se(R,a,l)),y.push(O)}else if(E.type==="extent"){const O=E.clone()._normalize(!1,!1,n);y.push(O.rings?new md(O):O)}else if(E.extent){const O=E.extent,R=Xw(O.xmin,l)*(2*a);let L=R===0?E.clone():Abe(E.clone(),R);O.offset(R,0),O.intersects(h)&&O.xmax!==a?(f=O.xmax>f?O.xmax:f,L=yse(L,o),m.push(L),y.push("cut")):O.intersects(p)&&O.xmin!==l?(f=O.xmax*(2*a)>f?O.xmax*(2*a):f,L=yse(L,o,360),m.push(L),y.push("cut")):y.push(L)}else y.push(E.clone());else y.push(E);let _=Xw(f,a),b=-90;const w=_,S=new Rp;for(;_>0;){const E=360*_-180;S.addPath([[E,b],[E,-1*b]]),b*=-1,_--}if(m.length>0&&w>0){const E=Aje(m,await bje(r,m,S,i)),O=[],R=[];for(let F=0;F<y.length;F++){const V=y[F];if(V!=="cut")R.push(V);else{const B=E.shift(),G=t[F];v(G)&&G.type==="polygon"&&G.rings&&G.rings.length>1&&B.rings.length>=G.rings.length?(O.push(B),R.push("simplify")):R.push(o?Ey(B):B)}}if(!O.length)return R;const L=await xje(r,O,i),P=[];for(let F=0;F<R.length;F++){const V=R[F];V!=="simplify"?P.push(V):P.push(o?Ey(L.shift()):L.shift())}return P}const T=[];for(let E=0;E<y.length;E++){const O=y[E];if(O!=="cut")T.push(O);else{const R=m.shift();T.push(o===!0?Ey(R):R)}}return T}function xPt(t,e){const i=Bp(e);if(i){const[r,s]=i.valid,n=s-r;if(t<r)for(;t<r;)t+=n;if(t>s)for(;t>s;)t-=n}return t}function Pbe(t){const e={};for(const i in t){if(i==="declaredClass")continue;const r=t[i];if(r!=null&&typeof r!="function")if(Array.isArray(r)){e[i]=[];for(let s=0;s<r.length;s++)e[i][s]=Pbe(r[s])}else typeof r=="object"?r.toJSON&&(e[i]=JSON.stringify(r)):e[i]=r}return e}var Y_;(function(t){t[t.varint=0]="varint",t[t.fixed64=1]="fixed64",t[t.delimited=2]="delimited",t[t.fixed32=5]="fixed32",t[t.unknown=99]="unknown"})(Y_||(Y_={}));const vse=4294967296,Oje=new TextDecoder("utf-8"),Rje=de("safari")||de("ios")?6:de("ff")?12:32;let Bj=class NN{constructor(e,i,r=0,s=e?e.byteLength:0){this._tag=0,this._dataType=Y_.unknown,this._init(e,i,r,s)}_init(e,i,r,s){this._data=e,this._dataView=i,this._pos=r,this._end=s}asUnsafe(){return this}clone(){return new NN(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(e){this._pos=e}nextTag(e){for(;;){if(this._pos===this._end)return!1;const i=this._decodeVarint();if(this._tag=i>>3,this._dataType=7&i,!e||e===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const e=this._decodeVarint();return this._tag=e>>3,this._dataType=7&e,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let e=4294967295;return e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?e:(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?e:void 0))))}getUInt64(){return this._decodeVarint()}getSInt32(){const e=this.getUInt32();if(e!==void 0)return e>>>1^-(1&e)|0}getSInt64(){return this._decodeSVarint()}getBool(){const e=this._data[this._pos]!==0;return this._skip(1),e}getEnum(){return this._decodeVarint()}getFixed64(){const e=this._dataView,i=this._pos,r=e.getUint32(i,!0)+e.getUint32(i+4,!0)*vse;return this._skip(8),r}getSFixed64(){const e=this._dataView,i=this._pos,r=e.getUint32(i,!0)+e.getInt32(i+4,!0)*vse;return this._skip(8),r}getDouble(){const e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e}getFixed32(){const e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e}getSFixed32(){const e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e}getFloat(){const e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e}getString(){const e=this._getLength(),i=this._pos,r=this._toString(this._data,i,i+e);return this._skip(e),r}getBytes(){const e=this._getLength(),i=this._pos,r=this._toBytes(this._data,i,i+e);return this._skip(e),r}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(e,i,r,s){const n=this.getMessage(),o=e(n,i,r,s);return n.release(),o}processMessage(e){const i=this.getMessage(),r=e(i);return i.release(),r}getMessage(){const e=this._getLength(),i=NN.pool.acquire();return i._init(this._data,this._dataView,this._pos,this._pos+e),this._skip(e),i}release(){NN.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case Y_.varint:this._decodeVarint();break;case Y_.fixed64:this._skip(8);break;case Y_.delimited:this._skip(this._getLength());break;case Y_.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(e){this._skip(e)}_skip(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e}_decodeVarint(){const e=this._data;let i=this._pos,r=0,s=0;if(this._end-i>=10)do{if(s=e[i++],r|=127&s,(128&s)==0||(s=e[i++],r|=(127&s)<<7,(128&s)==0)||(s=e[i++],r|=(127&s)<<14,(128&s)==0)||(s=e[i++],r|=(127&s)<<21,(128&s)==0)||(s=e[i++],r+=268435456*(127&s),(128&s)==0)||(s=e[i++],r+=34359738368*(127&s),(128&s)==0)||(s=e[i++],r+=4398046511104*(127&s),(128&s)==0)||(s=e[i++],r+=562949953421312*(127&s),(128&s)==0)||(s=e[i++],r+=72057594037927940*(127&s),(128&s)==0)||(s=e[i++],r+=9223372036854776e3*(127&s),(128&s)==0))break;throw new Error("Varint too long!")}while(0);else{let n=1;for(;i!==this._end&&(s=e[i],(128&s)!=0);)++i,r+=(127&s)*n,n*=128;if(i===this._end)throw new Error("Varint overrun!");++i,r+=s*n}return this._pos=i,r}_decodeSVarint(){const e=this._data;let i=this._pos,r=0,s=0;const n=1&e[i];if(this._end-i>=10)do{if(s=e[i++],r|=127&s,(128&s)==0||(s=e[i++],r|=(127&s)<<7,(128&s)==0)||(s=e[i++],r|=(127&s)<<14,(128&s)==0)||(s=e[i++],r|=(127&s)<<21,(128&s)==0)||(s=e[i++],r+=268435456*(127&s),(128&s)==0)||(s=e[i++],r+=34359738368*(127&s),(128&s)==0)||(s=e[i++],r+=4398046511104*(127&s),(128&s)==0)||(s=e[i++],r+=562949953421312*(127&s),(128&s)==0)||(s=e[i++],r+=72057594037927940*(127&s),(128&s)==0)||(s=e[i++],r+=9223372036854776e3*(127&s),(128&s)==0))break;throw new Error("Varint too long!")}while(0);else{let o=1;for(;i!==this._end&&(s=e[i],(128&s)!=0);)++i,r+=(127&s)*o,o*=128;if(i===this._end)throw new Error("Varint overrun!");++i,r+=s*o}return this._pos=i,n?-(r+1)/2:r/2}_getLength(){if(this._dataType!==Y_.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(e,i,r){if((r=Math.min(this._end,r))-i>Rje){const o=e.subarray(i,r);return Oje.decode(o)}let s="",n="";for(let o=i;o<r;++o){const a=e[o];128&a?n+="%"+a.toString(16):(s+=decodeURIComponent(n)+String.fromCharCode(a),n="")}return n.length&&(s+=decodeURIComponent(n)),s}_toBytes(e,i,r){return r=Math.min(this._end,r),new Uint8Array(e.buffer,i,r-i)}};Bj.pool=new yo(Bj,void 0,t=>{t._data=null,t._dataView=null});let Qp=class FN{constructor(e=[],i=[],r=!1){this.lengths=e??[],this.coords=i??[],this.hasIndeterminateRingOrder=r}static fromRect(e){const[i,r,s,n]=e,o=s-i,a=n-r;return new FN([5],[i,r,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,i)=>e+i)}forEachVertex(e){let i=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];for(let n=0;n<s;n++)e(this.coords[2*(n+i)],this.coords[2*(n+i)+1]);i+=s}}clone(e){return e?(e.set(this.coords),new FN(this.lengths.slice(),e,this.hasIndeterminateRingOrder)):new FN(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}},e1=class Ibe{constructor(e=null,i={},r,s){this.geometry=e,this.attributes=i,this.centroid=r,this.objectId=s,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const e=new Ibe(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}};function Mje(t){return!(C(t.geometry)||!t.geometry.coords||!t.geometry.coords.length)}let TPt=class extends e1{},$be=class Lbe{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new Lbe;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}};const Dbe=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];let EPt=class{constructor(e){this._options=e,this.geometryTypes=Dbe,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new $be}prepareFeatures(e){this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++}finishFeatureResult(e){if(!e||!e.features||!e.hasZ||!this._options.sourceSpatialReference||!e.spatialReference||rn(e.spatialReference,this._options.sourceSpatialReference)||e.spatialReference.vcsWkid)return;const i=wx(this._options.sourceSpatialReference)/wx(e.spatialReference);if(i!==1)for(const r of e.features){if(!Mje(r))continue;const s=r.geometry.coords;for(let n=2;n<s.length;n+=3)s[n]*=i}}addFeature(e,i){e.features.push(i)}createFeature(){return new e1}createSpatialReference(){return{wkid:0}}createGeometry(){return new Qp}addField(e,i){e.fields.push(i)}allocateCoordinates(e){e.coords.length=e.lengths.reduce((i,r)=>i+r,0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(e,i){e.coords[this._coordinatePtr++]=i}addCoordinatePoint(e,i){e.coords.push(i)}addLength(e,i){e.lengths.push(i)}addQueryGeometry(e,i){e.queryGeometry=i.queryGeometry,e.queryGeometryType=i.queryGeometryType}createPointGeometry(){return new Qp}};const bse=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],wse=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],xse=["upperLeft","lowerLeft"];function Tse(t){return t>=bse.length?null:bse[t]}function Pje(t){return t>=wse.length?null:wse[t]}function Sse(t){return t>=xse.length?null:xse[t]}function Ese(t,e){return e>=t.geometryTypes.length?null:t.geometryTypes[e]}function Ije(t,e,i){const s=t.asUnsafe(),n=e.createPointGeometry(i);for(;s.next();)switch(s.tag()){case 3:{const o=s.getUInt32(),a=s.pos()+o;let l=0;for(;s.pos()<a;)e.addCoordinatePoint(n,s.getSInt64(),l++);break}default:s.skip()}return n}function $je(t,e,i){const n=t.asUnsafe(),o=e.createGeometry(i),a=2+(i.hasZ?1:0)+(i.hasM?1:0);for(;n.next();)switch(n.tag()){case 2:{const l=n.getUInt32(),c=n.pos()+l;let h=0;for(;n.pos()<c;)e.addLength(o,n.getUInt32(),h++);break}case 3:{const l=n.getUInt32(),c=n.pos()+l;let h=0;for(e.allocateCoordinates(o);n.pos()<c;)e.addCoordinate(o,n.getSInt64(),h),h++,h===a&&(h=0);break}default:n.skip()}return o}function Lje(t){const s=t.asUnsafe(),n=new Qp;let o="esriGeometryPoint";for(;s.next();)switch(s.tag()){case 2:{const a=s.getUInt32(),l=s.pos()+a;for(;s.pos()<l;)n.lengths.push(s.getUInt32());break}case 3:{const a=s.getUInt32(),l=s.pos()+a;for(;s.pos()<l;)n.coords.push(s.getSInt64());break}case 1:o=Dbe[s.getEnum()];break;default:s.skip()}return{queryGeometry:n,queryGeometryType:o}}function Dje(t){const h=t.asUnsafe();for(;h.next();)switch(h.tag()){case 1:return h.getString();case 2:return h.getFloat();case 3:return h.getDouble();case 4:return h.getSInt32();case 5:return h.getUInt32();case 6:return h.getInt64();case 7:return h.getUInt64();case 8:return h.getSInt64();case 9:return h.getBool();default:return h.skip(),null}return null}function Nje(t){const a=t.asUnsafe(),l={type:Tse(0)};for(;a.next();)switch(a.tag()){case 1:l.name=a.getString();break;case 2:l.type=Tse(a.getEnum());break;case 3:l.alias=a.getString();break;case 4:l.sqlType=Pje(a.getEnum());break;case 5:a.skip();break;case 6:l.defaultValue=a.getString();break;default:a.skip()}return l}function Fje(t){const r={},s=t.asUnsafe();for(;s.next();)switch(s.tag()){case 1:r.name=s.getString();break;case 2:r.isSystemMaintained=s.getBool();break;default:s.skip()}return r}function Uje(t,e,i,r){const a=e.createFeature(i);let l=0;for(;t.next();)switch(t.tag()){case 1:{const c=r[l++].name;a.attributes[c]=t.processMessage(Dje);break}case 2:a.geometry=t.processMessageWithArgs($je,e,i);break;case 4:a.centroid=t.processMessageWithArgs(Ije,e,i);break;default:t.skip()}return a}function Vje(t){const n=[1,1,1,1],o=t.asUnsafe();for(;o.next();)switch(o.tag()){case 1:n[0]=o.getDouble();break;case 2:n[1]=o.getDouble();break;case 4:n[2]=o.getDouble();break;case 3:n[3]=o.getDouble();break;default:o.skip()}return n}function kje(t){const n=[0,0,0,0],o=t.asUnsafe();for(;o.next();)switch(o.tag()){case 1:n[0]=o.getDouble();break;case 2:n[1]=o.getDouble();break;case 4:n[2]=o.getDouble();break;case 3:n[3]=o.getDouble();break;default:o.skip()}return n}function Bje(t){const s={originPosition:Sse(0)},n=t.asUnsafe();for(;n.next();)switch(n.tag()){case 1:s.originPosition=Sse(n.getEnum());break;case 2:s.scale=n.processMessage(Vje);break;case 3:s.translate=n.processMessage(kje);break;default:n.skip()}return s}function zje(t){const s={},n=t.asUnsafe();for(;n.next();)switch(n.tag()){case 1:s.shapeAreaFieldName=n.getString();break;case 2:s.shapeLengthFieldName=n.getString();break;case 3:s.units=n.getString();break;default:n.skip()}return s}function Gje(t,e){const a=e.createSpatialReference();for(;t.next();)switch(t.tag()){case 1:a.wkid=t.getUInt32();break;case 5:a.wkt=t.getString();break;case 2:a.latestWkid=t.getUInt32();break;case 3:a.vcsWkid=t.getUInt32();break;case 4:a.latestVcsWkid=t.getUInt32();break;default:t.skip()}return a}function jje(t,e){const _=e.createFeatureResult(),b=t.asUnsafe();_.geometryType=Ese(e,0);let w=!1;for(;b.next();)switch(b.tag()){case 1:_.objectIdFieldName=b.getString();break;case 3:_.globalIdFieldName=b.getString();break;case 4:_.geohashFieldName=b.getString();break;case 5:_.geometryProperties=b.processMessage(zje);break;case 7:_.geometryType=Ese(e,b.getEnum());break;case 8:_.spatialReference=b.processMessageWithArgs(Gje,e);break;case 10:_.hasZ=b.getBool();break;case 11:_.hasM=b.getBool();break;case 12:_.transform=b.processMessage(Bje);break;case 9:{const S=b.getBool();_.exceededTransferLimit=S;break}case 13:e.addField(_,b.processMessage(Nje));break;case 15:w||(e.prepareFeatures(_),w=!0),e.addFeature(_,b.processMessageWithArgs(Uje,e,_,_.fields));break;case 2:_.uniqueIdField=b.processMessage(Fje);break;default:b.skip()}return e.finishFeatureResult(_),_}function Hje(t,e){const s={};let n=null;for(;t.next();)switch(t.tag()){case 4:n=t.processMessageWithArgs(Lje);break;case 1:s.featureResult=t.processMessageWithArgs(jje,e);break;default:t.skip()}return v(n)&&s.featureResult&&e.addQueryGeometry(s,n),s}function qje(t,e){try{const r=new Bj(new Uint8Array(t),new DataView(t)),s={};for(;r.next();)r.tag()===2?s.queryResult=r.processMessageWithArgs(Hje,e):r.skip();return s}catch(i){throw new W("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:i})}}function Wje(t,e){const i=qje(t,e),r=i.queryResult.featureResult,s=i.queryResult.queryGeometry,n=i.queryResult.queryGeometryType;if(r&&r.features&&r.features.length&&r.objectIdFieldName){const o=r.objectIdFieldName;for(const a of r.features)a.attributes&&(a.objectId=a.attributes[o])}return r&&(r.queryGeometry=s,r.queryGeometryType=n),r}function zj(t,e,i){if(!i||!i.features||!i.hasZ)return;const r=w_e(i.geometryType,e,t.outSpatialReference);if(!C(r))for(const s of i.features)r(s.geometry)}const Cse="Layer does not support extent calculation.";function Xje(t,e){if(e&&t.type==="extent")return`${t.xmin},${t.ymin},${t.xmax},${t.ymax}`;if(e&&t.type==="point")return`${t.x},${t.y}`;const i=t.toJSON();return delete i.spatialReference,JSON.stringify(i)}function Yje(t,e){const i=t.geometry,r=t.toJSON();delete r.compactGeometryEnabled,delete r.defaultSpatialReferenceEnabled;const s=r;let n,o,a;if(v(i)&&(o=i.spatialReference,a=i.spatialReference.wkid||JSON.stringify(i.spatialReference),s.geometryType=YC(i),s.geometry=Xje(i,t.compactGeometryEnabled),s.inSR=a),r.groupByFieldsForStatistics&&(s.groupByFieldsForStatistics=r.groupByFieldsForStatistics.join(",")),r.objectIds&&(s.objectIds=r.objectIds.join(",")),r.orderByFields&&(s.orderByFields=r.orderByFields.join(",")),!r.outFields||!r.returnDistinctValues&&(e!=null&&e.returnCountOnly||e!=null&&e.returnExtentOnly||e!=null&&e.returnIdsOnly)?delete s.outFields:r.outFields.includes("*")?s.outFields="*":s.outFields=r.outFields.join(","),r.outSR?(s.outSR=r.outSR.wkid||JSON.stringify(r.outSR),n=t.outSpatialReference):i&&(r.returnGeometry||r.returnCentroid)&&(s.outSR=s.inSR,n=o),r.returnGeometry&&delete r.returnGeometry,r.outStatistics&&(s.outStatistics=JSON.stringify(r.outStatistics)),r.fullText&&(s.fullText=JSON.stringify(r.fullText)),r.pixelSize&&(s.pixelSize=JSON.stringify(r.pixelSize)),r.quantizationParameters&&(t.defaultSpatialReferenceEnabled&&v(o)&&v(t.quantizationParameters)&&v(t.quantizationParameters.extent)&&o.equals(t.quantizationParameters.extent.spatialReference)&&delete r.quantizationParameters.extent.spatialReference,s.quantizationParameters=JSON.stringify(r.quantizationParameters)),r.parameterValues&&(s.parameterValues=JSON.stringify(r.parameterValues)),r.rangeValues&&(s.rangeValues=JSON.stringify(r.rangeValues)),r.dynamicDataSource&&(s.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r.timeExtent){const l=r.timeExtent,{start:c,end:h}=l;c==null&&h==null||(s.time=c===h?c:`${c??"null"},${h??"null"}`),delete r.timeExtent}return t.defaultSpatialReferenceEnabled&&v(o)&&v(n)&&o.equals(n)&&(s.defaultSR=s.inSR,delete s.inSR,delete s.outSR),s}async function Zje(t,e,i,r){const s=v(e.timeExtent)&&e.timeExtent.isEmpty?{data:{features:[]}}:await pI(t,e,"json",r);return zj(e,i,s.data),s}async function APt(t,e,i,r){if(v(e.timeExtent)&&e.timeExtent.isEmpty)return{data:i.createFeatureResult()};const s=await Jje(t,e,r),n=s;return n.data=Wje(s.data,i),n}function Jje(t,e,i){return pI(t,e,"pbf",i)}function OPt(t,e,i){return v(e.timeExtent)&&e.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):pI(t,e,"json",i,{returnIdsOnly:!0})}function RPt(t,e,i){return v(e.timeExtent)&&e.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):pI(t,e,"json",i,{returnIdsOnly:!0,returnCountOnly:!0})}function MPt(t,e,i){return v(e.timeExtent)&&e.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):pI(t,e,"json",i,{returnExtentOnly:!0,returnCountOnly:!0}).then(r=>{const s=r.data;if(s.hasOwnProperty("extent"))return r;if(s.features)throw new Error(Cse);if(s.hasOwnProperty("count"))throw new Error(Cse);return r})}function pI(t,e,i,r={},s={}){const n=typeof t=="string"?vl(t):t,o=e.geometry?[e.geometry]:[];return r.responseType=i==="pbf"?"array-buffer":"json",Mbe(o,null,r).then(a=>{const l=a&&a[0];v(l)&&((e=e.clone()).geometry=l);const c=Pbe({...n.query,f:i,...s,...Yje(e,s)});return zr(Ax(n.path,"query"),{...r,query:{...c,...r.query}})})}var Gj;const jj=new Gi({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let Qo=Gj=class extends Ie{constructor(t){super(t),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(t,e){var s;const i=mt.fromJSON(e.spatialReference),r=[];for(let n=0;n<t.length;n++){const o=t[n],a=ha.fromJSON(o),l=o.geometry&&o.geometry.spatialReference;v(a.geometry)&&!l&&(a.geometry.spatialReference=i);const c=o.aggregateGeometries,h=a.aggregateGeometries;if(c&&v(h))for(const p in h){const f=h[p],m=(s=c[p])==null?void 0:s.spatialReference;v(f)&&!m&&(f.spatialReference=i)}r.push(a)}return r}writeGeometryType(t,e,i,r){if(t)return void jj.write(t,e,i,r);const{features:s}=this;if(s){for(const n of s)if(n&&v(n.geometry))return void jj.write(n.geometry.type,e,i,r)}}readQueryGeometry(t,e){if(!t)return null;const i=!!t.spatialReference,r=Gy(t);return r&&!i&&e.spatialReference&&(r.spatialReference=mt.fromJSON(e.spatialReference)),r}writeSpatialReference(t,e){if(t)return void(e.spatialReference=t.toJSON());const{features:i}=this;if(i){for(const r of i)if(r&&v(r.geometry)&&r.geometry.spatialReference)return void(e.spatialReference=r.geometry.spatialReference.toJSON())}}clone(){return new Gj(this.cloneProperties())}cloneProperties(){return ae({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(t){const e=this.write();if(e.features&&Array.isArray(t)&&t.length>0)for(let i=0;i<e.features.length;i++){const r=e.features[i];if(r.geometry){const s=t&&t[i];r.geometry=s&&s.toJSON()||r.geometry}}return e}quantize(t){const{scale:[e,i],translate:[r,s]}=t,n=c=>Math.round((c-r)/e),o=c=>Math.round((s-c)/i),a=this.features,l=this._getQuantizationFunction(this.geometryType,n,o);for(let c=0,h=a.length;c<h;c++)l!=null&&l(a[c].geometry)||(a.splice(c,1),c--,h--);return this.transform=t,this}unquantize(){const{geometryType:t,features:e,transform:i}=this;if(!i)return this;const{translate:[r,s],scale:[n,o]}=i,a=h=>h*n+r,l=h=>s-h*o,c=this._getHydrationFunction(t,a,l);for(const{geometry:h}of e)v(h)&&c&&c(h);return this.transform=null,this}_quantizePoints(t,e,i){let r,s;const n=[];for(let o=0,a=t.length;o<a;o++){const l=t[o];if(o>0){const c=e(l[0]),h=i(l[1]);c===r&&h===s||(n.push([c-r,h-s]),r=c,s=h)}else r=e(l[0]),s=i(l[1]),n.push([r,s])}return n.length>0?n:null}_getQuantizationFunction(t,e,i){return t==="point"?r=>(r.x=e(r.x),r.y=i(r.y),r):t==="polyline"||t==="polygon"?r=>{const s=$v(r)?r.rings:r.paths,n=[];for(let o=0,a=s.length;o<a;o++){const l=s[o],c=this._quantizePoints(l,e,i);c&&n.push(c)}return n.length>0?($v(r)?r.rings=n:r.paths=n,r):null}:t==="multipoint"?r=>{const s=this._quantizePoints(r.points,e,i);return s&&s.length>0?(r.points=s,r):null}:t==="extent"?r=>r:null}_getHydrationFunction(t,e,i){return t==="point"?r=>{r.x=e(r.x),r.y=i(r.y)}:t==="polyline"||t==="polygon"?r=>{const s=$v(r)?r.rings:r.paths;let n,o;for(let a=0,l=s.length;a<l;a++){const c=s[a];for(let h=0,p=c.length;h<p;h++){const f=c[h];h>0?(n+=f[0],o+=f[1]):(n=f[0],o=f[1]),f[0]=e(n),f[1]=i(o)}}}:t==="extent"?r=>{r.xmin=e(r.xmin),r.ymin=i(r.ymin),r.xmax=e(r.xmax),r.ymax=i(r.ymax)}:t==="multipoint"?r=>{const s=r.points;let n,o;for(let a=0,l=s.length;a<l;a++){const c=s[a];a>0?(n+=c[0],o+=c[1]):(n=c[0],o=c[1]),c[0]=e(n),c[1]=i(o)}}:null}};u([d({type:String,json:{write:!0}})],Qo.prototype,"displayFieldName",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Qo.prototype,"exceededTransferLimit",void 0),u([d({type:[ha],json:{write:!0}})],Qo.prototype,"features",void 0),u([Qe("features")],Qo.prototype,"readFeatures",null),u([d({type:[UU],json:{write:!0}})],Qo.prototype,"fields",void 0),u([d({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:jj.read}}})],Qo.prototype,"geometryType",void 0),u([lt("geometryType")],Qo.prototype,"writeGeometryType",null),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Qo.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Qo.prototype,"hasZ",void 0),u([d({types:nT,json:{write:!0}})],Qo.prototype,"queryGeometry",void 0),u([Qe("queryGeometry")],Qo.prototype,"readQueryGeometry",null),u([d({type:mt,json:{write:!0}})],Qo.prototype,"spatialReference",void 0),u([lt("spatialReference")],Qo.prototype,"writeSpatialReference",null),u([d({json:{write:!0}})],Qo.prototype,"transform",void 0),Qo=Gj=u([I("esri.rest.support.FeatureSet")],Qo),Qo.prototype.toJSON.isDefaultToJSON=!0;const XJ=Qo,Ase={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},Kje={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function Qje(t,e){const i=new Date(t,e+1,1);return i.setDate(0),i.getDate()}function lx(t,e,i){const r=new Date(t.getTime());if(e&&i){const s=Kje[i],{getter:n,setter:o,multiplier:a}=s;if(i==="months"){const l=Qje(r.getFullYear(),r.getMonth()+e);r.getDate()>l&&r.setDate(l)}r[o](r[n]()+e*a)}return r}function Ose(t,e){switch(e){case"milliseconds":return new Date(t.getTime());case"seconds":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds());case"minutes":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes());case"hours":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours());case"days":return new Date(t.getFullYear(),t.getMonth(),t.getDate());case"weeks":return new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay());case"months":return new Date(t.getFullYear(),t.getMonth(),1);case"years":return new Date(t.getFullYear(),0,1);case"decades":return new Date(t.getFullYear()-t.getFullYear()%10,0,1);case"centuries":return new Date(t.getFullYear()-t.getFullYear()%100,0,1);default:return new Date}}function eHe(t,e,i){return t===0?0:t*Ase[e]/Ase[i]}var Jd;let Ru=Jd=class extends Ie{static get allTime(){return Rse}static get empty(){return tHe}constructor(t){super(t),this.end=null,this.start=null}readEnd(t,e){return e.end!=null?new Date(e.end):null}writeEnd(t,e){e.end=t?t.getTime():null}get isAllTime(){return this.equals(Jd.allTime)}get isEmpty(){return this.equals(Jd.empty)}readStart(t,e){return e.start!=null?new Date(e.start):null}writeStart(t,e){e.start=t?t.getTime():null}clone(){return new Jd({end:this.end,start:this.start})}equals(t){if(!t)return!1;const e=v(this.start)?this.start.getTime():this.start,i=v(this.end)?this.end.getTime():this.end,r=v(t.start)?t.start.getTime():t.start,s=v(t.end)?t.end.getTime():t.end;return e===r&&i===s}expandTo(t){if(this.isEmpty||this.isAllTime)return this.clone();const e=go(this.start,r=>Ose(r,t)),i=go(this.end,r=>{const s=Ose(r,t);return r.getTime()===s.getTime()?s:lx(s,1,t)});return new Jd({start:e,end:i})}intersection(t){if(!t)return this.clone();if(this.isEmpty||t.isEmpty)return Jd.empty;if(this.isAllTime)return t.clone();if(t.isAllTime)return this.clone();const e=Vu(this.start,-1/0,a=>a.getTime()),i=Vu(this.end,1/0,a=>a.getTime()),r=Vu(t.start,-1/0,a=>a.getTime()),s=Vu(t.end,1/0,a=>a.getTime());let n,o;if(r>=e&&r<=i?n=r:e>=r&&e<=s&&(n=e),i>=r&&i<=s?o=i:s>=e&&s<=i&&(o=s),n!=null&&o!=null&&!isNaN(n)&&!isNaN(o)){const a=new Jd;return a.start=n===-1/0?null:new Date(n),a.end=o===1/0?null:new Date(o),a}return Jd.empty}offset(t,e){if(this.isEmpty||this.isAllTime)return this.clone();const i=new Jd,{start:r,end:s}=this;return v(r)&&(i.start=lx(r,t,e)),v(s)&&(i.end=lx(s,t,e)),i}union(t){if(!t||t.isEmpty)return this.clone();if(this.isEmpty)return t.clone();if(this.isAllTime||t.isAllTime)return Rse.clone();const e=v(this.start)&&v(t.start)?new Date(Math.min(this.start.getTime(),t.start.getTime())):null,i=v(this.end)&&v(t.end)?new Date(Math.max(this.end.getTime(),t.end.getTime())):null;return new Jd({start:e,end:i})}};u([d({type:Date,json:{write:{allowNull:!0}}})],Ru.prototype,"end",void 0),u([Qe("end")],Ru.prototype,"readEnd",null),u([lt("end")],Ru.prototype,"writeEnd",null),u([d({readOnly:!0,json:{read:!1}})],Ru.prototype,"isAllTime",null),u([d({readOnly:!0,json:{read:!1}})],Ru.prototype,"isEmpty",null),u([d({type:Date,json:{write:{allowNull:!0}}})],Ru.prototype,"start",void 0),u([Qe("start")],Ru.prototype,"readStart",null),u([lt("start")],Ru.prototype,"writeStart",null),Ru=Jd=u([I("esri.TimeExtent")],Ru);const Rse=new Ru,tHe=new Ru({start:void 0,end:void 0}),ig=Ru;let Ub=class extends Cs(Ie){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};u([d({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:v(this.onFields)&&this.onFields.length>0}}}}})],Ub.prototype,"onFields",void 0),u([d({type:String,json:{write:!0}})],Ub.prototype,"operator",void 0),u([d({type:String,json:{write:!0}})],Ub.prototype,"searchTerm",void 0),u([d({type:String,json:{write:!0}})],Ub.prototype,"searchType",void 0),Ub=u([I("esri.rest.support.FullTextSearch")],Ub);const iHe=Ub;var Hj;const Mse=new Gi({upperLeft:"upper-left",lowerLeft:"lower-left"});let Vb=Hj=class extends Ie{constructor(t){super(t),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new Hj(ae({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};u([d({type:Pi,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],Vb.prototype,"extent",void 0),u([d({type:["view","edit"],json:{write:!0}})],Vb.prototype,"mode",void 0),u([d({type:String,json:{read:Mse.read,write:Mse.write}})],Vb.prototype,"originPosition",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],Vb.prototype,"tolerance",void 0),Vb=Hj=u([I("esri.rest.support.QuantizationParameters")],Vb);const Nbe=Vb;var qj;const Pse=new Gi({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let Kd=qj=class extends Ie{constructor(t){super(t),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(t,e){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(e.statisticParameters=ae(t))}clone(){return new qj({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:ae(this.statisticParameters)})}};u([d({type:Number,json:{write:!0}})],Kd.prototype,"maxPointCount",void 0),u([d({type:Number,json:{write:!0}})],Kd.prototype,"maxRecordCount",void 0),u([d({type:Number,json:{write:!0}})],Kd.prototype,"maxVertexCount",void 0),u([d({type:String,json:{write:!0}})],Kd.prototype,"onStatisticField",void 0),u([d({type:String,json:{write:!0}})],Kd.prototype,"outStatisticFieldName",void 0),u([d({type:String,json:{read:{source:"statisticType",reader:Pse.read},write:{target:"statisticType",writer:Pse.write}}})],Kd.prototype,"statisticType",void 0),u([d({type:Object})],Kd.prototype,"statisticParameters",void 0),u([lt("statisticParameters")],Kd.prototype,"writeStatisticParameters",null),Kd=qj=u([I("esri.rest.support.StatisticDefinition")],Kd);const Fbe=Kd;var wE;const rHe=new Gi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),sHe=new Gi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let ei=wE=class extends Ie{static from(t){return XE(wE,t)}constructor(t){super(t),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(t){return typeof t=="number"||typeof t=="object"?t:null}writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeParameterValues(t,e){if(t){const i={};for(const r in t){const s=t[r];Array.isArray(s)?i[r]=s.map(n=>n instanceof Date?n.getTime():n):s instanceof Date?i[r]=s.getTime():i[r]=s}e.parameterValues=i}}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,e.where="1=1"}writeWhere(t,e){e.where=t||"1=1"}clone(){return new wE(ae({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:v(this.historicMoment)?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};ei.MAX_MAX_RECORD_COUNT_FACTOR=5,u([d({json:{write:!0}})],ei.prototype,"aggregateIds",void 0),u([d({type:Boolean,json:{write:!0}})],ei.prototype,"cacheHint",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],ei.prototype,"compactGeometryEnabled",void 0),u([d({json:{write:!0}})],ei.prototype,"datumTransformation",void 0),u([wi("datumTransformation")],ei.prototype,"castDatumTransformation",null),u([d({type:Boolean,json:{default:!1,write:!0}})],ei.prototype,"defaultSpatialReferenceEnabled",void 0),u([d({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],ei.prototype,"distance",void 0),u([d({type:_p,json:{write:!0}})],ei.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],ei.prototype,"formatOf3DObjects",void 0),u([d({type:[iHe],json:{write:{enabled:!0,overridePolicy(){return{enabled:v(this.fullText)&&this.fullText.length>0}}}}})],ei.prototype,"fullText",void 0),u([d({type:String,json:{write:!0}})],ei.prototype,"gdbVersion",void 0),u([d({types:nT,json:{read:Gy,write:!0}})],ei.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],ei.prototype,"geometryPrecision",void 0),u([d({type:[String],json:{write:!0}})],ei.prototype,"groupByFieldsForStatistics",void 0),u([d({type:String,json:{write:!0}})],ei.prototype,"having",void 0),u([d({type:Date})],ei.prototype,"historicMoment",void 0),u([lt("historicMoment")],ei.prototype,"writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],ei.prototype,"maxAllowableOffset",void 0),u([d({type:Number,cast:t=>t<1?1:t>wE.MAX_MAX_RECORD_COUNT_FACTOR?wE.MAX_MAX_RECORD_COUNT_FACTOR:t,json:{write:{overridePolicy:t=>({enabled:t>1})}}})],ei.prototype,"maxRecordCountFactor",void 0),u([d({type:["xyFootprint"],json:{write:!0}})],ei.prototype,"multipatchOption",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],ei.prototype,"num",void 0),u([d({json:{write:!0}})],ei.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],ei.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],ei.prototype,"outFields",void 0),u([d({type:mt,json:{name:"outSR",write:!0}})],ei.prototype,"outSpatialReference",void 0),u([d({type:[Fbe],json:{write:{enabled:!0,overridePolicy(){return{enabled:v(this.outStatistics)&&this.outStatistics.length>0}}}}})],ei.prototype,"outStatistics",void 0),u([d({json:{write:!0}})],ei.prototype,"parameterValues",void 0),u([lt("parameterValues")],ei.prototype,"writeParameterValues",null),u([d({type:pt,json:{write:!0}})],ei.prototype,"pixelSize",void 0),u([d({type:Nbe,json:{write:!0}})],ei.prototype,"quantizationParameters",void 0),u([d({type:[Object],json:{write:!0}})],ei.prototype,"rangeValues",void 0),u([d({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],ei.prototype,"relationParameter",void 0),u([d({type:String,json:{write:!0}})],ei.prototype,"resultType",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],ei.prototype,"returnCentroid",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],ei.prototype,"returnDistinctValues",void 0),u([d({type:Boolean,json:{default:!0,write:!0}})],ei.prototype,"returnExceededLimitFeatures",void 0),u([d({type:Boolean,json:{write:!0}})],ei.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],ei.prototype,"returnQueryGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],ei.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],ei.prototype,"returnZ",void 0),u([d({type:mt,json:{write:!0}})],ei.prototype,"sourceSpatialReference",void 0),u([At(rHe,{ignoreUnknown:!1,name:"spatialRel"})],ei.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],ei.prototype,"start",void 0),u([lt("start"),lt("num")],ei.prototype,"writeStart",null),u([d({type:String,json:{write:!0}})],ei.prototype,"sqlFormat",void 0),u([d({type:String,json:{write:!0}})],ei.prototype,"text",void 0),u([d({type:ig,json:{write:!0}})],ei.prototype,"timeExtent",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],ei.prototype,"timeReferenceUnknownClient",void 0),u([At(sHe,{ignoreUnknown:!1}),d({json:{write:{overridePolicy(t){return{enabled:!!t&&this.distance!=null&&this.distance>0}}}}})],ei.prototype,"units",void 0),u([d({type:String,json:{write:{overridePolicy(t){return{enabled:t!=null||this.start!=null&&this.start>0}}}}})],ei.prototype,"where",void 0),u([lt("where")],ei.prototype,"writeWhere",null),ei=wE=u([I("esri.rest.support.Query")],ei);const Mm=ei;async function lk(t,e,i){const r=await nHe(t,e,i);return XJ.fromJSON(r)}async function nHe(t,e,i){const r=WJ(t),s={...i},n=Mm.from(e),{data:o}=await Zje(r,n,n.sourceSpatialReference,s);return o}function La(t,e){return t?e?4:3:e?3:2}const aA=oe.getLogger("esri.layers.graphics.featureConversionUtils"),Ube={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},oHe=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n},Ise=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+2]},aHe=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+3]},lHe=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+2],t[i+3]=e[r+3]};function YJ(t,e,i,r){if(t){if(i)return e&&r?lHe:Ise;if(e&&r)return aHe}else if(e&&r)return Ise;return oHe}function ck({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function uk({scale:t,translate:e},i){return Math.round((e[1]-i)/t[1])}function hk({scale:t,translate:e},i,r){return i*t[r]+e[r]}function IPt(t,e,i){return t?e?i?KJ(t):ZJ(t):i?JJ(t):VU(t):null}function VU(t){const e=t.coords;return{x:e[0],y:e[1]}}function Vbe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function ZJ(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function cHe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function JJ(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function uHe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function KJ(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function hHe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function dHe(t,e,i,r){let s=VU;i&&r?s=KJ:i?s=ZJ:r&&(s=JJ);for(const n of e){const{geometry:o,attributes:a}=n,l=v(o)?s(o):null;t.push({attributes:a,geometry:l})}return t}function QJ(t,e){return t&&e?hHe:t?cHe:e?uHe:Vbe}function kbe(t,e,i,r,s){const n=QJ(i,r);for(const{geometry:o,attributes:a}of e){const l=v(o)?n(new Qp,o):null;t.push(new e1(l,a,null,s?a[s]:void 0))}return t}function $Pt(t,e,i=QJ(e.z!=null,e.m!=null)){return i(t,e)}function pHe(t,e,i,r){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:v(s)?Bbe(s,i,r):null});return t}function Bbe(t,e,i){if(C(t))return null;const r=La(e,i),s=[];for(let n=0;n<t.coords.length;n+=r){const o=[];for(let a=0;a<r;a++)o.push(t.coords[n+a]);s.push(o)}return e?i?{points:s,hasZ:e,hasM:i}:{points:s,hasZ:e}:i?{points:s,hasM:i}:{points:s}}function zbe(t,e,i,r,s){const n=La(i,r);for(const{geometry:o,attributes:a}of e){const l=v(o)?Gbe(new Qp,o,n):null;t.push(new e1(l,a,null,s?a[s]:void 0))}return t}function Gbe(t,e,i=La(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const r=t.coords;let s=0;for(const n of e.points)for(let o=0;o<i;o++)r[s++]=n[o];return t}function fHe(t,e,i,r){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:v(s)?jbe(s,i,r):null});return t}function jbe(t,e,i){if(!t)return null;const r=La(e,i),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const p=[];for(let f=0;f<r;f++)p.push(s[a++]);c.push(p)}o.push(c)}return e?i?{paths:o,hasZ:e,hasM:i}:{paths:o,hasZ:e}:i?{paths:o,hasM:i}:{paths:o}}function Hbe(t,e,i,r,s){const n=La(i,r);for(const{geometry:o,attributes:a}of e){const l=v(o)?qbe(new Qp,o,n):null;t.push(new e1(l,a,null,s?a[s]:void 0))}return t}function qbe(t,e,i=La(e.hasZ,e.hasM)){const{lengths:r,coords:s}=t;let n=0;for(const o of e.paths){for(const a of o)for(let l=0;l<i;l++)s[n++]=a[l];r.push(o.length)}return t}function mHe(t,e,i,r){for(const{geometry:s,attributes:n,centroid:o}of e){const a=v(s)?Wbe(s,i,r):null;if(v(o)){const l=VU(o);t.push({attributes:n,centroid:l,geometry:a})}else t.push({attributes:n,geometry:a})}return t}function Wbe(t,e,i){if(!t)return null;const r=La(e,i),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const p=[];for(let f=0;f<r;f++)p.push(s[a++]);c.push(p)}o.push(c)}return e?i?{rings:o,hasZ:e,hasM:i}:{rings:o,hasZ:e}:i?{rings:o,hasM:i}:{rings:o}}function Xbe(t,e,i,r,s){for(const{geometry:n,centroid:o,attributes:a}of e){const l=v(n)?Ybe(new Qp,n,i,r):null,c=s?a[s]:void 0;v(o)?t.push(new e1(l,a,Vbe(new Qp,o),c)):t.push(new e1(l,a,null,c))}return t}function Ybe(t,e,i=e.hasZ,r=e.hasM){return gHe(t,e.rings,i,r),t}function gHe(t,e,i,r){const s=La(i,r),{lengths:n,coords:o}=t;let a=0;Ay(t);for(const l of e){for(const c of l)for(let h=0;h<s;h++)o[a++]=c[h];n.push(l.length)}return t}const xE=[],zM=[];function LPt(t,e,i,r,s){xE[0]=t;const[n]=Zbe(zM,xE,e,i,r,s);return ef(xE),ef(zM),n}function Zbe(t,e,i,r,s,n){if(ef(t),!i){for(const o of e){const a=n?o.attributes[n]:void 0;t.push(new e1(null,o.attributes,null,a))}return t}switch(i){case"esriGeometryPoint":return kbe(t,e,r,s,n);case"esriGeometryMultipoint":return zbe(t,e,r,s,n);case"esriGeometryPolyline":return Hbe(t,e,r,s,n);case"esriGeometryPolygon":return Xbe(t,e,r,s,n);default:aA.error("convertToFeatureSet:unknown-geometry",new W(`Unable to parse unknown geometry type '${i}'`)),ef(t)}return t}function DPt(t,e,i,r,s,n){const o=t.length;switch(i){case"esriGeometryPoint":kbe(t,e,r,s,n);break;case"esriGeometryMultipoint":zbe(t,e,r,s,n);break;case"esriGeometryPolyline":Hbe(t,e,r,s,n);break;case"esriGeometryPolygon":Xbe(t,e,r,s,n);break;default:aA.error("convertToFeatureSet:unknown-geometry",new W(`Unable to parse unknown geometry type '${i}'`))}for(let a=0;a<e.length;a++)t[a+o].geometryType=i,t[a+o].insertAfter=e[a].insertAfter,t[a+o].groupId=e[a].groupId;return t}function NPt(t,e,i,r){zM[0]=t,Jbe(xE,zM,e,i,r);const s=xE[0];return ef(xE),ef(zM),s}function yHe(t,e,i){if(C(t))return null;const r=new Qp;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&i==null&&(i=t.hasM),q6(t)?QJ(e??t.z!=null,i??t.m!=null)(r,t):$v(t)?Ybe(r,t,e,i):W6(t)?qbe(r,t,La(e,i)):H6(t)?Gbe(r,t,La(e,i)):void aA.error("convertFromGeometry:unknown-geometry",new W(`Unable to parse unknown geometry type '${t}'`))}function _He(t,e,i,r){const s=t&&("coords"in t?t:t.geometry);if(C(s))return null;switch(e){case"esriGeometryPoint":{let n=VU;return i&&r?n=KJ:i?n=ZJ:r&&(n=JJ),n(s)}case"esriGeometryMultipoint":return Bbe(s,i,r);case"esriGeometryPolyline":return jbe(s,i,r);case"esriGeometryPolygon":return Wbe(s,i,r);default:return aA.error("convertToGeometry:unknown-geometry",new W(`Unable to parse unknown geometry type '${e}'`)),null}}function vHe(t,e){for(const i of e)t.push({attributes:i.attributes});return t}function Jbe(t,e,i,r,s){if(ef(t),C(i))return vHe(t,e);switch(i){case"esriGeometryPoint":return dHe(t,e,r,s);case"esriGeometryMultipoint":return pHe(t,e,r,s);case"esriGeometryPolyline":return fHe(t,e,r,s);case"esriGeometryPolygon":return mHe(t,e,r,s);default:aA.error("convertToFeatureSet:unknown-geometry",new W(`Unable to parse unknown geometry type '${i}'`))}return t}function FPt(t){const{objectIdFieldName:e,spatialReference:i,transform:r,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:h,queryGeometry:p,queryGeometryType:f}=t,m={features:Jbe([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:e,spatialReference:i,uniqueIdField:h,queryGeometry:_He(p,f,!1,!1)};return r&&(m.transform=r),c&&(m.exceededTransferLimit=c),n&&(m.hasM=n),o&&(m.hasZ=o),m}function UPt(t,e){const i=new $be,{hasM:r,hasZ:s,features:n,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:h,fields:p}=t;return p&&(i.fields=p),i.geometryType=l??null,i.objectIdFieldName=o??e??null,i.spatialReference=a??null,i.objectIdFieldName?(n&&Zbe(i.features,n,l,s,r,i.objectIdFieldName),c&&(i.exceededTransferLimit=c),r&&(i.hasM=r),s&&(i.hasZ=s),h&&(i.transform=h),i):(aA.error(new W("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function VPt(t){const{transform:e,features:i,hasM:r,hasZ:s}=t;if(!e)return t;for(const n of i)v(n.geometry)&&Lse(n.geometry,n.geometry,r,s,e),v(n.centroid)&&Lse(n.centroid,n.centroid,r,s,e);return t.transform=null,t}function kPt(t,e){const{geometryType:i,features:r,hasM:s,hasZ:n}=e;if(!t)return e;for(let o=0;o<r.length;o++){const a=r[o],l=a.weakClone();l.geometry=new Qp,$se(l.geometry,a.geometry,s,n,i,t),a.centroid&&(l.centroid=new Qp,$se(l.centroid,a.centroid,s,n,"esriGeometryPoint",t)),r[o]=l}return e.transform=t,e}function $se(t,e,i,r,s,n,o=i,a=r){if(Ay(t),C(e)||!e.coords.length)return null;const l=Ube[s],{coords:c,lengths:h}=e,p=La(i,r),f=La(i&&o,r&&a),m=YJ(i,r,o,a);if(!h.length)return m(t.coords,c,0,0,ck(n,c[0]),uk(n,c[1])),Ay(t,p,0),t;let y,_,b,w,S=0,T=0,E=T;for(const O of h){if(O<l)continue;let R=0;T=E,b=y=ck(n,c[S]),w=_=uk(n,c[S+1]),m(t.coords,c,T,S,b,w),R++,S+=p,T+=f;for(let L=1;L<O;L++,S+=p)b=ck(n,c[S]),w=uk(n,c[S+1]),b===y&&w===_||(m(t.coords,c,T,S,b-y,w-_),T+=f,R++,y=b,_=w);R>=l&&(t.lengths.push(R),E=T)}return ef(t.coords,E),t.coords.length?t:null}function BPt(t,e,i,r,s,n,o=i,a=r){if(Ay(t),!e||!e.coords.length)return null;const l=Ube[s],{coords:c,lengths:h}=e,p=La(i,r),f=La(i&&o,r&&a),m=YJ(i,r,o,a);if(!h.length)return m(t.coords,c,0,0,c[0],c[1]),Ay(t,p,0),t;let y=0;const _=n*n;for(const b of h){if(b<l){y+=b*p;continue}const w=t.coords.length/f,S=y,T=y+(b-1)*p;m(t.coords,c,t.coords.length,S,c[S],c[S+1]),Wj(t.coords,c,p,_,m,S,T),m(t.coords,c,t.coords.length,T,c[T],c[T+1]);const E=t.coords.length/f-w;E>=l?t.lengths.push(E):ef(t.coords,w*f),y+=b*p}return t.coords.length?t:null}function bHe(t,e,i,r){const s=t[e],n=t[e+1],o=t[i],a=t[i+1],l=t[r],c=t[r+1];let h=o,p=a,f=l-h,m=c-p;if(f!==0||m!==0){const y=((s-h)*f+(n-p)*m)/(f*f+m*m);y>1?(h=l,p=c):y>0&&(h+=f*y,p+=m*y)}return f=s-h,m=n-p,f*f+m*m}function Wj(t,e,i,r,s,n,o){let a,l=r,c=0;for(let h=n+i;h<o;h+=i)a=bHe(e,h,n,o),a>l&&(c=h,l=a);l>r&&(c-n>i&&Wj(t,e,i,r,s,n,c),s(t,e,t.length,c,e[c],e[c+1]),o-c>i&&Wj(t,e,i,r,s,c,o))}function zPt(t,e,i,r){if(C(e)||!e.coords||!e.coords.length)return null;const s=La(i,r);let n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const c=e.coords;for(let h=0;h<c.length;h+=s){const p=c[h],f=c[h+1];n=Math.min(n,p),a=Math.max(a,p),o=Math.min(o,f),l=Math.max(l,f)}}return cG(t)?T6e(t,n,o,a,l):OZ(n,o,a,l,t),t}function Lse(t,e,i,r,s){const{coords:n,lengths:o}=e,a=La(i,r);if(!n.length)return t!==e&&Ay(t),t;$6(s);const{originPosition:l,scale:c,translate:h}=s,p=xHe;p.originPosition=l;const f=p.scale;f[0]=c[0]??1,f[1]=-(c[1]??1),f[2]=c[2]??1,f[3]=c[3]??1;const m=p.translate;if(m[0]=h[0]??0,m[1]=h[1]??0,m[2]=h[2]??0,m[3]=h[3]??0,!o.length){for(let _=0;_<a;++_)t.coords[_]=hk(p,n[_],_);return t!==e&&Ay(t,a,0),t}let y=0;for(let _=0;_<o.length;_++){const b=o[_];t.lengths[_]=b;for(let T=0;T<a;++T)t.coords[y+T]=hk(p,n[y+T],T);let w=t.coords[y],S=t.coords[y+1];y+=a;for(let T=1;T<b;T++,y+=a){w+=n[y]*f[0],S+=n[y+1]*f[1],t.coords[y]=w,t.coords[y+1]=S;for(let E=2;E<a;++E)t.coords[y+E]=hk(p,n[y+E],E)}}return t!==e&&Ay(t,n.length,o.length),t}function GPt(t,e,i,r,s,n){if(Ay(t),t.lengths.push(...e.lengths),i===s&&r===n)for(let o=0;o<e.coords.length;o++)t.coords.push(e.coords[o]);else{const o=La(i,r),a=YJ(i,r,s,n),l=e.coords;for(let c=0;c<l.length;c+=o)a(t.coords,l,t.coords.length,c,l[c],l[c+1])}return t}function wHe(t,e,i,r){let s=0,n=t[r*e],o=t[r*(e+1)];for(let a=1;a<i;a++){const l=n+t[r*(e+a)],c=o+t[r*(e+a)+1],h=(l-n)*(c+o);n=l,o=c,s+=h}return .5*s}function jPt(t,e){const{coords:i,lengths:r}=t;let s=0,n=0;for(let o=0;o<r.length;o++){const a=r[o];n+=wHe(i,s,a,e),s+=a}return Math.abs(n)}function HPt(t,e){if(C(t))return null;const i=t.clone(),r=t.coords,s=t.lengths;let n=0;for(let o=0;o<s.length;o++){const a=s[o];let l=r[e*n],c=r[e*n+1];for(let h=1;h<a;h++){const p=l+r[e*(n+h)],f=c+r[e*(n+h)+1];i.coords[e*(n+h)]=p,i.coords[e*(n+h)+1]=f,l=p,c=f}n+=a}return i}function Ay(t,e=0,i=0){ef(t.lengths,i),ef(t.coords,e)}function ef(t,e=0){t.length!==e&&(t.length=e)}const xHe={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]};var Xj;let sn=Xj=class extends Ie{constructor(t){super(t),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(e.definitionExpression="1=1")}clone(){return new Xj(ae({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};u([d({type:Boolean,json:{write:!0}})],sn.prototype,"cacheHint",void 0),u([d({type:_p,json:{write:!0}})],sn.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],sn.prototype,"gdbVersion",void 0),u([d({type:Number,json:{write:!0}})],sn.prototype,"geometryPrecision",void 0),u([d({type:Date})],sn.prototype,"historicMoment",void 0),u([lt("historicMoment")],sn.prototype,"_writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],sn.prototype,"maxAllowableOffset",void 0),u([d({type:[Number],json:{write:!0}})],sn.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],sn.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],sn.prototype,"outFields",void 0),u([d({type:mt,json:{read:{source:"outSR"},write:{target:"outSR"}}})],sn.prototype,"outSpatialReference",void 0),u([d({json:{write:!0}})],sn.prototype,"relationshipId",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],sn.prototype,"start",void 0),u([lt("start"),lt("num")],sn.prototype,"writeStart",null),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],sn.prototype,"num",void 0),u([d({json:{write:!0}})],sn.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],sn.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],sn.prototype,"returnZ",void 0),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],sn.prototype,"where",void 0),sn=Xj=u([I("esri.rest.support.RelationshipQuery")],sn),sn.from=mn(sn);const yC=sn,qPt=Object.freeze(Object.defineProperty({__proto__:null,default:yC},Symbol.toStringTag,{value:"Module"}));var Yj;let eS=Yj=class extends Ie{constructor(t){super(t),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new Yj({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};u([d({type:[String],json:{write:!0}})],eS.prototype,"groupByFields",void 0),u([d({type:Number,json:{write:!0}})],eS.prototype,"topCount",void 0),u([d({type:[String],json:{write:!0}})],eS.prototype,"orderByFields",void 0),eS=Yj=u([I("esri.rest.support.TopFilter")],eS);const THe=eS;var Zj;const Dse=new Gi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),Nse=new Gi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let $s=Zj=class extends Ie{constructor(t){super(t),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new Zj(ae({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};u([d({type:Boolean,json:{write:!0}})],$s.prototype,"cacheHint",void 0),u([d({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],$s.prototype,"distance",void 0),u([d({types:nT,json:{read:Gy,write:!0}})],$s.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],$s.prototype,"geometryPrecision",void 0),u([d({type:Number,json:{write:!0}})],$s.prototype,"maxAllowableOffset",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],$s.prototype,"num",void 0),u([d({json:{write:!0}})],$s.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],$s.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],$s.prototype,"outFields",void 0),u([d({type:mt,json:{read:{source:"outSR"},write:{target:"outSR"}}})],$s.prototype,"outSpatialReference",void 0),u([d({type:String,json:{write:!0}})],$s.prototype,"resultType",void 0),u([d({json:{write:!0}})],$s.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],$s.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],$s.prototype,"returnZ",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],$s.prototype,"start",void 0),u([lt("start"),lt("num")],$s.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"spatialRel",reader:Dse.read},write:{target:"spatialRel",writer:Dse.write}}})],$s.prototype,"spatialRelationship",void 0),u([d({type:ig,json:{write:!0}})],$s.prototype,"timeExtent",void 0),u([d({type:THe,json:{write:!0}})],$s.prototype,"topFilter",void 0),u([d({type:String,json:{read:Nse.read,write:{writer:Nse.write,overridePolicy(t){return{enabled:v(t)&&v(this.distance)&&this.distance>0}}}}})],$s.prototype,"units",void 0),u([d({type:String,json:{write:!0}})],$s.prototype,"where",void 0),$s=Zj=u([I("esri.rest.support.TopFeaturesQuery")],$s),$s.from=mn($s);const A$=$s,SHe="esri.widgets.Feature.support.relatedFeatureUtils",Fse=oe.getLogger(SHe),Use=new Map;function UN(t){if(!by(t))return null;const[e,i]=t.split("/").slice(1);return{layerId:e,fieldName:i}}function EHe(t,e){if(!e.relationships)return null;let i=null;const{relationships:r}=e;return r.some(s=>s.id===parseInt(t,10)&&(i=s,!0)),i}function CHe({originRelationship:t,relationships:e,layerId:i}){let r=null;return e&&e.some(s=>(`${s.relatedTableId}`===i&&s.id===(t==null?void 0:t.id)&&(r=s),!!r)),r}function AHe(t,e){const i=e.toLowerCase();for(const r in t)if(r.toLowerCase()===i)return t[r];return null}function OHe(t,e){const i=EHe(t,e);if(i)return{url:`${e.url}/${i.relatedTableId}`,sourceSpatialReference:e.spatialReference,relation:i,relatedFields:[],outStatistics:[]}}function RHe(t,e){if(!e||!t)return;const{features:i,statsFeatures:r}=t,s=i&&i.value;e.relatedFeatures=s?s.features:[];const n=r&&r.value;e.relatedStatsFeatures=n?n.features:[]}function MHe(t,e,i,r){var n;const s=new yC;return s.outFields=["*"],s.relationshipId=typeof e.id=="number"?e.id:parseInt(e.id,10),s.objectIds=[t.attributes[i.objectIdField]],((n=i.queryRelatedFeatures)==null?void 0:n.call(i,s,r))??Promise.resolve({})}function PHe(t,e,i){let r=0;const s=[];for(;r<e.length;)s.push(`${t} IN (${e.slice(r,i+r)})`),r+=i;return s.join(" OR ")}async function IHe(t,e,i,r){const s=i.layerId.toString(),{layerInfo:n,relation:o,relatedFields:a,outStatistics:l,url:c,sourceSpatialReference:h}=e;if(!n||!o)return null;const p=CHe({originRelationship:o,relationships:n.relationships,layerId:s});if(p!=null&&p.relationshipTableId&&p.keyFieldInRelationshipTable){const m=(await MHe(t,p,i,r))[t.attributes[i.objectIdField]];if(!m)return null;const y=m.features.map(_=>_.attributes[n.objectIdField]);if(l!=null&&l.length&&n.supportsStatistics){const _=new Mm;_.where=PHe(n.objectIdField,y,1e3),_.outFields=a,_.outStatistics=l,_.sourceSpatialReference=h;const b={features:Promise.resolve(m),statsFeatures:lk(c,_)};return lc(b)}}const f=p==null?void 0:p.keyField;if(f){const m=X6(FHe(n.fields,f)),y=AHe(t.attributes,o.keyField),_=m?`${f}=${y}`:`${f}='${y}'`,b=lk(c,new Mm({where:_,outFields:e.relatedFields,sourceSpatialReference:h}),r),w=e.outStatistics&&e.outStatistics.length>0&&n.supportsStatistics?lk(c,new Mm({where:_,outFields:e.relatedFields,outStatistics:e.outStatistics,sourceSpatialReference:h}),r):null,S={features:b};return w&&(S.statsFeatures=w),lc(S)}return null}function $He(t,e){return zr(t,{query:{f:"json"},signal:e&&e.signal})}function LHe({relatedInfos:t,layer:e},i){const r={};return t.forEach((s,n)=>{const{relation:o}=s;if(!o){const p=new W("relation-required","A relation is required on a layer to retrieve related records.");throw Fse.error(p),p}const{relatedTableId:a}=o;if(typeof a!="number"){const p=new W("A related table ID is required on a layer to retrieve related records.");throw Fse.error(p),p}const l=`${e.url}/${a}`,c=Use.get(l),h=c||$He(l);c||Use.set(l,h),r[n]=h}),FY(lc(r),i)}function DHe({graphic:t,relatedInfos:e,layer:i},r){const s={};return e.forEach((n,o)=>{n.layerInfo&&(s[o]=IHe(t,n,i,r))}),lc(s)}function NHe({relatedInfo:t,fieldName:e,fieldInfo:i}){var r,s;if((r=t.relatedFields)==null||r.push(e),i.statisticType){const n=new Fbe({statisticType:i.statisticType,onStatisticField:e,outStatisticFieldName:e});(s=t.outStatistics)==null||s.push(n)}}function FHe(t,e){if(t!=null){e=e.toLowerCase();for(const i of t)if(i&&i.name.toLowerCase()===e)return i}return null}const Vse={chartAnimation:!0};let Kn=class extends $e{constructor(e){super(e),this.abilities={...Vse},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return{...Vse,...e}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:i}=this,r=(e+i)%i;this.activeMediaInfoIndex=r}_pageContentElementMedia(e){const{activeMediaInfoIndex:i}=this,r=i+e;this._setContentElementMedia(r)}_formatMediaInfos(){const{mediaInfos:e,layer:i}=this,r=this.attributes??{},s=this.formattedAttributes??{},n=this.expressionAttributes??{},o=this.fieldInfoMap??new Map;return(e==null?void 0:e.map(a=>{const l=a==null?void 0:a.clone();if(!l)return null;if(l.title=Ww({attributes:r,fieldInfoMap:o,globalAttributes:s,expressionAttributes:n,layer:i,text:l.title}),l.caption=Ww({attributes:r,fieldInfoMap:o,globalAttributes:s,expressionAttributes:n,layer:i,text:l.caption}),l.altText=Ww({attributes:r,fieldInfoMap:o,globalAttributes:s,expressionAttributes:n,layer:i,text:l.altText}),l.type==="image"){const{value:c}=l;return this._setImageValue({value:c,formattedAttributes:s,layer:i}),l.value.sourceURL?l:void 0}if(l.type==="pie-chart"||l.type==="line-chart"||l.type==="column-chart"||l.type==="bar-chart"){const{value:c}=l;return this._setChartValue({value:c,chartType:l.type,attributes:r,formattedAttributes:s,layer:i,expressionAttributes:n}),l}return null}).filter(v))??[]}_setImageValue(e){const i=this.fieldInfoMap??new Map,{value:r,formattedAttributes:s,layer:n}=e,{linkURL:o,sourceURL:a}=r;if(a){const l=Sj(a,n);r.sourceURL=Tj({formattedAttributes:s,template:l,fieldInfoMap:i})}if(o){const l=Sj(o,n);r.linkURL=Tj({formattedAttributes:s,template:l,fieldInfoMap:i})}}_setChartValue(e){const{value:i,attributes:r,formattedAttributes:s,chartType:n,layer:o,expressionAttributes:a}=e,{popupTemplate:l,relatedInfos:c}=this,{fields:h,normalizeField:p}=i,f=o;if(i.fields=h7e(h,f),p&&(i.normalizeField=Z3(p,f)),!h.some(y=>!!(s[y]!=null||by(y)&&(c!=null&&c.size))))return;const m=(l==null?void 0:l.fieldInfos)??[];h.forEach(y=>{if(by(y))return void(i.series=[...i.series,...this._getRelatedChartInfos({fieldInfos:m,fieldName:y,formattedAttributes:s,chartType:n,value:i})]);const _=this._getChartOption({value:i,attributes:r,chartType:n,formattedAttributes:s,expressionAttributes:a,fieldName:y,fieldInfos:m});i.series.push(_)})}_getRelatedChartInfos(e){var m;const{fieldInfos:i,fieldName:r,formattedAttributes:s,chartType:n,value:o}=e,a=[],l=UN(r),c=l&&((m=this.relatedInfos)==null?void 0:m.get(l.layerId.toString()));if(!c)return a;const{relatedFeatures:h,relation:p}=c;if(!p||!h)return a;const{cardinality:f}=p;return h.forEach(y=>{const{attributes:_}=y;_&&Object.keys(_).forEach(b=>{b===l.fieldName&&a.push(this._getChartOption({value:o,attributes:_,formattedAttributes:s,fieldName:r,chartType:n,relatedFieldName:b,hasMultipleRelatedFeatures:(h==null?void 0:h.length)>1,fieldInfos:i}))})}),f==="one-to-many"||f==="many-to-many"?a:[a[0]]}_getTooltip({label:e,value:i,chartType:r}){return r==="pie-chart"?`${e}`:`${e}: ${i}`}_getChartOption(e){var R;const{value:i,attributes:r,formattedAttributes:s,expressionAttributes:n,fieldName:o,relatedFieldName:a,fieldInfos:l,chartType:c,hasMultipleRelatedFeatures:h}=e,p=this.layer,f=this.fieldInfoMap??new Map,{normalizeField:m,tooltipField:y}=i,_=m?by(m)?r[UN(m).fieldName]:r[m]:null,b=IJ(o)&&n&&n[o]!==void 0?n[o]:a&&r[a]!==void 0?r[a]:r[o]!==void 0?r[o]:s[o],w=new Cye({fieldName:o,value:b===void 0?null:b&&_?b/_:b});if(by(o)){const L=f.get(o.toLowerCase()),P=y&&f.get(y.toLowerCase()),F=(L==null?void 0:L.fieldName)??o,V=h&&y?UN(y).fieldName:(P==null?void 0:P.fieldName)??y,B=h&&V?r[V]:s[V]??(L==null?void 0:L.label)??(L==null?void 0:L.fieldName)??a,G=h&&a?r[a]:s[F];return w.tooltip=this._getTooltip({label:B,value:G,chartType:c}),w}const S=Q1e(l,o),T=Z3(o,p),E=y&&s[y]!==void 0?s[y]:J1e(S||new JP({fieldName:T}),(R=this.popupTemplate)==null?void 0:R.expressionInfos),O=s[T];return w.tooltip=this._getTooltip({label:E,value:O,chartType:c}),w}};u([d()],Kn.prototype,"abilities",void 0),u([wi("abilities")],Kn.prototype,"castAbilities",null),u([d()],Kn.prototype,"activeMediaInfoIndex",void 0),u([d({readOnly:!0})],Kn.prototype,"activeMediaInfo",null),u([d()],Kn.prototype,"attributes",void 0),u([d()],Kn.prototype,"description",void 0),u([d()],Kn.prototype,"fieldInfoMap",void 0),u([d()],Kn.prototype,"formattedAttributes",void 0),u([d()],Kn.prototype,"expressionAttributes",void 0),u([d({readOnly:!0})],Kn.prototype,"formattedMediaInfos",null),u([d()],Kn.prototype,"isAggregate",void 0),u([d()],Kn.prototype,"layer",void 0),u([d({readOnly:!0})],Kn.prototype,"formattedMediaInfoCount",null),u([d()],Kn.prototype,"mediaInfos",void 0),u([d()],Kn.prototype,"popupTemplate",void 0),u([d()],Kn.prototype,"relatedInfos",void 0),u([d()],Kn.prototype,"title",void 0),Kn=u([I("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],Kn);const Yw=Kn;var kse=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],UHe=[].concat(kse.slice(30,39),kse.slice(28,30).reverse()),VHe=[{name:"default",colors:UHe},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}];const Bse="en-us",eK=new Map([["ar",()=>ee(()=>import("./ar-bb1fe5ab.js"),["./ar-bb1fe5ab.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.a)],["bg-bg",()=>ee(()=>import("./bg_BG-184a2bfa.js"),["./bg_BG-184a2bfa.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.b)],["bs-ba",()=>ee(()=>import("./bs_BA-f32cc344.js"),["./bs_BA-f32cc344.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.b)],["ca-es",()=>ee(()=>import("./ca_ES-d17ee95b.js"),["./ca_ES-d17ee95b.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.c)],["cs-cz",()=>ee(()=>import("./cs_CZ-bcd1e782.js"),["./cs_CZ-bcd1e782.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.c)],["da-dk",()=>ee(()=>import("./da_DK-27b1b06e.js"),["./da_DK-27b1b06e.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.d)],["de-de",()=>ee(()=>import("./de_DE-c0a1d8dd.js"),["./de_DE-c0a1d8dd.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.d)],["de-ch",()=>ee(()=>import("./de_CH-be7b4255.js"),["./de_CH-be7b4255.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.d)],["el-gr",()=>ee(()=>import("./el_GR-05fb9ec0.js"),["./el_GR-05fb9ec0.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.e)],["en-us",()=>ee(()=>import("./en_US-170979d8.js"),["./en_US-170979d8.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.e)],["en-ca",()=>ee(()=>import("./en_CA-170979d8.js"),["./en_CA-170979d8.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.e)],["es-es",()=>ee(()=>import("./es_ES-d0b66640.js"),["./es_ES-d0b66640.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.e)],["et-ee",()=>ee(()=>import("./et_EE-56dd74d3.js"),["./et_EE-56dd74d3.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.e)],["fi-fi",()=>ee(()=>import("./fi_FI-91d58cb9.js"),["./fi_FI-91d58cb9.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.f)],["fr-fr",()=>ee(()=>import("./fr_FR-a11503e0.js"),["./fr_FR-a11503e0.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.f)],["he-il",()=>ee(()=>import("./he_IL-90db98c4.js"),["./he_IL-90db98c4.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.h)],["hr-hr",()=>ee(()=>import("./hr_HR-fac8bb29.js"),["./hr_HR-fac8bb29.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.h)],["hu-hu",()=>ee(()=>import("./hu_HU-e8803856.js"),["./hu_HU-e8803856.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.h)],["id-id",()=>ee(()=>import("./id_ID-86e57d06.js"),["./id_ID-86e57d06.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.i)],["it-it",()=>ee(()=>import("./it_IT-2d4485ba.js"),["./it_IT-2d4485ba.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.i)],["ja-jp",()=>ee(()=>import("./ja_JP-77c6c16d.js"),["./ja_JP-77c6c16d.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.j)],["ko-kr",()=>ee(()=>import("./ko_KR-e155b9ab.js"),["./ko_KR-e155b9ab.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.k)],["lt-lt",()=>ee(()=>import("./lt_LT-fde47ae9.js"),["./lt_LT-fde47ae9.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.l)],["lv-lv",()=>ee(()=>import("./lv_LV-359be050.js"),["./lv_LV-359be050.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.l)],["nb-no",()=>ee(()=>import("./nb_NO-30d57c1a.js"),["./nb_NO-30d57c1a.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.n)],["nl-nl",()=>ee(()=>import("./nl_NL-cb904b48.js"),["./nl_NL-cb904b48.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.n)],["pl-pl",()=>ee(()=>import("./pl_PL-58c54c9f.js"),["./pl_PL-58c54c9f.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.p)],["pt-br",()=>ee(()=>import("./pt_BR-d2e10248.js"),["./pt_BR-d2e10248.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.p)],["pt-pt",()=>ee(()=>import("./pt_PT-65a41842.js"),["./pt_PT-65a41842.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.p)],["ro-ro",()=>ee(()=>import("./ro_RO-15e90e9f.js"),["./ro_RO-15e90e9f.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.r)],["ru-ru",()=>ee(()=>import("./ru_RU-a74d21e5.js"),["./ru_RU-a74d21e5.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.r)],["sk-sk",()=>ee(()=>import("./sk_SK-a928dbd1.js"),["./sk_SK-a928dbd1.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.s)],["sl-sl",()=>ee(()=>import("./sl_SL-1a3c3078.js"),["./sl_SL-1a3c3078.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.s)],["sr-rs",()=>ee(()=>import("./sr_RS-0b18b911.js"),["./sr_RS-0b18b911.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.s)],["sv-se",()=>ee(()=>import("./sv_SE-ce7e3f84.js"),["./sv_SE-ce7e3f84.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.s)],["th-th",()=>ee(()=>import("./th_TH-1448f333.js"),["./th_TH-1448f333.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.t)],["tr-tr",()=>ee(()=>import("./tr_TR-dd92f630.js"),["./tr_TR-dd92f630.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.t)],["uk-ua",()=>ee(()=>import("./uk_UA-fe4434ed.js"),["./uk_UA-fe4434ed.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.u)],["vi-vn",()=>ee(()=>import("./vi_VN-41938633.js"),["./vi_VN-41938633.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.v)],["zh-cn",()=>ee(()=>import("./zh_Hans-524a1291.js"),["./zh_Hans-524a1291.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.z)],["zh-hk",()=>ee(()=>import("./zh_Hant-0e1f08e5.js"),["./zh_Hant-0e1f08e5.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.z)],["zh-tw",()=>ee(()=>import("./zh_Hant-0e1f08e5.js"),["./zh_Hant-0e1f08e5.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(t=>t.z)]]);function kHe(t){const e=t.split("-")[0].toLowerCase();let i=null;for(const r of eK.keys())if(r.startsWith(e)){i=r;break}return i}function BHe(t){return t?eK.has(t.toLowerCase())?t.toLowerCase():kHe(t)||Bse:Bse}let AT=null,HA=null;async function zHe(t=od()){if(t=BHe(t),AT&&t===HA)return AT;AT=ee(()=>import("./index-a70dd312.js"),["./index-a70dd312.js","./_commonjsHelpers-2f3e7994.js"],import.meta.url).then(e=>e.i),HA=t;try{const[e,i]=await Promise.all([AT,eK.get(HA)()]);HA===t&&(e.am4core.options.defaultLocale=i.default),e.am4core.options.suppressWarnings=!0,e.am4core.options.autoDispose=!0}catch{return AT=null,HA=null,null}return AT}function GHe(t,e="default"){const i=VHe.find(r=>r.name===e);return i?i.colors.map(r=>t.color(r)):null}const El="esri-feature-media",cn={base:El,mediaContainer:`${El}__container`,mediaItemContainer:`${El}__item-container`,mediaItem:`${El}__item`,mediaItemTitle:`${El}__item-title`,mediaItemCaption:`${El}__item-caption`,mediaPrevious:`${El}__previous`,mediaPreviousIconLTR:`${El}__previous-icon`,mediaPreviousIconRTL:`${El}__previous-icon--rtl`,mediaNext:`${El}__next`,mediaNextIconLTR:`${El}__next-icon`,mediaNextIconRTL:`${El}__next-icon--rtl`,mediaChart:`${El}__chart`,mediaButton:`${El}__button`,mediaIcon:`${El}__icon`,iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow"},dk=.05,pk=.95,fk=15,fg="color",$0="tooltip",qA="value",zse="default-line-value";let Ec=class extends bl{constructor(e,i){super(e,i),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.viewModel=new Yw,this.messages=null,this._getChartDependencies=async r=>{const s=await zHe(),{destroyed:n,viewModel:o}=this;if(n||!o||!r)return;const{activeMediaInfo:a}=o,l=await this._getRendererColors(s);this._renderChart({chartDiv:r,mediaInfo:a,chartsModule:s,colorMap:l})}}initialize(){this._featureElementInfo=new $U,this.addHandles([re(()=>{var e,i;return[(e=this.viewModel)==null?void 0:e.activeMediaInfo,(i=this.viewModel)==null?void 0:i.activeMediaInfoIndex]},()=>this._setupMediaRefreshTimer(),Zt),re(()=>{var e,i;return[(e=this.viewModel)==null?void 0:e.description,(i=this.viewModel)==null?void 0:i.title]},()=>this._setupFeatureElementInfo(),Zt)])}destroy(){var e;this._clearMediaRefreshTimer(),(e=this._featureElementInfo)==null||e.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(e){this.viewModel.activeMediaInfoIndex=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(e){this.viewModel.fieldInfoMap=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(e){this.viewModel.mediaInfos=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(e){this.viewModel.relatedInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var e;return le("div",{bind:this,class:cn.base,onkeyup:this._handleMediaKeyup},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:e}=this.viewModel;return e?le("div",{key:"media-element-container",class:cn.mediaContainer},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(e){const{_refreshIntervalInfo:i}=this,{activeMediaInfoIndex:r,formattedMediaInfoCount:s}=this.viewModel,{value:n,refreshInterval:o,altText:a,title:l,type:c}=e,{sourceURL:h,linkURL:p}=n,f=Z1e(p??void 0)?"_blank":"_self",m=f==="_blank"?"noreferrer":"",y=o?i:null,_=y?y.timestamp:0,b=y?y.sourceURL:h,w=le("img",{alt:a||l,key:`media-${c}-${r}-${s}-${_}`,src:b??void 0});return(p?le("a",{title:l,href:p,rel:m,target:f},w):null)||w}renderChartMediaInfo(e){const{activeMediaInfoIndex:i,formattedMediaInfoCount:r}=this.viewModel;return le("div",{key:`media-${e.type}-${i}-${r}`,bind:this,class:cn.mediaChart,afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this.renderImageMediaInfo(e):e.type.includes("chart")?this.renderChartMediaInfo(e):null:null}renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel;if(!e)return null;const i=e.title?le("div",{key:"media-title",class:cn.mediaItemTitle,innerHTML:e.title}):null,r=e.caption?le("div",{key:"media-caption",class:cn.mediaItemCaption,innerHTML:e.caption}):null;return le("div",{key:"media-container",class:cn.mediaItemContainer},le("div",{key:"media-item-container",class:cn.mediaItem},this.renderMediaInfoType()),i,r)}renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const i=e==="previous",r=i?this.messages.previous:this.messages.next,s=i?this.classes(cn.mediaButton,cn.mediaPrevious):this.classes(cn.mediaButton,cn.mediaNext),n=i?this.classes(cn.mediaIcon,cn.mediaPreviousIconLTR,cn.iconLeftTriangleArrow):this.classes(cn.mediaIcon,cn.mediaNextIconLTR,cn.iconRightTriangleArrow),o=i?this.classes(cn.mediaIcon,cn.mediaPreviousIconRTL,cn.iconRightTriangleArrow):this.classes(cn.mediaIcon,cn.mediaNextIconRTL,cn.iconLeftTriangleArrow),a=i?"media-previous":"media-next",l=i?this._previous:this._next;return le("button",{type:"button",key:a,title:r,"aria-label":r,tabIndex:0,class:s,bind:this,onclick:l},le("span",{"aria-hidden":"true",class:n}),le("span",{"aria-hidden":"true",class:o}))}_setupFeatureElementInfo(){var r;const{description:e,title:i}=this;(r=this._featureElementInfo)==null||r.set({description:e,title:i})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){const{isAggregate:e,layer:i}=this.viewModel;return e&&(i!=null&&i.featureReduction)&&"renderer"in i.featureReduction?i.featureReduction.renderer:i==null?void 0:i.renderer}async _getRendererColors(e){const{am4core:i}=e,r=new Map,s=this._getRenderer(),n="default";if(!s)return r;const o=await dje(s);return o.delete(n),Array.from(o.values()).every(a=>(a==null?void 0:a.length)===1)&&(r.set(zse,i.color({r:50,g:50,b:50,a:1})),Array.from(o.keys()).forEach(a=>{var l;a&&r.set(a,i.color((l=o.get(a))==null?void 0:l[0].toCss(!0)))})),r}_handleMediaKeyup(e){const i=Tw(e);i==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),i==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_renderChart(e){const{abilities:i}=this.viewModel,{chartsModule:r,chartDiv:s,mediaInfo:n,colorMap:o}=e,{value:a,type:l}=n,{am4core:c}=r,h=GHe(c);function p(y){y instanceof c.ColorSet&&h&&(y.list=h)}Q4()&&c.useTheme(r.am4themes_dark);const f=window.matchMedia("(prefers-reduced-motion: reduce)");i.chartAnimation&&!f.matches?c.useTheme(r.am4themes_animated):c.unuseTheme(r.am4themes_animated),c.useTheme(p);const m=l==="pie-chart"?this._createPieChart(e):this._createXYChart(e);s.setAttribute("aria-label",n.altText||n.title),m.data=a.series.map(y=>({[$0]:y.tooltip,[qA]:y.value,[fg]:o.get(y.fieldName)})).filter(y=>l!=="pie-chart"||y.value!=null&&y.value>0)}_customizeChartTooltip(e,i){e&&(e.label.wrap=!0,e.label.maxWidth=200,e.autoTextColor=!1,e.getFillFromObject=!1,e.label.fill=i.color("#ffffff"),e.background.fill=i.color({r:0,g:0,b:0,a:.7}))}_createPieChart(e){const{chartDiv:i,chartsModule:r}=e,{am4core:s,am4charts:n}=r,o=s.create(i,n.PieChart);o.rtl=bm(this.container);const a=o.series.push(new n.PieSeries);return a.labels.template.disabled=!0,a.ticks.template.disabled=!0,a.dataFields.value=qA,a.dataFields.category=$0,this._customizeChartTooltip(a.tooltip,s),a.slices.template.propertyFields.fill=fg,a.slices.template.propertyFields.stroke=fg,o}_getMinSeriesValue(e){let i=0;return e.forEach(r=>i=Math.min(r.value,i)),i}_createColumnChart(e,i){const{chartsModule:r,mediaInfo:s}=i,{value:n}=s,{am4core:o,am4charts:a}=r,l=e.xAxes.push(new a.CategoryAxis);l.dataFields.category=$0,l.renderer.labels.template.disabled=!0;const c=l.tooltip;this._customizeChartTooltip(c,o),c.events.on("sizechanged",()=>{c.dy=-c.contentHeight});const h=e.yAxes.push(new a.ValueAxis),p=h.renderer.labels.template;h.renderer.minLabelPosition=dk,h.renderer.maxLabelPosition=pk,h.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(h.tooltip,o),p.wrap=!0;const f=e.series.push(new a.ColumnSeries);f.dataFields.valueY=qA,f.dataFields.categoryX=$0,f.columns.template.propertyFields.fill=fg,f.columns.template.propertyFields.stroke=fg,e.cursor=new a.XYCursor,n.series.length>fk&&(e.scrollbarX=new o.Scrollbar)}_createBarChart(e,i){const{chartsModule:r,mediaInfo:s}=i,{value:n}=s,{am4core:o,am4charts:a}=r,l=e.yAxes.push(new a.CategoryAxis);l.dataFields.category=$0,l.renderer.inversed=!0,l.renderer.labels.template.disabled=!0;const c=l.tooltip;this._customizeChartTooltip(c,o),c.events.on("sizechanged",()=>{c.dx=c.contentWidth});const h=e.xAxes.push(new a.ValueAxis),p=h.renderer.labels.template;h.renderer.minLabelPosition=dk,h.renderer.maxLabelPosition=pk,h.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(h.tooltip,o),p.wrap=!0;const f=e.series.push(new a.ColumnSeries);f.dataFields.valueX=qA,f.dataFields.categoryY=$0,f.columns.template.propertyFields.fill=fg,f.columns.template.propertyFields.stroke=fg,e.cursor=new a.XYCursor,n.series.length>fk&&(e.scrollbarY=new o.Scrollbar)}_createLineChart(e,i){const{chartsModule:r,mediaInfo:s,colorMap:n}=i,{value:o}=s,{am4core:a,am4charts:l}=r,c=e.xAxes.push(new l.CategoryAxis);c.dataFields.category=$0,c.renderer.labels.template.disabled=!0;const h=c.tooltip;this._customizeChartTooltip(h,a),h.events.on("sizechanged",()=>{h.dy=-h.contentHeight});const p=e.yAxes.push(new l.ValueAxis),f=p.renderer.labels.template;p.renderer.minLabelPosition=dk,p.renderer.maxLabelPosition=pk,p.min=this._getMinSeriesValue(o.series),this._customizeChartTooltip(p.tooltip,a),f.wrap=!0;const m=e.series.push(new l.LineSeries);m.dataFields.categoryX=$0,m.dataFields.valueY=qA,m.strokeWidth=1;const y=n.get(zse);y&&(m.stroke=y);const _=m.bullets.push(new l.CircleBullet);_.propertyFields.fill=fg,_.propertyFields.stroke=fg,e.cursor=new l.XYCursor,o.series.length>fk&&(e.scrollbarX=new a.Scrollbar)}_createXYChart(e){const{chartDiv:i,chartsModule:r,mediaInfo:s}=e,{type:n}=s,{am4core:o,am4charts:a}=r,l=o.create(i,a.XYChart);return l.rtl=bm(this.container),n==="column-chart"&&this._createColumnChart(l,e),n==="bar-chart"&&this._createBarChart(l,e),n==="line-chart"&&this._createLineChart(l,e),l}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const i=Date.now();this._refreshIntervalInfo={timestamp:i,sourceURL:e&&this._getImageSource(e,i)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;e&&e.type==="image"&&e.refreshInterval&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:i,value:r}=e;if(!i)return;const s=6e4*i;this._updateMediaInfoTimestamp(r.sourceURL);const n=setInterval(()=>{this._updateMediaInfoTimestamp(r.sourceURL)},s);this._refreshTimer=n}_getImageSource(e,i){const r=e.includes("?")?"&":"?",[s,n=""]=e.split("#");return`${s}${r}timestamp=${i}${n?"#":""}${n}`}};u([d()],Ec.prototype,"attributes",null),u([d()],Ec.prototype,"activeMediaInfoIndex",null),u([d()],Ec.prototype,"description",null),u([d()],Ec.prototype,"fieldInfoMap",null),u([d()],Ec.prototype,"layer",null),u([d()],Ec.prototype,"mediaInfos",null),u([d()],Ec.prototype,"popupTemplate",null),u([d()],Ec.prototype,"relatedInfos",null),u([d()],Ec.prototype,"title",null),u([d({type:Yw})],Ec.prototype,"viewModel",void 0),u([d(),dl("esri/widgets/Feature/t9n/Feature")],Ec.prototype,"messages",void 0),Ec=u([I("esri.widgets.Feature.FeatureMedia")],Ec);const Kbe=Ec;var Jj;let xR=Jj=class extends Ie{constructor(t){super(t),this.minValue=0,this.maxValue=0}clone(){return new Jj({minValue:this.minValue,maxValue:this.maxValue})}};u([d({type:Number,json:{write:!0}})],xR.prototype,"minValue",void 0),u([d({type:Number,json:{write:!0}})],xR.prototype,"maxValue",void 0),xR=Jj=u([I("esri.renderer.support.AuthoringInfoClassBreakInfo")],xR);var Kj;let Z_=Kj=class extends Ie{constructor(t){super(t),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new Kj({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:ae(this.classBreakInfos)})}};u([d({type:String,json:{write:!0}})],Z_.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],Z_.prototype,"normalizationField",void 0),u([d({type:String,json:{write:!0}})],Z_.prototype,"label",void 0),u([d({type:[xR],json:{write:!0}})],Z_.prototype,"classBreakInfos",void 0),Z_=Kj=u([I("esri.renderers.support.AuthoringInfoFieldInfo")],Z_);var Qj;const O$=new Gi({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),R$=new Gi({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),Gse={key:t=>typeof t=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},jse=["high-to-low","above-and-below","centered-on","extremes"],Hse=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],qse=["seconds","minutes","hours","days","months","years"];let Cc=Qj=class extends Ie{constructor(t){super(t),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(t){return typeof t=="string"||typeof t=="number"?t:null}castStartTime(t){return typeof t=="string"||typeof t=="number"?t:null}get style(){return this.type==="color"?this._get("style"):null}set style(t){this._set("style",t)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(t){this._set("theme",t)}clone(){return new Qj({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};u([d({types:Gse,json:{write:!0}})],Cc.prototype,"endTime",void 0),u([wi("endTime")],Cc.prototype,"castEndTime",null),u([d({type:String,json:{write:!0}})],Cc.prototype,"field",void 0),u([d({type:Number,json:{write:!0}})],Cc.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0}})],Cc.prototype,"minSliderValue",void 0),u([d({types:Gse,json:{write:!0}})],Cc.prototype,"startTime",void 0),u([wi("startTime")],Cc.prototype,"castStartTime",null),u([d({type:O$.apiValues,value:null,json:{type:O$.jsonValues,read:O$.read,write:O$.write}})],Cc.prototype,"style",null),u([d({type:Hse,value:null,json:{type:Hse,origins:{"web-scene":{type:jse,write:{writer:(t,e)=>{jse.includes(t)&&(e.theme=t)}}}},write:!0}})],Cc.prototype,"theme",null),u([d({type:R$.apiValues,json:{type:R$.jsonValues,read:R$.read,write:R$.write}})],Cc.prototype,"type",void 0),u([d({type:qse,json:{type:qse,write:!0}})],Cc.prototype,"units",void 0),Cc=Qj=u([I("esri.renderers.support.AuthoringInfoVisualVariable")],Cc);const jHe=Cc;let VN=class extends Ie{constructor(e){super(e),this.type=null}};u([d({readOnly:!0,json:{read:!1,write:!0}})],VN.prototype,"type",void 0),VN=u([I("esri.rest.support.ColorRamp")],VN);const tK=VN;var eH;let kb=eH=class extends tK{constructor(t){super(t),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new eH({fromColor:ae(this.fromColor),toColor:ae(this.toColor),algorithm:this.algorithm})}};u([At({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],kb.prototype,"algorithm",void 0),u([d({type:ot,json:{type:[Yr],write:!0}})],kb.prototype,"fromColor",void 0),u([d({type:ot,json:{type:[Yr],write:!0}})],kb.prototype,"toColor",void 0),u([d({type:["algorithmic"]})],kb.prototype,"type",void 0),kb=eH=u([I("esri.rest.support.AlgorithmicColorRamp")],kb);const iK=kb;var tH;let TR=tH=class extends tK{constructor(t){super(t),this.colorRamps=null,this.type="multipart"}clone(){return new tH({colorRamps:ae(this.colorRamps)})}};u([d({type:[iK],json:{write:!0}})],TR.prototype,"colorRamps",void 0),u([d({type:["multipart"]})],TR.prototype,"type",void 0),TR=tH=u([I("esri.rest.support.MultipartColorRamp")],TR);const Qbe=TR,HHe={key:"type",base:tK,typeMap:{algorithmic:iK,multipart:Qbe}};function qHe(t){return t&&t.type?t.type==="algorithmic"?iK.fromJSON(t):t.type==="multipart"?Qbe.fromJSON(t):null:null}var iH;const P1=new Gi({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),M$=new Gi({pieChart:"pie-chart",classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),Wse=new Gi({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),Xse=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],WHe=["high-to-low","above-and-below","above","below","90-10"],XHe=["flow-line","wave-front"],YHe=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let un=iH=class extends Ie{constructor(t){super(t),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const t=this._get("classificationMethod"),e=this.type;return e&&e!=="relationship"?e==="class-breaks-size"||e==="class-breaks-color"?t||"manual":null:t}set classificationMethod(t){this._set("classificationMethod",t)}readColorRamp(t){return t?qHe(t):void 0}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(t){this._set("fields",t)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(t){this._set("field1",t)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(t){this._set("field2",t)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(t){this._set("flowTheme",t)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(t){this._set("focus",t)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(t){this._set("numClasses",t)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(t){this._set("statistics",t)}get standardDeviationInterval(){const t=this.type;return t&&t!=="relationship"&&t!=="class-breaks-size"&&t!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(t){this._set("standardDeviationInterval",t)}get type(){return this._get("type")}set type(t){let e=t;t==="classed-size"?e="class-breaks-size":t==="classed-color"&&(e="class-breaks-color"),this._set("type",e)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(t){this._set("univariateSymbolStyle",t)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(t){this._set("univariateTheme",t)}clone(){return new iH({classificationMethod:this.classificationMethod,colorRamp:ae(this.colorRamp),fadeRatio:ae(this.fadeRatio),fields:this.fields&&this.fields.slice(0),field1:ae(this.field1),field2:ae(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(t=>t.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};u([d({type:P1.apiValues,value:null,json:{type:P1.jsonValues,read:P1.read,write:P1.write,origins:{"web-document":{default:"manual",type:P1.jsonValues,read:P1.read,write:P1.write}}}})],un.prototype,"classificationMethod",null),u([d({types:HHe,json:{write:!0}})],un.prototype,"colorRamp",void 0),u([Qe("colorRamp")],un.prototype,"readColorRamp",null),u([d({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],un.prototype,"fadeRatio",void 0),u([d({type:[String],value:null,json:{write:!0}})],un.prototype,"fields",null),u([d({type:Z_,value:null,json:{write:!0}})],un.prototype,"field1",null),u([d({type:Z_,value:null,json:{write:!0}})],un.prototype,"field2",null),u([d({type:XHe,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],un.prototype,"flowTheme",null),u([d({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],un.prototype,"focus",null),u([d({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],un.prototype,"isAutoGenerated",void 0),u([d({type:Number,value:null,json:{type:Yr,write:!0}})],un.prototype,"numClasses",null),u([d({type:Xse,json:{type:Xse,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],un.prototype,"lengthUnit",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],un.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],un.prototype,"minSliderValue",void 0),u([d({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],un.prototype,"statistics",null),u([d({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],un.prototype,"standardDeviationInterval",null),u([d({type:M$.apiValues,value:null,json:{type:M$.jsonValues,read:M$.read,write:M$.write,origins:{"web-scene":{type:Wse.jsonValues,write:{writer:Wse.write,overridePolicy:t=>({enabled:t!=="flow"})}}}}})],un.prototype,"type",null),u([d({type:[jHe],json:{write:!0}})],un.prototype,"visualVariables",void 0),u([d({type:YHe,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],un.prototype,"univariateSymbolStyle",null),u([d({type:WHe,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],un.prototype,"univariateTheme",null),un=iH=u([I("esri.renderers.support.AuthoringInfo")],un);const rK=un,mk=new Gi({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let SR=class extends Ie{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const i=new Set;return await this.collectRequiredFields(i,e),Array.from(i).sort()}getSymbol(e,i){}async getSymbolAsync(e,i){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};u([d({type:rK,json:{write:!0}})],SR.prototype,"authoringInfo",void 0),u([d({type:mk.apiValues,readOnly:!0,json:{type:mk.jsonValues,read:!1,write:{writer:mk.write,ignoreOrigin:!0}}})],SR.prototype,"type",void 0),SR=u([I("esri.renderers.Renderer")],SR);const a0=SR;function ZHe(t){var e,i;return((i=(e=t.match(JHe))==null?void 0:e[1])==null?void 0:i.replace(/\\'/g,"'"))??null}const JHe=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var rH;let TE=rH=class extends Ie{constructor(){super(...arguments),this.title=null}clone(){return new rH({title:this.title})}};u([d({type:String,json:{write:!0}})],TE.prototype,"title",void 0),TE=rH=u([I("esri.renderers.support.LegendOptions")],TE);var sH;let kN=sH=class extends TE{constructor(){super(...arguments),this.showLegend=null}clone(){return new sH({title:this.title,showLegend:this.showLegend})}};u([d({type:Boolean,json:{write:!0}})],kN.prototype,"showLegend",void 0),kN=sH=u([I("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],kN);const ewe=kN,gk=new Gi({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let Qd=class extends Ie{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(oe.getLogger(this.declaredClass).error(".field: field must be a string value"),null):qP(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};u([d()],Qd.prototype,"index",void 0),u([d({type:gk.apiValues,readOnly:!0,json:{read:gk.read,write:gk.write}})],Qd.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Qd.prototype,"field",void 0),u([wi("field")],Qd.prototype,"castField",null),u([d({type:String,json:{write:!0}})],Qd.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],Qd.prototype,"valueExpressionTitle",void 0),u([d({readOnly:!0})],Qd.prototype,"arcadeRequired",null),u([d({type:ewe,json:{write:!0}})],Qd.prototype,"legendOptions",void 0),Qd=u([I("esri.renderers.visualVariables.VisualVariable")],Qd);const fI=Qd;var nH;let Bb=nH=class extends fI{constructor(t){super(t),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value),this._set("stops",t)}clone(){return new nH({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([d({readOnly:!0})],Bb.prototype,"cache",null),u([d({type:["color"],json:{type:["colorInfo"]}})],Bb.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Bb.prototype,"normalizationField",void 0),u([d({type:[Q7e],json:{write:!0}})],Bb.prototype,"stops",null),Bb=nH=u([I("esri.renderers.visualVariables.ColorVariable")],Bb);const twe=Bb;var oH;let C_=oH=class extends Ie{constructor(t){super(t),this.label=null,this.opacity=null,this.value=null}readOpacity(t,e){return V3(e.transparency)}writeOpacity(t,e,i){e[i]=Q6(t)}clone(){return new oH({label:this.label,opacity:this.opacity,value:this.value})}};u([d({type:String,json:{write:!0}})],C_.prototype,"label",void 0),u([d({type:Number,json:{type:Yr,write:{target:"transparency"}}})],C_.prototype,"opacity",void 0),u([Qe("opacity",["transparency"])],C_.prototype,"readOpacity",null),u([lt("opacity")],C_.prototype,"writeOpacity",null),u([d({type:Number,json:{write:!0}})],C_.prototype,"value",void 0),C_=oH=u([I("esri.renderers.visualVariables.support.OpacityStop")],C_);const KHe=C_;var aH;let zb=aH=class extends fI{constructor(t){super(t),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value),this._set("stops",t)}clone(){return new aH({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([d({readOnly:!0})],zb.prototype,"cache",null),u([d({type:["opacity"],json:{type:["transparencyInfo"]}})],zb.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],zb.prototype,"normalizationField",void 0),u([d({type:[KHe],json:{write:!0}})],zb.prototype,"stops",null),zb=aH=u([I("esri.renderers.visualVariables.OpacityVariable")],zb);const iwe=zb;var lH;let Bg=lH=class extends fI{constructor(t){super(t),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(t,e,i,r){if(r&&r.messages){const s=`visualVariables[${this.index}]`;r.messages.push(new W("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpressionTitle",context:r}))}}clone(){return new lH({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})}};u([d({readOnly:!0})],Bg.prototype,"cache",null),u([d({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],Bg.prototype,"axis",void 0),u([d({type:["rotation"],json:{type:["rotationInfo"]}})],Bg.prototype,"type",void 0),u([d({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],Bg.prototype,"rotationType",void 0),u([d({type:String,json:{write:!0}})],Bg.prototype,"valueExpressionTitle",void 0),u([lt("web-scene","valueExpressionTitle")],Bg.prototype,"writeValueExpressionTitleWebScene",null),Bg=lH=u([I("esri.renderers.visualVariables.RotationVariable")],Bg);const rwe=Bg;var cH;let tS=cH=class extends Ie{constructor(t){super(t),this.label=null,this.size=null,this.value=null}clone(){return new cH({label:this.label,size:this.size,value:this.value})}};u([d({type:String,json:{write:!0}})],tS.prototype,"label",void 0),u([d({type:Number,cast:mr,json:{write:!0}})],tS.prototype,"size",void 0),u([d({type:Number,json:{write:!0}})],tS.prototype,"value",void 0),tS=cH=u([I("esri.renderers.visualVariables.support.SizeStop")],tS);const iS=tS;var uH;let BN=uH=class extends ewe{constructor(){super(...arguments),this.customValues=null}clone(){return new uH({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};u([d({type:[Number],json:{write:!0}})],BN.prototype,"customValues",void 0),BN=uH=u([I("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],BN);const QHe=BN;var Oy,No;function Sv(t){return t&&t.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function K3(t){return t!=null&&!isNaN(t)&&isFinite(t)}function swe(t){return t.valueExpression?Oy.Expression:t.field&&typeof t.field=="string"?Oy.Field:Oy.Unknown}function eqe(t,e){const i=e||swe(t),r=t.valueUnit||"unknown";return i===Oy.Unknown?No.Constant:t.stops?No.Stops:t.minSize!=null&&t.maxSize!=null&&t.minDataValue!=null&&t.maxDataValue!=null?No.ClampedLinear:r==="unknown"?t.minSize!=null&&t.minDataValue!=null?t.minSize&&t.minDataValue?No.Proportional:No.Additive:No.Identity:No.RealWorldSize}(function(t){t.Unknown="unknown",t.Expression="expression",t.Field="field"})(Oy||(Oy={})),function(t){t.Unknown="unknown",t.Stops="stops",t.ClampedLinear="clamped-linear",t.Proportional="proportional",t.Additive="additive",t.Constant="constant",t.Identity="identity",t.RealWorldSize="real-world-size"}(No||(No={}));function KPt(t){}function tqe(t){return()=>t}const _C={inches:An(1,"meters","inches"),feet:An(1,"meters","feet"),"us-feet":An(1,"meters","us-feet"),yards:An(1,"meters","yards"),miles:An(1,"meters","miles"),"nautical-miles":An(1,"meters","nautical-miles"),millimeters:An(1,"meters","millimeters"),centimeters:An(1,"meters","centimeters"),decimeters:An(1,"meters","decimeters"),meters:An(1,"meters","meters"),kilometers:An(1,"meters","kilometers"),"decimal-degrees":1/r4e(1,"meters",Oi.radius)},t1=oe.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),Yse=new ha,zN=Math.PI,nwe=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function owe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(y=>y.type==="color"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void t1.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const s=typeof e=="number",n=s?null:e,o=n&&n.attributes;let a=s?e:null;const l=r.field,{ipData:c,hasExpression:h}=r.cache;let p=r.cache.compiledFunc;if(!l&&!h){const y=r.stops;return y&&y[0]&&y[0].color}if(typeof a!="number")if(h){if(C(i)||C(i.arcade))return void t1.error("Use of arcade expressions requires an arcade context");const y={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},_=i.arcade.arcadeUtils,b=_.getViewInfo(y),w=_.createExecContext(n,b);if(!p){const S=_.createSyntaxTree(r.valueExpression);p=_.createFunction(S),r.cache.compiledFunc=p}a=_.executeFunction(p,w)}else o&&(a=o[l]);const f=r.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const y=nK(a,c);if(y){const _=y[0],b=y[1],w=_===b?r.stops[_].color:ot.blendColors(r.stops[_].color,r.stops[b].color,y[2],v(i)?i.color:void 0);return new ot(w)}}}function awe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(y=>y.type==="opacity"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void t1.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const s=typeof e=="number",n=s?null:e,o=n&&n.attributes;let a=s?e:null;const l=r.field,{ipData:c,hasExpression:h}=r.cache;let p=r.cache.compiledFunc;if(!l&&!h){const y=r.stops;return y&&y[0]&&y[0].opacity}if(typeof a!="number")if(h){if(C(i)||C(i.arcade))return void t1.error("Use of arcade expressions requires an arcade context");const y={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},_=i.arcade.arcadeUtils,b=_.getViewInfo(y),w=_.createExecContext(n,b);if(!p){const S=_.createSyntaxTree(r.valueExpression);p=_.createFunction(S),r.cache.compiledFunc=p}a=_.executeFunction(p,w)}else o&&(a=o[l]);const f=r.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const y=nK(a,c);if(y){const _=y[0],b=y[1];if(_===b)return r.stops[_].opacity;{const w=r.stops[_].opacity;return w+(r.stops[b].opacity-w)*y[2]}}}}function lwe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(m=>m.type==="rotation"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void t1.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const s=r.axis||"heading",n=s==="heading"&&r.rotationType==="arithmetic"?90:0,o=s==="heading"&&r.rotationType==="arithmetic"?-1:1,a=typeof e=="number"?null:e,l=a&&a.attributes,c=r.field,{hasExpression:h}=r.cache;let p=r.cache.compiledFunc,f=0;if(!c&&!h)return f;if(h){if(C(i)||C(i.arcade))return void t1.error("Use of arcade expressions requires an arcade context");const m={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},y=i.arcade.arcadeUtils,_=y.getViewInfo(m),b=y.createExecContext(a,_);if(!p){const w=y.createSyntaxTree(r.valueExpression);p=y.createFunction(w),r.cache.compiledFunc=p}f=y.executeFunction(p,b)}else l&&(f=l[c]||0);return f=typeof f!="number"||isNaN(f)?null:n+o*f,f}function iqe(t,e,i){const r=typeof e=="number",s=r?null:e,n=s&&s.attributes;let o=r?e:null;const{isScaleDriven:a}=t.cache;let l=t.cache.compiledFunc;if(a){const h=v(i)?i.scale:void 0,p=v(i)?i.view:void 0;o=h==null||p==="3d"?rqe(t):h}else if(!r)switch(t.inputValueType){case Oy.Expression:{if(C(i)||C(i.arcade))return void t1.error("Use of arcade expressions requires an arcade context");const h={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},p=i.arcade.arcadeUtils,f=p.getViewInfo(h),m=p.createExecContext(s,f);if(!l){const y=p.createSyntaxTree(t.valueExpression);l=p.createFunction(y),t.cache.compiledFunc=l}o=p.executeFunction(l,m);break}case Oy.Field:n&&(o=n[t.field]);break;case Oy.Unknown:o=null}if(!K3(o))return null;if(r||!t.normalizationField)return o;const c=n?parseFloat(n[t.normalizationField]):null;return K3(c)&&c!==0?o/c:null}function rqe(t){let e=null,i=null;const r=t.stops;return r?(e=r[0].value,i=r[r.length-1].value):(e=t.minDataValue||0,i=t.maxDataValue||0),(e+i)/2}function kU(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(n=>n.type==="size"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void t1.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const s=uwe(iqe(r,e,i),r,e,i,r.cache.ipData);return s==null||isNaN(s)?0:s}function Jc(t,e,i){return t==null?null:Sv(t)?kU(t,e,i):K3(t)?t:null}function cwe(t,e,i){return K3(i)&&t>i?i:K3(e)&&t<e?e:t}function sqe(t,e,i,r){return t+((Jc(e.minSize,i,r)||e.minDataValue)??0)}function nqe(t,e,i){const r=t.stops;let s=r&&r.length&&r[0].size;return s==null&&(s=t.minSize),Jc(s,e,i)}function oqe(t,e,i,r){const s=(t-e.minDataValue)/(e.maxDataValue-e.minDataValue),n=Jc(e.minSize,i,r),o=Jc(e.maxSize,i,r),a=v(r)?r.shape:void 0;if(t<=e.minDataValue)return n;if(t>=e.maxDataValue)return o;if(n==null||o==null)return null;if(e.scaleBy==="area"&&a){const l=a==="circle",c=l?zN*(n/2)**2:n*n,h=c+s*((l?zN*(o/2)**2:o*o)-c);return l?2*Math.sqrt(h/zN):Math.sqrt(h)}return n+s*(o-n)}function aqe(t,e,i,r){const s=v(r)?r.shape:void 0,n=t/e.minDataValue,o=Jc(e.minSize,i,r),a=Jc(e.maxSize,i,r);let l=null;return l=s==="circle"?2*Math.sqrt(n*(o/2)**2):s==="square"||s==="diamond"||s==="image"?Math.sqrt(n*o**2):n*o,cwe(l,o,a)}function lqe(t,e,i,r,s){var l,c,h;const[n,o,a]=nK(t,s);if(n===o)return Jc((l=e.stops)==null?void 0:l[n].size,i,r);{const p=Jc((c=e.stops)==null?void 0:c[n].size,i,r);return p+(Jc((h=e.stops)==null?void 0:h[o].size,i,r)-p)*a}}function cqe(t,e,i,r){const s=(v(r)&&r.resolution?r.resolution:1)*_C[e.valueUnit],n=Jc(e.minSize,i,r),o=Jc(e.maxSize,i,r),{valueRepresentation:a}=e;let l=null;return l=a==="area"?2*Math.sqrt(t/zN)/s:a==="radius"||a==="distance"?2*t/s:t/s,cwe(l,n,o)}function uwe(t,e,i,r,s){switch(e.transformationType){case No.Additive:return sqe(t,e,i,r);case No.Constant:return nqe(e,i,r);case No.ClampedLinear:return oqe(t,e,i,r);case No.Proportional:return aqe(t,e,i,r);case No.Stops:return lqe(t,e,i,r,s);case No.RealWorldSize:return cqe(t,e,i,r);case No.Identity:return t;case No.Unknown:return null}}function uqe(t,e,i){const{isScaleDriven:r}=t.cache;if(!(r&&i==="3d"||e))return null;const s={scale:e,view:i};let n=Jc(t.minSize,Yse,s),o=Jc(t.maxSize,Yse,s);if(n!=null||o!=null){if(n>o){const a=o;o=n,n=a}return{minSize:n,maxSize:o}}}function sK(t,e,i){if(!t.visualVariables)return;const r=[],s=[],n=[],o=[],a=[];for(const l of t.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return s.forEach(l=>{const c=owe(l,e,i);r.push({variable:l,value:c})}),n.forEach(l=>{const c=awe(l,e,i);r.push({variable:l,value:c})}),a.forEach(l=>{const c=lwe(l,e,i);r.push({variable:l,value:c})}),o.forEach(l=>{const c=kU(l,e,i);r.push({variable:l,value:c})}),r.filter(l=>l.value!=null)}function nK(t,e){if(!e)return;let i=0,r=e.length-1;return e.some((s,n)=>t<s?(r=n,!0):(i=n,!1)),[i,r,(t-e[i])/(e[r]-e[i])]}function hqe(t,e,i){const r=["proportional","proportional","proportional"];for(const s of t){const n=s.useSymbolValue?"symbol-value":kU(s,e,i);switch(s.axis){case"width":r[0]=n;break;case"depth":r[1]=n;break;case"height":r[2]=n;break;case"width-and-depth":r[0]=n,r[1]=n;break;case"all":case void 0:case null:r[0]=n,r[1]=n,r[2]=n;break;default:s.axis}}return r}const oK=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:hqe,getColor:owe,getOpacity:awe,getRotationAngle:lwe,getSize:kU,getSizeForValue:uwe,getSizeFromNumberOrVariable:Jc,getSizeRangeAtScale:uqe,getVisualVariableValues:sK,viewScaleRE:nwe},Symbol.toStringTag,{value:"Module"}));var hH;const P$=new Gi({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),dH=new Gi({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function Zse(t){if(t!=null)return typeof t=="string"||typeof t=="number"?mr(t):t.type==="size"?Sv(t)?t:(delete(t={...t}).type,new wr(t)):void 0}function Jse(t,e,i){if(typeof t!="object")return t;const r=new wr;return r.read(t,i),r}let wr=hH=class extends fI{constructor(t){super(t),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:this.valueExpression!=null&&nwe.test(this.valueExpression)}}set expression(t){oe.getLogger(this.declaredClass).warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),t==="view.scale"?(this.valueExpression="$view.scale",this._set("expression",t)):this._set("expression",null)}set index(t){Sv(this.maxSize)&&(this.maxSize.index=`visualVariables[${t}].maxSize`),Sv(this.minSize)&&(this.minSize.index=`visualVariables[${t}].minSize`),this._set("index",t)}get inputValueType(){return swe(this)}set maxDataValue(t){t&&this.stops&&(oe.getLogger(this.declaredClass).warn("cannot set maxDataValue when stops is not null."),t=null),this._set("maxDataValue",t)}set maxSize(t){t&&this.stops&&(oe.getLogger(this.declaredClass).warn("cannot set maxSize when stops is not null."),t=null),this._set("maxSize",t)}castMaxSize(t){return Zse(t)}readMaxSize(t,e,i){return Jse(t,e,i)}set minDataValue(t){t&&this.stops&&(oe.getLogger(this.declaredClass).warn("cannot set minDataValue when stops is not null."),t=null),this._set("minDataValue",t)}set minSize(t){t&&this.stops&&(oe.getLogger(this.declaredClass).warn("cannot set minSize when stops is not null."),t=null),this._set("minSize",t)}castMinSize(t){return Zse(t)}readMinSize(t,e,i){return Jse(t,e,i)}get arcadeRequired(){return!!this.valueExpression||this.minSize!=null&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize!=null&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(t){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value):t&&(oe.getLogger(this.declaredClass).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),t=null),this._set("stops",t)}get transformationType(){return eqe(this,this.inputValueType)}readValueExpression(t,e){return t||e.expression&&"$view.scale"}writeValueExpressionWebScene(t,e,i,r){if(t==="$view.scale"){if(r&&r.messages){const s=this.index,n=typeof s=="string"?s:`visualVariables[${s}]`;r.messages.push(new W("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpression",context:r}))}}else e[i]=t}readValueUnit(t){return t?dH.read(t):null}clone(){return new hH({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:Sv(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:Sv(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if(this.transformationType===No.ClampedLinear){const{minSize:t,maxSize:e}=this;return this.minSize=e,this.maxSize=t,this}if(this.transformationType===No.Stops){const t=this.stops;if(!t)return this;const e=t.map(r=>r.size).reverse(),i=t.length;for(let r=0;r<i;r++)t[r].size=e[r];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([d({readOnly:!0})],wr.prototype,"cache",null),u([d({type:P$.apiValues,json:{type:P$.jsonValues,origins:{"web-map":{read:!1}},read:P$.read,write:P$.write}})],wr.prototype,"axis",void 0),u([d({type:String,value:null,json:{read:!1}})],wr.prototype,"expression",null),u([d()],wr.prototype,"index",null),u([d({type:String,readOnly:!0})],wr.prototype,"inputValueType",null),u([d({type:QHe,json:{write:!0}})],wr.prototype,"legendOptions",void 0),u([d({type:Number,value:null,json:{write:!0}})],wr.prototype,"maxDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],wr.prototype,"maxSize",null),u([wi("maxSize")],wr.prototype,"castMaxSize",null),u([Qe("maxSize")],wr.prototype,"readMaxSize",null),u([d({type:Number,value:null,json:{write:!0}})],wr.prototype,"minDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],wr.prototype,"minSize",null),u([wi("minSize")],wr.prototype,"castMinSize",null),u([Qe("minSize")],wr.prototype,"readMinSize",null),u([d({type:String,json:{write:!0}})],wr.prototype,"normalizationField",void 0),u([d({readOnly:!0})],wr.prototype,"arcadeRequired",null),u([d({type:String})],wr.prototype,"scaleBy",void 0),u([d({type:[iS],value:null,json:{write:!0}})],wr.prototype,"stops",null),u([d({type:["outline"],json:{write:!0}})],wr.prototype,"target",void 0),u([d({type:String,readOnly:!0})],wr.prototype,"transformationType",null),u([d({type:["size"],json:{type:["sizeInfo"]}})],wr.prototype,"type",void 0),u([d({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],wr.prototype,"useSymbolValue",void 0),u([d({type:String,json:{write:!0}})],wr.prototype,"valueExpression",void 0),u([Qe("valueExpression",["valueExpression","expression"])],wr.prototype,"readValueExpression",null),u([lt("web-scene","valueExpression")],wr.prototype,"writeValueExpressionWebScene",null),u([d({type:["radius","diameter","area","width","distance"],json:{write:!0}})],wr.prototype,"valueRepresentation",void 0),u([d({type:dH.apiValues,json:{write:dH.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],wr.prototype,"valueUnit",void 0),u([Qe("valueUnit")],wr.prototype,"readValueUnit",null),wr=hH=u([I("esri.renderers.visualVariables.SizeVariable")],wr);const BU=wr,dqe={color:twe,size:BU,opacity:iwe,rotation:rwe},pqe=new Gi({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),fqe=/^\[([^\]]+)\]$/i;let GN=class extends $e{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),(e=e&&e.filter(i=>!!i))&&e.length){for(const i of e)switch(i.type){case"color":this.colorVariables.push(i);break;case"opacity":this.opacityVariables.push(i);break;case"rotation":this.rotationVariables.push(i);break;case"size":this.sizeVariables.push(i)}this.sizeVariables.length&&this.sizeVariables.some(i=>!!i.target)&&e.sort((i,r)=>{let s=null;return s=i.target===r.target?0:i.target?1:-1,s});for(let i=0;i<e.length;i++)e[i].index=i;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,i,r){const{rotationExpression:s,rotationType:n}=i,o=s&&s.match(fqe),a=o&&o[1];if(a&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:n,field:a})),e)return e.map(l=>{const c=pqe.read(l.type),h=dqe[c];h||(oe.getLogger(this.declaredClass).warn(`Unknown variable type: ${c}`),r&&r.messages&&r.messages.push(new dd("visual-variable:unsupported",`visualVariable of type '${c}' is not supported`,{definition:l,context:r})));const p=new h;return p.read(l,r),p})}writeVariables(e,i){const r=[];for(const s of e){const n=s.toJSON(i);n&&r.push(n)}return r}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};u([d()],GN.prototype,"visualVariables",null),GN=u([I("esri.renderers.visualVariables.VisualVariableFactory")],GN);const mqe=GN,gqe={base:fI,key:"type",typeMap:{opacity:iwe,color:twe,rotation:rwe,size:BU}},lA=t=>{let e=class extends t{constructor(){super(...arguments),this._vvFactory=new mqe}set visualVariables(i){this._vvFactory.visualVariables=i,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(i,r,s){return this._vvFactory.readVariables(i,r,s)}writeVisualVariables(i,r,s,n){r[s]=this._vvFactory.writeVariables(i,n)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const i of this.visualVariables)if(i.arcadeRequired)return!0;return!1}hasVisualVariables(i,r){return i?this.getVisualVariablesForType(i,r).length>0:this.getVisualVariablesForType("size",r).length>0||this.getVisualVariablesForType("color",r).length>0||this.getVisualVariablesForType("opacity",r).length>0||this.getVisualVariablesForType("rotation",r).length>0}getVisualVariablesForType(i,r){const s=this.visualVariables;return s?s.filter(n=>n.type===i&&(typeof r=="string"?n.target===r:r!==!1||!n.target)):[]}async collectVVRequiredFields(i,r){let s=[];this.visualVariables&&(s=s.concat(this.visualVariables));for(const n of s)n&&(n.field&&Xu(i,r,n.field),n.normalizationField&&Xu(i,r,n.normalizationField),n.valueExpression&&(yqe(n.valueExpression,i,r)||await cc(i,r,n.valueExpression)))}};return u([d({types:[gqe],value:null,json:{write:!0}})],e.prototype,"visualVariables",null),u([Qe("visualVariables",["visualVariables","rotationType","rotationExpression"])],e.prototype,"readVisualVariables",null),u([lt("visualVariables")],e.prototype,"writeVisualVariables",null),e=u([I("esri.renderers.mixins.VisualVariablesMixin")],e),e};function yqe(t,e,i){const r=ZHe(t);return!!v(r)&&(Xu(e,i,r),!0)}const WA={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function _qe(t,e=WA){var a,l;if(!t)return{symbol:null};const{retainId:i=WA.retainId,ignoreDrivers:r=WA.ignoreDrivers,hasLabelingContext:s=WA.hasLabelingContext,retainCIM:n=WA.retainCIM}=e;let o=null;if(oC(t)||t instanceof cT)o=t.clone();else if(t.type==="cim"){const c=(l=(a=t.data)==null?void 0:a.symbol)==null?void 0:l.type;if(c!=="CIMPointSymbol")return{error:new W("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${c||"unknown"}' is unsupported in 3D`,{symbol:t})};o=n?t.clone():yv.fromCIMSymbol(t)}else if(t instanceof Ed)o=lU.fromSimpleLineSymbol(t);else if(t instanceof _1)o=yv.fromSimpleMarkerSymbol(t);else if(t instanceof uU)o=yv.fromPictureMarkerSymbol(t);else if(t instanceof y1)o=e.geometryType&&e.geometryType==="mesh"?cU.fromSimpleFillSymbol(t):rI.fromSimpleFillSymbol(t);else{if(!(t instanceof tA))return{error:new W("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};o=s?aU.fromTextSymbol(t):yv.fromTextSymbol(t)}if(i&&o&&o.type!=="cim"&&(o.id=t.id),r&&oC(o))for(let c=0;c<o.symbolLayers.length;++c)o.symbolLayers.getItemAt(c)._ignoreDrivers=!0;return{symbol:o}}function e5(t,e,i,r){const s=hwe(t,{},{context:r,isLabelSymbol:!1});v(s)&&(e[i]=s)}function Kse(t,e,i,r){const s=hwe(t,{},{context:r,isLabelSymbol:!0});v(s)&&(e[i]=s)}function Qse(t){return t instanceof eA||t instanceof cT}function hwe(t,e,i){if(C(t))return null;const{context:r,isLabelSymbol:s}=i,n=r==null?void 0:r.origin,o=r==null?void 0:r.messages;if(n==="web-scene"&&!Qse(t)){const a=_qe(t,{retainCIM:!0,hasLabelingContext:s});return v(a.symbol)?a.symbol.write(e,r):(o==null||o.push(new W("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:r,error:a.error})),null)}return(n==="web-map"||n==="portal-item"&&!Vve(r==null?void 0:r.layer))&&Qse(t)?(o==null||o.push(new W("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:r})),null):t.write(e,r)}function eIt(t,e){return r8e(t,null,e)}const cA={types:dU,json:{write:{writer:e5},origins:{"web-scene":{types:Yie,write:{writer:e5},read:{reader:f1({types:Yie})}}}}},dwe={types:{base:nu,key:"type",typeMap:{"simple-fill":nx.typeMap["simple-fill"],"picture-fill":nx.typeMap["picture-fill"],"polygon-3d":nx.typeMap["polygon-3d"]}},json:{write:{writer:e5},origins:{"web-scene":{type:rI,write:{writer:e5}}}}},jN={cast:t=>t==null||typeof t=="string"||typeof t=="number"?t:`${t}`,json:{type:String,write:{writer:(t,e)=>{e.value=t==null?void 0:t.toString()}}}};var pH;let A_=pH=class extends Ie{constructor(t){super(t),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new pH({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${t}`}};u([d({type:String,json:{write:!0}})],A_.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],A_.prototype,"label",void 0),u([d({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],A_.prototype,"minValue",void 0),u([d({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],A_.prototype,"maxValue",void 0),u([d(cA)],A_.prototype,"symbol",void 0),A_=pH=u([I("esri.renderers.support.ClassBreakInfo")],A_);const t5=A_;var fH;const pwe="log",HN="percent-of-total",qN="field",I$=new Gi({esriNormalizeByLog:pwe,esriNormalizeByPercentOfTotal:HN,esriNormalizeByField:qN}),vqe=mn(t5);let Qn=fH=class extends lA(a0){constructor(t){super(t),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(t,e,i){if(!Array.isArray(t))return;let r=e.minValue;return t.map(s=>{const n=new t5;return n.read(s,i),n.minValue==null&&(n.minValue=r),n.maxValue==null&&(n.maxValue=n.minValue),r=n.maxValue,n})}writeClassBreakInfos(t,e,i,r){const s=t.map(n=>n.write({},r));this._areClassBreaksConsecutive()&&s.forEach(n=>delete n.classMinValue),e[i]=s}castField(t){return t==null?t:typeof t=="function"?(oe.getLogger(this.declaredClass).error(".field: field must be a string value"),null):qP(t)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let t=this._get("normalizationType");const e=!!this.normalizationField,i=this.normalizationTotal!=null;return e||i?(t=e&&qN||i&&HN||null,e&&i&&oe.getLogger(this.declaredClass).warn("warning: both normalizationField and normalizationTotal are set!")):t!==qN&&t!==HN||(t=null),t}set normalizationType(t){this._set("normalizationType",t)}addClassBreakInfo(t,e,i){let r=null;r=typeof t=="number"?new t5({minValue:t,maxValue:e,symbol:Y0e(i)}):vqe(ae(t)),this.classBreakInfos.push(r),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(t,e){const i=this.classBreakInfos.length;for(let r=0;r<i;r++){const s=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(s[0]===t&&s[1]===e){this.classBreakInfos.splice(r,1);break}}}getBreakIndex(t,e){return this.valueExpression&&(C(e)||C(e.arcade))&&oe.getLogger(this.declaredClass).warn(""),this.valueExpression?this._getBreakIndexForExpression(t,e):this._getBreakIndexForField(t)}async getClassBreakInfo(t,e){let i=e;this.valueExpression&&(C(e)||C(e.arcade))&&(i={...i,arcade:await Um()});const r=this.getBreakIndex(t,i);return r!==-1?this.classBreakInfos[r]:null}getSymbol(t,e){if(this.valueExpression&&(C(e)||C(e.arcade)))return void oe.getLogger(this.declaredClass).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this.getBreakIndex(t,e);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}async getSymbolAsync(t,e){let i=e;if(this.valueExpression&&(C(e)||C(e.arcade))){const s=await Um(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i={...i,arcade:s}}const r=this.getBreakIndex(t,i);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}getSymbols(){const t=[];return this.classBreakInfos.forEach(e=>{e.symbol&&t.push(e.symbol)}),this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),i=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${t}.${e}.${this.classBreakInfos.reduce((r,s)=>r+s.getMeshHash(),"")}.${i}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new fH({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:ae(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:ae(this.visualVariables),legendOptions:ae(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(t,e){const i=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(i)}async collectSymbolFields(t,e){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(t,e)),cc(t,e,this.valueExpression)];Xu(t,e,this.field),Xu(t,e,this.normalizationField),await Promise.all(i)}_getBreakIndexForExpression(t,e){const{viewingMode:i,scale:r,spatialReference:s,arcade:n}=Gt(e,{}),{valueExpression:o}=this;let a=this._compiledValueExpression.valueExpression===o?this._compiledValueExpression.compiledFunction:null;const l=n.arcadeUtils;if(!a){const h=l.createSyntaxTree(o);a=l.createFunction(h),this._compiledValueExpression.compiledFunction=a}this._compiledValueExpression.valueExpression=o;const c=l.executeFunction(a,l.createExecContext(t,l.getViewInfo({viewingMode:i,scale:r,spatialReference:s})));return this._getBreakIndexfromInfos(c)}_getBreakIndexForField(t){const e=this.field,i=t.attributes,r=this.normalizationType;let s=parseFloat(i[e]);if(r){const n=this.normalizationTotal,o=parseFloat(this.normalizationField?i[this.normalizationField]:void 0);if(r===pwe)s=Math.log(s)*Math.LOG10E;else if(r!==HN||n==null||isNaN(n)){if(r===qN&&!isNaN(o)){if(isNaN(s)||isNaN(o))return-1;s/=o}}else s=s/n*100}return this._getBreakIndexfromInfos(s)}_getBreakIndexfromInfos(t){const e=this.isMaxInclusive;if(t!=null&&typeof t=="number"&&!isNaN(t))for(let i=0;i<this.classBreakInfos.length;i++){const r=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(r[0]<=t&&(e?t<=r[1]:t<r[1]))return i}return-1}_areClassBreaksConsecutive(){const t=this.classBreakInfos,e=t.length;for(let i=1;i<e;i++)if(t[i-1].maxValue!==t[i].minValue)return!1;return!0}};u([d(dwe)],Qn.prototype,"backgroundFillSymbol",void 0),u([d({type:[t5]})],Qn.prototype,"classBreakInfos",void 0),u([Qe("classBreakInfos")],Qn.prototype,"readClassBreakInfos",null),u([lt("classBreakInfos")],Qn.prototype,"writeClassBreakInfos",null),u([d({type:String,json:{write:!0}})],Qn.prototype,"defaultLabel",void 0),u([d(cA)],Qn.prototype,"defaultSymbol",void 0),u([d({type:String,json:{write:!0}})],Qn.prototype,"field",void 0),u([wi("field")],Qn.prototype,"castField",null),u([d({type:Boolean})],Qn.prototype,"isMaxInclusive",void 0),u([d({type:TE,json:{write:!0}})],Qn.prototype,"legendOptions",void 0),u([d({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],Qn.prototype,"minValue",null),u([d({type:String,json:{write:!0}})],Qn.prototype,"normalizationField",void 0),u([d({type:Number,cast:t=>Hh(t),json:{write:!0}})],Qn.prototype,"normalizationTotal",void 0),u([d({type:I$.apiValues,value:null,json:{type:I$.jsonValues,read:I$.read,write:I$.write}})],Qn.prototype,"normalizationType",null),u([At({classBreaks:"class-breaks"})],Qn.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Qn.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],Qn.prototype,"valueExpressionTitle",void 0),Qn=fH=u([I("esri.renderers.ClassBreaksRenderer")],Qn);const fwe=Qn;let bqe=class{constructor(e,i){this._storage=new HJ,this._storage.maxSize=e,i&&this._storage.registerRemoveFunc("",i)}put(e,i,r){this._storage.put(e,i,r,1)}pop(e){return this._storage.pop(e)}get(e){return this._storage.get(e)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}};const ene="esri.renderers.support.DictionaryLoader",wqe={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};let aK=class{constructor(e,i,r){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new bqe(100),this._dictionaryPromise=null,this.url=e,this.config=i,this.fieldMap=r}getSymbolFields(){return this._symbolFields}async getSymbolAsync(e,i){let r;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(i));try{r=await this._dictionaryPromise}catch(m){if(ln(m))return this._dictionaryPromise=null,null}const s={};if(this.fieldMap)for(const m of this._symbolFields){const y=this.fieldMap[m];if(y&&e.attributes[y]!=null){const _=""+e.attributes[y];s[m]=_}else s[m]=""}const n=r==null?void 0:r(s,i);if(!n||typeof n!="string")return null;const o=DY(n).toString(),a=this._symbolCache.get(o);if(a)return a.catch(()=>{this._symbolCache.pop(o)}),a;const l=n.split(";"),c=[],h=[];for(const m of l)if(m)if(m.includes("po:")){const y=m.substr(3).split("|");if(y.length===3){const _=y[0],b=y[1];let w=y[2];if(b==="DashTemplate")w=w.split(" ").map(S=>Number(S));else if(b==="Color"){const S=new ot(w).toRgba();w=[S[0],S[1],S[2],255*S[3]]}else w=Number(w);h.push({primitiveName:_,propertyName:b,value:w})}}else if(m.includes("|")){for(const y of m.split("|"))if(this._itemNames.has(y)){c.push(y);break}}else this._itemNames.has(m)&&c.push(m);const p=!v(e.geometry)||!e.geometry.hasZ&&e.geometry.type==="point",f=this._cimPartsToCIMSymbol(c,h,p,i);return this._symbolCache.put(o,f,1),f}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void oe.getLogger(ene).error("no valid URL!");const i=zr(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:v(e)?e.signal:null}),[{data:r}]=await Promise.all([i,Um()]);if(!r)throw this._dictionaryPromise=null,new W("esri.renderers.DictionaryRenderer","Bad dictionary data!");const s=r.expression,n=r.authoringInfo;this._refSymbolUrlTemplate=this.url+"/"+r.cimRefTemplateUrl,this._itemNames=new Set(r.itemsNames),this._symbolFields=n.symbol;const o={};if(this.config){const c=this.config;for(const h in c)o[h]=c[h]}if(n.configuration)for(const c of n.configuration)o.hasOwnProperty(c.name)||(o[c.name]=c.value);const a=[];if(v(e)&&e.fields&&this.fieldMap)for(const c of this._symbolFields){const h=this.fieldMap[c],p=e.fields.filter(f=>f.name===h);p.length>0&&a.push({...p[0],name:c})}const l=o5e(s,v(e)?e.spatialReference:null,a,o).then(c=>{const h={scale:0};return(p,f)=>{if(C(c))return null;const m=c.repurposeFeature({geometry:null,attributes:p});return h.scale=v(f)?f.scale??void 0:void 0,c.evaluate({$feature:m,$view:h})}}).catch(c=>(oe.getLogger(ene).error("Creating dictinoary expression failed:",c),null));return this._dictionaryPromise=l,l}async _cimPartsToCIMSymbol(e,i,r,s){const n=new Array(e.length);for(let l=0;l<e.length;l++)n[l]=this._getSymbolPart(e[l],s);const o=await Promise.all(n),a=this.fieldMap;if(a)for(const l of o)mwe(l,a);return new JC({data:this._combineSymbolParts(o,i,r)})}async _getSymbolPart(e,i){if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then(n=>n.data);const r=this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,e),s=zr(r,{responseType:"json",query:{f:"json"},...i});this._ongoingRequests.set(e,s);try{return(await s).data}catch(n){throw this._ongoingRequests.delete(e),n}}_combineSymbolParts(e,i,r){if(!e||e.length===0)return null;const s={...e[0]};if(e.length>1){s.symbolLayers=[];for(const n of e){const o=n;s.symbolLayers.unshift(...o.symbolLayers)}}return r&&(s.callout=wqe),{type:"CIMSymbolReference",symbol:s,primitiveOverrides:i}}};function mwe(t,e){if(!t)return;const i=t.symbolLayers;if(!i)return;let r=i.length;for(;r--;){const s=i[r];s&&s.enable!==!1&&s.type==="CIMVectorMarker"&&xqe(s,e)}}function xqe(t,e){const i=t.markerGraphics;if(i)for(const r of i){if(!r)continue;const s=r.symbol;if(s)switch(s.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":mwe(s,e);break;case"CIMTextSymbol":s.fieldMap=e}}}const rIt=Object.freeze(Object.defineProperty({__proto__:null,DictionaryLoader:aK},Symbol.toStringTag,{value:"Module"}));var mH;let ep=mH=class extends lA(a0){constructor(t){super(t),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new aK(this.url,this.config,this.fieldMap)}writeData(t,e){t&&(e.scalingExpressionInfo={expression:t,returnType:"number"})}writeVisualVariables(t,e,i,r){r!=null&&r.origin||super.writeVisualVariables(t,e,i,r)}clone(){return new mH({config:ae(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:ae(this.fieldMap),url:ae(this.url),visualVariables:ae(this.visualVariables)})}async getSymbolAsync(t,e){return this._loader.getSymbolAsync(t,e)}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e),this.scaleExpression&&await cc(t,e,this.scaleExpression);for(const i in this.fieldMap){const r=this.fieldMap[i];e.has(r)&&t.add(r)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};u([d({type:aK})],ep.prototype,"_loader",null),u([d({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],ep.prototype,"config",void 0),u([d({type:Object,json:{write:!0}})],ep.prototype,"fieldMap",void 0),u([d({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],ep.prototype,"scaleExpression",void 0),u([lt("scaleExpression")],ep.prototype,"writeData",null),u([d({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(t){return{enabled:!!t&&!!this.scaleExpression}}}}})],ep.prototype,"scaleExpressionTitle",void 0),u([d({type:String,json:{write:!0}})],ep.prototype,"url",void 0),u([lt("visualVariables")],ep.prototype,"writeVisualVariables",null),ep=mH=u([I("esri.renderers.DictionaryRenderer")],ep);const Tqe=ep;var gH;let zg=gH=class extends Ie{constructor(t){super(t),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(t){return t==null?t:typeof t=="function"?(oe.getLogger(this.declaredClass).error(".field: field must be a string value"),null):qP(t)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new gH({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([d({type:ot,json:{type:[Number],write:!0}})],zg.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],zg.prototype,"field",void 0),u([wi("field")],zg.prototype,"castField",null),u([d({type:String,json:{write:!0}})],zg.prototype,"label",void 0),u([d({type:String,json:{write:!0}})],zg.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],zg.prototype,"valueExpressionTitle",void 0),zg=gH=u([I("esri.renderers.support.AttributeColorInfo")],zg);const gwe=zg;var yH;let WN=yH=class extends Ie{constructor(){super(...arguments),this.unit=null}clone(){return new yH({unit:this.unit})}};u([d({type:String,json:{write:!0}})],WN.prototype,"unit",void 0),WN=yH=u([I("esri.renderers.support.DotDensityLegendOptions")],WN);const Sqe=WN;var _H;let Ac=_H=class extends lA(a0){constructor(t){super(t),this.attributes=null,this.backgroundColor=new ot([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new Ed,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(t){if(this.referenceScale==null)return this.dotValue;const e=t/this.referenceScale*this.dotValue;return e<1?1:e}getSymbol(){return new y1({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){var t;return((t=this.attributes)==null?void 0:t.reduce((e,i)=>e+i.getAttributeHash(),""))??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new _H({attributes:ae(this.attributes),backgroundColor:ae(this.backgroundColor),dotBlendingEnabled:ae(this.dotBlendingEnabled),dotShape:ae(this.dotShape),dotSize:ae(this.dotSize),dotValue:ae(this.dotValue),legendOptions:ae(this.legendOptions),outline:ae(this.outline),referenceScale:ae(this.referenceScale),visualVariables:ae(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){var e;return`${(e=this.attributes)==null?void 0:e.map(i=>i.field||i.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e);for(const i of this.attributes??[])i.valueExpression&&await cc(t,e,i.valueExpression),i.field&&t.add(i.field)}};u([d({type:[gwe],json:{write:!0}})],Ac.prototype,"attributes",void 0),u([d({type:ot,json:{write:!0}})],Ac.prototype,"backgroundColor",void 0),u([d({type:Boolean,json:{write:!0}})],Ac.prototype,"dotBlendingEnabled",void 0),u([d({type:String,json:{write:!1}})],Ac.prototype,"dotShape",void 0),u([d({type:Number,json:{write:!0}})],Ac.prototype,"dotSize",void 0),u([d({type:Sqe,json:{write:!0}})],Ac.prototype,"legendOptions",void 0),u([d({type:Ed,json:{default:null,write:!0}})],Ac.prototype,"outline",void 0),u([d({type:Number,json:{write:!0}})],Ac.prototype,"dotValue",void 0),u([d({type:Number,json:{write:!0}})],Ac.prototype,"referenceScale",void 0),u([d({type:Number,json:{write:!0}})],Ac.prototype,"seed",void 0),u([At({dotDensity:"dot-density"})],Ac.prototype,"type",void 0),Ac=_H=u([I("esri.renderers.DotDensityRenderer")],Ac);const Eqe=Ac;let rS=class extends Cs(Ie){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};u([d({type:String,json:{write:!0}})],rS.prototype,"minLabel",void 0),u([d({type:String,json:{write:!0}})],rS.prototype,"maxLabel",void 0),u([d({type:String,json:{write:!0}})],rS.prototype,"title",void 0),rS=u([I("esri.renderers.support.HeatmapLegendOptions")],rS);const lK=2.4;function Cqe(t){return gd(t*lK)}function Aqe(t){return ko(t)/lK}function Oqe(t,e,i,r){let{color:s,ratio:n}=e,{color:o,ratio:a}=i;a===n&&(a===1?n-=1e-6:a+=1e-6);const l=we((r-n)/(a-n),0,1);z6(t,s.toArray(),o.toArray(),l)}function nIt(t){const i=new Uint8ClampedArray(2048);if(t=t.filter(({ratio:a})=>a>=0&&a<=1).sort((a,l)=>a.ratio-l.ratio).map(({color:a,ratio:l})=>({color:a,ratio:Math.max(l,.001)})),t.length<1)return i;let r=t[0],s=t[0],n=1;const o=fi();for(let a=0;a<512;a++){const l=(a+.5)/512;for(;l>s.ratio&&n<t.length;)r=s,s=t[n++];Oqe(o,r,s,l),i.set(o,4*a)}return i}function oIt(t,e,i,r){const{radius:s,fieldOffset:n,field:o}=e,a=Math.round(ko(s)),l=new Float64Array(i*r);let c,h=Number.NEGATIVE_INFINITY;const p=Pqe(o,n),f=new Set;for(const m of t){const y=m.getCursor();for(;y.next();){const _=y.getObjectId();if(f.has(_))continue;f.add(_);const b=y.readLegacyPointGeometry(),w=128;if(b.x<-w||b.x>=i+w||b.y<-w||b.y>r+w)continue;const S=+p(y),T=Math.max(0,Math.round(b.x)-a),E=Math.max(0,Math.round(b.y)-a),O=Math.min(r,Math.round(b.y)+a),R=Math.min(i,Math.round(b.x)+a);for(let L=E;L<O;L++)for(let P=T;P<R;P++){const F=L*i+P,V=Mqe(b.x-P,b.y-L,a);c=l[F]+=V*S,c>h&&(h=c)}}}return{matrix:l.buffer,max:h}}function aIt(t,e,i,r,s,n){t.canvas.width=t.canvas.height=e,t.clearRect(0,0,e,e);const o=t.getImageData(0,0,e,e);i&&r&&o.data.set(new Uint8ClampedArray(Rqe(e,i,r,s,n))),t.putImageData(o,0,0)}function Rqe(t,e,i,r,s){const n=new Uint32Array(t*t),o="buffer"in e?e:new Float64Array(e),a="buffer"in i?new Uint32Array(i.buffer):new Uint32Array(new Uint8Array(i).buffer),l=a.length/(s-r);for(let c=0;c<o.length;c++){const h=o[c],p=Math.floor((h-r)*l);n[c]=a[we(p,0,a.length-1)]}return n.buffer}function Mqe(t,e,i){const r=Math.sqrt(t**2+e**2)/i;return r>1?0:3/(Math.PI*i**2)*(1-r**2)**2}function lIt(t,e){return typeof t=="function"?t:t?typeof e=="string"?i=>-1*+i[t]:i=>+i[t]+e:()=>1}function Pqe(t,e){return t!=null?typeof e=="string"?i=>-1*+i.readAttribute(t):i=>+i.readAttribute(t)+e:i=>1}var vH;const ywe="esri.renderers.HeatmapRenderer",Iqe=oe.getLogger(ywe);function tne(t){if(t!=null){const{maxDensity:e,minDensity:i,radius:r}=t;if(e!=null||i!=null||r!=null){const{blurRadius:s,maxPixelIntensity:n,minPixelIntensity:o,...a}=t;return a}}return t}let Oo=vH=class extends a0{constructor(t){super(t),this.authoringInfo=null,this.colorStops=[new kM({ratio:0,color:new ot("rgba(255, 140, 0, 0)")}),new kM({ratio:.75,color:new ot("rgba(255, 140, 0, 1)")}),new kM({ratio:.9,color:new ot("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(t){return tne(t)}get blurRadius(){return Aqe(this.radius)}set blurRadius(t){const e=this.maxPixelIntensity,i=this.minPixelIntensity;this._set("radius",Cqe(t)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",e*this._pixelIntensityToDensity),this._set("minDensity",i*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(t){this._set("maxDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(t){this._set("minDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(lK**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(t,e){this._warnedProps[t]||ml(this).getDefaultOrigin()==="user"&&(this._warnedProps[t]=!0,rT(()=>{Zz(Iqe,t,{replacement:`${String(e)} (suggested value: ${this._get(e)})`,version:"4.24"})}))}read(t,e){t=tne(t),super.read(t,e)}getSymbol(){return new _1}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(t,e){const i=this.field,r=this.valueExpression;i&&typeof i=="string"&&await Xu(t,e,i),r&&typeof r=="string"&&await cc(t,e,r)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new vH({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:ae(this.colorStops),field:this.field,legendOptions:ae(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([d({type:rK,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Oo.prototype,"authoringInfo",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Oo.prototype,"blurRadius",null),u([d({type:[kM],json:{write:!0}})],Oo.prototype,"colorStops",void 0),u([d({type:String,json:{write:!0}})],Oo.prototype,"field",void 0),u([d({type:Number,json:{write:{overridePolicy:(t,e,i)=>({enabled:i==null})},origins:{"web-scene":{write:!1}}}})],Oo.prototype,"fieldOffset",void 0),u([d({type:rS,json:{write:!0}})],Oo.prototype,"legendOptions",void 0),u([d({type:Number,json:{write:!0}})],Oo.prototype,"maxDensity",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Oo.prototype,"maxPixelIntensity",null),u([d({type:Number,json:{write:!0}})],Oo.prototype,"minDensity",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Oo.prototype,"minPixelIntensity",null),u([d({type:Number,cast:mr,json:{write:!0}})],Oo.prototype,"radius",void 0),u([d({type:Number,range:{min:0},json:{default:0,write:!0}})],Oo.prototype,"referenceScale",void 0),u([At({heatmap:"heatmap"})],Oo.prototype,"type",void 0),u([d({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],Oo.prototype,"valueExpression",void 0),u([d({type:String})],Oo.prototype,"valueExpressionTitle",void 0),u([d({readOnly:!0})],Oo.prototype,"_pixelIntensityToDensity",null),Oo=vH=u([I(ywe)],Oo);const _we=Oo;let Rw=class extends Cs(Ie){constructor(){super(...arguments),this.color=new ot([0,0,0,0]),this.label=null,this.threshold=0}};u([d({type:ot,json:{write:!0}})],Rw.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],Rw.prototype,"label",void 0),u([d({type:Number,range:{min:0,max:1},json:{write:!0}})],Rw.prototype,"threshold",void 0),Rw=u([I("esri.renderers.support.OthersCategory")],Rw);let XN=class extends Cs(Ie){constructor(){super(...arguments),this.title=null}};u([d({type:String,json:{write:!0}})],XN.prototype,"title",void 0),XN=u([I("esri.renderers.support.PieChartLegendOptions")],XN);let wu=class extends lA(Cs(a0)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new ot([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new Rw,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){var e;return new _1({size:this.size?this.size/2+(((e=this.outline)==null?void 0:e.width)||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(v)}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,i)=>e+i.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,i)=>e+JSON.stringify(i),"")}async collectRequiredFields(e,i){await this.collectVVRequiredFields(e,i);for(const r of this.attributes)r.valueExpression&&await cc(e,i,r.valueExpression),r.field&&e.add(r.field)}};u([d({type:[gwe],json:{write:!0}})],wu.prototype,"attributes",void 0),u([d({type:y1,json:{default:null,write:!0}})],wu.prototype,"backgroundFillSymbol",void 0),u([d({type:ot,json:{write:!0}})],wu.prototype,"defaultColor",void 0),u([d({type:String,json:{write:!0}})],wu.prototype,"defaultLabel",void 0),u([d({type:Number,range:{min:0,max:1},json:{write:!0}})],wu.prototype,"holePercentage",void 0),u([d({type:Rw,json:{write:!0}})],wu.prototype,"othersCategory",void 0),u([d({type:XN,json:{write:!0}})],wu.prototype,"legendOptions",void 0),u([d({type:Ed,json:{default:null,write:!0}})],wu.prototype,"outline",void 0),u([d({type:Number,cast:mr,json:{write:!0}})],wu.prototype,"size",void 0),u([At({pieChart:"pie-chart"})],wu.prototype,"type",void 0),wu=u([I("esri.renderers.PieChartRenderer")],wu);const $qe=wu;var bH;let Gb=bH=class extends lA(a0){constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(t,e){await Promise.all([this.collectSymbolFields(t,e),this.collectVVRequiredFields(t,e)])}async collectSymbolFields(t,e){await Promise.all(this.getSymbols().map(i=>i.collectRequiredFields(t,e)))}getSymbol(t,e){return this.symbol}async getSymbolAsync(t,e){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((t,e)=>t+JSON.stringify(e),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new bH({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:ae(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};u([d({type:String,json:{write:!0}})],Gb.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],Gb.prototype,"label",void 0),u([d(cA)],Gb.prototype,"symbol",void 0),u([At({simple:"simple"})],Gb.prototype,"type",void 0),Gb=bH=u([I("esri.renderers.SimpleRenderer")],Gb);const vC=Gb,Lqe=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function wH(t){return t instanceof $e}function ine(t){return t instanceof Nt?Object.keys(t.items):wH(t)?ml(t).keys():t?Object.keys(t):[]}function $$(t,e){return t instanceof Nt?t.items[e]:t[e]}function Dqe(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.length!==e.length}function GM(t){return t?t.declaredClass:null}function vwe(t,e){const i=t.diff;if(i&&typeof i=="function")return i(t,e);const r=ine(t),s=ine(e);if(r.length===0&&s.length===0)return;if(!r.length||!s.length||Dqe(t,e))return{type:"complete",oldValue:t,newValue:e};const n=s.filter(p=>!r.includes(p)),o=r.filter(p=>!s.includes(p)),a=r.filter(p=>s.includes(p)&&$$(t,p)!==$$(e,p)).concat(n,o).sort(),l=GM(t);if(l&&Lqe.includes(l)&&a.length)return{type:"complete",oldValue:t,newValue:e};let c;const h=wH(t)&&wH(e);for(const p of a){const f=$$(t,p),m=$$(e,p);let y;if((h||typeof f!="function"&&typeof m!="function")&&f!==m&&(f!=null||m!=null)){if(i&&i[p]&&typeof i[p]=="function")y=i[p](f,m);else if(f instanceof Date&&m instanceof Date){if(f.getTime()===m.getTime())continue;y={type:"complete",oldValue:f,newValue:m}}else y=typeof f=="object"&&typeof m=="object"&&GM(f)===GM(m)?vwe(f,m):{type:"complete",oldValue:f,newValue:m};v(y)&&(v(c)?c.diff[p]=y:c={type:"partial",diff:{[p]:y}})}}return c}function Nqe(t,e){if(C(t))return!1;const i=e.split(".");let r=t;for(const s of i){if(r.type==="complete")return!0;if(r.type!=="partial")return!1;{const n=r.diff[s];if(!n)return!1;r=n}}return!0}function dIt(t,e){for(const i of e)if(Nqe(t,i))return!0;return!1}function Fqe(t,e){if(!(typeof t=="function"||typeof e=="function"||C(t)&&C(e)))return C(t)||C(e)||typeof t=="object"&&typeof e=="object"&&GM(t)!==GM(e)?{type:"complete",oldValue:t,newValue:e}:vwe(t,e)}function L$(t){if(C(t))return!0;switch(t.type){case"complete":return!1;case"collection":{const e=t;for(const i of e.added)if(!L$(i))return!1;for(const i of e.removed)if(!L$(i))return!1;for(const i of e.changed)if(!L$(i))return!1;return!0}case"partial":for(const e in t.diff)if(!L$(t.diff[e]))return!1;return!0}}let sS=class extends Cs(Ie){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};u([d(jN)],sS.prototype,"value",void 0),u([d(jN)],sS.prototype,"value2",void 0),u([d(jN)],sS.prototype,"value3",void 0),sS=u([I("esri.renderers.support.UniqueValue")],sS);const SE=sS;let O_=class extends Cs(Ie){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(e==null)return null;const i=typeof(e=Array.isArray(e)?e:[e])[0];return i==="string"||i==="number"?e.map(r=>new SE({value:r})):i==="object"?e[0]instanceof SE?e:e.map(r=>new SE(r)):null}};u([d({type:String,json:{write:!0}})],O_.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],O_.prototype,"label",void 0),u([d(cA)],O_.prototype,"symbol",void 0),u([d({type:[SE],json:{type:[[String]],read:{reader:t=>t?t.map(e=>new SE({value:e[0],value2:e[1],value3:e[2]})):null},write:{writer:(t,e)=>{const i=[];for(const r of t){const s=[r.value,r.value2,r.value3].filter(v).map(n=>n.toString());i.push(s)}e.values=i}}}})],O_.prototype,"values",void 0),u([wi("values")],O_.prototype,"castValues",null),O_=u([I("esri.renderers.support.UniqueValueClass")],O_);const bwe=O_;let ER=class extends Cs(Ie){constructor(e){super(e),this.heading=null,this.classes=null}};u([d({type:String,json:{write:!0}})],ER.prototype,"heading",void 0),u([d({type:[bwe],json:{write:!0}})],ER.prototype,"classes",void 0),ER=u([I("esri.renderers.support.UniqueValueGroup")],ER);const xH=ER;var TH;let jb=TH=class extends Ie{constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new TH({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${t}`}};u([d({type:String,json:{write:!0}})],jb.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],jb.prototype,"label",void 0),u([d(cA)],jb.prototype,"symbol",void 0),u([d(jN)],jb.prototype,"value",void 0),jb=TH=u([I("esri.renderers.support.UniqueValueInfo")],jb);const jM=jb,Uqe=()=>!!de("enable-feature:force-wosr"),gIt=()=>!!de("enable-feature:direct-3d-object-feature-layer-display"),yIt=()=>!!de("enable-feature:SceneLayer-editing");let yk={};async function Vqe(t,e){try{return{data:(await Gqe(t,e)).data,baseUrl:aUe(t),styleUrl:t}}catch(i){return zc(i),null}}function kqe(t,e,i){const r=v(e.portal)?e.portal:uc.getDefault();let s;const n=`${r.url} - ${r.user&&r.user.username} - ${t}`;return yk[n]||(yk[n]=Bqe(t,r,i).then(o=>(s=o,o.fetchData())).then(o=>({data:o,baseUrl:s.itemUrl??"",styleName:t}))),yk[n]}function Bqe(t,e,i){return e.load(i).then(()=>{const r=new my({disableExtraQuery:!0,query:`owner:${rne} AND type:${sne} AND typekeywords:"${t}"`});return e.queryItems(r,i)}).then(({results:r})=>{var o;let s=null;const n=t.toLowerCase();if(r&&Array.isArray(r)){for(const a of r)if(((o=a.typeKeywords)==null?void 0:o.some(c=>c.toLowerCase()===n))&&a.type===sne&&a.owner===rne){s=a;break}}if(!s)throw new W("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return s.load(i)})}function zqe(t,e,i){return t&&v(t.styleUrl)?Vqe(t.styleUrl,i):t&&v(t.styleName)?kqe(t.styleName,e,i):Promise.reject(new W("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function _It(t){return t===null||t.type==="CIMSymbolReference"?t:{type:"CIMSymbolReference",symbol:t}}function vIt(t,e){if(e==="cimRef")return t.cimRef;if(t.formatInfos&&!Uqe()){for(const i of t.formatInfos)if(i.type==="gltf")return i.href}return t.webRef}function Gqe(t,e){const i={responseType:"json",query:{f:"json"},...e};return zr(zp(t),i)}const rne="esri_en",sne="Style",bIt="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";var CR;const wwe="esri.renderers.UniqueValueRenderer",L0=oe.getLogger(wwe),nne="uvInfos-watcher",one="uvGroups-watcher",jqe=",",Hqe=mn(jM);function qqe(t){const{field1:e,field2:i,field3:r,fieldDelimiter:s,uniqueValueInfos:n,valueExpression:o}=t,a=!(!e||!i);return[{classes:(n??[]).map(l=>{var w;const{symbol:c,label:h,value:p,description:f}=l,[m,y,_]=a?((w=p==null?void 0:p.toString())==null?void 0:w.split(s||""))||[]:[p],b=[];return(e||o)&&b.push(m),i&&b.push(y),r&&b.push(_),{symbol:c,label:h,values:[b],description:f}})}]}let Hs=CR=class extends lA(a0){constructor(t){super(t),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,i){if(!e&&!i)return;if(!e||!i)return{type:"complete",oldValue:e,newValue:i};let r=!1;const s={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<i.length;n++){const o=e.find(a=>a.value===i[n].value);o?Fqe(o,i[n])?(s.changed.push({type:"complete",oldValue:o,newValue:i[n]}),r=!0):s.unchanged.push({oldValue:o,newValue:i[n]}):(s.added.push(i[n]),r=!0)}for(let n=0;n<e.length;n++)i.find(o=>o.value===e[n].value)||(s.removed.push(e[n]),r=!0);return r?s:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(t){this._set("field",t),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(t){return t==null||typeof t=="function"?t:qP(t)}writeField(t,e,i,r){typeof t=="string"?e[i]=t:r&&r.messages?r.messages.push(new W("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):L0.error(".field: cannot write field to JSON since it's not a string value")}set field2(t){this._set("field2",t),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(t){this._set("field3",t),this._updateUniqueValues()}set valueExpression(t){this._set("valueExpression",t),this._updateUniqueValues()}set defaultSymbol(t){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",t)}set fieldDelimiter(t){this._set("fieldDelimiter",t),this._updateUniqueValues()}readPortal(t,e,i){return i.portal||uc.getDefault()}readStyleOrigin(t,e,i){if(e.styleName)return Object.freeze({styleName:e.styleName});if(e.styleUrl){const r=QC(e.styleUrl,i);return Object.freeze({styleUrl:r})}}writeStyleOrigin(t,e,i,r){t.styleName?e.styleName=t.styleName:t.styleUrl&&(e.styleUrl=Ox(t.styleUrl,r))}set uniqueValueGroups(t){this.styleOrigin?L0.error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",t),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(t){this.styleOrigin?L0.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(t,e){var r;if(this.styleOrigin)return void L0.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let i;i=typeof t=="object"?Hqe(t):new jM({value:t,symbol:Y0e(e)}),(r=this.uniqueValueInfos)==null||r.push(i),this._valueInfoMap[i.value]=i,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(t){if(this.styleOrigin)return void L0.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const e=this.uniqueValueInfos;if(e){for(let i=0;i<e.length;i++)if(e[i].value===t+""){delete this._valueInfoMap[t],e.splice(i,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(t,e){let i=e;return this.valueExpression&&(C(e)||C(e.arcade))&&(i={...i,arcade:await Um()}),this._getUniqueValueInfo(t,i)}getSymbol(t,e){if(this.valueExpression&&(C(e)||C(e.arcade)))return void L0.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this._getUniqueValueInfo(t,e);return i&&i.symbol||this.defaultSymbol}async getSymbolAsync(t,e){let i=e;if(this.valueExpression&&(C(i)||C(i.arcade))){const s=await Um(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i={...i,arcade:s}}const r=this._getUniqueValueInfo(t,i);return r&&r.symbol||this.defaultSymbol}getSymbols(){const t=[];for(const e of this.uniqueValueInfos??[])e.symbol&&t.push(e.symbol);return this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){var r;const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),i=(r=this.uniqueValueInfos)==null?void 0:r.reduce((s,n)=>s+n.getMeshHash(),"");return`${t}.${e}.${i}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const t=new CR({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:ae(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:ae(this.visualVariables),legendOptions:ae(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:ae(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(t._isDefaultSymbolDerived=!0),t._set("portal",this.portal);const e=ae(this.uniqueValueInfos),i=ae(this.uniqueValueGroups);return this.styleOrigin&&(t._set("styleOrigin",Object.freeze(ae(this.styleOrigin))),Object.freeze(e),Object.freeze(i)),t._set("uniqueValueInfos",e),t._updateValueInfoMap(),t._set("uniqueValueGroups",i),t._isInfosSource=this._isInfosSource,t._watchUniqueValueInfosAndGroups(),t}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(t,e){const i=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(i)}async collectSymbolFields(t,e){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(t,e)),cc(t,e,this.valueExpression)];Xu(t,e,this.field),Xu(t,e,this.field2),Xu(t,e,this.field3),await Promise.all(i)}populateFromStyle(){return zqe(this.styleOrigin,{portal:this.portal}).then(t=>{var i;const e=[];return this._valueInfoMap={},t&&t.data&&Array.isArray(t.data.items)&&t.data.items.forEach(r=>{const s=new cT({styleUrl:t.styleUrl,styleName:t.styleName,portal:this.portal,name:r.name});this.defaultSymbol||r.name!==t.data.defaultItem||(this.defaultSymbol=s,this._isDefaultSymbolDerived=!0);const n=new jM({value:r.name,symbol:s});e.push(n),this._valueInfoMap[r.name]=n}),this._set("uniqueValueInfos",Object.freeze(e)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&((i=this.uniqueValueInfos)!=null&&i.length)&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",jqe)}_updateUniqueValues(){this._isInfosSource!=null&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:t}=this;if(t)for(const e of t)this._valueInfoMap[e.value+""]=e}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(nne);const{uniqueValueInfos:t}=this;if(t){const e=[];for(const i of t)e.push(re(()=>({symbol:i.symbol,value:i.value,label:i.label,description:i.description}),(r,s)=>{r!==s&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(e,nne)}}_watchUniqueValueGroups(){this.removeHandles(one);const{uniqueValueGroups:t}=this;if(t){const e=[];for(const i of t){e.push(re(()=>({classes:i.classes}),(r,s)=>{r!==s&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(const r of i.classes??[])e.push(re(()=>({symbol:r.symbol,values:r.values,label:r.label,description:r.description}),(s,n)=>{s!==n&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(e,one)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const t=[],{field:e,field2:i,field3:r,fieldDelimiter:s,uniqueValueGroups:n,valueExpression:o}=this;if(!e&&!o)return this._set("uniqueValueInfos",t),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!e||!i);for(const l of n)for(const c of l.classes??[]){const{symbol:h,label:p,values:f,description:m}=c;for(const y of f??[]){const{value:_,value2:b,value3:w}=y,S=[_];i&&S.push(b),r&&S.push(w);const T=a?S.join(s||""):S[0];t.push(new jM({symbol:h,label:p,value:T,description:m}))}}this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(t=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:e,field2:i,valueExpression:r,fieldDelimiter:s,uniqueValueInfos:n}=this;if(!e&&!r||!n.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const o=!(!e||!i),a=n.map(c=>{var w;const{symbol:h,label:p,value:f,description:m}=c,[y,_,b]=o?((w=f==null?void 0:f.toString())==null?void 0:w.split(s||""))||[]:[f];return new bwe({symbol:h,label:p,description:m,values:[new SE({value:y,value2:_,value3:b})]})}),l=[new xH({classes:a})];t&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(t,e){return this.valueExpression?this._getUnqiueValueInfoForExpression(t,e):this._getUnqiueValueInfoForFields(t)}_getUnqiueValueInfoForExpression(t,e){const{viewingMode:i,scale:r,spatialReference:s,arcade:n}=Gt(e,{});let o=this._cache.compiledFunc;const a=n.arcadeUtils;if(!o){const c=a.createSyntaxTree(this.valueExpression);o=a.createFunction(c),this._cache.compiledFunc=o}const l=a.executeFunction(o,a.createExecContext(t,a.getViewInfo({viewingMode:i,scale:r,spatialReference:s})));return this._valueInfoMap[l+""]}_getUnqiueValueInfoForFields(t){const e=this.field,i=t.attributes;let r;if(typeof e!="function"&&this.field2){const s=this.field2,n=this.field3,o=[];e&&o.push(i[e]),s&&o.push(i[s]),n&&o.push(i[n]),r=o.join(this.fieldDelimiter||"")}else typeof e=="function"?r=e(t):e&&(r=i[e]);return this._valueInfoMap[r+""]}static fromPortalStyle(t,e){const i=new CR(e&&e.properties);i._set("styleOrigin",Object.freeze({styleName:t})),i._set("portal",e&&e.portal||uc.getDefault());const r=i.populateFromStyle();return r.catch(s=>{L0.error(`#fromPortalStyle('${t}'[, ...])`,"Failed to create unique value renderer from style name",s)}),r}static fromStyleUrl(t,e){const i=new CR(e&&e.properties);i._set("styleOrigin",Object.freeze({styleUrl:t}));const r=i.populateFromStyle();return r.catch(s=>{L0.error(`#fromStyleUrl('${t}'[, ...])`,"Failed to create unique value renderer from style URL",s)}),r}};u([d({readOnly:!0})],Hs.prototype,"_cache",null),u([At({uniqueValue:"unique-value"})],Hs.prototype,"type",void 0),u([d(dwe)],Hs.prototype,"backgroundFillSymbol",void 0),u([d({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],Hs.prototype,"field",null),u([wi("field")],Hs.prototype,"castField",null),u([lt("field")],Hs.prototype,"writeField",null),u([d({type:String,value:null,json:{write:!0}})],Hs.prototype,"field2",null),u([d({type:String,value:null,json:{write:!0}})],Hs.prototype,"field3",null),u([d({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],Hs.prototype,"orderByClassesEnabled",void 0),u([d({type:String,value:null,json:{write:!0}})],Hs.prototype,"valueExpression",null),u([d({type:String,json:{write:!0}})],Hs.prototype,"valueExpressionTitle",void 0),u([d({type:TE,json:{write:!0}})],Hs.prototype,"legendOptions",void 0),u([d({type:String,json:{write:!0}})],Hs.prototype,"defaultLabel",void 0),u([d(mme({...cA},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],Hs.prototype,"defaultSymbol",null),u([d({type:String,value:null,json:{write:!0}})],Hs.prototype,"fieldDelimiter",null),u([d({type:uc,readOnly:!0})],Hs.prototype,"portal",void 0),u([Qe("portal",["styleName"])],Hs.prototype,"readPortal",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],Hs.prototype,"styleOrigin",void 0),u([Qe("styleOrigin",["styleName","styleUrl"])],Hs.prototype,"readStyleOrigin",null),u([lt("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],Hs.prototype,"writeStyleOrigin",null),u([d({type:[xH],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(t,e,i)=>(e.uniqueValueGroups||qqe(e)).map(r=>xH.fromJSON(r,i))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],Hs.prototype,"uniqueValueGroups",null),u([d({type:[jM],json:{read:!1,write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],Hs.prototype,"uniqueValueInfos",null),Hs=CR=u([I(wwe)],Hs);const mI=Hs,zU={key:"type",base:a0,typeMap:{heatmap:_we,simple:vC,"unique-value":mI,"class-breaks":fwe,"dot-density":Eqe,dictionary:Tqe,"pie-chart":$qe},errorContext:"renderer"},Wqe={key:"type",base:a0,typeMap:{simple:vC,"unique-value":mI,"class-breaks":fwe,heatmap:_we},errorContext:"renderer"};function wIt(t,e){return Q3(t,null,e)}const Xqe=f1({types:zU});function Q3(t,e,i){return t?t&&(t.styleName||t.styleUrl)&&t.type!=="uniqueValue"?(i&&i.messages&&i.messages.push(new dd("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+t.type+"'",{definition:t,context:i})),null):Xqe(t,e,i):null}let Yqe=class xwe{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(Xz),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const i=new xwe,r=this._originStores[Xi.DEFAULTS];r&&r.forEach((s,n)=>{i.set(n,ae(s),Xi.DEFAULTS)});for(let s=Xi.SERVICE;s<Xz;s++){const n=this._originStores[s];n&&n.forEach((o,a)=>{e&&e.has(a)||i.set(a,ae(o),s)})}return i}get(e,i){const r=i===void 0?this._values:this._originStores[i];return r?r.get(e):void 0}keys(e){const i=e==null?this._values:this._originStores[e];return i?[...i.keys()]:[]}set(e,i,r=Xi.USER){let s=this._originStores[r];if(s||(s=new Map,this._originStores[r]=s),s.set(e,i),!this._values.has(e)||this._propertyOriginMap.get(e)<=r){const n=this._values.get(e);return this._values.set(e,i),this._propertyOriginMap.set(e,r),n!==i}return!1}delete(e,i=Xi.USER){const r=this._originStores[i];if(!r)return;const s=r.get(e);if(r.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===i){this._values.delete(e);for(let n=i-1;n>=0;n--){const o=this._originStores[n];if(o&&o.has(e)){this._values.set(e,o.get(e)),this._propertyOriginMap.set(e,n);break}}}return s}has(e,i){const r=i===void 0?this._values:this._originStores[i];return!!r&&r.has(e)}revert(e,i){for(;i>0&&!this.has(e,i);)--i;const r=this._originStores[i],s=r&&r.get(e),n=this._values.get(e);return this._values.set(e,s),this._propertyOriginMap.set(e,i),n!==s}originOf(e){return this._propertyOriginMap.get(e)||Xi.DEFAULTS}forEach(e){this._values.forEach(e)}};const Twe=t=>{let e=class extends t{constructor(...i){super(...i);const r=ml(this),s=r.store,n=new Yqe;r.store=n,wge(r,s,n)}read(i,r){Tge(this,i,r)}getAtOrigin(i,r){const s=_k(this),n=pv(r);if(typeof i=="string")return s.get(i,n);const o={};return i.forEach(a=>{o[a]=s.get(a,n)}),o}originOf(i){return s4(this.originIdOf(i))}originIdOf(i){return _k(this).originOf(i)}revert(i,r){const s=_k(this),n=pv(r),o=ml(this);let a;a=typeof i=="string"?i==="*"?s.keys(n):[i]:i,a.forEach(l=>{o.invalidate(l),s.revert(l,n),o.commit(l)})}};return e=u([I("esri.core.ReadOnlyMultiOriginJSONSupport")],e),e};function _k(t){return ml(t).store}let ane=class extends Twe($e){};ane=u([I("esri.core.ReadOnlyMultiOriginJSONSupport")],ane);const Zqe=t=>{let e=class extends t{constructor(...i){super(...i)}clear(i,r="user"){return vk(this).delete(i,pv(r))}write(i={},r){return Ege(this,i=i||{},r),i}setAtOrigin(i,r,s){ml(this).setAtOrigin(i,r,pv(s))}removeOrigin(i){const r=vk(this),s=pv(i),n=r.keys(s);for(const o of n)r.originOf(o)===s&&r.set(o,r.get(o,s),Xi.USER)}updateOrigin(i,r){const s=vk(this),n=pv(r),o=this.get(i);for(let a=n+1;a<Xz;++a)s.delete(i,a);s.set(i,o,n)}toJSON(i){return this.write({},i)}};return e=u([I("esri.core.WriteableMultiOriginJSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function vk(t){return ml(t).store}const Swe=t=>{let e=class extends Zqe(Twe(t)){constructor(...i){super(...i)}};return e=u([I("esri.core.MultiOriginJSONSupport")],e),e};let lne=class extends Swe($e){};lne=u([I("esri.core.MultiOriginJSONSupport")],lne);async function Jqe(t,e){const{WhereClause:i}=await ee(()=>import("./WhereClause-d3d68e94.js").then(r=>r.W),["./WhereClause-d3d68e94.js","./executionError-fb3f283a.js"],import.meta.url);return i.create(t,e)}function Kqe(t,e){return v(t)?v(e)?`(${t}) AND (${e})`:t:e}var SH;let Hb=SH=class extends Ie{constructor(t){super(t),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new SH({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],Hb.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],Hb.prototype,"name",void 0),u([d({type:["boolean","date","number","string"],json:{write:!0}})],Hb.prototype,"returnType",void 0),u([d({type:String,json:{write:!0}})],Hb.prototype,"title",void 0),Hb=SH=u([I("esri.form.ExpressionInfo")],Hb);const Qqe=Hb;let qb=class extends Ie{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};u([d({type:String,json:{write:!0}})],qb.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],qb.prototype,"label",void 0),u([d()],qb.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],qb.prototype,"visibilityExpression",void 0),qb=u([I("esri.form.elements.Element")],qb);const bC=qb;var EH;let YN=EH=class extends Ie{constructor(t){super(t),this.type=null}clone(){return new EH({type:this.type})}};u([d({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],YN.prototype,"type",void 0),YN=EH=u([I("esri.form.elements.inputs.AttachmentInput")],YN);const eWe=YN;var CH;let Wb=CH=class extends bC{constructor(t){super(t),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new CH({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({type:String,json:{write:!0}})],Wb.prototype,"attachmentKeyword",void 0),u([d({type:Boolean,json:{write:!0}})],Wb.prototype,"editable",void 0),u([d({type:eWe,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Wb.prototype,"input",void 0),u([d({type:["attachment"],json:{read:!1,write:!0}})],Wb.prototype,"type",void 0),Wb=CH=u([I("esri.form.elements.AttachmentElement")],Wb);const cne=Wb;let ZN=class extends Ie{constructor(e){super(e),this.type=null}};u([d()],ZN.prototype,"type",void 0),ZN=u([I("esri.form.elements.inputs.Input")],ZN);const uA=ZN;let AR=class extends uA{constructor(e){super(e),this.maxLength=null,this.minLength=0}};u([d({type:Number,json:{write:!0}})],AR.prototype,"maxLength",void 0),u([d({type:Number,json:{write:!0}})],AR.prototype,"minLength",void 0),AR=u([I("esri.form.elements.inputs.TextInput")],AR);const cK=AR;var AH;let JN=AH=class extends cK{constructor(t){super(t),this.type="barcode-scanner"}clone(){return new AH({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["barcode-scanner"],json:{read:!1,write:!0}})],JN.prototype,"type",void 0),JN=AH=u([I("esri.form.elements.inputs.BarcodeScannerInput")],JN);const tWe=JN;var OH;let nS=OH=class extends uA{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="combo-box"}clone(){return new OH({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};u([d({type:String,json:{write:!0}})],nS.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],nS.prototype,"showNoValueOption",void 0),u([d({type:["combo-box"],json:{read:!1,write:!0}})],nS.prototype,"type",void 0),nS=OH=u([I("esri.form.elements.inputs.ComboBoxInput")],nS);const iWe=nS;var RH;function une(t){return t!=null?new Date(t):null}function hne(t){return t?t.getTime():null}let tp=RH=class extends uA{constructor(t){super(t),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(t,e){return une(e.max)}writeMax(t,e){e.max=hne(t)}readMin(t,e){return une(e.min)}writeMin(t,e){e.min=hne(t)}clone(){return new RH({includeTime:this.includeTime,max:this.max,min:this.min})}};u([d({type:Boolean,json:{write:!0}})],tp.prototype,"includeTime",void 0),u([d({type:Date,json:{type:Number,write:!0}})],tp.prototype,"max",void 0),u([Qe("max")],tp.prototype,"readMax",null),u([lt("max")],tp.prototype,"writeMax",null),u([d({type:Date,json:{type:Number,write:!0}})],tp.prototype,"min",void 0),u([Qe("min")],tp.prototype,"readMin",null),u([lt("min")],tp.prototype,"writeMin",null),u([d({type:["datetime-picker"],json:{read:!1,write:!0}})],tp.prototype,"type",void 0),tp=RH=u([I("esri.form.elements.inputs.DateTimePickerInput")],tp);const rWe=tp;var MH;let oS=MH=class extends uA{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="radio-buttons"}clone(){return new MH({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};u([d({type:String,json:{write:!0}})],oS.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],oS.prototype,"showNoValueOption",void 0),u([d({type:["radio-buttons"],json:{read:!1,write:!0}})],oS.prototype,"type",void 0),oS=MH=u([I("esri.form.elements.inputs.RadioButtonsInput")],oS);const sWe=oS;var PH;let aS=PH=class extends uA{constructor(t){super(t),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new PH({offValue:this.offValue,onValue:this.onValue})}};u([d({type:[String,Number],json:{write:!0}})],aS.prototype,"offValue",void 0),u([d({type:[String,Number],json:{write:!0}})],aS.prototype,"onValue",void 0),u([d({type:["switch"],json:{read:!1,write:!0}})],aS.prototype,"type",void 0),aS=PH=u([I("esri.form.elements.inputs.SwitchInput")],aS);const nWe=aS;var IH;let KN=IH=class extends cK{constructor(t){super(t),this.type="text-area"}clone(){return new IH({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-area"],json:{read:!1,write:!0}})],KN.prototype,"type",void 0),KN=IH=u([I("esri.form.elements.inputs.TextAreaInput")],KN);const oWe=KN;var $H;let QN=$H=class extends cK{constructor(t){super(t),this.type="text-box"}clone(){return new $H({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-box"],json:{read:!1,write:!0}})],QN.prototype,"type",void 0),QN=$H=u([I("esri.form.elements.inputs.TextBoxInput")],QN);const aWe=QN,lWe={base:uA,key:"type",typeMap:{"barcode-scanner":tWe,"combo-box":iWe,"datetime-picker":rWe,"radio-buttons":sWe,switch:nWe,"text-area":oWe,"text-box":aWe}};var LH;const Ewe="esri.form.elements.FieldElement",dne=oe.getLogger(Ewe);let Ch=LH=class extends bC{constructor(t){super(t),this.domain=null,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}get editable(){return Zz(dne,"editable",{replacement:"editableExpression",version:"4.26",warnOnce:!0}),this._get("editable")??!0}set editable(t){Zz(dne,"editable",{replacement:"editableExpression",version:"4.26",warnOnce:!0}),this._set("editable",t)}clone(){return new LH({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};u([d({types:Cbe,json:{read:{reader:qJ},write:!0}})],Ch.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],Ch.prototype,"editable",null),u([d({type:String,json:{write:!0}})],Ch.prototype,"editableExpression",void 0),u([d({type:String,json:{write:!0}})],Ch.prototype,"fieldName",void 0),u([d({type:String,json:{write:!0}})],Ch.prototype,"hint",void 0),u([d({types:lWe,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Ch.prototype,"input",void 0),u([d({type:String,json:{write:!0}})],Ch.prototype,"requiredExpression",void 0),u([d({type:String,json:{read:!1,write:!0}})],Ch.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Ch.prototype,"valueExpression",void 0),Ch=LH=u([I(Ewe)],Ch);const pne=Ch;var DH;let Gg=DH=class extends bC{constructor(t){super(t),this.displayCount=null,this.displayType="list",this.editable=!0,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new DH({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editable:this.editable,label:this.label,orderByFields:ae(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};u([d({type:Number,json:{write:!0}})],Gg.prototype,"displayCount",void 0),u([d({type:["list"],json:{write:!0}})],Gg.prototype,"displayType",void 0),u([d({type:Boolean,json:{write:!0}})],Gg.prototype,"editable",void 0),u([d({type:[TZ],json:{write:!0}})],Gg.prototype,"orderByFields",void 0),u([d({type:Number,json:{write:!0}})],Gg.prototype,"relationshipId",void 0),u([d({type:["relationship"],json:{read:!1,write:!0}})],Gg.prototype,"type",void 0),Gg=DH=u([I("esri.form.elements.RelationshipElement")],Gg);const fne=Gg;function Cwe(t){return{typesWithGroup:{base:bC,key:"type",typeMap:{attachment:cne,field:pne,group:t,relationship:fne}},typesWithoutGroup:{base:bC,key:"type",typeMap:{attachment:cne,field:pne,relationship:fne}}}}function Awe(t,e,i=!0){if(!t)return null;const r=i?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>r[s.type]).map(s=>r[s.type].fromJSON(s))}function Owe(t,e,i=!0){if(!t)return null;const r=i?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>r[s.type]).map(s=>s.toJSON())}function Rwe(t,e,i=!0){return t?t.map(r=>Xp(i?e.typesWithGroup:e.typesWithoutGroup,r)):null}var NH;let sm=NH=class extends bC{constructor(t){super(t),this.elements=null,this.initialState="expanded",this.type="group"}castElements(t){return Rwe(t,bk,!1)}readElements(t,e){return Awe(e.formElements,bk,!1)}writeElements(t,e){e.formElements=Owe(t,bk,!1)}clone(){return new NH({description:this.description,elements:ae(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({json:{write:!0}})],sm.prototype,"elements",void 0),u([wi("elements")],sm.prototype,"castElements",null),u([Qe("elements",["formElements"])],sm.prototype,"readElements",null),u([lt("elements")],sm.prototype,"writeElements",null),u([d({type:["collapsed","expanded"],json:{write:!0}})],sm.prototype,"initialState",void 0),u([d({type:String,json:{read:!1,write:!0}})],sm.prototype,"type",void 0),sm=NH=u([I("esri.form.elements.GroupElement")],sm);const bk=Cwe(sm),cWe=sm;var FH;const wk=Cwe(cWe);let ip=FH=class extends Ie{constructor(t){super(t),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(t){return Rwe(t,wk)}readElements(t,e){return Awe(e.formElements,wk)}writeElements(t,e){e.formElements=Owe(t,wk)}clone(){return new FH({description:this.description,expressionInfos:ae(this.expressionInfos),elements:ae(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}};u([d({type:String,json:{write:!0}})],ip.prototype,"description",void 0),u([d({json:{write:!0}})],ip.prototype,"elements",void 0),u([wi("elements")],ip.prototype,"castElements",null),u([Qe("elements",["formElements"])],ip.prototype,"readElements",null),u([lt("elements")],ip.prototype,"writeElements",null),u([d({type:[Qqe],json:{write:!0}})],ip.prototype,"expressionInfos",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],ip.prototype,"preserveFieldValuesWhenHidden",void 0),u([d({type:String,json:{write:!0}})],ip.prototype,"title",void 0),ip=FH=u([I("esri.form.FormTemplate")],ip);const uWe=ip;async function hWe(t){const e="portalItem"in t?t:{portalItem:t},i=await ee(()=>import("./portalLayers-8237783e.js"),["./portalLayers-8237783e.js","./lazyLayerLoader-528f9864.js","./layersLoader-d22a3cce.js","./fetchService-590f6092.js","./jsonContext-ab2114a6.js"],import.meta.url);try{return await i.fromItem(e)}catch(r){const s=e&&e.portalItem,n=s&&s.id||"unset",o=s&&s.portal&&s.portal.url||ar.portalUrl;throw oe.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+n+"')",r),r}}let dWe=0,Ro=class extends As.EventedMixin(KP(Hy)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new Pi(-180,-90,180,90,mt.WGS84),this.id=Date.now().toString(16)+"-layer-"+dWe++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=mt.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const i=typeof e=="string"?{url:e}:e;return(await ee(()=>import("./arcgisLayers-24400eaa.js"),["./arcgisLayers-24400eaa.js","./fetchService-590f6092.js","./lazyLayerLoader-528f9864.js"],import.meta.url)).fromUrl(i)}static fromPortalItem(e){return hWe(e)}initialize(){this.when().catch(e=>{ln(e)||oe.getLogger(this.declaredClass).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){if(this.parent){const e=this,i=this.parent;"layers"in i&&i.layers.includes(e)?i.layers.remove(e):"tables"in i&&i.tables.includes(e)?i.tables.remove(e):"baseLayers"in i&&i.baseLayers.includes(e)?i.baseLayers.remove(e):"baseLayers"in i&&i.referenceLayers.includes(e)&&i.referenceLayers.remove(e)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return vl(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await zr(e,{query:{f:"json"},responseType:"json"})).data;throw new W("layer:no-attribution-data","Layer does not have attribution data")}};u([d({type:String})],Ro.prototype,"attributionDataUrl",void 0),u([d({type:Pi})],Ro.prototype,"fullExtent",void 0),u([d({readOnly:!0})],Ro.prototype,"hasAttributionData",null),u([d({type:String,clonable:!1})],Ro.prototype,"id",void 0),u([d({type:Boolean,nonNullable:!0})],Ro.prototype,"legendEnabled",void 0),u([d({type:["show","hide","hide-children"]})],Ro.prototype,"listMode",void 0),u([d({type:Number,range:{min:0,max:1},nonNullable:!0})],Ro.prototype,"opacity",void 0),u([d({clonable:!1})],Ro.prototype,"parent",void 0),u([d({readOnly:!0})],Ro.prototype,"parsedUrl",null),u([d({type:Boolean})],Ro.prototype,"popupEnabled",void 0),u([d({type:Boolean})],Ro.prototype,"attributionVisible",void 0),u([d({type:mt})],Ro.prototype,"spatialReference",void 0),u([d({type:String})],Ro.prototype,"title",void 0),u([d({readOnly:!0,json:{read:!1}})],Ro.prototype,"type",void 0),u([d()],Ro.prototype,"url",void 0),u([d({type:Boolean,nonNullable:!0})],Ro.prototype,"visible",void 0),Ro=u([I("esri.layers.Layer")],Ro);const i5=Ro;function mne(t,e,i){if(t.hasM==null||t.hasZ)for(const r of e)for(const s of r)s.length>2&&(s[2]*=i)}function pWe(t,e,i){if(!t&&!e||!i)return;const r=wx(i);gne(t,i,r),gne(e,i,r)}function gne(t,e,i){if(t)for(const r of t)fWe(r.geometry,e,i)}function fWe(t,e,i){if(C(t)||!t.spatialReference||rn(t.spatialReference,e))return;const r=wx(t.spatialReference)/i;if(r!==1){if("x"in t)t.z!=null&&(t.z*=r);else if("rings"in t)mne(t,t.rings,r);else if("paths"in t)mne(t,t.paths,r);else if("points"in t&&(t.hasM==null||t.hasZ))for(const s of t.points)s.length>2&&(s[2]*=r)}}let mWe=0;const Mwe="esri.layers.graphics.sources.MemorySource",xk=oe.getLogger(Mwe);let oy=class extends Hy.LoadableMixin(oU(uT(Nt))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const i=v(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(i)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.close(),this._connection=null}get _workerGeometryType(){var i;const e=(i=this.layer)==null?void 0:i.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,i={}){await this.load(i);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,i);zj(e,this.layer.spatialReference,r);const s=XJ.fromJSON(r);if(!this._requiresClientGraphicMapping())return s;const n=this.layer.objectIdField;for(const o of s.features){const a=o.attributes[n],l=this._idToClientGraphic.get(a);l&&(o.geometry=l.geometry)}return s.geometryType=this.layer.geometryType,s}async queryFeaturesJSON(e,i={}){if(this._requiresClientGraphicMapping())throw new W("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(i);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,i);return zj(e,this.layer.spatialReference,r),r}queryFeatureCount(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,i))}queryObjectIds(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,i))}queryExtent(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,i)).then(r=>({count:r.count,extent:Pi.fromJSON(r.extent)}))}querySnapping(e,i={}){return this.load(i).then(()=>this._connection.invoke("querySnapping",e,i))}async _applyEdits(e){if(!this._connection)throw new W("feature-layer-source:edit-failure","Memory source not loaded");const i=this.layer.objectIdField;let r=null;const s=[],n=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const o=h=>"objectId"in h&&h.objectId!=null?h.objectId:"attributes"in h&&h.attributes[i]!=null?h.attributes[i]:null;if(e.addFeatures&&(r=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const h of e.deleteFeatures){const p=o(h);p!=null&&s.push(p)}const a=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const h of e.updateFeatures)if(n.push(this._serializeFeature(h)),a){const p=o(h);p!=null&&a.set(p,h)}}pWe(r?r.features:null,n,this.layer.spatialReference);const{fullExtent:l,featureEditResults:c}=await this._connection.invoke("applyEdits",{adds:r?r.features:[],updates:n,deletes:s});return this.fullExtent=l,r&&r.finish(c.uidToObjectId),this._updateClientGraphicIds(a,c),this._createEditsResult(c)}async _prepareClientMapping(e,i){if(this._layerOrSourceGeometryType!=="mesh"||C(e))return;const r=[];for(const{geometry:s}of e)!v(s)||s.type!=="mesh"||s.hasExtent||s.loaded||r.push(s.load({signal:i}));r.length&&await Promise.all(r)}_updateClientGraphicIds(e,i){if(this._idToClientGraphic){if(e)for(const r of i.updateResults){if(!r.success)continue;const s=e.get(r.objectId);s!=null&&this._addIdToClientGraphic(s)}for(const r of i.deleteResults)r.success&&this._idToClientGraphic.delete(r.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const i=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:i?new W("feature-layer-source:edit-failure",i.description,{code:i.code}):null}}_prepareAddFeatures(e){const i=new Map,r=new Array(e.length);let s=null;for(let o=0;o<e.length;o++){const a=e[o],l=this._serializeFeature(a);!s&&v(a.geometry)&&(s=a.geometry.type),r[o]=l,i.set(`${l.uid}`,a)}const n=this;return{features:r,inferredGeometryType:s,finish(o){const a=n.sourceJSON.objectIdField;for(const l in o){const c=o[l],h=i.get(l);h&&(h.attributes||(h.attributes={}),c===-1?delete h.attributes[a]:h.attributes[a]=c,n._addIdToClientGraphic(h))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const i=this.sourceJSON.objectIdField,r=e.attributes&&e.attributes[i];r!=null&&this._idToClientGraphic.set(r,e)}get _layerOrSourceGeometryType(){var e,i;return((e=this.layer)==null?void 0:e.geometryType)??((i=this.sourceJSON)==null?void 0:i.geometryType)}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this._layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:i}=e,r=this._geometryForSerialization(e),s=(mWe++).toString();return r?{uid:s,geometry:r.toJSON(),attributes:i}:{uid:s,attributes:i}}_geometryForSerialization(e){const{geometry:i}=e;return C(i)?null:this._geometryRequiresClientGraphicMapping(i)?i.extent?md.fromExtent(i.extent):null:i}async _startWorker(e){this._connection=await n_e("MemorySourceWorker",{strategy:de("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:i,spatialReference:r,objectIdField:s,hasM:n,hasZ:o,timeInfo:a}=this.layer,l=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const c=this._prepareAddFeatures(this.items);this.handles.add(this.on("before-changes",m=>{xk.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),m.preventDefault()}));const h={features:c.features,fields:i&&i.map(m=>m.toJSON()),geometryType:Rie.toJSON(this._workerGeometryType),hasM:this._layerOrSourceGeometryType!=="mesh"&&n,hasZ:this._layerOrSourceGeometryType==="mesh"||o,objectIdField:s,spatialReference:l?null:r&&r.toJSON(),timeInfo:a?a.toJSON():null},p=await this._connection.invoke("load",h,{signal:e});for(const m of p.warnings)xk.warn(m.message,{layer:this.layer,warning:m});p.featureErrors.length&&xk.warn(`Encountered ${p.featureErrors.length} validation errors while loading features`,p.featureErrors);const f=p.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(c.inferredGeometryType)&&(f.geometryType=Rie.toJSON(c.inferredGeometryType)),this.sourceJSON=f,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),c.finish(p.assignedObjectIds)}};u([mZ({Type:ha,ensureType:mn(ha)})],oy.prototype,"itemType",void 0),u([d()],oy.prototype,"type",void 0),u([d({constructOnly:!0})],oy.prototype,"layer",void 0),u([d({readOnly:!0})],oy.prototype,"_workerGeometryType",null),u([d()],oy.prototype,"sourceJSON",void 0),oy=u([I(Mwe)],oy);function gWe(t){return"portalItem"in t}const yWe=t=>{let e=class extends t{get apiKey(){var i;return this._isOverridden("apiKey")?this._get("apiKey"):gWe(this)?(i=this.portalItem)==null?void 0:i.apiKey:null}set apiKey(i){i!=null?this._override("apiKey",i):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return u([d({type:String})],e.prototype,"apiKey",null),e=u([I("esri.layers.mixins.APIKeyMixin")],e),e},Pwe={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},Iwe=Object.values(Pwe),$we=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${Iwe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),_We=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${Iwe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),vWe=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function RIt(t){return!!$we.test(t)}function hA(t){if(C(t))return null;const e=vl(t),i=e.path.match($we)||e.path.match(_We);if(!i)return null;const[,r,s,n,o]=i,a=s.indexOf("/");return{title:uK(a!==-1?s.slice(a+1):s),serverType:Pwe[n.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:r}}}function bWe(t){const e=vl(t).path.match(vWe);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function uK(t){return(t=t.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function wWe(t,e){const i=[];if(t){const r=hA(t);v(r)&&r.title&&i.push(r.title)}if(e){const r=uK(e);i.push(r)}if(i.length===2){if(i[0].toLowerCase().includes(i[1].toLowerCase()))return i[0];if(i[1].toLowerCase().includes(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function Lwe(t){if(!t)return!1;const e=".arcgis.com/",i="//services",r="//tiles",s="//features",n=(t=t.toLowerCase()).includes(e),o=t.includes(i)||t.includes(r)||t.includes(s);return n&&o}function xWe(t,e){return t&&p0e(m0e(t,e))}function TWe(t){let{url:e}=t;if(!e)return{url:e};e=m0e(e,t.logger);const i=vl(e),r=hA(i.path);let s;if(v(r))r.sublayer!=null&&t.layer.layerId==null&&(s=r.sublayer),e=r.url.path;else if(t.nonStandardUrlAllowed){const n=bWe(i.path);v(n)&&(e=n.serviceUrl,s=n.sublayerId)}return{url:p0e(e),layerId:s}}function SWe(t,e,i,r,s){Zv(e,r,"url",s),r.url&&t.layerId!=null&&(r.url=Ax(r.url,i,t.layerId.toString()))}function MIt(t){if(!t)return!1;const e=t.toLowerCase(),i=e.includes("/services/"),r=e.includes("/mapserver/wmsserver"),s=e.includes("/imageserver/wmsserver"),n=e.includes("/wmsserver");return i&&(r||s||n)}const EWe=t=>{let e=class extends t{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const i=hA(this.url);if(v(i)&&i.title)return i.title}return this._get("title")||""}set title(i){this._set("title",i)}set url(i){this._set("url",xWe(i,oe.getLogger(this.declaredClass)))}};return u([d()],e.prototype,"title",null),u([d({type:String})],e.prototype,"url",null),e=u([I("esri.layers.mixins.ArcGISService")],e),e},yne={read:{reader:GJ},write:{allowNull:!0,writer:jJ}},CWe=t=>{let e=class extends t{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return u([d({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],e.prototype,"blendMode",void 0),u([d({json:{read:!1,write:!1,origins:{"web-map":yne,"portal-item":yne}}})],e.prototype,"effect",void 0),e=u([I("esri.layers.mixins.BlendLayer")],e),e},AWe=t=>{let e=class extends t{constructor(){super(...arguments),this.customParameters=null}};return u([d({type:Object,json:{write:{overridePolicy:i=>({enabled:!!(i&&Object.keys(i).length>0)})}}})],e.prototype,"customParameters",void 0),e=u([I("esri.layers.mixins.CustomParametersMixin")],e),e},OWe=new As.EventEmitter,Dwe="esri.layers.mixins.EditBusLayer",Nwe=Symbol(Dwe);function PIt(t){return t!=null&&typeof t=="object"&&Nwe in t}const RWe=t=>{var e;let i=class extends t{constructor(...r){super(...r),this[e]=!0,this.when().then(()=>{this.own([OWe.on("edits",s=>{var h,p,f;const n="layer"in s?s.layer:null,o="layer"in s?(h=s.layer)==null?void 0:h.url:s.serviceUrl,a="layer"in s?(p=s.layer)==null?void 0:p.layerId:s.layerId,l=s.event;if(n===this||o!==this.url)return;if(a!=null&&this.layerId!=null&&a===this.layerId)return void this.emit("edits",ae(l));const c=(f=l.editedFeatures)==null?void 0:f.find(({layerId:m})=>m===this.layerId);if(c){const{adds:m,updates:y,deletes:_}=c.editedFeatures,b={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:m?m.map(({attributes:w})=>({objectId:this.objectIdField&&w[this.objectIdField],globalId:this.globalIdField&&w[this.globalIdField]})):[],deletedFeatures:_?_.map(({attributes:w})=>({objectId:this.objectIdField&&w[this.objectIdField],globalId:this.globalIdField&&w[this.globalIdField]})):[],updatedFeatures:y?y.map(({current:{attributes:w}})=>({objectId:this.objectIdField&&w[this.objectIdField],globalId:this.globalIdField&&w[this.globalIdField]})):[],editedFeatures:ae(l.editedFeatures),exceededTransferLimit:!1};this.emit("edits",b)}})])},()=>{})}};return e=Nwe,i=u([I(Dwe)],i),i};var UH;const Tk=new Gi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),Sk=new Gi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let zf=UH=class extends Ie{constructor(t){super(t),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(t={}){const{where:e,geometry:i,spatialRelationship:r,timeExtent:s,objectIds:n,units:o,distance:a}=this;return new Mm({geometry:ae(i),objectIds:ae(n),spatialRelationship:r,timeExtent:ae(s),where:e,units:o,distance:a,...t})}clone(){const{where:t,geometry:e,spatialRelationship:i,timeExtent:r,objectIds:s,units:n,distance:o}=this;return new UH({geometry:ae(e),objectIds:ae(s),spatialRelationship:i,timeExtent:ae(r),where:t,units:n,distance:o})}};u([d({type:String,json:{write:!0}})],zf.prototype,"where",void 0),u([d({types:nT,json:{write:!0}})],zf.prototype,"geometry",void 0),u([d({type:Tk.apiValues,json:{name:"spatialRel",read:{reader:Tk.read},write:{allowNull:!1,writer:Tk.write,overridePolicy(){return{enabled:v(this.geometry)}}}}})],zf.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{write:{overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],zf.prototype,"distance",void 0),u([d({type:[Number],json:{write:!0}})],zf.prototype,"objectIds",void 0),u([d({type:Sk.apiValues,json:{read:Sk.read,write:{writer:Sk.write,overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],zf.prototype,"units",void 0),u([d({type:ig,json:{write:!0}})],zf.prototype,"timeExtent",void 0),zf=UH=u([I("esri.layers.support.FeatureFilter")],zf);const MWe=zf;var VH;const _ne={read:{reader:GJ},write:{writer:jJ,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},vne={read:{reader:GJ},write:{writer:jJ,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},bne={name:"showExcludedLabels",default:!0};let Xb=VH=class extends Ie{constructor(t){super(t),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(t,e){var r,s;const i=super.write(t,e);if(e!=null&&e.origin){if(i.filter){const n=Object.keys(i.filter);if(n.length>1||n[0]!=="where")return(r=e.messages)==null||r.push(new W("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:e.layer,effect:this})),null}if("showExcludedLabels"in i)return(s=e.messages)==null||s.push(new W("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:e.layer,effect:this})),null}return i}clone(){return new VH({filter:v(this.filter)?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};u([d({type:MWe,json:{write:{allowNull:!0,writer(t,e,i,r){const s=t==null?void 0:t.write({},r);s&&Object.keys(s).length!==0?gl(i,s,e):gl(i,null,e)}}}})],Xb.prototype,"filter",void 0),u([d({json:{write:!0,origins:{"web-map":_ne,"portal-item":_ne}}})],Xb.prototype,"includedEffect",void 0),u([d({json:{write:!0,origins:{"web-map":vne,"portal-item":vne}}})],Xb.prototype,"excludedEffect",void 0),u([d({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":bne,"portal-item":bne}}})],Xb.prototype,"excludedLabelsVisible",void 0),Xb=VH=u([I("esri.layers.support.FeatureEffect")],Xb);const PWe=Xb,wne={write:{allowNull:!0}},IWe=t=>{let e=class extends t{constructor(){super(...arguments),this.featureEffect=null}};return u([d({type:PWe,json:{origins:{"web-map":wne,"portal-item":wne}}})],e.prototype,"featureEffect",void 0),e=u([I("esri.layers.mixins.FeatureEffectLayer")],e),e};function $We(t){if(!t)return t;const{start:e,end:i}=t;return new ig({start:v(e)?lx(e,-e.getTimezoneOffset(),"minutes"):e,end:v(i)?lx(i,-i.getTimezoneOffset(),"minutes"):i})}function LWe(t){if(!t)return t;const{start:e,end:i}=t;return new ig({start:v(e)?lx(e,e.getTimezoneOffset(),"minutes"):e,end:v(i)?lx(i,i.getTimezoneOffset(),"minutes"):i})}var kH;let OR=kH=class extends Ie{constructor(t){super(t)}async collectRequiredFields(t,e){return cc(t,e,this.expression)}clone(){return new kH({expression:this.expression,title:this.title})}equals(t){return this.expression===t.expression&&this.title===t.title}};u([d({type:String,json:{write:!0}})],OR.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],OR.prototype,"title",void 0),OR=kH=u([I("esri.layers.support.FeatureExpressionInfo")],OR);const xne=OR;function DWe(t){return!!t&&_C[t]!=null}function NWe(t){return 1/(_C[t]||1)}function FWe(){const t=Object.keys(_C);return t.sort(),t}const UWe=FWe();var BH;const D$=Ua()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),Tne=new Gi({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let jg=BH=class extends Ie{constructor(t){super(t),this.offset=null}readFeatureExpressionInfo(t,e){return t??(e.featureExpression&&e.featureExpression.value===0?{expression:"0"}:void 0)}writeFeatureExpressionInfo(t,e,i,r){e[i]=t.write({},r),t.expression==="0"&&(e.featureExpression={value:0})}get mode(){const{offset:t,featureExpressionInfo:e}=this;return this._isOverridden("mode")?this._get("mode"):v(t)||e?"relative-to-ground":"on-the-ground"}set mode(t){this._override("mode",t)}set unit(t){this._set("unit",t)}write(t,e){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(t,e):null}clone(){return new BH({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(t){return this.mode===t.mode&&this.offset===t.offset&&this.unit===t.unit&&JLe(this.featureExpressionInfo,t.featureExpressionInfo)}};u([d({type:xne,json:{write:!0}})],jg.prototype,"featureExpressionInfo",void 0),u([Qe("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],jg.prototype,"readFeatureExpressionInfo",null),u([lt("featureExpressionInfo",{featureExpressionInfo:{type:xne},"featureExpression.value":{type:[0]}})],jg.prototype,"writeFeatureExpressionInfo",null),u([d({type:D$.apiValues,nonNullable:!0,json:{type:D$.jsonValues,read:D$.read,write:{writer:D$.write,isRequired:!0}}})],jg.prototype,"mode",null),u([d({type:Number,json:{write:!0}})],jg.prototype,"offset",void 0),u([d({type:UWe,json:{type:String,read:Tne.read,write:Tne.write}})],jg.prototype,"unit",null),jg=BH=u([I("esri.layers.support.ElevationInfo")],jg);const VWe=jg,kWe={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},hK={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(t,e)=>!e.disablePopup},write:{enabled:!0,writer(t,e,i){e[i]=!t}}}},dK={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:!0}},BWe={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:Zv}}},zWe={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},GWe={value:null,type:VWe,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function IIt(t){return{type:t,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const Fwe={write:!0,read:!0},zH={type:Number,json:{origins:{"web-document":Fwe,"portal-item":{write:!0}}}},jWe={...zH,json:{...zH.json,origins:{"web-document":{...Fwe,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(t,e,i)=>i&&i.origin!=="service"||!e.drawingInfo||e.drawingInfo.transparency===void 0?e.layerDefinition&&e.layerDefinition.drawingInfo&&e.layerDefinition.drawingInfo.transparency!==void 0?V3(e.layerDefinition.drawingInfo.transparency):void 0:V3(e.drawingInfo.transparency)}}},$It={type:ig,readOnly:!0,get(){var a,l;if(!((a=this.layer)!=null&&a.timeInfo))return null;const{datesInUnknownTimezone:t,timeOffset:e,useViewTime:i}=this.layer,r=(l=this.view)==null?void 0:l.timeExtent;let s=this.layer.timeExtent;t&&(s=LWe(s));let n=i?r&&s?r.intersection(s):r||s:s;if(!n||n.isEmpty||n.isAllTime)return n;e&&(n=n.offset(-e.value,e.unit)),t&&(n=$We(n));const o=this._get("timeExtent");return n.equals(o)?o:n}},LIt={type:Pi,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(t,e)=>{const i=Pi.fromJSON(t);return e.spatialReference!=null&&typeof e.spatialReference=="object"&&(i.spatialReference=mt.fromJSON(e.spatialReference)),i}}}},read:!1}},HWe={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},qWe={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},WWe={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},Uwe={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}},Sne=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Almaty"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Chihuahua"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);class fT extends Error{}class XWe extends fT{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class YWe extends fT{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class ZWe extends fT{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class RR extends fT{}class Vwe extends fT{constructor(e){super(`Invalid unit ${e}`)}}class qh extends fT{}class D0 extends fT{constructor(){super("Zone is an abstract class")}}const yt="numeric",tf="short",Ju="long",r5={year:yt,month:yt,day:yt},kwe={year:yt,month:tf,day:yt},JWe={year:yt,month:tf,day:yt,weekday:tf},Bwe={year:yt,month:Ju,day:yt},zwe={year:yt,month:Ju,day:yt,weekday:Ju},Gwe={hour:yt,minute:yt},jwe={hour:yt,minute:yt,second:yt},Hwe={hour:yt,minute:yt,second:yt,timeZoneName:tf},qwe={hour:yt,minute:yt,second:yt,timeZoneName:Ju},Wwe={hour:yt,minute:yt,hourCycle:"h23"},Xwe={hour:yt,minute:yt,second:yt,hourCycle:"h23"},Ywe={hour:yt,minute:yt,second:yt,hourCycle:"h23",timeZoneName:tf},Zwe={hour:yt,minute:yt,second:yt,hourCycle:"h23",timeZoneName:Ju},Jwe={year:yt,month:yt,day:yt,hour:yt,minute:yt},Kwe={year:yt,month:yt,day:yt,hour:yt,minute:yt,second:yt},Qwe={year:yt,month:tf,day:yt,hour:yt,minute:yt},exe={year:yt,month:tf,day:yt,hour:yt,minute:yt,second:yt},KWe={year:yt,month:tf,day:yt,weekday:tf,hour:yt,minute:yt},txe={year:yt,month:Ju,day:yt,hour:yt,minute:yt,timeZoneName:tf},ixe={year:yt,month:Ju,day:yt,hour:yt,minute:yt,second:yt,timeZoneName:tf},rxe={year:yt,month:Ju,day:yt,weekday:Ju,hour:yt,minute:yt,timeZoneName:Ju},sxe={year:yt,month:Ju,day:yt,weekday:Ju,hour:yt,minute:yt,second:yt,timeZoneName:Ju};class gI{get type(){throw new D0}get name(){throw new D0}get ianaName(){return this.name}get isUniversal(){throw new D0}offsetName(e,i){throw new D0}formatOffset(e,i){throw new D0}offset(e){throw new D0}equals(e){throw new D0}get isValid(){throw new D0}}let Ek=null;class GU extends gI{static get instance(){return Ek===null&&(Ek=new GU),Ek}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return oxe(e,i,r)}formatOffset(e,i){return qM(this.offset(e),i)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let eF={};function QWe(t){return eF[t]||(eF[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),eF[t]}const eXe={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function tXe(t,e){const i=t.format(e).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(i),[,s,n,o,a,l,c,h]=r;return[o,s,n,a,l,c,h]}function iXe(t,e){const i=t.formatToParts(e),r=[];for(let s=0;s<i.length;s++){const{type:n,value:o}=i[s],a=eXe[n];n==="era"?r[a]=o:vr(a)||(r[a]=parseInt(o,10))}return r}let N$={};class Wy extends gI{static create(e){return N$[e]||(N$[e]=new Wy(e)),N$[e]}static resetCache(){N$={},eF={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=Wy.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return oxe(e,i,r,this.name)}formatOffset(e,i){return qM(this.offset(e),i)}offset(e){const i=new Date(e);if(isNaN(i))return NaN;const r=QWe(this.name);let[s,n,o,a,l,c,h]=r.formatToParts?iXe(r,i):tXe(r,i);a==="BC"&&(s=-Math.abs(s)+1);const f=mK({year:s,month:n,day:o,hour:l===24?0:l,minute:c,second:h,millisecond:0});let m=+i;const y=m%1e3;return m-=y>=0?y:1e3+y,(f-m)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let Ene={};function rXe(t,e={}){const i=JSON.stringify([t,e]);let r=Ene[i];return r||(r=new Intl.ListFormat(t,e),Ene[i]=r),r}let GH={};function jH(t,e={}){const i=JSON.stringify([t,e]);let r=GH[i];return r||(r=new Intl.DateTimeFormat(t,e),GH[i]=r),r}let HH={};function sXe(t,e={}){const i=JSON.stringify([t,e]);let r=HH[i];return r||(r=new Intl.NumberFormat(t,e),HH[i]=r),r}let qH={};function nXe(t,e={}){const{base:i,...r}=e,s=JSON.stringify([t,r]);let n=qH[s];return n||(n=new Intl.RelativeTimeFormat(t,e),qH[s]=n),n}let MR=null;function oXe(){return MR||(MR=new Intl.DateTimeFormat().resolvedOptions().locale,MR)}function aXe(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const i=t.indexOf("-u-");if(i===-1)return[t];{let r,s;try{r=jH(t).resolvedOptions(),s=t}catch{const l=t.substring(0,i);r=jH(l).resolvedOptions(),s=l}const{numberingSystem:n,calendar:o}=r;return[s,n,o]}}function lXe(t,e,i){return(i||e)&&(t.includes("-u-")||(t+="-u"),i&&(t+=`-ca-${i}`),e&&(t+=`-nu-${e}`)),t}function cXe(t){const e=[];for(let i=1;i<=12;i++){const r=$i.utc(2016,i,1);e.push(t(r))}return e}function uXe(t){const e=[];for(let i=1;i<=7;i++){const r=$i.utc(2016,11,13+i);e.push(t(r))}return e}function F$(t,e,i,r,s){const n=t.listingMode(i);return n==="error"?null:n==="en"?r(e):s(e)}function hXe(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class dXe{constructor(e,i,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;const{padTo:s,floor:n,...o}=r;if(!i||Object.keys(o).length>0){const a={useGrouping:!1,...r};r.padTo>0&&(a.minimumIntegerDigits=r.padTo),this.inf=sXe(e,a)}}format(e){if(this.inf){const i=this.floor?Math.floor(e):e;return this.inf.format(i)}else{const i=this.floor?Math.floor(e):fK(e,3);return co(i,this.padTo)}}}class pXe{constructor(e,i,r){this.opts=r;let s;if(e.zone.isUniversal){const o=-1*(e.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;e.offset!==0&&Wy.create(a).valid?(s=a,this.dt=e):(s="UTC",r.timeZoneName?this.dt=e:this.dt=e.offset===0?e:$i.fromMillis(e.ts+e.offset*60*1e3))}else e.zone.type==="system"?this.dt=e:(this.dt=e,s=e.zone.name);const n={...this.opts};n.timeZone=n.timeZone||s,this.dtf=jH(i,n)}format(){return this.dtf.format(this.dt.toJSDate())}formatToParts(){return this.dtf.formatToParts(this.dt.toJSDate())}resolvedOptions(){return this.dtf.resolvedOptions()}}class fXe{constructor(e,i,r){this.opts={style:"long",...r},!i&&nxe()&&(this.rtf=nXe(e,r))}format(e,i){return this.rtf?this.rtf.format(e,i):PXe(i,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,i){return this.rtf?this.rtf.formatToParts(e,i):[]}}class Ys{static fromOpts(e){return Ys.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,i,r,s=!1){const n=e||ao.defaultLocale,o=n||(s?"en-US":oXe()),a=i||ao.defaultNumberingSystem,l=r||ao.defaultOutputCalendar;return new Ys(o,a,l,n)}static resetCache(){MR=null,GH={},HH={},qH={}}static fromObject({locale:e,numberingSystem:i,outputCalendar:r}={}){return Ys.create(e,i,r)}constructor(e,i,r,s){const[n,o,a]=aXe(e);this.locale=n,this.numberingSystem=i||o||null,this.outputCalendar=r||a||null,this.intl=lXe(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=s,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=hXe(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),i=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&i?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:Ys.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,i=!1,r=!0){return F$(this,e,r,cxe,()=>{const s=i?{month:e,day:"numeric"}:{month:e},n=i?"format":"standalone";return this.monthsCache[n][e]||(this.monthsCache[n][e]=cXe(o=>this.extract(o,s,"month"))),this.monthsCache[n][e]})}weekdays(e,i=!1,r=!0){return F$(this,e,r,dxe,()=>{const s=i?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},n=i?"format":"standalone";return this.weekdaysCache[n][e]||(this.weekdaysCache[n][e]=uXe(o=>this.extract(o,s,"weekday"))),this.weekdaysCache[n][e]})}meridiems(e=!0){return F$(this,void 0,e,()=>pxe,()=>{if(!this.meridiemCache){const i={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[$i.utc(2016,11,13,9),$i.utc(2016,11,13,19)].map(r=>this.extract(r,i,"dayperiod"))}return this.meridiemCache})}eras(e,i=!0){return F$(this,e,i,fxe,()=>{const r={era:e};return this.eraCache[e]||(this.eraCache[e]=[$i.utc(-40,1,1),$i.utc(2017,1,1)].map(s=>this.extract(s,r,"era"))),this.eraCache[e]})}extract(e,i,r){const s=this.dtFormatter(e,i),n=s.formatToParts(),o=n.find(a=>a.type.toLowerCase()===r);return o?o.value:null}numberFormatter(e={}){return new dXe(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,i={}){return new pXe(e,this.intl,i)}relFormatter(e={}){return new fXe(this.intl,this.isEnglish(),e)}listFormatter(e={}){return rXe(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let Ck=null;class ul extends gI{static get utcInstance(){return Ck===null&&(Ck=new ul(0)),Ck}static instance(e){return e===0?ul.utcInstance:new ul(e)}static parseSpecifier(e){if(e){const i=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(i)return new ul(HU(i[1],i[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${qM(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${qM(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,i){return qM(this.fixed,i)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class mXe extends gI{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function nv(t,e){if(vr(t)||t===null)return e;if(t instanceof gI)return t;if(gXe(t)){const i=t.toLowerCase();return i==="default"?e:i==="local"||i==="system"?GU.instance:i==="utc"||i==="gmt"?ul.utcInstance:ul.parseSpecifier(i)||Wy.create(t)}else return cx(t)?ul.instance(t):typeof t=="object"&&t.offset&&typeof t.offset=="number"?t:new mXe(t)}let Cne=()=>Date.now(),Ane="system",One=null,Rne=null,Mne=null,Pne=60,Ine;class ao{static get now(){return Cne}static set now(e){Cne=e}static set defaultZone(e){Ane=e}static get defaultZone(){return nv(Ane,GU.instance)}static get defaultLocale(){return One}static set defaultLocale(e){One=e}static get defaultNumberingSystem(){return Rne}static set defaultNumberingSystem(e){Rne=e}static get defaultOutputCalendar(){return Mne}static set defaultOutputCalendar(e){Mne=e}static get twoDigitCutoffYear(){return Pne}static set twoDigitCutoffYear(e){Pne=e%100}static get throwOnInvalid(){return Ine}static set throwOnInvalid(e){Ine=e}static resetCaches(){Ys.resetCache(),Wy.resetCache()}}function vr(t){return typeof t>"u"}function cx(t){return typeof t=="number"}function jU(t){return typeof t=="number"&&t%1===0}function gXe(t){return typeof t=="string"}function yXe(t){return Object.prototype.toString.call(t)==="[object Date]"}function nxe(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function _Xe(t){return Array.isArray(t)?t:[t]}function $ne(t,e,i){if(t.length!==0)return t.reduce((r,s)=>{const n=[e(s),s];return r&&i(r[0],n[0])===r[0]?r:n},null)[1]}function vXe(t,e){return e.reduce((i,r)=>(i[r]=t[r],i),{})}function wC(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function wy(t,e,i){return jU(t)&&t>=e&&t<=i}function bXe(t,e){return t-e*Math.floor(t/e)}function co(t,e=2){const i=t<0;let r;return i?r="-"+(""+-t).padStart(e,"0"):r=(""+t).padStart(e,"0"),r}function J_(t){if(!(vr(t)||t===null||t===""))return parseInt(t,10)}function I1(t){if(!(vr(t)||t===null||t===""))return parseFloat(t)}function pK(t){if(!(vr(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function fK(t,e,i=!1){const r=10**e;return(i?Math.trunc:Math.round)(t*r)/r}function yI(t){return t%4===0&&(t%100!==0||t%400===0)}function HM(t){return yI(t)?366:365}function s5(t,e){const i=bXe(e-1,12)+1,r=t+(e-i)/12;return i===2?yI(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][i-1]}function mK(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(e.getUTCFullYear()-1900)),+e}function n5(t){const e=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7,i=t-1,r=(i+Math.floor(i/4)-Math.floor(i/100)+Math.floor(i/400))%7;return e===4||r===3?53:52}function WH(t){return t>99?t:t>ao.twoDigitCutoffYear?1900+t:2e3+t}function oxe(t,e,i,r=null){const s=new Date(t),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(n.timeZone=r);const o={timeZoneName:e,...n},a=new Intl.DateTimeFormat(i,o).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function HU(t,e){let i=parseInt(t,10);Number.isNaN(i)&&(i=0);const r=parseInt(e,10)||0,s=i<0||Object.is(i,-0)?-r:r;return i*60+s}function axe(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new qh(`Invalid unit value ${t}`);return e}function o5(t,e){const i={};for(const r in t)if(wC(t,r)){const s=t[r];if(s==null)continue;i[e(r)]=axe(s)}return i}function qM(t,e){const i=Math.trunc(Math.abs(t/60)),r=Math.trunc(Math.abs(t%60)),s=t>=0?"+":"-";switch(e){case"short":return`${s}${co(i,2)}:${co(r,2)}`;case"narrow":return`${s}${i}${r>0?`:${r}`:""}`;case"techie":return`${s}${co(i,2)}${co(r,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function qU(t){return vXe(t,["hour","minute","second","millisecond"])}const wXe=["January","February","March","April","May","June","July","August","September","October","November","December"],lxe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],xXe=["J","F","M","A","M","J","J","A","S","O","N","D"];function cxe(t){switch(t){case"narrow":return[...xXe];case"short":return[...lxe];case"long":return[...wXe];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const uxe=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],hxe=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],TXe=["M","T","W","T","F","S","S"];function dxe(t){switch(t){case"narrow":return[...TXe];case"short":return[...hxe];case"long":return[...uxe];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const pxe=["AM","PM"],SXe=["Before Christ","Anno Domini"],EXe=["BC","AD"],CXe=["B","A"];function fxe(t){switch(t){case"narrow":return[...CXe];case"short":return[...EXe];case"long":return[...SXe];default:return null}}function AXe(t){return pxe[t.hour<12?0:1]}function OXe(t,e){return dxe(e)[t.weekday-1]}function RXe(t,e){return cxe(e)[t.month-1]}function MXe(t,e){return fxe(e)[t.year<0?0:1]}function PXe(t,e,i="always",r=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(t)===-1;if(i==="auto"&&n){const p=t==="days";switch(e){case 1:return p?"tomorrow":`next ${s[t][0]}`;case-1:return p?"yesterday":`last ${s[t][0]}`;case 0:return p?"today":`this ${s[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=a===1,c=s[t],h=r?l?c[1]:c[2]||c[1]:l?s[t][0]:t;return o?`${a} ${h} ago`:`in ${a} ${h}`}function Lne(t,e){let i="";for(const r of t)r.literal?i+=r.val:i+=e(r.val);return i}const IXe={D:r5,DD:kwe,DDD:Bwe,DDDD:zwe,t:Gwe,tt:jwe,ttt:Hwe,tttt:qwe,T:Wwe,TT:Xwe,TTT:Ywe,TTTT:Zwe,f:Jwe,ff:Qwe,fff:txe,ffff:rxe,F:Kwe,FF:exe,FFF:ixe,FFFF:sxe};class al{static create(e,i={}){return new al(e,i)}static parseFormat(e){let i=null,r="",s=!1;const n=[];for(let o=0;o<e.length;o++){const a=e.charAt(o);a==="'"?(r.length>0&&n.push({literal:s,val:r}),i=null,r="",s=!s):s||a===i?r+=a:(r.length>0&&n.push({literal:!1,val:r}),r=a,i=a)}return r.length>0&&n.push({literal:s,val:r}),n}static macroTokenToFormatOpts(e){return IXe[e]}constructor(e,i){this.opts=i,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,i){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...i}).format()}formatDateTime(e,i={}){return this.loc.dtFormatter(e,{...this.opts,...i}).format()}formatDateTimeParts(e,i={}){return this.loc.dtFormatter(e,{...this.opts,...i}).formatToParts()}formatInterval(e,i={}){return this.loc.dtFormatter(e.start,{...this.opts,...i}).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,i={}){return this.loc.dtFormatter(e,{...this.opts,...i}).resolvedOptions()}num(e,i=0){if(this.opts.forceSimple)return co(e,i);const r={...this.opts};return i>0&&(r.padTo=i),this.loc.numberFormatter(r).format(e)}formatDateTimeFromString(e,i){const r=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(m,y)=>this.loc.extract(e,m,y),o=m=>e.isOffsetFixed&&e.offset===0&&m.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,m.format):"",a=()=>r?AXe(e):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(m,y)=>r?RXe(e,m):n(y?{month:m}:{month:m,day:"numeric"},"month"),c=(m,y)=>r?OXe(e,m):n(y?{weekday:m}:{weekday:m,month:"long",day:"numeric"},"weekday"),h=m=>{const y=al.macroTokenToFormatOpts(m);return y?this.formatWithSystemDefault(e,y):m},p=m=>r?MXe(e,m):n({era:m},"era"),f=m=>{switch(m){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return s?n({day:"numeric"},"day"):this.num(e.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(e.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(e.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(e.year,6);case"G":return p("short");case"GG":return p("long");case"GGGGG":return p("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return h(m)}};return Lne(al.parseFormat(i),f)}formatDurationFromString(e,i){const r=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=l=>c=>{const h=r(c);return h?this.num(l.get(h),c.length):c},n=al.parseFormat(i),o=n.reduce((l,{literal:c,val:h})=>c?l:l.concat(h),[]),a=e.shiftTo(...o.map(r).filter(l=>l));return Lne(n,s(a))}}class Lp{constructor(e,i){this.reason=e,this.explanation=i}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const mxe=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function dA(...t){const e=t.reduce((i,r)=>i+r.source,"");return RegExp(`^${e}$`)}function pA(...t){return e=>t.reduce(([i,r,s],n)=>{const[o,a,l]=n(e,s);return[{...i,...o},a||r,l]},[{},null,1]).slice(0,2)}function fA(t,...e){if(t==null)return[null,null];for(const[i,r]of e){const s=i.exec(t);if(s)return r(s)}return[null,null]}function gxe(...t){return(e,i)=>{const r={};let s;for(s=0;s<t.length;s++)r[t[s]]=J_(e[i+s]);return[r,null,i+s]}}const yxe=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,$Xe=`(?:${yxe.source}?(?:\\[(${mxe.source})\\])?)?`,gK=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,_xe=RegExp(`${gK.source}${$Xe}`),yK=RegExp(`(?:T${_xe.source})?`),LXe=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,DXe=/(\d{4})-?W(\d\d)(?:-?(\d))?/,NXe=/(\d{4})-?(\d{3})/,FXe=gxe("weekYear","weekNumber","weekDay"),UXe=gxe("year","ordinal"),VXe=/(\d{4})-(\d\d)-(\d\d)/,vxe=RegExp(`${gK.source} ?(?:${yxe.source}|(${mxe.source}))?`),kXe=RegExp(`(?: ${vxe.source})?`);function EE(t,e,i){const r=t[e];return vr(r)?i:J_(r)}function BXe(t,e){return[{year:EE(t,e),month:EE(t,e+1,1),day:EE(t,e+2,1)},null,e+3]}function mA(t,e){return[{hours:EE(t,e,0),minutes:EE(t,e+1,0),seconds:EE(t,e+2,0),milliseconds:pK(t[e+3])},null,e+4]}function _I(t,e){const i=!t[e]&&!t[e+1],r=HU(t[e+1],t[e+2]),s=i?null:ul.instance(r);return[{},s,e+3]}function vI(t,e){const i=t[e]?Wy.create(t[e]):null;return[{},i,e+1]}const zXe=RegExp(`^T?${gK.source}$`),GXe=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function jXe(t){const[e,i,r,s,n,o,a,l,c]=t,h=e[0]==="-",p=l&&l[0]==="-",f=(m,y=!1)=>m!==void 0&&(y||m&&h)?-m:m;return[{years:f(I1(i)),months:f(I1(r)),weeks:f(I1(s)),days:f(I1(n)),hours:f(I1(o)),minutes:f(I1(a)),seconds:f(I1(l),l==="-0"),milliseconds:f(pK(c),p)}]}const HXe={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function _K(t,e,i,r,s,n,o){const a={year:e.length===2?WH(J_(e)):J_(e),month:lxe.indexOf(i)+1,day:J_(r),hour:J_(s),minute:J_(n)};return o&&(a.second=J_(o)),t&&(a.weekday=t.length>3?uxe.indexOf(t)+1:hxe.indexOf(t)+1),a}const qXe=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function WXe(t){const[,e,i,r,s,n,o,a,l,c,h,p]=t,f=_K(e,s,r,i,n,o,a);let m;return l?m=HXe[l]:c?m=0:m=HU(h,p),[f,new ul(m)]}function XXe(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const YXe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,ZXe=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,JXe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Dne(t){const[,e,i,r,s,n,o,a]=t;return[_K(e,s,r,i,n,o,a),ul.utcInstance]}function KXe(t){const[,e,i,r,s,n,o,a]=t;return[_K(e,a,i,r,s,n,o),ul.utcInstance]}const QXe=dA(LXe,yK),eYe=dA(DXe,yK),tYe=dA(NXe,yK),iYe=dA(_xe),bxe=pA(BXe,mA,_I,vI),rYe=pA(FXe,mA,_I,vI),sYe=pA(UXe,mA,_I,vI),nYe=pA(mA,_I,vI);function oYe(t){return fA(t,[QXe,bxe],[eYe,rYe],[tYe,sYe],[iYe,nYe])}function aYe(t){return fA(XXe(t),[qXe,WXe])}function lYe(t){return fA(t,[YXe,Dne],[ZXe,Dne],[JXe,KXe])}function cYe(t){return fA(t,[GXe,jXe])}const uYe=pA(mA);function hYe(t){return fA(t,[zXe,uYe])}const dYe=dA(VXe,kXe),pYe=dA(vxe),fYe=pA(mA,_I,vI);function mYe(t){return fA(t,[dYe,bxe],[pYe,fYe])}const gYe="Invalid Duration",wxe={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},yYe={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...wxe},ch=146097/400,OT=146097/4800,_Ye={years:{quarters:4,months:12,weeks:ch/7,days:ch,hours:ch*24,minutes:ch*24*60,seconds:ch*24*60*60,milliseconds:ch*24*60*60*1e3},quarters:{months:3,weeks:ch/28,days:ch/4,hours:ch*24/4,minutes:ch*24*60/4,seconds:ch*24*60*60/4,milliseconds:ch*24*60*60*1e3/4},months:{weeks:OT/7,days:OT,hours:OT*24,minutes:OT*24*60,seconds:OT*24*60*60,milliseconds:OT*24*60*60*1e3},...wxe},Yb=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],vYe=Yb.slice(0).reverse();function N0(t,e,i=!1){const r={values:i?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new xr(r)}function bYe(t){return t<0?Math.floor(t):Math.ceil(t)}function xxe(t,e,i,r,s){const n=t[s][i],o=e[i]/n,a=Math.sign(o)===Math.sign(r[s]),l=!a&&r[s]!==0&&Math.abs(o)<=1?bYe(o):Math.trunc(o);r[s]+=l,e[i]-=l*n}function wYe(t,e){vYe.reduce((i,r)=>vr(e[r])?i:(i&&xxe(t,e,i,e,r),r),null)}function xYe(t){const e={};for(const[i,r]of Object.entries(t))r!==0&&(e[i]=r);return e}class xr{constructor(e){const i=e.conversionAccuracy==="longterm"||!1;let r=i?_Ye:yYe;e.matrix&&(r=e.matrix),this.values=e.values,this.loc=e.loc||Ys.create(),this.conversionAccuracy=i?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=r,this.isLuxonDuration=!0}static fromMillis(e,i){return xr.fromObject({milliseconds:e},i)}static fromObject(e,i={}){if(e==null||typeof e!="object")throw new qh(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new xr({values:o5(e,xr.normalizeUnit),loc:Ys.fromObject(i),conversionAccuracy:i.conversionAccuracy,matrix:i.matrix})}static fromDurationLike(e){if(cx(e))return xr.fromMillis(e);if(xr.isDuration(e))return e;if(typeof e=="object")return xr.fromObject(e);throw new qh(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,i){const[r]=cYe(e);return r?xr.fromObject(r,i):xr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,i){const[r]=hYe(e);return r?xr.fromObject(r,i):xr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,i=null){if(!e)throw new qh("need to specify a reason the Duration is invalid");const r=e instanceof Lp?e:new Lp(e,i);if(ao.throwOnInvalid)throw new ZWe(r);return new xr({invalid:r})}static normalizeUnit(e){const i={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!i)throw new Vwe(e);return i}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,i={}){const r={...i,floor:i.round!==!1&&i.floor!==!1};return this.isValid?al.create(this.loc,r).formatDurationFromString(this,e):gYe}toHuman(e={}){const i=Yb.map(r=>{const s=this.values[r];return vr(s)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:r.slice(0,-1)}).format(s)}).filter(r=>r);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(i)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=fK(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const i=this.toMillis();if(i<0||i>=864e5)return null;e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e};const r=this.shiftTo("hours","minutes","seconds","milliseconds");let s=e.format==="basic"?"hhmm":"hh:mm";(!e.suppressSeconds||r.seconds!==0||r.milliseconds!==0)&&(s+=e.format==="basic"?"ss":":ss",(!e.suppressMilliseconds||r.milliseconds!==0)&&(s+=".SSS"));let n=r.toFormat(s);return e.includePrefix&&(n="T"+n),n}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const i=xr.fromDurationLike(e),r={};for(const s of Yb)(wC(i.values,s)||wC(this.values,s))&&(r[s]=i.get(s)+this.get(s));return N0(this,{values:r},!0)}minus(e){if(!this.isValid)return this;const i=xr.fromDurationLike(e);return this.plus(i.negate())}mapUnits(e){if(!this.isValid)return this;const i={};for(const r of Object.keys(this.values))i[r]=axe(e(this.values[r],r));return N0(this,{values:i},!0)}get(e){return this[xr.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const i={...this.values,...o5(e,xr.normalizeUnit)};return N0(this,{values:i})}reconfigure({locale:e,numberingSystem:i,conversionAccuracy:r,matrix:s}={}){const o={loc:this.loc.clone({locale:e,numberingSystem:i}),matrix:s,conversionAccuracy:r};return N0(this,o)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return wYe(this.matrix,e),N0(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=xYe(this.normalize().shiftToAll().toObject());return N0(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(o=>xr.normalizeUnit(o));const i={},r={},s=this.toObject();let n;for(const o of Yb)if(e.indexOf(o)>=0){n=o;let a=0;for(const c in r)a+=this.matrix[c][o]*r[c],r[c]=0;cx(s[o])&&(a+=s[o]);const l=Math.trunc(a);i[o]=l,r[o]=(a*1e3-l*1e3)/1e3;for(const c in s)Yb.indexOf(c)>Yb.indexOf(o)&&xxe(this.matrix,s,c,i,o)}else cx(s[o])&&(r[o]=s[o]);for(const o in r)r[o]!==0&&(i[n]+=o===n?r[o]:r[o]/this.matrix[n][o]);return N0(this,{values:i},!0).normalize()}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const i of Object.keys(this.values))e[i]=this.values[i]===0?0:-this.values[i];return N0(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function i(r,s){return r===void 0||r===0?s===void 0||s===0:r===s}for(const r of Yb)if(!i(this.values[r],e.values[r]))return!1;return!0}}const RT="Invalid Interval";function TYe(t,e){return!t||!t.isValid?Sn.invalid("missing or invalid start"):!e||!e.isValid?Sn.invalid("missing or invalid end"):e<t?Sn.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class Sn{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,i=null){if(!e)throw new qh("need to specify a reason the Interval is invalid");const r=e instanceof Lp?e:new Lp(e,i);if(ao.throwOnInvalid)throw new YWe(r);return new Sn({invalid:r})}static fromDateTimes(e,i){const r=ZA(e),s=ZA(i),n=TYe(r,s);return n??new Sn({start:r,end:s})}static after(e,i){const r=xr.fromDurationLike(i),s=ZA(e);return Sn.fromDateTimes(s,s.plus(r))}static before(e,i){const r=xr.fromDurationLike(i),s=ZA(e);return Sn.fromDateTimes(s.minus(r),s)}static fromISO(e,i){const[r,s]=(e||"").split("/",2);if(r&&s){let n,o;try{n=$i.fromISO(r,i),o=n.isValid}catch{o=!1}let a,l;try{a=$i.fromISO(s,i),l=a.isValid}catch{l=!1}if(o&&l)return Sn.fromDateTimes(n,a);if(o){const c=xr.fromISO(s,i);if(c.isValid)return Sn.after(n,c)}else if(l){const c=xr.fromISO(r,i);if(c.isValid)return Sn.before(a,c)}}return Sn.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;const i=this.start.startOf(e),r=this.end.startOf(e);return Math.floor(r.diff(i,e).get(e))+1}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:i}={}){return this.isValid?Sn.fromDateTimes(e||this.s,i||this.e):this}splitAt(...e){if(!this.isValid)return[];const i=e.map(ZA).filter(o=>this.contains(o)).sort(),r=[];let{s}=this,n=0;for(;s<this.e;){const o=i[n]||this.e,a=+o>+this.e?this.e:o;r.push(Sn.fromDateTimes(s,a)),s=a,n+=1}return r}splitBy(e){const i=xr.fromDurationLike(e);if(!this.isValid||!i.isValid||i.as("milliseconds")===0)return[];let{s:r}=this,s=1,n;const o=[];for(;r<this.e;){const a=this.start.plus(i.mapUnits(l=>l*s));n=+a>+this.e?this.e:a,o.push(Sn.fromDateTimes(r,n)),r=n,s+=1}return o}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const i=this.s>e.s?this.s:e.s,r=this.e<e.e?this.e:e.e;return i>=r?null:Sn.fromDateTimes(i,r)}union(e){if(!this.isValid)return this;const i=this.s<e.s?this.s:e.s,r=this.e>e.e?this.e:e.e;return Sn.fromDateTimes(i,r)}static merge(e){const[i,r]=e.sort((s,n)=>s.s-n.s).reduce(([s,n],o)=>n?n.overlaps(o)||n.abutsStart(o)?[s,n.union(o)]:[s.concat([n]),o]:[s,o],[[],null]);return r&&i.push(r),i}static xor(e){let i=null,r=0;const s=[],n=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...n),a=o.sort((l,c)=>l.time-c.time);for(const l of a)r+=l.type==="s"?1:-1,r===1?i=l.time:(i&&+i!=+l.time&&s.push(Sn.fromDateTimes(i,l.time)),i=null);return Sn.merge(s)}difference(...e){return Sn.xor([this].concat(e)).map(i=>this.intersection(i)).filter(i=>i&&!i.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} – ${this.e.toISO()})`:RT}toLocaleString(e=r5,i={}){return this.isValid?al.create(this.s.loc.clone(i),e).formatInterval(this):RT}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:RT}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:RT}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:RT}toFormat(e,{separator:i=" – "}={}){return this.isValid?`${this.s.toFormat(e)}${i}${this.e.toFormat(e)}`:RT}toDuration(e,i){return this.isValid?this.e.diff(this.s,e,i):xr.invalid(this.invalidReason)}mapEndpoints(e){return Sn.fromDateTimes(e(this.s),e(this.e))}}class U${static hasDST(e=ao.defaultZone){const i=$i.now().setZone(e).set({month:12});return!e.isUniversal&&i.offset!==i.set({month:6}).offset}static isValidIANAZone(e){return Wy.isValidZone(e)}static normalizeZone(e){return nv(e,ao.defaultZone)}static months(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Ys.create(i,r,n)).months(e)}static monthsFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Ys.create(i,r,n)).months(e,!0)}static weekdays(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||Ys.create(i,r,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||Ys.create(i,r,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return Ys.create(e).meridiems()}static eras(e="short",{locale:i=null}={}){return Ys.create(i,null,"gregory").eras(e)}static features(){return{relative:nxe()}}}function Nne(t,e){const i=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=i(e)-i(t);return Math.floor(xr.fromMillis(r).as("days"))}function SYe(t,e,i){const r=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const h=Nne(l,c);return(h-h%7)/7}],["days",Nne]],s={},n=t;let o,a;for(const[l,c]of r)i.indexOf(l)>=0&&(o=l,s[l]=c(t,e),a=n.plus(s),a>e?(s[l]--,t=n.plus(s)):t=a);return[t,s,a,o]}function EYe(t,e,i,r){let[s,n,o,a]=SYe(t,e,i);const l=e-s,c=i.filter(p=>["hours","minutes","seconds","milliseconds"].indexOf(p)>=0);c.length===0&&(o<e&&(o=s.plus({[a]:1})),o!==s&&(n[a]=(n[a]||0)+l/(o-s)));const h=xr.fromObject(n,r);return c.length>0?xr.fromMillis(l,r).shiftTo(...c).plus(h):h}const vK={arab:"[٠-٩]",arabext:"[۰-۹]",bali:"[᭐-᭙]",beng:"[০-৯]",deva:"[०-९]",fullwide:"[０-９]",gujr:"[૦-૯]",hanidec:"[〇|一|二|三|四|五|六|七|八|九]",khmr:"[០-៩]",knda:"[೦-೯]",laoo:"[໐-໙]",limb:"[᥆-᥏]",mlym:"[൦-൯]",mong:"[᠐-᠙]",mymr:"[၀-၉]",orya:"[୦-୯]",tamldec:"[௦-௯]",telu:"[౦-౯]",thai:"[๐-๙]",tibt:"[༠-༩]",latn:"\\d"},Fne={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},CYe=vK.hanidec.replace(/[\[|\]]/g,"").split("");function AYe(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);if(t[i].search(vK.hanidec)!==-1)e+=CYe.indexOf(t[i]);else for(const s in Fne){const[n,o]=Fne[s];r>=n&&r<=o&&(e+=r-n)}}return parseInt(e,10)}else return e}function Ld({numberingSystem:t},e=""){return new RegExp(`${vK[t||"latn"]}${e}`)}const OYe="missing Intl.DateTimeFormat.formatToParts support";function Nr(t,e=i=>i){return{regex:t,deser:([i])=>e(AYe(i))}}const RYe=String.fromCharCode(160),Txe=`[ ${RYe}]`,Sxe=new RegExp(Txe,"g");function MYe(t){return t.replace(/\./g,"\\.?").replace(Sxe,Txe)}function Une(t){return t.replace(/\./g,"").replace(Sxe," ").toLowerCase()}function Dd(t,e){return t===null?null:{regex:RegExp(t.map(MYe).join("|")),deser:([i])=>t.findIndex(r=>Une(i)===Une(r))+e}}function Vne(t,e){return{regex:t,deser:([,i,r])=>HU(i,r),groups:e}}function Ak(t){return{regex:t,deser:([e])=>e}}function PYe(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function IYe(t,e){const i=Ld(e),r=Ld(e,"{2}"),s=Ld(e,"{3}"),n=Ld(e,"{4}"),o=Ld(e,"{6}"),a=Ld(e,"{1,2}"),l=Ld(e,"{1,3}"),c=Ld(e,"{1,6}"),h=Ld(e,"{1,9}"),p=Ld(e,"{2,4}"),f=Ld(e,"{4,6}"),m=b=>({regex:RegExp(PYe(b.val)),deser:([w])=>w,literal:!0}),_=(b=>{if(t.literal)return m(b);switch(b.val){case"G":return Dd(e.eras("short",!1),0);case"GG":return Dd(e.eras("long",!1),0);case"y":return Nr(c);case"yy":return Nr(p,WH);case"yyyy":return Nr(n);case"yyyyy":return Nr(f);case"yyyyyy":return Nr(o);case"M":return Nr(a);case"MM":return Nr(r);case"MMM":return Dd(e.months("short",!0,!1),1);case"MMMM":return Dd(e.months("long",!0,!1),1);case"L":return Nr(a);case"LL":return Nr(r);case"LLL":return Dd(e.months("short",!1,!1),1);case"LLLL":return Dd(e.months("long",!1,!1),1);case"d":return Nr(a);case"dd":return Nr(r);case"o":return Nr(l);case"ooo":return Nr(s);case"HH":return Nr(r);case"H":return Nr(a);case"hh":return Nr(r);case"h":return Nr(a);case"mm":return Nr(r);case"m":return Nr(a);case"q":return Nr(a);case"qq":return Nr(r);case"s":return Nr(a);case"ss":return Nr(r);case"S":return Nr(l);case"SSS":return Nr(s);case"u":return Ak(h);case"uu":return Ak(a);case"uuu":return Nr(i);case"a":return Dd(e.meridiems(),0);case"kkkk":return Nr(n);case"kk":return Nr(p,WH);case"W":return Nr(a);case"WW":return Nr(r);case"E":case"c":return Nr(i);case"EEE":return Dd(e.weekdays("short",!1,!1),1);case"EEEE":return Dd(e.weekdays("long",!1,!1),1);case"ccc":return Dd(e.weekdays("short",!0,!1),1);case"cccc":return Dd(e.weekdays("long",!0,!1),1);case"Z":case"ZZ":return Vne(new RegExp(`([+-]${a.source})(?::(${r.source}))?`),2);case"ZZZ":return Vne(new RegExp(`([+-]${a.source})(${r.source})?`),2);case"z":return Ak(/[a-z_+-/]{1,256}?/i);default:return m(b)}})(t)||{invalidReason:OYe};return _.token=t,_}const $Ye={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function LYe(t,e){const{type:i,value:r}=t;if(i==="literal")return{literal:!0,val:r};const s=e[i];let n=$Ye[i];if(typeof n=="object"&&(n=n[s]),n)return{literal:!1,val:n}}function DYe(t){return[`^${t.map(i=>i.regex).reduce((i,r)=>`${i}(${r.source})`,"")}$`,t]}function NYe(t,e,i){const r=t.match(e);if(r){const s={};let n=1;for(const o in i)if(wC(i,o)){const a=i[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(r.slice(n,n+l))),n+=l}return[r,s]}else return[r,{}]}function FYe(t){const e=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let i=null,r;return vr(t.z)||(i=Wy.create(t.z)),vr(t.Z)||(i||(i=new ul(t.Z)),r=t.Z),vr(t.q)||(t.M=(t.q-1)*3+1),vr(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),vr(t.u)||(t.S=pK(t.u)),[Object.keys(t).reduce((n,o)=>{const a=e(o);return a&&(n[a]=t[o]),n},{}),i,r]}let Ok=null;function UYe(){return Ok||(Ok=$i.fromMillis(1555555555555)),Ok}function VYe(t,e){if(t.literal)return t;const i=al.macroTokenToFormatOpts(t.val),r=Axe(i,e);return r==null||r.includes(void 0)?t:r}function Exe(t,e){return Array.prototype.concat(...t.map(i=>VYe(i,e)))}function Cxe(t,e,i){const r=Exe(al.parseFormat(i),t),s=r.map(o=>IYe(o,t)),n=s.find(o=>o.invalidReason);if(n)return{input:e,tokens:r,invalidReason:n.invalidReason};{const[o,a]=DYe(s),l=RegExp(o,"i"),[c,h]=NYe(e,l,a),[p,f,m]=h?FYe(h):[null,null,void 0];if(wC(h,"a")&&wC(h,"H"))throw new RR("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:r,regex:l,rawMatches:c,matches:h,result:p,zone:f,specificOffset:m}}}function kYe(t,e,i){const{result:r,zone:s,specificOffset:n,invalidReason:o}=Cxe(t,e,i);return[r,s,n,o]}function Axe(t,e){return t?al.create(e,t).formatDateTimeParts(UYe()).map(s=>LYe(s,t)):null}const Oxe=[0,31,59,90,120,151,181,212,243,273,304,334],Rxe=[0,31,60,91,121,152,182,213,244,274,305,335];function id(t,e){return new Lp("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function Mxe(t,e,i){const r=new Date(Date.UTC(t,e-1,i));t<100&&t>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const s=r.getUTCDay();return s===0?7:s}function Pxe(t,e,i){return i+(yI(t)?Rxe:Oxe)[e-1]}function Ixe(t,e){const i=yI(t)?Rxe:Oxe,r=i.findIndex(n=>n<e),s=e-i[r];return{month:r+1,day:s}}function XH(t){const{year:e,month:i,day:r}=t,s=Pxe(e,i,r),n=Mxe(e,i,r);let o=Math.floor((s-n+10)/7),a;return o<1?(a=e-1,o=n5(a)):o>n5(e)?(a=e+1,o=1):a=e,{weekYear:a,weekNumber:o,weekday:n,...qU(t)}}function kne(t){const{weekYear:e,weekNumber:i,weekday:r}=t,s=Mxe(e,1,4),n=HM(e);let o=i*7+r-s-3,a;o<1?(a=e-1,o+=HM(a)):o>n?(a=e+1,o-=HM(e)):a=e;const{month:l,day:c}=Ixe(a,o);return{year:a,month:l,day:c,...qU(t)}}function Rk(t){const{year:e,month:i,day:r}=t,s=Pxe(e,i,r);return{year:e,ordinal:s,...qU(t)}}function Bne(t){const{year:e,ordinal:i}=t,{month:r,day:s}=Ixe(e,i);return{year:e,month:r,day:s,...qU(t)}}function BYe(t){const e=jU(t.weekYear),i=wy(t.weekNumber,1,n5(t.weekYear)),r=wy(t.weekday,1,7);return e?i?r?!1:id("weekday",t.weekday):id("week",t.week):id("weekYear",t.weekYear)}function zYe(t){const e=jU(t.year),i=wy(t.ordinal,1,HM(t.year));return e?i?!1:id("ordinal",t.ordinal):id("year",t.year)}function $xe(t){const e=jU(t.year),i=wy(t.month,1,12),r=wy(t.day,1,s5(t.year,t.month));return e?i?r?!1:id("day",t.day):id("month",t.month):id("year",t.year)}function Lxe(t){const{hour:e,minute:i,second:r,millisecond:s}=t,n=wy(e,0,23)||e===24&&i===0&&r===0&&s===0,o=wy(i,0,59),a=wy(r,0,59),l=wy(s,0,999);return n?o?a?l?!1:id("millisecond",s):id("second",r):id("minute",i):id("hour",e)}const Mk="Invalid DateTime",zne=864e13;function V$(t){return new Lp("unsupported zone",`the zone "${t.name}" is not supported`)}function Pk(t){return t.weekData===null&&(t.weekData=XH(t.c)),t.weekData}function XA(t,e){const i={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new $i({...i,...e,old:i})}function Dxe(t,e,i){let r=t-e*60*1e3;const s=i.offset(r);if(e===s)return[r,e];r-=(s-e)*60*1e3;const n=i.offset(r);return s===n?[r,s]:[t-Math.min(s,n)*60*1e3,Math.max(s,n)]}function Gne(t,e){t+=e*60*1e3;const i=new Date(t);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function tF(t,e,i){return Dxe(mK(t),e,i)}function jne(t,e){const i=t.o,r=t.c.year+Math.trunc(e.years),s=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,n={...t.c,year:r,month:s,day:Math.min(t.c.day,s5(r,s))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},o=xr.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=mK(n);let[l,c]=Dxe(a,i,t.zone);return o!==0&&(l+=o,c=t.zone.offset(l)),{ts:l,o:c}}function YA(t,e,i,r,s,n){const{setZone:o,zone:a}=i;if(t&&Object.keys(t).length!==0){const l=e||a,c=$i.fromObject(t,{...i,zone:l,specificOffset:n});return o?c:c.setZone(a)}else return $i.invalid(new Lp("unparsable",`the input "${s}" can't be parsed as ${r}`))}function k$(t,e,i=!0){return t.isValid?al.create(Ys.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(t,e):null}function Ik(t,e){const i=t.c.year>9999||t.c.year<0;let r="";return i&&t.c.year>=0&&(r+="+"),r+=co(t.c.year,i?6:4),e?(r+="-",r+=co(t.c.month),r+="-",r+=co(t.c.day)):(r+=co(t.c.month),r+=co(t.c.day)),r}function Hne(t,e,i,r,s,n){let o=co(t.c.hour);return e?(o+=":",o+=co(t.c.minute),(t.c.second!==0||!i)&&(o+=":")):o+=co(t.c.minute),(t.c.second!==0||!i)&&(o+=co(t.c.second),(t.c.millisecond!==0||!r)&&(o+=".",o+=co(t.c.millisecond,3))),s&&(t.isOffsetFixed&&t.offset===0&&!n?o+="Z":t.o<0?(o+="-",o+=co(Math.trunc(-t.o/60)),o+=":",o+=co(Math.trunc(-t.o%60))):(o+="+",o+=co(Math.trunc(t.o/60)),o+=":",o+=co(Math.trunc(t.o%60)))),n&&(o+="["+t.zone.ianaName+"]"),o}const Nxe={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},GYe={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},jYe={ordinal:1,hour:0,minute:0,second:0,millisecond:0},Fxe=["year","month","day","hour","minute","second","millisecond"],HYe=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],qYe=["year","ordinal","hour","minute","second","millisecond"];function qne(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new Vwe(t);return e}function Wne(t,e){const i=nv(e.zone,ao.defaultZone),r=Ys.fromObject(e),s=ao.now();let n,o;if(vr(t.year))n=s;else{for(const c of Fxe)vr(t[c])&&(t[c]=Nxe[c]);const a=$xe(t)||Lxe(t);if(a)return $i.invalid(a);const l=i.offset(s);[n,o]=tF(t,l,i)}return new $i({ts:n,zone:i,loc:r,o})}function Xne(t,e,i){const r=vr(i.round)?!0:i.round,s=(o,a)=>(o=fK(o,r||i.calendary?0:2,!0),e.loc.clone(i).relFormatter(i).format(o,a)),n=o=>i.calendary?e.hasSame(t,o)?0:e.startOf(o).diff(t.startOf(o),o).get(o):e.diff(t,o).get(o);if(i.unit)return s(n(i.unit),i.unit);for(const o of i.units){const a=n(o);if(Math.abs(a)>=1)return s(a,o)}return s(t>e?-0:0,i.units[i.units.length-1])}function Yne(t){let e={},i;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],i=Array.from(t).slice(0,t.length-1)):i=Array.from(t),[e,i]}class $i{constructor(e){const i=e.zone||ao.defaultZone;let r=e.invalid||(Number.isNaN(e.ts)?new Lp("invalid input"):null)||(i.isValid?null:V$(i));this.ts=vr(e.ts)?ao.now():e.ts;let s=null,n=null;if(!r)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(i))[s,n]=[e.old.c,e.old.o];else{const a=i.offset(this.ts);s=Gne(this.ts,a),r=Number.isNaN(s.year)?new Lp("invalid input"):null,s=r?null:s,n=r?null:a}this._zone=i,this.loc=e.loc||Ys.create(),this.invalid=r,this.weekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new $i({})}static local(){const[e,i]=Yne(arguments),[r,s,n,o,a,l,c]=i;return Wne({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static utc(){const[e,i]=Yne(arguments),[r,s,n,o,a,l,c]=i;return e.zone=ul.utcInstance,Wne({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static fromJSDate(e,i={}){const r=yXe(e)?e.valueOf():NaN;if(Number.isNaN(r))return $i.invalid("invalid input");const s=nv(i.zone,ao.defaultZone);return s.isValid?new $i({ts:r,zone:s,loc:Ys.fromObject(i)}):$i.invalid(V$(s))}static fromMillis(e,i={}){if(cx(e))return e<-zne||e>zne?$i.invalid("Timestamp out of range"):new $i({ts:e,zone:nv(i.zone,ao.defaultZone),loc:Ys.fromObject(i)});throw new qh(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,i={}){if(cx(e))return new $i({ts:e*1e3,zone:nv(i.zone,ao.defaultZone),loc:Ys.fromObject(i)});throw new qh("fromSeconds requires a numerical input")}static fromObject(e,i={}){e=e||{};const r=nv(i.zone,ao.defaultZone);if(!r.isValid)return $i.invalid(V$(r));const s=ao.now(),n=vr(i.specificOffset)?r.offset(s):i.specificOffset,o=o5(e,qne),a=!vr(o.ordinal),l=!vr(o.year),c=!vr(o.month)||!vr(o.day),h=l||c,p=o.weekYear||o.weekNumber,f=Ys.fromObject(i);if((h||a)&&p)throw new RR("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new RR("Can't mix ordinal dates with month/day");const m=p||o.weekday&&!h;let y,_,b=Gne(s,n);m?(y=HYe,_=GYe,b=XH(b)):a?(y=qYe,_=jYe,b=Rk(b)):(y=Fxe,_=Nxe);let w=!1;for(const P of y){const F=o[P];vr(F)?w?o[P]=_[P]:o[P]=b[P]:w=!0}const S=m?BYe(o):a?zYe(o):$xe(o),T=S||Lxe(o);if(T)return $i.invalid(T);const E=m?kne(o):a?Bne(o):o,[O,R]=tF(E,n,r),L=new $i({ts:O,zone:r,o:R,loc:f});return o.weekday&&h&&e.weekday!==L.weekday?$i.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${L.toISO()}`):L}static fromISO(e,i={}){const[r,s]=oYe(e);return YA(r,s,i,"ISO 8601",e)}static fromRFC2822(e,i={}){const[r,s]=aYe(e);return YA(r,s,i,"RFC 2822",e)}static fromHTTP(e,i={}){const[r,s]=lYe(e);return YA(r,s,i,"HTTP",i)}static fromFormat(e,i,r={}){if(vr(e)||vr(i))throw new qh("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=r,o=Ys.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[a,l,c,h]=kYe(o,e,i);return h?$i.invalid(h):YA(a,l,r,`format ${i}`,e,c)}static fromString(e,i,r={}){return $i.fromFormat(e,i,r)}static fromSQL(e,i={}){const[r,s]=mYe(e);return YA(r,s,i,"SQL",e)}static invalid(e,i=null){if(!e)throw new qh("need to specify a reason the DateTime is invalid");const r=e instanceof Lp?e:new Lp(e,i);if(ao.throwOnInvalid)throw new XWe(r);return new $i({invalid:r})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,i={}){const r=Axe(e,Ys.fromObject(i));return r?r.map(s=>s?s.val:null).join(""):null}static expandFormat(e,i={}){return Exe(al.parseFormat(e),Ys.fromObject(i)).map(s=>s.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?Pk(this).weekYear:NaN}get weekNumber(){return this.isValid?Pk(this).weekNumber:NaN}get weekday(){return this.isValid?Pk(this).weekday:NaN}get ordinal(){return this.isValid?Rk(this.c).ordinal:NaN}get monthShort(){return this.isValid?U$.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?U$.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?U$.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?U$.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return yI(this.year)}get daysInMonth(){return s5(this.year,this.month)}get daysInYear(){return this.isValid?HM(this.year):NaN}get weeksInWeekYear(){return this.isValid?n5(this.weekYear):NaN}resolvedLocaleOptions(e={}){const{locale:i,numberingSystem:r,calendar:s}=al.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:i,numberingSystem:r,outputCalendar:s}}toUTC(e=0,i={}){return this.setZone(ul.instance(e),i)}toLocal(){return this.setZone(ao.defaultZone)}setZone(e,{keepLocalTime:i=!1,keepCalendarTime:r=!1}={}){if(e=nv(e,ao.defaultZone),e.equals(this.zone))return this;if(e.isValid){let s=this.ts;if(i||r){const n=e.offset(this.ts),o=this.toObject();[s]=tF(o,n,e)}return XA(this,{ts:s,zone:e})}else return $i.invalid(V$(e))}reconfigure({locale:e,numberingSystem:i,outputCalendar:r}={}){const s=this.loc.clone({locale:e,numberingSystem:i,outputCalendar:r});return XA(this,{loc:s})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const i=o5(e,qne),r=!vr(i.weekYear)||!vr(i.weekNumber)||!vr(i.weekday),s=!vr(i.ordinal),n=!vr(i.year),o=!vr(i.month)||!vr(i.day),a=n||o,l=i.weekYear||i.weekNumber;if((a||s)&&l)throw new RR("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&s)throw new RR("Can't mix ordinal dates with month/day");let c;r?c=kne({...XH(this.c),...i}):vr(i.ordinal)?(c={...this.toObject(),...i},vr(i.day)&&(c.day=Math.min(s5(c.year,c.month),c.day))):c=Bne({...Rk(this.c),...i});const[h,p]=tF(c,this.o,this.zone);return XA(this,{ts:h,o:p})}plus(e){if(!this.isValid)return this;const i=xr.fromDurationLike(e);return XA(this,jne(this,i))}minus(e){if(!this.isValid)return this;const i=xr.fromDurationLike(e).negate();return XA(this,jne(this,i))}startOf(e){if(!this.isValid)return this;const i={},r=xr.normalizeUnit(e);switch(r){case"years":i.month=1;case"quarters":case"months":i.day=1;case"weeks":case"days":i.hour=0;case"hours":i.minute=0;case"minutes":i.second=0;case"seconds":i.millisecond=0;break}if(r==="weeks"&&(i.weekday=1),r==="quarters"){const s=Math.ceil(this.month/3);i.month=(s-1)*3+1}return this.set(i)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,i={}){return this.isValid?al.create(this.loc.redefaultToEN(i)).formatDateTimeFromString(this,e):Mk}toLocaleString(e=r5,i={}){return this.isValid?al.create(this.loc.clone(i),e).formatDateTime(this):Mk}toLocaleParts(e={}){return this.isValid?al.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:i=!1,suppressMilliseconds:r=!1,includeOffset:s=!0,extendedZone:n=!1}={}){if(!this.isValid)return null;const o=e==="extended";let a=Ik(this,o);return a+="T",a+=Hne(this,o,i,r,s,n),a}toISODate({format:e="extended"}={}){return this.isValid?Ik(this,e==="extended"):null}toISOWeekDate(){return k$(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:i=!1,includeOffset:r=!0,includePrefix:s=!1,extendedZone:n=!1,format:o="extended"}={}){return this.isValid?(s?"T":"")+Hne(this,o==="extended",i,e,r,n):null}toRFC2822(){return k$(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return k$(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?Ik(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:i=!1,includeOffsetSpace:r=!0}={}){let s="HH:mm:ss.SSS";return(i||e)&&(r&&(s+=" "),i?s+="z":e&&(s+="ZZ")),k$(this,s,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():Mk}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const i={...this.c};return e.includeConfig&&(i.outputCalendar=this.outputCalendar,i.numberingSystem=this.loc.numberingSystem,i.locale=this.loc.locale),i}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,i="milliseconds",r={}){if(!this.isValid||!e.isValid)return xr.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...r},n=_Xe(i).map(xr.normalizeUnit),o=e.valueOf()>this.valueOf(),a=o?this:e,l=o?e:this,c=EYe(a,l,n,s);return o?c.negate():c}diffNow(e="milliseconds",i={}){return this.diff($i.now(),e,i)}until(e){return this.isValid?Sn.fromDateTimes(this,e):this}hasSame(e,i){if(!this.isValid)return!1;const r=e.valueOf(),s=this.setZone(e.zone,{keepLocalTime:!0});return s.startOf(i)<=r&&r<=s.endOf(i)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const i=e.base||$i.fromObject({},{zone:this.zone}),r=e.padding?this<i?-e.padding:e.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=e.unit;return Array.isArray(e.unit)&&(s=e.unit,n=void 0),Xne(i,this.plus(r),{...e,numeric:"always",units:s,unit:n})}toRelativeCalendar(e={}){return this.isValid?Xne(e.base||$i.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every($i.isDateTime))throw new qh("min requires all arguments be DateTimes");return $ne(e,i=>i.valueOf(),Math.min)}static max(...e){if(!e.every($i.isDateTime))throw new qh("max requires all arguments be DateTimes");return $ne(e,i=>i.valueOf(),Math.max)}static fromFormatExplain(e,i,r={}){const{locale:s=null,numberingSystem:n=null}=r,o=Ys.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return Cxe(o,e,i)}static fromStringExplain(e,i,r={}){return $i.fromFormatExplain(e,i,r)}static get DATE_SHORT(){return r5}static get DATE_MED(){return kwe}static get DATE_MED_WITH_WEEKDAY(){return JWe}static get DATE_FULL(){return Bwe}static get DATE_HUGE(){return zwe}static get TIME_SIMPLE(){return Gwe}static get TIME_WITH_SECONDS(){return jwe}static get TIME_WITH_SHORT_OFFSET(){return Hwe}static get TIME_WITH_LONG_OFFSET(){return qwe}static get TIME_24_SIMPLE(){return Wwe}static get TIME_24_WITH_SECONDS(){return Xwe}static get TIME_24_WITH_SHORT_OFFSET(){return Ywe}static get TIME_24_WITH_LONG_OFFSET(){return Zwe}static get DATETIME_SHORT(){return Jwe}static get DATETIME_SHORT_WITH_SECONDS(){return Kwe}static get DATETIME_MED(){return Qwe}static get DATETIME_MED_WITH_SECONDS(){return exe}static get DATETIME_MED_WITH_WEEKDAY(){return KWe}static get DATETIME_FULL(){return txe}static get DATETIME_FULL_WITH_SECONDS(){return ixe}static get DATETIME_HUGE(){return rxe}static get DATETIME_HUGE_WITH_SECONDS(){return sxe}}function ZA(t){if($i.isDateTime(t))return t;if(t&&t.valueOf&&cx(t.valueOf()))return $i.fromJSDate(t);if(t&&typeof t=="object")return $i.fromObject(t);throw new qh(`Unknown datetime argument: ${t}, of type ${typeof t}`)}function WYe(t,e="system"){if(!t||!Sne.has(t.timeZone))return e;const i=Sne.get(t.timeZone);return YYe(t.timeZone)||t.respectsDaylightSaving?i:XYe(i)}function XYe(t){const e=$i.local().setZone(t),i=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return i===0?"Etc/UTC":`Etc/GMT${ul.instance(-i).formatOffset(0,"narrow")}`}function YYe(t){return t.startsWith("UTC")}let R_=class extends Cs(Ie){constructor(e){super(e),this.legacy=null,this.timeZone="system"}readLegacy(e,i){const{timeZone:r,respectsDaylightSaving:s}=i;return{timeZone:r,respectsDaylightSaving:s}}readTimeZone(e,i){return"timeZoneIANA"in i?i.timeZoneIANA:WYe(i)}writeTimeZone(e,i){i.timeZoneIANA=e}equals(e){return!(C(e)||C(this.timeZone)||C(e.timeZone))&&this.timeZone===e.timeZone}};u([d()],R_.prototype,"legacy",void 0),u([Qe("legacy",["timeZone"])],R_.prototype,"readLegacy",null),u([d({type:String,nonNullable:!0})],R_.prototype,"timeZone",void 0),u([Qe("timeZone",["timeZone","timeZoneIANA","respectsDaylightSaving"])],R_.prototype,"readTimeZone",null),u([lt("timeZone")],R_.prototype,"writeTimeZone",null),R_=u([I("esri.time.TimeReference")],R_);const xC=R_;let Hg=class extends Cs(Ie){constructor(e){super(e),this.creatorField=null,this.creationDateField=null,this.editorField=null,this.editDateField=null,this.realm=null,this.dateFieldsTimeReference=null}};u([d()],Hg.prototype,"creatorField",void 0),u([d()],Hg.prototype,"creationDateField",void 0),u([d()],Hg.prototype,"editorField",void 0),u([d()],Hg.prototype,"editDateField",void 0),u([d()],Hg.prototype,"realm",void 0),u([d({type:xC})],Hg.prototype,"dateFieldsTimeReference",void 0),Hg=u([I("esri.layers.support.EditFieldsInfo")],Hg);const ZYe=Hg;let nm=class extends Cs(Ie){constructor(e){super(e)}};u([d({constructOnly:!0,json:{write:!0}})],nm.prototype,"name",void 0),u([d({constructOnly:!0,json:{write:!0}})],nm.prototype,"fields",void 0),u([d({constructOnly:!0,json:{write:!0}})],nm.prototype,"isAscending",void 0),u([d({constructOnly:!0,json:{write:!0}})],nm.prototype,"indexType",void 0),u([d({constructOnly:!0,json:{write:!0}})],nm.prototype,"isUnique",void 0),u([d({constructOnly:!0,json:{write:!0}})],nm.prototype,"description",void 0),nm=u([I("esri.layers.support.FeatureIndex")],nm);const YH=new Gi({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function JYe(t,e,i,r){const s=await b1(t);if(await bK(t,e,r),!s.addAttachment)throw new W(r,"Layer source does not support addAttachment capability");return s.addAttachment(e,i)}function bK(t,e,i){const{attributes:r}=e,{objectIdField:s}=t;return t.get("capabilities.data.supportsAttachment")?e?r?s&&r[s]?Promise.resolve():Promise.reject(new W(i,`feature is missing the identifying attribute ${s}`)):Promise.reject(new W(i,"'attributes' are required on a feature to query attachments")):Promise.reject(new W(i,"A feature is required to add/delete/update attachments")):Promise.reject(new W(i,"this layer doesn't support attachments"))}async function KYe(t,e,i,r,s){const n=await b1(t);if(await bK(t,e,s),!n.updateAttachment)throw new W(s,"Layer source does not support updateAttachment capability");return n.updateAttachment(e,i,r)}async function QYe(t,e,i){const r=await ee(()=>import("./editingSupport-e01ec74b.js"),["./editingSupport-e01ec74b.js","./assetEditingSupport-2cebf928.js"],import.meta.url),s=await t.load();return r.applyEdits(s,s.source,e,i)}async function eZe(t,e,i,r){const s=await b1(t);if(await bK(t,e,r),!s.deleteAttachments)throw new W(r,"Layer source does not support deleteAttachments capability");return s.deleteAttachments(e,i)}async function tZe(t,e,i){const r=(await t.load({signal:e==null?void 0:e.signal})).source;if(!r.fetchRecomputedExtents)throw new W(i,"Layer source does not support fetchUpdates capability");return r.fetchRecomputedExtents(e)}async function iZe(t,e,i,r){var m,y;e=wj.from(e),await t.load();const s=t.source,n=t.capabilities;if(!((m=n==null?void 0:n.data)!=null&&m.supportsAttachment))throw new W(r,"this layer doesn't support attachments");const{attachmentTypes:o,objectIds:a,globalIds:l,num:c,size:h,start:p,where:f}=e;if(!((y=n==null?void 0:n.operations)!=null&&y.supportsQueryAttachments)&&((o==null?void 0:o.length)>0||(l==null?void 0:l.length)>0||(h==null?void 0:h.length)>0||c||p||f))throw new W(r,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(a!=null&&a.length||l!=null&&l.length||f))throw new W(r,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!s.queryAttachments)throw new W(r,"Layer source does not support queryAttachments capability",e);return s.queryAttachments(e)}async function rZe(t,e,i,r){const s=await b1(t);if(!s.queryObjectIds)throw new W(r,"Layer source does not support queryObjectIds capability");return s.queryObjectIds(Mm.from(e)??t.createQuery(),i)}async function sZe(t,e,i,r){const s=await b1(t);if(!s.queryFeatureCount)throw new W(r,"Layer source does not support queryFeatureCount capability");return s.queryFeatureCount(Mm.from(e)??t.createQuery(),i)}async function nZe(t,e,i,r){const s=await b1(t);if(!s.queryExtent)throw new W(r,"Layer source does not support queryExtent capability");return s.queryExtent(Mm.from(e)??t.createQuery(),i)}async function oZe(t,e,i,r){const s=await b1(t);if(!s.queryRelatedFeatures)throw new W(r,"Layer source does not support queryRelatedFeatures capability");return s.queryRelatedFeatures(yC.from(e),i)}async function aZe(t,e,i,r){const s=await b1(t);if(!s.queryRelatedFeaturesCount)throw new W(r,"Layer source does not support queryRelatedFeaturesCount capability");return s.queryRelatedFeaturesCount(yC.from(e),i)}async function lZe(t){const e=t.source;if(e!=null&&e.refresh)try{const{dataChanged:i,updates:r}=await e.refresh();if(v(r)&&(t.sourceJSON={...t.sourceJSON,...r},t.read(r,{origin:"service",url:t.parsedUrl})),i)return!0}catch{}if(t.definitionExpression)try{return(await Jqe(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function cZe(t){const e=new Mm,i=t.get("capabilities.data"),r=t.get("capabilities.query");e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,r&&(e.compactGeometryEnabled=r.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),i&&(i.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),i.supportsM&&t.returnM!=null&&(e.returnM=t.returnM)),e.outFields=["*"];const{timeOffset:s,timeExtent:n}=t;return e.timeExtent=s!=null&&n!=null?n.offset(-s.value,s.unit):n||null,e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null,e}function Uxe(t){const{globalIdField:e,fields:i}=t;if(e)return e;if(i){for(const r of i)if(r.type==="esriFieldTypeGlobalID")return r.name}}function Vxe(t){const{objectIdField:e,fields:i}=t;if(e)return e;if(i){for(const r of i)if(r.type==="esriFieldTypeOID")return r.name}}function uZe(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}async function b1(t){return(await t.load()).source}async function hZe(t,e){if(!Cr||Cr.findCredential(t))return;let i;try{const r=await Bve(t,e);r&&(i=await Cr.checkSignInStatus(`${r}/sharing`))}catch{}if(i)try{const r=v(e)?e.signal:null;await Cr.getCredential(t,{signal:r})}catch{}}async function dZe(t,e){var s;const i=(s=t.parsedUrl)==null?void 0:s.path;if(!i)return;const r=t.editFieldsInfo;(t.userHasUpdateItemPrivileges||t.userHasFullEditingPrivileges&&t.capabilities.operations.supportsEditing||r!=null&&r.creatorField||r!=null&&r.editorField)&&await hZe(i,e)}function pZe(t){var e;return!((e=t.sourceJSON)!=null&&e.isMultiServicesView)&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}let lS=class extends Cs(Ie){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};u([d({type:String,json:{read:{source:"shapeAreaFieldName"}}})],lS.prototype,"shapeAreaField",void 0),u([d({type:String,json:{read:{source:"shapeLengthFieldName"}}})],lS.prototype,"shapeLengthField",void 0),u([d({type:String,json:{read:t=>h4e.read(t)||d4e.read(t)}})],lS.prototype,"units",void 0),lS=u([I("esri.layers.support.GeometryFieldsInfo")],lS);const fZe=lS;var ZH;let cS=ZH=class extends Ie{constructor(t){super(t),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new Nt}clone(){return new ZH({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};u([d({type:String,json:{write:!0}})],cS.prototype,"floorField",void 0),u([d({json:{read:!1,write:!1}})],cS.prototype,"viewAllMode",void 0),u([d({json:{read:!1,write:!1}})],cS.prototype,"viewAllLevelIds",void 0),cS=ZH=u([I("esri.layers.support.LayerFloorInfo")],cS);const mZe=cS,Zne=new Gi({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),Jne=new Gi({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let Ah=class extends Cs(Ie){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};u([d({json:{read:Zne.read,write:Zne.write}})],Ah.prototype,"cardinality",void 0),u([d({json:{read:!0,write:!0}})],Ah.prototype,"composite",void 0),u([d({json:{read:!0,write:!0}})],Ah.prototype,"id",void 0),u([d({json:{read:!0,write:!0}})],Ah.prototype,"keyField",void 0),u([d({json:{read:!0,write:!0}})],Ah.prototype,"keyFieldInRelationshipTable",void 0),u([d({json:{read:!0,write:!0}})],Ah.prototype,"name",void 0),u([d({json:{read:!0,write:!0}})],Ah.prototype,"relatedTableId",void 0),u([d({json:{read:!0,write:!0}})],Ah.prototype,"relationshipTableId",void 0),u([d({json:{read:Jne.read,write:Jne.write}})],Ah.prototype,"role",void 0),Ah=u([I("esri.layers.support.Relationship")],Ah);const gZe=Ah,yZe={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function ai(t,e,i){return!!(t&&t.hasOwnProperty(e)?t[e]:i)}function B$(t,e,i){return t&&t.hasOwnProperty(e)?t[e]:i}function _Ze(t){var i;const e=(i=t==null?void 0:t.supportedSpatialAggregationStatistics)==null?void 0:i.map(r=>r.toLowerCase());return{envelope:!!(e!=null&&e.includes("envelopeaggregate")),centroid:!!(e!=null&&e.includes("centroidaggregate")),convexHull:!!(e!=null&&e.includes("convexhullaggregate"))}}function bI(t,e){var r;const i=(r=t==null?void 0:t.supportedOperationsWithCacheHint)==null?void 0:r.map(s=>s.toLowerCase());return!!(i!=null&&i.includes(e.toLowerCase()))}function kxe(t,e){return{analytics:vZe(t),attachment:bZe(t),data:wZe(t),metadata:xZe(t),operations:TZe(t.capabilities,t,e),query:SZe(t,e),queryRelated:EZe(t),queryTopFeatures:CZe(t),editing:AZe(t)}}function vZe(t){return{supportsCacheHint:bI(t.advancedQueryCapabilities,"queryAnalytics")}}function bZe(t){const e=t.attachmentProperties,i={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:bI(t.advancedQueryCapabilities,"queryAttachments"),supportsResize:ai(t,"supportsAttachmentsResizing",!1)};return e&&Array.isArray(e)&&e.forEach(r=>{const s=yZe[r.name];s&&(i[s]=!!r.isEnabled)}),i}function wZe(t){return{isVersioned:ai(t,"isDataVersioned",!1),supportsAttachment:ai(t,"hasAttachments",!1),supportsM:ai(t,"hasM",!1),supportsZ:ai(t,"hasZ",!1)}}function xZe(t){return{supportsAdvancedFieldProperties:ai(t,"supportsFieldDescriptionProperty",!1)}}function TZe(t,e,i){const r=t?t.toLowerCase().split(",").map(f=>f.trim()):[],s=i?hA(i):null,n=r.includes(v(s)&&s.serverType==="MapServer"?"data":"query"),o=r.includes("editing")&&!e.datesInUnknownTimezone;let a=o&&r.includes("create"),l=o&&r.includes("delete"),c=o&&r.includes("update");const h=r.includes("changetracking"),p=e.advancedQueryCapabilities;return o&&!(a||l||c)&&(a=l=c=!0),{supportsCalculate:ai(e,"supportsCalculate",!1),supportsTruncate:ai(e,"supportsTruncate",!1),supportsValidateSql:ai(e,"supportsValidateSql",!1),supportsAdd:a,supportsDelete:l,supportsEditing:o,supportsChangeTracking:h,supportsQuery:n,supportsQueryAnalytics:ai(p,"supportsQueryAnalytic",!1),supportsQueryAttachments:ai(p,"supportsQueryAttachments",!1),supportsQueryTopFeatures:ai(p,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:ai(e,"supportsAttachmentsResizing",!1),supportsSync:r.includes("sync"),supportsUpdate:c,supportsExceedsLimitStatistics:ai(e,"supportsExceedsLimitStatistics",!1)}}function SZe(t,e){const i=t.advancedQueryCapabilities,r=t.ownershipBasedAccessControlForFeatures,s=t.archivingInfo,n=t.currentVersion,o=e==null?void 0:e.includes("MapServer"),a=!o||n>=de("mapserver-pbf-version-support"),l=Lwe(e),c=new Set((t.supportedQueryFormats??"").split(",").map(h=>h.toLowerCase().trim()));return{supportsStatistics:ai(i,"supportsStatistics",t.supportsStatistics),supportsPercentileStatistics:ai(i,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:ai(i,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:_Ze(i),supportsCentroid:ai(i,"supportsReturningGeometryCentroid",!1),supportsDistance:ai(i,"supportsQueryWithDistance",!1),supportsDistinct:ai(i,"supportsDistinct",t.supportsAdvancedQueries),supportsExtent:ai(i,"supportsReturningQueryExtent",!1),supportsGeometryProperties:ai(i,"supportsReturningGeometryProperties",!1),supportsHavingClause:ai(i,"supportsHavingClause",!1),supportsOrderBy:ai(i,"supportsOrderBy",t.supportsAdvancedQueries),supportsPagination:ai(i,"supportsPagination",!1),supportsQuantization:ai(t,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:ai(t,"supportsQuantizationEditMode",!1),supportsQueryGeometry:ai(t,"supportsReturningQueryGeometry",!1),supportsResultType:ai(i,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:ai(i,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:ai(i,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:ai(t,"useStandardizedQueries",!1),supportsTopFeaturesQuery:ai(i,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:ai(r,"allowOthersToQuery",!0),supportsHistoricMoment:ai(s,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:a&&c.has("pbf"),supportsDisjointSpatialRelationship:ai(i,"supportsDisjointSpatialRel",!1),supportsCacheHint:ai(i,"supportsQueryWithCacheHint",!1)||bI(i,"query"),supportsDefaultSpatialReference:ai(i,"supportsDefaultSR",!1),supportsCompactGeometry:l,supportsFullTextSearch:ai(i,"supportsFullTextSearch",!1),maxRecordCountFactor:B$(t,"maxRecordCountFactor",void 0),maxRecordCount:B$(t,"maxRecordCount",void 0),standardMaxRecordCount:B$(t,"standardMaxRecordCount",void 0),tileMaxRecordCount:B$(t,"tileMaxRecordCount",void 0)}}function EZe(t){const e=t.advancedQueryCapabilities,i=ai(e,"supportsAdvancedQueryRelated",!1);return{supportsPagination:ai(e,"supportsQueryRelatedPagination",!1),supportsCount:i,supportsOrderBy:i,supportsCacheHint:bI(e,"queryRelated")}}function CZe(t){return{supportsCacheHint:bI(t.advancedQueryCapabilities,"queryTopFilter")}}function AZe(t){const e=t.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:ai(t,"allowGeometryUpdates",!0),supportsGlobalId:ai(t,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:ai(t,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:ai(t,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:ai(t,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:ai(t,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:ai(e,"allowAnonymousToDelete",!0),supportsDeleteByOthers:ai(e,"allowOthersToDelete",!0),supportsUpdateByAnonymous:ai(e,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:ai(e,"allowOthersToUpdate",!0)}}const OZe=t=>{let e=class extends t{constructor(){super(...arguments),this.capabilities=null,this.copyright=null,this.dateFieldsTimeReference=null,this.datesInUnknownTimezone=!1,this.displayField=null,this.definitionExpression=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.isTable=!1,this.layerId=void 0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.preferredTimeReference=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.serviceItemId=null,this.spatialReference=mt.WGS84,this.subtypeField=null,this.trackIdField=null,this.indexes=new(Nt.ofType(nm)),this.version=void 0}readCapabilitiesFromService(i,r){return kxe(r,this.url)}get effectiveCapabilities(){var o;const i=this.capabilities;if(!i)return null;const r=ae(i),{operations:s,editing:n}=r;return(o=this.sourceJSON)!=null&&o.isMultiServicesView?(this.userHasUpdateItemPrivileges&&(s.supportsQuery=!0),r):this.userHasUpdateItemPrivileges?(s.supportsAdd=s.supportsDelete=s.supportsEditing=s.supportsQuery=s.supportsUpdate=n.supportsDeleteByOthers=n.supportsGeometryUpdate=n.supportsUpdateByOthers=!0,r):(this.userHasFullEditingPrivileges&&s.supportsEditing&&(s.supportsAdd=s.supportsDelete=s.supportsUpdate=n.supportsGeometryUpdate=!0),r)}readEditingInfo(i,r){const{editingInfo:s}=r;return s?{lastEditDate:s.lastEditDate!=null?new Date(s.lastEditDate):null}:null}readIsTableFromService(i,r){return r.type==="Table"}readMinScale(i,r){return r.effectiveMinScale||i||0}readMaxScale(i,r){return r.effectiveMaxScale||i||0}readGlobalIdFieldFromService(i,r){return Uxe(r)}readObjectIdFieldFromService(i,r){return Vxe(r)}readServiceDefinitionExpression(i,r){return r.definitionQuery||r.definitionExpression}set url(i){const r=TWe({layer:this,url:i,nonStandardUrlAllowed:!0,logger:oe.getLogger(this.declaredClass)});this._set("url",r.url),r.layerId!=null&&this._set("layerId",r.layerId)}writeUrl(i,r,s,n){SWe(this,i,null,r,n)}readVersion(i,r){return uZe(r)}};return u([d({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],e.prototype,"capabilities",void 0),u([Qe("service","capabilities")],e.prototype,"readCapabilitiesFromService",null),u([d({readOnly:!0})],e.prototype,"effectiveCapabilities",null),u([d({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],e.prototype,"copyright",void 0),u([d({type:xC})],e.prototype,"dateFieldsTimeReference",void 0),u([d({type:Boolean})],e.prototype,"datesInUnknownTimezone",void 0),u([d({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],e.prototype,"displayField",void 0),u([d({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],e.prototype,"definitionExpression",void 0),u([d({readOnly:!0,type:ZYe})],e.prototype,"editFieldsInfo",void 0),u([d({readOnly:!0})],e.prototype,"editingInfo",void 0),u([Qe("editingInfo")],e.prototype,"readEditingInfo",null),u([d((()=>{const i=ae(GWe),r=i.json.origins;return r["web-map"]={read:!1,write:!1},r["portal-item"]={read:!1,write:!1},i})())],e.prototype,"elevationInfo",void 0),u([d({type:mZe,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],e.prototype,"floorInfo",void 0),u([d({type:Pi,json:{origins:{service:{read:{source:"extent"}}}}})],e.prototype,"fullExtent",void 0),u([d()],e.prototype,"gdbVersion",void 0),u([d({readOnly:!0,type:fZe,json:{read:{source:"geometryProperties"}}})],e.prototype,"geometryFieldsInfo",void 0),u([d({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:YH.read}}}})],e.prototype,"geometryType",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasM",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasZ",void 0),u([d({readOnly:!0,type:iA})],e.prototype,"heightModelInfo",void 0),u([d({type:Date})],e.prototype,"historicMoment",void 0),u([d({readOnly:!0})],e.prototype,"isTable",void 0),u([Qe("service","isTable",["type"])],e.prototype,"readIsTableFromService",null),u([d({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],e.prototype,"layerId",void 0),u([d(qWe)],e.prototype,"minScale",void 0),u([Qe("service","minScale",["minScale","effectiveMinScale"])],e.prototype,"readMinScale",null),u([d(WWe)],e.prototype,"maxScale",void 0),u([Qe("service","maxScale",["maxScale","effectiveMaxScale"])],e.prototype,"readMaxScale",null),u([d({type:String})],e.prototype,"globalIdField",void 0),u([Qe("service","globalIdField",["globalIdField","fields"])],e.prototype,"readGlobalIdFieldFromService",null),u([d({type:String})],e.prototype,"objectIdField",void 0),u([Qe("service","objectIdField",["objectIdField","fields"])],e.prototype,"readObjectIdFieldFromService",null),u([d({type:xC})],e.prototype,"preferredTimeReference",void 0),u([d({type:[gZe],readOnly:!0})],e.prototype,"relationships",void 0),u([d()],e.prototype,"sourceJSON",void 0),u([d({type:Boolean})],e.prototype,"returnM",void 0),u([d({type:Boolean})],e.prototype,"returnZ",void 0),u([d({readOnly:!0})],e.prototype,"serviceDefinitionExpression",void 0),u([Qe("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],e.prototype,"readServiceDefinitionExpression",null),u([d({type:String,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],e.prototype,"serviceItemId",void 0),u([d({type:mt,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],e.prototype,"spatialReference",void 0),u([d({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],e.prototype,"subtypeField",void 0),u([d({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],e.prototype,"trackIdField",void 0),u([d({readOnly:!0,json:{write:!1}})],e.prototype,"serverGens",void 0),u([d({type:Nt.ofType(nm),readOnly:!0})],e.prototype,"indexes",void 0),u([d(BWe)],e.prototype,"url",null),u([lt("url")],e.prototype,"writeUrl",null),u([d({json:{origins:{service:{read:!0}},read:!1}})],e.prototype,"version",void 0),u([Qe("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],e.prototype,"readVersion",null),e=u([I("esri.layers.mixins.FeatureLayerBase")],e),e};let uS=class extends Cs(Ie){constructor(e){super(e),this.expression=null,this.title=null,this.returnType=null}};u([d({type:String,json:{write:!0}})],uS.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],uS.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],uS.prototype,"returnType",void 0),uS=u([I("esri.layers.support.ExpressionInfo")],uS);const wK=uS;var JH;let qg=JH=class extends Ie{constructor(t){super(t),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new JH({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:ae(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}};u([d({type:Boolean,json:{write:!0}})],qg.prototype,"isAutoGenerated",void 0),u([d({type:String,json:{write:!0}})],qg.prototype,"name",void 0),u([d({type:String,json:{write:!0}})],qg.prototype,"alias",void 0),u([d({type:String,json:{write:!0}})],qg.prototype,"onStatisticField",void 0),u([d({type:wK,json:{write:!0}})],qg.prototype,"onStatisticExpression",void 0),u([d({type:String,json:{write:!0}})],qg.prototype,"statisticType",void 0),qg=JH=u([I("esri.layers.support.AggregateField")],qg);const Ux=qg;let Nv=class extends Ie{constructor(){super(...arguments),this.type=null}};u([d({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],Nv.prototype,"type",void 0),Nv=u([I("esri.layers.support.FeatureReduction")],Nv);const xK="__begin__",TK="__end__",RZe=new RegExp(xK,"ig"),MZe=new RegExp(TK,"ig"),Kne=new RegExp("^"+xK,"i"),Qne=new RegExp(TK+"$","i"),a5='"',PZe=a5+" + ",IZe=" + "+a5;function $Ze(t){return t.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")}function LZe(t){return t.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")}function WU(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=$Ze(t.labelExpression),e.type="conventional"),e}function DZe(t){const e=WU(t);if(!e)return null;switch(e.type){case"conventional":return KH(e.expression);case"arcade":return e.expression}return null}function NZe(t){const e=WU(t);if(!e)return null;switch(e.type){case"conventional":return UZe(e.expression);case"arcade":return SK(e.expression)}return null}function KH(t){let e;return t?(e=Fm(t,i=>xK+'$feature["'+i+'"]'+TK),e=Kne.test(e)?e.replace(Kne,""):a5+e,e=Qne.test(e)?e.replace(Qne,""):e+a5,e=e.replace(RZe,PZe).replace(MZe,IZe)):e='""',e}const FZe=/^\s*\{([^}]+)\}\s*$/i;function UZe(t){const e=t==null?void 0:t.match(FZe);return e&&e[1].trim()||null}const VZe=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,kZe=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,BZe=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function SK(t){if(!t)return null;let e=VZe.exec(t)||kZe.exec(t);return e?e[1]||e[3]:(e=BZe.exec(t),e?e[2]:null)}var QH;let M_=QH=class extends Ie{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(t,e){return e.value?KH(e.value):t}writeExpression(t,e,i){this.value!=null&&(t=KH(this.value)),t!=null&&(e[i]=t)}clone(){return new QH({expression:this.expression,title:this.title,value:this.value})}};u([d({type:String,json:{write:{writerEnsuresNonNull:!0}}})],M_.prototype,"expression",void 0),u([Qe("expression",["expression","value"])],M_.prototype,"readExpression",null),u([lt("expression")],M_.prototype,"writeExpression",null),u([d({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],M_.prototype,"title",void 0),u([d({json:{read:!1,write:!1}})],M_.prototype,"value",void 0),M_=QH=u([I("esri.layers.support.LabelExpressionInfo")],M_);const Bxe=M_,zxe=[252,146,31,255],zIt=[153,153,153,255],zZe={type:"esriSMS",style:"esriSMSCircle",size:6,color:zxe,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},GZe={type:"esriSLS",style:"esriSLSSolid",width:.75,color:zxe},jZe={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},HZe={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},qZe={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},WZe={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},XZe={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},GIt=_1.fromJSON(zZe),jIt=Ed.fromJSON(GZe),HIt=y1.fromJSON(jZe),YZe=tA.fromJSON(HZe),qIt=_1.fromJSON(qZe),WIt=Ed.fromJSON(WZe),XIt=y1.fromJSON(XZe);var eq;const z$=new Gi({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function G$(t,e,i){return{enabled:!Vve(i==null?void 0:i.layer)}}function Gxe(t){var e;return!t||t.origin!=="service"&&((e=t.layer)==null?void 0:e.type)!=="map-image"}function ZZe(t){return(t==null?void 0:t.type)==="map-image"}function jxe(t){var e,i;return!!ZZe(t)&&!!((i=(e=t.capabilities)==null?void 0:e.exportMap)!=null&&i.supportsArcadeExpressionForLabeling)}function JZe(t){return Gxe(t)||jxe(t==null?void 0:t.layer)}let _n=eq=class extends Ie{static evaluateWhere(t,e){const i=(r,s,n)=>{switch(s){case"=":return r==n;case"<>":return r!=n;case">":return r>n;case">=":return r>=n;case"<":return r<n;case"<=":return r<=n}return!1};try{if(t==null)return!0;const r=t.split(" ");if(r.length===3)return i(e[r[0]],r[1],r[2]);if(r.length===7){const s=i(e[r[0]],r[1],r[2]),n=r[3],o=i(e[r[4]],r[5],r[6]);switch(n){case"AND":return s&&o;case"OR":return s||o}}return!1}catch{console.log("Error.: can't parse = "+t)}}constructor(t){super(t),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=YZe,this.useCodedValues=void 0,this.where=null}readLabelExpression(t,e){const i=e.labelExpressionInfo;if(!i||!i.value&&!i.expression)return t}writeLabelExpression(t,e,i){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)t=LZe(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const r=SK(this.labelExpressionInfo.expression);r&&(t="["+r+"]")}}t!=null&&(e[i]=t)}writeLabelExpressionInfo(t,e,i,r){if(t==null&&this.labelExpression!=null&&Gxe(r))t=new Bxe({expression:this.getLabelExpressionArcade()});else if(!t)return;const s=t.toJSON(r);s.expression&&(e[i]=s)}writeMaxScale(t,e){(t||this.minScale)&&(e.maxScale=t)}writeMinScale(t,e){(t||this.maxScale)&&(e.minScale=t)}getLabelExpression(){return WU(this)}getLabelExpressionArcade(){return DZe(this)}getLabelExpressionSingleField(){return NZe(this)}hash(){return JSON.stringify(this)}clone(){return new eq({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:ae(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:ae(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};u([d({type:String,json:{write:!0}})],_n.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:G$}}}}})],_n.prototype,"allowOverrun",void 0),u([d({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:G$}}}}})],_n.prototype,"deconflictionStrategy",void 0),u([d({type:String,json:{write:{overridePolicy(t,e,i){return this.labelExpressionInfo&&(i==null?void 0:i.origin)==="service"&&jxe(i.layer)?{enabled:!1}:{allowNull:!0}}}}})],_n.prototype,"labelExpression",void 0),u([Qe("labelExpression")],_n.prototype,"readLabelExpression",null),u([lt("labelExpression")],_n.prototype,"writeLabelExpression",null),u([d({type:Bxe,json:{write:{overridePolicy:(t,e,i)=>JZe(i)?{allowNull:!0}:{enabled:!1}}}})],_n.prototype,"labelExpressionInfo",void 0),u([lt("labelExpressionInfo")],_n.prototype,"writeLabelExpressionInfo",null),u([d({type:z$.apiValues,json:{type:z$.jsonValues,read:z$.read,write:z$.write}})],_n.prototype,"labelPlacement",void 0),u([d({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],_n.prototype,"labelPosition",void 0),u([d({type:Number})],_n.prototype,"maxScale",void 0),u([lt("maxScale")],_n.prototype,"writeMaxScale",null),u([d({type:Number})],_n.prototype,"minScale",void 0),u([lt("minScale")],_n.prototype,"writeMinScale",null),u([d({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:G$}}}}})],_n.prototype,"repeatLabel",void 0),u([d({type:Number,cast:mr,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:G$}}}}})],_n.prototype,"repeatLabelDistance",void 0),u([d({types:s8e,json:{origins:{"web-scene":{types:n8e,write:Kse,default:null}},write:Kse,default:null}})],_n.prototype,"symbol",void 0),u([d({type:Boolean,json:{write:!0}})],_n.prototype,"useCodedValues",void 0),u([d({type:String,json:{write:!0}})],_n.prototype,"where",void 0),_n=eq=u([I("esri.layers.support.LabelClass")],_n);const XU=_n;var tq;const $k=f1({types:dU}),KZe="esri.layers.support.FeatureReductionBinning";let Ul=tq=class extends Nv{constructor(t){super(t),this.type="binning",this.binType="geohash",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}writeFields(t,e,i){const r=t.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());gl(i,r,e)}readRenderer(t,e,i){var s;const r=(s=e.drawingInfo)==null?void 0:s.renderer;return r?Q3(r,e,i)??void 0:e.defaultSymbol?e.types&&e.types.length?new mI({defaultSymbol:$k(e.defaultSymbol,e,i),field:e.typeIdField,uniqueValueInfos:e.types.map(n=>({id:n.id,symbol:$k(n.symbol,n,i)}))}):new vC({symbol:$k(e.defaultSymbol,e,i)}):null}clone(){return new tq({fields:ae(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:ae(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:ae(this.popupTemplate),renderer:ae(this.renderer)})}};u([At({binning:"binning"})],Ul.prototype,"type",void 0),u([At({geohash:"geohash"})],Ul.prototype,"binType",void 0),u([d({type:Number,range:{min:1,max:9},json:{write:!0}})],Ul.prototype,"fixedBinLevel",void 0),u([d({type:[XU],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Ul.prototype,"labelingInfo",void 0),u([d(dK)],Ul.prototype,"labelsVisible",void 0),u([d({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],Ul.prototype,"maxScale",void 0),u([d(hK)],Ul.prototype,"popupEnabled",void 0),u([d({type:QP,json:{name:"popupInfo",write:!0}})],Ul.prototype,"popupTemplate",void 0),u([d({type:[Ux],json:{write:!0}})],Ul.prototype,"fields",void 0),u([lt("fields")],Ul.prototype,"writeFields",null),u([d({types:zU,json:{write:{target:"drawingInfo.renderer"}}})],Ul.prototype,"renderer",void 0),u([Qe("renderer",["drawingInfo.renderer"])],Ul.prototype,"readRenderer",null),Ul=tq=u([I(KZe)],Ul);const Hxe=Ul;var iq;const Lk=f1({types:dU}),QZe="esri.layers.support.FeatureReductionCluster";function eoe(t){var e;return t.type==="simple"&&!((e=t.visualVariables)!=null&&e.length)}let eo=iq=class extends Ie{constructor(t){super(t),this.type="cluster",this.clusterRadius=mr("80px"),this.clusterMinSize=mr("12px"),this.clusterMaxSize=mr("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}readRenderer(t,e,i){var s,n;const r=(s=e.drawingInfo)==null?void 0:s.renderer;return(n=r==null?void 0:r.authoringInfo)!=null&&n.isAutoGenerated?null:r?eoe(r)?null:Q3(r,e,i)??void 0:e.defaultSymbol?e.types&&e.types.length?new mI({defaultSymbol:Lk(e.defaultSymbol,e,i),field:e.typeIdField,uniqueValueInfos:e.types.map(o=>({id:o.id,symbol:Lk(o.symbol,o,i)}))}):new vC({symbol:Lk(e.defaultSymbol,e,i)}):null}readSymbol(t,e,i){var s,n,o;const r=(s=e.drawingInfo)==null?void 0:s.renderer;return(n=r==null?void 0:r.authoringInfo)!=null&&n.isAutoGenerated?null:r&&eoe(r)?(o=Q3(r,e,i))==null?void 0:o.symbol:null}writeSymbol(t,e,i,r){var n,o;const s=(o=(n=this.renderer)==null?void 0:n.authoringInfo)==null?void 0:o.isAutoGenerated;if(!this.renderer||s){const a=new vC({symbol:t});e.drawingInfo={renderer:a.write({},r)}}}writeFields(t,e,i){const r=t.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());gl(i,r,e)}readFields(t,e,i){return t.filter(r=>!r.isAutoGenerated).map(r=>Ux.fromJSON(r))}clone(){return new iq({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:ae(this.labelingInfo),labelsVisible:this.labelsVisible,fields:ae(this.fields),maxScale:this.maxScale,renderer:ae(this.renderer),symbol:ae(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:ae(this.popupTemplate)})}};u([d({type:["cluster"],readOnly:!0,json:{write:!0}})],eo.prototype,"type",void 0),u([d({type:Number,cast:t=>t==="auto"?t:mr(t),json:{write:!0}})],eo.prototype,"clusterRadius",void 0),u([d({type:Number,cast:mr,json:{write:!0}})],eo.prototype,"clusterMinSize",void 0),u([d({type:Number,cast:mr,json:{write:!0}})],eo.prototype,"clusterMaxSize",void 0),u([d({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],eo.prototype,"maxScale",void 0),u([d(hK)],eo.prototype,"popupEnabled",void 0),u([d({type:QP,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],eo.prototype,"popupTemplate",void 0),u([d({types:zU,json:{write:{target:"drawingInfo.renderer"}}})],eo.prototype,"renderer",void 0),u([Qe("renderer",["drawingInfo.renderer"])],eo.prototype,"readRenderer",null),u([d({types:i8e})],eo.prototype,"symbol",void 0),u([Qe("symbol",["drawingInfo.renderer"])],eo.prototype,"readSymbol",null),u([lt("symbol")],eo.prototype,"writeSymbol",null),u([d({type:[XU],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],eo.prototype,"labelingInfo",void 0),u([d(dK)],eo.prototype,"labelsVisible",void 0),u([d({type:[Ux],json:{write:!0}})],eo.prototype,"fields",void 0),u([lt("fields")],eo.prototype,"writeFields",null),u([Qe("fields")],eo.prototype,"readFields",null),eo=iq=u([I(QZe)],eo);const qxe=eo;var rq;let iF=rq=class extends Nv{constructor(t){super(t),this.type="selection"}clone(){return new rq}};u([d({type:["selection"]})],iF.prototype,"type",void 0),iF=rq=u([I("esri.layers.support.FeatureReductionSelection")],iF);const toe=iF,ioe={key:"type",base:Nv,typeMap:{cluster:qxe,binning:Hxe}},eJe={types:{key:"type",base:Nv,typeMap:{selection:toe,cluster:qxe,binning:Hxe}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:ioe},"portal-item":{types:ioe},"web-scene":{types:{key:"type",base:Nv,typeMap:{selection:toe}}}}}},MT={Base64:0,Hex:1,String:2,Raw:3},CE=8,Wxe=(1<<CE)-1;function Ev(t,e){const i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}function tJe(t){const e=[];for(let i=0,r=t.length*CE;i<r;i+=CE)e[i>>5]|=(t.charCodeAt(i/CE)&Wxe)<<i%32;return e}function iJe(t){const e=[];for(let i=0,r=32*t.length;i<r;i+=CE)e.push(String.fromCharCode(t[i>>5]>>>i%32&Wxe));return e.join("")}function rJe(t){const e="0123456789abcdef",i=[];for(let r=0,s=4*t.length;r<s;r++)i.push(e.charAt(t[r>>2]>>r%4*8+4&15)+e.charAt(t[r>>2]>>r%4*8&15));return i.join("")}function sJe(t){const e="=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=[];for(let s=0,n=4*t.length;s<n;s+=3){const o=(t[s>>2]>>s%4*8&255)<<16|(t[s+1>>2]>>(s+1)%4*8&255)<<8|t[s+2>>2]>>(s+2)%4*8&255;for(let a=0;a<4;a++)8*s+6*a>32*t.length?r.push(e):r.push(i.charAt(o>>6*(3-a)&63))}return r.join("")}function nJe(t,e){return t<<e|t>>>32-e}function YU(t,e,i,r,s,n){return Ev(nJe(Ev(Ev(e,t),Ev(r,n)),s),i)}function Ba(t,e,i,r,s,n,o){return YU(e&i|~e&r,t,e,s,n,o)}function za(t,e,i,r,s,n,o){return YU(e&r|i&~r,t,e,s,n,o)}function Ga(t,e,i,r,s,n,o){return YU(e^i^r,t,e,s,n,o)}function ja(t,e,i,r,s,n,o){return YU(i^(e|~r),t,e,s,n,o)}function oJe(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;let i=1732584193,r=-271733879,s=-1732584194,n=271733878;for(let o=0;o<t.length;o+=16){const a=i,l=r,c=s,h=n;i=Ba(i,r,s,n,t[o+0],7,-680876936),n=Ba(n,i,r,s,t[o+1],12,-389564586),s=Ba(s,n,i,r,t[o+2],17,606105819),r=Ba(r,s,n,i,t[o+3],22,-1044525330),i=Ba(i,r,s,n,t[o+4],7,-176418897),n=Ba(n,i,r,s,t[o+5],12,1200080426),s=Ba(s,n,i,r,t[o+6],17,-1473231341),r=Ba(r,s,n,i,t[o+7],22,-45705983),i=Ba(i,r,s,n,t[o+8],7,1770035416),n=Ba(n,i,r,s,t[o+9],12,-1958414417),s=Ba(s,n,i,r,t[o+10],17,-42063),r=Ba(r,s,n,i,t[o+11],22,-1990404162),i=Ba(i,r,s,n,t[o+12],7,1804603682),n=Ba(n,i,r,s,t[o+13],12,-40341101),s=Ba(s,n,i,r,t[o+14],17,-1502002290),r=Ba(r,s,n,i,t[o+15],22,1236535329),i=za(i,r,s,n,t[o+1],5,-165796510),n=za(n,i,r,s,t[o+6],9,-1069501632),s=za(s,n,i,r,t[o+11],14,643717713),r=za(r,s,n,i,t[o+0],20,-373897302),i=za(i,r,s,n,t[o+5],5,-701558691),n=za(n,i,r,s,t[o+10],9,38016083),s=za(s,n,i,r,t[o+15],14,-660478335),r=za(r,s,n,i,t[o+4],20,-405537848),i=za(i,r,s,n,t[o+9],5,568446438),n=za(n,i,r,s,t[o+14],9,-1019803690),s=za(s,n,i,r,t[o+3],14,-187363961),r=za(r,s,n,i,t[o+8],20,1163531501),i=za(i,r,s,n,t[o+13],5,-1444681467),n=za(n,i,r,s,t[o+2],9,-51403784),s=za(s,n,i,r,t[o+7],14,1735328473),r=za(r,s,n,i,t[o+12],20,-1926607734),i=Ga(i,r,s,n,t[o+5],4,-378558),n=Ga(n,i,r,s,t[o+8],11,-2022574463),s=Ga(s,n,i,r,t[o+11],16,1839030562),r=Ga(r,s,n,i,t[o+14],23,-35309556),i=Ga(i,r,s,n,t[o+1],4,-1530992060),n=Ga(n,i,r,s,t[o+4],11,1272893353),s=Ga(s,n,i,r,t[o+7],16,-155497632),r=Ga(r,s,n,i,t[o+10],23,-1094730640),i=Ga(i,r,s,n,t[o+13],4,681279174),n=Ga(n,i,r,s,t[o+0],11,-358537222),s=Ga(s,n,i,r,t[o+3],16,-722521979),r=Ga(r,s,n,i,t[o+6],23,76029189),i=Ga(i,r,s,n,t[o+9],4,-640364487),n=Ga(n,i,r,s,t[o+12],11,-421815835),s=Ga(s,n,i,r,t[o+15],16,530742520),r=Ga(r,s,n,i,t[o+2],23,-995338651),i=ja(i,r,s,n,t[o+0],6,-198630844),n=ja(n,i,r,s,t[o+7],10,1126891415),s=ja(s,n,i,r,t[o+14],15,-1416354905),r=ja(r,s,n,i,t[o+5],21,-57434055),i=ja(i,r,s,n,t[o+12],6,1700485571),n=ja(n,i,r,s,t[o+3],10,-1894986606),s=ja(s,n,i,r,t[o+10],15,-1051523),r=ja(r,s,n,i,t[o+1],21,-2054922799),i=ja(i,r,s,n,t[o+8],6,1873313359),n=ja(n,i,r,s,t[o+15],10,-30611744),s=ja(s,n,i,r,t[o+6],15,-1560198380),r=ja(r,s,n,i,t[o+13],21,1309151649),i=ja(i,r,s,n,t[o+4],6,-145523070),n=ja(n,i,r,s,t[o+11],10,-1120210379),s=ja(s,n,i,r,t[o+2],15,718787259),r=ja(r,s,n,i,t[o+9],21,-343485551),i=Ev(i,a),r=Ev(r,l),s=Ev(s,c),n=Ev(n,h)}return[i,r,s,n]}function Xxe(t,e=MT.Hex){const i=e||MT.Base64,r=oJe(tJe(t),t.length*CE);switch(i){case MT.Raw:return r;case MT.Hex:return rJe(r);case MT.String:return iJe(r);case MT.Base64:return sJe(r)}}var sq;let PR=sq=class extends BU{writeLevels(t,e,i){for(const r in t){const s=this.levels[r];return void(e.stops=s)}}clone(){return new sq({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:Sv(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:Sv(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone(),levels:ae(this.levels)})}};u([d()],PR.prototype,"levels",void 0),u([lt("levels")],PR.prototype,"writeLevels",null),PR=sq=u([I("esri.views.2d.engine.LevelDependentSizeVariable")],PR);const aJe=oe.getLogger("esri.views.2d.layers.support.clusterUtils");de.add("esri-cluster-arcade-enabled",!0);const lJe=de("esri-cluster-arcade-enabled"),cJe=(t,e,i,r,s)=>{const n=e.clone();if(!hJe(n))return n;if(n.authoringInfo||(n.authoringInfo=new rK),n.authoringInfo.isAutoGenerated=!0,"visualVariables"in n){const o=(n.visualVariables||[]).filter(l=>l.valueExpression!=="$view.scale"),a=Yxe(o);o.forEach(l=>{l.type==="rotation"?l.field?l.field=$1(t,l.field,"avg_angle","number"):l.valueExpression&&(l.field=JA(t,l.valueExpression,"avg_angle","number"),l.valueExpression=null):l.normalizationField?(l.field=$1(t,l.field,"avg_norm","number",l.normalizationField),l.normalizationField=null):l.field?l.field=$1(t,l.field,"avg","number"):l.valueExpression&&(l.field=JA(t,l.valueExpression,"avg","number"),l.valueExpression=null)}),C(a)&&!uJe(o)&&s&&(o.push(Zxe(i,r)),n.dynamicClusterSize=!0),n.visualVariables=o}switch(n.type){case"simple":break;case"pie-chart":for(const o of n.attributes)o.field?o.field=$1(t,o.field,"sum","number"):o.valueExpression&&(o.field=JA(t,o.valueExpression,"sum","number"),o.valueExpression=null);break;case"unique-value":n.field?n.field=$1(t,n.field,"mode","string"):n.valueExpression&&(n.field=JA(t,n.valueExpression,"mode","string"),n.valueExpression=null);break;case"class-breaks":n.normalizationField?(n.field=$1(t,n.field,"avg_norm","number",n.normalizationField),n.normalizationField=null):n.field?n.field=$1(t,n.field,"avg","number"):n.valueExpression&&(n.field=JA(t,n.valueExpression,"avg","number"),n.valueExpression=null)}return n},Yxe=t=>{for(const e of t)if(e.type==="size")return e;return null};function YIt(t,e,i){const r=t.clone();let s=!1;if("visualVariables"in r){const n=(r.visualVariables||[]).filter(a=>a.valueExpression!=="$view.scale"),o=Yxe(n);C(o)&&(r.visualVariables||(r.visualVariables=[]),r.visualVariables.push(Zxe(e,i)),r.dynamicClusterSize=!0,s=!0)}return{renderer:r,didInject:s}}const uJe=t=>{for(const e of t)if(e.field==="cluster_count")return!0;return!1},Zxe=(t,e)=>{const i=[new iS({value:0,size:0}),new iS({value:1})];if(C(e))return new BU({field:"cluster_count",stops:[...i,new iS({value:2,size:0})]});const r=Object.keys(e).reduce((s,n)=>({...s,[n]:[...i,new iS({value:Math.max(2,e[n].minValue),size:t.clusterMinSize}),new iS({value:Math.max(3,e[n].maxValue),size:t.clusterMaxSize})]}),{});return new PR({field:"cluster_count",levels:r})},hJe=t=>{const e=i=>aJe.error(new W("Unsupported-renderer",i,{renderer:t}));switch(t.type){case"unique-value":if(t.field2||t.field3)return e("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(t.normalizationField){const i=t.normalizationType;if(i!=="field")return e(`FeatureReductionCluster does not support a normalizationType of ${i}`),!1}break;case"simple":case"pie-chart":break;default:return e(`FeatureReductionCluster does not support renderers of type ${t.type}`),!1}if(!lJe){if("valueExpression"in t&&t.valueExpression)return e("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in t&&t.visualVariables||[]).some(i=>!(!("valueExpression"in i)||!i.valueExpression)))return e("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function dJe(t,e,i){switch(t){case"sum":return`cluster_sum_${e}`;case"avg":case"avg_angle":return`cluster_avg_${e}`;case"mode":return`cluster_type_${e}`;case"avg_norm":{const r=i,s="field",n=e.toLowerCase()+",norm:"+s+","+r.toLowerCase();return"cluster_avg_"+Xxe(n)}}}function JA(t,e,i,r){const s=Xxe(e),n=i==="mode"?`cluster_type_${s}`:i==="sum"?`cluster_sum_${s}`:`cluster_avg_${s}`;return t.some(o=>o.name===n)||t.push(new Ux({name:n,isAutoGenerated:!0,onStatisticExpression:new wK({expression:e,returnType:r}),statisticType:i})),n}function $1(t,e,i,r,s){if(e==="cluster_count"||t.some(o=>o.name===e))return e;const n=dJe(i,e,s);return t.some(o=>o.name===n)||(i==="avg_norm"?t.push(new Ux({name:n,isAutoGenerated:!0,onStatisticExpression:new wK({expression:`$feature.${e} / $feature.${s}`,returnType:r}),statisticType:"avg"})):t.push(new Ux({name:n,isAutoGenerated:!0,onStatisticField:e,statisticType:i}))),n}const pJe=t=>{let e=class extends t{constructor(...i){super(...i),this.own(this.watch("renderer",()=>{if(this.featureReduction){const r=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",r)}},!0))}set featureReduction(i){const r=this._normalizeFeatureReduction(i);this._set("featureReduction",r)}set renderer(i){}_normalizeFeatureReduction(i){var a;if((i==null?void 0:i.type)!=="cluster")return i;const r=i.clone(),s=[new Ux({name:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],n=(r.fields??[]).filter(l=>!l.isAutoGenerated);if(i.renderer&&!((a=i.renderer.authoringInfo)!=null&&a.isAutoGenerated))return r.fields=[...s,...n],r;if(i.symbol)return r.fields=[...s,...n],r.renderer=null,r;if(!this.renderer)return i;const o=cJe(s,this.renderer,i,null,!1);return r.fields=[...s,...n],r.renderer=o,r}};return u([d(eJe)],e.prototype,"featureReduction",null),e=u([I("esri.layers.mixins.FeatureReductionLayer")],e),e},fJe={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0,LineOfSightLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":{ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-map/basemap":{ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},"web-map/tables":{ArcGISFeatureLayer:!0},"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0,OrientedImageryLayer:!0}},mJe=t=>{let e=class extends t{constructor(){super(...arguments),this.title=null}writeListMode(i,r,s,n){(n&&n.layerContainerType==="ground"||i&&UFe(this,s,{},n))&&(r[s]=i)}writeOperationalLayerType(i,r,s,n){!i||n&&n.layerContainerType==="tables"||(r.layerType=i)}writeTitle(i,r){r.title=i??"Layer"}read(i,r){r&&(r.layer=this),DFe(this,i,s=>super.read(i,s),r)}write(i,r){var o,a;if(r!=null&&r.origin){const l=`${r.origin}/${r.layerContainerType||"operational-layers"}`,c=fJe[l];let h=c&&c[this.operationalLayerType];if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&l==="web-scene/operational-layers"&&(h=!1),this.operationalLayerType==="ArcGISDimensionLayer"&&l==="web-map/operational-layers"&&(h=!1),!h)return(o=r.messages)==null||o.push(new W("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${l}'`,{layer:this})),null}const s=super.write(i,{...r,layer:this}),n=!!r&&!!r.messages&&!!r.messages.filter(l=>l instanceof W&&l.name==="web-document-write:property-required").length;return nC(s==null?void 0:s.url)?((a=r==null?void 0:r.messages)==null||a.push(new W("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&n?null:s}beforeSave(){}};return u([d({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],e.prototype,"id",void 0),u([d(Uwe)],e.prototype,"listMode",void 0),u([lt("listMode")],e.prototype,"writeListMode",null),u([d({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],e.prototype,"operationalLayerType",void 0),u([lt("operationalLayerType")],e.prototype,"writeOperationalLayerType",null),u([d(zH)],e.prototype,"opacity",void 0),u([d({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],e.prototype,"title",void 0),u([lt("title"),lt(["web-scene"],"title")],e.prototype,"writeTitle",null),u([d({type:Boolean,json:{name:"visibility"}})],e.prototype,"visible",void 0),e=u([I("esri.layers.mixins.OperationalLayer")],e),e};var nq;const Dk=new Gi({asc:"ascending",desc:"descending"});let hS=nq=class extends Ie{constructor(t){super(t),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new nq({field:this.field,valueExpression:this.valueExpression,order:this.order})}};u([d({type:String,json:{write:!0}})],hS.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],hS.prototype,"valueExpression",void 0),u([d({type:Dk.apiValues,json:{read:Dk.read,write:Dk.write}})],hS.prototype,"order",void 0),hS=nq=u([I("esri.layers.support.OrderByInfo")],hS);const Jxe=hS;function gJe(t,e,i){if(!t)return null;const r=t.find(n=>!!n.field);if(!r)return null;const s=new Jxe;return s.read(r,i),[s]}function yJe(t,e,i,r){const s=t.find(n=>!!n.field);s&&gl(i,[s.toJSON()],e)}const _Je=t=>{let e=class extends t{constructor(){super(...arguments),this.orderBy=null}};return u([d({type:[Jxe],json:{origins:{"web-scene":{write:!1,read:!1}},read:{source:"layerDefinition.orderBy",reader:gJe},write:{target:"layerDefinition.orderBy",writer:yJe}}})],e.prototype,"orderBy",void 0),e=u([I("esri.layers.mixins.OrderedLayer")],e),e};let P_=class extends $e{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?{...e,path:this._normalizePath(e.path,e.portalItem)}:e}set path(e){v(e)&&Zu(e)?oe.getLogger(this.declaredClass).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",i){const r=this.url;if(C(r))throw new W("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(r,{responseType:e,query:{token:this.portalItem.apiKey},signal:In(i,"signal")})}async update(e,i){return(await ee(()=>import("./resourceUtils-357afe82.js"),[],import.meta.url)).addOrUpdateResource(this,"update",e,i)}hasPath(){return v(this.path)}_normalizePath(e,i){return C(e)?e:(e=e.replace(/^\/+/,""),v(i)&&Zu(e)&&(e=VZ(e,i.itemUrl)),e==null?void 0:e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};u([d()],P_.prototype,"portalItem",void 0),u([d({type:String,value:null})],P_.prototype,"path",null),u([wi("path")],P_.prototype,"_castPath",null),u([d({type:String,readOnly:!0})],P_.prototype,"url",null),u([d({type:String,readOnly:!0})],P_.prototype,"itemRelativeUrl",null),P_=u([I("esri.portal.PortalItemResource")],P_);const vJe=P_;let IR=class extends $e{constructor(e){super(e),this.created=null,this.rating=null}};u([d()],IR.prototype,"created",void 0),u([d()],IR.prototype,"rating",void 0),IR=u([I("esri.portal.PortalRating")],IR);const Nk=IR;var Zb;const bJe=new Set(["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","GeoJson","CSV","KML","WFS","WMTS","WMS","Feed"]),wJe=new Set(["KML","GeoJson","CSV"]);let Ei=Zb=class extends YP(Hy){static from(t){return XE(Zb,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let i=t;return t==="Feature Service"||t==="Feature Collection"?i=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?i=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?i="Scene Layer":t==="Video Service"?i="Video Layer":t==="Scene Package"?i="Scene Layer Package":t==="Stream Service"?i="Feature Layer":t==="Geoprocessing Service"&&this.portal&&this.portal.isPortal?i=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geocoding Service"?i="Locator":t==="Geoenrichment Service"?i="GeoEnrichment Service":t==="Microsoft Powerpoint"?i="Microsoft PowerPoint":t==="GeoJson"?i="GeoJSON":t==="Globe Service"?i="Globe Layer":t==="Vector Tile Service"?i="Tile Layer":t==="netCDF"?i="NetCDF":t==="Map Service"?i=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t&&t.toLowerCase().includes("add in")?i=t.replace(/(add in)/gi,"Add-In"):t==="datastore catalog service"?i="Big Data File Share":t==="Compact Tile Package"?i="Tile Package (tpkx)":t==="OGCFeatureServer"?i="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?i="Instant App":t==="Insights Page"&&(i="Insights Report"),i}readExtent(t){return t&&t.length?new Pi(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){const t=this.type&&this.type.toLowerCase()||"",e=this.typeKeywords||[],i="esri/images/portal/",r="16";let s,n=!1,o=!1,a=!1,l=!1,c=!1,h=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(n=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(o=e.includes("Table"),a=e.includes("Route Layer"),l=e.includes("Markup"),c=e.includes("Spatiotemporal"),h=e.includes("UtilityNetwork"),s=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":n?"featureshosted":h?"utilitynetwork":"features"):s=t==="map service"||t==="wms"||t==="wmts"?n||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages":t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="video service"?"mediaservice":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="geoprocessing service"?e.includes("Web Tool")&&this.portal&&this.portal.isPortal?"tool":"layers":t==="geodata service"?"geodataservice":"layers"):s=t==="web map"||t==="cityengine web scene"?"maps":t==="web scene"?e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?"instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?"apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?"mapsgray":t==="service definition"||t==="csv"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="360 vr experience"||t==="netcdf"||t==="administrative report"?"datafiles":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?"appsgray":t==="arcgis pro add in"||t==="arcgis pro configuration"?"addindesktop":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="form"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="image"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?"datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?"toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?"layersgray":t==="scene package"?"scenepackage":t==="mobile scene package"?"mobilescenepackage":t==="tile package"||t==="compact tile package"?"tilepackage":t==="task file"?"taskfile":t==="report template"?"report-template":t==="statistical data collection"?"statisticaldatacollection":t==="insights workbook"?"workbook":t==="insights model"?"insightsmodel":t==="insights page"?"insightspage":t==="insights theme"?"insightstheme":t==="hub initiative"?"hubinitiative":t==="hubpage"?"hubpage":t==="hub event"?"hubevent":t==="hub site application"?"hubsite":t==="hub project"?"hubproject":t==="relational database connection"?"relationaldatabaseconnection":t==="big data file share"?"datastorecollection":t==="image collection"?"imagecollection":t==="style"?"style":t==="desktop style"?"desktopstyle":t==="dashboard"?"dashboard":t==="raster function template"?"rasterprocessingtemplate":t==="vector tile package"?"vectortilepackage":t==="ortho mapping project"?"orthomappingproject":t==="ortho mapping template"?"orthomappingtemplate":t==="solution"?"solutions":t==="geopackage"?"geopackage":t==="deep learning package"?"deeplearningpackage":t==="real time analytic"?"realtimeanalytics":t==="big data analytic"?"bigdataanalytics":t==="feed"?"feed":t==="excalibur imagery project"?"excaliburimageryproject":t==="notebook"?"notebook":t==="storymap"?"storymap":t==="survey123 add in"?"survey123addin":t==="mission"?"mission":t==="mission report"?"missionreport":t==="quickcapture project"?"quickcaptureproject":t==="pro report"?"proreport":t==="pro report template"?"proreporttemplate":t==="urban model"?"urbanmodel":t==="web experience"?"experiencebuilder":t==="web experience template"?"webexperiencetemplate":t==="experience builder widget"?"experiencebuilderwidget":t==="experience builder widget package"?"experiencebuilderwidgetpackage":t==="workflow"?"workflow":t==="insights script"?"insightsscript":t==="kernel gateway connection"?"kernelgatewayconnection":t==="hub initiative template"?"hubinitiativetemplate":t==="storymap theme"?"storymaptheme":t==="knowledge graph"?"knowledgegraph":t==="native application"?"nativeapp":t==="native application installer"?"nativeappinstaller":t==="link chart"?"linkchart":t==="investigation"?"investigation":t==="ogcfeatureserver"?"features":t==="pro project"?"proproject":t==="insights workbook package"?"insightsworkbookpackage":t==="apache parquet"?"apacheparquet":t==="notebook code snippets"||t==="notebook code snippet library"?"notebookcodesnippets":t==="suitability model"?"suitabilitymodel":t==="esri classifier definition"?"classifierdefinition":t==="esri classification schema"?"classificationschema":t==="insights data engineering workbook"?"dataengineeringworkbook":t==="insights data engineering model"?"dataengineeringmodel":t==="deep learning studio project"?"deeplearningproject":t==="discussion"?"discussion":t==="allsource project"?"allsourceproject":t==="api key"?"apikey":"maps",s?ir(i+s+r+".png"):null}get isLayer(){return this.type!=null&&bJe.has(this.type)}get itemPageUrl(){var e;const t=(e=this.portal)==null?void 0:e.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get thumbnailUrl(){var i;const t=this.itemUrl,e=this.thumbnail;return t&&e?((i=this.portal)==null?void 0:i.normalizeUrl(`${t}/info/${e}?f=json`))??null:null}get userItemUrl(){const t=this.get("portal.restUrl");if(!t)return null;const e=this.owner||this.get("portal.user.username");return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=uc.getDefault()),i=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:v(t)?t.signal:null,query:{token:this.apiKey}}):{}).then(r=>{this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(i),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}};return t instanceof Nk&&(t=t.rating),t==null||isNaN(t)||typeof t!="number"||(e.query.rating=t),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new Nk({rating:t,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:ae(this.applicationProxies),avgRating:this.avgRating,categories:ae(this.categories),created:ae(this.created),culture:this.culture,description:this.description,extent:ae(this.extent),groupCategories:ae(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:ae(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:ae(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:ae(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ae(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new Zb({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){const t=this.toJSON();for(const i of["tags","typeKeywords","categories"])t[i]&&(t[i]=t[i].join(", "));const{extent:e}=t;return e&&(t.extent=JSON.stringify(e)),t}async deleteRating(){await Jl(this.portal).request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return Jl(this.portal).request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await Jl(this.portal).request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new Nk(e)):null}fetchRelatedItems(t,e){return Jl(this.portal).requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},Zb)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return Jl(this.portal).request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>Jl(this.portal).signIn()).then(()=>{const e=t&&t.data,i={method:"post"};i.query=this.createPostQuery();for(const r in i.query)i.query[r]===null&&(i.query[r]="");return i.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?i.query.text=e:typeof e=="object"&&(i.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,i).then(()=>this.reload())}):Promise.reject(new W("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new W("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:i}=this;await Jl(e).signIn();const{copyResources:r,folder:s,tags:n,title:o}=t||{},a={method:"post",query:{copyPrivateResources:r==="all",folder:typeof s=="string"?s:s==null?void 0:s.id,includeResources:!!r,tags:n==null?void 0:n.join(","),title:o}},{itemId:l}=await e.request(`${i}/copy`,a);return new Zb({id:l,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,i=t.filename,r={method:"post"};if(typeof e=="string")Qm(e)?r.query={data:e}:r.query={url:Gu(e)},v(i)&&(r.query.filename=i);else{const s=new FormData;v(i)?s.append("file",e,i):s.append("file",e),r.body=s}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,r).then(()=>this.reload())}):Promise.reject(new W("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){return(await ee(()=>import("./resourceUtils-357afe82.js"),[],import.meta.url)).fetchResources(this,t,e)}async addResource(t,e,i){const r=await ee(()=>import("./resourceUtils-357afe82.js"),[],import.meta.url);return t.portalItem=this,r.addOrUpdateResource(t,"add",e,i)}async removeResource(t,e){const i=await ee(()=>import("./resourceUtils-357afe82.js"),[],import.meta.url);if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new W("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i.removeResource(this,t,e)}async removeAllResources(t){return(await ee(()=>import("./resourceUtils-357afe82.js"),[],import.meta.url)).removeAllResources(this,t)}resourceFromPath(t){return new vJe({portalItem:this,path:t})}toJSON(){const t=this.extent,e={accessInformation:this.accessInformation,categories:ae(this.categories),created:this.created&&this.created.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:ae(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ae(this.typeKeywords),url:this.url};return ome(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new Zb({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};u([d({type:["private","shared","org","public"]})],Ei.prototype,"access",void 0),u([d()],Ei.prototype,"accessInformation",void 0),u([d({type:String})],Ei.prototype,"apiKey",void 0),u([d({json:{read:{source:"appProxies"}}})],Ei.prototype,"applicationProxies",void 0),u([d()],Ei.prototype,"avgRating",void 0),u([d()],Ei.prototype,"categories",void 0),u([d({type:Date})],Ei.prototype,"created",void 0),u([d()],Ei.prototype,"culture",void 0),u([d()],Ei.prototype,"description",void 0),u([d({readOnly:!0})],Ei.prototype,"displayName",null),u([d({type:Pi})],Ei.prototype,"extent",void 0),u([Qe("extent")],Ei.prototype,"readExtent",null),u([d()],Ei.prototype,"groupCategories",void 0),u([d({readOnly:!0})],Ei.prototype,"iconUrl",null),u([d()],Ei.prototype,"id",void 0),u([d({readOnly:!0})],Ei.prototype,"isLayer",null),u([d({type:Boolean,readOnly:!0})],Ei.prototype,"isOrgItem",void 0),u([d()],Ei.prototype,"itemControl",void 0),u([d({readOnly:!0})],Ei.prototype,"itemPageUrl",null),u([d({readOnly:!0})],Ei.prototype,"itemUrl",null),u([d()],Ei.prototype,"licenseInfo",void 0),u([d({type:Date})],Ei.prototype,"modified",void 0),u([d()],Ei.prototype,"name",void 0),u([d()],Ei.prototype,"numComments",void 0),u([d()],Ei.prototype,"numRatings",void 0),u([d()],Ei.prototype,"numViews",void 0),u([d()],Ei.prototype,"owner",void 0),u([d()],Ei.prototype,"ownerFolder",void 0),u([d({type:uc})],Ei.prototype,"portal",void 0),u([d()],Ei.prototype,"screenshots",void 0),u([d()],Ei.prototype,"size",void 0),u([d()],Ei.prototype,"snippet",void 0),u([d()],Ei.prototype,"sourceJSON",void 0),u([d({type:String})],Ei.prototype,"sourceUrl",void 0),u([d({type:String})],Ei.prototype,"spatialReference",void 0),u([d()],Ei.prototype,"tags",void 0),u([d()],Ei.prototype,"thumbnail",void 0),u([d({readOnly:!0})],Ei.prototype,"thumbnailUrl",null),u([d()],Ei.prototype,"title",void 0),u([d()],Ei.prototype,"type",void 0),u([d()],Ei.prototype,"typeKeywords",void 0),u([d({type:String,json:{read(t,e){var i;if(wJe.has(e.type)){const r=(i=this.portal)==null?void 0:i.restUrl;t||(t=r&&this.id?`${r}/content/items/${this.id}/data`:null)}return t}}})],Ei.prototype,"url",void 0),u([d({readOnly:!0})],Ei.prototype,"userItemUrl",null),Ei=Zb=u([I("esri.portal.PortalItem")],Ei);const WM=Ei,Kxe=Object.freeze(Object.defineProperty({__proto__:null,default:WM},Symbol.toStringTag,{value:"Module"}));async function xJe(t){const e=t.spatialReference;if(e.isWGS84)return t.clone();if(e.isWebMercator)return BS(t);const i=mt.WGS84;return await bVe(e,i),tg(t,i)}function KIt(t,e){if(!TJe(t,e)){const i=t.typeKeywords;i?i.push(e):t.typeKeywords=[e]}}function TJe(t,e){var i;return!!((i=t.typeKeywords)!=null&&i.includes(e))}function QIt(t,e){const i=t.typeKeywords;if(i){const r=i.indexOf(e);r>-1&&i.splice(r,1)}}async function e$t(t){const e=t.clone().normalize();let i;if(e.length>1)for(const r of e)i?r.width>i.width&&(i=r):i=r;else i=e[0];return xJe(i)}const t$t={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table"};function roe(t){var l;const{portal:e,isOrgItem:i,itemControl:r}=t,s=(l=e.user)==null?void 0:l.privileges;let n=!s||s.includes("features:user:edit"),o=!!i&&!!(s!=null&&s.includes("features:user:fullEdit"));const a=r==="update"||r==="admin";return a?o=n=!0:o&&(n=!0),{features:{edit:n,fullEdit:o},content:{updateItem:a}}}const SJe=t=>{let e=class extends t{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=Je(this.portalItem)}set portalItem(i){i!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",i))}readPortalItem(i,r,s){if(r.itemId)return new WM({id:r.itemId,portal:s&&s.portal})}writePortalItem(i,r){i&&i.id&&(r.itemId=i.id)}async loadFromPortal(i,r){if(this.portalItem&&this.portalItem.id)try{const s=await ee(()=>import("./layersLoader-d22a3cce.js"),["./layersLoader-d22a3cce.js","./fetchService-590f6092.js","./jsonContext-ab2114a6.js"],import.meta.url);return gi(r),await s.load({instance:this,supportedTypes:i.supportedTypes,validateItem:i.validateItem,supportsData:i.supportsData,layerModuleTypeMap:i.layerModuleTypeMap},r)}catch(s){throw ln(s)||oe.getLogger(this.declaredClass).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${s}`),s}}async finishLoadEditablePortalLayer(i){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(i).catch(r=>(zc(r),!0)))}async _setUserPrivileges(i,r){if(!ar.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(r);if(this.url)try{const{features:{edit:s,fullEdit:n},content:{updateItem:o}}=await this._fetchUserPrivileges(i,r);this._set("userHasEditingPrivileges",s),this._set("userHasFullEditingPrivileges",n),this._set("userHasUpdateItemPrivileges",o)}catch(s){zc(s)}}async _fetchUserPrivileges(i,r){let s=this.portalItem;if(!i||!s||!s.loaded||s.sourceUrl)return this._fetchFallbackUserPrivileges(r);const n=i===s.id;if(n&&s.portal.user)return roe(s);let o,a;if(n)o=s.portal.url;else try{o=await Bve(this.url,r)}catch(p){zc(p)}if(!o||!J6e(o,s.portal.url))return this._fetchFallbackUserPrivileges(r);try{const p=v(r)?r.signal:null;a=await(Cr==null?void 0:Cr.getCredential(`${o}/sharing`,{prompt:!1,signal:p}))}catch(p){zc(p)}const l=!0,c=!1,h=!1;if(!a)return{features:{edit:l,fullEdit:c},content:{updateItem:h}};try{if(n?await s.reload():(s=new WM({id:i,portal:{url:o}}),await s.load(r)),s.portal.user)return roe(s)}catch(p){zc(p)}return{features:{edit:l,fullEdit:c},content:{updateItem:h}}}async _fetchFallbackUserPrivileges(i){let r=!0;try{r=await this._fetchUserHasEditingPrivileges(i)}catch(s){zc(s)}return{features:{edit:r,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(i){const r=this.url?Cr==null?void 0:Cr.findCredential(this.url):null;if(!r)return!0;const s=j$.credential===r?j$.user:await this._fetchEditingUser(i);return j$.credential=r,j$.user=s,C(s)||s.privileges==null||s.privileges.includes("features:user:edit")}async _fetchEditingUser(i){var h,p;const r=(p=(h=this.portalItem)==null?void 0:h.portal)==null?void 0:p.user;if(r)return r;const s=Cr.findServerInfo(this.url??"");if(!(s!=null&&s.owningSystemUrl))return null;const n=`${s.owningSystemUrl}/sharing/rest`,o=uc.getDefault();if(o&&o.loaded&&zp(o.restUrl)===zp(n))return o.user;const a=`${n}/community/self`,l=v(i)?i.signal:null,c=await Kp(zr(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?HZ.fromJSON(c.value.data):null}read(i,r){r&&(r.layer=this),super.read(i,r)}write(i,r){const s=r&&r.portal,n=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||uc.getDefault());return s&&n&&!u0e(n.restUrl,s.restUrl)?(r.messages&&r.messages.push(new W("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(i,{...r,layer:this})}};return u([d({type:WM})],e.prototype,"portalItem",null),u([Qe("web-document","portalItem",["itemId"])],e.prototype,"readPortalItem",null),u([lt("web-document","portalItem",{itemId:{type:String}})],e.prototype,"writePortalItem",null),u([d({clonable:!1})],e.prototype,"resourceReferences",void 0),u([d({type:Boolean,readOnly:!0})],e.prototype,"userHasEditingPrivileges",void 0),u([d({type:Boolean,readOnly:!0})],e.prototype,"userHasFullEditingPrivileges",void 0),u([d({type:Boolean,readOnly:!0})],e.prototype,"userHasUpdateItemPrivileges",void 0),e=u([I("esri.layers.mixins.PortalLayer")],e),e},j$={credential:null,user:null};let $R=class extends $e{constructor(){super(...arguments),this.updating=!1,this.status="unknown"}};u([d()],$R.prototype,"updating",void 0),u([d()],$R.prototype,"status",void 0),$R=u([I("esri.layers.support.PublishingInfo")],$R);const EJe=$R,Qxe="esri.layers.mixins.PublishableLayer",CJe=Symbol(Qxe),AJe=t=>{var e;let i=class extends t{constructor(){super(...arguments),this[e]=!0}get publishingInfo(){if(this.destroyed)return null;const r=this._get("publishingInfo");if(r)return r;const s=new EJe;return this._checkPublishingStatus(s),s}_checkPublishingStatus(r){let o=0;const a=async c=>{let h;r.updating=!0;try{h=await this.fetchPublishingStatus()}catch{h="unavailable"}h!=="published"&&h!=="unavailable"||(r.status==="publishing"&&this.refresh(),l.remove()),r.status=h,r.updating=!1,l.removed||(o=setTimeout(a,c,c+125))},l={removed:!1,remove(){this.removed=!0,clearTimeout(o)}};this.when().catch(()=>l.remove()),a(250),this.own(l)}};return e=CJe,u([d({readOnly:!0,clonable:!1})],i.prototype,"publishingInfo",null),i=u([I(Qxe)],i),i},eP=new Nt,XM=new WeakMap;function OJe(t){eTe(t)&&eP.push(t)}function RJe(t){eTe(t)&&eP.includes(t)&&eP.remove(t)}function eTe(t){return t!=null&&typeof t=="object"&&"refreshInterval"in t&&"refresh"in t}function tTe(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:tTe(e,t%e):0}let Fk=0,H$=0;function MJe(){const t=Date.now();for(const e of eP)e.refreshInterval&&t-(XM.get(e)??0)+5>=6e4*e.refreshInterval&&(XM.set(e,t),e.refresh(t))}Nme(()=>{const t=Date.now();let e=0;for(const i of eP)e=tTe(Math.round(6e4*i.refreshInterval),e),i.refreshInterval?XM.get(i)||XM.set(i,t):XM.delete(i);if(e!==H$){if(H$=e,clearInterval(Fk),H$===0)return void(Fk=0);Fk=setInterval(MJe,H$)}});function PJe(t){return t!=null&&typeof t=="object"&&"refreshTimestamp"in t&&"refresh"in t}const IJe=t=>{let e=class extends t{constructor(...i){super(...i),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=Rme(()=>this.hasDataChanged()),this.when().then(()=>{OJe(this)},()=>{})}destroy(){RJe(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(i=Date.now()){dE(this._debounceHasDataChanged()).then(r=>{r&&this._set("refreshTimestamp",i),this.emit("refresh",{dataChanged:r})},r=>{oe.getLogger(this.declaredClass).error(r),this.emit("refresh",{dataChanged:!1,error:r})})}async hasDataChanged(){return!0}};return u([d({type:Number,cast:i=>i>=.1?i:i<=0?0:.1,json:{write:!0}})],e.prototype,"refreshInterval",void 0),u([d({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),u([d()],e.prototype,"refreshParameters",null),e=u([I("esri.layers.mixins.RefreshableLayer")],e),e},$Je=t=>{let e=class extends t{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const i={minScale:this.minScale,maxScale:this.maxScale},r=this.parent;r&&"effectiveScaleRange"in r&&LJe(i,r.effectiveScaleRange);const s=this._get("effectiveScaleRange");return s&&s.minScale===i.minScale&&s.maxScale===i.maxScale?s:i}};return u([d({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"minScale",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"maxScale",void 0),u([d({readOnly:!0})],e.prototype,"effectiveScaleRange",null),e=u([I("esri.layers.mixins.ScaleRangeLayer")],e),e};function LJe(t,e){return t.minScale=t.minScale>0?e.minScale>0?Math.min(t.minScale,e.minScale):t.minScale:e.minScale,t.maxScale=t.maxScale>0?e.maxScale>0?Math.max(t.maxScale,e.maxScale):t.maxScale:e.maxScale,t}const iTe=Ua()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});let LR=class extends Cs(Ie){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return eHe(this.value,this.unit,"milliseconds")}};u([At(iTe,{nonNullable:!0})],LR.prototype,"unit",void 0),u([d({type:Number,json:{write:!0},nonNullable:!0})],LR.prototype,"value",void 0),LR=u([I("esri.TimeInterval")],LR);const l5=LR;function soe(t,e){return l5.fromJSON({value:t,unit:e})}let Ja=class extends Cs(Ie){constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,i){if(!i.timeExtent||!Array.isArray(i.timeExtent)||i.timeExtent.length!==2)return null;const r=new Date(i.timeExtent[0]),s=new Date(i.timeExtent[1]);return new ig({start:r,end:s})}writeFullTimeExtent(e,i){e&&v(e.start)&&v(e.end)?i.timeExtent=[e.start.getTime(),e.end.getTime()]:i.timeExtent=null}readInterval(e,i){return i.timeInterval&&i.timeIntervalUnits?soe(i.timeInterval,i.timeIntervalUnits):i.defaultTimeInterval&&i.defaultTimeIntervalUnits?soe(i.defaultTimeInterval,i.defaultTimeIntervalUnits):null}writeInterval(e,i){i.timeInterval=(e==null?void 0:e.toJSON().value)??null,i.timeIntervalUnits=(e==null?void 0:e.toJSON().unit)??null}};u([d({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],Ja.prototype,"cumulative",void 0),u([d({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],Ja.prototype,"endField",void 0),u([d({type:ig,json:{write:{enabled:!0,allowNull:!0}}})],Ja.prototype,"fullTimeExtent",void 0),u([Qe("fullTimeExtent",["timeExtent"])],Ja.prototype,"readFullTimeExtent",null),u([lt("fullTimeExtent")],Ja.prototype,"writeFullTimeExtent",null),u([d({type:Boolean,json:{write:!0}})],Ja.prototype,"hasLiveData",void 0),u([d({type:l5,json:{write:{enabled:!0,allowNull:!0}}})],Ja.prototype,"interval",void 0),u([Qe("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],Ja.prototype,"readInterval",null),u([lt("interval")],Ja.prototype,"writeInterval",null),u([d({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],Ja.prototype,"startField",void 0),u([d({type:xC,json:{write:{enabled:!0,allowNull:!0}}})],Ja.prototype,"timeReference",void 0),u([d({type:String,json:{write:{enabled:!0,allowNull:!0}}})],Ja.prototype,"trackIdField",void 0),u([d({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],Ja.prototype,"useTime",void 0),Ja=u([I("esri.layers.support.TimeInfo")],Ja);const rTe=Ja,DJe=t=>{let e=class extends t{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(i,r){const s=r.timeInfo.exportOptions;if(!s)return null;const n=s.timeOffset,o=iTe.fromJSON(s.timeOffsetUnits);return n&&o?new l5({value:n,unit:o}):null}set timeInfo(i){dye(i,this.fieldsIndex),this._set("timeInfo",i)}};return u([d({type:ig,json:{write:!1}})],e.prototype,"timeExtent",void 0),u([d({type:l5})],e.prototype,"timeOffset",void 0),u([Qe("service","timeOffset",["timeInfo.exportOptions"])],e.prototype,"readOffset",null),u([d({value:null,type:rTe,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.prototype,"timeInfo",null),u([d({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],e.prototype,"useViewTime",void 0),e=u([I("esri.layers.mixins.TemporalLayer")],e),e},noe=new Gi({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let I_=class extends Cs(Ie){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};u([d({json:{write:!0}})],I_.prototype,"name",void 0),u([d({json:{write:!0}})],I_.prototype,"description",void 0),u([d({json:{read:noe.read,write:noe.write}})],I_.prototype,"drawingTool",void 0),u([d({json:{write:!0}})],I_.prototype,"prototype",void 0),u([d({json:{write:!0}})],I_.prototype,"thumbnail",void 0),I_=u([I("esri.layers.support.FeatureTemplate")],I_);const EK=I_;let Wg=class extends Cs(Ie){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const i={};for(const r of Object.keys(e))i[r]=qJ(e[r]);return i}writeDomains(e,i){var s;const r={};for(const n of Object.keys(e))e[n]&&(r[n]=(s=e[n])==null?void 0:s.toJSON());i.domains=r}};u([d({json:{write:!0}})],Wg.prototype,"id",void 0),u([d({json:{write:!0}})],Wg.prototype,"name",void 0),u([d({json:{write:!0}})],Wg.prototype,"domains",void 0),u([Qe("domains")],Wg.prototype,"readDomains",null),u([lt("domains")],Wg.prototype,"writeDomains",null),u([d({type:[EK],json:{write:!0}})],Wg.prototype,"templates",void 0),Wg=u([I("esri.layers.support.FeatureType")],Wg);const sTe=Wg;function NJe(t){return t.type==="date"||t.type==="esriFieldTypeDate"}function ooe(t){return t.type==="oid"||t.type==="esriFieldTypeOID"}function aoe(t){return t.type==="global-id"||t.type==="esriFieldTypeGlobalID"}let FJe=class{constructor(e=[]){if(this.fields=[],this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this.dateFields=[],this.numericFields=[],this._requiredFields=null,!e)return;this.fields=e;const i=[];for(const r of e){const s=r==null?void 0:r.name,n=coe(r==null?void 0:r.name);if(s&&n){const o=loe(s);this._fieldsMap.set(s,r),this._fieldsMap.set(o,r),this._normalizedFieldsMap.set(n,r),i.push(o),NJe(r)?(this.dateFields.push(r),this._dateFieldsSet.add(r)):X6(r)&&(this._numericFieldsSet.add(r),this.numericFields.push(r)),ooe(r)||aoe(r)||(r.editable=r.editable==null||!!r.editable,r.nullable=r.nullable==null||!!r.nullable)}}i.sort(),this.uid=i.join(",")}destroy(){this._fieldsMap.clear()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)ooe(e)||aoe(e)||e.nullable||w5e(e)!==void 0||this._requiredFields.push(e)}return this._requiredFields}has(e){return this.get(e)!=null}get(e){if(!e)return;let i=this._fieldsMap.get(e);return i||(i=this._fieldsMap.get(loe(e))??this._normalizedFieldsMap.get(coe(e)),i&&this._fieldsMap.set(e,i),i)}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){const i=this.get(e);if(i)return i.name??void 0}};function loe(t){return t.trim().toLowerCase()}function coe(t){var e;return((e=d5e(t))==null?void 0:e.toLowerCase())??""}function UJe(){return{fields:{type:[UU],value:null},fieldsIndex:{readOnly:!0,get(){return new FJe(this.fields||[])}},outFields:{type:[String],json:{read:!1},set:function(t){this._userOutFields=t,this.notifyChange("outFields")},get:function(){var e;const t=this._userOutFields;if(!t||!t.length)return null;if(t.includes("*"))return["*"];if(!this.fields)return t;for(const i of t)((e=this.fieldsIndex)==null?void 0:e.has(i))||oe.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${i} found in outFields`,{layer:this,outFields:t});return pye(this.fieldsIndex,t)}}}}const Uk=oe.getLogger("esri.layers.support.labelingInfo"),VJe=/\[([^\[\]]+)\]/gi;function uoe(t,e,i){return t?t.map(r=>{const s=new XU;if(s.read(r,i),s.labelExpression){const n=e.fields||e.layerDefinition&&e.layerDefinition.fields||this.fields;s.labelExpression=s.labelExpression.replace(VJe,(o,a)=>`[${kJe(a,n)}]`)}return s}):null}function kJe(t,e){if(!e)return t;const i=t.toLowerCase();for(let r=0;r<e.length;r++){const s=e[r].name;if(s.toLowerCase()===i)return s}return t}const BJe={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null};function l$t(t,e){const i=ae(t);return i.some(r=>zJe(r,e))?[]:i}function zJe(t,e){const i=t.labelPlacement,r=BJe[e];if(!t.symbol)return Uk.warn("No ILabelClass symbol specified."),!0;if(!r)return Uk.error(new W("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${e}' is not supported`)),!0;if(!r.includes(i)){const s=r[0];i&&Uk.warn(`Found invalid label placement type ${i} for ${e}. Defaulting to ${s}`),t.labelPlacement=s}return!1}const rp=[];function GJe(t,e){if(Lwe(t.url??""))return!0;const{wkid:i}=e;for(const r of rp){if((t.version??0)>=r[0])return!0;if(typeof r[1]=="function"&&(r[1]=r[1]()),r[1].has(i))return!1}return!0}rp.push([10.91,()=>{const t=new Set([9709,9716,9741,9761,9766]);for(let e=9712;e<=9713;e++)t.add(e);for(let e=9748;e<=9749;e++)t.add(e);for(let e=20904;e<=20932;e++)t.add(e);for(let e=21004;e<=21032;e++)t.add(e);for(let e=21207;e<=21264;e++)t.add(e);for(let e=21307;e<=21364;e++)t.add(e);for(let e=102759;e<=102760;e++)t.add(e);for(let e=102901;e<=102955;e++)t.add(e);return t}]),rp.push([10.9,()=>{const t=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let e=9356;e<=9360;e++)t.add(e);for(let e=9404;e<=9407;e++)t.add(e);for(let e=9476;e<=9482;e++)t.add(e);for(let e=9487;e<=9494;e++)t.add(e);for(let e=9697;e<=9699;e++)t.add(e);return t}]),rp.push([10.81,()=>{const t=new Set([9265,9333,103598,103699]);for(let e=9248;e<=9254;e++)t.add(e);for(let e=9271;e<=9273;e++)t.add(e);for(let e=9284;e<=9285;e++)t.add(e);for(let e=21453;e<=21463;e++)t.add(e);return t}]),rp.push([10.8,()=>{const t=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let e=8035;e<=8036;e++)t.add(e);for(let e=8455;e<=8456;e++)t.add(e);for(let e=8518;e<=8529;e++)t.add(e);for(let e=8533;e<=8536;e++)t.add(e);for(let e=8538;e<=8540;e++)t.add(e);for(let e=8677;e<=8679;e++)t.add(e);for(let e=8902;e<=8903;e++)t.add(e);for(let e=8907;e<=8910;e++)t.add(e);for(let e=8949;e<=8951;e++)t.add(e);for(let e=8972;e<=8987;e++)t.add(e);for(let e=9039;e<=9040;e++)t.add(e);for(let e=9068;e<=9069;e++)t.add(e);for(let e=9140;e<=9141;e++)t.add(e);for(let e=9148;e<=9150;e++)t.add(e);for(let e=9153;e<=9159;e++)t.add(e);for(let e=9205;e<=9218;e++)t.add(e);for(let e=9221;e<=9222;e++)t.add(e);for(let e=54098;e<=54101;e++)t.add(e);return t}]),rp.push([10.71,()=>{const t=new Set([6316]);for(let e=8351;e<=8353;e++)t.add(e);for(let e=9294;e<=9297;e++)t.add(e);for(let e=22619;e<=22621;e++)t.add(e);for(let e=103586;e<=103594;e++)t.add(e);return t}]),rp.push([10.7,()=>{const t=new Set([8387,8391,8427,8545,8682,8685,8818,31370,104022,104024,104975]);for(let e=8065;e<=8068;e++)t.add(e);for(let e=8082;e<=8083;e++)t.add(e);for(let e=8379;e<=8385;e++)t.add(e);for(let e=8836;e<=8840;e++)t.add(e);for(let e=8857;e<=8860;e++)t.add(e);for(let e=53035;e<=53037;e++)t.add(e);for(let e=54090;e<=54091;e++)t.add(e);for(let e=102498;e<=102499;e++)t.add(e);return t}]),rp.push([10.61,()=>new Set([102497])]),rp.push([10.6,()=>{const t=new Set([7803,7805,7887,8086,8232,8237,8240,8246,8249,8252,8255,9019,9391]);for(let e=7755;e<=7787;e++)t.add(e);for(let e=7791;e<=7795;e++)t.add(e);for(let e=7799;e<=7801;e++)t.add(e);for(let e=7825;e<=7831;e++)t.add(e);for(let e=7877;e<=7878;e++)t.add(e);for(let e=7882;e<=7883;e++)t.add(e);for(let e=7991;e<=7992;e++)t.add(e);for(let e=8042;e<=8043;e++)t.add(e);for(let e=8058;e<=8059;e++)t.add(e);for(let e=8311;e<=8348;e++)t.add(e);for(let e=9060;e<=9067;e++)t.add(e);for(let e=102562;e<=102568;e++)t.add(e);for(let e=102799;e<=102900;e++)t.add(e);return t}]),rp.push([10.51,()=>{const t=new Set([7683,7881,7886,7899,8888,9e3]);for(let e=8013;e<=8032;e++)t.add(e);for(let e=9053;e<=9057;e++)t.add(e);for(let e=104017;e<=104018;e++)t.add(e);for(let e=104971;e<=104974;e++)t.add(e);return t}]),rp.push([10.5,()=>{const t=new Set([6962,7035,7037,7039,7041,7084,7086,7133,7798,102399]);for(let e=4087;e<=4088;e++)t.add(e);for(let e=5896;e<=5899;e++)t.add(e);for(let e=7005;e<=7007;e++)t.add(e);for(let e=7057;e<=7070;e++)t.add(e);for(let e=7073;e<=7082;e++)t.add(e);for(let e=7109;e<=7128;e++)t.add(e);for(let e=7844;e<=7859;e++)t.add(e);return t}]);async function jJe(t,e,i){const r=t&&t.getAtOrigin&&t.getAtOrigin("renderer",e.origin);if(r&&r.type==="unique-value"&&r.styleOrigin){const s=await Kp(r.populateFromStyle());if(gi(i),s.ok===!1){const n=s.error;e&&e.messages&&e.messages.push(new dd("renderer:style-reference",`Failed to create unique value renderer from style reference: ${n.message}`,{error:n,context:e})),t.clear("renderer",e==null?void 0:e.origin)}}}const HJe=["oid","global-id"],qJe=["oid","global-id","guid"];function WJe({displayField:t,editFieldsInfo:e,fields:i,objectIdField:r,title:s},n){if(!i)return null;const o=QJe({editFieldsInfo:e,fields:i,objectIdField:r},n);if(!o.length)return null;const a=iKe({titleBase:s,fields:i,displayField:t}),l=tKe();return new QP({title:a,content:l,fieldInfos:o})}const XJe=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i],YJe=(t,{editFieldsInfo:e,objectIdField:i,visibleFieldNames:r})=>r?r.has(t.name):!nTe(t.name,e)&&(!i||t.name!==i)&&!HJe.includes(t.type)&&!XJe.some(s=>s.test(t.name));function ZJe(t,e){const i=t;return e&&(t=t.filter(r=>!e.includes(r.type))),t===i&&(t=t.slice()),t.sort(JJe),t}function JJe(t,e){return t.type==="oid"?-1:e.type==="oid"?1:hoe(t)?-1:hoe(e)?1:(t.alias||t.name).toLocaleLowerCase().localeCompare((e.alias||e.name).toLocaleLowerCase())}function nTe(t,e){if(!t||!e)return!1;const{creationDateField:i,creatorField:r,editDateField:s,editorField:n}=e;return[i&&i.toLowerCase(),r&&r.toLowerCase(),s&&s.toLowerCase(),n&&n.toLowerCase()].includes(t.toLowerCase())}function KJe(t,e){return t.editable&&!qJe.includes(t.type)&&!nTe(t.name,e)}function QJe({editFieldsInfo:t,fields:e,objectIdField:i},r){return ZJe(e??[],(r==null?void 0:r.ignoreFieldTypes)||rKe).map(s=>new JP({fieldName:s.name,isEditable:KJe(s,t),label:s.alias,format:eKe(s),visible:YJe(s,{editFieldsInfo:t,objectIdField:i,visibleFieldNames:r==null?void 0:r.visibleFieldNames})}))}function eKe(t){switch(t.type){case"small-integer":case"integer":case"single":return new zS({digitSeparator:!0,places:0});case"double":return new zS({digitSeparator:!0,places:2});case"date":return new zS({dateFormat:"long-month-day-year"});default:return t.type==="string"&&vye(t.name)?new zS({digitSeparator:!0,places:0}):null}}function tKe(){return[new tC,new D3]}function iKe(t){const e=m5e(t),{titleBase:i}=t;return e?`${i}: {${e.trim()}}`:i??""}function hoe(t){return(t.name&&t.name.toLowerCase())==="name"?!0:(t.alias&&t.alias.toLowerCase())==="name"}const rKe=["geometry","blob","raster","guid","xml"],Cl="FeatureLayer",oTe="esri.layers.FeatureLayer",sKe=oe.getLogger(oTe);function q$(t,e){return new W("layer:unsupported",`Layer (${t.title}, ${t.id}) of type '${t.declaredClass}' ${e}`,{layer:t})}function doe(t){return t&&t instanceof Nt}const Vk=UJe();function kk(t,e,i){const r=!!(i!=null&&i.writeLayerSchema);return{enabled:r,ignoreOrigin:r}}let Ot=class extends OZe(pJe(IWe(AJe(RWe(CWe(_Je(DJe($Je(IJe(EWe(mJe(SJe(Swe(AWe(yWe(Cs(i5))))))))))))))))){constructor(...e){super(...e),this._handles=new Ki,this.charts=null,this.copyright=null,this.displayField=null,this.dynamicDataSource=null,this.fields=null,this.fieldsIndex=null,this.formTemplate=null,this.fullExtent=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.spatialReference=mt.WGS84,this.subtypeCode=null,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.type="feature",this.typeIdField=null,this.types=null,this.visible=!0}destroy(){var e;(e=this.source)==null||e.destroy(),this._handles=Je(this._handles)}normalizeCtorArgs(e,i){return typeof e=="string"?{url:e,...i}:e}load(e){var s;const i=v(e)?e.signal:null;if((s=this.portalItem)!=null&&s.loaded&&this.source)return this.addResolvingPromise(this.createGraphicsSource(i).then(n=>this.initLayerProperties(n))),Promise.resolve(this);const r=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch(zc).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const n=await this._fetchFirstLayerId(i);n!=null&&(this.layerId=n)}if(!this.url&&!this._hasMemorySource())throw new W("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this.initLayerProperties(await this.createGraphicsSource(i))}).then(()=>this._setUserPrivileges(this.serviceItemId,e)).then(()=>dZe(this,e));return this.addResolvingPromise(r),Promise.resolve(this)}readCapabilities(e,i){return i=i.layerDefinition||i,kxe(i,this.url)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")??0)+1}get editingEnabled(){var e;return!(this.loaded&&!((e=this.capabilities)!=null&&e.operations.supportsEditing))&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(e){this._overrideIfSome("editingEnabled",e)}readEditingEnabled(e,i){return this._readEditingEnabled(i,!1)}readEditingEnabledFromWebMap(e,i,r){return this._readEditingEnabled(i,!0,r)}writeEditingEnabled(e,i){this._writeEditingEnabled(e,i,!1)}writeEditingEnabledToWebMap(e,i,r,s){this._writeEditingEnabled(e,i,!0,s)}get effectiveEditingEnabled(){return pZe(this)}readIsTable(e,i){return(i=(i==null?void 0:i.layerDefinition)??i).type==="Table"||!i.geometryType}writeIsTable(e,i,r,s){s!=null&&s.writeLayerSchema&&gl(r,e?"Table":"Feature Layer",i)}readGlobalIdField(e,i){return Uxe(i.layerDefinition||i)}readObjectIdField(e,i){return Vxe(i.layerDefinition||i)}get parsedUrl(){const e=vl(this.url);return e!=null&&(this.dynamicDataSource!=null?e.path=Ax(e.path,"dynamicLayer"):this.layerId!=null&&(e.path=Ax(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){Mie(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,i,r){var n;const s=(n=(i=i.layerDefinition||i).drawingInfo)==null?void 0:n.renderer;if(s){const o=Q3(s,i,r)??void 0;return o||sKe.error("Failed to create renderer",{rendererDefinition:i.drawingInfo.renderer,layer:this,context:r}),o}if(i.defaultSymbol)return i.types&&i.types.length?new mI({defaultSymbol:Bk(i.defaultSymbol,i,r),field:i.typeIdField,uniqueValueInfos:i.types.map(o=>({id:o.id,symbol:Bk(o.symbol,o,r)}))}):new vC({symbol:Bk(i.defaultSymbol,i,r)})}set source(e){const i=this._get("source");i!==e&&(doe(i)&&this._resetMemorySource(i),doe(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof Nt?new oy({layer:this,items:e}):e:null}readSource(e,i){const r=XJ.fromJSON(i.featureSet);return new oy({layer:this,items:(r==null?void 0:r.features)??[]})}readTemplates(e,i){const r=i.editFieldsInfo,s=r&&r.creatorField,n=r&&r.editorField;return e=e&&e.map(o=>EK.fromJSON(o)),this._fixTemplates(e,s),this._fixTemplates(e,n),e}readTitle(e,i){var n;const r=((n=i.layerDefinition)==null?void 0:n.name)??i.name,s=i.title||i.layerDefinition&&i.layerDefinition.title;if(r){const o=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return this.url?wWe(this.url,r):r;let a=r;if(!a&&this.url){const l=hA(this.url);v(l)&&(a=l.title)}return a?(this.sublayerTitleMode==="item-title-and-service-name"&&o&&o!==a&&(a=o+" - "+a),uK(a)):void 0}if(this.sublayerTitleMode==="item-title"&&s)return s}readTitleFromWebMap(e,i){return i.title||i.layerDefinition&&i.layerDefinition.name}readTypeIdField(e,i){let r=(i=i.layerDefinition||i).typeIdField;if(r&&i.fields){r=r.toLowerCase();const s=i.fields.find(n=>n.name.toLowerCase()===r);s&&(r=s.name)}return r}readTypes(e,i){e=(i=i.layerDefinition||i).types;const r=i.editFieldsInfo,s=r&&r.creatorField,n=r&&r.editorField;return e&&e.map(o=>(o=sTe.fromJSON(o),this._fixTemplates(o.templates,s),this._fixTemplates(o.templates,n),o))}readVisible(e,i){return i.layerDefinition&&i.layerDefinition.defaultVisibility!=null?!!i.layerDefinition.defaultVisibility:i.visibility!=null?!!i.visibility:void 0}async addAttachment(e,i){return JYe(this,e,i,Cl)}async updateAttachment(e,i,r){return KYe(this,e,i,r,Cl)}async applyEdits(e,i){return QYe(this,e,i)}on(e,i){return super.on(e,i)}createPopupTemplate(e){return WJe(this,e)}async createGraphicsSource(e){if(this._hasMemorySource()&&this.source)return this.source.load({signal:e});const{default:i}=await FY(ee(()=>import("./FeatureLayerSource-00baf92c.js"),["./FeatureLayerSource-00baf92c.js","./assetEditingSupport-2cebf928.js","./clientSideDefaults-b0c27b52.js","./QueryEngineCapabilities-42e44ded.js","./QueryTask-9dc26fe5.js","./executeForIds-a0e8e13a.js"],import.meta.url),e);return new i({layer:this}).load({signal:e})}createQuery(){const e=cZe(this);e.dynamicDataSource=this.dynamicDataSource;const i=v(this.subtypeCode)?`${this.subtypeField} = ${this.subtypeCode}`:null,r=Kqe(this.definitionExpression,i);return e.where=r||"1=1",e}async deleteAttachments(e,i){return eZe(this,e,i,Cl)}async fetchRecomputedExtents(e){return tZe(this,e,Cl)}getFeatureType(e){const{typeIdField:i,types:r}=this;if(!i||!e)return null;const s=e.attributes?e.attributes[i]:void 0;if(s==null)return null;let n=null;return r==null||r.some(o=>{const{id:a}=o;return a!=null&&(a.toString()===s.toString()&&(n=o),!!n)}),n}getFieldDomain(e,i){const r=i&&i.feature,s=this.getFeatureType(r);if(s){const n=s.domains&&s.domains[e];if(n&&n.type!=="inherited")return n}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}async queryAttachments(e,i){return iZe(this,e,i,Cl)}async queryFeatures(e,i){const r=await this.load(),s=await r.source.queryFeatures(Mm.from(e)??r.createQuery(),i);if(s!=null&&s.features)for(const n of s.features)n.layer=n.sourceLayer=r;return s}async queryObjectIds(e,i){return rZe(this,e,i,Cl)}async queryFeatureCount(e,i){return sZe(this,e,i,Cl)}async queryExtent(e,i){return nZe(this,e,i,Cl)}async queryRelatedFeatures(e,i){return oZe(this,e,i,Cl)}async queryRelatedFeaturesCount(e,i){return aZe(this,e,i,Cl)}async queryTopFeatures(e,i){var o;const{source:r,capabilities:s}=await this.load();if(!r.queryTopFeatures||!((o=s==null?void 0:s.query)!=null&&o.supportsTopFeaturesQuery))throw new W(Cl,"Layer source does not support queryTopFeatures capability");const n=await r.queryTopFeatures(A$.from(e),i);if(n!=null&&n.features)for(const a of n.features)a.layer=a.sourceLayer=this;return n}async queryTopObjectIds(e,i){const{source:r,capabilities:s}=await this.load();if(!r.queryTopObjectIds||!(s!=null&&s.query.supportsTopFeaturesQuery))throw new W(Cl,"Layer source does not support queryTopObjectIds capability");return r.queryTopObjectIds(A$.from(e),i)}async queryTopFeaturesExtent(e,i){var n;const{source:r,capabilities:s}=await this.load();if(!r.queryTopExtents||!((n=s==null?void 0:s.query)!=null&&n.supportsTopFeaturesQuery))throw new W(Cl,"Layer source does not support queryTopExtents capability");return r.queryTopExtents(A$.from(e),i)}async queryTopFeatureCount(e,i){var n;const{source:r,capabilities:s}=await this.load();if(!r.queryTopCount||!((n=s==null?void 0:s.query)!=null&&n.supportsTopFeaturesQuery))throw new W(Cl,"Layer source does not support queryFeatureCount capability");return r.queryTopCount(A$.from(e),i)}read(e,i){const r=e.featureCollection;if(r){const s=r.layers;s&&s.length===1&&(super.read(s[0],i),r.showLegend!=null&&super.read({showLegend:r.showLegend},i))}super.read(e,i),i&&i.origin==="service"&&(this.revert(["objectIdField","fields","timeInfo"],"service"),this.spatialReference||this.revert(["spatialReference"],"service"))}write(e,i){i={...i,origin:(i==null?void 0:i.origin)??void 0,writeLayerSchema:(i==null?void 0:i.writeLayerSchema)??this._hasMemorySource()};const{origin:r,layerContainerType:s,messages:n}=i;if(this.dynamicDataSource)return n==null||n.push(q$(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if(r==="web-scene"||r==="web-map"&&s!=="tables")return n==null||n.push(q$(this,"using a table source cannot be written to web scenes and web maps")),null;if(this._hasMemorySource())return n==null||n.push(q$(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&r==="web-map"&&s==="tables")return n==null||n.push(q$(this,"using a non-table source cannot be written to tables in web maps")),null;return super.write(e,i)}clone(){if(this._hasMemorySource())throw new W(Cl,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(e){var i;return!!this.loaded&&(((i=this.source)==null?void 0:i.type)==="memory"||GJe(this,e))}async save(e){return(await ee(()=>import("./featureLayerUtils-97666314.js"),["./featureLayerUtils-97666314.js","./originUtils-1469eeaf.js","./multiOriginJSONSupportUtils-c978f4c3.js","./fetchService-590f6092.js","./jsonContext-ab2114a6.js"],import.meta.url)).save(this,e)}async saveAs(e,i){return(await ee(()=>import("./featureLayerUtils-97666314.js"),["./featureLayerUtils-97666314.js","./originUtils-1469eeaf.js","./multiOriginJSONSupportUtils-c978f4c3.js","./fetchService-590f6092.js","./jsonContext-ab2114a6.js"],import.meta.url)).saveAs(this,e,i)}_readEditingEnabled(e,i,r){var n;let s=(n=e.layerDefinition)==null?void 0:n.capabilities;return s?this._hasEditingCapability(s):(s=e.capabilities,i&&(r==null?void 0:r.origin)==="web-map"&&!this._hasMemorySource()&&s?this._hasEditingCapability(s):void 0)}_hasEditingCapability(e){return e.toLowerCase().split(",").map(i=>i.trim()).includes("editing")}_writeEditingEnabled(e,i,r,s){var n,o;if(!e){const a=(o=(n=this.capabilities)==null?void 0:n.operations)!=null&&o.supportsSync?"Query,Sync":"Query";gl("layerDefinition.capabilities",a,i),r&&!(s!=null&&s.writeLayerSchema)&&(i.capabilities=a)}}_getLayerDomain(e){const i=this.fieldsIndex.get(e);return i?i.domain:null}_fetchFirstLayerId(e){return zr(this.url,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e}).then(i=>{const r=i.data;if(r)return Array.isArray(r.layers)&&r.layers.length>0?r.layers[0].id:Array.isArray(r.tables)&&r.tables.length>0?r.tables[0].id:void 0})}async initLayerProperties(e){var i;return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:(i=this.portalItem)==null?void 0:i.portal,url:this.parsedUrl})),this._verifySource(),this._verifyFields(),Mie(this.renderer,this.fieldsIndex),dye(this.timeInfo,this.fieldsIndex),jJe(this,{origin:"service"})}async hasDataChanged(){return lZe(this)}async fetchPublishingStatus(){const e=this.source;return e!=null&&e.fetchPublishingStatus?e.fetchPublishingStatus():"unavailable"}_verifyFields(){var i,r;const e=((i=this.parsedUrl)==null?void 0:i.path)??"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||e.search(/\/FeatureServer\//i)!==-1||(r=this.fields)!=null&&r.some(s=>s.type==="geometry")||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,i){e&&e.forEach(r=>{const s=r.prototype&&r.prototype.attributes;s&&i&&delete s[i]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new W("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new W("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach(i=>{i.layer=this,i.sourceLayer=this}),this._handles.add([e.on("after-add",i=>{i.item.layer=this,i.item.sourceLayer=this}),e.on("after-remove",i=>{i.item.layer=null,i.item.sourceLayer=null})],"fl-source")}_resetMemorySource(e){e.forEach(i=>{i.layer=null,i.sourceLayer=null}),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}};u([Qe("service","capabilities")],Ot.prototype,"readCapabilities",null),u([d({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Ot.prototype,"charts",void 0),u([d({readOnly:!0})],Ot.prototype,"createQueryVersion",null),u([d({json:{read:{source:"layerDefinition.copyrightText"}}})],Ot.prototype,"copyright",void 0),u([d({json:{read:{source:"layerDefinition.displayField"}}})],Ot.prototype,"displayField",void 0),u([d({types:nx,readOnly:!0})],Ot.prototype,"defaultSymbol",void 0),u([d({type:_p})],Ot.prototype,"dynamicDataSource",void 0),u([d({type:Boolean})],Ot.prototype,"editingEnabled",null),u([Qe(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],Ot.prototype,"readEditingEnabled",null),u([Qe("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],Ot.prototype,"readEditingEnabledFromWebMap",null),u([lt(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],Ot.prototype,"writeEditingEnabled",null),u([lt("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],Ot.prototype,"writeEditingEnabledToWebMap",null),u([d({readOnly:!0})],Ot.prototype,"effectiveEditingEnabled",null),u([d({...Vk.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:kk}}}}})],Ot.prototype,"fields",void 0),u([d(Vk.fieldsIndex)],Ot.prototype,"fieldsIndex",void 0),u([d({type:uWe,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],Ot.prototype,"formTemplate",void 0),u([d({json:{read:{source:"layerDefinition.extent"}}})],Ot.prototype,"fullExtent",void 0),u([d({json:{origins:{"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:kk,writer(t,e,i){const r=t?YH.toJSON(t):null;r&&gl(i,r,e)}}}},read:{source:"layerDefinition.geometryType",reader:YH.read}}})],Ot.prototype,"geometryType",void 0),u([d({json:{read:{source:"layerDefinition.hasM"}}})],Ot.prototype,"hasM",void 0),u([d({json:{read:{source:"layerDefinition.hasZ"}}})],Ot.prototype,"hasZ",void 0),u([d(HWe)],Ot.prototype,"id",void 0),u([d({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],Ot.prototype,"infoFor3D",void 0),u([d({json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],Ot.prototype,"isTable",void 0),u([Qe("service","isTable",["type","geometryType"]),Qe("isTable",["layerDefinition.type","layerDefinition.geometryType"])],Ot.prototype,"readIsTable",null),u([lt("web-map","isTable")],Ot.prototype,"writeIsTable",null),u([d(dK)],Ot.prototype,"labelsVisible",void 0),u([d({type:[XU],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:uoe},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:uoe},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],Ot.prototype,"labelingInfo",void 0),u([d((()=>{const t=ae(jWe);return t.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(e,i,r){gl(r,Q6(e),i)}}},t})())],Ot.prototype,"opacity",void 0),u([d(zWe)],Ot.prototype,"legendEnabled",void 0),u([d({type:["show","hide"],json:(()=>{const t=ae(Uwe.json);return t.origins["portal-item"]={read:!1,write:!1},t})()})],Ot.prototype,"listMode",void 0),u([Qe("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],Ot.prototype,"readGlobalIdField",null),u([d({json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:kk}}}}})],Ot.prototype,"objectIdField",void 0),u([Qe("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],Ot.prototype,"readObjectIdField",null),u([d({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],Ot.prototype,"operationalLayerType",void 0),u([d(Vk.outFields)],Ot.prototype,"outFields",void 0),u([d({readOnly:!0})],Ot.prototype,"parsedUrl",null),u([d({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Ot.prototype,"path",void 0),u([d(hK)],Ot.prototype,"popupEnabled",void 0),u([d({type:QP,json:{name:"popupInfo",write:!0}})],Ot.prototype,"popupTemplate",void 0),u([d({readOnly:!0})],Ot.prototype,"defaultPopupTemplate",null),u([d({types:zU,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:Wqe,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:(t,e,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(t,e,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}})],Ot.prototype,"renderer",null),u([Qe("service","renderer",["drawingInfo.renderer","defaultSymbol"]),Qe("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],Ot.prototype,"readRenderer",null),u([d((()=>{const t=ae(kWe);return t.json.origins["portal-item"]={read:!1,write:!1},t})())],Ot.prototype,"screenSizePerspectiveEnabled",void 0),u([d({clonable:!1})],Ot.prototype,"source",null),u([wi("source")],Ot.prototype,"castSource",null),u([Qe("portal-item","source",["featureSet"]),Qe("web-map","source",["featureSet"])],Ot.prototype,"readSource",null),u([d({json:{read:{source:"layerDefinition.extent.spatialReference"}}})],Ot.prototype,"spatialReference",void 0),u([d({type:Number})],Ot.prototype,"subtypeCode",void 0),u([d({type:[EK]})],Ot.prototype,"templates",void 0),u([Qe("templates",["editFieldsInfo","creatorField","editorField","templates"])],Ot.prototype,"readTemplates",null),u([d({type:rTe})],Ot.prototype,"timeInfo",void 0),u([d()],Ot.prototype,"title",void 0),u([Qe("service","title",["name"]),Qe("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],Ot.prototype,"readTitle",null),u([Qe("web-map","title",["layerDefinition.name","title"])],Ot.prototype,"readTitleFromWebMap",null),u([d({type:String})],Ot.prototype,"sublayerTitleMode",void 0),u([d({json:{read:!1}})],Ot.prototype,"type",void 0),u([d({type:String})],Ot.prototype,"typeIdField",void 0),u([Qe("service","typeIdField"),Qe("typeIdField",["layerDefinition.typeIdField"])],Ot.prototype,"readTypeIdField",null),u([d({type:[sTe]})],Ot.prototype,"types",void 0),u([Qe("service","types",["types"]),Qe("types",["layerDefinition.types"])],Ot.prototype,"readTypes",null),u([d({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],Ot.prototype,"visible",void 0),u([Qe("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],Ot.prototype,"readVisible",null),Ot=u([I(oTe)],Ot);const Bk=f1({types:dU}),aTe=Ot,u$t=Object.freeze(Object.defineProperty({__proto__:null,default:aTe},Symbol.toStringTag,{value:"Module"})),nKe=["$datastore","$map","$layer","$aggregatedfeatures"],oKe="esri.widgets.Feature.support.arcadeFeatureUtils",aKe=oe.getLogger(oKe);function lKe(t){return typeof t=="string"?cI(LJ(t)):Array.isArray(t)?cKe(t):(t==null?void 0:t.declaredClass)==="esri.arcade.Dictionary"?uKe(t):t}function cKe(t){return`<ul class="esri-widget__list">${t.map(e=>`<li>${typeof e=="string"?cI(LJ(e)):e}</li>`).join("")}</ul>`}function uKe(t){return`<table class="esri-widget__table">${t.keys().map(e=>{const i=t.field(e);return`<tr><th>${e}</th><td>${typeof i=="string"?cI(LJ(i)):i}</td></tr>`}).join("")}</table>`}function hKe({aggregatedFeatures:t,arcadeUtils:e,featureSetVars:i,context:r,viewInfo:s,map:n,graphic:o,interceptor:a}){i.forEach(l=>{const c=l.toLowerCase(),h=s.sr,p={map:n,spatialReference:h,interceptor:a};if(c==="$map"&&(r.vars[c]=e.convertMapToFeatureSetCollection(p)),c==="$layer"&&(r.vars[c]=e.convertFeatureLayerToFeatureSet({layer:o.sourceLayer,spatialReference:h,interceptor:a})),c==="$datastore"&&(r.vars[c]=e.convertServiceUrlToWorkspace({url:o.sourceLayer.url,spatialReference:h,interceptor:a})),c==="$aggregatedfeatures"){const f=o.layer,{fields:m,objectIdField:y,geometryType:_,spatialReference:b,displayField:w}=f,S=new aTe({fields:m,objectIdField:y,geometryType:_,spatialReference:b,displayField:w,...f.type==="feature"?{templates:f.templates,typeIdField:f.typeIdField,types:f.types}:null,source:t});r.vars[c]=e.convertFeatureLayerToFeatureSet({layer:S,spatialReference:b,interceptor:a})}})}function lTe(){return ee(()=>import("./arcadeUtils-37f87c1a.js").then(t=>t.ax),["./arcadeUtils-37f87c1a.js","./arcadeTimeUtils-999b74fd.js","./executionError-fb3f283a.js","./number-9ca1111c.js","./hash-0ddfbf4b.js"],import.meta.url)}function dKe(t){return"createQuery"in t&&"queryFeatures"in t}async function pKe({graphic:t,view:e}){const{isAggregate:i,layer:r}=t;if(!i||!r||(e==null?void 0:e.type)!=="2d")return[];const s=await e.whenLayerView(r);if(!dKe(s))return[];const n=s.createQuery(),o=t.getObjectId();n.aggregateIds=o!=null?[o]:[];const{features:a}=await s.queryFeatures(n);return a}async function cTe({expressionInfo:t,arcadeUtils:e,interceptor:i,spatialReference:r,map:s,graphic:n,view:o}){if(!t||!t.expression)return null;const a=e.createSyntaxTree(t.expression),l=nKe.filter(m=>e.hasVariable(a,m)),[c]=await Promise.all([pKe({graphic:n,view:o}),e.loadScriptDependencies(a,!0,l)]),h=e.getViewInfo({spatialReference:r}),p=e.createExecContext(n,h);p.interceptor=i,p.useAsync=!0,hKe({aggregatedFeatures:c,arcadeUtils:e,featureSetVars:l,context:p,viewInfo:h,map:s,graphic:n,interceptor:i});const f=e.createFunction(a,p);return e.executeAsyncFunction(f,p).catch(m=>aKe.error("arcade-execution-error",{error:m,graphic:n,expressionInfo:t}))}async function fKe({expressionInfos:t,spatialReference:e,graphic:i,interceptor:r,map:s,view:n}){if(!t||!t.length)return{};const o=await lTe(),a={};for(const h of t)a[`expression/${h.name}`]=cTe({expressionInfo:h,arcadeUtils:o,interceptor:r,spatialReference:e,map:s,graphic:i,view:n});const l=await lc(a),c={};for(const h in l)c[h]=lKe(l[h].value);return c}const mKe=1;let xu=class extends uT($e){constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.view=null,this._cancelQuery=()=>{const{_abortController:i}=this;i&&i.abort(),this._abortController=null},this._createVM=()=>{var s,n;const i=(s=this.contentElement)==null?void 0:s.type;(n=this.contentElementViewModel)==null||n.destroy();const r=i==="fields"?new LU:i==="media"?new Yw:i==="text"?new K4:null;this._set("contentElementViewModel",r)},this._compile=async()=>{this._cancelQuery();const i=new AbortController;this._abortController=i,await this._compileExpression(),this._abortController===i&&(this._abortController=null)},this._compileThrottled=vE(this._compile,mKe,this),this._compileExpression=async()=>{const{expressionInfo:i,graphic:r,interceptor:s,spatialReference:n,map:o,view:a,_abortController:l}=this;if(!(i&&r&&n&&o))return void this._set("contentElement",null);const c=await lTe();if(l!==this._abortController)return;const h=await cTe({arcadeUtils:c,expressionInfo:i,graphic:r,interceptor:s,map:o,spatialReference:n,view:a});if(!h||h.declaredClass!=="esri.arcade.Dictionary")return void this._set("contentElement",null);const p=await h.castAsJsonAsync(l==null?void 0:l.signal),f=p==null?void 0:p.type,m=f==="media"?U3.fromJSON(p):f==="text"?iC.fromJSON(p):f==="fields"?tC.fromJSON(p):null;this._set("contentElement",m)},this.handles.add([re(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),Zt),re(()=>[this.contentElement],()=>this._createVM(),Zt)])}destroy(){var e;this._cancelQuery(),(e=this.contentElementViewModel)==null||e.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){var e;return((e=this.view)==null?void 0:e.spatialReference)??null}set spatialReference(e){this._override("spatialReference",e)}get state(){const{_abortController:e,contentElement:i,contentElementViewModel:r}=this;return e?"loading":i||r?"ready":"disabled"}get map(){var e;return((e=this.view)==null?void 0:e.map)??null}set map(e){this._override("map",e)}};u([d()],xu.prototype,"_abortController",void 0),u([d({type:bye})],xu.prototype,"expressionInfo",void 0),u([d({type:ha})],xu.prototype,"graphic",void 0),u([d({readOnly:!0})],xu.prototype,"contentElement",void 0),u([d({readOnly:!0})],xu.prototype,"contentElementViewModel",void 0),u([d()],xu.prototype,"interceptor",void 0),u([d()],xu.prototype,"spatialReference",null),u([d({readOnly:!0})],xu.prototype,"state",null),u([d()],xu.prototype,"map",null),u([d()],xu.prototype,"view",void 0),xu=u([I("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],xu);const CK=xu,W$={iconLoading:"esri-icon-loading-indicator esri-rotating",base:"esri-feature-expression",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"};let rF=class extends bl{constructor(e,i){super(e,i),this._contentWidget=null,this.viewModel=new CK}initialize(){this.addHandles(re(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentElementViewModel},()=>this._setupExpressionWidget(),Zt))}destroy(){this._destroyContentWidget()}renderLoading(){return le("div",{key:"loading-container",class:W$.loadingSpinnerContainer},le("span",{class:this.classes(W$.iconLoading,W$.spinner)}))}render(){var i;const{state:e}=this.viewModel;return le("div",{class:W$.base},e==="loading"?this.renderLoading():e==="disabled"?null:(i=this._contentWidget)==null?void 0:i.render())}_destroyContentWidget(){const{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:e,contentElement:i}=this.viewModel,r=i==null?void 0:i.type;this._destroyContentWidget();const s=e?r==="fields"?new abe({viewModel:e}):r==="media"?new Kbe({viewModel:e}):r==="text"?new $N({viewModel:e}):null:null;this._contentWidget=s,this.scheduleRender()}};u([d({type:CK})],rF.prototype,"viewModel",void 0),rF=u([I("esri.widgets.Feature.FeatureExpression")],rF);const gKe=rF,zk=100;let rs=class extends Cs(KP(uT($e))){constructor(e){super(e),this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{const{_queryAbortController:i}=this;i&&i.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:i}=this;i&&i.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:i}=this;i&&i.abort(),this._queryPageAbortController=null},this._queryController=async()=>{this._cancelQuery();const i=new AbortController;this._queryAbortController=i,await dE(this._query()),this._queryAbortController===i&&(this._queryAbortController=null)},this._queryFeatureCountController=async()=>{this._cancelQueryFeatureCount();const i=new AbortController;this._queryFeatureCountAbortController=i,await dE(this._queryFeatureCount()),this._queryFeatureCountAbortController===i&&(this._queryFeatureCountAbortController=null)},this._queryPageController=async()=>{const i=new AbortController;this._queryPageAbortController=i,await dE(this._queryPage()),this._queryPageAbortController===i&&(this._queryPageAbortController=null)},this._queryThrottled=vE(this._queryController,zk,this),this._queryFeatureCountThrottled=vE(this._queryFeatureCountController,zk,this),this._queryPageThrottled=vE(this._queryPageController,zk,this),this._query=async()=>{const{_queryAbortController:i,relatedFeatures:r}=this;this._destroyRelatedFeatureViewModels(),this.featurePage=1,r.removeAll(),r.addMany(this._sliceFeatures(await this._queryRelatedFeatures({signal:i==null?void 0:i.signal})))},this.handles.add([re(()=>[this.displayCount,this.graphic,this.layer,this.map,this.orderByFieldsFixedCasing,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount],()=>this._queryThrottled(),Zt),re(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageThrottled()),re(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery],()=>this._queryFeatureCountThrottled())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.removeAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(e){const{featuresPerPage:i,featureCount:r}=this,s=1,n=Math.ceil(r/i)||1;this._set("featurePage",Math.min(Math.max(e,s),n))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){const{orderByFields:e,relatedLayer:i}=this;return e&&(i!=null&&i.loaded)?e.map(r=>{const s=r.clone(),n=Z3(r.field,i);return s.field=n,s}):e??[]}get supportsCacheHint(){var e,i,r;return!!((r=(i=(e=this.layer)==null?void 0:e.capabilities)==null?void 0:i.queryRelated)!=null&&r.supportsCacheHint)}get canQuery(){var i,r;const e=(r=(i=this.layer)==null?void 0:i.capabilities)==null?void 0:r.queryRelated;return!!(this.relatedLayer&&this.relationship&&typeof this.relationshipId=="number"&&typeof this.objectId=="number"&&(e!=null&&e.supportsCount)&&(e!=null&&e.supportsPagination))}get itemDescriptionFieldName(){var e,i;return((i=(e=this.orderByFieldsFixedCasing)==null?void 0:e[0])==null?void 0:i.field)||null}set displayCount(e){this._set("displayCount",Math.min(Math.max(e,0),10))}get displayCount(){return this._get("displayCount")}get objectId(){var e,i;return(this.objectIdField&&((i=(e=this.graphic)==null?void 0:e.attributes)==null?void 0:i[this.objectIdField]))??null}get objectIdField(){var e;return((e=this.layer)==null?void 0:e.objectIdField)||null}get relatedFeatures(){return this._get("relatedFeatures")||new Nt}get relatedLayer(){const{layer:e,map:i,relationship:r}=this;return e!=null&&e.loaded&&i&&r?M7e(i,e,r)??null:null}get relationship(){var r;const{relationshipId:e,layer:i}=this;return typeof e=="number"?((r=i==null?void 0:i.relationships)==null?void 0:r.find(({id:s})=>s===e))??null:null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new Nt}get state(){const{_queryAbortController:e,_queryFeatureCountAbortController:i,_queryPageAbortController:r,canQuery:s}=this;return i?"loading":e||r?"querying":s?"ready":"disabled"}_destroyRelatedFeatureViewModels(){var e;(e=this.relatedFeatureViewModels)==null||e.forEach(i=>!i.destroyed&&i.destroy()),this.relatedFeatureViewModels.removeAll()}async _queryFeatureCount(){const{layer:e,relatedLayer:i,relationshipId:r,objectId:s,_queryFeatureCountAbortController:n,canQuery:o,supportsCacheHint:a}=this;if(await(e==null?void 0:e.load()),await(i==null?void 0:i.load()),!o||!e||!i)return void this._set("featureCount",0);const l=i.createQuery(),c=new yC({cacheHint:a,relationshipId:r,returnGeometry:!1,objectIds:[s],where:Hte(l.where,void 0)}),h=await e.queryRelatedFeaturesCount(c,{signal:n==null?void 0:n.signal});this._set("featureCount",h[s]||0)}_sliceFeatures(e){const{showAllEnabled:i,displayCount:r}=this;return i?e:r?e.slice(0,r):[]}async _queryPage(){const{relatedFeatures:e,featurePage:i,showAllEnabled:r,_queryPageAbortController:s}=this;!r||i<2||e.addMany(await this._queryRelatedFeatures({signal:s==null?void 0:s.signal}))}async _queryRelatedFeatures(e){var R;const{orderByFieldsFixedCasing:i,showAllEnabled:r,featuresPerPage:s,displayCount:n,layer:o,relationshipId:a,featurePage:l,featureCount:c,relatedLayer:h,supportsCacheHint:p}=this,{canQuery:f,objectId:m}=this;if(!f||!o||!h)return[];const y=r?((l-1)*s+c)%c:0,_=r?s:n,b=h.objectIdField,w=[...i==null?void 0:i.map(L=>L.field),b].filter(v),S=i==null?void 0:i.map(L=>`${L.field} ${L.order}`),T=h.createQuery(),E=new yC({orderByFields:S,start:y,num:_,outFields:w,cacheHint:p,relationshipId:a,returnGeometry:!1,objectIds:[m],where:Hte(T.where,void 0)}),O=((R=(await o.queryRelatedFeatures(E,{signal:e==null?void 0:e.signal}))[m])==null?void 0:R.features)||[];return O.forEach(L=>{L.sourceLayer=h,L.layer=h}),O}};u([d()],rs.prototype,"_queryAbortController",void 0),u([d()],rs.prototype,"_queryPageAbortController",void 0),u([d()],rs.prototype,"_queryFeatureCountAbortController",void 0),u([d({value:1})],rs.prototype,"featurePage",null),u([d()],rs.prototype,"featuresPerPage",void 0),u([d({readOnly:!0})],rs.prototype,"orderByFieldsFixedCasing",null),u([d({readOnly:!0})],rs.prototype,"supportsCacheHint",null),u([d({readOnly:!0})],rs.prototype,"canQuery",null),u([d()],rs.prototype,"description",void 0),u([d({readOnly:!0})],rs.prototype,"itemDescriptionFieldName",null),u([d({value:3})],rs.prototype,"displayCount",null),u([d({type:ha})],rs.prototype,"graphic",void 0),u([d()],rs.prototype,"layer",void 0),u([d()],rs.prototype,"map",void 0),u([d({readOnly:!0})],rs.prototype,"objectId",null),u([d({readOnly:!0})],rs.prototype,"objectIdField",null),u([d()],rs.prototype,"orderByFields",void 0),u([d({readOnly:!0})],rs.prototype,"relatedFeatures",null),u([d({readOnly:!0})],rs.prototype,"relatedLayer",null),u([d({readOnly:!0})],rs.prototype,"relationship",null),u([d()],rs.prototype,"featureCount",void 0),u([d({readOnly:!0})],rs.prototype,"relatedFeatureViewModels",null),u([d()],rs.prototype,"relationshipId",void 0),u([d()],rs.prototype,"showAllEnabled",void 0),u([d()],rs.prototype,"state",null),u([d()],rs.prototype,"title",void 0),rs=u([I("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],rs);const AK=rs,DR="esri-feature",Gk=`${DR}-relationship`,mg={base:Gk,esriWidget:"esri-widget",listContainer:`${Gk}__list`,listContainerQuerying:`${Gk}__list--querying`,featureObserver:`${DR}__feature-observer`,stickySpinnerContainer:`${DR}__sticky-loading-container`,loadingSpinnerContainer:`${DR}__loading-container`,spinner:`${DR}__loading-spinner`,iconLoading:"esri-icon-loading-indicator esri-rotating"},poe={title:!0,description:!0};let Vl=class extends bl{constructor(e,i){super(e,i),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([r])=>{r!=null&&r.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.headingLevel=2,this.viewModel=new AK,this.messages=null,this.messagesCommon=null,this.visibleElements={...poe},this._increaseFeaturePage=()=>{const{state:r,showAllEnabled:s,relatedFeatures:n,featuresPerPage:o,featurePage:a}=this.viewModel;r==="ready"&&s&&n.length>=o*a&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new $U,this.addHandles([re(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),Zt),re(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),pn(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return Promise.all([ee(()=>import("./calcite-list-7135aaaa.js"),["./calcite-list-7135aaaa.js","./interactive-573cbe88.js","./observers-4f67f1fb.js","./utils3-1ce076c1.js","./loadable-25ad9e4e.js","./debounce-31e0cfcc.js","./t9n-25a567dc.js","./icon-f7d88fe1.js","./loader-5f4c008e.js","./guid-9426053f.js","./scrim-333a6848.js"],import.meta.url),ee(()=>import("./calcite-list-item-ad8c4849.js"),["./calcite-list-item-ad8c4849.js","./interactive-573cbe88.js","./utils3-1ce076c1.js","./loadable-25ad9e4e.js","./icon-f7d88fe1.js","./observers-4f67f1fb.js"],import.meta.url),ee(()=>import("./calcite-icon-1a5b9b53.js"),["./calcite-icon-1a5b9b53.js","./icon-f7d88fe1.js","./observers-4f67f1fb.js"],import.meta.url),ee(()=>import("./calcite-notice-570846d2.js"),["./calcite-notice-570846d2.js","./observers-4f67f1fb.js","./loadable-25ad9e4e.js","./t9n-25a567dc.js","./icon-f7d88fe1.js"],import.meta.url)])}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=Je(this._featureElementInfo)}get displayShowAllButton(){const{showAllEnabled:e,featureCount:i,displayCount:r}=this.viewModel;return!e&&!!i&&(i>r||r===0)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get featureCountDescription(){const{messages:e}=this,{featureCount:i}=this.viewModel;return rm(i===1?e==null?void 0:e.numberRecord:e==null?void 0:e.numberRecords,{number:i})}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}castVisibleElements(e){return{...poe,...e}}renderStickyLoading(){return this.viewModel.state==="querying"?le("div",{key:"sticky-loader",class:mg.stickySpinnerContainer},this.renderLoadingIcon()):null}renderLoadingIcon(){return le("span",{class:this.classes(mg.iconLoading,mg.spinner)})}renderLoading(){return le("div",{key:"loading-container",class:mg.loadingSpinnerContainer},this.renderLoadingIcon())}renderShowAllIconNode(){return le("calcite-icon",{scale:"s",icon:"list",slot:"content-end"})}renderChevronIconNode(){const e=bm(this.container)?"chevron-left":"chevron-right";return le("calcite-icon",{scale:"s",icon:e,slot:"content-end"})}renderRelatedFeature(e){var n,o;const{itemDescriptionFieldName:i}=this.viewModel,r=e.title;e.description=i&&((n=e.formattedAttributes)==null?void 0:n.global[i]);const s=e.state==="loading";return le("calcite-list-item",{key:e.uid,label:s?`${(o=this.messagesCommon)==null?void 0:o.loading}…`:r,description:s?"…":e.description??"",onCalciteListItemSelect:()=>this.emit("select-record",{featureViewModel:e})},this.renderChevronIconNode())}renderShowAllListItem(){var e;return this.displayShowAllButton?le("calcite-list-item",{key:"show-all-item",label:(e=this.messages)==null?void 0:e.showAll,description:this.featureCountDescription,onCalciteListItemSelect:()=>this.emit("show-all-records")},this.renderShowAllIconNode()):null}renderNoRelatedFeaturesMessage(){var e;return le("calcite-notice",{key:"no-related-features-message",icon:"information",open:!0,kind:"brand",scale:"s",width:"full"},le("div",{slot:"message"},(e=this.messages)==null?void 0:e.noRelatedFeatures))}renderFeatureObserver(){return le("div",{key:"feature-observer",class:mg.featureObserver,bind:this,afterCreate:this._relatedFeatureIntersectionObserverCreated})}renderList(){const{relatedFeatureViewModels:e}=this.viewModel;return le("calcite-list",null,e.toArray().map(i=>this.renderRelatedFeature(i)),this.renderShowAllListItem())}renderRelatedFeatures(){const{displayListItems:e}=this,{state:i}=this.viewModel;return le("div",{key:"list-container",class:this.classes(mg.listContainer,{[mg.listContainerQuerying]:i==="querying"})},e?this.renderList():i==="ready"?this.renderNoRelatedFeaturesMessage():null,this.renderStickyLoading(),this.renderFeatureObserver())}renderRelationshipNotFound(){var e;return le("calcite-notice",{key:"relationship-not-found",icon:"exclamation-mark-triangle",open:!0,kind:"danger",scale:"s",width:"full"},le("div",{slot:"message"},(e=this.messages)==null?void 0:e.relationshipNotFound))}render(){var i;const{state:e}=this.viewModel;return le("div",{class:this.classes(mg.base,mg.esriWidget)},(i=this._featureElementInfo)==null?void 0:i.render(),e==="loading"?this.renderLoading():e==="disabled"?this.renderRelationshipNotFound():this.renderRelatedFeatures())}_setupRelatedFeatureViewModels(){const{relatedFeatureViewModels:e}=this.viewModel,i="related-feature-viewmodels";this.removeHandles(i),e==null||e.forEach(r=>{this.addHandles(re(()=>[r.title,r.state],()=>this.scheduleRender(),Zt),i)}),this.scheduleRender()}_setupFeatureElementInfo(){var n;const{headingLevel:e,visibleElements:i}=this,r=i.description&&this.description,s=i.title&&this.title;(n=this._featureElementInfo)==null||n.set({description:r,title:s,headingLevel:e})}async _handleRelatedFeatureObserverChange(){this._unobserveRelatedFeatureObserver();const{state:e,showAllEnabled:i}=this.viewModel;await _x(0),this._relatedFeatureIntersectionObserverNode&&e==="ready"&&i&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)}_relatedFeatureIntersectionObserverCreated(e){this._relatedFeatureIntersectionObserverNode=e}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};u([d()],Vl.prototype,"_relatedFeatureIntersectionObserverNode",void 0),u([d({readOnly:!0})],Vl.prototype,"displayShowAllButton",null),u([d({readOnly:!0})],Vl.prototype,"displayListItems",null),u([d()],Vl.prototype,"description",null),u([d({readOnly:!0})],Vl.prototype,"featureCountDescription",null),u([d()],Vl.prototype,"headingLevel",void 0),u([d()],Vl.prototype,"title",null),u([d({type:AK})],Vl.prototype,"viewModel",void 0),u([d(),dl("esri/widgets/Feature/t9n/Feature")],Vl.prototype,"messages",void 0),u([d(),dl("esri/t9n/common")],Vl.prototype,"messagesCommon",void 0),u([d()],Vl.prototype,"visibleElements",void 0),u([wi("visibleElements")],Vl.prototype,"castVisibleElements",null),Vl=u([I("esri.widgets.Feature.FeatureRelationship")],Vl);const foe=Vl;let yKe=class{constructor(e,i){this.preLayerQueryCallback=e,this.preRequestCallback=i,this.preLayerQueryCallback||(this.preLayerQueryCallback=r=>{}),this.preRequestCallback||(this.preLayerQueryCallback=r=>{})}};var NR;const _Ke=1,moe="content-view-models",goe="relationship-view-models",yoe={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0};let Ls=NR=class extends KP($e){constructor(t){super(t),this._handles=new Ki,this._error=null,this._featureAbortController=null,this._graphicChangedThrottled=vE(this._graphicChanged,_Ke,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...yoe},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=e=>{const{abilities:i}=this;return e.type==="attachments"&&!!i.attachmentsContent||e.type==="custom"&&!!i.customContent||e.type==="fields"&&!!i.fieldsContent||e.type==="media"&&!!i.mediaContent||e.type==="text"&&!!i.textContent||e.type==="expression"&&!!i.expressionContent||e.type==="relationship"&&!!i.relationshipContent},this._handles.add(re(()=>[this.graphic,this._effectivePopupTemplate,this.abilities],()=>this._graphicChangedThrottled(),Zt))}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this._handles.destroy(),this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return v(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return T7e(nse(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return Y1e(this.graphic)}castAbilities(t){return{...yoe,...t}}get isTable(){var t;return((t=this._sourceLayer)==null?void 0:t.isTable)||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(t){this._set("graphic",t?t.clone():null)}get spatialReference(){var t;return((t=this.view)==null?void 0:t.spatialReference)??null}set spatialReference(t){this._override("spatialReference",t)}get map(){var t;return((t=this.view)==null?void 0:t.map)||null}set map(t){this._override("map",t)}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(t,e){const i=this.contentViewModels[t];i instanceof Yw&&i.setActiveMedia(e)}nextMedia(t){const e=this.contentViewModels[t];e instanceof Yw&&e.next()}previousMedia(t){const e=this.contentViewModels[t];e instanceof Yw&&e.previous()}async updateGeometry(){var o,a;const{graphic:t,spatialReference:e,_sourceLayer:i}=this;await(i==null?void 0:i.load());const r=i==null?void 0:i.objectIdField;if(!r||!t||!i)return;const s=(o=t==null?void 0:t.attributes)==null?void 0:o[r];if(s==null)return;const n=[s];if(!t.geometry){const l=(a=await tbe({layer:i,graphic:t,outFields:[],objectIds:n,returnGeometry:!0,spatialReference:e}))==null?void 0:a.geometry;l&&(t.geometry=l)}}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:t}=this;if(!t)return;const e=new AbortController;this._featureAbortController=e;try{await this._queryFeature({signal:e.signal})}catch(i){ln(i)||(this._error=i,oe.getLogger(this.declaredClass).error("error","The popupTemplate could not be displayed for this feature.",{error:i,graphic:t,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===e&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:t}=this;t&&t.abort(),this._featureAbortController=null}_compileContentElement(t,e){return t.type==="attachments"?this._compileAttachments(t,e):t.type==="custom"?this._compileCustom(t,e):t.type==="fields"?this._compileFields(t,e):t.type==="media"?this._compileMedia(t,e):t.type==="text"?this._compileText(t,e):t.type==="expression"?this._compileExpression(t,e):t.type==="relationship"?this._compileRelationship(t,e):void 0}_compileContent(t){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(t)?t.filter(this._isAllowedContentType).map((e,i)=>this._compileContentElement(e,i)).filter(v):typeof t=="string"?this._compileText(new iC({text:t}),0).text:t}_destroyContentViewModels(){var t,e;(t=this._handles)==null||t.remove(goe),(e=this._handles)==null||e.remove(moe),this.contentViewModels.forEach(i=>i&&!i.destroyed&&i.destroy()),this._set("contentViewModels",[])}_matchesFeature(t,e){var s;const i=(s=t==null?void 0:t.graphic)==null?void 0:s.getObjectId(),r=e==null?void 0:e.getObjectId();return v(i)&&v(r)&&i===r}_setRelatedFeaturesViewModels({relatedFeatureViewModels:t,relatedFeatures:e,map:i}){const{view:r,spatialReference:s}=this;e==null||e.filter(Boolean).forEach(n=>{t.find(o=>this._matchesFeature(o,n))||t.add(new NR({abilities:{relationshipContent:!1},map:i,view:r,spatialReference:s,graphic:n}))}),t.forEach(n=>{(e==null?void 0:e.find(a=>this._matchesFeature(n,a)))||t.remove(n)})}_setExpressionContentVM(t,e){const i=this.formattedAttributes,{contentElement:r,contentElementViewModel:s}=t,n=r==null?void 0:r.type;s&&n&&(n==="fields"&&(this._createFieldsFormattedAttributes({contentElement:r,contentElementIndex:e,formattedAttributes:i}),s.set(this._createFieldsVMParams(r,e))),n==="media"&&(this._createMediaFormattedAttributes({contentElement:r,contentElementIndex:e,formattedAttributes:i}),s.set(this._createMediaVMParams(r,e))),n==="text"&&s.set(this._createTextVMParams(r)))}_compileRelationship(t,e){const{displayCount:i,orderByFields:r,relationshipId:s,title:n,description:o}=t,{_sourceLayer:a,graphic:l,map:c}=this,h=new AK({displayCount:i,graphic:l,orderByFields:r,relationshipId:s,layer:a,map:c,...this._compileTitleAndDesc({title:n,description:o})});return this.contentViewModels[e]=h,this._handles.add(pn(()=>h.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(h)),goe),t}_compileExpression(t,e){const{expressionInfo:i}=t,{graphic:r,map:s,spatialReference:n,view:o}=this,a=new CK({expressionInfo:i,graphic:r,interceptor:NR.interceptor,map:s,spatialReference:n,view:o});return this.contentViewModels[e]=a,this._handles.add(re(()=>a.contentElementViewModel,()=>this._setExpressionContentVM(a,e),Zt),moe),t}_compileAttachments(t,e){const{graphic:i}=this,{description:r,title:s}=t;return this.contentViewModels[e]=new NJ({graphic:i,...this._compileTitleAndDesc({title:s,description:r})}),t}_compileCustom(t,e){const{graphic:i}=this,{creator:r,destroyer:s}=t;return this.contentViewModels[e]=new K4({graphic:i,creator:r,destroyer:s}),t}_compileTitleAndDesc({title:t,description:e}){const{_fieldInfoMap:i,_sourceLayer:r,graphic:s,formattedAttributes:n}=this,o=s==null?void 0:s.attributes,a=this._expressionAttributes,l=n.global;return{title:Ww({attributes:o,fieldInfoMap:i,globalAttributes:l,expressionAttributes:a,layer:r,text:t}),description:Ww({attributes:o,fieldInfoMap:i,globalAttributes:l,expressionAttributes:a,layer:r,text:e})}}_createFieldsVMParams(t,e){var c;const i=this._effectivePopupTemplate,r=this.formattedAttributes,s={...r==null?void 0:r.global,...r==null?void 0:r.content[e]},n=(c=(t==null?void 0:t.fieldInfos)||(i==null?void 0:i.fieldInfos))==null?void 0:c.filter(({fieldName:h})=>IJ(h)||by(h)||s.hasOwnProperty(h)),o=i==null?void 0:i.expressionInfos,{description:a,title:l}=t;return{attributes:s,expressionInfos:o,fieldInfos:n,...this._compileTitleAndDesc({title:l,description:a})}}_compileFields(t,e){const i=t.clone(),r=new LU(this._createFieldsVMParams(t,e));return this.contentViewModels[e]=r,i.fieldInfos=r.formattedFieldInfos.slice(0),i}_createMediaVMParams(t,e){const{abilities:i,graphic:r,_fieldInfoMap:s,_effectivePopupTemplate:n,relatedInfos:o,_sourceLayer:a,_expressionAttributes:l}=this,c=this.formattedAttributes,h=(r==null?void 0:r.attributes)??{},{description:p,mediaInfos:f,title:m}=t;return{abilities:{chartAnimation:i.chartAnimation},activeMediaInfoIndex:t.activeMediaInfoIndex||0,attributes:h,isAggregate:r==null?void 0:r.isAggregate,layer:a,fieldInfoMap:s,formattedAttributes:{...c==null?void 0:c.global,...c==null?void 0:c.content[e]},expressionAttributes:l,mediaInfos:f,popupTemplate:n,relatedInfos:o,...this._compileTitleAndDesc({title:m,description:p})}}_compileMedia(t,e){const i=t.clone(),r=new Yw(this._createMediaVMParams(t,e));return i.mediaInfos=r.formattedMediaInfos.slice(0),this.contentViewModels[e]=r,i}_createTextVMParams(t){var n;const{graphic:e,_fieldInfoMap:i,_sourceLayer:r,_expressionAttributes:s}=this;if(t&&t.text){const o=(e==null?void 0:e.attributes)??{},a=((n=this.formattedAttributes)==null?void 0:n.global)??{};t.text=Ww({attributes:o,fieldInfoMap:i,globalAttributes:a,expressionAttributes:s,layer:r,text:t.text})}return{graphic:e,creator:t.text}}_compileText(t,e){const i=t.clone();return this.contentViewModels[e]=new K4(this._createTextVMParams(i)),i}_compileLastEditInfo(){const{_effectivePopupTemplate:t,_sourceLayer:e,graphic:i}=this;if(!t)return;const{lastEditInfoEnabled:r}=t,s=e==null?void 0:e.editFieldsInfo;return r&&s?x7e(s,i==null?void 0:i.attributes):void 0}_compileTitle(t){var a;const{_fieldInfoMap:e,_sourceLayer:i,graphic:r,_expressionAttributes:s}=this,n=(r==null?void 0:r.attributes)??{},o=((a=this.formattedAttributes)==null?void 0:a.global)??{};return Ww({attributes:n,fieldInfoMap:e,globalAttributes:o,expressionAttributes:s,layer:i,text:t})}async _getTitle(){const{_effectivePopupTemplate:t,graphic:e}=this;if(!e)return null;const i=t==null?void 0:t.title;return J4(i,{graphic:e})}async _getContent(){const{_effectivePopupTemplate:t,graphic:e}=this;if(!e)return null;const i=t==null?void 0:t.content;return J4(i,{graphic:e})}async _queryFeature(t){const{_featureAbortController:e,_sourceLayer:i,graphic:r,_effectivePopupTemplate:s}=this,n=this.map,o=this.view,a=this.spatialReference;if(e!==this._featureAbortController||!r)return;await E7e({graphic:r,popupTemplate:s,layer:i,spatialReference:a},t);const{content:{value:l},title:{value:c}}=await lc({content:this._getContent(),title:this._getTitle()}),{expressionAttributes:{value:h}}=await lc({checkForRelatedFeatures:this._checkForRelatedFeatures(t),expressionAttributes:fKe({expressionInfos:s==null?void 0:s.expressionInfos,spatialReference:a,graphic:r,map:n,interceptor:NR.interceptor,view:o})});e===this._featureAbortController&&r&&(this._expressionAttributes=h,this._graphicExpressionAttributes={...r.attributes,...h},this._set("formattedAttributes",this._createFormattedAttributes(l)),this._set("title",this._compileTitle(c)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(l)||null))}_createMediaFormattedAttributes({contentElement:t,contentElementIndex:e,formattedAttributes:i}){const{_effectivePopupTemplate:r,graphic:s,relatedInfos:n,_sourceLayer:o,_fieldInfoMap:a,_graphicExpressionAttributes:l}=this;i.content[e]=QV({fieldInfos:r==null?void 0:r.fieldInfos,graphic:s,attributes:{...l,...t.attributes},layer:o,fieldInfoMap:a,relatedInfos:n})}_createFieldsFormattedAttributes({contentElement:t,contentElementIndex:e,formattedAttributes:i}){if(t.fieldInfos){const{graphic:r,relatedInfos:s,_sourceLayer:n,_fieldInfoMap:o,_graphicExpressionAttributes:a}=this;i.content[e]=QV({fieldInfos:t.fieldInfos,graphic:r,attributes:{...a,...t.attributes},layer:n,fieldInfoMap:o,relatedInfos:s})}}_createFormattedAttributes(t){const{_effectivePopupTemplate:e,graphic:i,relatedInfos:r,_sourceLayer:s,_fieldInfoMap:n,_graphicExpressionAttributes:o}=this,a=e==null?void 0:e.fieldInfos,l={global:QV({fieldInfos:a,graphic:i,attributes:o,layer:s,fieldInfoMap:n,relatedInfos:r}),content:[]};return Array.isArray(t)&&t.forEach((c,h)=>{c.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l}),c.type==="media"&&this._createMediaFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l})}),l}_checkForRelatedFeatures(t){const{graphic:e,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(e,nse(i),t)}async _queryRelatedInfos(t,e,i){const{relatedInfos:r,_sourceLayer:s}=this;r.clear();const n=v(s==null?void 0:s.associatedLayer)?await(s==null?void 0:s.associatedLayer.load(i)):s;if(!n||!t)return;const o=e.filter(c=>c&&by(c.fieldName));if(!o||!o.length)return;e.forEach(c=>this._configureRelatedInfo(c,n));const a=await LHe({relatedInfos:r,layer:n},i);Object.keys(a).forEach(c=>{var f;const h=r.get(c.toString()),p=(f=a[c])==null?void 0:f.value;h&&p&&(h.layerInfo=p.data)});const l=await DHe({graphic:t,relatedInfos:r,layer:n},i);Object.keys(l).forEach(c=>{var h;RHe((h=l[c])==null?void 0:h.value,r.get(c.toString()))})}_configureRelatedInfo(t,e){const{relatedInfos:i}=this,r=UN(t.fieldName);if(!r)return;const{layerId:s,fieldName:n}=r;if(!s)return;const o=i.get(s.toString())||OHe(s,e);o&&(NHe({relatedInfo:o,fieldName:n,fieldInfo:t}),this.relatedInfos.set(s,o))}};Ls.interceptor=new yKe(O7e,R7e),u([d()],Ls.prototype,"_error",void 0),u([d()],Ls.prototype,"_featureAbortController",void 0),u([d({readOnly:!0})],Ls.prototype,"_effectivePopupTemplate",null),u([d({readOnly:!0})],Ls.prototype,"_fieldInfoMap",null),u([d({readOnly:!0})],Ls.prototype,"_sourceLayer",null),u([d()],Ls.prototype,"abilities",void 0),u([wi("abilities")],Ls.prototype,"castAbilities",null),u([d({readOnly:!0})],Ls.prototype,"content",void 0),u([d({readOnly:!0})],Ls.prototype,"contentViewModels",void 0),u([d()],Ls.prototype,"description",void 0),u([d({type:Boolean})],Ls.prototype,"defaultPopupTemplateEnabled",void 0),u([d({readOnly:!0})],Ls.prototype,"isTable",null),u([d({readOnly:!0})],Ls.prototype,"state",null),u([d({readOnly:!0})],Ls.prototype,"formattedAttributes",void 0),u([d({type:ha,value:null})],Ls.prototype,"graphic",null),u([d({readOnly:!0})],Ls.prototype,"lastEditInfo",void 0),u([d({readOnly:!0})],Ls.prototype,"relatedInfos",void 0),u([d()],Ls.prototype,"spatialReference",null),u([d({readOnly:!0})],Ls.prototype,"title",void 0),u([d()],Ls.prototype,"map",null),u([d({readOnly:!0})],Ls.prototype,"waitingForContent",null),u([d()],Ls.prototype,"view",void 0),Ls=NR=u([I("esri.widgets.FeatureViewModel")],Ls);const OK=Ls,fa="esri-feature",nn={iconText:"esri-icon-font-fallback-text",iconLoading:"esri-icon-loading-indicator esri-rotating",esriTable:"esri-widget__table",esriWidget:"esri-widget",base:fa,container:`${fa}__size-container`,title:`${fa}__title`,main:`${fa}__main-container`,btn:`${fa}__button`,icon:`${fa}__icon`,content:`${fa}__content`,contentNode:`${fa}__content-node`,contentElement:`${fa}__content-element`,text:`${fa}__text`,lastEditedInfo:`${fa}__last-edited-info`,fields:`${fa}__fields`,fieldHeader:`${fa}__field-header`,fieldData:`${fa}__field-data`,fieldDataDate:`${fa}__field-data--date`,loadingSpinnerContainer:`${fa}__loading-container`,spinner:`${fa}__loading-spinner`},uTe=t=>{let e=class extends t{constructor(){super(...arguments),this.renderNodeContent=i=>obe(i)&&!i.destroyed?le("div",{class:nn.contentNode,key:i},i.render()):i instanceof HTMLElement?le("div",{class:nn.contentNode,key:i,bind:i,afterCreate:this._attachToNode}):W7e(i)?le("div",{class:nn.contentNode,key:i,bind:i.domNode,afterCreate:this._attachToNode}):null}_attachToNode(i){const r=this;i.appendChild(r)}};return e=u([I("esri.widgets.Feature.ContentMixin")],e),e};var oq;const _oe={title:!0,content:!0,lastEditedInfo:!0},voe="relationship-handles";let Mo=oq=class extends uTe(bl){constructor(t,e){super(t,e),this._contentWidgets=[],this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.visibleElements={..._oe},this.viewModel=new OK}initialize(){this.addHandles(re(()=>{var t;return(t=this.viewModel)==null?void 0:t.contentViewModels},()=>this._setupContentWidgets(),Zt))}loadDependencies(){return ee(()=>import("./calcite-notice-570846d2.js"),["./calcite-notice-570846d2.js","./observers-4f67f1fb.js","./loadable-25ad9e4e.js","./t9n-25a567dc.js","./icon-f7d88fe1.js"],import.meta.url)}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(t){this.viewModel.graphic=t}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(t){this.viewModel.defaultPopupTemplateEnabled=t}get isTable(){return this.viewModel.isTable}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(t){this.viewModel.spatialReference=t}get title(){return this.viewModel.title}castVisibleElements(t){return{..._oe,...t}}get map(){return this.viewModel.map}set map(t){this.viewModel.map=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}render(){const{state:t}=this.viewModel,e=le("div",{class:nn.container,key:"container"},this.renderTitle(),t==="error"?this.renderError():t==="loading"?this.renderLoading():this.renderContentContainer());return le("div",{class:this.classes(nn.base,nn.esriWidget)},e)}setActiveMedia(t,e){return this.viewModel.setActiveMedia(t,e)}nextMedia(t){return this.viewModel.nextMedia(t)}previousMedia(t){return this.viewModel.previousMedia(t)}renderError(){const{messagesCommon:t,messages:e,visibleElements:i}=this;return le("calcite-notice",{open:!0,kind:"danger",icon:"exclamation-mark-circle",scale:"s"},i.title?le("div",{key:"error-title",slot:"title"},t.errorMessage):null,le("div",{key:"error-message",slot:"message"},e.loadingError))}renderLoading(){return le("div",{key:"loading-container",class:nn.loadingSpinnerContainer},le("span",{class:this.classes(nn.iconLoading,nn.spinner)}))}renderContentContainer(){const{visibleElements:t}=this;return t.content?le("div",{class:nn.main},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:t,title:e}=this;return t.title?le(FJ,{level:this.headingLevel,class:nn.title,innerHTML:e}):null}renderContent(){const t=this.viewModel.content,e="content";if(!t)return null;if(Array.isArray(t))return t.length?le("div",{class:nn.contentNode,key:`${e}-content-elements`},t.map(this.renderContentElement,this)):null;if(typeof t=="string"){const i=this._contentWidgets[0];return!i||i.destroyed?null:le("div",{class:nn.contentNode,key:`${e}-content`},i.render())}return this.renderNodeContent(t)}renderContentElement(t,e){var r;const{visibleElements:i}=this;if(typeof i.content!="boolean"&&!((r=i.content)!=null&&r[t.type]))return null;switch(t.type){case"attachments":return this.renderAttachments(e);case"custom":return this.renderCustom(t,e);case"fields":return this.renderFields(e);case"media":return this.renderMedia(e);case"text":return this.renderText(t,e);case"expression":return this.renderExpression(e);case"relationship":return this.renderRelationship(e);default:return null}}renderAttachments(t){const e=this._contentWidgets[t];if(!e||e.destroyed)return null;const{state:i,attachmentInfos:r}=e.viewModel;return i==="loading"||r.length>0?le("div",{key:this._buildKey("attachments-element",t),class:this.classes(nn.contentElement)},e.render()):null}renderRelationship(t){const e=this._contentWidgets[t];return e&&!e.destroyed&&this.flowItems?le("div",{key:this._buildKey("relationship-element",t),class:nn.contentElement},e.render()):null}renderExpression(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:le("div",{key:this._buildKey("expression-element",t),class:nn.contentElement},e.render())}renderCustom(t,e){const{creator:i}=t,r=this._contentWidgets[e];return!r||r.destroyed?null:i?le("div",{key:this._buildKey("custom-element",e),class:nn.contentElement},r.render()):null}renderFields(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:le("div",{key:this._buildKey("fields-element",t),class:nn.contentElement},e.render())}renderMedia(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:le("div",{key:this._buildKey("media-element",t),class:nn.contentElement},e.render())}renderLastEditInfo(){const{visibleElements:t,messages:e}=this,{lastEditInfo:i}=this.viewModel;if(!i||!t.lastEditedInfo)return null;const{date:r,user:s}=i,n=i.type==="edit"?s?e.lastEditedByUser:e.lastEdited:s?e.lastCreatedByUser:e.lastCreated,o=rm(n,{date:r,user:s});return le("div",{key:"edit-info-element",class:this.classes(nn.lastEditedInfo,nn.contentElement)},o)}renderText(t,e){const i=t.text,r=this._contentWidgets[e];return!r||r.destroyed?null:i?le("div",{key:this._buildKey("text-element",e),class:this.classes(nn.contentElement,nn.text)},r.render()):null}_buildKey(t,...e){return`${t}__${this.get("viewModel.graphic.uid")||"0"}-${e.join("-")}`}_destroyContentWidget(t){t&&(t.viewModel=null,!t.destroyed&&t.destroy())}_destroyContentWidgets(){this.removeHandles(voe),this._contentWidgets.forEach(t=>this._destroyContentWidget(t)),this._contentWidgets=[]}_addFeatureRelationshipHandles(t){const{flowItems:e,visibleElements:i}=this;this.addHandles([pn(()=>t,"select-record",({featureViewModel:r})=>{e&&(r.abilities={relationshipContent:!0},e.push(new oq({flowItems:e,viewModel:r,visibleElements:i})))}),pn(()=>t,"show-all-records",()=>{if(!e)return;const{viewModel:r}=t;r.showAllEnabled=!0;const s=new foe({visibleElements:{title:!1,description:!1},viewModel:r});this._addFeatureRelationshipHandles(s),e.push(s)})],voe)}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:t,visibleElements:e}=this,i=this.get("viewModel.content"),{contentViewModels:r}=this.viewModel;if(Array.isArray(i))i.forEach((s,n)=>{if(s.type==="attachments"&&(this._contentWidgets[n]=new U7e({displayType:s.displayType,headingLevel:e.title?t+1:t,viewModel:r[n]})),s.type==="fields"&&(this._contentWidgets[n]=new abe({viewModel:r[n]})),s.type==="media"&&(this._contentWidgets[n]=new Kbe({viewModel:r[n]})),s.type==="text"&&(this._contentWidgets[n]=new $N({viewModel:r[n]})),s.type==="custom"&&(this._contentWidgets[n]=new $N({viewModel:r[n]})),s.type==="expression"&&(this._contentWidgets[n]=new gKe({viewModel:r[n]})),s.type==="relationship"){const o=new foe({viewModel:r[n]});this._addFeatureRelationshipHandles(o),this._contentWidgets[n]=o}},this);else{const s=r[0];s&&!s.destroyed&&(this._contentWidgets[0]=new $N({viewModel:s}))}this.scheduleRender()}};u([d()],Mo.prototype,"graphic",null),u([d()],Mo.prototype,"defaultPopupTemplateEnabled",null),u([d()],Mo.prototype,"flowItems",void 0),u([d()],Mo.prototype,"headingLevel",void 0),u([d({readOnly:!0})],Mo.prototype,"isTable",null),u([d()],Mo.prototype,"label",null),u([d(),dl("esri/widgets/Feature/t9n/Feature")],Mo.prototype,"messages",void 0),u([d(),dl("esri/t9n/common")],Mo.prototype,"messagesCommon",void 0),u([d(),dl("esri/widgets/support/t9n/uriUtils")],Mo.prototype,"messagesURIUtils",void 0),u([d()],Mo.prototype,"spatialReference",null),u([d({readOnly:!0})],Mo.prototype,"title",null),u([d()],Mo.prototype,"visibleElements",void 0),u([wi("visibleElements")],Mo.prototype,"castVisibleElements",null),u([d()],Mo.prototype,"map",null),u([d()],Mo.prototype,"view",null),u([d({type:OK})],Mo.prototype,"viewModel",void 0),Mo=oq=u([I("esri.widgets.Feature")],Mo);const vKe=Mo;var hTe;const sF=Symbol("anchorHandles");let Jb=class extends As.EventedAccessor{constructor(e){super(e),this[hTe]=new Ki,this.location=null,this.screenLocationEnabled=!1,this.view=null,this[sF].add([qo(()=>go(this.screenLocationEnabled?this.view:null,i=>[i.size,i.type==="3d"?i.camera:i.viewpoint]),()=>this.notifyChange("screenLocation")),re(()=>this.screenLocation,(i,r)=>{v(i)&&v(r)&&this.emit("view-change")})])}destroy(){this.view=null,this[sF]=Je(this[sF])}get screenLocation(){var s;const{location:e,view:i,screenLocationEnabled:r}=this;return r&&v(e)&&v(i)&&i.ready?(s=i.toScreen)==null?void 0:s.call(i,e):null}};hTe=sF,u([d()],Jb.prototype,"location",void 0),u([d()],Jb.prototype,"screenLocation",null),u([d()],Jb.prototype,"screenLocationEnabled",void 0),u([d()],Jb.prototype,"view",void 0),Jb=u([I("esri.widgets.support.AnchorElementViewModel")],Jb);const dTe=Jb,bKe="esri.widgets.CompassViewModel";let nF=class extends dTe{constructor(e){super(e),this.visible=!1}};u([d()],nF.prototype,"visible",void 0),nF=u([I(bKe)],nF);const pTe=nF,jk="esri-spinner",Hk={base:jk,spinnerStart:`${jk}--start`,spinnerFinish:`${jk}--finish`};let Kb=class extends bl{constructor(e,i){super(e,i),this._animationDelay=500,this._animationPromise=null,this.viewModel=new pTe}initialize(){this.addHandles(re(()=>this.visible,e=>this._visibleChange(e)))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}show(e){const{location:i,promise:r}=e??{};i&&(this.viewModel.location=i),this.visible=!0;const s=()=>this.hide();r&&r.catch(()=>{}).then(s)}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:i}=this.viewModel,r=!!i,s=e&&r,n=!e&&r,o={[Hk.spinnerStart]:s,[Hk.spinnerFinish]:n},a=this._getPositionStyles();return le("div",{class:this.classes(Hk.base,o),styles:a})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const i=_x(this._animationDelay);this._animationPromise=i,i.catch(()=>{}).then(()=>{this._animationPromise===i&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:e,view:i}=this.viewModel;if(C(i)||C(e))return{};const{padding:r}=i;return{left:e.x-r.left+"px",top:e.y-r.top+"px"}}};u([d()],Kb.prototype,"location",null),u([d()],Kb.prototype,"view",null),u([d({type:pTe})],Kb.prototype,"viewModel",void 0),u([d()],Kb.prototype,"visible",null),Kb=u([I("esri.widgets.Spinner")],Kb);const wKe=Kb,ZU={iconZoom:"esri-icon-zoom-in-magnifying-glass",iconTrash:"esri-icon-trash",iconBrowseClusteredFeatures:"esri-icon-table"},Zw=new ZC({id:"zoom-to-feature",title:"{messages.zoom}",className:ZU.iconZoom}),boe=new ZC({id:"remove-selected-feature",title:"{messages.remove}",className:ZU.iconTrash}),qS=new ZC({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:ZU.iconZoom}),WS=new ZC({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:ZU.iconBrowseClusteredFeatures}),xKe="esri.widgets.Popup.PopupViewModel",c5=oe.getLogger(xKe),TKe=t=>{const{event:e,view:i}=t,{action:r}=e,s=i&&i.popup;if(!r)return Promise.reject(new W("trigger-action:missing-arguments","Event has no action"));if(!s)return Promise.reject(new W("trigger-action:missing-arguments","view.popup is missing"));const{disabled:n,id:o}=r;if(!o)return Promise.reject(new W("trigger-action:invalid-action","action.id is missing"));if(n)return Promise.reject(new W("trigger-action:invalid-action","Action is disabled"));if(o===Zw.id)return EKe(s.viewModel).catch(Jz);if(o===qS.id)return CKe(s.viewModel);if(o===WS.id)return s.featureMenuOpen=!s.featureMenuOpen,s.viewModel.browseClusterEnabled=!s.viewModel.browseClusterEnabled,Promise.resolve();if(s.viewModel.browseClusterEnabled=!1,o===boe.id){s.close();const{selectedFeature:a}=s;if(!a)return Promise.reject(new W(`trigger-action:${boe.id}`,"selectedFeature is required",{selectedFeature:a}));const{sourceLayer:l}=a;return l?l.remove(a):i.graphics.remove(a),Promise.resolve()}return Promise.resolve()};function fTe(t){const{selectedFeature:e,location:i,view:r}=t;return r?r.type==="3d"?e??i??null:t.get("selectedFeature.geometry")||i:null}function Mw(t){var e,i;return!!t&&t.isAggregate&&((i=(e=t.sourceLayer)==null?void 0:e.featureReduction)==null?void 0:i.type)==="cluster"}async function SKe(t,e){if((e==null?void 0:e.type)!=="3d"||!t||t.declaredClass!=="esri.Graphic")return!0;const i=e.getViewForGraphic(t);if(i&&"whenGraphicBounds"in i){let r;try{r=await i.whenGraphicBounds(t,{useViewElevation:!0})}catch{}return!r||!r.boundingBox||r.boundingBox[0]===r.boundingBox[3]&&r.boundingBox[1]===r.boundingBox[4]&&r.boundingBox[2]===r.boundingBox[5]}return!0}async function EKe(t){var h;const{location:e,selectedFeature:i,view:r,zoomFactor:s}=t,n=fTe(t);if(!r||!n){const p=new W("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:n,view:r});throw c5.error(p),p}const o=r.scale/s,a=(h=t.selectedFeature)==null?void 0:h.geometry,l=a??e,c=v(l)&&l.type==="point"&&await SKe(i,r);Zw.active=!0,Zw.disabled=!0;try{await t.zoomTo({target:{target:n,scale:c?o:void 0}})}catch{const f=new W("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:i});c5.error(f)}finally{Zw.active=!1,Zw.disabled=!1,t.zoomToLocation=null,c&&(t.location=l)}}async function CKe(t){const{selectedFeature:e,view:i}=t;if((i==null?void 0:i.type)!=="2d"){const o=new W("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i});throw c5.error(o),o}if(!e||!Mw(e)){const o=new W("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:e});throw c5.error(o),o}const[r,s]=await RK(i,e);qS.active=!0,qS.disabled=!0;const{extent:n}=await r.queryExtent(s);await t.zoomTo({target:n}),qS.active=!1,qS.disabled=!1}async function AKe(t){const{view:e,selectedFeature:i}=t;if(!e||!i)return;const[r,s]=await RK(e,i),{extent:n}=await r.queryExtent(s);t.selectedClusterBoundaryFeature.geometry=n,e.graphics.add(t.selectedClusterBoundaryFeature)}async function OKe(t){var o;const{selectedFeature:e,view:i}=t;if(!i||!e)return;const[r,s]=await RK(i,e);WS.active=!0,WS.disabled=!0;const{features:n}=await r.queryFeatures(s);WS.active=!1,WS.disabled=!1,(o=i.popup)==null||o.open({features:[e].concat(n),featureMenuOpen:!0})}async function RK(t,e){const i=await t.whenLayerView(e.sourceLayer),r=i.createQuery(),s=e.getObjectId();return r.aggregateIds=s!=null?[s]:[],[i,r]}function RKe(t){const e=t.features.filter(i=>Mw(i));e.length&&(t.features=e)}function mTe(t){var e;if(C(t))return null;switch(t.type){case"point":return t;case"extent":return t.center;case"polygon":return t.centroid;case"multipoint":case"polyline":return(e=t.extent)==null?void 0:e.center;default:return null}}const Xt="esri-popup",KA=`${Xt}__header`,L1=`${Xt}--is-docked`,ke={calciteThemeLight:"calcite-mode-light",calciteThemeDark:"calcite-mode-dark",iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow",iconDockToTop:"esri-icon-maximize",iconDockToBottom:"esri-icon-dock-bottom",iconDockToLeft:"esri-icon-dock-left",iconDockToRight:"esri-icon-dock-right",iconClose:"esri-icon-close",iconUndock:"esri-icon-minimize",iconCheckMark:"esri-icon-check-mark",iconLoading:"esri-icon-loading-indicator",iconDefaultAction:"esri-icon-default-action",iconActionsMenu:"esri-icon-handle-horizontal",rotating:"esri-rotating",base:Xt,widget:"esri-widget",main:`${Xt}__main-container`,loadingContainer:`${Xt}__loading-container`,isCollapsible:`${Xt}--is-collapsible`,isCollapsed:`${Xt}--is-collapsed`,shadow:`${Xt}--shadow`,isDocked:L1,isDockedTopLeft:`${L1}-top-left`,isDockedTopCenter:`${L1}-top-center`,isDockedTopRight:`${L1}-top-right`,isDockedBottomLeft:`${L1}-bottom-left`,isDockedBottomCenter:`${L1}-bottom-center`,isDockedBottomRight:`${L1}-bottom-right`,alignTopCenter:`${Xt}--aligned-top-center`,alignBottomCenter:`${Xt}--aligned-bottom-center`,alignTopLeft:`${Xt}--aligned-top-left`,alignBottomLeft:`${Xt}--aligned-bottom-left`,alignTopRight:`${Xt}--aligned-top-right`,alignBottomRight:`${Xt}--aligned-bottom-right`,isFeatureMenuOpen:`${Xt}--feature-menu-open`,isActionsMenuOpen:`${Xt}--actions-menu-open`,hasFeatureUpdated:`${Xt}--feature-updated`,header:KA,headerButtons:`${KA}-buttons`,headerContainer:`${KA}-container`,headerContainerButton:`${KA}-container--button`,headerTitle:`${KA}-title`,content:`${Xt}__content`,contentHasFlows:"esri-content--has-flows",contentFlowItem:"esri-content__flow-item",footer:`${Xt}__footer`,footerHasPagination:`${Xt}__footer--has-pagination`,footerHasActions:`${Xt}__footer--has-actions`,footerHasActionsMenu:`${Xt}__footer--has-actions-menu`,button:`${Xt}__button`,buttonDisabled:`${Xt}__button--disabled`,buttonDock:`${Xt}__button--dock`,icon:`${Xt}__icon`,iconDock:`${Xt}__icon--dock-icon`,inlineActionsContainer:`${Xt}__inline-actions-container`,actionsMenuButton:`${Xt}__actions-menu-button`,actions:`${Xt}__actions`,action:`${Xt}__action`,actionImage:`${Xt}__action-image`,actionText:`${Xt}__action-text`,actionToggle:`${Xt}__action-toggle`,actionToggleOn:`${Xt}__action-toggle--on`,actionExit:`${Xt}__action--exit`,actionSelectFeature:`${Xt}__action--select-feature`,pointer:`${Xt}__pointer`,pointerDirection:`${Xt}__pointer-direction`,navigation:`${Xt}__navigation`,paginationPrevious:`${Xt}__pagination-previous`,paginationNext:`${Xt}__pagination-next`,paginationPreviousIconLTR:`${Xt}__pagination-previous-icon`,paginationPreviousIconRTL:`${Xt}__pagination-previous-icon--rtl`,paginationNextIconLTR:`${Xt}__pagination-next-icon`,paginationNextIconRTL:`${Xt}__pagination-next-icon--rtl`,featureMenu:`${Xt}__feature-menu`,featureMenuList:`${Xt}__feature-menu-list`,featureMenuItem:`${Xt}__feature-menu-item`,featureMenuViewport:`${Xt}__feature-menu-viewport`,featureMenuHeader:`${Xt}__feature-menu-header`,featureMenuNote:`${Xt}__feature-menu-note`,featureMenuSelected:`${Xt}__feature-menu-item--selected`,featureMenuButton:`${Xt}__feature-menu-button`,featureMenuTitle:`${Xt}__feature-menu-title`,featureMenuObserver:`${Xt}__feature-menu-observer`,featureMenuLoader:`${Xt}__feature-menu-loader`,collapseButton:`${Xt}__collapse-button`,collapseIcon:`${Xt}__collapse-icon`};var Vx;(function(t){t[t.size=22]="size",t[t.lineWidth=50]="lineWidth",t[t.maxSize=120]="maxSize",t[t.maxOutlineSize=80]="maxOutlineSize",t[t.tallSymbolWidth=20]="tallSymbolWidth"})(Vx||(Vx={}));function gTe(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function MKe(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function PKe(t,e,i,r,s,n){const o=new Float32Array(6);return o[0]=t,o[1]=e,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function IKe(t,e){return new Float32Array(t,e,6)}function yTe(t,e,i,r){const s=e[r],n=e[r+1];t[r]=i[0]*s+i[2]*n+i[4],t[r+1]=i[1]*s+i[3]*n+i[5]}function $Ke(t,e,i,r=0,s=0,n=2){const o=s||e.length/n;for(let a=r;a<o;a++)yTe(t,e,i,a*n)}Object.freeze(Object.defineProperty({__proto__:null,clone:MKe,create:gTe,createView:IKe,fromValues:PKe,transform:yTe,transformMany:$Ke},Symbol.toStringTag,{value:"Module"}));function LKe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function DKe(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function NKe(t,e,i,r,s,n,o){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=o,t}function MK(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5];let l=i*n-r*s;return l?(l=1/l,t[0]=n*l,t[1]=-r*l,t[2]=-s*l,t[3]=i*l,t[4]=(s*a-n*o)*l,t[5]=(r*o-i*a)*l,t):null}function FKe(t){return t[0]*t[3]-t[1]*t[2]}function _Te(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=i[0],h=i[1],p=i[2],f=i[3],m=i[4],y=i[5];return t[0]=r*c+n*h,t[1]=s*c+o*h,t[2]=r*p+n*f,t[3]=s*p+o*f,t[4]=r*m+n*y+a,t[5]=s*m+o*y+l,t}function JU(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=Math.sin(i),h=Math.cos(i);return t[0]=r*h+n*c,t[1]=s*h+o*c,t[2]=r*-c+n*h,t[3]=s*-c+o*h,t[4]=a,t[5]=l,t}function PK(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=i[0],h=i[1];return t[0]=r*c,t[1]=s*c,t[2]=n*h,t[3]=o*h,t[4]=a,t[5]=l,t}function tP(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=i[0],h=i[1];return t[0]=r,t[1]=s,t[2]=n,t[3]=o,t[4]=r*c+n*h+a,t[5]=s*c+o*h+l,t}function vTe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t[4]=0,t[5]=0,t}function bTe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function IK(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function UKe(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function VKe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)}function kKe(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t}function wTe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}function BKe(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t}function zKe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t}function GKe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function jKe(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=e[0],c=e[1],h=e[2],p=e[3],f=e[4],m=e[5],y=Fa();return Math.abs(i-l)<=y*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-c)<=y*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(s-h)<=y*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(n-p)<=y*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(o-f)<=y*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-m)<=y*Math.max(1,Math.abs(a),Math.abs(m))}const HKe=_Te,qKe=wTe;Object.freeze(Object.defineProperty({__proto__:null,add:kKe,copy:LKe,determinant:FKe,equals:jKe,exactEquals:GKe,frob:VKe,fromRotation:vTe,fromScaling:bTe,fromTranslation:IK,identity:DKe,invert:MK,mul:HKe,multiply:_Te,multiplyScalar:BKe,multiplyScalarAndAdd:zKe,rotate:JU,scale:PK,set:NKe,str:UKe,sub:qKe,subtract:wTe,translate:tP},Symbol.toStringTag,{value:"Module"}));const woe=de("android");de("chrome")||woe&&woe>=4;mj();function v$t(t){return t=t||globalThis.location.hostname,XKe.some(e=>(t==null?void 0:t.match(e))!=null)}function WKe(t,e){return t&&(e=e||globalThis.location.hostname)?e.match(xTe)!=null||e.match(STe)!=null?t.replace("static.arcgis.com","staticdev.arcgis.com"):e.match(TTe)!=null||e.match(ETe)!=null?t.replace("static.arcgis.com","staticqa.arcgis.com"):t:t}const xTe=/^devext.arcgis.com$/,TTe=/^qaext.arcgis.com$/,STe=/^[\w-]*\.mapsdevext.arcgis.com$/,ETe=/^[\w-]*\.mapsqa.arcgis.com$/,XKe=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,xTe,TTe,/^jsapps.esri.com$/,STe,ETe];Vx.size;Vx.maxSize;Vx.maxOutlineSize;Vx.lineWidth;Vx.tallSymbolWidth;function CTe(t){return t&&"opacity"in t?t.opacity*CTe(t.parent):1}async function YKe(t,e){if(!t)return;const i=t.sourceLayer,r=(v(e)&&e.useSourceLayer?i:t.layer)??i,s=CTe(r);if(v(t.symbol)&&(!v(e)||e.ignoreGraphicSymbol!==!0)){const b=t.symbol.type==="web-style"?await ije(t.symbol,{...e,cache:v(e)?e.webStyleCache:null}):t.symbol.clone();return nk(b,null,s),b}const n=(v(e)?e.renderer:null)??(r&&"renderer"in r?r.renderer:null);let o=n&&"getSymbolAsync"in n?await n.getSymbolAsync(t,e):null;if(!o)return;if(o=o.type==="web-style"?await o.fetchSymbol({...e,cache:v(e)?e.webStyleCache:null}):o.clone(),!(n&&"visualVariables"in n&&n.visualVariables&&n.visualVariables.length))return nk(o,null,s),o;if("arcadeRequiredForVisualVariables"in n&&n.arcadeRequiredForVisualVariables&&(C(e)||C(e.arcade))){const b={...e};b.arcade=await Um(),e=b}const a=await ee(()=>Promise.resolve().then(()=>oK),void 0,import.meta.url),l=[],c=[],h=[],p=[];for(const b of n.visualVariables)switch(b.type){case"color":l.push(b);break;case"opacity":c.push(b);break;case"rotation":p.push(b);break;case"size":b.target||h.push(b)}const f=!!l.length&&l[l.length-1],m=f?a.getColor(f,t,e):null,y=!!c.length&&c[c.length-1];let _=y?a.getOpacity(y,t,e):null;if(s!=null&&(_=_!=null?_*s:s),nk(o,m,_),h.length){const b=a.getAllSizes(h,t,e);await eje(o,b)}for(const b of p)tje(o,a.getRotationAngle(b,t,e),b.axis);return o}let Xy=class{constructor(e,i){this._owner=i,this._properties={},this._afterDispatchHandle=null;for(const r in e){const s=e[r],n=new Cme(s,void 0,void 0,2,2);this._properties[r]={pool:n,acquired:[]}}this._afterDispatchHandle=Vme(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const i=this._properties[e];for(const r of i.acquired)aie(r)||i.pool.release(r);i.pool.destroy(),i.pool=null,i.acquired=null}this._properties=null,this._owner=null}get(e){const i=this._owner._get(e),r=this._properties[e];let s=r.pool.acquire();for(r.acquired.push(s);s===i;)r.acquired.push(s),s=r.pool.acquire();return s}_release(){for(const e in this._properties){const i=this._properties[e];let r=0;for(const s of i.acquired)aie(s)?i.acquired[r++]=s:i.pool.release(s);i.acquired.length=r}}};const ZKe=de("mac")?"Meta":"Ctrl",KU={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let t=48;t<58;t++)KU[t]=String.fromCharCode(t);for(let t=1;t<25;t++)KU[111+t]=`F${t}`;for(let t=65;t<91;t++)KU[t]=[String.fromCharCode(t+32),String.fromCharCode(t)];function JKe(t){if(t.key!==void 0)return Tw(t);const e=KU[t.keyCode];return Array.isArray(e)?t.shiftKey?e[1]:e[0]:e}function KKe(t){switch(t){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}let QKe=class{constructor(e,i=[]){this.eventType=e,this.keyModifiers=i}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const i=e.modifiers;for(const r of this.keyModifiers)if(!i.has(r))return!1;return!0}};const xoe=oe.getLogger("esri.views.input.InputHandler");let Kr=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const i=this._incoming[e];for(const r of i)this._incomingEventMatches.push(r.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?xoe.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback(i=>this._handleEvent(i)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,i,r){let s;typeof i=="function"?(r=i,s=[]):s=i||[];const n=typeof e=="string"?new QKe(e,s):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=h=>{const p=this._incoming[h.match.eventType];if(p){const f=p.indexOf(h);p.splice(f,1),o(),this._manager&&this._manager.updateDependencies()}},l=new eQe(n,r,{onPause:a,onRemove:a,onResume:h=>{const p=this._incoming[h.match.eventType];p&&!p.includes(h)&&(p.push(h),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const i=new tQe(e,{onEmit:(r,s,n,o)=>{var a;(a=this._manager)==null||a.emit(r.eventType,s,n,o)},onRemove:r=>{var s;delete this._outgoing[r.eventType],(s=this._manager)==null||s.updateDependencies()}});return this._outgoing[e]=i,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),i}startCapturingPointer(e){var i;(i=this._manager)==null||i.setPointerCapture(e,!0)}stopCapturingPointer(e){var i;(i=this._manager)==null||i.setPointerCapture(e,!1)}refreshHasPendingInputs(){var e;(e=this._manager)==null||e.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):xoe.error("This InputHandler is not registered with an InputManager")}_handleEvent(e){var r;const i=this._incoming[e.type];if(i){for(const s of i)if(s.match.matches(e)&&((r=s.callback)==null||r.call(s,e),e.shouldStopPropagation()))break}}},eQe=class{constructor(e,i,r){this.match=e,this._callback=i,this._handler=r}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},tQe=class{constructor(e,i){this.eventType=e,this._removed=!1,this._handler=i}emit(e,i,r){this._removed||this._handler.onEmit(this,e,i,r)}remove(){this._removed=!0,this._handler.onRemove(this)}},iQe=class extends Kr{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",i=>{this._update(i.data)})}_update(e){const i=e.native.pointerType==="touch"?"touch":"mouse",{x:r,y:s}=e;i===this._value&&this._x===r&&this._y===s||(this._value=i,this._x=r,this._y=s,this._onChange(i,r,s))}},u5=class{constructor(e){this._observable=new gZ,this._value=e}get(){return Ai(this._observable),this._value}set(e){e!==this._value&&(this._value=e,this._observable.notify())}},rQe=class extends Kr{get multiTouchActive(){return this._multiTouchActive.get()}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=new u5(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.set(this._activeTouchPointerIds.size>1)}},hp=class extends $e{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=ZKe,this._latestPointerType="mouse",this._propertiesPool=new Xy({latestPointerLocation:oQe},this),this.latestPointerLocation=null,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const i of e)this.uninstallHandlers(i);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}installHandlers(e,i,r=Pm.INTERNAL){if(this._nameToGroup[e])return void oe.getLogger(this.declaredClass).error("There is already an InputHandler group registered under the name `"+e+"`");if(i.length===0)return void oe.getLogger(this.declaredClass).error("Can't register a group of zero handlers");const s={name:e,handlers:i.map(n=>({handler:n,active:!0,removed:!1,priorityIndex:0,groupPriority:r,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=s;for(let n=s.handlers.length-1;n>=0;n--){const o=s.handlers[n];this._handlers.push(o),o.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,l,c,h,p)=>{this._emitInputEvent(o.priorityIndex+1,a,l,c,p,h)},setPointerCapture:(a,l)=>{this._setPointerCapture(s,o,a,l)},setEventCallback:a=>{o.eventCallback=a},setUninstallCallback:a=>{o.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const i=this._nameToGroup[e];i?(i.handlers.forEach(r=>{var s;r.removed=!0,(s=r.uninstallCallback)==null||s.call(r)}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):oe.getLogger(this.declaredClass).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,i=new Set;this._handlersPriority=[];for(let r=this._handlers.length-1;r>=0;r--){const s=this._handlers[r];s.priorityIndex=r,this._handlersPriority.push(s)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let r=this._handlersPriority.length-1;r>=0;r--){const s=this._handlersPriority[r];s.priorityIndex=r;let n=s.handler.hasSideEffects;if(!n){for(const o of s.handler.outgoingEventTypes)if(e.has(o)){n=!0;break}}if(n)for(const o of s.handler.incomingEventMatches){e.add(o.eventType);for(const a of o.keyModifiers)KKe(a)||i.add(a)}s.active=n}this._sourceEvents=e,this._keyModifiers=i,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,i,r){this._latestPointerType=e;const s=this._get("latestPointerLocation");if(C(s)||s.x!==i||s.y!==r){const n=this._propertiesPool.get("latestPointerLocation");n.x=i,n.y=r,this._set("latestPointerLocation",n)}}_onEventReceived(e,i){if(e==="pointer-capture-lost"){const n=i;this._pointerCaptures.delete(n.native.pointerId)}this._updateKeyModifiers(e,i);const r=this.test.timestamp!=null?this.test.timestamp:i.native?i.native.timestamp:void 0,s=i.native?i.native.cancelable:void 0;this._emitInputEventFromSource(e,i,r,s)}_updateKeyModifiers(e,i){if(!i)return;let r=!1;const s=()=>{if(!r){const a=new Set;this._activeKeyModifiers.forEach(l=>{a.add(l)}),this._activeKeyModifiers=a,r=!0}},n=(a,l)=>{l&&!this._activeKeyModifiers.has(a)?(s(),this._activeKeyModifiers.add(a)):!l&&this._activeKeyModifiers.has(a)&&(s(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=i.key;this._keyModifiers.has(a)&&n(a,e==="key-down")}const o=i.native;n("Alt",!(!o||!o.altKey)),n("Ctrl",!(!o||!o.ctrlKey)),n("Shift",!(!o||!o.shiftKey)),n("Meta",!(!o||!o.metaKey)),n("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new iQe((e,i,r)=>this._setLatestPointer(e,i,r)),this._multiTouchHandler=new rQe,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],Pm.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,Pm.INTERNAL)}_setPointerCapture(e,i,r,s){const n=e.name+"-"+i.priorityIndex,o=this._pointerCaptures.get(r.pointerId)||new Set;this._pointerCaptures.set(r.pointerId,o),s?(o.add(n),o.size===1&&this.eventSource&&this.eventSource.setPointerCapture(r,!0)):o.has(n)&&(o.delete(n),o.size===0&&(this._pointerCaptures.delete(r.pointerId),this.eventSource&&this.eventSource.setPointerCapture(r,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,i,r,s){this._emitInputEvent(0,e,i,r,s)}_emitInputEvent(e,i,r,s,n,o){const a=s!==void 0?s:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),l=n!==void 0&&n,c={event:new sQe(i,r,a,o||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new P4,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){var i,r;const e=Jl(this._currentPropagation);for(;e.events.length>0;){const{event:s,priorityIndex:n}=e.events.pop(),o=s.data&&s.data.eventId;if(!(o!=null&&this._stoppedPropagationEventIds.has(o)))for(e.currentHandler=this._handlersPriority[n];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!s.shouldStopPropagation()&&((r=(i=e.currentHandler).eventCallback)==null||r.call(i,s)),s.shouldStopPropagation()){o!=null&&this._stoppedPropagationEventIds.add(o);break}if(s.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:s,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}_pausePropagation(e){const i=new P4;i.push(e);const r=this._currentPropagation;if(r){for(;r.events.length;)i.push(r.events.pop());r.events=i,r.currentHandler=null}}_compareHandlerPriority(e,i){if(e.handler.hasSideEffects!==i.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==i.groupPriority)return e.groupPriority>i.groupPriority?-1:1;for(const r of e.handler.incomingEventMatches)for(const s of i.handler.incomingEventMatches){if(r.eventType!==s.eventType)continue;const n=r.keyModifiers.filter(o=>s.keyModifiers.includes(o));if(n.length===r.keyModifiers.length!=(n.length===s.keyModifiers.length))return r.keyModifiers.length>s.keyModifiers.length?-1:1}return e.priorityIndex>i.priorityIndex?-1:1}_sortHandlersPriority(e){const i=[];for(const r of e){let s=0;for(;s<i.length&&this._compareHandlerPriority(r,i[s])>=0;)s++;i.splice(s,0,r)}return i}get debug(){const e=i=>{const r=this._setPointerCapture;this._setPointerCapture=()=>{},i(),this._setPointerCapture=r};return{injectEvent:(i,r)=>{e(()=>{this._onEventReceived(i,r)})},disablePointerCapture:e}}};u([d({readOnly:!0})],hp.prototype,"hasPendingInputs",null),u([d({constructOnly:!0})],hp.prototype,"eventSource",void 0),u([d({constructOnly:!0})],hp.prototype,"recognizers",void 0),u([d()],hp.prototype,"_latestPointerType",void 0),u([d()],hp.prototype,"latestPointerType",null),u([d()],hp.prototype,"multiTouchActive",null),u([d({readOnly:!0})],hp.prototype,"latestPointerLocation",void 0),hp=u([I("esri.views.input.InputManager")],hp);let sQe=class{constructor(e,i,r,s,n){this.type=e,this.data=i,this.timestamp=r,this.modifiers=s,this.cancelable=n,this._propagationState=K_.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=K_.STOPPED}shouldStopPropagation(){return(this._propagationState&K_.STOPPED)!=0}async(e){this._propagationState|=K_.PAUSED;const i=(r,s)=>{this._propagationState&=~K_.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw r;return r};return(typeof e=="function"?e():e).then(r=>i(r,!1),r=>i(r,!0))}shouldPausePropagation(e){return!!(this._propagationState&K_.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var K_;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(K_||(K_={}));const Pm={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let nQe=class{};const oQe=nQe;function Toe(t){return t&&typeof t.highlight=="function"}function aQe(t){return t&&typeof t.maskOccludee=="function"}function P$t(t,e,i){return C(t)||t>i&&(e===0||t<e)}function I$t(t,e){return v(t)&&t>0||v(e)&&e>0}function $$t(t){const e=t.effectiveScaleRange;return{minScale:(e==null?void 0:e.minScale)??0,maxScale:(e==null?void 0:e.maxScale)??0}}const ATe=t=>{let e=class extends t{constructor(...i){super(...i),this.goToOverride=null,this.view=null}callGoTo(i){const{view:r}=this;return $6(r),this.goToOverride?this.goToOverride(r,i):r.goTo(i.target,i.options)}};return u([d()],e.prototype,"goToOverride",void 0),u([d()],e.prototype,"view",void 0),e=u([I("esri.widgets.support.GoTo")],e),e},YM=Nt.ofType({key:"type",defaultKeyValue:"button",base:K6,typeMap:{button:ZC,toggle:Dye}}),lQe=()=>[Zw.clone()],cQe=()=>[qS.clone(),WS.clone()];let Hi=class extends ATe(dTe){get isLoadingFeature(){return this.featureViewModels.some(e=>e.waitingForContent)}constructor(e){super(e),this._handles=new Ki,this._pendingPromises=new Set,this._fetchFeaturesController=null,this._highlightSelectedFeaturePromise=null,this._highlightActiveFeaturePromise=null,this._selectedClusterFeature=null,this.featurePage=null,this.actions=new YM,this.activeFeature=null,this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.featuresPerPage=20,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new ha({symbol:new y1({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}initialize(){this._handles.add([re(()=>[this.autoOpenEnabled,this.view],()=>this._autoOpenEnabledChange()),this.on("view-change",()=>this._autoClose()),re(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),re(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),re(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.animation)==null?void 0:i.state},e=>this._animationStateChange(e)),re(()=>this.location,e=>this._locationChange(e)),re(()=>this.selectedFeature,e=>this._selectedFeatureChange(e)),re(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),re(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),re(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",e=>TKe({event:e,view:this.view})),qo(()=>!this.waitingForResult,()=>this._waitingForResultChange(),Wi),re(()=>{var e,i;return[this.features,(e=this.view)==null?void 0:e.map,(i=this.view)==null?void 0:i.spatialReference]},()=>this._updateFeatureVMs()),re(()=>{var e;return(e=this.view)==null?void 0:e.scale},()=>this._viewScaleChange()),qo(()=>!this.visible,()=>this.browseClusterEnabled=!1),re(()=>this.browseClusterEnabled,e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new YM;e.removeAll();const{actions:i,defaultActions:r,defaultPopupTemplateEnabled:s,includeDefaultActions:n,selectedFeature:o}=this,a=n?r.concat(i):i,l=o&&(typeof o.getEffectivePopupTemplate=="function"&&o.getEffectivePopupTemplate(s)||o.popupTemplate),c=l&&l.actions,h=l&&l.overwriteActions?c:c?c.concat(a):a;return h&&h.filter(Boolean).forEach(p=>e.add(p)),e}get defaultActions(){const e=this._get("defaultActions")||new YM;return e.removeAll(),e.addMany(Mw(this.selectedFeature)?cQe():lQe()),e}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(e){const i=e||[];this._set("features",i);const{pendingPromisesCount:r,promiseCount:s,selectedFeatureIndex:n}=this,o=s&&i.length;o&&r&&n===-1?this.selectedFeatureIndex=0:o&&n!==-1||(this.selectedFeatureIndex=i.length?0:-1)}get location(){return this._get("location")||null}set location(e){var s,n,o;let i=e;const r=(n=(s=this.view)==null?void 0:s.spatialReference)==null?void 0:n.isWebMercator;e&&((o=e==null?void 0:e.spatialReference)!=null&&o.isWGS84)&&r&&(i=Ey(e)),this._set("location",i)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||this.featureCount!==0)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach(i=>{this._pendingPromises.add(i);const r=n=>{this._pendingPromises.has(i)&&this._updateFeatures(n),this._updatePendingPromises(i)},s=()=>this._updatePendingPromises(i);i.then(r,s)}),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:e,selectedFeatureIndex:i}=this;return i===-1?null:e[i]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return typeof e=="number"?e:-1}set selectedFeatureIndex(e){const{featureCount:i}=this;e=isNaN(e)||e<-1||!i?-1:(e+i)%i,this.activeFeature=null,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:e}=this,i=fTe(this);return i&&e?this.callGoTo({target:{target:i,scale:e.scale}}):Promise.reject(new W("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:i,view:e}))}zoomTo(e){return this.callGoTo(e)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(e,i){const{view:r}=this;if(!r||!e)throw new W("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:r});return r.fetchPopupFeatures(e,{event:i&&i.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:i&&i.signal})}open(e){const i={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...e,visible:!0},{fetchFeatures:r}=i;delete i.fetchFeatures,r&&this._setFetchFeaturesPromises(i.location);const s=["actionsMenuOpen","collapsed","featureMenuOpen"];for(const n of s)delete i[n];this.set(i)}triggerAction(e){const i=this.allActions.getItemAt(e);i&&!i.disabled&&this.emit("trigger-action",{action:i})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}disableClusterBrowsing(){RKe(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){const{view:e,selectedFeature:i}=this;(e==null?void 0:e.type)==="2d"?Mw(i)?(await AKe(this),await OKe(this)):oe.getLogger(this.declaredClass).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",i):oe.getLogger(this.declaredClass).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",i)}_animationStateChange(e){this.zoomToLocation||(Zw.disabled=e==="waiting-for-target")}_clearBrowsedClusterGraphics(){var i;const e=(i=this.view)==null?void 0:i.graphics;e&&(e.remove(this.selectedClusterBoundaryFeature),this._selectedClusterFeature&&e.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(Mw(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])}_locationChange(e){const{selectedFeature:i,updateLocationEnabled:r}=this;r&&e&&(!i||i.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:i,featurePage:r,featuresPerPage:s,featureViewModels:n}=this;if(r===null)return;const o=((r-1)*s+i)%i,a=o+s;n.slice(o,a).forEach((l,c)=>{l&&!l.graphic&&(l.graphic=e[o+c])})}async _selectedFeatureChange(e){const{location:i,updateLocationEnabled:r,view:s}=this;if(e&&s){if(this.browseClusterEnabled)return this._selectedClusterFeature&&(s.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),Mw(e)?void 0:(e.symbol=await YKe(e),this._selectedClusterFeature=e,void s.graphics.add(this._selectedClusterFeature));!r&&i||!e.geometry?r&&!e.geometry&&this.centerAtLocation().then(()=>{var o;const n=(o=s.center)==null?void 0:o.clone();n&&(this.location=n)}):this.location=mTe(e.geometry)}}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then(i=>{const{clientOnlyGraphics:r,promisesPerLayerView:s}=i,n=Promise.resolve(r),o=s.map(a=>a.promise);this.promises=[n,...o]})}_destroyFeatureVMs(){this.featureViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:i,featureViewModels:r}=this;if(Mw(e)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!i||!i.length)return;const s=r.slice(0),n=[];i.forEach((o,a)=>{var c,h;if(!o)return;let l=null;if(s.some((p,f)=>(p&&p.graphic===o&&(l=p,s.splice(f,1)),!!l)),l)n[a]=l;else{const p=new OK({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:(c=this.view)==null?void 0:c.spatialReference,graphic:o===e?o:null,map:(h=this.view)==null?void 0:h.map,view:this.view});n[a]=p}}),s.forEach(o=>o&&!o.destroyed&&o.destroy()),this._set("featureViewModels",n)}_getScreenPoint(e){const{view:i}=this;return i&&e&&typeof i.toScreen=="function"?i.toScreen(e):null}_autoOpenEnabledChange(){const e="auto-fetch-features",{_handles:i,autoOpenEnabled:r}=this;if(i.remove(e),r&&this.view){const s=this.view.on("click",n=>{n.pointerType==="mouse"&&n.button!==0||this._fetchFeaturesAndOpen(n)},Pm.WIDGET);i.add(s,e)}}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(e,i){this._cancelFetchingFeatures();const r=new AbortController,{signal:s}=r;this._fetchFeaturesController=r,this.notifyChange("waitingForResult");const n=this.fetchFeatures(e,{signal:s,event:i});return n.catch(()=>{}).then(()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}),n}_fetchFeaturesAndOpen(e){const{screenPoint:i,mapPoint:r}=e,{view:s}=this;this._fetchFeaturesWithController(i,e).then(n=>{var h;const{clientOnlyGraphics:o,promisesPerLayerView:a,location:l}=n,c=[Promise.resolve(o),...a.map(p=>p.promise)];return(h=s==null?void 0:s.popup)==null||h.open({location:l||r,promises:c}),n})}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}async _getLayerView(e,i){return await e.when(),e.whenLayerView(i)}_getHighlightLayer(e){const{layer:i,sourceLayer:r}=e;return r&&"layer"in r&&r.layer?r.layer:(r==null?void 0:r.type)==="map-notes"||(r==null?void 0:r.type)==="subtype-group"?r:i}_getHighlightTarget(e,i){const r=i.type==="imagery"?void 0:"objectIdField"in i?i.objectIdField||Uve:null,s=e.attributes;return s&&r&&s[r]||e}async _highlightActiveFeature(){const e="highlight-active-feature";this._handles.remove(e);const{highlightEnabled:i,view:r,activeFeature:s,visible:n}=this;if(!(s&&r&&i&&n))return;const o=this._getHighlightLayer(s);if(!(o&&o instanceof i5))return;const a=this._getLayerView(r,o);this._highlightActiveFeaturePromise=a;const l=await a;if(!(l&&Toe(l)&&this._highlightActiveFeaturePromise===a&&this.activeFeature&&this.highlightEnabled))return;const c=l.highlight(this._getHighlightTarget(s,o));this._handles.add(c,e)}async _highlightSelectedFeature(){const e="highlight-selected-feature";this._handles.remove(e);const{selectedFeature:i,highlightEnabled:r,view:s,visible:n}=this;if(!(i&&s&&r&&n))return;const o=this._getHighlightLayer(i);if(!(o&&o instanceof i5))return;const a=this._getLayerView(s,o);this._highlightSelectedFeaturePromise=a;const l=await a;if(!(l&&Toe(l)&&this._highlightSelectedFeaturePromise===a&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const c=l.highlight(this._getHighlightTarget(i,o));this._handles.add(c,e)}_updateFeatures(e){const{features:i}=this;if(!e||!e.length)return;if(!i.length)return void(this.features=e);const r=e.filter(s=>!i.includes(s));this.features=i.concat(r)}};u([d()],Hi.prototype,"featurePage",void 0),u([d()],Hi.prototype,"isLoadingFeature",null),u([d({type:YM})],Hi.prototype,"actions",void 0),u([d({readOnly:!0})],Hi.prototype,"active",null),u([d()],Hi.prototype,"activeFeature",void 0),u([d({readOnly:!0})],Hi.prototype,"allActions",null),u([d({type:Boolean})],Hi.prototype,"defaultPopupTemplateEnabled",void 0),u([d()],Hi.prototype,"autoCloseEnabled",void 0),u([d()],Hi.prototype,"autoOpenEnabled",void 0),u([d()],Hi.prototype,"browseClusterEnabled",void 0),u([d()],Hi.prototype,"content",void 0),u([d({type:YM,readOnly:!0})],Hi.prototype,"defaultActions",null),u([d({readOnly:!0})],Hi.prototype,"featureCount",null),u([d()],Hi.prototype,"features",null),u([d()],Hi.prototype,"featuresPerPage",void 0),u([d()],Hi.prototype,"featureViewModelAbilities",void 0),u([d({readOnly:!0})],Hi.prototype,"featureViewModels",void 0),u([d()],Hi.prototype,"highlightEnabled",void 0),u([d()],Hi.prototype,"includeDefaultActions",void 0),u([d({type:pt})],Hi.prototype,"location",null),u([d({readOnly:!0})],Hi.prototype,"pendingPromisesCount",null),u([d({readOnly:!0})],Hi.prototype,"selectedClusterBoundaryFeature",void 0),u([d({readOnly:!0})],Hi.prototype,"waitingForResult",null),u([d({readOnly:!0})],Hi.prototype,"promiseCount",null),u([d()],Hi.prototype,"promises",null),u([d({value:null,readOnly:!0})],Hi.prototype,"selectedFeature",null),u([d({value:-1})],Hi.prototype,"selectedFeatureIndex",null),u([d({readOnly:!0})],Hi.prototype,"selectedFeatureViewModel",null),u([d({readOnly:!0})],Hi.prototype,"state",null),u([d()],Hi.prototype,"title",void 0),u([d()],Hi.prototype,"updateLocationEnabled",void 0),u([d()],Hi.prototype,"view",void 0),u([d()],Hi.prototype,"visible",void 0),u([d()],Hi.prototype,"zoomFactor",void 0),u([d()],Hi.prototype,"zoomToLocation",void 0),u([d()],Hi.prototype,"centerAtLocation",null),Hi=u([I("esri.widgets.Popup.PopupViewModel")],Hi);const OTe=Hi,Soe="selected-index",uQe=0,Eoe="popup-spinner",Coe={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},Aoe="esri-popup";function gg(t,e){return e===void 0?`${Aoe}__${t}`:`${Aoe}__${t}-${e}`}const Ooe={closeButton:!0,featureNavigation:!0};let Wt=class extends uTe(bl){constructor(e,i){super(e,i),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new Ki,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverNode=null,this._featureMenuViewportNode=null,this._rootFlowItemNode=null,this._featureMenuIntersectionObserverCallback=([r])=>{r!=null&&r.isIntersecting&&this.viewModel.featurePage!=null&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._displaySpinnerThrottled=vE(()=>this._displaySpinner(),uQe),this._exitRelatedRecordsActions=new WeakMap,this._featureSelectionActions=new WeakMap,this._flowItems=new Nt,this.alignment="auto",this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureMenuOpen=!1,this.headingLevel=2,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.spinnerEnabled=!0,this.viewModel=new OTe,this.visibleElements={...Ooe},this._handleOpenRelatedFeature=r=>{this._openRelatedFeature(r)},this._addSelectedFeatureIndexHandle(),this.addHandles([re(()=>{var r;return(r=this.viewModel)==null?void 0:r.screenLocation},()=>this._positionContainer()),re(()=>{var r;return[(r=this.viewModel)==null?void 0:r.active,this.dockEnabled]},()=>this._toggleScreenLocationEnabled()),re(()=>{var r;return(r=this.viewModel)==null?void 0:r.screenLocation},(r,s)=>{!!r!=!!s&&this.reposition()}),re(()=>{var r,s,n,o,a,l;return[(s=(r=this.viewModel)==null?void 0:r.view)==null?void 0:s.padding,(o=(n=this.viewModel)==null?void 0:n.view)==null?void 0:o.size,(a=this.viewModel)==null?void 0:a.active,(l=this.viewModel)==null?void 0:l.location,this.alignment]},()=>this.reposition()),re(()=>this.spinnerEnabled,r=>this._spinnerEnabledChange(r)),re(()=>{var r,s;return(s=(r=this.viewModel)==null?void 0:r.view)==null?void 0:s.size},(r,s)=>this._updateDockEnabledForViewSize(r,s)),re(()=>{var r;return(r=this.viewModel)==null?void 0:r.view},(r,s)=>this._viewChange(r,s)),re(()=>{var r,s;return(s=(r=this.viewModel)==null?void 0:r.view)==null?void 0:s.ready},(r,s)=>this._viewReadyChange(r??!1,s??!1)),re(()=>{var r,s;return[(r=this.viewModel)==null?void 0:r.waitingForResult,(s=this.viewModel)==null?void 0:s.location]},()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),re(()=>this.selectedFeatureWidget,()=>this._destroyFlowItemWidgets()),re(()=>{var r,s,n,o;return[(s=(r=this.selectedFeatureWidget)==null?void 0:r.viewModel)==null?void 0:s.title,(o=(n=this.selectedFeatureWidget)==null?void 0:n.viewModel)==null?void 0:o.state]},()=>this._setTitleFromFeatureWidget()),re(()=>{var r,s,n,o;return[(s=(r=this.selectedFeatureWidget)==null?void 0:r.viewModel)==null?void 0:s.content,(o=(n=this.selectedFeatureWidget)==null?void 0:n.viewModel)==null?void 0:o.state]},()=>this._setContentFromFeatureWidget()),qo(()=>!this.collapsed,()=>{var r,s;((s=(r=this.viewModel)==null?void 0:r.view)==null?void 0:s.widthBreakpoint)==="xsmall"&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()}),pn(()=>{var r;return(r=this.viewModel)==null?void 0:r.allActions},"change",()=>this._watchActions()),re(()=>{var r;return(r=this.viewModel)==null?void 0:r.allActions},()=>this._watchActions(),Zt),re(()=>{var r;return(r=this.viewModel)==null?void 0:r.featureViewModels},()=>this._featureMenuViewportScrollTop()),pn(()=>this._flowItems,"change",()=>{this.notifyChange("_activeFlowItemWidget"),this.scheduleRender()}),re(()=>{var r,s,n,o;return[(s=(r=this._activeFlowItemWidget)==null?void 0:r.viewModel)==null?void 0:s.state,(o=(n=this._activeFlowItemWidget)==null?void 0:n.viewModel)==null?void 0:o.title]},()=>this.scheduleRender())])}loadDependencies(){return Promise.all([ee(()=>import("./calcite-flow-29a09a2f.js"),["./calcite-flow-29a09a2f.js","./observers-4f67f1fb.js"],import.meta.url),ee(()=>import("./calcite-flow-item-d41c5cf7.js"),["./calcite-flow-item-d41c5cf7.js","./interactive-573cbe88.js","./loadable-25ad9e4e.js","./t9n-25a567dc.js","./observers-4f67f1fb.js","./guid-9426053f.js","./action-96cccefb.js","./icon-f7d88fe1.js","./loader-5f4c008e.js","./tooltip-da45ef35.js","./debounce-31e0cfcc.js","./scrim-333a6848.js"],import.meta.url),ee(()=>import("./calcite-action-44fd7e32.js"),["./calcite-action-44fd7e32.js","./action-96cccefb.js","./guid-9426053f.js","./interactive-573cbe88.js","./loadable-25ad9e4e.js","./t9n-25a567dc.js","./observers-4f67f1fb.js","./icon-f7d88fe1.js","./loader-5f4c008e.js"],import.meta.url),ee(()=>import("./calcite-tooltip-53a7df1b.js"),["./calcite-tooltip-53a7df1b.js","./tooltip-da45ef35.js","./debounce-31e0cfcc.js","./guid-9426053f.js"],import.meta.url),ee(()=>import("./calcite-icon-1a5b9b53.js"),["./calcite-icon-1a5b9b53.js","./icon-f7d88fe1.js","./observers-4f67f1fb.js"],import.meta.url)])}destroy(){var e,i;this._destroyFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),(e=this._handles)==null||e.destroy(),this._unobserveFeatureMenuObserver(),(i=this._featureMenuIntersectionObserver)==null||i.disconnect()}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){const{selectedFeatureWidget:e,viewModel:i}=this;if(!e)return!!(i!=null&&i.content);const r=e.viewModel;if(r!=null&&r.waitingForContent||(r==null?void 0:r.state)==="error")return!0;const s=r==null?void 0:r.content;return Array.isArray(s)?!!s.length:!!s}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation!=null}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}get _activeFlowItemWidget(){const{_flowItems:e}=this;return e.getItemAt(e.length-1)||null}get actions(){return this.viewModel.actions}set actions(e){this.viewModel.actions=e}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(e){this.viewModel.autoCloseEnabled=e}get autoOpenEnabled(){return this.viewModel.autoOpenEnabled}set autoOpenEnabled(e){this.viewModel.autoOpenEnabled=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||Coe}set dockOptions(e){var l,c;const i={...Coe},r=(c=(l=this.viewModel)==null?void 0:l.view)==null?void 0:c.breakpoints,s={};r&&(s.width=r.xsmall,s.height=r.xsmall);const n={...i,...e},o={...i.breakpoint,...s},{breakpoint:a}=n;typeof a=="object"?n.breakpoint={...o,...a}:a&&(n.breakpoint=o),this._set("dockOptions",n),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(e){this.viewModel.highlightEnabled=e}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(e){this.viewModel.selectedFeatureIndex=e}get selectedFeatureWidget(){const{_feature:e,visibleElements:i,headingLevel:r,_flowItems:s}=this,{selectedFeatureViewModel:n}=this.viewModel,o={...i,title:!1};return n?(e?(e.viewModel=n,e.visibleElements=o):this._feature=new vKe({flowItems:s,headingLevel:r+1,viewModel:n,visibleElements:o}),this._feature):null}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(e){this.viewModel.updateLocationEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}castVisibleElements(e){return{...Ooe,...e}}blur(){const{active:e}=this.viewModel;e||oe.getLogger(this.declaredClass).warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,i){return this.viewModel.fetchFeatures(e,i)}focus(){const{active:e}=this.viewModel;e||oe.getLogger(this.declaredClass).warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){var n,o;this._handles.remove(Soe);const i=!!e&&!!e.featureMenuOpen,r=!!e&&!!e.actionsMenuOpen,s={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:r,featureMenuOpen:i};((o=(n=this.viewModel)==null?void 0:n.view)==null?void 0:o.widthBreakpoint)==="xsmall"&&(s.collapsed=!0),this.set(s),this.viewModel.open(e),this._shouldFocus(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){return this.viewModel.triggerAction(e)}render(){var _,b,w,S;const{actionsMenuOpen:e,dockEnabled:i,featureMenuVisible:r,dividedActions:s,currentAlignment:n,currentDockPosition:o}=this,{active:a}=this.viewModel,{menuActions:l}=s,c=a&&l.length>1&&e,h=a&&i,p=a&&!i,f=(b=(_=this.selectedFeature)==null?void 0:_.layer)==null?void 0:b.title,m=(S=(w=this.selectedFeature)==null?void 0:w.layer)==null?void 0:S.id,y={[ke.alignTopCenter]:n==="top-center",[ke.alignBottomCenter]:n==="bottom-center",[ke.alignTopLeft]:n==="top-left",[ke.alignBottomLeft]:n==="bottom-left",[ke.alignTopRight]:n==="top-right",[ke.alignBottomRight]:n==="bottom-right",[ke.isDocked]:h,[ke.shadow]:p,[ke.isDockedTopLeft]:o==="top-left",[ke.isDockedTopCenter]:o==="top-center",[ke.isDockedTopRight]:o==="top-right",[ke.isDockedBottomLeft]:o==="bottom-left",[ke.isDockedBottomCenter]:o==="bottom-center",[ke.isDockedBottomRight]:o==="bottom-right",[ke.isFeatureMenuOpen]:r,[ke.isActionsMenuOpen]:c};return le("div",{class:this.classes(ke.base,y),role:"presentation","data-layer-title":f,"data-layer-id":m,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},a?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return le("span",{"aria-hidden":"true",class:this.classes(ke.icon,ke.iconLoading,ke.rotating)})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?le("div",{key:gg("loading-container"),role:"presentation",class:ke.loadingContainer,"aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const e=bm(this.container),i={[ke.iconRightTriangleArrow]:e,[ke.paginationPreviousIconRTL]:e,[ke.iconLeftTriangleArrow]:!e,[ke.paginationPreviousIconLTR]:!e};return le("span",{"aria-hidden":"true",class:this.classes(ke.icon,i)})}renderPreviousButton(){const{messages:e}=this;return le("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(ke.button,ke.paginationPrevious),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}renderNextIcon(){const e=bm(this.container),i={[ke.iconLeftTriangleArrow]:e,[ke.paginationNextIconRTL]:e,[ke.iconRightTriangleArrow]:!e,[ke.paginationNextIconLTR]:!e};return le("span",{"aria-hidden":"true",class:this.classes(ke.icon,i)})}renderNextButton(){const{messages:e}=this;return le("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(ke.button,ke.paginationNext),"aria-label":e.next,title:e.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:i,messagesCommon:r}=this,{featureCount:s,selectedFeatureIndex:n}=this.viewModel;return le("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(ke.button,ke.featureMenuButton),"aria-haspopup":"true","aria-controls":i,"aria-expanded":e.toString(),"aria-label":r.menu,title:r.menu},this._getPageText(s,n))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:[]}renderDockIcon(){const{dockEnabled:e}=this,i=this._wouldDockTo(),r={[ke.iconUndock]:e,[ke.iconDock]:!e,[ke.iconDockToRight]:!e&&(i==="top-right"||i==="bottom-right"),[ke.iconDockToLeft]:!e&&(i==="top-left"||i==="bottom-left"),[ke.iconDockToTop]:!e&&i==="top-center",[ke.iconDockToBottom]:!e&&i==="bottom-center"};return le("span",{"aria-hidden":"true",class:this.classes(r,ke.icon)})}renderDockButton(){var n,o,a;const{dockEnabled:e,messages:i}=this,r=(o=(n=this.viewModel)==null?void 0:n.view)==null?void 0:o.widthBreakpoint,s=e?i.undock:i.dock;return r!=="xsmall"&&((a=this.dockOptions)!=null&&a.buttonEnabled)?le("div",{role:"button","aria-label":s,title:s,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(ke.button,ke.buttonDock)},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:i,collapsible:r,contentCollapsed:s,messagesCommon:n}=this,o={[ke.headerContainerButton]:r},a=le(FJ,{level:this.headingLevel,class:ke.headerTitle,innerHTML:e??""}),l=r?le("button",{key:`${e}--collapsible`,id:i,title:s?n.expand:n.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(ke.headerContainer,o),"aria-expanded":s?"false":"true",onclick:this._toggleCollapsed,type:"button"},a,le("calcite-icon",{class:ke.collapseIcon,key:"collapse-icon",icon:s?"chevron-down":"chevron-up",scale:"m"})):le("div",{key:e??"title",id:i,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(ke.headerContainer,o)},a);return e?l:null}renderCloseIcon(){return le("span",{"aria-hidden":"true",class:this.classes(ke.icon,ke.iconClose)})}renderCloseButton(){const{visibleElements:e,messagesCommon:i}=this;return e.closeButton?le("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:ke.button,"aria-label":i.close,title:i.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return le("header",{class:ke.header},this.renderTitle(),le("div",{class:ke.headerButtons},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:i,contentCollapsed:r,_flowItems:s}=this,{content:n}=this.viewModel,o=s.toArray(),a={[ke.contentHasFlows]:!!o.length};return i&&!r?le("div",{key:n??"content",enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:this.classes(ke.content,a)},le("calcite-flow",{bind:this},le("calcite-flow-item",{bind:this,"data-node-ref":"_rootFlowItemNode",afterCreate:B4,key:"root-flow-item",onCalciteFlowItemBack:this._handleBackClick},this.renderContent()),o.map(l=>this.renderFlowItem(l))),o.map(l=>this.renderFlowItemTooltips(l))):null}renderFlowItem(e){const{messages:i}=this,r=Q4(),s="graphic"in e&&!e.isTable;return le("calcite-flow-item",{bind:this,class:this.classes({[ke.calciteThemeDark]:!r,[ke.calciteThemeLight]:r}),heading:e.title??"",description:this._getFlowItemDescription(e),onCalciteFlowItemBack:this._handleBackClick,key:`flow-item-${e.viewModel.uid}`},le("calcite-action",{class:ke.actionExit,icon:"move-up",label:i==null?void 0:i.exitRelatedRecords,text:i==null?void 0:i.exitRelatedRecords,slot:"header-actions-start",bind:this,afterCreate:n=>this._storeExitRelatedRecordsAction(e,n),onclick:this._destroyFlowItemWidgets}),s?le("calcite-action",{class:ke.actionSelectFeature,icon:"zoom-to-object",label:i==null?void 0:i.selectFeature,text:i==null?void 0:i.selectFeature,slot:"header-actions-end",bind:this,afterCreate:n=>this._storeFeatureSelectionAction(e,n),onclick:()=>this._handleOpenRelatedFeature(e)}):null,le("div",{class:this.classes(ke.contentFlowItem,{[ke.calciteThemeDark]:r,[ke.calciteThemeLight]:!r})},e.render()))}renderFlowItemTooltips(e){const{messages:i,_exitRelatedRecordsActions:r,_featureSelectionActions:s}=this,n=Q4(),o=s.get(e);return[le("calcite-tooltip",{class:this.classes({[ke.calciteThemeDark]:!n,[ke.calciteThemeLight]:n}),key:`exit-related-records-tooltip-${e.viewModel.uid}`,label:i==null?void 0:i.exitRelatedRecords,overlayPositioning:"fixed",referenceElement:r.get(e),placement:"top"},i==null?void 0:i.exitRelatedRecords),o?le("calcite-tooltip",{class:this.classes({[ke.calciteThemeDark]:!n,[ke.calciteThemeLight]:n}),key:`select-related-record-tooltip-${e.viewModel.uid}`,label:i==null?void 0:i.selectFeature,overlayPositioning:"fixed",referenceElement:o,placement:"top"},i==null?void 0:i.selectFeature):null]}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:i,actionsMenuOpen:r,dividedActions:s,messagesCommon:n}=this,o=r?n.close:n.open,{menuActions:a}=s;return a.length?le("div",{key:gg("actions-menu-button"),class:this.classes(ke.button,ke.actionsMenuButton),role:"button",id:i,"aria-haspopup":"true","aria-controls":r?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":o,title:o},le("span",{"aria-hidden":"true",class:ke.iconActionsMenu})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:i,actionsMenuOpen:r,dividedActions:s}=this,{menuActions:n}=s;return n.length&&r?le("ul",{id:e,role:"menu","aria-labelledby":i,key:gg("actions"),class:ke.actions,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},n.toArray().map(o=>this.renderAction({action:o,type:"menu-item"}))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return e.length?e.toArray().map(i=>this.renderAction({action:i,type:"inline"})):[]}renderInlineActionsContainer(){const{inlineActions:e,menuActions:i}=this.dividedActions,r=!!e.length,s=!!i.length;return r||s?le("div",{key:"inline-actions-container","data-inline-actions":r.toString(),"data-menu-actions":s.toString(),class:ke.inlineActionsContainer},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?le("section",{key:gg("navigation"),class:this.classes(ke.navigation)},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:i}=this,{inlineActions:r,menuActions:s}=i,n=!!r.length,o=!!s.length,a={[ke.footerHasPagination]:e,[ke.footerHasActions]:n,[ke.footerHasActionsMenu]:o};return e||n?le("div",{key:gg("feature-buttons"),class:this.classes(ke.footer,a)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:i,isLoadingFeature:r}=this.viewModel,s=rm(e.selectedFeatures,{total:i.length});return le("section",{key:gg("menu"),class:ke.featureMenu},le("strong",{class:ke.featureMenuHeader},s),le("nav",{bind:this,class:ke.featureMenuViewport,"data-node-ref":"_featureMenuViewportNode",afterCreate:B4},this.renderFeatureMenu(),le("div",{class:ke.featureMenuObserver,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),r?le("div",{class:ke.featureMenuLoader},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:le("div",{key:gg("pointer"),class:ke.pointer,role:"presentation"},le("div",{class:this.classes(ke.pointerDirection,ke.shadow)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:i,currentDockPosition:r,titleId:s,contentId:n,collapsible:o,hasContent:a,contentCollapsed:l,visibleElements:c}=this,{title:h}=this.viewModel,p=i==="bottom-left"||i==="bottom-center"||i==="bottom-right"||r==="top-left"||r==="top-center"||r==="top-right",f=i==="top-left"||i==="top-center"||i==="top-right"||r==="bottom-left"||r==="bottom-center"||r==="bottom-right",m={[ke.shadow]:e,[ke.isCollapsible]:o,[ke.isCollapsed]:l};return le("div",{class:this.classes(ke.main,ke.widget,m),tabIndex:c.closeButton?void 0:-1,role:"dialog","aria-labelledby":h?s:"","aria-describedby":a&&!l?n:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},p?this.renderFooter():null,p?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),f?this.renderFooter():null,f?this.renderFeatureMenuContainer():null)}renderContent(){var i;const e=(i=this.viewModel)==null?void 0:i.content;return e?typeof e=="string"?le("div",{class:nn.contentNode,key:e,innerHTML:e}):this.renderNodeContent(e):null}renderActionText(e){return le("span",{key:"text",class:ke.actionText},e)}renderActionIcon(e){const i=this._getActionClass(e),r=this._getActionImage(e),s={[ke.iconLoading]:e.active,[ke.rotating]:e.active,[ke.icon]:!!i,[ke.actionImage]:!e.active&&!!r};return i&&(s[i]=!e.active),le("span",{key:"icon","aria-hidden":"true",class:this.classes(ke.icon,s),styles:this._getIconStyles(r)})}renderAction(e){const{action:i,type:r}=e,s=this._getActionTitle(i),n={[ke.action]:i.type!=="toggle",[ke.actionToggle]:i.type==="toggle",[ke.actionToggleOn]:i.type==="toggle"&&i.value,[ke.buttonDisabled]:i.disabled},o=[this.renderActionIcon(i),this.renderActionText(s)],a=r==="menu-item"?le("li",{key:i.uid,role:"menuitem",tabIndex:0,title:s,"aria-label":s,class:this.classes(ke.button,n),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":i.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},o):le("div",{key:i.uid,role:"button",tabIndex:0,title:s,"aria-label":s,class:this.classes(ke.button,n),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":i.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},o);return i.visible?a:null}renderFeatureMenuItem(e,i){const{messages:r,messagesCommon:s}=this,{selectedFeatureIndex:n,selectedFeatureViewModel:o}=this.viewModel,a=e===o,l={[ke.featureMenuSelected]:a},c=a?le("span",{key:gg(`feature-menu-selected-feature-${n}`),title:r.selectedFeature,"aria-label":r.selectedFeature,class:ke.iconCheckMark}):null,h=le("span",{innerHTML:e.title||s.untitled});return le("li",{role:"menuitem",tabIndex:-1,key:gg(`feature-menu-feature-${n}`),class:this.classes(l,ke.featureMenuItem),bind:this,"data-feature-index":i,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature,onmouseover:this._setActiveFeature,onmouseleave:this._removeActiveFeature},le("span",{class:ke.featureMenuTitle},h,c))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:i}=this.viewModel;return i.length>1?le("ol",{class:ke.featureMenuList,id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},i.filter(r=>!!r.graphic).map((r,s)=>this.renderFeatureMenuItem(r,s))):null}_storeFeatureSelectionAction(e,i){this._featureSelectionActions.set(e,i),this.scheduleRender()}_storeExitRelatedRecordsAction(e,i){this._exitRelatedRecordsActions.set(e,i),this.scheduleRender()}_getFlowItemDescription(e){return"featureCountDescription"in e?e.featureCountDescription:e.viewModel.description??""}async _openRelatedFeature(e){await e.viewModel.updateGeometry();const i=e.graphic,r=i==null?void 0:i.geometry;if(C(r)||C(i))return;this._destroyFlowItemWidgets(),await this.viewModel.zoomTo({target:r});const s=mTe(r);this.open({features:[i],location:v(s)?s:void 0})}_destroyFlowItemWidgets(){this._flowItems.removeAll().forEach(e=>{"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e.viewModel=null,e.destroy()})}_handleBackClick(){const e=this._flowItems.pop();e&&(this._exitRelatedRecordsActions.delete(e),this._featureSelectionActions.delete(e),"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e&&(e.viewModel=null,e.destroy()))}_getActionTitle(e){const{messages:i,selectedFeature:r,messagesCommon:s}=this,{id:n}=e,o=r==null?void 0:r.attributes,a=e.title??"",l=n==="zoom-to-feature"?rm(a,{messages:i}):n==="remove-selected-feature"?rm(a,{messages:s}):n==="zoom-to-clustered-features"||n==="browse-clustered-features"?rm(a,{messages:i}):e.title;return l&&o?rm(l,o):l??""}_getActionClass(e){const{selectedFeature:i}=this,r=i==null?void 0:i.attributes,{className:s,image:n}=e,o=n||s?s:ke.iconDefaultAction;return o&&r?rm(o,r):o??""}_getActionImage(e){const{selectedFeature:i}=this,r=i==null?void 0:i.attributes,{image:s}=e;return s&&r?rm(s,r):s??""}_createFeatureUpdatedAnimation(){return iBe("enter",ke.hasFeatureUpdated)}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:i}=this;if(typeof e!="number")return null;const r=Math.round(e);return Math.max(i?r-1:r,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const i="actions";this._handles.remove(i),e&&e.forEach(r=>{this._handles.add(re(()=>[r.uid,r.active,r.className,r.disabled,r.id,r.title,r.image,r.visible],()=>this.scheduleRender()),i)})}_divideActions(){const{allActions:e}=this.viewModel,i=e.filter(o=>o.visible),r=this._getInlineActionCount(),s=r===null,n=r===0;return{inlineActions:s?i.slice(0):n?new Nt:i.slice(0,r),menuActions:s?new Nt:n?i.slice(0):i.slice(r)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(){var r,s;const{selectedFeatureWidget:e,messagesCommon:i}=this;e&&(this.viewModel.title=((r=e.viewModel)==null?void 0:r.state)==="error"?i.errorMessage:((s=e.viewModel)==null?void 0:s.title)||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_handleFeatureMenuKeyup(e){Tw(e)==="Escape"&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){Tw(e)==="Escape"&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_setActiveFeature(e){const{viewModel:i}=this,r=e.currentTarget["data-feature-index"];i.activeFeature=i.features[r]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_handleFeatureMenuItemKeyup(e){const i=Tw(e),{_featureMenuNode:r}=this,s=e.currentTarget["data-feature-index"];if(!r)return;const n=r.querySelectorAll("li"),o=n.length;i!=="ArrowUp"?i!=="ArrowDown"?i!=="Home"?i!=="End"||(e.stopPropagation(),n[n.length-1].focus()):(e.stopPropagation(),n[0].focus()):(e.stopPropagation(),n[(s+1+o)%o].focus()):(e.stopPropagation(),n[(s-1+o)%o].focus())}_handleActionMenuItemKeyup(e){const i=Tw(e),{_actionsMenuNode:r}=this,s=e.currentTarget.dataset.actionUid,{menuActions:n}=this.dividedActions,o=n.findIndex(c=>c.uid===s);if(!r)return;const a=r.querySelectorAll("li"),l=a.length;i!=="ArrowUp"?i!=="ArrowDown"?i!=="Home"?i!=="End"||(e.stopPropagation(),a[a.length-1].focus()):(e.stopPropagation(),a[0].focus()):(e.stopPropagation(),a[(o+1+l)%l].focus()):(e.stopPropagation(),a[(o-1+l)%l].focus())}_handleMainKeyup(e){const i=Tw(e);i==="ArrowLeft"&&(e.stopPropagation(),this.previous()),i==="ArrowRight"&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const i=this.get("viewModel.view");this._createSpinner(i)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:i,waitingForResult:r}=this.viewModel;r&&i?e.show({location:i}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}async _shouldFocus(e){e!=null&&e.shouldFocus&&(await aC(()=>{var i;return((i=this.viewModel)==null?void 0:i.active)===!0}),this.focus())}_addSelectedFeatureIndexHandle(){const e=re(()=>{var i;return(i=this.viewModel)==null?void 0:i.selectedFeatureIndex},(i,r)=>this._selectedFeatureIndexUpdated(i,r));this._handles.add(e,Soe)}_selectedFeatureIndexUpdated(e,i){const{featureCount:r}=this;r&&e!==i&&e!==-1&&(this._destroyFlowItemWidgets(),this.actionsMenuOpen=!1,this.featureMenuOpen=!1,this._mainContainerNode&&(this._mainContainerNode.scrollTop=0),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,i){return e.x>-1&&e.y>-1&&e.x<=i.width&&e.y<=i.height}_isOutsideView(e){const{popupHeight:i,popupWidth:r,screenLocation:s,side:n,view:o}=e;if(isNaN(r)||isNaN(i)||!o||!s)return!1;const a=o.padding;return n==="right"&&s.x+r/2>o.width-a.right||n==="left"&&s.x-r/2<a.left||n==="top"&&s.y-i<a.top||n==="bottom"&&s.y+i>o.height-a.bottom}_calculateAutoAlignment(e){if(e!=="auto")return e;const{_pointerOffsetInPx:i,_containerNode:r,_mainContainerNode:s,viewModel:n}=this,{screenLocation:o,view:a}=n;if(C(o)||!a||!r)return"top-center";if(!this._isScreenLocationWithinView(o,a))return this._get("currentAlignment")||"top-center";function l(E){return parseInt(E.replace(/[^-\d\.]/g,""),10)}const c=s?window.getComputedStyle(s,null):null,h=c?l(c.getPropertyValue("max-height")):0,p=c?l(c.getPropertyValue("height")):0,{height:f,width:m}=r.getBoundingClientRect(),y=m+i,_=Math.max(f,h,p)+i,b=this._isOutsideView({popupHeight:_,popupWidth:y,screenLocation:o,side:"right",view:a}),w=this._isOutsideView({popupHeight:_,popupWidth:y,screenLocation:o,side:"left",view:a}),S=this._isOutsideView({popupHeight:_,popupWidth:y,screenLocation:o,side:"top",view:a}),T=this._isOutsideView({popupHeight:_,popupWidth:y,screenLocation:o,side:"bottom",view:a});return w?S?"bottom-right":"top-right":b?S?"bottom-left":"top-left":S?T?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return typeof e=="function"?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:i}=this;return i||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const i=["left","right"];return bm(this.container)&&i.reverse(),e.replace(/leading/gi,i[0]).replace(/trailing/gi,i[1])}_callDockPosition(e){return typeof e=="function"?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition((e=this.dockOptions)==null?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){var a;if(e!=="auto")return e;const i=(a=this.viewModel)==null?void 0:a.view,r=bm(this.container)?"top-left":"top-right";if(!i)return r;const s=i.padding||{left:0,right:0,top:0,bottom:0},n=i.width-s.left-s.right,{breakpoints:o}=i;return o&&n<=o.xsmall?"bottom-center":r}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!this._containerNode)return;const{screenLocation:i}=this.viewModel,{width:r}=this._containerNode.getBoundingClientRect(),s=this._calculatePositionStyle(i,r);s&&Object.assign(this._containerNode.style,s)}_calculateFullWidth(e){const{currentAlignment:i,_pointerOffsetInPx:r}=this;return i==="top-left"||i==="bottom-left"||i==="top-right"||i==="bottom-right"?e+r:e}_calculateAlignmentPosition(e,i,r,s){const{currentAlignment:n,_pointerOffsetInPx:o}=this;if(!r)return;const{padding:a}=r,l=s/2,c=r.height-i,h=r.width-e;return n==="bottom-center"?{top:i+o-a.top,left:e-l-a.left}:n==="top-left"?{bottom:c+o-a.bottom,right:h+o-a.right}:n==="bottom-left"?{top:i+o-a.top,right:h+o-a.right}:n==="top-right"?{bottom:c+o-a.bottom,left:e+o-a.left}:n==="bottom-right"?{top:i+o-a.top,left:e+o-a.left}:n==="top-center"?{bottom:c+o-a.bottom,left:e-l-a.left}:void 0}_calculatePositionStyle(e,i){const{dockEnabled:r,view:s}=this;if(!s)return;if(r)return{left:"",top:"",right:"",bottom:""};if(C(e)||!i)return;const n=this._calculateFullWidth(i),o=this._calculateAlignmentPosition(e.x,e.y,s,n);return o?{top:o.top!==void 0?`${o.top}px`:"auto",left:o.left!==void 0?`${o.left}px`:"auto",bottom:o.bottom!==void 0?`${o.bottom}px`:"auto",right:o.right!==void 0?`${o.right}px`:"auto"}:void 0}_viewChange(e,i){e&&i&&(this.close(),this.clear())}_viewReadyChange(e,i){if(e){const r=this.get("viewModel.view");this._wireUpView(r)}else i&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:i}=this;i&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,i,r){const[s,n]=e,[o,a]=i,{width:l=0,height:c=0}=r??{};return s<=l&&o>l||s>l&&o<=l||n<=c&&a>c||n>c&&a<=c}_updateDockEnabledForViewSize(e,i){if(!e||!i)return;const r=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},s=r.left+r.right,n=r.top+r.bottom,o=[],a=[];o[0]=e[0]-s,o[1]=e[1]-n,a[0]=i[0]-s,a[1]=i[1]-n;const{dockOptions:l}=this,c=l.breakpoint;this._dockingThresholdCrossed(o,a,c)&&this._setDockEnabledForViewSize(l),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_closeButtonNodeUpdated(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const i=e.querySelectorAll("li");i.length&&i[0].focus()}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const i=e.querySelectorAll("li");i.length&&i[0].focus()}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:i}=this;if(!i)return;const r=i.active&&!e;i.screenLocationEnabled=r}_shouldDockAtCurrentViewSize(e){var l,c;const i=e.breakpoint,r=(c=(l=this.viewModel)==null?void 0:l.view)==null?void 0:c.ui;if(!r)return!1;const{width:s,height:n}=r;if(isNaN(s)||isNaN(n)||!i)return!1;const o=i.hasOwnProperty("width")&&s<=(i.width??0),a=i.hasOwnProperty("height")&&n<=(i.height??0);return o||a}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,i){return this.featureNavigationVisible?rm(this.messages.pageText,{index:i+1,total:e}):null}_destroySpinner(){const{_spinner:e,view:i}=this;e&&(i&&i.ui&&i.ui.remove(e,Eoe),e.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new wKe({view:e}),e.ui.add(this._spinner,{key:Eoe,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const i=e.currentTarget.dataset.actionUid,{allActions:r}=this.viewModel,s=r.findIndex(o=>o.uid===i),n=r.getItemAt(s);n&&n.type==="toggle"&&(n.value=!n.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(s)}_selectFeature(e){const i=e.currentTarget["data-feature-index"];isNaN(i)||(this.viewModel.selectedFeatureIndex=i),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};u([d({readOnly:!0})],Wt.prototype,"actionsMenuId",null),u([d({readOnly:!0})],Wt.prototype,"actionsMenuButtonId",null),u([d({readOnly:!0})],Wt.prototype,"featureMenuId",null),u([d({readOnly:!0})],Wt.prototype,"titleId",null),u([d({readOnly:!0})],Wt.prototype,"contentId",null),u([d({readOnly:!0})],Wt.prototype,"hasContent",null),u([d({readOnly:!0})],Wt.prototype,"featureNavigationVisible",null),u([d({readOnly:!0})],Wt.prototype,"collapsible",null),u([d({readOnly:!0})],Wt.prototype,"featureMenuVisible",null),u([d({readOnly:!0})],Wt.prototype,"contentCollapsed",null),u([d({readOnly:!0})],Wt.prototype,"dividedActions",null),u([d({readOnly:!0,dependsOn:["_flowItems.length"]})],Wt.prototype,"_activeFlowItemWidget",null),u([d()],Wt.prototype,"actions",null),u([d()],Wt.prototype,"actionsMenuOpen",null),u([d()],Wt.prototype,"alignment",void 0),u([d()],Wt.prototype,"autoCloseEnabled",null),u([d()],Wt.prototype,"autoOpenEnabled",null),u([d()],Wt.prototype,"defaultPopupTemplateEnabled",null),u([d()],Wt.prototype,"content",null),u([d()],Wt.prototype,"collapsed",void 0),u([d()],Wt.prototype,"collapseEnabled",void 0),u([d({readOnly:!0})],Wt.prototype,"currentAlignment",null),u([d({readOnly:!0})],Wt.prototype,"currentDockPosition",null),u([d()],Wt.prototype,"dockOptions",null),u([d()],Wt.prototype,"dockEnabled",void 0),u([d({readOnly:!0})],Wt.prototype,"featureCount",null),u([d()],Wt.prototype,"featureMenuOpen",void 0),u([d()],Wt.prototype,"features",null),u([d()],Wt.prototype,"goToOverride",null),u([d()],Wt.prototype,"headingLevel",void 0),u([d()],Wt.prototype,"highlightEnabled",null),u([d()],Wt.prototype,"location",null),u([d()],Wt.prototype,"label",null),u([d()],Wt.prototype,"maxInlineActions",void 0),u([d(),dl("esri/widgets/Popup/t9n/Popup")],Wt.prototype,"messages",void 0),u([d(),dl("esri/t9n/common")],Wt.prototype,"messagesCommon",void 0),u([d()],Wt.prototype,"promises",null),u([d({readOnly:!0})],Wt.prototype,"selectedFeature",null),u([d()],Wt.prototype,"selectedFeatureIndex",null),u([d({readOnly:!0})],Wt.prototype,"selectedFeatureWidget",null),u([d()],Wt.prototype,"spinnerEnabled",void 0),u([d()],Wt.prototype,"title",null),u([d()],Wt.prototype,"updateLocationEnabled",null),u([d()],Wt.prototype,"view",null),u([d({type:OTe}),B7e(["triggerAction","trigger-action"])],Wt.prototype,"viewModel",void 0),u([d()],Wt.prototype,"visible",null),u([d()],Wt.prototype,"visibleElements",void 0),u([wi("visibleElements")],Wt.prototype,"castVisibleElements",null),u([Fh()],Wt.prototype,"_close",null),u([Fh()],Wt.prototype,"_toggleDockEnabled",null),u([Fh()],Wt.prototype,"_toggleFeatureMenu",null),u([Fh()],Wt.prototype,"_toggleActionsMenu",null),u([Fh()],Wt.prototype,"_triggerAction",null),u([Fh()],Wt.prototype,"_selectFeature",null),u([Fh()],Wt.prototype,"_next",null),u([Fh()],Wt.prototype,"_previous",null),Wt=u([I("esri.widgets.Popup")],Wt);const Roe=Wt,qk=[0,0];function hQe(t){const e=(t.ownerDocument||window.document).defaultView,i=t.getBoundingClientRect();return qk[0]=i.left+((e==null?void 0:e.pageXOffset)??0),qk[1]=i.top+((e==null?void 0:e.pageYOffset)??0),qk}function Moe(t){t&&(Z0e(t),t.parentNode&&t.parentNode.removeChild(t))}function dQe(t){const e=document.createElement("div");return t.appendChild(e),e}const QA=16,X$=750,pQe=512,fQe=2,RTe=t=>{let e=class extends t{constructor(...i){var r;super(...i),this._freqInfo={freq:QA,time:X$},this._overlayRenderTaskHandle=null,this.height=0,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,i.length!==0&&((r=i[0])==null?void 0:r.popup)!==void 0||(this.popup=new Roe({view:this})),this.handles.add([re(()=>this.cursor,s=>{const{surface:n}=this;n&&n.setAttribute("data-cursor",s)}),re(()=>this.interacting,s=>{const{surface:n}=this;n&&n.setAttribute("data-interacting",s.toString())})])}initialize(){this.handles.add(re(()=>this.ui,(i,r)=>this._handleUIChange(i,r))),this._wireUI(this.ui),this.handles.add([this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=Je(this.ui),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}get container(){return this._get("container")??null}set container(i){const r=this._get("container"),s=pU(i);if(s||typeof i!="string"||oe.getLogger(this.declaredClass).error("#container",`element with id '${i}' not found`),r===s)return;const n="dom-size";if(this.handles.remove(n),this._stopMeasuring(),r&&(r.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(Moe(this.root),this._set("root",null)),this.userContent&&(Jie(this.userContent,r),Moe(this.userContent),this._set("userContent",null))),!s)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);s.classList.add("esri-view");const o=document.createElement("div");o.className="esri-view-user-storage",Jie(s,o),s.appendChild(o),this._set("userContent",o);const a=document.createElement("div");a.className="esri-view-root",s.insertBefore(a,s.firstChild),this._set("root",a);const l=document.createElement("div");l.className="esri-view-surface",l.setAttribute("role","application"),l.tabIndex=0,a.appendChild(l),this._set("surface",l);const c=new Ure;a.appendChild(c.surface),this._set("overlay",c),re(()=>c.needsRender,h=>{h&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=By({render:()=>{var p;return(p=this.overlay)==null?void 0:p.render()}}):this._overlayRenderTaskHandle=Rr(this._overlayRenderTaskHandle)}),this.forceDOMReadyCycle(),this.handles.add(re(()=>this.size,h=>{const[p,f]=h,m="esri-view-surface--inset-outline";p>=document.body.clientWidth||f>=document.body.clientHeight?l.classList.add(m):l.classList.remove(m)},Zt),n),this._set("container",s),this._startMeasuring()}get focused(){const i=document.activeElement===this.surface;return document.hasFocus()&&i}set popup(i){const r=this._get("popup");r&&r!==i&&r.destroy(),this._set("popup",i)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(i,r,s){const n=this.position;return i-=n?n[0]:0,r-=n?n[1]:0,s?(s[0]=i,s[1]=r):s=[i,r],s}containerToPage(i,r,s){const n=this.position;return i+=n?n[0]:0,r+=n?n[1]:0,s?(s[0]=i,s[1]=r):s=[i,r],s}_handleUIChange(i,r){r&&(this.handles.remove("ui"),r.destroy()),i&&this._wireUI(i),this._set("ui",i)}_wireUI(i){this.handles.remove("ui"),i&&(i.view=this,this.handles.add([re(()=>this.root,r=>{i.container=r?dQe(r):null},Zt),re(()=>this.popup,(r,s)=>{const n="popup",o="manual";s&&i.remove(s,n),r&&(r.view=i.view,i.add(r,{key:n,position:o}))},Zt)],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const i=this._freqInfo;i.freq=QA,i.time=X$,this.handles.add([(()=>{const r=()=>{i.freq=QA,i.time=X$};return window.addEventListener("resize",r),{remove(){window.removeEventListener("resize",r)}}})(),By({prepare:r=>{const s=this._measure(),n=this._freqInfo;if(n.time+=r.deltaTime,s&&(n.freq=QA,this._get("resizing")||this._set("resizing",!0)),n.time<n.freq)return;n.time=0;const o=this._position();n.freq=o||s?QA:Math.min(X$,n.freq*fQe),!s&&n.freq>=pQe&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const i=this.container,r=i?i.clientWidth:0,s=i?i.clientHeight:0;if(r===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,o=this.height;return r===n&&s===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",r),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:o,width:r,height:s}),!0)}_position(){const i=this.container,r=this.position,s=i&&hQe(i);return!!s&&(!r||s[0]!==r[0]||s[1]!==r[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return u([d()],e.prototype,"container",null),u([d({readOnly:!0})],e.prototype,"focused",null),u([d({readOnly:!0})],e.prototype,"height",void 0),u([d({type:Roe})],e.prototype,"popup",null),u([d({type:Ure})],e.prototype,"overlay",void 0),u([d({readOnly:!0})],e.prototype,"position",void 0),u([d({readOnly:!0})],e.prototype,"resizing",void 0),u([d({readOnly:!0})],e.prototype,"root",void 0),u([d({value:null,readOnly:!0})],e.prototype,"size",null),u([d({readOnly:!0})],e.prototype,"surface",void 0),u([d({readOnly:!0})],e.prototype,"suspended",void 0),u([d()],e.prototype,"ui",void 0),u([d({readOnly:!0})],e.prototype,"userContent",void 0),u([d({readOnly:!0})],e.prototype,"width",void 0),u([d()],e.prototype,"widthBreakpoint",void 0),e=u([I("esri.views.DOMContainer")],e),e},$K=oe.getLogger("esri.layers.support.ElevationSampler");let MTe=class{queryElevation(e){return PTe(e.clone(),this)}on(){return vQe}projectIfRequired(e,i){return ITe(e,i)}},mQe=class extends MTe{get spatialReference(){return this.extent.spatialReference}constructor(e,i,r){super(),this.tile=e,this.noDataValue=r;const s=e.tile.extent;this.extent=eU(s,i.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=s;const n=_l(i.spatialReference),o=i.lodAt(e.tile.level).resolution*n;this.demResolution={min:o,max:o}}contains(e){const i=this.projectIfRequired(e,this.spatialReference);return!C(i)&&this.containsAt(i.x,i.y)}containsAt(e,i){return tU(this._aaExtent,e,i)}elevationAt(e,i){if(!this.containsAt(e,i)){const r=this.extent,s=`${r.xmin}, ${r.ymin}, ${r.xmax}, ${r.ymax}`;return $K.warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${s})`),this.noDataValue}return Gt(this.tile.sample(e,i),this.noDataValue)}},U$t=class extends MTe{get spatialReference(){return this.extent.spatialReference}constructor(e,i,r){let s;super(),typeof i=="number"?(this.noDataValue=i,s=null):(s=i,this.noDataValue=r),this.samplers=s?e.map(o=>new mQe(o,s,this.noDataValue)):e;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:o,max:a}=n.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=eU(ci(),s.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,i){for(const r of this.samplers)if(r.containsAt(e,i))return r.elevationAt(e,i);return $K.warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler`),this.noDataValue}};function PTe(t,e){const i=ITe(t,e.spatialReference);if(!i)return null;switch(t.type){case"point":gQe(t,i,e);break;case"polyline":yQe(t,i,e);break;case"multipoint":_Qe(t,i,e)}return t}function ITe(t,e){if(C(t))return null;const i=t.spatialReference;if(i.equals(e))return t;const r=sT(t,e);return r||$K.error(`Cannot project geometry spatial reference (wkid:${i.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),r}function gQe(t,e,i){t.z=i.elevationAt(e.x,e.y)}function yQe(t,e,i){fm.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s],o=e.paths[s];for(let a=0;a<n.length;a++){const l=n[a],c=o[a];fm.x=c[0],fm.y=c[1],r&&(l[3]=l[2]),l[2]=i.elevationAt(fm.x,fm.y)}}t.hasZ=!0}function _Qe(t,e,i){fm.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let s=0;s<t.points.length;s++){const n=t.points[s],o=e.points[s];fm.x=o[0],fm.y=o[1],r&&(n[3]=n[2]),n[2]=i.elevationAt(fm.x,fm.y)}t.hasZ=!0}const fm=new pt,vQe={remove(){}};var aq;let Gf=aq=class extends Ie{constructor(t){super(t),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new aq({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Gf.prototype,"cols",void 0),u([d({type:Yr,json:{write:!0}})],Gf.prototype,"level",void 0),u([d({type:String,json:{write:!0}})],Gf.prototype,"levelValue",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Gf.prototype,"origin",void 0),u([d({type:Number,json:{write:!0}})],Gf.prototype,"resolution",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Gf.prototype,"rows",void 0),u([d({type:Number,json:{write:!0}})],Gf.prototype,"scale",void 0),Gf=aq=u([I("esri.layers.support.LOD")],Gf);const Wh=Gf;let bQe=class{constructor(e,i,r,s,n){this.id=e,this.level=i,this.row=r,this.col=s,this.extent=n}};var $_;const Poe=new Gi({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let Po=$_=class extends Ie{static create(t={}){const{resolutionFactor:e=1,scales:i,size:r=256,spatialReference:s=mt.WebMercator,numLODs:n=24}=t;if(!sa(s)){const p=[];if(i)for(let f=0;f<i.length;f++){const m=i[f];p.push(new Wh({level:f,scale:m,resolution:m}))}else{let f=5e-4;for(let m=n-1;m>=0;m--)p.unshift(new Wh({level:m,scale:f,resolution:f})),f*=2}return new $_({dpi:96,lods:p,origin:new pt(0,0,s),size:[r,r],spatialReference:s})}const o=Bp(s),a=t.origin?new pt({x:t.origin.x,y:t.origin.y,spatialReference:s}):new pt(o?{x:o.origin[0],y:o.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),l=96,c=1/(_l(s)*39.37*l),h=[];if(i)for(let p=0;p<i.length;p++){const f=i[p],m=f*c;h.push(new Wh({level:p,scale:f,resolution:m}))}else{let p=Age(s)?512/r*5916575275917094e-7:256/r*591657527591555e-6;const f=Math.ceil(n/e);h.push(new Wh({level:0,scale:p,resolution:p*c}));for(let m=1;m<f;m++){const y=p/2**e,_=y*c;h.push(new Wh({level:m,scale:y,resolution:_})),p=y}}return new $_({dpi:l,lods:h,origin:a,size:[r,r],spatialReference:s})}constructor(t){super(t),this.dpi=96,this.format=null,this.origin=null,this.minScale=0,this.maxScale=0,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:t,origin:e}=this;if(t&&e){const i=Bp(t);return t.isWrappable&&!!i&&Math.abs(i.origin[0]-e.x)<=i.dx}return!1}readOrigin(t,e){return pt.fromJSON({spatialReference:e.spatialReference,...t})}set lods(t){let e=0,i=0;const r=[],s=this._levelToLOD={};t&&(e=-1/0,i=1/0,t.forEach(n=>{r.push(n.scale),e=n.scale>e?n.scale:e,i=n.scale<i?n.scale:i,s[n.level]=n})),this._set("scales",r),this._set("minScale",e),this._set("maxScale",i),this._set("lods",t),this._initializeUpsampleLevels()}readSize(t,e){return[e.cols,e.rows]}writeSize(t,e){e.cols=t[0],e.rows=t[1]}zoomToScale(t){const e=this.scales;if(t<=0)return e[0];if(t>=e.length-1)return e[e.length-1];const i=Math.floor(t),r=i+1;return e[i]/(e[i]/e[r])**(t-i)}scaleToZoom(t){const e=this.scales,i=e.length-1;let r=0;for(;r<i;r++){const s=e[r],n=e[r+1];if(s<=t)return r;if(n===t)return r+1;if(s>t&&n<t)return r+Math.log(s/t)/Math.log(s/n)}return r}snapScale(t,e=.95){const i=this.scaleToZoom(t);return i%Math.floor(i)>=e?this.zoomToScale(Math.ceil(i)):this.zoomToScale(Math.floor(i))}tileAt(t,e,i,r){const s=this.lodAt(t);if(!s)return null;let n,o;if(typeof e=="number")n=e,o=i;else if(rn(e.spatialReference,this.spatialReference))n=e.x,o=e.y,r=i;else{const c=sT(e,this.spatialReference);if(C(c))return null;n=c.x,o=c.y,r=i}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return r||(r=new bQe(null,0,0,0,ci())),r.level=t,r.row=Math.floor((this.origin.y-o)/l+.001),r.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(r),r}updateTileInfo(t,e=$_.ExtrapolateOptions.NONE){let i=this.lodAt(t.level);if(!i&&e===$_.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<t.level&&(i=o)}if(!i)return;const r=t.level-i.level,s=i.resolution*this.size[0]/2**r,n=i.resolution*this.size[1]/2**r;t.id=`${t.level}/${t.row}/${t.col}`,t.extent||(t.extent=ci()),t.extent[0]=this.origin.x+t.col*s,t.extent[1]=this.origin.y-(t.row+1)*n,t.extent[2]=t.extent[0]+s,t.extent[3]=t.extent[1]+n}upsampleTile(t){const e=this._upsampleLevels[t.level];return!(!e||e.parentLevel===-1)&&(t.level=e.parentLevel,t.row=Math.floor(t.row/e.factor+.001),t.col=Math.floor(t.col/e.factor+.001),this.updateTileInfo(t),!0)}getTileBounds(t,e){const i=this.lodAt(e.level);if(i==null)return null;const{resolution:r}=i,s=r*this.size[0],n=r*this.size[1];return t[0]=this.origin.x+e.col*s,t[1]=this.origin.y-(e.row+1)*n,t[2]=t[0]+s,t[3]=t[1]+n,t}lodAt(t){var e;return((e=this._levelToLOD)==null?void 0:e[t])??null}clone(){return $_.fromJSON(this.write({}))}getOrCreateCompatible(t,e){if(this.size[0]===256&&this.size[1]===256)return t===256?this:null;const i=[],r=this.lods.length;for(let s=0;s<r;s++){const n=this.lods[s],o=n.resolution*e;i.push(new Wh({level:n.level,scale:n.scale,resolution:o}))}return new $_({size:[t,t],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:i})}_initializeUpsampleLevels(){const t=this.lods;this._upsampleLevels=[];let e=null;for(let i=0;i<t.length;i++){const r=t[i];this._upsampleLevels[r.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/r.resolution:0},e=r}}};u([d({type:Number,json:{write:!0}})],Po.prototype,"compressionQuality",void 0),u([d({type:Number,json:{write:!0}})],Po.prototype,"dpi",void 0),u([d({type:String,json:{read:Poe.read,write:Poe.write,origins:{"web-scene":{read:!1,write:!1}}}})],Po.prototype,"format",void 0),u([d({readOnly:!0})],Po.prototype,"isWrappable",null),u([d({type:pt,json:{write:!0}})],Po.prototype,"origin",void 0),u([Qe("origin")],Po.prototype,"readOrigin",null),u([d({type:[Wh],value:null,json:{write:!0}})],Po.prototype,"lods",null),u([d({readOnly:!0})],Po.prototype,"minScale",void 0),u([d({readOnly:!0})],Po.prototype,"maxScale",void 0),u([d({readOnly:!0})],Po.prototype,"scales",void 0),u([d({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],Po.prototype,"size",void 0),u([Qe("size",["rows","cols"])],Po.prototype,"readSize",null),u([lt("size",{cols:{type:Yr},rows:{type:Yr}})],Po.prototype,"writeSize",null),u([d({type:mt,json:{write:!0}})],Po.prototype,"spatialReference",void 0),Po=$_=u([I("esri.layers.support.TileInfo")],Po),function(t){var e;(e=t.ExtrapolateOptions||(t.ExtrapolateOptions={}))[e.NONE=0]="NONE",e[e.POWER_OF_TWO=1]="POWER_OF_TWO"}(Po||(Po={}));const ZM=Po,wQe=12;let Gc=class kl{constructor(e){const i=kl.checkUnsupported(e);if(v(i))throw i;const r=e;this.spatialReference=r.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=$x(this.spatialReference)||Zm(this.spatialReference)||Jm(this.spatialReference),this.origin=[r.origin.x,r.origin.y],this.pixelSize=r.size[0],this.dpi=r.dpi;const s=r.lods.reduce((c,h,p)=>(h.level<c.min&&(c.min=h.level,c.minIndex=p),c.max=Math.max(c.max,h.level),c),{min:1/0,minIndex:0,max:-1/0}),n=r.lods[s.minIndex],o=2**n.level;let a=n.resolution*o,l=n.scale*o;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*r.size[0],a*r.size[1]]},a/=2,l/=2}clone(){return new kl(this.toTileInfo())}toTileInfo(){return new ZM({dpi:this.dpi,origin:new pt({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,i)=>new Wh({level:i,scale:e.scale,resolution:e.resolution}))})}getExtent(e,i,r,s){const n=this.levels[e],o=n.tileSize[0],a=n.tileSize[1];s[0]=this.origin[0]+r*o,s[2]=this.origin[0]+(r+1)*o,s[3]=this.origin[1]-i*a,s[1]=this.origin[1]-(i+1)*a}convertExtentToRadians(e,i){this._isWebMercator?(i[0]=Sie(e[0]),i[1]=v4(e[1]),i[2]=Sie(e[2]),i[3]=v4(e[3])):this._isGCS&&(i[0]=ii(e[0]),i[1]=ii(e[1]),i[2]=ii(e[2]),i[3]=ii(e[3]))}getExtentGeometry(e,i,r,s=new Pi){return this.getExtent(e,i,r,mf),s.spatialReference=this.spatialReference,s.xmin=mf[0],s.ymin=mf[1],s.xmax=mf[2],s.ymax=mf[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(e){if(e==null)return!1;let i=!1;for(;this.levels.length<=e;){const r=this.levels[this.levels.length-1],s=r.resolution/2;this.levels.push({resolution:s,scale:r.scale/2,tileSize:[s*this.pixelSize,s*this.pixelSize]}),i=!0}return i}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const i=this.levels[0].scale;return e>=i?0:Math.log(i/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e){if(!(e instanceof kl)){if(kl.checkUnsupported(e))return!1;e=new kl(e)}if(!e.spatialReference.equals(this.spatialReference)||e.pixelSize!==this.pixelSize)return!1;const i=Math.min(this.levels.length,e.levels.length)-1,r=this.levels[i].resolution;let s=.5*r;return!gE(e.origin[0],this.origin[0],s)||!gE(e.origin[1],this.origin[1],s)?!1:(s=.5*r/2**i/this.pixelSize*wQe,gE(r,e.levels[i].resolution,s))}rootTilesInExtent(e,i=null,r=1/0){const s=new Array,n=this.levels[0].tileSize;if(C(e)||n[0]===0||n[1]===0)return s;kl.computeRowColExtent(e,n,this.origin,mf);let o=mf[1],a=mf[3],l=mf[0],c=mf[2];const h=c-l,p=a-o;if(h*p>r){const f=Math.floor(Math.sqrt(r));p>f&&(o=o+Math.floor(.5*p)-Math.floor(.5*f),a=o+f),h>f&&(l=l+Math.floor(.5*h)-Math.floor(.5*f),c=l+f)}for(let f=o;f<a;f++)for(let m=l;m<c;m++)s.push([0,f,m]);return v(i)&&(i[0]=this.origin[0]+l*n[0],i[1]=this.origin[1]-a*n[1],i[2]=this.origin[0]+c*n[0],i[3]=this.origin[1]-o*n[1]),s}static computeRowColExtent(e,i,r,s){const n=.001*(e[2]-e[0]+(e[3]-e[1]));s[0]=Math.max(0,Math.floor((e[0]+n-r[0])/i[0])),s[2]=Math.max(0,Math.ceil((e[2]-n-r[0])/i[0])),s[1]=Math.max(0,Math.floor((r[1]-e[3]+n)/i[1])),s[3]=Math.max(0,Math.ceil((r[1]-e[1]-n)/i[1]))}static isPowerOfTwo(e){const i=e.lods,r=i[0].resolution*2**i[0].level;return!i.some(s=>!CFe(s.resolution,r/2**s.level))}static hasGapInLevels(e){const i=e.lods.map(r=>r.level);i.sort((r,s)=>r-s);for(let r=1;r<i.length;r++)if(i[r]!==i[0]+r)return!0;return!1}static tileSizeSupported(e){const i=e.size[1];return i===e.size[0]&&(i&i-1)==0&&i>=128&&i<=512}static hasOriginPerLODs(e){const i=e.origin;return e.lods.some(r=>r.origin!=null&&(r.origin[0]!==i.x||r.origin[1]!==i.y))}static getMissingTileInfoError(){return new W("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return C(e)?LK():e.lods.length<1?new W("tilingscheme:generic","Tiling scheme must have at least one level"):kl.isPowerOfTwo(e)?kl.hasGapInLevels(e)?new W("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):kl.tileSizeSupported(e)?kl.hasOriginPerLODs(e)?new W("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new W("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new W("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,i){const r=e[2]-e[0],s=e[3]-e[1],n=_l(i),o=1.2*Math.max(r,s),a=256,l=96,c=.0254,h=new kl(new ZM({size:[a,a],origin:new pt({x:e[0]-.5*(o-r),y:e[3]+.5*(o-s)}),lods:[new Wh({level:0,resolution:o/a,scale:1/(a/l*c/(o*n))})],spatialReference:i}));return h.ensureMaxLod(20),h}static makeWebMercatorAuxiliarySphere(e){const i=new kl(kl.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(e),i}static makeGCSWithTileSize(e,i=256,r=16){const s=256/i,n=new kl(new ZM({size:[i,i],origin:new pt({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new Wh({level:0,resolution:.703125*s,scale:295497598570834e-6*s})]}));return n.ensureMaxLod(r),n}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}};function LK(){return new W("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}Gc.WebMercatorAuxiliarySphereTileInfo=new ZM({size:[256,256],origin:new pt({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:mt.WebMercator}),spatialReference:mt.WebMercator,lods:[new Wh({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),Gc.WebMercatorAuxiliarySphere=Gc.makeWebMercatorAuxiliarySphere(19);const mf=ci(),XS=64,FR=512,xQe=2.5,iP=AFe(g7/10),$Te=2,LTe=ci();Gc.WebMercatorAuxiliarySphere.getExtent(0,0,0,LTe);const TQe=ci([-180,-90,180,90]),SQe="Cannot extend surface to encompass all layers because it would result in too many root tiles.",EQe="Surface extent is too large for tile resolution at level 0.",CQe=3;let AQe=CQe;function lq(t){return t<4?3:AQe}let L_=class extends As.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=iP}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(e==null||C(e.extent)||C(e.spatialReference))return null;const i=eU(e.extent,e.spatialReference);return i.zmin=e.visibleElevationBounds.min,i.zmax=e.visibleElevationBounds.max,i}get spatialReference(){var e;return Gt((e=this.view.basemapTerrain)==null?void 0:e.spatialReference,mt.WGS84)}elevationAt(e,i){var r;if(C(this.extent)||!rl(this.extent,e,i)){const s=v(this.extent)?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return oe.getLogger(this.declaredClass).warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${s})`),this.noDataValue}return Gt((r=this.view.elevationProvider)==null?void 0:r.getElevation(e,i,0,this.spatialReference,"ground"),this.noDataValue)}queryElevation(e){return PTe(e.clone(),this)}};u([d({readOnly:!0})],L_.prototype,"demResolution",void 0),u([d({readOnly:!0})],L_.prototype,"extent",null),u([d({readOnly:!0})],L_.prototype,"noDataValue",void 0),u([d()],L_.prototype,"spatialReference",null),u([d({constructOnly:!0})],L_.prototype,"view",void 0),L_=u([I("esri.views.support.GroundViewElevationSampler")],L_);const OQe=L_;let D_=class extends $e{constructor(e){super(e),this._handles=new Ki,this.view=null,this.layerViews=new Nt}initialize(){this._handles.add(qo(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.ground},e=>e.load())),this._handles.add(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null),this._handles&&(this._handles.destroy(),this._handles=null)}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new OQe({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this._handles.remove("updating"),this._handles.add(this.layerViews.map(e=>re(()=>e.updating,()=>this._updateUpdating(),Wi)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};u([d({readOnly:!0})],D_.prototype,"elevationSampler",null),u([d({type:Boolean,readOnly:!0})],D_.prototype,"updating",null),u([d({constructOnly:!0})],D_.prototype,"view",void 0),u([d({type:Nt,readOnly:!0})],D_.prototype,"layerViews",void 0),u([d({readOnly:!0})],D_.prototype,"suspended",null),D_=u([I("esri.views.GroundView")],D_);const RQe=D_,DTe=t=>{let e=class extends t{async fetchPopupFeatures(i,r){await this.when();const{location:s,queryArea:n,layerViewsAndGraphics:o,clientOnlyGraphics:a}=await this._prepareFetchPopupFeatures(i,r),l=Promise.resolve(a),c=this._queryLayerPopupFeatures(n,o,r),h=c.map(p=>p.promise);return{location:s,clientOnlyGraphics:a,allGraphicsPromise:Kz([l,...h]).then(p=>Array.from(new Set(p.flat()))),promisesPerLayerView:c}}_queryLayerPopupFeatures(i,r,s){return r.map(({layerView:n,graphics:o})=>{const a={clientGraphics:o,event:v(s)?s.event:void 0,signal:v(s)?s.signal:void 0,defaultPopupTemplateEnabled:!!v(s)&&!!s.defaultPopupTemplateEnabled},l=n.fetchPopupFeatures(i,a);return{layerView:n,promise:l}})}_isValidPopupGraphic(i,r){return i&&!!i.getEffectivePopupTemplate(v(r)&&r.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(i,r){const{clientGraphics:s,queryArea:n,location:o}=await this._popupHitTestGraphics(i,r),a=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(s,a);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:n,location:o}}async _popupHitTestGraphics(i,r){const s=await this.popupHitTest(i),n=s.results,o=s.mapPoint,a=n.filter(c=>c.type==="graphic"&&this._isValidPopupGraphic(c.graphic,r)),l=a.length?a[0].mapPoint:null;return{clientGraphics:a.map(c=>c.graphic),queryArea:o,location:o||l}}_getFetchPopupLayerViews(){const i=[];return this.allLayerViews.forEach(r=>{this._isValidPopupLayerView(r)&&i.push(r)}),v(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&i.push(this.graphicsView),i.reverse()}_isValidPopupLayerView(i){return v(i)&&(!("layer"in i)||!i.suspended)&&"fetchPopupFeatures"in i}_graphicsPerFetchPopupLayerView(i,r){const s=[],n=new Map,o=r.map(a=>{const l=[];return"layer"in a?n.set(a.layer,l):n.set(a.graphics,l),{layerView:a,graphics:l}});for(const a of i){const l=n.get(a.layer)||n.get(a.sourceLayer)||null;l?l.push(a):s.push(a)}return{layerViewsAndGraphics:o,clientOnlyGraphics:s}}};return e=u([I("esri.views.PopupView")],e),e};async function NTe(t,e){return await t.load(),MQe(t,e)}async function MQe(t,e){const i=[],r=(...n)=>{for(const o of n)C(o)||(Array.isArray(o)?r(...o):Nt.isCollection(o)?o.forEach(a=>r(a)):Hy.isLoadable(o)&&i.push(o))};e(r);let s=null;if(await eGe(i,async n=>{const o=await Kp(PQe(n)?n.loadAll():n.load());o.ok!==!1||s||(s=o)}),s)throw s.error;return t}function PQe(t){return"loadAll"in t&&typeof t.loadAll=="function"}async function IQe(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t,i=await t_e("esri/t9n/basemaps");return i[t]||i[e]}const cq={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return ir("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return ir("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return ir("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return ir("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return ir("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return ir("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return ir("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return ir("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return ir("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return ir("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return ir("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return ir("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return ir("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return ir("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return ir("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return ir("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return ir("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return ir("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return ir("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return ir("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return ir("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return ir("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return ir("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return ir("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return ir("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return ir("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return ir("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}},$Qe=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),LQe=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","media","ogc-feature","route","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function DQe(t){return t.layerContainerType==="basemap"?$Qe:t.layerContainerType==="operational-layers"?LQe:null}function NQe(t,e){if(e.restrictedWebMapWriting){const i=DQe(e);return!v(i)||i.has(t.type)&&!TJ(t)}return!0}function FQe(t,e){if(e)if(TJ(t)){const i=GP("featureCollection.layers",e),r=i&&i[0]&&i[0].layerDefinition;r&&Wk(t,r)}else t.type==="stream"?Wk(t,e.layerDefinition=e.layerDefinition||{}):t.type!=="group"&&Wk(t,e)}function Wk(t,e){"maxScale"in t&&(e.maxScale=m4(t.maxScale)??void 0),"minScale"in t&&(e.minScale=m4(t.minScale)??void 0)}function UQe(t,e){if(FQe(t,e),e&&("blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=m4(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(TJ(t)){const i=e.featureCollection;i&&(i.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function Ioe(t,e,i){if(!("write"in t)||!t.write)return i&&i.messages&&i.messages.push(new W("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(NQe(t,i)){const r={};return t.write(r,i)?r:null}return v(e)&&UQe(t,e=ae(e)),e}var oF;let VQe=0;const FTe="esri.Basemap";let Oh=oF=class extends YP(Hy){constructor(t){super(t),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+VQe++,this.baseLayers=new Nt,this.referenceLayers=new Nt;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type==="elevation"&&oe.getLogger(this.declaredClass).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a basemap layer and will therefore be ignored.`)},i=r=>{r.parent=null};this.baseLayers.on("after-add",r=>e(r.item)),this.referenceLayers.on("after-add",r=>e(r.item)),this.baseLayers.on("after-remove",r=>i(r.item)),this.referenceLayers.on("after-remove",r=>i(r.item))}initialize(){this.when().catch(t=>{oe.getLogger(this.declaredClass).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var i;const t=this.baseLayers.removeAll();for(const r of t)r.destroy();const e=this.referenceLayers.removeAll();for(const r of e)r.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),(i=this.portalItem)==null||i.destroy(),this.portalItem=null}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set baseLayers(t){this._set("baseLayers",Rx(t,this._get("baseLayers")))}_writeBaseLayers(t,e,i){const r=[];t&&(i={...i,layerContainerType:"basemap"},this.baseLayers.forEach(s=>{const n=Ioe(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);v(n)&&r.push(n)}),this.referenceLayers.forEach(s=>{const n=Ioe(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);v(n)&&(s.type!=="scene"&&(n.isReference=!0),r.push(n))})),e.baseMapLayers=r}set referenceLayers(t){this._set("referenceLayers",Rx(t,this._get("referenceLayers")))}writeTitle(t,e){e.title=t||"Basemap"}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return NTe(this,t=>{t(this.baseLayers,this.referenceLayers)})}clone(){const t={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};return this.loaded&&(t.loadStatus="loaded"),new oF({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}write(t,e){return t=t||{},e&&e.origin||(e={origin:"web-map",...e}),super.write(t,e),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(t.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(i=>{const r=ae(i);return r.url&&Gm(r.url)&&(r.url=`https:${r.url}`),r.templateUrl&&Gm(r.templateUrl)&&(r.templateUrl=`https:${r.templateUrl}`),r})),t}async _loadFromSource(t){const{resourceInfo:e,portalItem:i}=this;gi(t);const r=[];if(e){const s=e.context?e.context.url:null;if(r.push(this._loadLayersFromJSON(e.data,s,t)),e.data.id&&!e.data.title){const n=e.data.id;r.push(IQe(n).then(o=>{o&&this.read({title:o},e.context)}))}}else i&&r.push(this._loadFromItem(i,t));await Promise.all(r)}async _loadLayersFromJSON(t,e,i){const r=this.resourceInfo&&this.resourceInfo.context,s=this.portalItem&&this.portalItem.portal||r&&r.portal||null,n=r&&r.origin==="web-scene"?"web-scene":"web-map",{populateOperationalLayers:o}=await ee(()=>import("./layersCreator-9c655cbd.js"),["./layersCreator-9c655cbd.js","./lazyLayerLoader-528f9864.js","./portalLayers-8237783e.js","./layersLoader-d22a3cce.js","./fetchService-590f6092.js","./jsonContext-ab2114a6.js"],import.meta.url),a=[];if(gi(i),t.baseMapLayers&&Array.isArray(t.baseMapLayers)){const l={context:{origin:n,url:e,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=f=>n==="web-scene"&&f.layerType==="ArcGISSceneServiceLayer"||f.isReference,h=o(this.baseLayers,t.baseMapLayers.filter(f=>!c(f)),l);a.push(h);const p=o(this.referenceLayers,t.baseMapLayers.filter(c),l);a.push(p)}await lc(a)}async _loadFromItem(t,e){const i=await t.load(e),r=await i.fetchData("json",e),s=vl(t.itemUrl??"");return this._set("resourceInfo",{data:r.baseMap??{},context:{origin:t.type==="Web Scene"?"web-scene":"web-map",portal:t.portal||uc.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:t.title,thumbnailUrl:t.thumbnailUrl},{origin:"portal-item",portal:t.portal||uc.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,e)}static fromId(t){const e=cq[t];if(e){if(e.deprecated){let i=null;t==="dark-gray"?i="dark-gray-vector":t==="gray"?i="gray-vector":t==="streets"?i="streets-vector":t==="topo"&&(i="topo-vector"),Ame(oe.getLogger(FTe),`The ${t} basemap has entered mature support and is no longer being updated.`,{replacement:i,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return oF.fromJSON(e)}return null}};u([d({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,i,r){this._writeBaseLayers(t,e,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:Nt}},writer(t,e,i,r){this._writeBaseLayers(t,e,r)}}}}}})],Oh.prototype,"baseLayers",null),u([d({type:String,json:{origins:{"web-scene":{write:!0}}}})],Oh.prototype,"id",void 0),u([d({type:WM})],Oh.prototype,"portalItem",void 0),u([d()],Oh.prototype,"referenceLayers",null),u([d({readOnly:!0})],Oh.prototype,"resourceInfo",void 0),u([d({type:mt})],Oh.prototype,"spatialReference",void 0),u([d()],Oh.prototype,"thumbnailUrl",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],Oh.prototype,"title",void 0),u([lt("title")],Oh.prototype,"writeTitle",null),Oh=oF=u([I(FTe)],Oh);const h5=Oh,kQe=Object.freeze(Object.defineProperty({__proto__:null,default:h5},Symbol.toStringTag,{value:"Module"}));var uq;let aF=uq=class extends Ie{constructor(t){super(t),this.type="none"}clone(){return new uq({type:this.type})}};u([At({none:"none",stayAbove:"stay-above"})],aF.prototype,"type",void 0),aF=uq=u([I("esri.ground.NavigationConstraint")],aF);let Ds=class extends $e{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1,this.TERRAIN_USE_LEGACY_SHADING=!1}};u([d()],Ds.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),u([d()],Ds.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),u([d()],Ds.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),u([d()],Ds.prototype,"DECONFLICTOR_SHOW_GRID",void 0),u([d()],Ds.prototype,"LABELS_SHOW_BORDER",void 0),u([d()],Ds.prototype,"TEXT_SHOW_BASELINE",void 0),u([d()],Ds.prototype,"TEXT_SHOW_BORDER",void 0),u([d()],Ds.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),u([d()],Ds.prototype,"OVERLAY_SHOW_CENTER",void 0),u([d()],Ds.prototype,"SHOW_POI",void 0),u([d()],Ds.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),u([d()],Ds.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),u([d()],Ds.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),u([d()],Ds.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),u([d()],Ds.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),u([d()],Ds.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),u([d()],Ds.prototype,"I3S_TREE_SHOW_TILES",void 0),u([d()],Ds.prototype,"I3S_SHOW_MODIFICATIONS",void 0),u([d()],Ds.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),u([d()],Ds.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),u([d()],Ds.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),u([d()],Ds.prototype,"LINE_WIREFRAMES",void 0),u([d()],Ds.prototype,"TERRAIN_USE_LEGACY_SHADING",void 0),Ds=u([I("esri.views.3d.support.DebugFlags")],Ds);const Ji=new Ds;var hq;let jf=hq=class extends YP(Hy){constructor(t){super(t),this.opacity=1,this.shading=!Ji.TERRAIN_USE_LEGACY_SHADING,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new Nt;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&oe.getLogger(this.declaredClass).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=r=>{r.parent=null};this.layers.on("after-add",r=>e(r.item)),this.layers.on("after-remove",r=>i(r.item))}initialize(){this.when().catch(t=>{oe.getLogger(this.declaredClass).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)e.destroy();this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set layers(t){this._set("layers",Rx(t,this._get("layers")))}writeLayers(t,e,i,r){const s=[];t&&(r={...r,layerContainerType:"ground"},t.forEach(n=>{if("write"in n){const o={};tqe(n)().write(o,r)&&s.push(o)}else r&&r.messages&&r.messages.push(new W("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),e.layers=s}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return NTe(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:i}=await ee(()=>import("./ElevationQuery-6d1517f0.js"),[],import.meta.url);gi(e);const r=new i,s=this.layers.filter($oe).toArray();return r.queryAll(s,t,e)}async createElevationSampler(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:i}=await ee(()=>import("./ElevationQuery-6d1517f0.js"),[],import.meta.url);gi(e);const r=new i,s=this.layers.filter($oe).toArray();return r.createSamplerAll(s,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:ae(this.surfaceColor),navigationConstraint:ae(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new hq({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}_loadLayersFromJSON(t,e,i){const r=e&&e.origin||"web-scene",s=e&&e.portal||null,n=e&&e.url||null;return ee(()=>import("./layersCreator-9c655cbd.js"),["./layersCreator-9c655cbd.js","./lazyLayerLoader-528f9864.js","./portalLayers-8237783e.js","./layersLoader-d22a3cce.js","./fetchService-590f6092.js","./jsonContext-ab2114a6.js"],import.meta.url).then(({populateOperationalLayers:o})=>{gi(i);const a=[];if(t.layers&&Array.isArray(t.layers)){const l={context:{origin:r,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,t.layers,l))}return lc(a)}).then(()=>{})}};function BQe(t){return t&&"createElevationSampler"in t}function $oe(t){return t.type==="elevation"||BQe(t)}u([d({json:{read:!1}})],jf.prototype,"layers",null),u([lt("layers")],jf.prototype,"writeLayers",null),u([d({readOnly:!0})],jf.prototype,"resourceInfo",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Yr,read:{reader:V3,source:"transparency"},write:{writer:(t,e)=>{e.transparency=Q6(t)},target:"transparency"}}})],jf.prototype,"opacity",void 0),u([d({type:Boolean,nonNullable:!0,json:{read:!1}})],jf.prototype,"shading",void 0),u([d({type:ot,json:{type:[Yr],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],jf.prototype,"surfaceColor",void 0),u([d({type:aF,json:{write:!0}})],jf.prototype,"navigationConstraint",void 0),jf=hq=u([I("esri.Ground")],jf);const d5=jf;let dS=class extends Nt{constructor(e){super(e),this.getCollections=null}initialize(){this.own(Nme(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=v(this.getCollections)?this.getCollections():null;if(C(e))return void this.removeAll();let i=0;for(const r of e)v(r)&&(i=this._processCollection(i,r));this.splice(i,this.length)}_createNewInstance(e){return new Nt(e)}_processCollection(e,i){if(!i)return e;const r=this.itemFilterFunction?this.itemFilterFunction:s=>!!s;for(const s of i)if(s){if(r(s)){const n=this.indexOf(s,e);n>=0?n!==e&&this.reorder(s,e):this.add(s,e),++e}if(this.getChildrenFunction){const n=this.getChildrenFunction(s);if(Array.isArray(n))for(const o of n)e=this._processCollection(e,o);else e=this._processCollection(e,n)}}return e}};u([d()],dS.prototype,"getCollections",void 0),u([d()],dS.prototype,"getChildrenFunction",void 0),u([d()],dS.prototype,"itemFilterFunction",void 0),dS=u([I("esri.core.CollectionFlattener")],dS);const TC=dS;function zQe(t){var e,i;return!(!(t!=null&&t.loaded)||!((i=(e=zve(t))==null?void 0:e.operations)!=null&&i.supportsEditing)||"editingEnabled"in t&&!i9e(t))}const Loe=oe.getLogger("esri.support.basemapUtils");function GQe(){return{}}function jQe(t){for(const e in t){const i=t[e];(i==null?void 0:i.destroyed)===!1&&i.destroy(),delete t[e]}}function HQe(t,e){let i;if(typeof t=="string"){if(!(t in cq)){const r=Object.entries(cq).filter(([s,n])=>ar.apiKey&&!n.classic||!ar.apiKey&&n.classic&&!n.deprecated).map(([s])=>`"${s}"`).join(", ");return Loe.warn(`Unable to find basemap definition for: ${t}. Try one of these: ${r}`),null}e&&(i=e[t]),i||(i=h5.fromId(t),e&&(e[t]=i))}else i=mn(h5,t);return i!=null&&i.destroyed&&(Loe.warn("The provided basemap is already destroyed",{basemap:i}),i=null),i}function qQe(t){return new TC({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const i=[];return"tables"in e&&i.push(e.tables),"layers"in e&&i.push(e.layers),i},itemFilterFunction:e=>{const i=e.parent;return!!i&&"tables"in i&&i.tables.includes(e)}})}const Doe={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function WQe(t){let e=null;if(typeof t=="string")if(t in Doe){const i=Doe[t];e=new d5({resourceInfo:{data:{layers:[i]}}})}else oe.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=mn(d5,t);return e}function dq(t,e,i){let r,s;if(t)for(let n=0,o=t.length;n<o;n++){if(r=t.getItemAt(n),r[e]===i)return r;if((r==null?void 0:r.type)==="group"&&(s=dq(r.layers,e,i),s))return s}}const XQe=t=>{let e=class extends t{constructor(...i){super(...i),this.layers=new Nt;const r=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},s=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||oe.getLogger(this.declaredClass).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},n=o=>{o.parent=null,this.layerRemoved(o)};this.layers.on("before-add",o=>r(o.item)),this.layers.on("after-add",o=>s(o.item)),this.layers.on("after-remove",o=>n(o.item))}destroy(){const i=this.layers.removeAll();for(const r of i)this.layerRemoved(r),r.destroy();this.layers.destroy()}set layers(i){this._set("layers",Rx(i,this._get("layers")))}add(i,r){const s=this.layers;if(r=s.getNextIndex(r),i instanceof i5){const n=i;n.parent===this?this.reorder(n,r):s.add(n,r)}else su(i)?i.then(n=>{this.destroyed||this.add(n,r)}):oe.getLogger(this.declaredClass).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(i,r){const s=this.layers;let n=s.getNextIndex(r);i.slice().forEach(o=>{o.parent!==this?(s.add(o,n),n+=1):this.reorder(o,n)})}findLayerById(i){return dq(this.layers,"id",i)}findLayerByUid(i){return dq(this.layers,"uid",i)}remove(i){return this.layers.remove(i)}removeMany(i){return this.layers.removeMany(i)}removeAll(){return this.layers.removeAll()}reorder(i,r){return this.layers.reorder(i,r)}layerAdded(i){}layerRemoved(i){}};return u([d()],e.prototype,"layers",null),e=u([I("esri.support.LayersMixin")],e),e};function pq(t,e,i){if(t)for(let r=0,s=t.length;r<s;r++){const n=t.getItemAt(r);if(n[e]===i)return n;if((n==null?void 0:n.type)==="group"){const o=pq(n.tables,e,i);if(o)return o}}}const YQe=t=>{let e=class extends t{constructor(...i){super(...i),this.tables=new Nt,this.tables.on("after-add",r=>{const s=r.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,s.type!=="feature"&&oe.getLogger(this.declaredClass).error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",r=>{r.item.parent=null})}destroy(){const i=this.tables.removeAll();for(const r of i)r.destroy();this.tables.destroy()}set tables(i){this._set("tables",Rx(i,this._get("tables")))}findTableById(i){return pq(this.tables,"id",i)}findTableByUid(i){return pq(this.tables,"uid",i)}};return u([d()],e.prototype,"tables",null),e=u([I("esri.support.TablesMixin")],e),e};let Hf=class extends YQe(XQe(As.EventedMixin($e))){constructor(e){super(e),this.allLayers=new TC({getCollections:()=>{var i,r,s;return[(i=this.basemap)==null?void 0:i.baseLayers,(r=this.ground)==null?void 0:r.layers,this.layers,(s=this.basemap)==null?void 0:s.referenceLayers]},getChildrenFunction:i=>"layers"in i?i.layers:null}),this.allTables=qQe(this),this.basemap=null,this.editableLayers=new TC({getCollections:()=>[this.allLayers],itemFilterFunction:zQe}),this.ground=new d5,this._basemapCache=GQe()}destroy(){var e,i;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),(e=this.ground)==null||e.destroy(),(i=this.basemap)==null||i.destroy(),jQe(this._basemapCache),this._basemapCache=null}castBasemap(e){return HQe(e,this._basemapCache)}castGround(e){const i=WQe(e);return C(i)?this._get("ground"):i}findLayerById(e){return this.allLayers.find(i=>i.id===e)}findTableById(e){return this.allTables.find(i=>i.id===e)}};u([d({readOnly:!0,dependsOn:[]})],Hf.prototype,"allLayers",void 0),u([d({readOnly:!0})],Hf.prototype,"allTables",void 0),u([d({type:h5})],Hf.prototype,"basemap",void 0),u([wi("basemap")],Hf.prototype,"castBasemap",null),u([d({readOnly:!0})],Hf.prototype,"editableLayers",void 0),u([d({type:d5,nonNullable:!0})],Hf.prototype,"ground",void 0),u([wi("ground")],Hf.prototype,"castGround",null),Hf=u([I("esri.Map")],Hf);const UTe=Hf;let JM=class extends $M{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};u([mZ({Type:ha,ensureType:mn(ha)})],JM.prototype,"itemType",void 0),JM=u([I("esri.support.GraphicsCollection")],JM);let N_=class extends $e{constructor(e){super(e),this.view=null,this.baseLayerViews=new Nt,this.referenceLayerViews=new Nt,this._loadingHandle=re(()=>{var i,r;return(r=(i=this.view)==null?void 0:i.map)==null?void 0:r.basemap},i=>{i&&i.load().catch(()=>{})},Zt)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}get suspended(){return!this.view||this.view.suspended}get updating(){var i,r;if(this.view&&this.view.suspended)return!1;const e=(r=(i=this.view)==null?void 0:i.map)==null?void 0:r.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(s=>s.updating)||this.referenceLayerViews.some(s=>s.updating))}};u([d({constructOnly:!0})],N_.prototype,"view",void 0),u([d({readOnly:!0})],N_.prototype,"baseLayerViews",void 0),u([d({readOnly:!0})],N_.prototype,"referenceLayerViews",void 0),u([d({readOnly:!0})],N_.prototype,"suspended",null),u([d({type:Boolean,readOnly:!0})],N_.prototype,"updating",null),N_=u([I("esri.views.BasemapView")],N_);function ZQe(t){return"tryRecycleWith"in t}let JQe=class{constructor(e,i,r){this.layer=e,this.view=i,this.layerViewImporter=r,this._controller=new AbortController,this._deferred=ky(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,ca(this._controller.signal,()=>{const s=new W("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(s)})}tryRecycle(e){if(!this.done||!this.layerView||!ZQe(this.layerView))return null;const i=this.layer.type,r=this._controller.signal;for(let s=0;s<e.length;s++){const n=e[s];if(n.type!==i)continue;const o=this.layerView.tryRecycleWith(n,{signal:r});if(o){e.splice(s,1),this.layer=n;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(gi(this._controller.signal),n.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),n.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,h)=>ca(this._controller.signal,()=>h(Bi())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(!e)return;const{layer:i,view:r}=this;i.emit("layerview-destroy",{view:r,layerView:e}),r.emit("layerview-destroy",{layer:i,layerView:e}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){var s,n,o;if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:i,view:r}=this;this._map=r.map;try{let a,l;if(await i.load({signal:e}),"prefetchResources"in i&&await((s=i.prefetchResources)==null?void 0:s.call(i,{signal:e})),QQe(i))a=await i.createLayerView(r,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(i))throw new W("layer:view-not-supported","No layerview implementation was found");const p=await this.layerViewImporter.importLayerView(i);gi(e),a="default"in p?new p.default({layer:i,view:r}):new p({layer:i,view:r})}const c=()=>{l=Rr(l),a.destroyed||a.destroy(),a.layer=null,a.parent=null,a.view=null,this.done=!0};l=ca(e,c),gi(e);try{await a.when()}catch(p){throw c(),p}if(!((o=(n=this._map)==null?void 0:n.allLayers)==null?void 0:o.includes(i)))return c(),void this._deferred.reject(new W("view:no-layerview-for-layer","The layer has been removed from the map",{layer:i}));this.layerView=a,i.emit("layerview-create",{view:r,layerView:a}),r.emit("layerview-create",{layer:i,layerView:a}),this.done=!0,this._deferred.resolve(a)}catch(a){i.emit("layerview-create-error",{view:r,error:a}),r.emit("layerview-create-error",{layer:i,error:a}),this.done=!0,this._deferred.reject(new W("layerview:create-error","layerview creation failed",{layer:i,error:a}))}}},Rh=class extends $e{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new Cm,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var r;const i=(r=this.view.map)==null?void 0:r.allLayers;if(i)for(const s of i)this.layerViewImporter.hasLayerViewModule(s)&&this.layerViewImporter.importLayerView(s)},this._reschedule=()=>(C(this._workPromise)&&(this._workPromise=ky(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(rT(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var l,c,h;const i=this.view.map;if(this._map!==i&&(this.clear(),this._map=i),C(this._workPromise))return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const r=new Set,s=[],n=this.view.ready,o=p=>{if(!C(p)){for(const f of p)if(f){r.add(f);const m=this._layerLayerViewInfoMap.get(f);m&&n?m.start():m||this._recyclingInfoMap.has(f)||s.push(f),"layers"in f&&f.layers&&o(f.layers)}}};for(const p of this._rootCollectionNames)o(this.get(p));for(const[p,f]of this._layerLayerViewInfoMap)if(!r.has(p)){this._layerLayerViewInfoMap.delete(f.layer);const m=f.tryRecycle(s);m?(this._recyclingInfoMap.set(f.layer,f),m.then(()=>{this._recyclingInfoMap.delete(f.layer),this._layerLayerViewInfoMap.set(f.layer,f),this._reschedule()}).catch(()=>{this._recyclingInfoMap.delete(f.layer),f.destroy(),this._reschedule()})):f.destroy()}for(const[p,f]of this._recyclingInfoMap)r.has(p)||(this._recyclingInfoMap.delete(f.layer),f.destroy());for(const p of s)this._createLayerView(p);this._refreshCollections();const a=[(l=i==null?void 0:i.ground)==null?void 0:l.layers,(c=i==null?void 0:i.basemap)==null?void 0:c.baseLayers,(h=i==null?void 0:i.basemap)==null?void 0:h.referenceLayers,i==null?void 0:i.layers].filter(p=>!!p);r.forEach(p=>"layers"in p&&a.push(p.layers)),this.addHandles(a.map(p=>this._watchUpdatingTracking.addOnCollectionChange(()=>p,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.own([pn(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),re(()=>{const e=this.view,i=e==null?void 0:e.map;return[i==null?void 0:i.basemap,i==null?void 0:i.ground,i==null?void 0:i.layers,e==null?void 0:e.ready]},()=>this._reschedule(),Br)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null,v(this._workPromise)&&(this._workPromise.reject(Bi()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return v(this._workPromise)||this._watchUpdatingTracking.updating||Vo(this._layerLayerViewInfoMap,e=>!e.done)}get updatingRemaining(){let e=0;for(const i of this._layerLayerViewInfoMap.values())i.done||++e;return e}clear(){if(!this.destroyed){for(const e of this._layerLayerViewInfoMap.values())e.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new W("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,i]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(i),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,i,r){if(!e||!i)return void(i&&i.removeAll());let s=0;for(const n of e){const o=this._layerLayerViewInfoMap.get(n);if(!o||!o.layerView)continue;const a=o.layerView;a.layer=n,a.parent=r,i.getItemAt(s)!==a&&i.splice(s,0,a),n.layers&&this._populateLayerViewsOwners(n.layers,a.layerViews,a),s+=1}s<i.length&&i.splice(s,i.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const i=new JQe(e,this.view,this.layerViewImporter);i.promise.then(()=>this._refreshCollections(),r=>{r&&(ln(r)||r.name==="cancelled:layerview-create")||oe.getLogger(this.declaredClass).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:r}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,i),this.view.ready&&i.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};u([d()],Rh.prototype,"_workPromise",void 0),u([d({readOnly:!0})],Rh.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0})],Rh.prototype,"_layersToLayerViews",null),u([d({readOnly:!0})],Rh.prototype,"_rootCollectionNames",null),u([d()],Rh.prototype,"layerViewImporter",void 0),u([d()],Rh.prototype,"supportsGround",void 0),u([d({readOnly:!0})],Rh.prototype,"updating",null),u([d({readOnly:!0})],Rh.prototype,"updatingRemaining",null),u([d({constructOnly:!0})],Rh.prototype,"view",void 0),Rh=u([I("esri.views.LayerViewManager")],Rh);const KQe=Rh;function QQe(t){return"createLayerView"in t&&t.createLayerView!=null}let Tu=class extends $e{constructor(e){super(e),this.factor=1.5,this.offset=Ra(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};u([d({type:Number})],Tu.prototype,"factor",void 0),u([d({nonNullable:!0})],Tu.prototype,"offset",void 0),u([d()],Tu.prototype,"position",void 0),u([d({type:Number,range:{min:0}})],Tu.prototype,"size",void 0),u([d()],Tu.prototype,"maskUrl",void 0),u([d()],Tu.prototype,"maskEnabled",void 0),u([d()],Tu.prototype,"overlayUrl",void 0),u([d()],Tu.prototype,"overlayEnabled",void 0),u([d({readOnly:!0})],Tu.prototype,"version",null),u([d({type:Boolean})],Tu.prototype,"visible",void 0),Tu=u([I("esri.views.Magnifier")],Tu);const VTe=Tu;let eet=class{constructor(){this._tasks=new Array,this._running=new u5(!1)}get length(){return this._tasks.length}get running(){return this._running.get()}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,i,r){return this._running.set(!0),new Promise((s,n)=>this._tasks.push(new Noe(s,n,e,i,r)))}unshift(e,i,r){return this._running.set(!0),new Promise((s,n)=>this._tasks.unshift(new Noe(s,n,e,i,r)))}_process(e){var r;if(this._tasks.length===0)return!1;const i=this._tasks.shift();try{const s=qn(i.signal);if(s&&!i.abortCallback)i.reject(Bi());else{const n=s?(r=i.abortCallback)==null?void 0:r.call(i,Bi()):i.callback(e);su(n)?n.then(i.resolve,i.reject):i.resolve(n)}}catch(s){i.reject(s)}return this._running.set(this._tasks.length>0),!0}cancelAll(){const e=Bi();for(const i of this._tasks)if(i.abortCallback){const r=i.abortCallback(e);i.resolve(r)}else i.reject(e);this._tasks.length=0,this._running.set(!1)}},Noe=class{constructor(e,i,r,s,n){this.resolve=e,this.reject=i,this.callback=r,this.signal=s,this.abortCallback=n}},UR=class extends $e{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};u([d()],UR.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),u([d()],UR.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),UR=u([I("esri.views.support.DebugFlags")],UR);const tet=new UR;var Mi;(function(t){t[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE"})(Mi||(Mi={}));function iet(){return new p5.Scheduler}var ua,Rt;(function(t){t[t.YIELD=1]="YIELD"})(ua||(ua={})),function(t){t.RESOURCE_CONTROLLER_IMMEDIATE="immediate",t.RESOURCE_CONTROLLER="schedule",t.SLIDE="slide",t.STREAM_DATA_LOADER="stream loader",t.ELEVATION_QUERY="elevation query",t.TERRAIN_SURFACE="terrain",t.SURFACE_GEOMETRY_UPDATES="surface geometry updates",t.LOD_RENDERER="LoD renderer",t.GRAPHICS_CORE="Graphics3D",t.I3S_CONTROLLER="I3S",t.POINT_CLOUD_LAYER="point cloud",t.FEATURE_TILE_FETCHER="feature fetcher",t.OVERLAY="overlay",t.STAGE="stage",t.GRAPHICS_DECONFLICTOR="graphics deconflictor",t.FILTER_VISIBILITY="Graphics3D filter visibility",t.SCALE_VISIBILITY="Graphics3D scale visibility",t.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",t.POINT_OF_INTEREST_FREQUENT="POI frequent",t.POINT_OF_INTEREST_INFREQUENT="POI infrequent",t.LABELER="labeler",t.FEATURE_QUERY_ENGINE="feature query",t.FEATURE_TILE_TREE="feature tile tree",t.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",t.ELEVATION_ALIGNMENT="elevation alignment",t.TEXT_TEXTURE_ATLAS="text texture atlas",t.TEXTURE_UNLOAD="texture unload",t.LINE_OF_SIGHT_TOOL="line of sight tool",t.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",t.ELEVATION_PROFILE="elevation profile",t.SNAPPING="snapping",t.SHADOW_ACCUMULATOR="shadow accumulator",t.CLOUDS_GENERATOR="clouds generator",t[t.TEST_PRIO=1]="TEST_PRIO"}(Rt||(Rt={}));const am=0,Foe=new Map([[Rt.RESOURCE_CONTROLLER_IMMEDIATE,am],[Rt.RESOURCE_CONTROLLER,4],[Rt.SLIDE,am],[Rt.STREAM_DATA_LOADER,am],[Rt.ELEVATION_QUERY,am],[Rt.TERRAIN_SURFACE,1],[Rt.SURFACE_GEOMETRY_UPDATES,1],[Rt.LOD_RENDERER,2],[Rt.GRAPHICS_CORE,2],[Rt.I3S_CONTROLLER,2],[Rt.POINT_CLOUD_LAYER,2],[Rt.FEATURE_TILE_FETCHER,2],[Rt.OVERLAY,4],[Rt.STAGE,4],[Rt.GRAPHICS_DECONFLICTOR,4],[Rt.FILTER_VISIBILITY,4],[Rt.SCALE_VISIBILITY,4],[Rt.FRUSTUM_VISIBILITY,4],[Rt.CLOUDS_GENERATOR,4],[Rt.POINT_OF_INTEREST_FREQUENT,6],[Rt.POINT_OF_INTEREST_INFREQUENT,30],[Rt.LABELER,8],[Rt.FEATURE_QUERY_ENGINE,8],[Rt.FEATURE_TILE_TREE,16],[Rt.FEATURE_TILE_TREE_ACTIVE,am],[Rt.ELEVATION_ALIGNMENT,12],[Rt.TEXT_TEXTURE_ATLAS,12],[Rt.TEXTURE_UNLOAD,12],[Rt.LINE_OF_SIGHT_TOOL,16],[Rt.LINE_OF_SIGHT_TOOL_INTERACTIVE,am],[Rt.SNAPPING,am],[Rt.SHADOW_ACCUMULATOR,30]]);function Uoe(t){return Foe.has(t)?Foe.get(t):typeof t=="number"?t:1}const Voe=6.5,koe=1,ret=30,Boe=1e3/30,zoe=100,Goe=.9;var p5,D1;(function(t){class e{get updating(){return this._updating.get()}_updatingChanged(){this._updating.set(this._tasks.some(n=>n.needsUpdate))}constructor(){this._updating=new u5(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new vy("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=Mi.INTERACTING,this._tasks=new li,this._runQueue=new li,this._load=0,this._idleStateCallbacks=new li,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=re(()=>tet.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,Zt);for(const o of Object.keys(Rt))this.performanceInfo.tasks.set(Rt[o],new vy(Rt[o]));const n=this;this._test={FRAME_SAFETY_BUDGET:Voe,INTERACTING_BUDGET:Boe,IDLE_BUDGET:zoe,get availableBudget(){return n._budget.budget},usedBudget:0,getBudget:()=>n._budget,setBudget:o=>n._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(n=>n.remove()),this._tasks.clear(),Rr(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(n){this._updatingChanged(),n&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(n,o){const a=Uoe(n),l=new i(this,n,o,a);return this._tasks.push(l),this._updatingChanged(),this.performanceInfo.tasks.has(n)||this.performanceInfo.tasks.set(n,new vy(n)),l}registerIdleStateCallbacks(n,o){const a={idleBegin:n,idleEnd:o};this._idleStateCallbacks.push(a),this.state===Mi.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===Mi.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(n){this._state!==n&&(this._state=n,this.state!==Mi.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}updateBudget(n){this._test.usedBudget=0,++this._frameNumber;let o=Voe,a=n.frameDuration,l=koe;switch(this.state){case Mi.IDLE:o=0,a=Math.max(zoe,n.frameDuration),l=ret;break;case Mi.INTERACTING:a=Math.max(Boe,n.frameDuration);case Mi.ANIMATING:}return a=a-n.elapsedFrameTime-o,this.state!==Mi.IDLE&&a<koe&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case Mi.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(n=>n.idleBegin())),this._runIdle();break;case Mi.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(n){this._idleUpdatesStartFired&&n.idleEnd(),this._idleStateCallbacks.removeUnordered(n)}removeTask(n){this._tasks.removeUnordered(n),this._runQueue.removeUnordered(n),this._updatingChanged()}_updateTask(n){this._tasks.forAll(o=>{o.name===n&&o.setPriority(n)})}_getState(n){if(this._runQueue.some(a=>a.name===n))return D1.SCHEDULED;let o=D1.IDLE;return this._tasks.forAll(a=>{a.name===n&&a.needsUpdate&&(a.schedulePriority<=1?o=D1.READY:o!==D1.READY&&(o=D1.WAITING))}),o}_getRuntime(n){let o=0;return this._tasks.forAll(a=>{a.name===n&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(n=>n.runtime=0)}_getRunning(){const n=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&n.set(a.name,(n.get(a.name)||0)+1)}),n.size===0)return null;let o="";return n.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const n=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*Goe+n*(1-Goe)}_schedule(){for(this._runQueue.filterInPlace(n=>!!n.needsUpdate||(n.schedulePriority=n.basePriority,!1)),this._tasks.forAll(n=>{n.basePriority===am&&n.needsUpdate&&!this._runQueue.includes(n)&&n.blockFrame!==this._frameNumber&&this._runQueue.unshift(n)});this._runQueue.length===0;){let n=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==am&&a.blockFrame!==this._frameNumber&&(n=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!n)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const n=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const o=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)===ua.YIELD&&(a.blockFrame=this._frameNumber)}catch(c){oe.getLogger("esri.views.support.Scheduler").error(`Exception in task "${a.name}"`,c)}!this._budget.hasProgressed&&a.blockFrame!==this._frameNumber&&a.needsUpdate&&(a.name,Rt.I3S_CONTROLLER,a.blockFrame=this._frameNumber),a.schedulePriority=a.basePriority;const l=this._budget.now()-o;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._debug&&l>2*this._budget.budget&&console.log("Task",a.name,"used",l,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-n)}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-n)}_startFrameTaskTimes(){for(const n of Object.keys(Rt))this._frameTaskTimes.set(Rt[n],0)}_recordFrameTaskTimes(n){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).record(o)),this.performanceInfo.total.record(n)}get test(){return this._test}}t.Scheduler=e;class i{get task(){return this._task.get()}get updating(){return this._queue.running}constructor(n,o,a,l){this._scheduler=n,this.name=o,this._basePriority=l,this.blockFrame=0,this.runtime=0,this._queue=new eet,this._handles=new Ki,this.schedulePriority=this._basePriority,this._task=new u5(v(a)?a:this._queue),this._handles.add(qo(()=>this.task.running,c=>n.taskRunningChanged(c)))}remove(){this.processQueue(ll),this._scheduler.removeTask(this),this.schedule=SC.schedule,this.reschedule=SC.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(n){this.name=n;const o=Uoe(n);this._basePriority!==am&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(n){this.setPriority(n)}get needsUpdate(){return this.updating||this.task.running}schedule(n,o,a){return this._queue.push(n,o,a)}reschedule(n,o,a){return this._queue.unshift(n,o,a)}processQueue(n){this._queue.runTask(n)}}class r{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=Mi.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(n){return!this.done&&(n()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,o){this._begin=this.now(),this._budget=n,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}t.Budget=r})(p5||(p5={})),function(t){t.SCHEDULED="s",t.READY="r",t.WAITING="w",t.IDLE="i"}(D1||(D1={}));const ll=(()=>{const t=new p5.Budget;return t.enabled=!1,t})();let set=class{remove(){}processQueue(){}schedule(e,i,r){try{if(qn(i)){const s=Bi();return r?Promise.resolve(r(s)):Promise.reject(s)}return Qz(e(ll))}catch(s){return Promise.reject(s)}}reschedule(e,i,r){return this.schedule(e,i,r)}};const SC=new set;let YS=class extends $e{constructor(e,i){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(i==null?void 0:i.registerTask(Rt.TEXTURE_UNLOAD))??SC}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask.remove(),this._textureRequests.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests.clear()}get updating(){return this._frameTask.updating}fromData(e,i,r){const s=this.makeUid(e);let n=this._textureRequests.get(s);if(!n){const o=i();n={referenceCount:0,texture:o,textureAsync:null,abortController:null,onRemove:r},this._stage&&(this._stage.add(o),this._stage.loadImmediate(o)),this._textureRequests.set(s,n)}return n.referenceCount++,{uid:s,texture:n.texture,release:()=>this._release(s)}}_release(e){const i=this._textureRequests.get(e);i?(i.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),i.referenceCount--,i.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const i=this._textureRequests.get(e);!i||i.referenceCount>0||(this._releaseTextureRequest(i),this._textureRequests.delete(e))}_releaseTextureRequest(e){var i;e.onRemove&&e.onRemove(),e.texture?(i=this._stage)==null||i.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,i=null){return v(i)?`${e}.${i}px`:e}};u([d()],YS.prototype,"_frameTask",void 0),u([d()],YS.prototype,"updating",null),YS=u([I("esri.views.3d.support.TextureCollection")],YS);var joe;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"})(joe||(joe={}));const kTe=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],BTe={};function zTe(t){return!!BTe[t]}function net(t){for(const e of t)if(!zTe(e))return!1;return!0}kTe.forEach(t=>{BTe[t]=!0});let oet=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:i,priority:r},s)=>{var n;return(n=this.inputManager)==null?void 0:n.installHandlers(s,[i],r)})}disconnect(){this.inputManager&&this._handlers.forEach((e,i)=>{var r;return(r=this.inputManager)==null?void 0:r.uninstallHandlers(i)}),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,i,r,s){const n=Array.isArray(e)?e:e.split(",");if(!net(n))return n.some(zTe)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(i)?a=i:(o=i,a=[]),typeof r=="function"?o=r:s=r,s=s??Pm.DEFAULT;const l=this._createUniqueGroupName(),c=new aet(this.view,n,a,o);this._handlers.set(l,{handler:c,priority:s});for(const h of n){const p=this._handlerCounts.get(h)||0;this._handlerCounts.set(h,p+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),{remove:()=>this._removeHandler(l,n)}}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,i){if(this._handlers.has(e)){this._handlers.delete(e);for(const r of i){const s=this._handlerCounts.get(r);s===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",r):s===1?this._handlerCounts.delete(r):this._handlerCounts.set(r,s-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},aet=class extends Kr{constructor(e,i,r,s){super(!0),this._latestDragStart=void 0,this.view=e;for(const n of i)switch(n){case"click":this.registerIncoming("click",r,o=>s(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",r,o=>s(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",r,o=>s(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",r,o=>s(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",r,o=>s(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",r,o=>{const a=this._wrapDrag(o);a&&s(a)});break;case"key-down":this.registerIncoming("key-down",r,o=>s(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",r,o=>s(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",r,o=>s(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",r,o=>s(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",r,o=>s(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",r,o=>s(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",r,o=>s(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",r,o=>s(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",r,o=>s(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",r,o=>{s(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",r,o=>{s(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",r,o=>{s(this._wrapBlur(o))})}}_wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:i=>e.async(i),preventDefault:()=>e.preventDefault()}}_wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:i=>e.async(i),preventDefault:()=>e.preventDefault()}}_wrapClick(e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:h,screenPoint:Ra(n,o),mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapDoubleClick(e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"double-click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:h,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapImmediateClick(e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:h,timestamp:p}=e;return{type:"immediate-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapImmediateDoubleClick(e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:h,timestamp:p}=e;return{type:"immediate-double-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapHold(e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"hold",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(n,o),cancelable:l,stopPropagation:()=>e.stopPropagation(),async:h=>e.async(h),preventDefault:()=>e.preventDefault()}}_getMapPoint(e,i){return this.view.toMap(Ra(e,i),{exclude:[]})}_wrapDrag(e){const i=e.data,{x:r,y:s}=i.center,{action:n,pointerType:o,button:a}=i;if(n==="start"&&(this._latestDragStart=i),!this._latestDragStart)return;const l=i.pointer.native,c=i.buttons,{cancelable:h,timestamp:p}=e,f={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return n==="end"&&(this._latestDragStart=void 0),{type:"drag",action:n,x:r,y:s,origin:f,pointerType:o,button:a,buttons:c,radius:i.radius,angle:yl(i.angle),native:l,timestamp:p,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapKeyDown(e){const{key:i,repeat:r,native:s}=e.data,{cancelable:n,timestamp:o}=e;return{type:"key-down",key:i,repeat:r,native:s,timestamp:o,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:a=>e.async(a),preventDefault:()=>e.preventDefault()}}_wrapKeyUp(e){const{key:i,native:r}=e.data,{cancelable:s,timestamp:n}=e;return{type:"key-up",key:i,native:r,timestamp:n,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:o=>e.async(o),preventDefault:()=>e.preventDefault()}}_wrapPointer(e,i){const{x:r,y:s,button:n,buttons:o,native:a,eventId:l}=e.data,c=a.pointerId,h=a.pointerType,{cancelable:p,timestamp:f}=e;return{type:i,x:r,y:s,pointerId:c,pointerType:h,button:n,buttons:o,native:a,timestamp:f,eventId:l,cancelable:p,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapPointerDrag(e){const{x:i,y:r,buttons:s,native:n,eventId:o}=e.data.currentEvent,{button:a}=e.data.startEvent,l=e.data.startEvent.native.pointerId,c=e.data.startEvent.native.pointerType,h=e.data.action,p={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:f,timestamp:m}=e;return{type:"pointer-drag",x:i,y:r,pointerId:l,pointerType:c,button:a,buttons:s,action:h,origin:p,native:n,timestamp:m,eventId:o,cancelable:f,stopPropagation:()=>e.stopPropagation(),async:y=>e.async(y),preventDefault:()=>e.preventDefault()}}_wrapMouseWheel(e){const{cancelable:i,data:r,timestamp:s}=e,{x:n,y:o,deltaY:a,native:l}=r;return{type:"mouse-wheel",x:n,y:o,deltaY:a,native:l,timestamp:s,cancelable:i,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}_wrapGamepad(e){const{action:i,state:r,device:s}=e.data,{cancelable:n,timestamp:o}=e,{buttons:a,axes:l}=r;return{type:"gamepad",device:s,timestamp:o,action:i,buttons:a,axes:l,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}};var rP,Hoe,qoe;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(rP||(rP={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(Hoe||(Hoe={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(qoe||(qoe={}));function cet(t){return[t.on("before-add",e=>{const i=e.item;if(i==null||t.includes(i))return oe.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();i.onAdd()}),t.on("after-remove",e=>{const i=e.item;i.active&&(i.view.activeTool=null),i.destroy()})]}function fq(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(rP.USER)&&t.getEditableFlag(rP.MANAGER)}function qf(t){return Ra(t.x,t.y)}function sLt(t){return ms(t.x,t.y)}function GTe(t,e){var r;const i=(r=t instanceof HTMLElement?t:t.surface)==null?void 0:r.getBoundingClientRect();return i?Ra(e.clientX-i.left,e.clientY-i.top):Ra(0,0)}function f5(t,e){return e instanceof Event?GTe(t,e):qf(e)}function m5(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let uet=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(e,i){const r=()=>e.stopPropagation();switch(e.type){case"pointer-move":Woe(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(r(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!Xoe(e))break;const s=qf(e),n=this._intersect(s,e.pointerType,i.forEachTool);if(C(n))break;const o=n.manipulator,a=n.tool;!(v(o)&&v(a)&&o.interactive)||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,e,i),v(o)&&v(a)&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:s,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&C(i.activeTool)&&(this._revertToNullActiveTool=!0,i.setActiveTool(n.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:s}),r());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,i);break;case"pointer-drag":{if(!Xoe(e))break;const s=this._grabbedManipulators.get(e.pointerId),n=go(s,({manipulator:h})=>h),o=go(s,({tool:h})=>h);if(C(n)||C(o))break;const a=qf(e);a.x=we(a.x,0,i.view.width),a.y=we(a.y,0,i.view.height);const l=s.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(n.dragging=!0,c?n.events.emit("drag",{action:"update",start:l,screenPoint:a}):n.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:o,manipulator:n,start:l}));break;case"end":n.dragging=!1,c&&n.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,i)}r();break}case"immediate-click":{const s=qf(e),n=this._intersect(s,e.pointerType,i.forEachTool);if(het(e)||i.forEachTool(c=>{if((!v(n)||n.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let h=!1;c.manipulators.forEach(({manipulator:p})=>{p.selected&&(p.selected=!1,h=!0)}),h&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),C(n))break;const{manipulator:o,tool:a}=n;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:r});break}case"click":{const s=qf(e),n=this._intersect(s,e.pointerType,i.forEachTool),o=v(n)?n.manipulator:null;if(C(o)||!o.interactive)break;const a=e.native.shiftKey;o.events.emit(e.type,{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a}),r();break}case"double-click":{const s=qf(e),n=this._intersect(s,e.pointerType,i.forEachTool),o=v(n)?n.manipulator:null;if(C(o)||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:r});break}case"immediate-double-click":{const s=qf(e),n=this._intersect(s,e.pointerType,i.forEachTool),o=v(n)?n.manipulator:null;if(C(o)||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:r});break}}this._onFocusChange(i.forEachTool)}_ungrabManipulatorBeforeDragging(e,i,r){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:i.pointerType,screenPoint:qf(i)}),this._grabbedManipulators.forEach(({manipulator:s},n)=>{s===e&&this._grabbedManipulators.delete(n)}),this._afterManipulatorUngrab(r.setActiveTool)}_handlePointerEnd(e,i){const r=go(this._grabbedManipulators.get(e.pointerId),({manipulator:s})=>s);C(r)||r.grabbing&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:qf(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorUngrab(i.setActiveTool))}_cursorFromMap(e){let i=null;return Vo(e,({manipulator:r})=>!(C(r)||!r.interactive)&&(r.grabbing&&r.grabCursor?(i=r.grabCursor,!0):!!r.cursor&&(i=r.cursor,!0))),i}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const i=new Set,r=new Set;this._grabbedManipulators.forEach(({tool:s})=>{i.add(s)}),this._hoveredManipulators.forEach(({tool:s})=>{r.add(s)}),e(s=>{s.hasGrabbedManipulators=i.has(s),s.hasHoveredManipulators=r.has(s);const n=this._grabbedManipulators.values(),o=ZLe(n,({tool:a})=>a===s);s.firstGrabbedManipulator=v(o)?o.manipulator:null})}clearPointers(e,{forEachTool:i,setActiveTool:r},s=!0,n){const o=(a,l)=>a===e&&(C(n)||n===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},h)=>{o(a,l)&&(this._grabbedManipulators.delete(h),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),s&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorUngrab(r),this._onFocusChange(i)}_intersect(e,i,r){let s=null;return r(n=>{if(n.manipulators==null||!fq(n))return!1;const o=n.manipulators.intersect(e,i);return!C(o)&&(s={tool:n,manipulator:o},!0)}),s}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((i,r)=>{this._updateHoveredStateForPointerAtScreenPosition(Ra(i.x,i.y),r,i.pointerType,e)})}handleHoverEvent(e,i){e.type!=="pointer-up"&&e.type!=="immediate-click"&&e.type!=="pointer-move"||!Woe(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(qf(e),e.pointerId,e.pointerType,i)}_updateHoveredStateForPointerAtScreenPosition(e,i,r,s){let n=this._intersect(e,r,s);const o=go(this._hoveredManipulators.get(i),({manipulator:a})=>a);v(n)&&!n.manipulator.interactive&&(n=null),v(n)&&o===n.manipulator||(v(o)&&(o.hovering=!1),v(n)?(n.manipulator.hovering=!0,this._hoveredManipulators.set(i,n)):this._hoveredManipulators.delete(i),this._onFocusChange(s))}_afterManipulatorUngrab(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}};function Woe(t){return t==="mouse"}function Xoe(t){return t.pointerType!=="mouse"||t.button===0}function het(t){return!!t.native.shiftKey}const Yoe="attached",Xk="tools";let Xg=class extends j3{constructor(e){super(e),this._manipulatorState=new uet,this.tools=new Nt,this.cursor=null,this._forEachTool=i=>{for(const r of this.tools.items)if(i(r))return}}initialize(){this.handles.add([this.view.on(kTe,e=>{this._handleInputEvent(e)},Pm.TOOL),...cet(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(v(e)&&!this.view.ready)return void oe.getLogger(this.declaredClass).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const i=this.activeTool;this._set("activeTool",e),v(i)&&i.deactivate(),v(e)&&e.activate(),this._removeIncompleteTools(e);for(const r of this.tools){this._updateToolEditableFlag(r);const s=fq(r);!C(this.activeTool)&&s||this._manipulatorState.clearPointers(r,this._manipulatorStateEventArgs,!s)}this._updateCursor()}get updating(){var e;return this.updatingHandles.updating||this.tools.some(i=>i.updating)||(((e=this.textures)==null?void 0:e.updating)??!1)}attach(){var e;this.view.type==="3d"?(this._set("textures",new YS(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([re(()=>{const{state:i}=this.view;return"camera"in i&&i.camera},()=>this._forEachManipulator(i=>i.onViewChange())),(e=this.view.elevationProvider)==null?void 0:e.on("elevation-change",i=>this._forEachManipulator(r=>r.onElevationChange(i))),Wp(()=>this._set("textures",Je(this.textures)))],Yoe)):this.handles.add(re(()=>this.view.extent,()=>this._forEachManipulator(i=>i.onViewChange())))}detach(){v(this.activeTool)&&(this.activeTool=null),this.tools.removeAll(),this.handles.remove(Yoe)}_forEachManipulator(e){this._forEachTool(i=>{i.manipulators&&i.manipulators.forEach(({manipulator:r})=>e(r,i))})}_handleInputEvent(e){let i=!1;const r={...e,stopPropagation:()=>{i=!0,e.stopPropagation()}};v(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(r):this._forEachTool(s=>{!i&&s.visible&&s.handleInputEvent(r)}),!i&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(r,this._manipulatorStateEventArgs),!i&&v(this.activeTool)&&this.activeTool.handleInputEventAfter(r),this._manipulatorState.handleHoverEvent(r,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this.handles.remove(Xk),this._forEachTool(e=>{if(e instanceof $e){const i=re(()=>[e.cursor,e.visible,e.editable],()=>{fq(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.handles.add(i,Xk)}e.manipulators&&this.handles.add([e.manipulators.on("after-remove",i=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,i.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],Xk)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){var i;(i=e.setEditableFlag)==null||i.call(e,rP.MANAGER,C(this.activeTool)||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;C(e)&&this._forEachTool(i=>!(!v(i.cursor)||!i.visible)&&(e=i.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(i=>(C(e)||i!==e)&&!i.created&&i.removeIncompleteOnCancel).forEach(i=>{this.tools.remove(i)})}};u([d({constructOnly:!0,nonNullable:!0})],Xg.prototype,"view",void 0),u([d({readOnly:!0,nonNullable:!0})],Xg.prototype,"textures",void 0),u([d({value:null})],Xg.prototype,"activeTool",null),u([d({readOnly:!0,type:Nt})],Xg.prototype,"tools",void 0),u([d({readOnly:!0})],Xg.prototype,"cursor",void 0),u([d({readOnly:!0})],Xg.prototype,"updating",null),Xg=u([I("esri.views.ToolViewManager")],Xg);const det=Xg;let pS=class extends $e{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":pet.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return fet[this.deviceType]}};u([d({nonNullable:!0,readOnly:!0})],pS.prototype,"nativeIndex",void 0),u([d({type:String,readOnly:!0})],pS.prototype,"deviceType",null),u([d({type:Number,readOnly:!0})],pS.prototype,"axisThreshold",null),pS=u([I("esri.views.input.gamepad.GamepadInputDevice")],pS);const pet=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),fet={standard:.15,spacemouse:.025,unknown:0},DK=pS;let VR=class extends $e{constructor(...e){super(...e),this.devices=new Nt,this.enabledFocusMode="document"}};u([d({type:Nt.ofType(DK),readOnly:!0})],VR.prototype,"devices",void 0),u([d({type:["document","view","none"]})],VR.prototype,"enabledFocusMode",void 0),VR=u([I("esri.views.input.gamepad.GamepadSettings")],VR);const met=VR;let lF=class extends $e{constructor(){super(...arguments),this.gamepad=new met}};u([d({readOnly:!0})],lF.prototype,"gamepad",void 0),lF=u([I("esri.views.input.Input")],lF);const get=lF;let F_=class extends $e{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};u([d({type:Boolean,nonNullable:!0})],F_.prototype,"enabled",void 0),u([d({type:DK})],F_.prototype,"device",void 0),u([d({type:["pan","zoom"],nonNullable:!0})],F_.prototype,"mode",void 0),u([d({type:["forward-down","forward-up"],nonNullable:!0})],F_.prototype,"tiltDirection",void 0),u([d({type:Number,nonNullable:!0})],F_.prototype,"velocityFactor",void 0),F_=u([I("esri.views.navigation.gamepad.GamepadSettings")],F_);const jTe=F_;let Qb=class extends $e{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new jTe,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};u([d({type:Boolean})],Qb.prototype,"browserTouchPanEnabled",void 0),u([d({type:jTe,nonNullable:!0})],Qb.prototype,"gamepad",void 0),u([d({type:Boolean})],Qb.prototype,"momentumEnabled",void 0),u([d({type:Boolean})],Qb.prototype,"mouseWheelZoomEnabled",void 0),Qb=u([I("esri.views.navigation.Navigation")],Qb);const HTe=Qb;function dLt(t,e,i){const r=qTe(t),s=e,n=yet(r,s,i);if(r){const o=iA.deriveUnitFromSR(r,t.spatialReference).heightUnit;if(!i&&o!==r.heightUnit){const a=new W("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new W("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r,error:a})}}if(!_et(t)||n===Fc.Unsupported)return new W("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r});switch(n){case Fc.Units:{const o=(r==null?void 0:r.heightUnit)||"unknown",a=(s==null?void 0:s.heightUnit)||"unknown",l=new W("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new W("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case Fc.HeightModel:{const o=(r==null?void 0:r.heightModel)||"unknown",a=(s==null?void 0:s.heightModel)||"unknown",l=new W("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new W("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case Fc.CRS:{const o=(r==null?void 0:r.vertCRS)||"unknown",a=(s==null?void 0:s.vertCRS)||"unknown",l=new W("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new W("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}}return null}function yet(t,e,i){if(!Zoe(t)||!Zoe(e))return Fc.Unsupported;if(t==null||e==null)return Fc.Ok;if(!i&&t.heightUnit!==e.heightUnit)return Fc.Units;if(t.heightModel!==e.heightModel)return Fc.HeightModel;switch(t.heightModel){case"gravity-related-height":return Fc.Ok;case"ellipsoidal":return t.vertCRS===e.vertCRS?Fc.Ok:Fc.CRS;default:return Fc.Unsupported}}var Fc;function Zoe(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function _et(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!YTe(t)}function qTe(t){var r;const e=t.url?hA(t.url):void 0;return!(((r=t.spatialReference)==null?void 0:r.vcsWkid)==null&&v(e)&&e.serverType==="ImageServer")&&WTe(t)&&t.heightModelInfo?t.heightModelInfo:YTe(t)?iA.deriveUnitFromSR(bet,t.spatialReference):null}function WTe(t){return"heightModelInfo"in t}function XTe(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function YTe(t){return XTe(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):ZTe(t)}function vet(t){return t.layers!=null||ZTe(t)||XTe(t)||WTe(t)}function ZTe(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(t){t[t.Ok=0]="Ok",t[t.Units=1]="Units",t[t.HeightModel=2]="HeightModel",t[t.CRS=3]="CRS",t[t.Unsupported=4]="Unsupported"})(Fc||(Fc={}));const bet=new iA({heightModel:"gravity-related-height"});var st;function Joe(t){return t==="global"?st.Global:st.Local}function Yk(t){return t===st.Global?"global":"local"}(function(t){t[t.Global=1]="Global",t[t.Local=2]="Local"})(st||(st={}));let mq,Zk=null;async function wet(t){Zk||(Zk=ee(()=>Promise.resolve().then(()=>Uvt),void 0,import.meta.url).then(e=>mq=e)),await Zk,gi(t)}async function JTe(t,e,i,r){if(!t)return null;const s=t.spatialReference;return Mx()||jm(s,e)?tg(t,e):mq?mq.projectGeometry(t,e,i,r):(await Promise.race([wet(r),Px(r)]),JTe(t,e,i,r))}let ss=class extends $e{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=hd(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return v(this.userSpatialReference)?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return C(this.userSpatialReference)||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var r,s,n,o;const e=(r=this.map)==null?void 0:r.call(this),i=[];return v(this.priorityCollection)&&i.push(this.priorityCollection),i.push({parent:e==null?void 0:e.basemap,layers:(s=e==null?void 0:e.basemap)==null?void 0:s.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(n=e==null?void 0:e.ground)==null?void 0:n.layers},{parent:e==null?void 0:e.basemap,layers:(o=e==null?void 0:e.basemap)==null?void 0:o.referenceLayers}),i}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:i}=this._allLayers;let r=null;for(const n of e){const o=this._getSupportedSpatialReferences(n);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(r,o);v(a)&&(r=a)}if(v(r)&&r.length===1)break}if(i&&(C(r)||r.length!==1))return{updating:!0};const s=this._pickSpatialReferenceCandidate(r);return{spatialReference:v(s)?s.spatialReference:null,viewingMode:v(s)?s.viewingMode:null,updating:!1}}get _tileInfoTask(){var r,s,n,o,a,l,c;if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:i}=this._collectLayers([{parent:(s=(r=this.map)==null?void 0:r.call(this))==null?void 0:s.basemap,layers:(a=(o=(n=this.map)==null?void 0:n.call(this))==null?void 0:o.basemap)==null?void 0:a.baseLayers},{layers:(c=(l=this.map)==null?void 0:l.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const h=e[0].tileInfo;return{tileInfo:h&&h.spatialReference.equals(this.spatialReference)?h:null,updating:!1}}return{updating:i}}get _heightModelInfoTask(){var r,s,n;if(!this.required.heightModelInfo||this.suspended&&((r=this._get("_heightModelInfoTask"))!=null&&r.heightModelInfo))return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:i}=this._allLayers;for(const o of e)if(vet(o)){const a=qTe(o);if(a)return{heightModelInfo:a,vcsWkid:(s=o.spatialReference)==null?void 0:s.vcsWkid,latestVcsWkid:(n=o.spatialReference)==null?void 0:n.latestVcsWkid,updating:!1}}return{updating:i}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,i=e.updating,r=[];for(const s of e.layers){const n="fullExtents"in s&&s.fullExtents||(v(s.fullExtent)?[s.fullExtent]:[]),o=this.requiresExtentInSpatialReference?null:n[0],a=n.find(l=>l.spatialReference.equals(this.spatialReference))??o;if(a)return{candidates:[{extent:a,layer:s}],updating:!1};if(this._getSupportedSpatialReferences(s).length>0)for(const l of n)r.push({extent:l,layer:s})}return{candidates:r,updating:i}}get _extentTask(){const{candidates:e,updating:i}=this._extentCandidatesTask;if(i)return{updating:i};if(C(e)||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const r=this._pickExtentCandidate(e),s=this.spatialReference;return r.extent.equals(this._projectExtentTask.input)&&s.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:v(this._projectExtentTask.task)&&!this._projectExtentTask.task.finished}:(v(this._projectExtentTask.task)&&(this._projectExtentTask.task=hd(this._projectExtentTask.task)),this._projectExtentTask={input:r.extent.clone(),output:null,spatialReference:s.clone(),task:uI(async n=>{try{const o=await JTe(r.extent,s,r.layer.portalItem,n);this._projectExtentTask={...this._projectExtentTask,task:null,output:o}}catch{if(qn(n))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,i){if(C(e))return i;const r=[],s=(n,o)=>v(n)?v(o)?n===o&&n:n:o;for(const n of e)for(const o of i){if(!n.spatialReference.equals(o.spatialReference))continue;const a=s(n.viewingMode,o.viewingMode);if(a!==!1){r.push({spatialReference:n.spatialReference,viewingMode:a});break}}return r.length>0?r:null}_pickSpatialReferenceCandidate(e){const i=this.defaultSpatialReference;return C(e)||e.length<1?v(i)?{spatialReference:i,viewingMode:null}:null:(v(i)&&e.length>1&&e.some(({spatialReference:r})=>r.equals(i))&&(e=e.filter(({spatialReference:r})=>r.equals(i))),e.length>1&&e.some(({viewingMode:r})=>r!==st.Local)&&(e=e.filter(({viewingMode:r})=>r!==st.Local)),e[0])}_getSupportedSpatialReferences(e){const i="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(i.length===0)return[];const r=[];for(const s of i){const n=this.getSpatialReferenceSupport({spatialReference:s,layer:e});if(v(n)){const o=v(n.constraints)?n.constraints:[{spatialReference:s,viewingMode:null}];for(const{spatialReference:a,viewingMode:l}of o)(!this.requiresExtentInSpatialReference||C(this.userSpatialReference)||a.equals(this.userSpatialReference))&&r.push({spatialReference:a,viewingMode:l})}}return r}_pickExtentCandidate(e){const i=this.spatialReference;return e.find(({extent:r})=>i.equals(r.spatialReference))||e[0]}_collectLayers(e){var r;if(this._loadMaybe((r=this.map)==null?void 0:r.call(this))!=="loaded")return{layers:[],updating:!0};const i={layers:[],preloading:-1,updating:!1};for(const s of e)if(this._collectCollection(s,i),i.preloading===this.sourcePreloadCount)break;return{layers:i.layers,updating:i.updating}}_collectCollection(e,i){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return i.updating=!0,void++i.preloading;case"failed":return}for(const r of e.layers){switch(this._loadMaybe(r)){case"failed":continue;case"loading":i.updating=!0,++i.preloading;break;case"loaded":i.updating||i.layers.push(r),"layers"in r&&this._collectCollection({layers:r.layers},i)}if(i.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(()=>{}),"loading"):e.loadStatus:"loaded"}};u([d()],ss.prototype,"required",void 0),u([d({constructOnly:!0})],ss.prototype,"map",void 0),u([d({constructOnly:!0})],ss.prototype,"getSpatialReferenceSupport",void 0),u([d()],ss.prototype,"defaultSpatialReference",void 0),u([d()],ss.prototype,"userSpatialReference",void 0),u([d()],ss.prototype,"sourcePreloadCount",void 0),u([d()],ss.prototype,"priorityCollection",void 0),u([d()],ss.prototype,"requiresExtentInSpatialReference",void 0),u([d()],ss.prototype,"suspended",void 0),u([d({readOnly:!0})],ss.prototype,"ready",null),u([d({readOnly:!0})],ss.prototype,"heightModelInfoReady",null),u([d({readOnly:!0})],ss.prototype,"spatialReference",null),u([d({readOnly:!0})],ss.prototype,"extent",null),u([d({readOnly:!0})],ss.prototype,"heightModelInfo",null),u([d({readOnly:!0})],ss.prototype,"vcsWkid",null),u([d({readOnly:!0})],ss.prototype,"latestVcsWkid",null),u([d({readOnly:!0})],ss.prototype,"viewingMode",null),u([d({readOnly:!0})],ss.prototype,"tileInfo",null),u([d({readOnly:!0})],ss.prototype,"mapCollections",null),u([d({readOnly:!0})],ss.prototype,"_allLayers",null),u([d({readOnly:!0})],ss.prototype,"_spatialReferenceTask",null),u([d({readOnly:!0})],ss.prototype,"_tileInfoTask",null),u([d({readOnly:!0})],ss.prototype,"_heightModelInfoTask",null),u([d({readOnly:!0})],ss.prototype,"_extentCandidatesTask",null),u([d()],ss.prototype,"_extentTask",null),u([d()],ss.prototype,"_projectExtentTask",void 0),ss=u([I("esri.views.support.DefaultsFromMap")],ss);var cF;let Kt=cF=class extends uT(As.EventedMixin(oU($e))){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new TC({getCollections:()=>{var e,i,r;return[(e=this.basemapView)==null?void 0:e.baseLayerViews,(i=this.groundView)==null?void 0:i.layerViews,this.layerViews,(r=this.basemapView)==null?void 0:r.referenceLayerViews]},getChildrenFunction:e=>e.layerViews}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new JM,this.analyses=new mC,this.typeSpecificPreconditionsReady=!0,this.layerViews=new Nt,this.magnifier=new VTe,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.timeReference=new xC,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new get,this.navigation=new HTe,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new oet(this),this.persistableViewModels=new Nt,this._isValid=!1,this._readyCycleForced=!1,this._currentSpatialReference=null,this.handles.add(re(()=>this.preconditionsReady,e=>{var i,r;e?(this._currentSpatialReference=this.spatialReference,cF.views.add(this)):(this._currentSpatialReference=null,cF.views.remove(this)),this.notifyChange("spatialReference"),!e&&this.ready?((i=this.toolViewManager)==null||i.detach(),v(this.analysisViewManager)&&this.analysisViewManager.detach(),(r=this.layerViewManager)==null||r.clear(),this._teardown()):e&&!this.ready&&(this._startup(),v(this.analysisViewManager)&&this.analysisViewManager.attach(),this.toolViewManager.attach())},Wi))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,aC(()=>this.ready)))),this.basemapView=new N_({view:this}),this.layerViewManager=new KQe({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new det({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([re(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},{sync:!0,initial:!0}),re(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},{sync:!0}),re(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let t=null;this.handles.add([re(()=>{var e;return(e=this.defaultsFromMap)==null?void 0:e.ready},e=>{var r;const i=((r=this.map)==null?void 0:r.allLayers.length)>0;if(e&&!this.spatialReference&&i){if(v(t))return;const s=Wp(()=>t=hd(t));t=uI(async n=>{try{await _x(this.spatialReferenceWarningDelay,null,n)}catch{return}finally{t=null}oe.getLogger(this.declaredClass).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.handles.add(s,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=Je(this.graphics),this.analyses=Je(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),Je(this.analysisViewManager),this.toolViewManager=Je(this.toolViewManager),this.layerViewManager=Je(this.layerViewManager),this.basemapView=Je(this.basemapView),this.invalidate(),this._emitter.clear(),this.handles.removeAll();const t=this.map;this.map=null,t==null||t.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return oe.getLogger(this.declaredClass).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var t;return(t=this.toolViewManager)==null?void 0:t.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new ss({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:t=>this.getSpatialReferenceSupport(t),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var t;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||Hy.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!((t=this.defaultsFromMap)!=null&&t.ready)||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t!=null&&t.destroyed&&(oe.getLogger(this.declaredClass).warn("#map","The provided map is already destroyed",{map:t}),t=null),Hy.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",t))}get spatialReference(){var e,i;let t=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return t&&((i=(e=this.defaultsFromMap)==null?void 0:e.required)!=null&&i.heightModelInfo)&&(t=t.clone(),t.vcsWkid=this.defaultsFromMap.vcsWkid,t.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),t}set spatialReference(t){const e=!rn(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get tools(){var t;return(t=this.toolViewManager)==null?void 0:t.tools}get initialExtent(){var t;return(t=this.defaultsFromMap)==null?void 0:t.extent}get cursor(){const t=this.toolViewManager?this.toolViewManager.cursor:null;return v(t)?t:this._cursor||"default"}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(t){return this.layerViewManager.whenLayerView(t)}getDefaultSpatialReference(){var t;return(t=this.defaultsFromMap)==null?void 0:t.spatialReference}getDefaultHeightModelInfo(){var t;return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??((t=this.defaultsFromMap)==null?void 0:t.heightModelInfo)??null}importLayerView(t){throw new W("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return v(this.getSpatialReferenceSupport({spatialReference:t}))}when(t,e){return this.isResolved()&&!this.ready&&oe.getLogger(this.declaredClass).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&(qo(()=>this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};Kt.views=new Nt,u([d()],Kt.prototype,"_userSpatialReference",void 0),u([d()],Kt.prototype,"activeTool",null),u([d({readOnly:!0})],Kt.prototype,"allLayerViews",void 0),u([d()],Kt.prototype,"groundView",void 0),u([d()],Kt.prototype,"animation",null),u([d()],Kt.prototype,"basemapView",void 0),u([d()],Kt.prototype,"center",null),u([d({readOnly:!0})],Kt.prototype,"_defaultsFromMapSettings",null),u([d()],Kt.prototype,"defaultsFromMap",null),u([d()],Kt.prototype,"fatalError",void 0),u([d({type:Pi})],Kt.prototype,"extent",null),u([d(HG(JM,"graphics"))],Kt.prototype,"graphics",void 0),u([d(HG(mC,"analyses"))],Kt.prototype,"analyses",void 0),u([d({readOnly:!0,type:iA})],Kt.prototype,"heightModelInfo",null),u([d({readOnly:!0})],Kt.prototype,"interacting",null),u([d({readOnly:!0})],Kt.prototype,"navigating",null),u([d({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],Kt.prototype,"preconditionsReady",null),u([d({readOnly:!0})],Kt.prototype,"typeSpecificPreconditionsReady",void 0),u([d({type:Nt,readOnly:!0})],Kt.prototype,"layerViews",void 0),u([d()],Kt.prototype,"resolution",null),u([d({type:VTe})],Kt.prototype,"magnifier",void 0),u([d({value:null,type:UTe})],Kt.prototype,"map",null),u([d()],Kt.prototype,"padding",void 0),u([d({readOnly:!0})],Kt.prototype,"ready",void 0),u([d({type:mt})],Kt.prototype,"spatialReference",null),u([d()],Kt.prototype,"spatialReferenceWarningDelay",void 0),u([d()],Kt.prototype,"stationary",null),u([d({readOnly:!0})],Kt.prototype,"supportsGround",void 0),u([d({type:ig})],Kt.prototype,"timeExtent",void 0),u([d({type:xC,nonNullable:!0})],Kt.prototype,"timeReference",void 0),u([d()],Kt.prototype,"tools",null),u([d()],Kt.prototype,"toolViewManager",void 0),u([d({readOnly:!0})],Kt.prototype,"type",void 0),u([d({type:Number})],Kt.prototype,"scale",void 0),u([d({readOnly:!0})],Kt.prototype,"updating",void 0),u([d({readOnly:!0})],Kt.prototype,"initialExtentRequired",void 0),u([d({readOnly:!0})],Kt.prototype,"initialExtent",null),u([d()],Kt.prototype,"cursor",null),u([d({readOnly:!0})],Kt.prototype,"input",void 0),u([d({type:HTe,nonNullable:!0})],Kt.prototype,"navigation",void 0),u([d()],Kt.prototype,"layerViewManager",void 0),u([d()],Kt.prototype,"analysisViewManager",void 0),u([d()],Kt.prototype,"width",void 0),u([d()],Kt.prototype,"height",void 0),u([d({readOnly:!0})],Kt.prototype,"resizing",void 0),u([d({value:null,readOnly:!0})],Kt.prototype,"size",null),u([d({readOnly:!0})],Kt.prototype,"suspended",void 0),u([d({readOnly:!0})],Kt.prototype,"viewEvents",void 0),u([d({readOnly:!0})],Kt.prototype,"persistableViewModels",void 0),u([d()],Kt.prototype,"_isValid",void 0),u([d()],Kt.prototype,"_readyCycleForced",void 0),u([d()],Kt.prototype,"_currentSpatialReference",void 0),Kt=cF=u([I("esri.views.View")],Kt);const KTe=Kt;let U_=class extends M4{constructor(e){super(e),this.state="running",this.target=null,this._dfd=null}initialize(){this.addResolvingPromise(new Promise((e,i)=>this._dfd={resolve:e,reject:i}))}get done(){return this.state==="finished"||this.state==="stopped"}stop(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),(e=this._dfd)==null||e.reject(new W("ViewAnimation stopped")))}finish(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),(e=this._dfd)==null||e.resolve())}update(e,i){i||(i=su(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",i)}};u([d({readOnly:!0})],U_.prototype,"done",null),u([d({readOnly:!0,type:String})],U_.prototype,"state",void 0),u([d()],U_.prototype,"target",void 0),U_=u([I("esri.views.ViewAnimation")],U_),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(U_||(U_={}));const Yy=U_,eO=()=>ee(()=>import("./TileLayerView3D-14851f62.js"),["./TileLayerView3D-14851f62.js","./LayerView3D-3838457e.js","./TiledLayerView3D-4c7e8e34.js","./LayerView-7b372130.js","./RefreshableLayerView-cb757f22.js","./MapServiceLayerViewHelper-540289c1.js","./floorFilterUtils-080a7cd2.js","./sublayerUtils-01edef31.js","./popupUtils-8b1a1adb.js","./drapedUtils-11ce819c.js"],import.meta.url),Koe=()=>ee(()=>import("./ElevationLayerView3D-840ace09.js"),["./ElevationLayerView3D-840ace09.js","./LayerView3D-3838457e.js","./TiledLayerView3D-4c7e8e34.js","./LayerView-7b372130.js"],import.meta.url),Qoe={"base-dynamic":()=>ee(()=>import("./BaseDynamicLayerView3D-0fae731d.js"),["./BaseDynamicLayerView3D-0fae731d.js","./DynamicLayerView3D-3a980df9.js","./LayerView3D-3838457e.js","./projectExtentUtils-2ba254ff.js","./ImageMaterial-2cbfab0b.js","./LayerView-7b372130.js","./RefreshableLayerView-cb757f22.js"],import.meta.url),"base-elevation":Koe,"base-tile":eO,"bing-maps":eO,"building-scene":()=>ee(()=>import("./BuildingSceneLayerView3D-f7a9428e.js"),["./BuildingSceneLayerView3D-f7a9428e.js","./BuildingGroupSublayer-f2c13892.js","./BuildingComponentSublayer-e717fddc.js","./capabilities-a18453f6.js","./I3SIndexInfo-0412432b.js","./I3SLayerDefinitions-89f1626b.js","./I3SUtil-20c4030b.js","./I3SBinaryReader-fdd4f4f3.js","./popupUtils-8b1a1adb.js","./WhereClause-d3d68e94.js","./executionError-fb3f283a.js","./I3SMeshView3D-5d828d13.js","./I3SOverrides-327a726d.js","./I3SNode-724578f8.js","./RenderTexture-32de94fb.js","./FeatureLayerView3D-9a1b15f8.js","./FeatureLayerViewBase3D-420db4f4.js","./FeatureLikeLayerView3D-ba396373.js","./dehydratedFeatureComparison-4083c3a5.js","./queryForSymbologySnapping-1a4edcba.js","./elevationInfoUtils-3c9457ff.js","./hash-0ddfbf4b.js","./Graphics3DObjectStates-135fd699.js","./optimizedFeatureQueryEngineAdapter-dc9b72d8.js","./centroid-d1553553.js","./PooledRBush-83d0be85.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-a3138f9c.js","./QueryEngineResult-10a77c28.js","./utils-2505602d.js","./generateRendererUtils-dce0e007.js","./projectionSupport-23b402d8.js","./json-48e3ea08.js","./utils-7cfc8659.js","./QueryEngineCapabilities-42e44ded.js","./timeSupport-6a05419e.js","./FeatureStore-7c5009b6.js","./BoundsStore-b6bb441e.js","./heatmapTextureUtils-0aa3a2bc.js","./projectExtentUtils-2ba254ff.js","./LayerView3D-3838457e.js","./EventedSet-c37e86c7.js","./FeatureLayerView-2dcca551.js","./LayerView-7b372130.js","./RefreshableLayerView-cb757f22.js","./SceneModification-fe8b9220.js","./persistable-f8f00ae1.js","./multiOriginJSONSupportUtils-c978f4c3.js","./resourceExtension-6d3251a6.js","./SceneLayerWorker-4cd3d6b3.js","./I3SQueryFeatureStore-03234353.js","./DefinitionExpressionSceneLayerView-c650862d.js"],import.meta.url),csv:()=>ee(()=>import("./CSVLayerView3D-a3716072.js"),["./CSVLayerView3D-a3716072.js","./FeatureLayerViewBase3D-420db4f4.js","./FeatureLikeLayerView3D-ba396373.js","./dehydratedFeatureComparison-4083c3a5.js","./queryForSymbologySnapping-1a4edcba.js","./elevationInfoUtils-3c9457ff.js","./hash-0ddfbf4b.js","./Graphics3DObjectStates-135fd699.js","./optimizedFeatureQueryEngineAdapter-dc9b72d8.js","./centroid-d1553553.js","./PooledRBush-83d0be85.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-a3138f9c.js","./QueryEngineResult-10a77c28.js","./WhereClause-d3d68e94.js","./executionError-fb3f283a.js","./utils-2505602d.js","./generateRendererUtils-dce0e007.js","./projectionSupport-23b402d8.js","./json-48e3ea08.js","./utils-7cfc8659.js","./QueryEngineCapabilities-42e44ded.js","./timeSupport-6a05419e.js","./FeatureStore-7c5009b6.js","./BoundsStore-b6bb441e.js","./heatmapTextureUtils-0aa3a2bc.js","./projectExtentUtils-2ba254ff.js","./LayerView3D-3838457e.js","./EventedSet-c37e86c7.js","./FeatureLayerView-2dcca551.js","./popupUtils-8b1a1adb.js","./LayerView-7b372130.js","./RefreshableLayerView-cb757f22.js"],import.meta.url),dimension:()=>ee(()=>import("./DimensionLayerView3D-0f022384.js"),["./DimensionLayerView3D-0f022384.js","./LayerView3D-3838457e.js","./LayerView-7b372130.js"],import.meta.url),elevation:Koe,feature:()=>ee(()=>import("./FeatureLayerView3D-9a1b15f8.js"),["./FeatureLayerView3D-9a1b15f8.js","./FeatureLayerViewBase3D-420db4f4.js","./FeatureLikeLayerView3D-ba396373.js","./dehydratedFeatureComparison-4083c3a5.js","./queryForSymbologySnapping-1a4edcba.js","./elevationInfoUtils-3c9457ff.js","./hash-0ddfbf4b.js","./Graphics3DObjectStates-135fd699.js","./optimizedFeatureQueryEngineAdapter-dc9b72d8.js","./centroid-d1553553.js","./PooledRBush-83d0be85.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-a3138f9c.js","./QueryEngineResult-10a77c28.js","./WhereClause-d3d68e94.js","./executionError-fb3f283a.js","./utils-2505602d.js","./generateRendererUtils-dce0e007.js","./projectionSupport-23b402d8.js","./json-48e3ea08.js","./utils-7cfc8659.js","./QueryEngineCapabilities-42e44ded.js","./timeSupport-6a05419e.js","./FeatureStore-7c5009b6.js","./BoundsStore-b6bb441e.js","./heatmapTextureUtils-0aa3a2bc.js","./projectExtentUtils-2ba254ff.js","./LayerView3D-3838457e.js","./EventedSet-c37e86c7.js","./FeatureLayerView-2dcca551.js","./popupUtils-8b1a1adb.js","./LayerView-7b372130.js","./RefreshableLayerView-cb757f22.js"],import.meta.url),geojson:()=>ee(()=>import("./GeoJSONLayerView3D-26885643.js"),["./GeoJSONLayerView3D-26885643.js","./FeatureLayerViewBase3D-420db4f4.js","./FeatureLikeLayerView3D-ba396373.js","./dehydratedFeatureComparison-4083c3a5.js","./queryForSymbologySnapping-1a4edcba.js","./elevationInfoUtils-3c9457ff.js","./hash-0ddfbf4b.js","./Graphics3DObjectStates-135fd699.js","./optimizedFeatureQueryEngineAdapter-dc9b72d8.js","./centroid-d1553553.js","./PooledRBush-83d0be85.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-a3138f9c.js","./QueryEngineResult-10a77c28.js","./WhereClause-d3d68e94.js","./executionError-fb3f283a.js","./utils-2505602d.js","./generateRendererUtils-dce0e007.js","./projectionSupport-23b402d8.js","./json-48e3ea08.js","./utils-7cfc8659.js","./QueryEngineCapabilities-42e44ded.js","./timeSupport-6a05419e.js","./FeatureStore-7c5009b6.js","./BoundsStore-b6bb441e.js","./heatmapTextureUtils-0aa3a2bc.js","./projectExtentUtils-2ba254ff.js","./LayerView3D-3838457e.js","./EventedSet-c37e86c7.js","./FeatureLayerView-2dcca551.js","./popupUtils-8b1a1adb.js","./LayerView-7b372130.js","./RefreshableLayerView-cb757f22.js"],import.meta.url),graphics:()=>ee(()=>import("./GraphicsLayerView3D-53b0e12d.js"),["./GraphicsLayerView3D-53b0e12d.js","./LayerView3D-3838457e.js","./queryForSymbologySnapping-1a4edcba.js","./elevationInfoUtils-3c9457ff.js","./GraphicsProcessor-b227957b.js","./Graphics3DObjectStates-135fd699.js","./optimizedFeatureQueryEngineAdapter-dc9b72d8.js","./centroid-d1553553.js","./PooledRBush-83d0be85.js","./projectExtentUtils-2ba254ff.js","./LayerView-7b372130.js"],import.meta.url),group:()=>ee(()=>import("./GroupLayerView-a68bc498.js"),["./GroupLayerView-a68bc498.js","./LayerView-7b372130.js"],import.meta.url),imagery:()=>ee(()=>import("./ImageryLayerView3D-2e88006f.js"),["./ImageryLayerView3D-2e88006f.js","./DynamicLayerView3D-3a980df9.js","./LayerView3D-3838457e.js","./projectExtentUtils-2ba254ff.js","./ImageMaterial-2cbfab0b.js","./LayerView-7b372130.js","./RefreshableLayerView-cb757f22.js","./ImageryLayerView-1596f988.js","./popupUtils-8b1a1adb.js"],import.meta.url),"integrated-mesh":()=>ee(()=>import("./IntegratedMeshLayerView3D-59b155e8.js"),["./IntegratedMeshLayerView3D-59b155e8.js","./I3SMeshView3D-5d828d13.js","./I3SOverrides-327a726d.js","./I3SNode-724578f8.js","./I3SUtil-20c4030b.js","./I3SBinaryReader-fdd4f4f3.js","./RenderTexture-32de94fb.js","./FeatureLayerView3D-9a1b15f8.js","./FeatureLayerViewBase3D-420db4f4.js","./FeatureLikeLayerView3D-ba396373.js","./dehydratedFeatureComparison-4083c3a5.js","./queryForSymbologySnapping-1a4edcba.js","./elevationInfoUtils-3c9457ff.js","./hash-0ddfbf4b.js","./Graphics3DObjectStates-135fd699.js","./optimizedFeatureQueryEngineAdapter-dc9b72d8.js","./centroid-d1553553.js","./PooledRBush-83d0be85.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-a3138f9c.js","./QueryEngineResult-10a77c28.js","./WhereClause-d3d68e94.js","./executionError-fb3f283a.js","./utils-2505602d.js","./generateRendererUtils-dce0e007.js","./projectionSupport-23b402d8.js","./json-48e3ea08.js","./utils-7cfc8659.js","./QueryEngineCapabilities-42e44ded.js","./timeSupport-6a05419e.js","./FeatureStore-7c5009b6.js","./BoundsStore-b6bb441e.js","./heatmapTextureUtils-0aa3a2bc.js","./projectExtentUtils-2ba254ff.js","./LayerView3D-3838457e.js","./EventedSet-c37e86c7.js","./FeatureLayerView-2dcca551.js","./popupUtils-8b1a1adb.js","./LayerView-7b372130.js","./RefreshableLayerView-cb757f22.js","./SceneModification-fe8b9220.js","./persistable-f8f00ae1.js","./multiOriginJSONSupportUtils-c978f4c3.js","./resourceExtension-6d3251a6.js","./SceneLayerWorker-4cd3d6b3.js"],import.meta.url),"line-of-sight":()=>ee(()=>import("./LineOfSightLayerView3D-534c9676.js"),["./LineOfSightLayerView3D-534c9676.js","./LayerView3D-3838457e.js","./LayerView-7b372130.js"],import.meta.url),"map-image":()=>ee(()=>import("./MapImageLayerView3D-42e7cc9b.js"),["./MapImageLayerView3D-42e7cc9b.js","./DynamicLayerView3D-3a980df9.js","./LayerView3D-3838457e.js","./projectExtentUtils-2ba254ff.js","./ImageMaterial-2cbfab0b.js","./LayerView-7b372130.js","./RefreshableLayerView-cb757f22.js","./MapImageLayerView-bc836ece.js","./ExportImageParameters-d7cdd086.js","./floorFilterUtils-080a7cd2.js","./sublayerUtils-01edef31.js","./MapServiceLayerViewHelper-540289c1.js","./popupUtils-8b1a1adb.js","./drapedUtils-11ce819c.js"],import.meta.url),media:()=>ee(()=>import("./MediaLayerView3D-0bae0ad3.js"),["./MediaLayerView3D-0bae0ad3.js","./MediaElementView-c88dc21d.js","./normalizeUtilsSync-e634818e.js","./LayerView3D-3838457e.js","./ImageMaterial-2cbfab0b.js","./LayerView-7b372130.js"],import.meta.url),"ogc-feature":()=>ee(()=>import("./OGCFeatureLayerView3D-0ff06e9c.js"),["./OGCFeatureLayerView3D-0ff06e9c.js","./FeatureLayerViewBase3D-420db4f4.js","./FeatureLikeLayerView3D-ba396373.js","./dehydratedFeatureComparison-4083c3a5.js","./queryForSymbologySnapping-1a4edcba.js","./elevationInfoUtils-3c9457ff.js","./hash-0ddfbf4b.js","./Graphics3DObjectStates-135fd699.js","./optimizedFeatureQueryEngineAdapter-dc9b72d8.js","./centroid-d1553553.js","./PooledRBush-83d0be85.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-a3138f9c.js","./QueryEngineResult-10a77c28.js","./WhereClause-d3d68e94.js","./executionError-fb3f283a.js","./utils-2505602d.js","./generateRendererUtils-dce0e007.js","./projectionSupport-23b402d8.js","./json-48e3ea08.js","./utils-7cfc8659.js","./QueryEngineCapabilities-42e44ded.js","./timeSupport-6a05419e.js","./FeatureStore-7c5009b6.js","./BoundsStore-b6bb441e.js","./heatmapTextureUtils-0aa3a2bc.js","./projectExtentUtils-2ba254ff.js","./LayerView3D-3838457e.js","./EventedSet-c37e86c7.js","./FeatureLayerView-2dcca551.js","./popupUtils-8b1a1adb.js","./LayerView-7b372130.js","./RefreshableLayerView-cb757f22.js","./OGCFeatureLayerView-4babf317.js"],import.meta.url),"open-street-map":eO,"oriented-imagery":()=>ee(()=>import("./FeatureLayerView3D-9a1b15f8.js"),["./FeatureLayerView3D-9a1b15f8.js","./FeatureLayerViewBase3D-420db4f4.js","./FeatureLikeLayerView3D-ba396373.js","./dehydratedFeatureComparison-4083c3a5.js","./queryForSymbologySnapping-1a4edcba.js","./elevationInfoUtils-3c9457ff.js","./hash-0ddfbf4b.js","./Graphics3DObjectStates-135fd699.js","./optimizedFeatureQueryEngineAdapter-dc9b72d8.js","./centroid-d1553553.js","./PooledRBush-83d0be85.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-a3138f9c.js","./QueryEngineResult-10a77c28.js","./WhereClause-d3d68e94.js","./executionError-fb3f283a.js","./utils-2505602d.js","./generateRendererUtils-dce0e007.js","./projectionSupport-23b402d8.js","./json-48e3ea08.js","./utils-7cfc8659.js","./QueryEngineCapabilities-42e44ded.js","./timeSupport-6a05419e.js","./FeatureStore-7c5009b6.js","./BoundsStore-b6bb441e.js","./heatmapTextureUtils-0aa3a2bc.js","./projectExtentUtils-2ba254ff.js","./LayerView3D-3838457e.js","./EventedSet-c37e86c7.js","./FeatureLayerView-2dcca551.js","./popupUtils-8b1a1adb.js","./LayerView-7b372130.js","./RefreshableLayerView-cb757f22.js"],import.meta.url),"point-cloud":()=>ee(()=>import("./PointCloudLayerView3D-ff889523.js").then(t=>t.P),["./PointCloudLayerView3D-ff889523.js","./LayerView3D-3838457e.js","./I3SUtil-20c4030b.js","./I3SBinaryReader-fdd4f4f3.js","./PointCloudWorkerUtil-bc670b7f.js","./PointCloudUniqueValueRenderer-c509ec1e.js","./PopupSceneLayerView-ed6c7eaf.js","./popupUtils-8b1a1adb.js","./LayerView-7b372130.js"],import.meta.url),voxel:()=>ee(()=>import("./VoxelLayerView3D-51bd46b0.js"),["./VoxelLayerView3D-51bd46b0.js","./LayerView3D-3838457e.js","./PopupSceneLayerView-ed6c7eaf.js","./popupUtils-8b1a1adb.js","./LayerView-7b372130.js"],import.meta.url),route:()=>ee(()=>import("./RouteLayerView3D-e1db0fb9.js"),["./RouteLayerView3D-e1db0fb9.js","./Stop-96691457.js","./LayerView3D-3838457e.js","./GraphicsProcessor-b227957b.js","./Graphics3DObjectStates-135fd699.js","./optimizedFeatureQueryEngineAdapter-dc9b72d8.js","./centroid-d1553553.js","./PooledRBush-83d0be85.js","./projectExtentUtils-2ba254ff.js","./EventedSet-c37e86c7.js","./LayerView-7b372130.js"],import.meta.url),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?ee(()=>import("./SceneLayerView3D-7007132c.js"),["./SceneLayerView3D-7007132c.js","./WhereClause-d3d68e94.js","./executionError-fb3f283a.js","./floorFilterUtils-080a7cd2.js","./I3SMeshView3D-5d828d13.js","./I3SOverrides-327a726d.js","./I3SNode-724578f8.js","./I3SUtil-20c4030b.js","./I3SBinaryReader-fdd4f4f3.js","./RenderTexture-32de94fb.js","./FeatureLayerView3D-9a1b15f8.js","./FeatureLayerViewBase3D-420db4f4.js","./FeatureLikeLayerView3D-ba396373.js","./dehydratedFeatureComparison-4083c3a5.js","./queryForSymbologySnapping-1a4edcba.js","./elevationInfoUtils-3c9457ff.js","./hash-0ddfbf4b.js","./Graphics3DObjectStates-135fd699.js","./optimizedFeatureQueryEngineAdapter-dc9b72d8.js","./centroid-d1553553.js","./PooledRBush-83d0be85.js","./QueryEngine-a3138f9c.js","./QueryEngineResult-10a77c28.js","./utils-2505602d.js","./generateRendererUtils-dce0e007.js","./projectionSupport-23b402d8.js","./json-48e3ea08.js","./utils-7cfc8659.js","./QueryEngineCapabilities-42e44ded.js","./timeSupport-6a05419e.js","./FeatureStore-7c5009b6.js","./BoundsStore-b6bb441e.js","./heatmapTextureUtils-0aa3a2bc.js","./projectExtentUtils-2ba254ff.js","./LayerView3D-3838457e.js","./EventedSet-c37e86c7.js","./FeatureLayerView-2dcca551.js","./popupUtils-8b1a1adb.js","./LayerView-7b372130.js","./RefreshableLayerView-cb757f22.js","./SceneModification-fe8b9220.js","./persistable-f8f00ae1.js","./multiOriginJSONSupportUtils-c978f4c3.js","./resourceExtension-6d3251a6.js","./SceneLayerWorker-4cd3d6b3.js","./SceneLayerView-8cb1d309.js","./DefinitionExpressionSceneLayerView-c650862d.js","./I3SQueryFeatureStore-03234353.js","./PopupSceneLayerView-ed6c7eaf.js"],import.meta.url):ee(()=>import("./SceneLayerGraphicsView3D-7ecda6ab.js"),["./SceneLayerGraphicsView3D-7ecda6ab.js","./I3SOverrides-327a726d.js","./I3SNode-724578f8.js","./I3SUtil-20c4030b.js","./I3SBinaryReader-fdd4f4f3.js","./RenderTexture-32de94fb.js","./FeatureLayerView3D-9a1b15f8.js","./FeatureLayerViewBase3D-420db4f4.js","./FeatureLikeLayerView3D-ba396373.js","./dehydratedFeatureComparison-4083c3a5.js","./queryForSymbologySnapping-1a4edcba.js","./elevationInfoUtils-3c9457ff.js","./hash-0ddfbf4b.js","./Graphics3DObjectStates-135fd699.js","./optimizedFeatureQueryEngineAdapter-dc9b72d8.js","./centroid-d1553553.js","./PooledRBush-83d0be85.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-a3138f9c.js","./QueryEngineResult-10a77c28.js","./WhereClause-d3d68e94.js","./executionError-fb3f283a.js","./utils-2505602d.js","./generateRendererUtils-dce0e007.js","./projectionSupport-23b402d8.js","./json-48e3ea08.js","./utils-7cfc8659.js","./QueryEngineCapabilities-42e44ded.js","./timeSupport-6a05419e.js","./FeatureStore-7c5009b6.js","./BoundsStore-b6bb441e.js","./heatmapTextureUtils-0aa3a2bc.js","./projectExtentUtils-2ba254ff.js","./LayerView3D-3838457e.js","./EventedSet-c37e86c7.js","./FeatureLayerView-2dcca551.js","./popupUtils-8b1a1adb.js","./LayerView-7b372130.js","./RefreshableLayerView-cb757f22.js","./SceneLayerView-8cb1d309.js","./DefinitionExpressionSceneLayerView-c650862d.js","./PopupSceneLayerView-ed6c7eaf.js"],import.meta.url),stream:()=>ee(()=>import("./StreamLayerView3D-83a521a6.js"),["./StreamLayerView3D-83a521a6.js","./StreamFeatureManager-5a55bc70.js","./CircularArray-c86c79de.js","./createConnection-908723de.js","./EventedSet-c37e86c7.js","./FeatureLikeLayerView3D-ba396373.js","./dehydratedFeatureComparison-4083c3a5.js","./queryForSymbologySnapping-1a4edcba.js","./elevationInfoUtils-3c9457ff.js","./hash-0ddfbf4b.js","./Graphics3DObjectStates-135fd699.js","./optimizedFeatureQueryEngineAdapter-dc9b72d8.js","./centroid-d1553553.js","./PooledRBush-83d0be85.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-a3138f9c.js","./QueryEngineResult-10a77c28.js","./WhereClause-d3d68e94.js","./executionError-fb3f283a.js","./utils-2505602d.js","./generateRendererUtils-dce0e007.js","./projectionSupport-23b402d8.js","./json-48e3ea08.js","./utils-7cfc8659.js","./QueryEngineCapabilities-42e44ded.js","./timeSupport-6a05419e.js","./FeatureStore-7c5009b6.js","./BoundsStore-b6bb441e.js","./heatmapTextureUtils-0aa3a2bc.js","./projectExtentUtils-2ba254ff.js","./LayerView3D-3838457e.js","./LayerView-7b372130.js"],import.meta.url),tile:eO,"imagery-tile":()=>ee(()=>import("./ImageryTileLayerView3D-10084e47.js"),["./ImageryTileLayerView3D-10084e47.js","./LayerView3D-3838457e.js","./TiledLayerView3D-4c7e8e34.js","./ImageryTileLayerView-0f75a8ab.js","./rasterProjectionHelper-2a66ec39.js","./popupUtils-8b1a1adb.js","./LayerView-7b372130.js","./RefreshableLayerView-cb757f22.js","./drapedUtils-11ce819c.js"],import.meta.url),"vector-tile":()=>ee(()=>import("./VectorTileLayerView3D-b763dd68.js"),["./VectorTileLayerView3D-b763dd68.js","./TileInfoViewPOT-ede78d65.js","./Rect-ea14f53a.js","./rasterizingUtils-ea810fad.js","./StyleDefinition-7d58136b.js","./enums-4b2a86a0.js","./WGLBrushVTLSymbol-b759c30b.js","./definitions-19bfb61c.js","./enums-b1d611e3.js","./number-b10bd8f5.js","./GeometryUtils-dd03fc25.js","./VTLMaterialManager-241b1acb.js","./ShaderCompiler-77d0dcb6.js","./programUtils-f035fe8a.js","./StyleRepository-063ad8a0.js","./colorUtils-c0f43caf.js","./GeometryUtils-53652037.js","./LayerView3D-3838457e.js","./TiledLayerView3D-4c7e8e34.js","./LayerView-7b372130.js"],import.meta.url),wcs:()=>ee(()=>import("./ImageryTileLayerView3D-10084e47.js"),["./ImageryTileLayerView3D-10084e47.js","./LayerView3D-3838457e.js","./TiledLayerView3D-4c7e8e34.js","./ImageryTileLayerView-0f75a8ab.js","./rasterProjectionHelper-2a66ec39.js","./popupUtils-8b1a1adb.js","./LayerView-7b372130.js","./RefreshableLayerView-cb757f22.js","./drapedUtils-11ce819c.js"],import.meta.url),"web-tile":eO,wfs:()=>ee(()=>import("./WFSLayerView3D-01c5e147.js"),["./WFSLayerView3D-01c5e147.js","./FeatureLayerViewBase3D-420db4f4.js","./FeatureLikeLayerView3D-ba396373.js","./dehydratedFeatureComparison-4083c3a5.js","./queryForSymbologySnapping-1a4edcba.js","./elevationInfoUtils-3c9457ff.js","./hash-0ddfbf4b.js","./Graphics3DObjectStates-135fd699.js","./optimizedFeatureQueryEngineAdapter-dc9b72d8.js","./centroid-d1553553.js","./PooledRBush-83d0be85.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-a3138f9c.js","./QueryEngineResult-10a77c28.js","./WhereClause-d3d68e94.js","./executionError-fb3f283a.js","./utils-2505602d.js","./generateRendererUtils-dce0e007.js","./projectionSupport-23b402d8.js","./json-48e3ea08.js","./utils-7cfc8659.js","./QueryEngineCapabilities-42e44ded.js","./timeSupport-6a05419e.js","./FeatureStore-7c5009b6.js","./BoundsStore-b6bb441e.js","./heatmapTextureUtils-0aa3a2bc.js","./projectExtentUtils-2ba254ff.js","./LayerView3D-3838457e.js","./EventedSet-c37e86c7.js","./FeatureLayerView-2dcca551.js","./popupUtils-8b1a1adb.js","./LayerView-7b372130.js","./RefreshableLayerView-cb757f22.js"],import.meta.url),wms:()=>ee(()=>import("./WMSLayerView3D-88e6f57b.js"),["./WMSLayerView3D-88e6f57b.js","./DynamicLayerView3D-3a980df9.js","./LayerView3D-3838457e.js","./projectExtentUtils-2ba254ff.js","./ImageMaterial-2cbfab0b.js","./LayerView-7b372130.js","./RefreshableLayerView-cb757f22.js","./WMSLayerView-cef0556a.js","./ExportWMSImageParameters-b50dd82c.js"],import.meta.url),wmts:()=>ee(()=>import("./WMTSLayerView3D-4064987a.js"),["./WMTSLayerView3D-4064987a.js","./LayerView3D-3838457e.js","./TiledLayerView3D-4c7e8e34.js","./LayerView-7b372130.js","./RefreshableLayerView-cb757f22.js"],import.meta.url),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null};function xet(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",i=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new W(`${i}:view-not-supported`,`${e} is not supported in 3D`)}const eae={hasLayerViewModule:t=>v(Qoe[t.type]),importLayerView:t=>{const e=Qoe[t.type];if(C(e))throw xet(t);return e(t)}},tae="analyses-owner-handles";var ZS,Pw;(function(t){t[t.PENDING=0]="PENDING",t[t.CREATED=1]="CREATED"})(ZS||(ZS={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED"}(Pw||(Pw={}));let ew=class extends j3{constructor(e){super(e),this._allAnalysisViews=new Nt,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=iae(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(Bi("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(Bi()),this._attachedToViewResolver=iae()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const i=this._items.get(e);if(C(i)||i.state.list===Pw.REMOVED)throw new W("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return i.createAnalysisViewTask.promise}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),tae)}_disconnectOwners(){this.handles.remove(tae),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const s of e)this._addAnalysis(s);const i=e.on("after-add",s=>this._addAnalysis(s.item)),r=e.on("after-remove",s=>this._removeAnalysis(s.item));return{remove:()=>{i.remove(),r.remove();for(const s of e)this._removeAnalysis(s)}}}_addAnalysis(e){const i=this._items.get(e);if(i==null){const r={state:{view:ZS.PENDING,list:Pw.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,r),r.createAnalysisViewTask=uI(s=>this._createAnalysisViewPromise(r,s))}else i.state.list=Pw.ADDED}_removeAnalysis(e){const i=this._items.get(e);i!=null?(i.state.list=Pw.REMOVED,this._scheduleUpdate()):oe.getLogger(this.declaredClass).error("Trying to remove analysis which was not added")}_scheduleUpdate(){v(this._scheduledUpdateHandle)||(this._scheduledUpdateHandle=rT(()=>this._update()))}_update(){this._scheduledUpdateHandle=Rr(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===Pw.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case ZS.PENDING:e.createAnalysisViewTask=hd(e.createAnalysisViewTask);break;case ZS.CREATED:v(e.view)&&(this._allAnalysisViews.remove(e.view),e.view=Je(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,i){const r=e.analysis,s=r.type,n=this._analysisModules[s];if(this._creatingViewCount+=1,C(n.module))try{n.module=await this._loadAnalysisModule(s)}catch(a){throw this._creatingViewCount-=1,a}if(qn(i))throw this._creatingViewCount-=1,Bi("AnalysisView creation aborted");const o=new n.module.default({analysis:r,view:this.view});try{await o.when()}catch(a){throw this._creatingViewCount-=1,a}if(qn(i))throw this._creatingViewCount-=1,o.destroy(),Bi("AnalysisView creation aborted");return e.view=o,e.state.view=ZS.CREATED,this._allAnalysisViews.add(o),this._creatingViewCount-=1,o}_loadAnalysisModule(e){switch(e){case"area-measurement":return ee(()=>import("./AreaMeasurementAnalysisView3D-e815273a.js").then(i=>i.A),["./AreaMeasurementAnalysisView3D-e815273a.js","./analysisThemeUtils-0b7e15c5.js","./Segment-a1fa4b06.js","./LineVisualElement-904de9f6.js","./elevationInfoUtils-3c9457ff.js","./geometryEngine-0bddb0d3.js","./geometryEngineBase-e1a33b0a.js","./hydrated-42ff4796.js","./EditGeometryOperations-023b3d76.js"],import.meta.url);case"dimension":return ee(()=>import("./DimensionAnalysisView3D-2e404786.js").then(i=>i.D),["./DimensionAnalysisView3D-2e404786.js","./LineVisualElement-904de9f6.js","./LengthDimension-ab6848c2.js","./Segment-a1fa4b06.js","./elevationInfoUtils-3c9457ff.js","./analysisViewUtils-e5cbe5fd.js","./ImageMaterial-2cbfab0b.js","./Factory-8247a6e0.js","./RightAngleQuadVisualElement-ba7b8aa2.js","./VisualElementResources-12bd7834.js","./PointVisualElement-da80c55c.js","./colorUtils-c0f43caf.js","./EditGeometryOperations-023b3d76.js","./QueryEngineResult-10a77c28.js","./WhereClause-d3d68e94.js","./executionError-fb3f283a.js","./utils-2505602d.js","./generateRendererUtils-dce0e007.js","./projectionSupport-23b402d8.js","./json-48e3ea08.js","./utils-7cfc8659.js","./dehydratedFeatureComparison-4083c3a5.js","./RenderTexture-32de94fb.js"],import.meta.url);case"direct-line-measurement":return ee(()=>import("./DirectLineMeasurementAnalysisView3D-63ec4659.js").then(i=>i.D),["./DirectLineMeasurementAnalysisView3D-63ec4659.js","./analysisThemeUtils-0b7e15c5.js","./Segment-a1fa4b06.js","./LineVisualElement-904de9f6.js","./elevationInfoUtils-3c9457ff.js","./geometryEngine-0bddb0d3.js","./geometryEngineBase-e1a33b0a.js","./hydrated-42ff4796.js","./RightAngleQuadVisualElement-ba7b8aa2.js","./VisualElementResources-12bd7834.js"],import.meta.url);case"line-of-sight":return ee(()=>import("./LineOfSightAnalysisView3D-ec4468eb.js"),["./LineOfSightAnalysisView3D-ec4468eb.js","./LineVisualElement-904de9f6.js","./LineOfSightAnalysisTarget-adb61d03.js","./persistable-f8f00ae1.js","./multiOriginJSONSupportUtils-c978f4c3.js","./resourceExtension-6d3251a6.js","./elevationInfoUtils-3c9457ff.js","./analysisViewUtils-e5cbe5fd.js","./ImageMaterial-2cbfab0b.js","./PointVisualElement-da80c55c.js","./VisualElementResources-12bd7834.js"],import.meta.url);case"slice":return ee(()=>import("./SliceAnalysisView3D-02e29451.js").then(i=>i.S),["./SliceAnalysisView3D-02e29451.js","./LineVisualElement-904de9f6.js","./persistable-f8f00ae1.js","./multiOriginJSONSupportUtils-c978f4c3.js","./resourceExtension-6d3251a6.js","./BuildingComponentSublayer-e717fddc.js","./capabilities-a18453f6.js","./I3SIndexInfo-0412432b.js","./I3SLayerDefinitions-89f1626b.js","./I3SUtil-20c4030b.js","./I3SBinaryReader-fdd4f4f3.js","./popupUtils-8b1a1adb.js","./analysisViewUtils-e5cbe5fd.js","./ImageMaterial-2cbfab0b.js","./Factory-8247a6e0.js"],import.meta.url)}}};function iae(){const t=qv();return t.promise.catch(()=>{}),t}u([d()],ew.prototype,"updating",null),u([d({constructOnly:!0})],ew.prototype,"view",void 0),u([d()],ew.prototype,"_allAnalysisViews",void 0),u([d()],ew.prototype,"_creatingViewCount",void 0),ew=u([I("esri.views.3d.analysis.AnalysisViewManager3D")],ew);const Tet=ew;let Yg=class extends $e{constructor(e){super(e),this.collision=new kR,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===st.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==st.Local?this._set("altitude",e):oe.getLogger(this.declaredClass).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?we(e,this.altitude.min,this.altitude.max):e}clampTilt(e,i){if(!this.tilt)return i;const r=this.tilt(e);return we(i,r.min,r.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===st.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(i,r=Jk)=>(r.min=ia.min,r.max=e,r)}_createDefaultTiltLocal(){const e=this.collision.enabled?MN([[4e3,ia.max],[1e4,ii(88)],[6e6,ii(88)]]):()=>ia.max;return(i,r=Jk)=>(r.min=ia.min,r.max=e(i),r)}_createDefaultTiltGlobal(){const e=this.collision.enabled?MN([[4e3,ia.max],[5e4,ii(88)],[6e6,ii(88)],[2e7,ia.min]]):MN([[3e5,ia.max],[3e6,ii(88)],[6e6,ii(88)],[2e7,ia.min]]);return(i,r=Jk)=>(r.min=ia.min,r.max=e(i),r)}};function Eet(t){return{min:-2e5,max:4*t.radius}}u([d()],Yg.prototype,"altitude",null),u([d({readOnly:!0})],Yg.prototype,"collision",void 0),u([d()],Yg.prototype,"distance",void 0),u([d({readOnly:!0})],Yg.prototype,"minimumPoiDistance",void 0),u([d()],Yg.prototype,"tilt",void 0),u([d({constructOnly:!0})],Yg.prototype,"mode",void 0),Yg=u([I("esri.views.3d.state.Constraints")],Yg);const rae=Eet(Oi),ia={min:ii(.5),max:ii(179.5)},Jk={min:0,max:0};let kR=class extends $e{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};u([d({type:Boolean})],kR.prototype,"enabled",void 0),u([d({type:Number})],kR.prototype,"elevationMargin",void 0),kR=u([I("esri.views.3d.state.Constraints.CollisionConstraint")],kR);let JS=class extends $e{constructor(){super(...arguments),this.min=rae.min,this.max=rae.max}};u([d({type:Number})],JS.prototype,"min",void 0),u([d({type:Number})],JS.prototype,"max",void 0),JS=u([I("esri.views.3d.constraints.AltitudeConstraint")],JS);let ay=class extends $e{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,i){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==i&&this._set("far",i))}};u([d({type:Number,value:1e-8})],ay.prototype,"near",null),u([wi("near")],ay.prototype,"castNear",null),u([d({type:Number,value:1e-8})],ay.prototype,"far",null),u([wi("far")],ay.prototype,"castFar",null),u([d({type:["auto","manual"]})],ay.prototype,"mode",void 0),ay=u([I("esri.views.3d.constraints.ClipDistanceConstraint")],ay);const gq={min:yl(ia.min),max:yl(ia.max)};let Iw=class extends $e{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return we(e,gq.min,gq.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};u([d({type:["auto","manual"]})],Iw.prototype,"mode",void 0),u([d({type:Number,value:gq.max})],Iw.prototype,"max",null),u([wi("max")],Iw.prototype,"castMax",null),Iw=u([I("esri.views.3d.constraints.TiltConstraint")],Iw);let $w=class extends $e{constructor(){super(...arguments),this.tilt=new Iw,this.altitude=new JS,this.clipDistance=new ay}};u([d({type:Iw})],$w.prototype,"tilt",void 0),u([d({type:JS})],$w.prototype,"altitude",void 0),u([d({type:ay})],$w.prototype,"clipDistance",void 0),$w=u([I("esri.views.3d.constraints.Constraints")],$w);var yq;let Mh=yq=class extends Ie{constructor(t){super(t),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(t,e){return e.datetime!=null&&new Date(e.datetime)||null}writeDate(t,e,i){e[i]=t.getTime()}readDirectShadowsEnabled(t,e){return!!e.directShadows}writedirectShadowsEnabled(t,e,i){t&&(e[i]=t)}writeDisplayUTCOffset(t,e){t!=null&&(e.displayUTCOffset=t)}clone(){return new yq(this.cloneConstructProperties())}cloneConstructProperties(){const t={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(t.date=new Date(this.date.getTime())),t}};u([d({readOnly:!0,type:["sun"],json:{write:!0}})],Mh.prototype,"type",void 0),u([d({type:Date,json:{type:Number,write:{target:"datetime"}}})],Mh.prototype,"date",void 0),u([Qe("date",["datetime"])],Mh.prototype,"readDate",null),u([lt("date")],Mh.prototype,"writeDate",null),u([d({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],Mh.prototype,"directShadowsEnabled",void 0),u([Qe("directShadowsEnabled",["directShadows"])],Mh.prototype,"readDirectShadowsEnabled",null),u([lt("directShadowsEnabled")],Mh.prototype,"writedirectShadowsEnabled",null),u([d({type:Number,json:{write:!0}})],Mh.prototype,"displayUTCOffset",void 0),u([lt("displayUTCOffset")],Mh.prototype,"writeDisplayUTCOffset",null),Mh=yq=u([I("esri.webscene.SunLighting")],Mh);const sP=Mh;var fS;let Wf=fS=class extends As.EventedMixin(sP){constructor(t){super(t),this.cameraTrackingEnabled=!0,this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),i=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",i),this._set("date",i)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(t){return new fS(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t.getTime()),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}autoUpdate(t,e){const i=fS.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let r=null;v(t)&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(r=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(r=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const s=fS.calculateTimezoneOffset(this.positionTimezoneInfo);if(i!==s&&(Kk.target=this,Kk.timezoneOffset=s,this.emit("timezone-will-change",Kk)),v(t))return!!isNaN(t.getTime())||r!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new fS({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([d({type:Boolean})],Wf.prototype,"cameraTrackingEnabled",void 0),u([d({type:Boolean})],Wf.prototype,"ambientOcclusionEnabled",void 0),u([d({type:Boolean})],Wf.prototype,"waterReflectionEnabled",void 0),u([d({type:Date})],Wf.prototype,"defaultDate",null),u([d({type:Date})],Wf.prototype,"date",null),Wf=fS=u([I("esri.views.3d.environment.SunLighting")],Wf),function(t){function e({hours:i,minutes:r,seconds:s}){return Math.round(i+r/60+s/3600)}t.calculateTimezoneOffset=e}(Wf||(Wf={}));const Kk={target:null,timezoneOffset:0},V_=Wf;var _q;let BR=_q=class extends Ie{constructor(t){super(t),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new _q(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};u([d({readOnly:!0,type:["virtual"],json:{write:!0}})],BR.prototype,"type",void 0),u([d({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],BR.prototype,"directShadowsEnabled",void 0),BR=_q=u([I("esri.webscene.VirtualLighting")],BR);const QU=BR;var uF;let mS=uF=class extends As.EventedMixin(QU){constructor(t){super(t),this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.cameraTrackingEnabled=!0}clone(){return new uF({...this.cloneConstructProperties(),ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new uF(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([d({type:Boolean})],mS.prototype,"ambientOcclusionEnabled",void 0),u([d({type:Boolean})],mS.prototype,"waterReflectionEnabled",void 0),u([d({type:Boolean})],mS.prototype,"cameraTrackingEnabled",void 0),mS=uF=u([I("esri.views.3d.environment.VirtualLighting")],mS);const zR=mS,Cet={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:V_,virtual:zR}};var vq;let KM=vq=class extends $e{set quality(t){["low","high"].includes(t)&&this._set("quality",t)}clone(){return new vq({quality:this.quality})}};u([d({type:["low","high"],value:"low"})],KM.prototype,"quality",null),KM=vq=u([I("esri.views.3d.environment.SceneViewAtmosphere")],KM);var bq;let GR=bq=class extends Ie{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new bq({cloudCover:this.cloudCover})}};u([At({sunny:"sunny"})],GR.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],GR.prototype,"cloudCover",void 0),GR=bq=u([I("esri.views.3d.environment.SunnyWeather")],GR);const wq=GR;var xq;let jR=xq=class extends Ie{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new xq({cloudCover:this.cloudCover})}};u([At({cloudy:"cloudy"})],jR.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],jR.prototype,"cloudCover",void 0),jR=xq=u([I("esri.views.3d.environment.CloudyWeather")],jR);const Aet=jR;var Tq;let HR=Tq=class extends Ie{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new Tq({fogStrength:this.fogStrength})}};u([At({foggy:"foggy"})],HR.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],HR.prototype,"fogStrength",void 0),HR=Tq=u([I("esri.views.3d.environment.FoggyWeather")],HR);const Oet=HR;var Sq;let gS=Sq=class extends Ie{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new Sq({cloudCover:this.cloudCover,precipitation:this.precipitation})}};u([At({rainy:"rainy"})],gS.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],gS.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],gS.prototype,"precipitation",void 0),gS=Sq=u([I("esri.views.3d.environment.RainyWeather")],gS);const Ret=gS;var Eq;let tw=Eq=class extends Ie{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new Eq({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};u([At({snowy:"snowy"})],tw.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],tw.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],tw.prototype,"precipitation",void 0),u([d({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],tw.prototype,"snowCover",void 0),tw=Eq=u([I("esri.views.3d.environment.SnowyWeather")],tw);const Met=tw,QTe={key:"type",base:wq,typeMap:{sunny:wq,cloudy:Aet,rainy:Ret,snowy:Met,foggy:Oet}},Pet=Object.keys(QTe.typeMap);function Iet(t,e){return!!Pet.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const zh=1e4,$et={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:sP,virtual:QU}};let hF=class extends Ie{constructor(e){super(e)}clone(){}};u([d({readOnly:!0,json:{read:!1}})],hF.prototype,"type",void 0),hF=u([I("esri.webscene.background.Background")],hF);const e2e=hF;var Cq;const Let={...s0,nonNullable:!0};let qR=Cq=class extends e2e{constructor(t){super(t),this.type="color",this.color=new ot([0,0,0,1])}clone(){return new Cq(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};u([At({color:"color"},{readOnly:!0})],qR.prototype,"type",void 0),u([d(Let)],qR.prototype,"color",void 0),qR=Cq=u([I("esri.webscene.background.ColorBackground")],qR);const t2e=qR,sae={base:e2e,key:"type",typeMap:{color:t2e}};function Det(t){return(e,i,r)=>{if(!e)return e;for(const s in t.typeMap)if(e.type===s){const n=new t.typeMap[s];return n.read(e,r),n}}}const Net={types:sae,json:{read:Det(sae),write:{overridePolicy:(t,e,i)=>({enabled:!i||!i.isPresentation})}}};var Aq;const i2e="esri.webscene.Environment",Fet=oe.getLogger(i2e),nae=(t,e,i)=>({enabled:!i||!i.isPresentation});let k_=Aq=class extends Ie{constructor(t){super(t),this.lighting=new sP,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(t){Iet(t==null?void 0:t.type,Fet)&&this._set("weather",t)}clone(){return new Aq(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?QU.prototype.clone.call(this.lighting):sP.prototype.clone.call(this.lighting),background:ae(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};u([d({types:$et,nonNullable:!0,json:{write:!0}})],k_.prototype,"lighting",void 0),u([d(Net)],k_.prototype,"background",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:nae}}})],k_.prototype,"atmosphereEnabled",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:nae}}})],k_.prototype,"starsEnabled",void 0),u([d({types:QTe,nonNullable:!0,json:{write:!0},value:new wq})],k_.prototype,"weather",null),k_=Aq=u([I(i2e)],k_);const r2e=k_;var WR;let yS=WR=class extends r2e{constructor(t){super(t),this.atmosphere=new KM,this.lighting=new V_,this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(t){const e=t.cloneConstructProperties();return new WR({...e,lighting:e.lighting?e.lighting.type==="virtual"?zR.fromWebsceneLighting(e.lighting):V_.fromWebsceneLighting(e.lighting):void 0})}castLighting(t){return this._convertLighting(t)}applyLighting(t){this.lighting=this._convertLighting(t)}_convertLighting(t){var e,i;return t?t instanceof V_||t instanceof zR?t:t instanceof sP?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(t):new V_({...t.cloneConstructProperties(),...(e=this.lighting)==null?void 0:e.cloneNonPersistentConstructProperties()}):t instanceof QU?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t):new zR({...t.cloneConstructProperties(),...(i=this.lighting)==null?void 0:i.cloneNonPersistentConstructProperties()}):Xp(Cet,t):new V_}clone(){return new WR({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ae(this.background)})}cloneWithWebsceneEnvironment(t){return new WR({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ae(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(t.lighting):V_.fromWebsceneLighting(t.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t.lighting):zR.fromWebsceneLighting(t.lighting);default:return t.lighting,V_.fromWebsceneLighting(t.lighting)}}};u([d({type:KM,json:{read:!1},nonNullable:!0})],yS.prototype,"atmosphere",void 0),u([d({nonNullable:!0})],yS.prototype,"lighting",void 0),u([wi("lighting")],yS.prototype,"castLighting",null),yS=WR=u([I("esri.views.3d.environment.SceneViewEnvironment")],yS);const _S=yS;var Vn;(function(t){t[t.Simple=0]="Simple",t[t.Realistic=1]="Realistic",t[t.Panoramic=2]="Panoramic",t[t.None=3]="None"})(Vn||(Vn={}));function Fn(t,e){return t[0]=e[0],t[1]=e[1],t}function It(t,e,i){return t[0]=e,t[1]=i,t}function Gh(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function ju(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function s2e(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function n2e(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function Uet(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function Vet(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function ket(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t}function Bet(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t}function zet(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function Ca(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function Get(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t}function Hm(t,e){const i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)}function EC(t,e){const i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r}function nP(t){const e=t[0],i=t[1];return Math.sqrt(e*e+i*i)}function o2e(t){const e=t[0],i=t[1];return e*e+i*i}function NK(t,e){return t[0]=-e[0],t[1]=-e[1],t}function jet(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function kx(t,e){const i=e[0],r=e[1];let s=i*i+r*r;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s),t}function dn(t,e){return t[0]*e[0]+t[1]*e[1]}function a2e(t,e,i){const r=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=r,t}function vS(t,e,i,r){const s=e[0],n=e[1];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t}function Het(t,e){e=e||1;const i=2*WP()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t}function Oq(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[2]*s,t[1]=i[1]*r+i[3]*s,t}function hm(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[2]*s+i[4],t[1]=i[1]*r+i[3]*s+i[5],t}function qet(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[3]*s+i[6],t[1]=i[1]*r+i[4]*s+i[7],t}function Wet(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[4]*s+i[12],t[1]=i[1]*r+i[5]*s+i[13],t}function Xet(t,e,i,r){const s=e[0]-i[0],n=e[1]-i[1],o=Math.sin(r),a=Math.cos(r);return t[0]=s*a-n*o+i[0],t[1]=s*o+n*a+i[1],t}function Yet(t,e){const i=t[0],r=t[1],s=e[0],n=e[1];let o=i*i+r*r;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(i*s+r*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function Zet(t){return"vec2("+t[0]+", "+t[1]+")"}function l2e(t,e){return t[0]===e[0]&&t[1]===e[1]}function c2e(t,e){const i=t[0],r=t[1],s=e[0],n=e[1],o=Fa();return Math.abs(i-s)<=o*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-n)<=o*Math.max(1,Math.abs(r),Math.abs(n))}function Jet(t,e,i,r,s){let n=e[0]-i[0],o=e[1]-i[1];const a=(r[0]*n+r[1]*o)*(s-1);return n=r[0]*a,o=r[1]*a,t[0]=e[0]+n,t[1]=e[1]+o,t}const Ket=nP,FK=ju,Qet=s2e,ett=n2e,u2e=Hm,ttt=EC,itt=o2e;Object.freeze(Object.defineProperty({__proto__:null,add:Gh,angle:Yet,ceil:Uet,copy:Fn,cross:a2e,dist:u2e,distance:Hm,div:ett,divide:n2e,dot:dn,equals:c2e,exactEquals:l2e,floor:Vet,inverse:jet,len:Ket,length:nP,lerp:vS,max:Bet,min:ket,mul:Qet,multiply:s2e,negate:NK,normalize:kx,projectAndScale:Jet,random:Het,rotate:Xet,round:zet,scale:Ca,scaleAndAdd:Get,set:It,sqrDist:ttt,sqrLen:itt,squaredDistance:EC,squaredLength:o2e,str:Zet,sub:FK,subtract:ju,transformMat2:Oq,transformMat2d:hm,transformMat3:qet,transformMat4:Wet},Symbol.toStringTag,{value:"Module"}));function UK(t){return we((t-1e5)/(1e6-1e5),0,1)}const Rq=1e4,rtt=.085,oP=1e5;let stt=class{};const yr=stt;function x(t,...e){let i="";for(let r=0;r<e.length;r++)i+=t[r]+e[r];return i+=t[t.length-1],i}(function(t){function e(r){return Math.round(r).toString()}function i(r){return r.toPrecision(8)}t.int=e,t.float=i})(x||(x={}));var A;(function(t){t.POSITION="position",t.NORMAL="normal",t.UV0="uv0",t.AUXPOS1="auxpos1",t.AUXPOS2="auxpos2",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.TANGENT="tangent",t.OFFSET="offset",t.SUBDIVISIONFACTOR="subdivisionFactor",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.NORMALCOMPRESSED="normalCompressed",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.FEATUREVALUE="featureValue",t.MODELORIGINHI="modelOriginHi",t.MODELORIGINLO="modelOriginLo",t.MODEL="model",t.MODELNORMAL="modelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMALA="normalA",t.NORMALB="normalB",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.U8PADDING="u8padding",t.U16PADDING="u16padding",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.EXTRUDE="extrude",t.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",t.OBJECTANDLAYERIDCOLOR_INSTANCED="objectAndLayerIdColor_instanced"})(A||(A={}));var Ks;function Im(t,e){switch(e.textureCoordinateType){case Ks.Default:return t.attributes.add(A.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(x`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case Ks.Compressed:return t.attributes.add(A.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(x`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case Ks.Atlas:return t.attributes.add(A.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add(A.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(x`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case Ks.None:return void t.vertex.code.add(x`void forwardTextureCoordinates() {}`);case Ks.COUNT:return}}(function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"})(Ks||(Ks={}));function ou(t){t.code.add(x`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function rh(t){t.include(ou),t.code.add(x`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}function e8(t){t.fragment.code.add(x`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var gr;(function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"})(gr||(gr={}));let Os=class{constructor(e,i,r,s,n=null){this.name=e,this.type=i,this.arraySize=n,this.bind={[gr.Pass]:null,[gr.Draw]:null},v(r)&&v(s)&&(this.bind[r]=s)}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},ni=class extends Os{constructor(e,i){super(e,"vec3",gr.Pass,(r,s,n)=>r.setUniform3fv(e,i(s,n)))}},He=class extends Os{constructor(e,i){super(e,"float",gr.Pass,(r,s,n)=>r.setUniform1f(e,i(s,n)))}};function l0(t){t.uniforms.add(new ni("mainLightDirection",(e,i)=>i.lighting.mainLight.direction))}function rg(t){t.uniforms.add(new ni("mainLightIntensity",(e,i)=>i.lighting.mainLight.intensity))}function ntt(t,e){e.useLegacyTerrainShading?t.uniforms.add(new He("lightingFixedFactor",(i,r)=>r.lighting.noonFactor*(1-r.lighting.globalFactor))):t.constants.add("lightingFixedFactor","float",0)}function g5(t,e){const i=t.fragment;l0(i),rg(i),ntt(i,e),i.code.add(x`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}let zi=class extends Os{constructor(e,i){super(e,"vec2",gr.Pass,(r,s,n)=>r.setUniform2fv(e,i(s,n)))}},Si=class extends Os{constructor(e,i){super(e,"vec4",gr.Pass,(r,s,n)=>r.setUniform4fv(e,i(s,n)))}},Jr=class extends Os{constructor(e,i){super(e,"mat4",gr.Pass,(r,s,n)=>r.setUniformMatrix4fv(e,i(s,n)))}};const h2e=oe.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let d2e=class{constructor(){this._includedModules=new Map}include(e,i){if(this._includedModules.has(e)){const r=this._includedModules.get(e);if(r!==i){h2e.error("Trying to include shader module multiple times with different sets of options.");const s=new Set;for(const n of Object.keys(r))r[n]!==e[n]&&s.add(n);for(const n of Object.keys(e))r[n]!==e[n]&&s.add(n);s.forEach(n=>console.error(`  ${n}: current ${r[n]} new ${e[n]}`))}}else this._includedModules.set(e,i),e(this.builder,i)}},Ui=class extends d2e{constructor(){super(...arguments),this.vertex=new oae,this.fragment=new oae,this.attributes=new ltt,this.varyings=new ctt,this.extensions=new Mq,this.constants=new p2e}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const i=this.extensions.generateSource(e),r=this.attributes.generateSource(e),s=this.varyings.generateSource(),n=e==="vertex"?this.vertex:this.fragment,o=n.uniforms.generateSource(),a=n.code.generateSource(),l=e==="vertex"?htt:utt,c=this.constants.generateSource().concat(n.constants.generateSource());return`
${i.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${r.join(`
`)}

${s.join(`
`)}

${a.join(`
`)}`}generateBind(e,i){const r=new Map;this.vertex.uniforms.entries.forEach(o=>{const a=o.bind[e];v(a)&&r.set(o.name,a)}),this.fragment.uniforms.entries.forEach(o=>{const a=o.bind[e];v(a)&&r.set(o.name,a)});const s=Array.from(r.values()),n=s.length;return(o,a,l)=>{for(let c=0;c<n;++c)s[c](i,o,a,l)}}},ott=class{constructor(){this._entries=new Map}add(e){if(!Array.isArray(e))return this._add(e);for(const i of e)this._add(i)}get(e){return this._entries.get(e)}_add(e){if(C(e))h2e.error(`Trying to add null Uniform from ${new Error().stack}.`);else{if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new W(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}}generateSource(){return Array.from(this._entries.values()).map(e=>v(e.arraySize)?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}},att=class{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}},oae=class extends d2e{constructor(){super(...arguments),this.uniforms=new ott,this.code=new att,this.constants=new p2e}get builder(){return this}},ltt=class{constructor(){this._entries=new Array}add(e,i){this._entries.push([e,i])}generateSource(e){return e==="fragment"?[]:this._entries.map(i=>`attribute ${i[1]} ${i[0]};`)}},ctt=class{constructor(){this._entries=new Array}add(e,i){this._entries.push([e,i])}generateSource(){return this._entries.map(e=>`varying ${e[1]} ${e[0]};`)}},Mq=class Pq{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const i=e==="vertex"?Pq.ALLOWLIST_VERTEX:Pq.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(r=>i.includes(r)).map(r=>`#extension ${r} : enable`)}};Mq.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],Mq.ALLOWLIST_VERTEX=[];let p2e=class vn{constructor(){this._entries=new Set}add(e,i,r){let s="ERROR_CONSTRUCTOR_STRING";switch(i){case"float":s=vn._numberToFloatStr(r);break;case"int":s=vn._numberToIntStr(r);break;case"bool":s=r.toString();break;case"vec2":s=`vec2(${vn._numberToFloatStr(r[0])},                            ${vn._numberToFloatStr(r[1])})`;break;case"vec3":s=`vec3(${vn._numberToFloatStr(r[0])},                            ${vn._numberToFloatStr(r[1])},                            ${vn._numberToFloatStr(r[2])})`;break;case"vec4":s=`vec4(${vn._numberToFloatStr(r[0])},                            ${vn._numberToFloatStr(r[1])},                            ${vn._numberToFloatStr(r[2])},                            ${vn._numberToFloatStr(r[3])})`;break;case"ivec2":s=`ivec2(${vn._numberToIntStr(r[0])},                             ${vn._numberToIntStr(r[1])})`;break;case"ivec3":s=`ivec3(${vn._numberToIntStr(r[0])},                             ${vn._numberToIntStr(r[1])},                             ${vn._numberToIntStr(r[2])})`;break;case"ivec4":s=`ivec4(${vn._numberToIntStr(r[0])},                             ${vn._numberToIntStr(r[1])},                             ${vn._numberToIntStr(r[2])},                             ${vn._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${i}(${Array.prototype.map.call(r,n=>vn._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${i} ${e} = ${s};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const utt=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,htt=`precision highp float;
precision highp sampler2D;`,VK="Size",t8="InvSize";function ad(t,e,i=!1,r=0){if(t.hasWebGL2Context){const s=x`vec2(textureSize(${e}, ${x.int(r)}))`;return i?"(1.0 / "+s+")":s}return i?e+t8:e+VK}function hl(t,e,i,r=null,s=0){if(t.hasWebGL2Context)return x`texelFetch(${e}, ivec2(${i}), ${x.int(s)})`;let n=x`texture2D(${e}, ${i} * `;return n+=r?x`(${r}))`:x`${e+t8})`,n}var sr;(function(t){t[t.None=0]="None",t[t.Size=1]="Size",t[t.InvSize=2]="InvSize"})(sr||(sr={}));let zt=class extends Os{constructor(e,i){super(e,"sampler2D",gr.Pass,(r,s,n)=>r.bindTexture(e,i(s,n)))}};function jp(t,e,i=sr.None){const r=[new zt(t,e)];if(i&sr.Size){const s=t+VK;r.push(new zi(s,(n,o)=>{const a=e(n,o);return v(a)?It(aae,a.descriptor.width,a.descriptor.height):dc}))}if(i&sr.InvSize){const s=t+t8;r.push(new zi(s,(n,o)=>{const a=e(n,o);return v(a)?It(aae,1/a.descriptor.width,1/a.descriptor.height):dc}))}return r}const aae=et(),QM=Xe(parseFloat(Number(5802e-9).toFixed(6)),parseFloat(Number(13558e-9).toFixed(6)),parseFloat(Number(331e-7).toFixed(6))),Qk=3,e9=Xe(Qk*parseFloat(Number(65e-8).toFixed(6)),Qk*parseFloat(Number(1881e-9).toFixed(6)),Qk*parseFloat(Number(85e-9).toFixed(6))),dtt=3996e-9,ptt=Xe(parseFloat(Number(QM[0]+e9[0]).toFixed(6)),parseFloat(Number(QM[1]+e9[1]).toFixed(6)),parseFloat(Number(QM[2]+e9[2]).toFixed(6)));function ftt(t){const e=new Ui;e.attributes.add(A.POSITION,"vec2"),e.include(Im,{textureCoordinateType:Ks.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:i,fragment:r}=e;return i.uniforms.add([new Jr("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new Jr("inverseViewMatrix",(s,n)=>rA(mtt,n.camera.viewMatrix))]),i.code.add(x`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add([new zi("radii",s=>s.radii),new ni("cameraPosition",(s,n)=>n.camera.eye),new Si("heightParameters",s=>s.heightParameters),new He("innerFadeDistance",s=>s.innerFadeDistance),new He("altitudeFade",s=>s.altitudeFade),new zt("depthTex",s=>s.depthTex),new He("hazeStrength",s=>s.hazeStrength)]),r.constants.add("betaRayleigh","vec3",QM),r.constants.add("betaCombined","vec3",ptt),r.constants.add("betaMie","float",dtt),r.constants.add("scaleHeight","float",rtt*oP),l0(r),e.include(e8),t.haze&&(r.include(rh),r.uniforms.add(new zi("nearFar",(s,n)=>n.camera.nearFar))),r.code.add(x`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(x`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),r.code.add(x`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),r.code.add(x`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${t.haze?x`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${t.haze?x``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${t.haze?"":x`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${t.haze?x`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:x`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${t.haze?x`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:x`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}

      ${t.haze?x`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:x`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${t.haze?"":x`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, gl_FragColor);
          }`}
    }
  `),e}const mtt=We(),gtt=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:QM,build:ftt},Symbol.toStringTag,{value:"Module"}));let Vi=class{constructor(e,i){this._module=e,this._loadModule=i}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}};var Vr,jt,Ve,qm,Bt,Dp,CC,wt,Dr,ks,gt,kt,Pt,it,Lt,Ht,sl,Fi,ku,oo,gs,Di;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(Vr||(Vr={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(jt||(jt={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(Ve||(Ve={})),function(t){t[t.ADD=32774]="ADD",t[t.SUBTRACT=32778]="SUBTRACT",t[t.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(qm||(qm={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(Bt||(Bt={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(Dp||(Dp={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(CC||(CC={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT"}(wt||(wt={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(Dr||(Dr={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(ks||(ks={})),function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(gt||(gt={})),function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(kt||(kt={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(Pt||(Pt={})),function(t){t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(it||(it={})),function(t){t[t.RGBA4=32854]="RGBA4",t[t.R16F=33325]="R16F",t[t.RG16F=33327]="RG16F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB5_A1=32855]="RGB5_A1",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGB565=36194]="RGB565",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI"}(Lt||(Lt={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.INT=5124]="INT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(Ht||(Ht={})),function(t){t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(sl||(sl={})),function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(Fi||(Fi={})),function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(ku||(ku={})),function(t){t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(oo||(oo={})),function(t){t[t.TEXTURE=0]="TEXTURE",t[t.RENDER_BUFFER=1]="RENDER_BUFFER",t[t.CUBEMAP=2]="CUBEMAP"}(gs||(gs={})),function(t){t[t.NONE=0]="NONE",t[t.DEPTH_RENDER_BUFFER=1]="DEPTH_RENDER_BUFFER",t[t.STENCIL_RENDER_BUFFER=2]="STENCIL_RENDER_BUFFER",t[t.DEPTH_STENCIL_RENDER_BUFFER=3]="DEPTH_STENCIL_RENDER_BUFFER",t[t.DEPTH_STENCIL_TEXTURE=4]="DEPTH_STENCIL_TEXTURE"}(Di||(Di={}));const t9=33984;var Wn,Mu;(function(t){t[t.Texture=0]="Texture",t[t.BufferObject=1]="BufferObject",t[t.VertexArrayObject=2]="VertexArrayObject",t[t.Shader=3]="Shader",t[t.Program=4]="Program",t[t.FramebufferObject=5]="FramebufferObject",t[t.Renderbuffer=6]="Renderbuffer",t[t.Sync=7]="Sync",t[t.COUNT=8]="COUNT"})(Wn||(Wn={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(Mu||(Mu={}));const lae=33306;var Ns,tl,cae,uae,y5,Iq,hae;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(Ns||(Ns={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(tl||(tl={})),function(t){t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS"}(cae||(cae={})),function(t){t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED"}(uae||(uae={})),function(t){t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED"}(y5||(y5={})),function(t){t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(Iq||(Iq={})),function(t){t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(hae||(hae={}));let ji=class{constructor(e,i,r){this.release=r,this.initializeConfiguration(e,i),this._configuration=i.snapshot(),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}destroy(){this._program=ft(this._program),this._pipeline=this._configuration=null}reload(e){ft(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPipelineState(e,i=null,r){e.setPipelineState(this.getPipelineState(i,r))}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return jt.TRIANGLES}getPipelineState(e,i){return this._pipeline}initializeConfiguration(e,i){}};const Li=new Map([[A.POSITION,0],[A.NORMAL,1],[A.UV0,2],[A.COLOR,3],[A.SIZE,4],[A.TANGENT,4],[A.AUXPOS1,5],[A.SYMBOLCOLOR,5],[A.AUXPOS2,6],[A.FEATUREATTRIBUTE,6],[A.INSTANCEFEATUREATTRIBUTE,6],[A.INSTANCECOLOR,7],[A.OBJECTANDLAYERIDCOLOR,7],[A.OBJECTANDLAYERIDCOLOR_INSTANCED,7],[A.MODEL,8],[A.MODELNORMAL,12],[A.MODELORIGINHI,11],[A.MODELORIGINLO,15]]),ytt=oe.getLogger("esri.views.webgl.checkWebGLError");function _tt(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const f2e=!!de("enable-feature:webgl-debug");function $u(){return f2e}function $q(){return f2e}function ov(t){if($u()){const e=t.getError();if(e){const i=_tt(t,e),r=new Error().stack;ytt.error(new W("webgl-error","WebGL error occured",{message:i,stack:r}))}}}let ki=class{constructor(e,i,r){this._context=e,this._locations=r,this._textures=new Map,this._freeTextureUnits=new li({deallocator:null}),this._glProgram=e.programCache.acquire(i.generate("vertex"),i.generate("fragment"),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=i.generateBind(gr.Pass,this),this.bindDraw=i.generateBind(gr.Draw,this),this._fragmentUniforms=$u()?i.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get compiled(){return this._glProgram.compiled}setUniform1b(e,i){this._glProgram.setUniform1i(e,i?1:0)}setUniform1i(e,i){this._glProgram.setUniform1i(e,i)}setUniform1f(e,i){this._glProgram.setUniform1f(e,i)}setUniform2fv(e,i){this._glProgram.setUniform2fv(e,i)}setUniform3fv(e,i){this._glProgram.setUniform3fv(e,i)}setUniform4fv(e,i){this._glProgram.setUniform4fv(e,i)}setUniformMatrix3fv(e,i){this._glProgram.setUniformMatrix3fv(e,i)}setUniformMatrix4fv(e,i){this._glProgram.setUniformMatrix4fv(e,i)}setUniform1fv(e,i){this._glProgram.setUniform1fv(e,i)}setUniform1iv(e,i){this._glProgram.setUniform1iv(e,i)}setUniform2iv(e,i){this._glProgram.setUniform3iv(e,i)}setUniform3iv(e,i){this._glProgram.setUniform3iv(e,i)}setUniform4iv(e,i){this._glProgram.setUniform4iv(e,i)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,i){if(C(i)||i.glName==null){const s=this._textures.get(e);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(e)),null}let r=this._textures.get(e);return r==null?(r=this._allocTextureUnit(i),this._textures.set(e,r)):r.texture=i,this._context.useProgram(this),this.setUniform1i(e,r.unit),this._context.bindTexture(i,r.unit),r.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((e,i)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(i,e.unit)}),v(this._fragmentUniforms)&&this._fragmentUniforms.forEach(e=>{e.type!=="sampler2D"&&e.type!=="samplerCube"||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}};var Or,Bx,Fs,Ry,oc,Zy,Fv,AC,fr,zx,gy;(function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"})(Or||(Or={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(Bx||(Bx={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(Fs||(Fs={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(Ry||(Ry={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(oc||(oc={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee",t[t.COUNT=2]="COUNT"}(Zy||(Zy={})),function(t){t[t.STRETCH=1]="STRETCH",t[t.PAD=2]="PAD"}(Fv||(Fv={})),function(t){t[t.CHANGED=0]="CHANGED",t[t.UNCHANGED=1]="UNCHANGED"}(AC||(AC={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(fr||(fr={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(zx||(zx={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(gy||(gy={}));function of(t,e,i=qm.ADD,r=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function Yn(t,e,i,r,s=qm.ADD,n=qm.ADD,o=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:i,dstAlpha:r,opRgb:s,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const kK={face:Dp.BACK,mode:CC.CCW},m2e={face:Dp.FRONT,mode:CC.CCW},i8=t=>t===Or.Back?kK:t===Or.Front?m2e:null,pc={zNear:0,zFar:1},ui={r:!0,g:!0,b:!0,a:!0};function vtt(t){return Att.intern(t)}function btt(t){return Ott.intern(t)}function wtt(t){return Rtt.intern(t)}function xtt(t){return Mtt.intern(t)}function Ttt(t){return Ptt.intern(t)}function Stt(t){return Itt.intern(t)}function Ett(t){return $tt.intern(t)}function Ctt(t){return Ltt.intern(t)}function Qt(t){return Dtt.intern(t)}let c0=class{constructor(e,i){this._makeKey=e,this._makeRef=i,this._interns=new Map}intern(e){if(!e)return null;const i=this._makeKey(e),r=this._interns;return r.has(i)||r.set(i,this._makeRef(e)),r.get(i)??null}};function u0(t){return"["+t.join(",")+"]"}const Att=new c0(g2e,t=>({__tag:"Blending",...t}));function g2e(t){return t?u0([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const Ott=new c0(y2e,t=>({__tag:"Culling",...t}));function y2e(t){return t?u0([t.face,t.mode]):null}const Rtt=new c0(_2e,t=>({__tag:"PolygonOffset",...t}));function _2e(t){return t?u0([t.factor,t.units]):null}const Mtt=new c0(v2e,t=>({__tag:"DepthTest",...t}));function v2e(t){return t?u0([t.func]):null}const Ptt=new c0(b2e,t=>({__tag:"StencilTest",...t}));function b2e(t){return t?u0([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const Itt=new c0(w2e,t=>({__tag:"DepthWrite",...t}));function w2e(t){return t?u0([t.zNear,t.zFar]):null}const $tt=new c0(x2e,t=>({__tag:"ColorWrite",...t}));function x2e(t){return t?u0([t.r,t.g,t.b,t.a]):null}const Ltt=new c0(T2e,t=>({__tag:"StencilWrite",...t}));function T2e(t){return t?u0([t.mask]):null}const Dtt=new c0(Ntt,t=>({blending:vtt(t.blending),culling:btt(t.culling),polygonOffset:wtt(t.polygonOffset),depthTest:xtt(t.depthTest),stencilTest:Ttt(t.stencilTest),depthWrite:Stt(t.depthWrite),colorWrite:Ett(t.colorWrite),stencilWrite:Ctt(t.stencilWrite)}));function Ntt(t){return t?u0([g2e(t.blending),y2e(t.culling),_2e(t.polygonOffset),v2e(t.depthTest),b2e(t.stencilTest),w2e(t.depthWrite),x2e(t.colorWrite),T2e(t.stencilWrite)]):null}let Ftt=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(e,i,r,s){return(r||e!==i)&&(s(e),this._pipelineInvalid=!0),e}},Utt=class extends yr{constructor(){super(...arguments),this.heightParameters=fi(),this.radii=et(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1}},Lq=class S2e extends ji{initializeProgram(e){return new ki(e.rctx,S2e.shader.get().build(this.configuration),Li)}initializePipeline(){return this.configuration.haze?Qt({blending:Yn(Ve.ONE,Ve.ZERO,Ve.ONE_MINUS_SRC_COLOR,Ve.ONE),colorWrite:ui}):Qt({blending:Yn(Ve.SRC_ALPHA,Ve.ONE,Ve.ONE_MINUS_SRC_ALPHA,Ve.ONE_MINUS_SRC_ALPHA),depthTest:{func:Dr.LEQUAL},colorWrite:ui})}};Lq.shader=new Vi(gtt,()=>ee(()=>import("./ChapmanAtmosphere.glsl-3a9684e4.js"),[],import.meta.url));let Va=class extends yr{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,i={key:this.key};for(const r of e)i[r]=this[r];return i}};function z(t={}){return(e,i)=>{if(e._parameterNames=e._parameterNames??[],e._parameterNames.push(i),t.constValue!=null)Object.defineProperty(e,i,{get:()=>t.constValue});else{const r=e._parameterNames.length-1,s=t.count||2,n=Math.ceil(Math.log2(s)),o=e._parameterBits??[0];let a=0;for(;o[a]+n>16;)a++,a>=o.length&&o.push(0);e._parameterBits=o;const l=o[a],c=(1<<n)-1<<l;o[a]+=n,Object.defineProperty(e,i,{get(){return this[r]},set(h){if(this[r]!==h&&(this[r]=h,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+h<<l&c,typeof h!="number"&&typeof h!="boolean"))throw new Error("Configuration value for "+i+" must be boolean or number, got "+typeof h)}})}}}let E2e=class extends Va{constructor(){super(...arguments),this.haze=!1}};u([z()],E2e.prototype,"haze",void 0);let jo=class{constructor(e,i,r,s,n,o=!1,a=0){this.name=e,this.count=i,this.type=r,this.offset=s,this.stride=n,this.normalized=o,this.divisor=a}};new jo(A.POSITION,3,wt.FLOAT,0,12);new jo(A.POSITION,3,wt.FLOAT,0,20),new jo(A.UV0,2,wt.FLOAT,12,20);new jo(A.POSITION,3,wt.FLOAT,0,32),new jo(A.NORMAL,3,wt.FLOAT,12,32),new jo(A.UV0,2,wt.FLOAT,24,32);new jo(A.POSITION,3,wt.FLOAT,0,16),new jo(A.COLOR,4,wt.UNSIGNED_BYTE,12,16);const BK=[new jo(A.POSITION,2,wt.FLOAT,0,8)],gA=[new jo(A.POSITION,2,wt.FLOAT,0,16),new jo(A.UV0,2,wt.FLOAT,8,16)];function dae(t){const e=t.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function oa(t,e){return t.vertexBuffers[e].size/Vtt(t.layout[e])}function Vtt(t){return t[0].stride}function zK(t,e,i,r,s=0){const n=t.gl,o=t.capabilities.instancing;t.bindBuffer(i);for(const a of r){const l=e.get(a.name);l===void 0&&console.error(`There is no location for vertex attribute '${a.name}' defined.`);const c=s*a.stride;if(a.count<=4)n.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),n.enableVertexAttribArray(l),a.divisor>0&&o&&o.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let h=0;h<3;h++)n.vertexAttribPointer(l+h,3,a.type,a.normalized,a.stride,a.offset+12*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else if(a.count===16)for(let h=0;h<4;h++)n.vertexAttribPointer(l+h,4,a.type,a.normalized,a.stride,a.offset+16*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function GK(t,e,i,r){const s=t.gl,n=t.capabilities.instancing;t.bindBuffer(i);for(const o of r){const a=e.get(o.name);if(o.count<=4)s.disableVertexAttribArray(a),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a,0);else if(o.count===9)for(let l=0;l<3;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else if(o.count===16)for(let l=0;l<4;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else console.error("Unsupported vertex attribute element count: "+o.count)}t.unbindBuffer(Bt.ARRAY_BUFFER)}function C2e(t){switch(t){case it.ALPHA:case it.LUMINANCE:case it.RED:case it.RED_INTEGER:case Lt.R8:case Lt.R8I:case Lt.R8UI:case Lt.R8_SNORM:case sl.STENCIL_INDEX8:return 1;case it.LUMINANCE_ALPHA:case it.RG:case it.RG_INTEGER:case Lt.RGBA4:case Lt.R16F:case Lt.R16I:case Lt.R16UI:case Lt.RG8:case Lt.RG8I:case Lt.RG8UI:case Lt.RG8_SNORM:case Lt.RGB565:case Lt.RGB5_A1:case sl.DEPTH_COMPONENT16:return 2;case it.DEPTH_COMPONENT:case it.RGB:case it.RGB_INTEGER:case Lt.RGB8:case Lt.RGB8I:case Lt.RGB8UI:case Lt.RGB8_SNORM:case Lt.SRGB8:case sl.DEPTH_COMPONENT24:return 3;case it.DEPTH_STENCIL:case it.RGBA:case it.RGBA_INTEGER:case Lt.RGBA8:case Lt.R32F:case Lt.R11F_G11F_B10F:case Lt.RG16F:case Lt.R32I:case Lt.R32UI:case Lt.RG16I:case Lt.RG16UI:case Lt.RGBA8I:case Lt.RGBA8UI:case Lt.RGBA8_SNORM:case Lt.SRGB8_ALPHA8:case Lt.RGB9_E5:case Lt.RGB10_A2UI:case Lt.RGB10_A2:case sl.DEPTH_STENCIL:case sl.DEPTH_COMPONENT32F:case sl.DEPTH24_STENCIL8:return 4;case sl.DEPTH32F_STENCIL8:return 5;case Lt.RGB16F:case Lt.RGB16I:case Lt.RGB16UI:return 6;case Lt.RG32F:case Lt.RG32I:case Lt.RG32UI:case Lt.RGBA16F:case Lt.RGBA16I:case Lt.RGBA16UI:return 8;case Lt.RGB32F:case Lt.RGB32I:case Lt.RGB32UI:return 12;case Lt.RGBA32F:case Lt.RGBA32I:case Lt.RGBA32UI:return 16;case Ns.COMPRESSED_RGB_S3TC_DXT1_EXT:case Ns.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case Ns.COMPRESSED_RGBA_S3TC_DXT3_EXT:case Ns.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case Ns.COMPRESSED_R11_EAC:case Ns.COMPRESSED_SIGNED_R11_EAC:case Ns.COMPRESSED_RGB8_ETC2:case Ns.COMPRESSED_SRGB8_ETC2:case Ns.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case Ns.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case Ns.COMPRESSED_RG11_EAC:case Ns.COMPRESSED_SIGNED_RG11_EAC:case Ns.COMPRESSED_RGBA8_ETC2_EAC:case Ns.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}function Gx(t){if(C(t))return 0;if("descriptor"in t)return t.glName?Gx(t.descriptor):0;const e=t.internalFormat||"pixelFormat"in t&&t.pixelFormat;if(!e)return 0;const i="hasMipmap"in t&&t.hasMipmap?1.3:1,r=t.width*t.height;return C2e(e)*r*i}const N1=oe.getLogger("esri.views.webgl.VertexArrayObject");let vd=class{constructor(e,i,r,s,n=null){this._context=e,this._locations=i,this._layout=r,this._buffers=s,this._indexBuffer=n,this._glName=null,this._initialized=!1,e.instanceCounter.increment(Wn.VertexArrayObject,this)}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get size(){return Object.keys(this._buffers).reduce((e,i)=>e+this._buffers[i].size,v(this._indexBuffer)?this._indexBuffer.size:0)}get layout(){return this._layout}get locations(){return this._locations}dispose(e=!0){var i,r,s;if(!this._context)return void((this._glName||e&&Object.getOwnPropertyNames(this._buffers).length>0)&&N1.warn("Leaked WebGL VAO"));if(this._glName){const n=(r=(i=this._context)==null?void 0:i.capabilities)==null?void 0:r.vao;n?(n.deleteVertexArray(this._glName),this._glName=null):N1.warn("Leaked WebGL VAO")}if(this._context.getBoundVAO()===this&&this._context.bindVAO(null),e){for(const n in this._buffers)(s=this._buffers[n])==null||s.dispose(),delete this._buffers[n];this._indexBuffer=ft(this._indexBuffer)}this._context.instanceCounter.decrement(Wn.VertexArrayObject,this),this._context=yx(this._context)}initialize(){if(this._initialized)return;const e=this._context.capabilities.vao;if(e){const i=e.createVertexArray();e.bindVertexArray(i),this._bindLayout(),e.bindVertexArray(null),this._glName=i}this._initialized=!0}bind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:e,_layout:i,_indexBuffer:r}=this;e||N1.error("Vertex buffer dictionary is empty!");const s=this._context.gl;for(const n in e){const o=e[n];o||N1.error("Vertex buffer is uninitialized!");const a=i[n];a||N1.error("Vertex element descriptor is empty!"),zK(this._context,this._locations,o,a)}v(r)&&(this._context.capabilities.vao?s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,r.glName):this._context.bindBuffer(r))}unbind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:e,_layout:i}=this;e||N1.error("Vertex buffer dictionary is empty!");for(const r in e){const s=e[r];s||N1.error("Vertex buffer is uninitialized!");const n=i[r];GK(this._context,this._locations,s,n)}v(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)}},af=class extends vd{};var Mt;function ktt(t,e,i={}){const r=A2e(t);for(;r.length>1;){const s=_5(e,r.shift(),i);if(v(s))return s}return Btt(e,r.shift(),i)}function A2e(t){const e=de("esri-force-webgl");if(e===Mt.WEBGL1||e===Mt.WEBGL2)return[e];switch(t){case"2d":return de("mac")&&de("chrome")?[Mt.WEBGL1,Mt.WEBGL2]:[Mt.WEBGL2,Mt.WEBGL1];case"3d":return[Mt.WEBGL2,Mt.WEBGL1]}}function Btt(t,e,i={}){if(!window.WebGLRenderingContext)return pae(t,ztt),null;const r=_5(t,e,i);return C(r)&&pae(t,Gtt),r}function _5(t,e,i={}){const r=e===Mt.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];let s=null;for(const n of r){try{s=t.getContext(n,i)}catch{}if(s)break}return s}function pae(t,e){const i=t.parentNode;i&&(i.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+e+"</div></div></td></tr></table>")}(function(t){t[t.WEBGL1=1]="WEBGL1",t[t.WEBGL2=2]="WEBGL2"})(Mt||(Mt={}));const ztt='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',Gtt=`It doesn't appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>`,gf=oe.getLogger("esri.views.webgl.BufferObject");let Yi=class bS{static createIndex(e,i,r){return new bS(e,Bt.ELEMENT_ARRAY_BUFFER,i,r)}static createVertex(e,i,r){return new bS(e,Bt.ARRAY_BUFFER,i,r)}static createUniform(e,i,r){if(e.type!==Mt.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new bS(e,Bt.UNIFORM_BUFFER,i,r)}static createPixelPack(e,i=Fi.STREAM_READ,r){if(e.type!==Mt.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const s=new bS(e,Bt.PIXEL_PACK_BUFFER,i);return r&&s.setSize(r),s}static createPixelUnpack(e,i=Fi.STREAM_DRAW,r){if(e.type!==Mt.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new bS(e,Bt.PIXEL_UNPACK_BUFFER,i,r)}constructor(e,i,r,s){this._context=e,this.bufferType=i,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(Wn.BufferObject,this),this._glName=this._context.gl.createBuffer(),ov(this._context.gl),s&&this.setData(s)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteSize(){return this.bufferType===Bt.ELEMENT_ARRAY_BUFFER?this._indexType===wt.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===Bt.ELEMENT_ARRAY_BUFFER||this.bufferType===Bt.ARRAY_BUFFER}dispose(){var e;(e=this._context)!=null&&e.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(Wn.BufferObject,this),this._context=yx(this._context)):this._glName&&gf.warn("Leaked WebGL buffer object")}setSize(e,i=null){if(e<=0&&gf.error("Buffer size needs to be positive!"),this.bufferType===Bt.ELEMENT_ARRAY_BUFFER&&v(i))switch(this._indexType=i,i){case wt.UNSIGNED_SHORT:e*=2;break;case wt.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let i=e.byteLength;this.bufferType===Bt.ELEMENT_ARRAY_BUFFER&&(RY(e)&&(i/=2,this._indexType=wt.UNSIGNED_SHORT),MY(e)&&(i/=4,this._indexType=wt.UNSIGNED_INT)),this._setBufferData(i,e)}_setBufferData(e,i=null){this._size=e;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;v(i)?s.bufferData(this.bufferType,i,this.usage):s.bufferData(this.bufferType,e,this.usage),ov(s),this._isVAOAware&&this._context.bindVAO(r)}setSubData(e,i,r,s){if(!e)return;(i<0||i*e.BYTES_PER_ELEMENT>=this.byteSize)&&gf.error("offset is out of range!"),r>=s&&gf.error("end must be bigger than start!"),(i+(s-r))*e.BYTES_PER_ELEMENT>this.byteSize&&gf.error("An attempt to write beyond the end of the buffer!");const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;if(this._context.type===Mt.WEBGL2)o.bufferSubData(this.bufferType,i*e.BYTES_PER_ELEMENT,e,r,s-r);else{const a=r===0&&s===e.length?e:e.subarray(r,s);o.bufferSubData(this.bufferType,i*e.BYTES_PER_ELEMENT,a)}ov(o),this._isVAOAware&&this._context.bindVAO(n)}getSubData(e,i=0,r,s){if(this._context.type!==Mt.WEBGL2)return void gf.error("Get buffer subdata is supported in WebGL2 only!");if(r<0||s<0)return void gf.error("Problem getting subdata: offset and length were less than zero!");const n=jtt(e)?e.BYTES_PER_ELEMENT:1;if(n*((r??0)+(s??0))>e.byteLength)return void gf.error("Problem getting subdata: offset and length exceeded destination size!");i+n*(s??0)>this.byteSize&&gf.warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this._context.bindBuffer(this,Bt.COPY_READ_BUFFER),o.getBufferSubData(Bt.COPY_READ_BUFFER,i,e,r,s),this._context.unbindBuffer(Bt.COPY_READ_BUFFER)}async getSubDataAsync(e,i=0,r,s){this._context.type===Mt.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(e,i,r,s)):gf.error("Get buffer subdata is supported in WebGL2 only!")}};function jtt(t){return QLe(t)}const i9={target:Pt.TEXTURE_2D,samplingMode:gt.LINEAR,wrapMode:kt.REPEAT,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,isImmutable:!1},fae=4;let xt=class{constructor(e,i,r=null){this._context=e,this.type="texture",this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,e.instanceCounter.increment(Wn.Texture,this),this._descriptor={...i9,...i};for(const s in i9)this._descriptor[s]===void 0&&(this._descriptor[s]=i9[s]);if(e.type!==Mt.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),F1(this._descriptor.target)))throw new Error("3D and array textures are not supported in WebGL1");this._descriptor.target===Pt.TEXTURE_CUBE_MAP?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._context.gl&&this._glName&&(this._context.unbindTexture(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(Wn.Texture,this))}release(){this.dispose()}resize(e,i){const r=this._descriptor;if(r.width!==e||r.height!==i){if(this._wasImmutablyAllocated)throw new Error("Immutable textures can't be resized!");r.width=e,r.height=i,this._descriptor.target===Pt.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let i=Pt.TEXTURE_CUBE_MAP_POSITIVE_X;i<=Pt.TEXTURE_CUBE_MAP_NEGATIVE_Z;i++)this._setData(e,i)}setData(e){this._setData(e)}_setData(e,i){if(!this._context||!this._context.gl)return;const r=this._context.gl;this._glName||(this._glName=r.createTexture()),e===void 0&&(e=null);const s=this._descriptor,n=i??s.target,o=F1(n);e===null&&(s.width=s.width||fae,s.height=s.height||fae,o&&(s.depth=s.depth??1));const a=this._context.bindTexture(this,xt.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(xt.TEXTURE_UNIT_FOR_UPDATES),xt._validateTexture(this._context,s),this._configurePixelStorage(),ov(r);const l=s.pixelFormat;let c=s.internalFormat??this._deriveInternalFormat(l,s.dataType);if(r9(e)){let h=e.width,p=e.height;const f=1;e instanceof HTMLVideoElement&&(h=e.videoWidth,p=e.videoHeight),s.width&&s.height,o&&s.depth,s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,c,s.hasMipmap,h,p,f),this._texImage(n,0,c,h,p,f,e),ov(r),s.hasMipmap&&this.generateMipmap(),s.width===void 0&&(s.width=h),s.height===void 0&&(s.height=p),o&&s.depth===void 0&&(s.depth=f)}else{const{width:h,height:p,depth:f}=s;if(h==null||p==null)throw new Error("Width and height must be specified!");if(o&&f==null)throw new Error("Depth must be specified!");if(s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,c,s.hasMipmap,h,p,f),r.DEPTH24_STENCIL8&&c===r.DEPTH_STENCIL&&(c=r.DEPTH24_STENCIL8),dF(e)){const m=e.levels,y=mae(n,h,p,f),_=Math.min(y-1,m.length-1);v(this._context.gl2)?r.texParameteri(s.target,this._context.gl2.TEXTURE_MAX_LEVEL,_):s.hasMipmap=s.hasMipmap&&y===m.length;const b=c;if(!qtt(b))throw new Error("Attempting to use compressed data with an umcompressed format!");this._forEachMipmapLevel((w,S,T,E)=>{const O=m[Math.min(w,m.length-1)];this._compressedTexImage(n,w,b,S,T,E,O)},_)}else v(e)?(this._texImage(n,0,c,h,p,f,e),ov(r),s.hasMipmap&&this.generateMipmap()):this._forEachMipmapLevel((m,y,_,b)=>{this._texImage(n,m,c,y,_,b,null),ov(r)})}xt._applySamplingMode(r,this._descriptor),xt._applyWrapMode(r,this._descriptor),xt._applyAnisotropicFilteringParameters(this._context,this._descriptor),ov(r),this._context.bindTexture(a,xt.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,i,r,s,n,o,a=0){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._context.gl,c=this._descriptor,{pixelFormat:h,dataType:p,target:f,isImmutable:m}=c,y=c.internalFormat??this._deriveInternalFormat(h,p);if(m&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");const _=this._context.bindTexture(this,xt.TEXTURE_UNIT_FOR_UPDATES,!0);if((i<0||r<0||s>c.width||n>c.height||i+s>c.width||r+n>c.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),a){if(C(this._context.gl2))return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(this._context.gl2.UNPACK_SKIP_ROWS,a)}if(r9(o)?v(this._context.gl2)?this._context.gl2.texSubImage2D(f,e,i,r,s,n,h,p,o):l.texSubImage2D(f,e,i,r,h,p,o):dF(o)?l.compressedTexSubImage2D(f,e,i,r,s,n,y,o.levels[e]):l.texSubImage2D(f,e,i,r,s,n,h,p,o),a){if(C(this._context.gl2))return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(this._context.gl2.UNPACK_SKIP_ROWS,0)}this._context.bindTexture(_,xt.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,i,r,s,n,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._context.gl2;if(C(c))throw new Error("3D textures are not supported in WebGL1");const h=this._descriptor,{pixelFormat:p,dataType:f,isImmutable:m,target:y}=h,_=h.internalFormat??this._deriveInternalFormat(p,f);if(m&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");F1(y)||console.warn("Attempting to set 3D texture data on a non-3D texture");const b=this._context.bindTexture(this,xt.TEXTURE_UNIT_FOR_UPDATES);if(this._context.setActiveTexture(xt.TEXTURE_UNIT_FOR_UPDATES),(i<0||r<0||s<0||n>h.width||o>h.height||a>h.depth||i+n>h.width||r+o>h.height||s+a>h.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),dF(l))l=l.levels[e],c.compressedTexSubImage3D(y,e,i,r,s,n,o,a,_,l);else{const w=l;c.texSubImage3D(y,e,i,r,s,n,o,a,p,f,w)}this._context.bindTexture(b,xt.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new Error("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,xt._validateTexture(this._context,e)}e.samplingMode===gt.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=gt.LINEAR_MIPMAP_NEAREST):e.samplingMode===gt.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=gt.NEAREST_MIPMAP_NEAREST);const i=this._context.bindTexture(this,xt.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(xt.TEXTURE_UNIT_FOR_UPDATES),this._context.gl.generateMipmap(e.target),this._context.bindTexture(i,xt.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,xt._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._context.gl,i=this._descriptor;this._samplingModeDirty&&(xt._applySamplingMode(e,i),this._samplingModeDirty=!1),this._wrapModeDirty&&(xt._applyWrapMode(e,i),this._wrapModeDirty=!1)}_deriveInternalFormat(e,i){if(this._context.type===Mt.WEBGL1)return e;switch(i){case Ht.FLOAT:switch(e){case it.RGBA:return Lt.RGBA32F;case it.RGB:return Lt.RGB32F;default:throw new Error("Unable to derive format")}case Ht.UNSIGNED_BYTE:switch(e){case it.RGBA:return Lt.RGBA8;case it.RGB:return Lt.RGB8}default:return e}}_configurePixelStorage(){const e=this._context.gl,{unpackAlignment:i,flipped:r,preMultiplyAlpha:s}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,i),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_texStorage(e,i,r,s,n,o){const a=this._context.gl2;if(C(a))throw new Error("Immutable textures are not supported in WebGL1");if(!Htt(i))throw new Error("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=r?mae(e,s,n,o):1;if(F1(e)){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,i,s,n,o)}else a.texStorage2D(e,l,i,s,n);this._wasImmutablyAllocated=!0}_texImage(e,i,r,s,n,o,a){const l=this._context.gl;let c=null;const h=this._context.type===Mt.WEBGL2,p=F1(e),{isImmutable:f,pixelFormat:m,dataType:y}=this._descriptor;if(h&&(c=l),h||!r9(a))if(f){if(v(a)){const _=a;if(p){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");c.texSubImage3D(e,i,0,0,0,s,n,o,m,y,_)}else l.texSubImage2D(e,i,0,0,s,n,m,y,_)}}else{const _=a;if(p){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");c.texImage3D(e,i,r,s,n,o,0,m,y,_)}else l.texImage2D(e,i,r,s,n,0,m,y,_)}else l.texImage2D(e,0,r,m,y,a)}_compressedTexImage(e,i,r,s,n,o,a){const l=this._context.gl;let c=null;const h=F1(e),p=this._descriptor.isImmutable;if(h){if(this._context.type!==Mt.WEBGL2)throw new Error("3D textures are not supported in WebGL1");c=l}if(p){if(v(a))if(h){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");c.compressedTexSubImage3D(e,i,0,0,0,s,n,o,r,a)}else l.compressedTexSubImage2D(e,i,0,0,s,n,r,a)}else if(h){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");c.compressedTexImage3D(e,i,r,s,n,o,0,a)}else l.compressedTexImage2D(e,i,r,s,n,0,a)}_forEachMipmapLevel(e,i=1/0){let{width:r,height:s,depth:n,hasMipmap:o,target:a}=this._descriptor;const l=a===Pt.TEXTURE_3D;if(r==null||s==null||l&&n==null)throw new Error("Missing texture dimensions for mipmap calculation");for(let c=0;e(c,r,s,n),o&&(r!==1||s!==1||l&&n!==1)&&!(c>=i);++c)r=Math.max(1,r>>1),s=Math.max(1,s>>1),l&&(n=Math.max(1,n>>1))}static _validateTexture(e,i){(i.width!=null&&i.width<0||i.height!=null&&i.height<0||i.depth!=null&&i.depth<0)&&console.error("Negative dimension parameters are not allowed!");const r=e.type===Mt.WEBGL2,s=i.width!=null&&Yp(i.width)&&i.height!=null&&Yp(i.height);r||!i.isImmutable&&!F1(i.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),r||s||(typeof i.wrapMode=="number"?i.wrapMode!==kt.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):i.wrapMode.s===kt.CLAMP_TO_EDGE&&i.wrapMode.t===kt.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),i.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(e,i){let r=i.samplingMode,s=i.samplingMode;r===gt.LINEAR_MIPMAP_NEAREST||r===gt.LINEAR_MIPMAP_LINEAR?(r=gt.LINEAR,i.hasMipmap||(s=gt.LINEAR)):r!==gt.NEAREST_MIPMAP_NEAREST&&r!==gt.NEAREST_MIPMAP_LINEAR||(r=gt.NEAREST,i.hasMipmap||(s=gt.NEAREST)),e.texParameteri(i.target,e.TEXTURE_MAG_FILTER,r),e.texParameteri(i.target,e.TEXTURE_MIN_FILTER,s)}static _applyWrapMode(e,i){typeof i.wrapMode=="number"?(e.texParameteri(i.target,e.TEXTURE_WRAP_S,i.wrapMode),e.texParameteri(i.target,e.TEXTURE_WRAP_T,i.wrapMode)):(e.texParameteri(i.target,e.TEXTURE_WRAP_S,i.wrapMode.s),e.texParameteri(i.target,e.TEXTURE_WRAP_T,i.wrapMode.t))}static _applyAnisotropicFilteringParameters(e,i){const r=e.capabilities.textureFilterAnisotropic;r&&e.gl.texParameterf(i.target,r.TEXTURE_MAX_ANISOTROPY,i.maxAnisotropy??1)}};function Htt(t){return t in Lt}function qtt(t){return t in Ns}function dF(t){return v(t)&&"type"in t&&t.type==="compressed"}function Wtt(t){return v(t)&&"byteLength"in t}function r9(t){return v(t)&&!dF(t)&&!Wtt(t)}function F1(t){return t===Pt.TEXTURE_3D||t===Pt.TEXTURE_2D_ARRAY}function mae(t,e,i,r=1){let s=Math.max(e,i);return t===Pt.TEXTURE_3D&&(s=Math.max(s,r)),Math.round(Math.log(s)/Math.LN2)+1}xt.TEXTURE_UNIT_FOR_UPDATES=0;function ka(t,e=BK,i=Li,r=-1,s=1){let n=null;return e===gA?n=new Float32Array([r,r,0,0,s,r,1,0,r,s,0,1,s,s,1,1]):n=new Float32Array([r,r,s,r,r,s,s,s]),new af(t,i,{geometry:e},{geometry:Yi.createVertex(t,Fi.STATIC_DRAW,n)})}function Xtt(t,e=BK,i=Li){const r=new Float32Array([-1,-1,3,-1,-1,3]);return new af(t,i,{geometry:e},{geometry:Yi.createVertex(t,Fi.STATIC_DRAW,r)})}const O2e=4;function R2e(t,e=O2e){return new xt(t,{target:Pt.TEXTURE_2D,pixelFormat:it.RGBA,dataType:Ht.UNSIGNED_BYTE,samplingMode:gt.NEAREST,width:e,height:e})}function Ytt(t,e,i=O2e){const r=new Uint8Array(i*i*4);for(let s=0;s<r.length;s+=4)r[s+0]=255*e[0],r[s+1]=255*e[1],r[s+2]=255*e[2],r[s+3]=255*e[3];return new xt(t,{target:Pt.TEXTURE_2D,pixelFormat:it.RGBA,dataType:Ht.UNSIGNED_BYTE,samplingMode:gt.NEAREST,width:i,height:i},r)}function M2e(t){return new xt(t,{target:Pt.TEXTURE_2D,pixelFormat:it.RGBA,dataType:Ht.UNSIGNED_BYTE,samplingMode:gt.NEAREST,width:1,height:1},new Uint8Array([255,255,255,255]))}let s9=class{constructor(e,i){this._view=e,this.type=Vn.Realistic,this._handles=new Ki,this._passParameters=new Utt,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=Oi.radius,this._fadeHaze=0,this._updateRadius(Oi.radius);const r=i.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([re(()=>this._view.basemapTerrain.rootTileElevationBounds,()=>this._updateRootTileElevationBounds()),re(()=>this._view.basemapTerrain.visibleElevationBounds,()=>this._updateVisibleElevationBounds())]);const s=new E2e;s.haze=!1,this._atmosphereTechnique=i.techniqueRepository.acquire(Lq,s),s.haze=!0,this._atmosphereHazeTechnique=i.techniqueRepository.acquire(Lq,s),this._vao=ka(r,gA)}destroy(){this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._vao.dispose(),this._handles.destroy()}render(e){this._render(e,this._atmosphereTechnique,e.offscreenRenderingHelper.depthTexture)}renderHaze(e,i){this._fadeHaze=i,this._render(e,this._atmosphereHazeTechnique,e.offscreenRenderingHelper.linearDepthTexture)}_render(e,i,r){if(C(r))return;this._update(e.bindParameters.camera),this._passParameters.depthTex=r;const s=e.rctx.bindTechnique(i,this._passParameters,e.bindParameters);e.offscreenRenderingHelper.renderDepthDetached(()=>this._renderCommon(s,e))}_renderCommon(e,i){C(this._vao)||(i.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.rctx.drawArrays(jt.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(e){return e*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const e=this._view.basemapTerrain.rootTileElevationBounds.min;e!==this._rootTileElevationMin&&(this._rootTileElevationMin=e,this._lowerBoundEarthRadius=Oi.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=this._adjustRadiusForTesselation(Oi.radius+this._view.basemapTerrain.visibleElevationBounds.min);e<this._lowerBoundEarthRadius&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,It(this._passParameters.radii,e,e+oP),this._passParameters.innerFadeDistance=2*Math.sqrt((2*e-Rq)*Rq)}_update(e){if(C(e))return;const i=Ea(e.eye),r=Math.sqrt(i),s=i-this._passParameters.radii[1]*this._passParameters.radii[1],n=we((r-this._passParameters.radii[0])/oP,0,1);nr(this._passParameters.heightParameters,r,i,s,n),this._passParameters.altitudeFade=UK(r-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=Yt(Yt(.6,1,ZE(9500,10500,r-Oi.radius)),1,this._fadeHaze)}static isSupported(e){return e.renderContext.rctx.capabilities.depthTexture}};function qr(){return new Float32Array(3)}function v5(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function er(t,e,i){const r=new Float32Array(3);return r[0]=t,r[1]=e,r[2]=i,r}function P2e(t,e){return new Float32Array(t,e,3)}function jK(){return qr()}function I2e(){return er(1,1,1)}function $2e(){return er(1,0,0)}function L2e(){return er(0,1,0)}function D2e(){return er(0,0,1)}const Ztt=jK(),Jtt=I2e(),Ktt=$2e(),Qtt=L2e(),eit=D2e();Object.freeze(Object.defineProperty({__proto__:null,ONES:Jtt,UNIT_X:Ktt,UNIT_Y:Qtt,UNIT_Z:eit,ZEROS:Ztt,clone:v5,create:qr,createView:P2e,fromValues:er,ones:I2e,unitX:$2e,unitY:L2e,unitZ:D2e,zeros:jK},Symbol.toStringTag,{value:"Module"}));function N2e(t){t.extensions.add("GL_EXT_shader_texture_lod"),t.extensions.add("GL_OES_standard_derivatives"),t.fragment.code.add(x`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)}function HK(t,e){switch(t.include(Im,e),t.fragment.code.add(x`
  struct TextureLookupParameter {
    vec2 uv;
    ${e.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `),e.textureCoordinateType){case Ks.Default:case Ks.Compressed:return void t.fragment.code.add(x`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return texture2D(texture, params.uv);
}`);case Ks.Atlas:return t.include(N2e),void t.fragment.code.add(x`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return textureAtlasLookup(texture, params.size, params.uv, vuvRegion);
}`);default:e.textureCoordinateType;case Ks.None:case Ks.COUNT:return}}let Ku=class extends Os{constructor(e,i){super(e,"vec3",gr.Draw,(r,s,n,o)=>r.setUniform3fv(e,i(s,n,o)))}},aP=class extends Os{constructor(e,i){super(e,"vec2",gr.Draw,(r,s,n,o)=>r.setUniform2fv(e,i(s,n,o)))}},wI=class extends Os{constructor(e,i){super(e,"sampler2D",gr.Draw,(r,s,n)=>r.bindTexture(e,i(s,n)))}};function Uv(t,e,i=sr.None){const r=[new wI(t,e)];if(i&sr.Size){const s=t+VK;r.push(new aP(s,(n,o)=>{const a=e(n,o);return v(a)?It(gae,a.descriptor.width,a.descriptor.height):dc}))}if(i&sr.InvSize){const s=t+t8;r.push(new aP(s,(n,o)=>{const a=e(n,o);return v(a)?It(gae,1/a.descriptor.width,1/a.descriptor.height):dc}))}return r}const gae=et();let w1=class{constructor(e){this._material=e.material,this._techniqueRepository=e.techniqueRep,this._output=e.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}ensureTechnique(e,i){return this._technique=this._techniqueRepository.releaseAndAcquire(e,this._material.getConfiguration(this._output,i),this._technique),this._technique}ensureResources(e){return Ry.LOADED}},qK=class extends w1{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textureRepository=e.textureRep,this._textureId=e.textureId,this._acquire(e.textureId,i=>this._texture=i),this._acquire(e.normalTextureId,i=>this._textureNormal=i),this._acquire(e.emissiveTextureId,i=>this._textureEmissive=i),this._acquire(e.occlusionTextureId,i=>this._textureOcclusion=i),this._acquire(e.metallicRoughnessTextureId,i=>this._textureMetallicRoughness=i)}dispose(){this._texture=Wr(this._texture),this._textureNormal=Wr(this._textureNormal),this._textureEmissive=Wr(this._textureEmissive),this._textureOcclusion=Wr(this._textureOcclusion),this._textureMetallicRoughness=Wr(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?Ry.LOADED:Ry.LOADING}get textureBindParameters(){return new F2e(v(this._texture)?this._texture.glTexture:null,v(this._textureNormal)?this._textureNormal.glTexture:null,v(this._textureEmissive)?this._textureEmissive.glTexture:null,v(this._textureOcclusion)?this._textureOcclusion.glTexture:null,v(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){(C(this._texture)||e!==this._texture.id)&&(this._texture=Wr(this._texture),this._textureId=e,this._acquire(this._textureId,i=>this._texture=i))}_acquire(e,i){if(C(e))return void i(null);const r=this._textureRepository.acquire(e);if(su(r))return++this._numLoading,void r.then(s=>{if(this._disposed)return Wr(s),void i(null);i(s)}).finally(()=>--this._numLoading);i(r)}},F2e=class extends yr{constructor(e=null,i=null,r=null,s=null,n=null){super(),this.texture=e,this.textureNormal=i,this.textureEmissive=r,this.textureOcclusion=s,this.textureMetallicRoughness=n}};const rDt=er(0,.6,.2);var St;(function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Terrain=5]="Terrain",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"})(St||(St={}));function WK(t,e){const i=t.fragment,r=e.hasMetallicRoughnessTexture||e.hasEmissionTexture||e.hasOcclusionTexture;if(e.pbrMode===St.Normal&&r&&t.include(HK,e),e.pbrMode!==St.Schematic)if(e.pbrMode!==St.Disabled){if(e.pbrMode===St.Normal){i.code.add(x`vec3 mrr;
vec3 emission;
float occlusion;`);const s=e.supportsTextureAtlas?e.hasWebGL2Context?sr.None:sr.Size:sr.None,n=e.pbrTextureBindType;e.hasMetallicRoughnessTexture&&(i.uniforms.add(n===gr.Pass?jp("texMetallicRoughness",o=>o.textureMetallicRoughness,s):Uv("texMetallicRoughness",o=>o.textureMetallicRoughness,s)),i.code.add(x`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),e.hasEmissionTexture&&(i.uniforms.add(n===gr.Pass?jp("texEmission",o=>o.textureEmissive,s):Uv("texEmission",o=>o.textureEmissive,s)),i.code.add(x`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),e.hasOcclusionTexture?(i.uniforms.add(n===gr.Pass?jp("texOcclusion",o=>o.textureOcclusion,s):Uv("texOcclusion",o=>o.textureOcclusion,s)),i.code.add(x`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):i.code.add(x`float getBakedOcclusion() { return 1.0; }`),i.uniforms.add(n===gr.Pass?[new ni("emissionFactor",o=>o.emissiveFactor),new ni("mrrFactors",o=>o.mrrFactors)]:[new Ku("emissionFactor",o=>o.emissiveFactor),new Ku("mrrFactors",o=>o.mrrFactors)]),i.code.add(x`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${r?x`vtc.uv = vuv0;`:""}
      ${e.hasMetallicRoughnessTextureTransform?x`vtc.uv = metallicRoughnessUV;`:""}
      ${e.hasMetallicRoughnessTexture?e.supportsTextureAtlas?x`
                vtc.size = ${ad(e,"texMetallicRoughness")};
                applyMetallnessAndRoughness(vtc);`:x`applyMetallnessAndRoughness(vtc);`:""}
      ${e.hasEmissiveTextureTransform?x`vtc.uv = emissiveUV;`:""}
      ${e.hasEmissionTexture?e.supportsTextureAtlas?x`
                vtc.size = ${ad(e,"texEmission")};
                applyEmission(vtc);`:x`applyEmission(vtc);`:""}
      ${e.hasOcclusionTextureTransform?x`vtc.uv = occlusionUV;`:""}
      ${e.hasOcclusionTexture?e.supportsTextureAtlas?x`
                vtc.size = ${ad(e,"texOcclusion")};
                applyOcclusion(vtc);`:x`applyOcclusion(vtc);`:""}
    }
  `)}}else i.code.add(x`float getBakedOcclusion() { return 1.0; }`);else i.code.add(x`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function XK(t,e){const i=t.fragment,r=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;r===0?(i.uniforms.add(new ni("lightingAmbientSH0",(s,n)=>fe(yae,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0]))),i.code.add(x`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===1?(i.uniforms.add([new Si("lightingAmbientSH_R",(s,n)=>nr(yg,n.lighting.sh.r[0],n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3])),new Si("lightingAmbientSH_G",(s,n)=>nr(yg,n.lighting.sh.g[0],n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3])),new Si("lightingAmbientSH_B",(s,n)=>nr(yg,n.lighting.sh.b[0],n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3]))]),i.code.add(x`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===2&&(i.uniforms.add([new ni("lightingAmbientSH0",(s,n)=>fe(yae,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0])),new Si("lightingAmbientSH_R1",(s,n)=>nr(yg,n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3],n.lighting.sh.r[4])),new Si("lightingAmbientSH_G1",(s,n)=>nr(yg,n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3],n.lighting.sh.g[4])),new Si("lightingAmbientSH_B1",(s,n)=>nr(yg,n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3],n.lighting.sh.b[4])),new Si("lightingAmbientSH_R2",(s,n)=>nr(yg,n.lighting.sh.r[5],n.lighting.sh.r[6],n.lighting.sh.r[7],n.lighting.sh.r[8])),new Si("lightingAmbientSH_G2",(s,n)=>nr(yg,n.lighting.sh.g[5],n.lighting.sh.g[6],n.lighting.sh.g[7],n.lighting.sh.g[8])),new Si("lightingAmbientSH_B2",(s,n)=>nr(yg,n.lighting.sh.b[5],n.lighting.sh.b[6],n.lighting.sh.b[7],n.lighting.sh.b[8]))]),i.code.add(x`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==St.Normal&&e.pbrMode!==St.Schematic||i.code.add(x`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const yae=M(),yg=fi();function xI(t){t.vertex.code.add(x`const float PI = 3.141592653589793;`),t.fragment.code.add(x`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var Us,jx;function tit(t){return v(t)&&v(t.cubeMap)}function YK(t){return v(t)&&!t.running}(function(t){t[t.RENDERING=0]="RENDERING",t[t.FINISHED_RENDERING=1]="FINISHED_RENDERING",t[t.FADING_TEXTURE_CHANNELS=2]="FADING_TEXTURE_CHANNELS",t[t.SWITCH_CHANNELS=3]="SWITCH_CHANNELS",t[t.FINISHED=4]="FINISHED"})(Us||(Us={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA"}(jx||(jx={}));let iit=class{constructor(){this.readChannels=jx.RG,this.renderingStage=Us.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=M(),this.isCameraPositionFinal=!0,this.parallax=new _ae,this.parallaxNew=new _ae,this.crossFade={enabled:!1,factor:1,distanceThresholdFactor:.3},this.fadeInOut={stage:kn.FINISHED,factor:1,distanceThresholdFactor:.6},this.fadeIn={stage:kc.FINISHED,factor:1,distanceThresholdFactor:2},this.fadeInOutHeight={stage:i1.FINISHED,factor:-1}}get isFading(){return this.fadeInOut.stage===kn.FADE_OUT||this.fadeInOut.stage===kn.FADE_IN||this.fadeIn.stage===kc.FADE_IN||this.fadeInOutHeight.stage!==i1.FINISHED||this.renderingStage===Us.FADING_TEXTURE_CHANNELS}};var kc,kn,i1;(function(t){t[t.FINISHED=0]="FINISHED",t[t.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",t[t.FADE_IN=2]="FADE_IN"})(kc||(kc={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.FADE_OUT=1]="FADE_OUT",t[t.SWITCH=2]="SWITCH",t[t.FADE_IN=3]="FADE_IN"}(kn||(kn={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.HEIGHT_FADE=1]="HEIGHT_FADE"}(i1||(i1={}));let _ae=class{constructor(){this.anchorPointClouds=M(),this.cloudsHeight=1e5,this.radiusCurvatureCorrectionFactor=0,this.transform=We()}},My=class extends Os{constructor(e,i){super(e,"bool",gr.Pass,(r,s,n)=>r.setUniform1b(e,i(s,n)))}},rit=class extends Os{constructor(e,i){super(e,"samplerCube",gr.Pass,(r,s,n)=>r.bindTexture(e,i(s,n)))}};function U2e(t){const e=t.fragment;e.uniforms.add([new Jr("rotationMatrixClouds",(i,r)=>r.cloudsFade.parallax.transform),new Jr("rotationMatrixCloudsCrossFade",(i,r)=>r.cloudsFade.parallaxNew.transform),new ni("anchorPosition",(i,r)=>r.cloudsFade.parallax.anchorPointClouds),new ni("anchorPositionCrossFade",(i,r)=>r.cloudsFade.parallaxNew.anchorPointClouds),new He("cloudsHeight",(i,r)=>r.cloudsFade.parallax.cloudsHeight),new He("radiusCurvatureCorrectionFactor",(i,r)=>r.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new He("totalFadeInOut",(i,r)=>r.cloudsFade.fadeInOut.stage===kn.FINISHED?r.cloudsFade.fadeInOutHeight.factor+1-r.cloudsFade.fadeIn.factor:r.cloudsFade.fadeInOutHeight.factor+1-r.cloudsFade.fadeInOut.factor),new He("crossFadeAnchorFactor",(i,r)=>we(r.cloudsFade.crossFade.factor,0,1)),new rit("cubeMap",(i,r)=>v(r.cloudsFade.data)&&v(r.cloudsFade.data.cubeMap)?r.cloudsFade.data.cubeMap.colorTexture:null),new My("crossFade",(i,r)=>r.cloudsFade.crossFade.enabled),new My("readChannelsRG",(i,r)=>r.cloudsFade.readChannels===jx.RG),new My("fadeTextureChannels",(i,r)=>r.cloudsFade.renderingStage===Us.FADING_TEXTURE_CHANNELS)]),e.constants.add("planetRadius","float",Oi.radius),e.code.add(x`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),e.code.add(x`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),e.code.add(x`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),l0(e),rg(e),e.code.add(x`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),e.code.add(x`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),e.code.add(x`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),e.code.add(x`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),e.code.add(x`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function sg(t){t.code.add(x`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function sit(){const t=new Ui;t.attributes.add(A.POSITION,"vec2"),t.varyings.add("worldRay","vec3");const{vertex:e,fragment:i}=t;return e.uniforms.add([new Jr("inverseProjectionMatrix",(r,s)=>s.camera.inverseProjectionMatrix),new Jr("inverseViewMatrix",(r,s)=>rA(nit,s.camera.viewMatrix))]),e.code.add(x`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),i.include(sg),i.include(ou),t.include(XK,{pbrMode:St.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(xI),t.include(e8),t.include(g5,{useLegacyTerrainShading:!1}),t.include(U2e,{instancedDoublePrecision:!1,useLegacyTerrainShading:!1}),i.uniforms.add([new ni("cameraPosition",(r,s)=>s.camera.eye)]),i.code.add(x`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),t}const nit=We(),oit=Object.freeze(Object.defineProperty({__proto__:null,build:sit},Symbol.toStringTag,{value:"Module"}));let V2e=class k2e extends ji{constructor(e){super(e,new Va,()=>this.destroy())}initializeProgram(e){return new ki(e.rctx,k2e.shader.get().build(),Li)}initializePipeline(){return Qt({blending:Yn(Ve.ONE,Ve.ZERO,Ve.SRC_ALPHA,Ve.ONE),depthTest:{func:Dr.LEQUAL},colorWrite:ui})}};V2e.shader=new Vi(oit,()=>ee(()=>import("./CloudsComposition.glsl-c14a662a.js"),[],import.meta.url));let iw=class extends $e{constructor(e){super(e),this._technique=new V2e(e),this._vao=ka(e.rctx)}destroy(){this._technique=Wr(this._technique),this._vao=ft(this._vao)}render(e){const i=e.bindParameters.cloudsFade;if(C(this._vao)||C(i.data))return;if(!this._technique.compiled)return void this.requestRender();const r=e.rctx.bindTechnique(this._technique,ait,e.bindParameters);e.rctx.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(jt.TRIANGLE_STRIP,0,4)}};u([d({constructOnly:!0})],iw.prototype,"rctx",void 0),u([d({constructOnly:!0})],iw.prototype,"viewingMode",void 0),u([d({constructOnly:!0})],iw.prototype,"planetRadius",void 0),u([d({constructOnly:!0})],iw.prototype,"requestRender",void 0),iw=u([I("esri.views.3d.environment.CloudsComposition")],iw);const ait=new yr;function bd(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function lit(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function ZK(t,e,i,r,s,n,o,a,l,c){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t}function JK(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function wd(t,e){if(t===e){const i=e[1],r=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function mT(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=h*o-a*c,f=-h*n+a*l,m=c*n-o*l;let y=i*p+r*f+s*m;return y?(y=1/y,t[0]=p*y,t[1]=(-h*r+s*c)*y,t[2]=(a*r-s*o)*y,t[3]=f*y,t[4]=(h*i-s*l)*y,t[5]=(-a*i+s*n)*y,t[6]=m*y,t[7]=(-c*i+r*l)*y,t[8]=(o*i-r*n)*y,t):null}function cit(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return t[0]=o*h-a*c,t[1]=s*c-r*h,t[2]=r*a-s*o,t[3]=a*l-n*h,t[4]=i*h-s*l,t[5]=s*n-i*a,t[6]=n*c-o*l,t[7]=r*l-i*c,t[8]=i*o-r*n,t}function uit(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*n-o*l)+i*(-c*s+o*a)+r*(l*s-n*a)}function OC(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],f=i[0],m=i[1],y=i[2],_=i[3],b=i[4],w=i[5],S=i[6],T=i[7],E=i[8];return t[0]=f*r+m*o+y*c,t[1]=f*s+m*a+y*h,t[2]=f*n+m*l+y*p,t[3]=_*r+b*o+w*c,t[4]=_*s+b*a+w*h,t[5]=_*n+b*l+w*p,t[6]=S*r+T*o+E*c,t[7]=S*s+T*a+E*h,t[8]=S*n+T*l+E*p,t}function b5(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],f=i[0],m=i[1];return t[0]=r,t[1]=s,t[2]=n,t[3]=o,t[4]=a,t[5]=l,t[6]=f*r+m*o+c,t[7]=f*s+m*a+h,t[8]=f*n+m*l+p,t}function KK(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],f=Math.sin(i),m=Math.cos(i);return t[0]=m*r+f*o,t[1]=m*s+f*a,t[2]=m*n+f*l,t[3]=m*o-f*r,t[4]=m*a-f*s,t[5]=m*l-f*n,t[6]=c,t[7]=h,t[8]=p,t}function QK(t,e,i){const r=i[0],s=i[1],n=i[2];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=n*e[6],t[7]=n*e[7],t[8]=n*e[8],t}function hit(t,e,i){const r=i[0],s=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t}function dit(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function pit(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function fit(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function mit(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function eQ(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=i+i,a=r+r,l=s+s,c=i*o,h=r*o,p=r*a,f=s*o,m=s*a,y=s*l,_=n*o,b=n*a,w=n*l;return t[0]=1-p-y,t[3]=h-w,t[6]=f+b,t[1]=h+w,t[4]=1-c-y,t[7]=m-_,t[2]=f-b,t[5]=m+_,t[8]=1-c-p,t}function B2e(t,e){const i=e[0],r=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10],p=h*o-a*c,f=-h*n+a*l,m=c*n-o*l,y=i*p+r*f+s*m;if(!y)return null;const _=1/y;return t[0]=p*_,t[1]=(-h*r+s*c)*_,t[2]=(a*r-s*o)*_,t[3]=f*_,t[4]=(h*i-s*l)*_,t[5]=(-a*i+s*n)*_,t[6]=m*_,t[7]=(-c*i+r*l)*_,t[8]=(o*i-r*n)*_,t}function RC(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],m=e[11],y=e[12],_=e[13],b=e[14],w=e[15],S=i*a-r*o,T=i*l-s*o,E=i*c-n*o,O=r*l-s*a,R=r*c-n*a,L=s*c-n*l,P=h*_-p*y,F=h*b-f*y,V=h*w-m*y,B=p*b-f*_,G=p*w-m*_,te=f*w-m*b;let se=S*te-T*G+E*B+O*V-R*F+L*P;return se?(se=1/se,t[0]=(a*te-l*G+c*B)*se,t[1]=(l*V-o*te-c*F)*se,t[2]=(o*G-a*V+c*P)*se,t[3]=(s*G-r*te-n*B)*se,t[4]=(i*te-s*V+n*F)*se,t[5]=(r*V-i*G-n*P)*se,t[6]=(_*L-b*R+w*O)*se,t[7]=(b*E-y*L-w*T)*se,t[8]=(y*R-_*E+w*S)*se,t):null}function git(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function yit(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function _it(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function vit(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t}function z2e(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}function bit(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t}function wit(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t}function xit(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function Tit(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=e[0],f=e[1],m=e[2],y=e[3],_=e[4],b=e[5],w=e[6],S=e[7],T=e[8],E=Fa();return Math.abs(i-p)<=E*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(r-f)<=E*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(s-m)<=E*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(n-y)<=E*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(o-_)<=E*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(a-b)<=E*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(l-w)<=E*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(c-S)<=E*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(h-T)<=E*Math.max(1,Math.abs(h),Math.abs(T))}function tQ(t){const e=Fa(),i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8];return Math.abs(1-(i*i+n*n+l*l))<=e&&Math.abs(1-(r*r+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+h*h))<=e}const Sit=OC,Eit=z2e;Object.freeze(Object.defineProperty({__proto__:null,add:vit,adjoint:cit,copy:lit,determinant:uit,equals:Tit,exactEquals:xit,frob:_it,fromMat2d:mit,fromMat4:bd,fromQuat:eQ,fromRotation:pit,fromScaling:fit,fromTranslation:dit,identity:JK,invert:mT,isOrthoNormal:tQ,mul:Sit,multiply:OC,multiplyScalar:bit,multiplyScalarAndAdd:wit,normalFromMat4:RC,normalFromMat4Legacy:B2e,projection:git,rotate:KK,scale:QK,scaleByVec2:hit,set:ZK,str:yit,sub:Eit,subtract:z2e,translate:b5,transpose:wd},Symbol.toStringTag,{value:"Module"}));var sc;(function(t){t[t.SIXTEEN=0]="SIXTEEN",t[t.HUNDRED=1]="HUNDRED",t[t.TWOHUNDRED=2]="TWOHUNDRED",t[t.COUNT=3]="COUNT"})(sc||(sc={}));let pF=class extends Va{constructor(){super(...arguments),this.steps=sc.SIXTEEN,this.writeTextureChannels=jx.RG}};u([z({count:sc.COUNT})],pF.prototype,"steps",void 0),u([z({constValue:de("esri-mobile")?1024:2048})],pF.prototype,"cubeMapSize",void 0),u([z()],pF.prototype,"writeTextureChannels",void 0);let XR=class{constructor(e,i,r,s,n,o,a,l,c=.5){this.coverage=e,this.density=i,this.absorption=r,this.cloudSize=s,this.detailSize=n,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}};const vae=new XR([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],sc.SIXTEEN),ba={sunny:vae,cloudy:new XR([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],sc.TWOHUNDRED,.6),rainy:new XR([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],sc.TWOHUNDRED,.4),snowy:new XR([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],sc.HUNDRED,.65),foggy:new XR([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],sc.SIXTEEN),default:vae},jh=de("esri-mobile")?64:128,Cit=jh/128,dp=Math.ceil(Math.sqrt(jh)),xp=(jh+2)*dp,Ait=1e5,n9=128,Oit=xp/1560;function Ad(t,e=!0){t.attributes.add(A.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.code.add(x`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?x`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}let lP=class extends Os{constructor(e,i){super(e,"mat3",gr.Draw,(r,s,n)=>r.setUniformMatrix3fv(e,i(s,n)))}},G2e=class extends yr{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=ba.default.raymarchingSteps,this.weatherTile=et()}},j2e=class extends yr{constructor(){super(...arguments),this.viewMatrix=ls()}};function Rit(t){const e=new Ui;e.include(Ad,!1);const i=e.fragment;return i.uniforms.add([new He("cloudRadius",r=>r.cloudRadius),new He("power",r=>Yt(35,120,r.absorption)),new He("sigmaE",r=>1+r.absorption),new He("density",r=>Yt(0,.3,r.density)),new He("cloudSize",r=>Yt(0,.02,Math.max(.01,1-r.cloudSize))),new He("detailSize",r=>Yt(0,.2,Math.max(.01,1-r.detailSize))),new He("smoothness",r=>Yt(0,.5,1-r.smoothness)),new He("cloudHeight",r=>Yt(0,1500,r.cloudHeight)),new He("coverage",r=>r.coverage),new lP("view",r=>r.viewMatrix),new zt("cloudShapeTexture",r=>v(r.noiseTexture)?r.noiseTexture.textureAtlas:null),new zi("cloudVariables",r=>It(Mit,r.coverage,r.absorption))]),i.constants.add("halfCubeMapSize","float",.5*t.cubeMapSize),i.code.add(x`
    const int STEPS = ${t.steps===sc.SIXTEEN?x`16`:t.steps===sc.HUNDRED?x`100`:x`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),i.code.add(x`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${x.float(xp)};
      const float dataWidth = ${x.float(xp)};
      const float tileRows = ${x.float(dp)};
      const vec3 atlasDimensions = vec3(${x.float(jh)}, ${x.float(jh)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${x.float(Cit)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Non-power-of-two textures can't be tiled using WebGL1
      // Get fractional part of uv to tile
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = fract((${x.float(Oit)} * p) / ${x.float(xp)} + 0.5);

      return texture2D(cloudShapeTexture, uv).a;
    }
    `),i.code.add(x`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),i.code.add(x`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),i.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),i.code.add(x`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),i.code.add(x`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),i.code.add(x`void main() {
if (coverage ==  0.0) {
gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
gl_FragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
gl_FragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),e}const Mit=et(),Pit=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:j2e,CloudsPassParameters:G2e,build:Rit},Symbol.toStringTag,{value:"Module"}));let H2e=class q2e extends ji{constructor(e,i){super(e,i,()=>this.destroy())}initializeProgram(e){return new ki(e.rctx,q2e.shader.get().build(this.configuration),Li)}initializePipeline(){return Qt({blending:of(Ve.CONSTANT_COLOR,Ve.ONE_MINUS_CONSTANT_COLOR,qm.ADD,this.configuration.writeTextureChannels===jx.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:Dr.LEQUAL},colorWrite:ui})}};H2e.shader=new Vi(Pit,()=>ee(()=>import("./Clouds.glsl-a7813b7a.js"),[],import.meta.url));var Hu;(function(t){t[t.Full=0]="Full",t[t.WeatherMap=1]="WeatherMap",t[t.COUNT=2]="COUNT"})(Hu||(Hu={}));let Dq=class extends Va{constructor(){super(...arguments),this.mode=Hu.Full}};u([z({count:Hu.COUNT})],Dq.prototype,"mode",void 0);let W2e=class extends yr{constructor(){super(...arguments),this.weatherTile=Ni(0,0)}};function Iit(t){const e=new Ui;return e.include(Ad,!1),e.fragment.code.add(x`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===Hu.Full&&e.fragment.code.add(x`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${x.float(dp)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${x.float(8)});

      float worley0 = worley(p, ${x.float(2)} * 2.0);
      float worley1 = worley(p, ${x.float(2)} * 8.0);
      float worley2 = worley(p, ${x.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${x.float(2)});
      float worley1 = worley(p, ${x.float(2)} * 2.0);
      float worley2 = worley(p, ${x.float(2)} * 4.0);
      float worley3 = worley(p, ${x.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),e.fragment.uniforms.add(new zi("weatherTile",i=>i.weatherTile)),e.fragment.code.add(x`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${x.float(n9)});

      // Get global coordinates of p
      p += weatherTile * ${x.float(n9)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${x.float(Ait)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),e.fragment.code.add(x`void main() {`),t.mode===Hu.Full&&e.fragment.code.add(x`
        float padWidth = 1.0;
        float paddedSize = ${x.float(jh)} + 2.0 * padWidth;
        float tileCount = ${x.float(dp)} * ${x.float(dp)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${x.float(jh)};
          }

          if (startPadY) {
            pixel.y += ${x.float(jh)};
          }

          if (endPadX) {
            pixel.x -= ${x.float(jh)};
          }

          if (endPadY) {
            pixel.y -= ${x.float(jh)};
          }

          uv = vec2(pixel.xy / ${x.float(jh)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${x.float(jh)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${x.float(dp)} * ${x.float(dp)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${x.float(dp)} * ${x.float(dp)});
        p = p_;
        p.z /= (${x.float(dp)} * ${x.float(dp)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),e.fragment.code.add(x`
      vec2 mapUV = ${x.float(n9)} * (gl_FragCoord.xy / ${x.float(xp)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${t.mode===Hu.Full?x`gl_FragColor.ba = vec2(0.0, map);`:x`gl_FragColor = vec4(map);`};
    }
  `),e}const $it=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:W2e,build:Iit},Symbol.toStringTag,{value:"Module"}));let Nq=class X2e extends ji{initializeProgram(e){return new ki(e.rctx,X2e.shader.get().build(this.configuration),Li)}initializePipeline(){return Qt({blending:this.configuration.mode===Hu.Full?of(Ve.ONE,Ve.ZERO):Yn(Ve.ZERO,Ve.ONE,Ve.ONE,Ve.ZERO),depthTest:{func:Dr.ALWAYS},colorWrite:ui})}};Nq.shader=new Vi($it,()=>ee(()=>import("./NoiseTextureAtlas.glsl-5f3f30d1.js"),[],import.meta.url));let wS=class{constructor(e,i){this._context=e,this._desc=i,this.type="renderbuffer",this._context.instanceCounter.increment(Wn.Renderbuffer,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:o,multisampled:a}=i;if(a){if(this._context.type!==Mt.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,o,s,n)}else r.renderbufferStorage(r.RENDERBUFFER,o,s,n)}get descriptor(){return this._desc}get samples(){const e=this._desc.samples,i=this._context.parameters.maxSamples;return e?Math.min(e,i):i}resize(e,i){const r=this._desc;if(r.width===e&&r.height===i)return;r.width=e,r.height=i;const s=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):s.renderbufferStorage(s.RENDERBUFFER,r.internalFormat,r.width,r.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(Wn.Renderbuffer,this),this._context=yx(this._context))}},Bs=class xS{constructor(e,i,r=null,s=null){if(this._context=e,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachments=new Map,this._depthStencilTexture=null,this._initialized=!1,this._desc={...i},e.instanceCounter.increment(Wn.FramebufferObject,this),v(r)){Array.isArray(r)||(r=[r]);for(let n=0;n<r.length;++n){const o=r[n],a=Mu.COLOR_ATTACHMENT0+n;let l;wae(o)?(Zg(o)?(l=o.descriptor,this._colorAttachments.set(a,o)):(l=o,this._colorAttachments.set(a,new xt(this._context,l))),Y$(l,this._desc)):(bae(o)?(l=o.descriptor,this._colorAttachments.set(a,o)):(l=o,this._colorAttachments.set(a,new wS(this._context,l))),o9(l,this._desc)),this._validateColorAttachmentPoint(a)}}if(v(s)){let n,o;if(wae(s))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),Zg(s)?(o=s.descriptor,this._depthStencilTexture=s):(o=s,this._depthStencilTexture=new xt(this._context,o)),Y$(o,this._desc);else{bae(s)?(o=s.descriptor,n=s):(o=s,n=new wS(this._context,o));const a=this._desc.depthStencilTarget??Di.DEPTH_STENCIL_RENDER_BUFFER;a===Di.STENCIL_RENDER_BUFFER?this._stencilAttachment=n:a===Di.DEPTH_RENDER_BUFFER||a===Di.DEPTH_STENCIL_RENDER_BUFFER?this._depthAttachment=n:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),this._desc.depthStencilTarget=a,o9(o,this._desc)}}}dispose(){if(!this._desc)return;const e=this._context.getBoundFramebufferObject();this._disposeColorAttachments(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(Wn.FramebufferObject,this),this._desc=null}get glName(){return this._glName}get descriptor(){return this._desc}get colorTexture(){const e=this._colorAttachments.get(Mu.COLOR_ATTACHMENT0);return e&&Zg(e)?e:null}get colorAttachment(){return this._colorAttachments.get(Mu.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._desc.width??0}get height(){return this._desc.height??0}get gpuMemoryUsage(){return[...this._colorAttachments].reduce((e,[i,r])=>e+Gx(r),0)+Gx(this.depthStencilAttachment)}getColorTexture(e){const i=this._colorAttachments.get(e);return i&&Zg(i)?i:null}attachColorTexture(e,i=Mu.COLOR_ATTACHMENT0){e&&(this._validateColorAttachmentPoint(i),Y$(e.descriptor,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,i)),this._colorAttachments.set(i,e))}detachColorTexture(e=Mu.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(e);if(Zg(i)){const r=i;return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e)),this._colorAttachments.delete(e),r}}setColorTextureTarget(e,i=Mu.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(i);Zg(r)&&this._framebufferTexture2D(r.glName,i,e)}attachDepthStencilTexture(e){if(C(e))return;const i=e.descriptor;i.pixelFormat!==it.DEPTH_STENCIL&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),i.dataType!==Ht.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),Y$(i,this._desc),this._desc.depthStencilTarget&&this._desc.depthStencilTarget!==Di.DEPTH_STENCIL_TEXTURE&&(this._desc.depthStencilTarget=Di.DEPTH_STENCIL_TEXTURE),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,lae)),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;return e&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,lae)),this._depthStencilTexture=null,e}attachDepthStencilBuffer(e){if(C(e))return;const i=e.descriptor;if(i.internalFormat!==sl.DEPTH_STENCIL&&i.internalFormat!==sl.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),o9(i,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=i.internalFormat===sl.DEPTH_STENCIL?Di.DEPTH_STENCIL_RENDER_BUFFER:Di.DEPTH_RENDER_BUFFER,this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,s=this._desc.depthStencilTarget===Di.DEPTH_RENDER_BUFFER?r.DEPTH_ATTACHMENT:r.DEPTH_STENCIL_ATTACHMENT;r.framebufferRenderbuffer(oo.FRAMEBUFFER,s,r.RENDERBUFFER,e.glName)}this._depthAttachment=e}detachDepthStencilBuffer(){const e=this._context.gl,i=this._depthAttachment;if(i&&this._initialized){this._context.bindFramebuffer(this);const r=this._desc.depthStencilTarget===Di.DEPTH_RENDER_BUFFER?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(oo.FRAMEBUFFER,r,e.RENDERBUFFER,null)}return this._depthAttachment=null,i}detachAll(){this._colorAttachments.forEach((e,i)=>this._detachColorAttachment(i)),this.detachDepthStencilBuffer(),this.detachDepthStencilTexture()}copyToTexture(e,i,r,s,n,o,a){(e<0||i<0||n<0||o<0)&&console.error("Offsets cannot be negative!"),(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=this._desc,c=a.descriptor;a.descriptor.target!==Pt.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),((l==null?void 0:l.width)==null||(l==null?void 0:l.height)==null||(c==null?void 0:c.width)==null||(c==null?void 0:c.height)==null||e+r>l.width||i+s>l.height||n+r>c.width||o+s>c.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const h=this._context,p=h.bindTexture(a,xt.TEXTURE_UNIT_FOR_UPDATES);h.setActiveTexture(xt.TEXTURE_UNIT_FOR_UPDATES),h.bindFramebuffer(this),h.gl.copyTexSubImage2D(Pt.TEXTURE_2D,0,n,o,e,i,r,s),h.bindTexture(p,xt.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,i,r,s,n,o,a){(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,i,r,s,n,o,a)}async readPixelsAsync(e,i,r,s,n,o,a){if(this._context.type!==Mt.WEBGL2)return $u()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(e,i,r,s,n,o,a);const l=this._context.gl,c=Yi.createPixelPack(this._context,Fi.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(e,i,r,s,n,o,0),this._context.unbindBuffer(Bt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(e,i){const r=this._desc;if(r.width!==e||r.height!==i){if(r.width=e,r.height=i,!this._initialized)return this._colorAttachments.forEach(s=>{s&&s.resize(e,i)}),void(this._depthStencilTexture&&this._depthStencilTexture.resize(e,i));this._colorAttachments.forEach(s=>{s&&s.resize(e,i)}),this._depthStencilTexture!=null?this._depthStencilTexture.resize(e,i):(this._depthAttachment||this._stencilAttachment)&&(this._depthAttachment&&this._depthAttachment.resize(e,i),this._stencilAttachment&&this._stencilAttachment.resize(e,i)),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}}initializeAndBind(e=oo.FRAMEBUFFER){const i=this._context.gl;if(this._initialized)return void i.bindFramebuffer(e,this.glName);this._glName&&i.deleteFramebuffer(this._glName);const r=this._context,s=i.createFramebuffer(),n=this._desc,o=n.colorTarget??gs.RENDER_BUFFER,a=n.width??1,l=n.height??1;if(i.bindFramebuffer(e,s),this._colorAttachments.size===0)if(o===gs.TEXTURE||o===gs.CUBEMAP)this._colorAttachments.set(Mu.COLOR_ATTACHMENT0,Lit(r,n,this.descriptor.colorTarget===gs.CUBEMAP?Pt.TEXTURE_CUBE_MAP:Pt.TEXTURE_2D));else{const h=new wS(r,{internalFormat:Lt.RGBA4,width:a,height:l});this._colorAttachments.set(Mu.COLOR_ATTACHMENT0,h)}this._colorAttachments.forEach((h,p)=>{h&&(Zg(h)?this._framebufferTexture2D(h.glName,p,xae(h),e):i.framebufferRenderbuffer(e,p,i.RENDERBUFFER,h.glName))});const c=n.depthStencilTarget??Di.NONE;switch(c){case Di.DEPTH_RENDER_BUFFER:case Di.DEPTH_STENCIL_RENDER_BUFFER:{this._depthAttachment||(this._depthAttachment=new wS(r,{internalFormat:n.depthStencilTarget===Di.DEPTH_RENDER_BUFFER?sl.DEPTH_COMPONENT16:sl.DEPTH_STENCIL,width:a,height:l}));const h=c===Di.DEPTH_RENDER_BUFFER?i.DEPTH_ATTACHMENT:i.DEPTH_STENCIL_ATTACHMENT;i.framebufferRenderbuffer(e,h,i.RENDERBUFFER,this._depthAttachment.glName);break}case Di.STENCIL_RENDER_BUFFER:this._stencilAttachment||(this._stencilAttachment=new wS(r,{internalFormat:sl.STENCIL_INDEX8,width:a,height:l})),i.framebufferRenderbuffer(e,i.STENCIL_ATTACHMENT,i.RENDERBUFFER,this._stencilAttachment.glName);break;case Di.DEPTH_STENCIL_TEXTURE:if(!this._depthStencilTexture){r.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");const h={target:Pt.TEXTURE_2D,pixelFormat:it.DEPTH_STENCIL,dataType:Ht.UNSIGNED_INT_24_8,samplingMode:gt.NEAREST,wrapMode:kt.CLAMP_TO_EDGE,width:a,height:l};this._depthStencilTexture=new xt(r,h)}this._framebufferTexture2D(this._depthStencilTexture.glName,i.DEPTH_STENCIL_ATTACHMENT,xae(this._depthStencilTexture),e)}$u()&&i.checkFramebufferStatus(e)!==i.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=s,this._initialized=!0}_framebufferTexture2D(e,i=Mu.COLOR_ATTACHMENT0,r=Pt.TEXTURE_2D,s=oo.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(s,i,r,e,n)}_detachColorAttachment(e){$u()&&console.warn("Detaching an FBO attachment can be a slow due to invalidating framebuffer completeness!");const i=this._context.gl,r=this._colorAttachments.get(e);return Zg(r)?this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e)):this._initialized&&(this._context.bindFramebuffer(this),i.framebufferRenderbuffer(oo.FRAMEBUFFER,e,i.RENDERBUFFER,null)),this._colorAttachments.delete(e),r}_disposeColorAttachments(){this._colorAttachments.forEach((e,i)=>{this._detachColorAttachment(i),e.dispose()}),this._colorAttachments.clear()}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);const i=this._desc.depthStencilTarget===Di.DEPTH_RENDER_BUFFER?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(oo.FRAMEBUFFER,i,e.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(oo.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)}_validateColorAttachmentPoint(e){if(xS._MAX_COLOR_ATTACHMENTS===-1){const r=this._context.capabilities.drawBuffers;if(r){const s=this._context.gl;xS._MAX_COLOR_ATTACHMENTS=s.getParameter(r.MAX_COLOR_ATTACHMENTS)}else xS._MAX_COLOR_ATTACHMENTS=1}const i=e-Mu.COLOR_ATTACHMENT0;i+1>xS._MAX_COLOR_ATTACHMENTS&&oe.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${i+1}. Implementation supports up to ${xS._MAX_COLOR_ATTACHMENTS} color attachments`)}};function Zg(t){return t!=null&&"type"in t&&t.type==="texture"}function bae(t){return t!=null&&"type"in t&&t.type==="renderbuffer"}function wae(t){return Zg(t)||t!=null&&"pixelFormat"in t}function Lit(t,e,i){return new xt(t,{target:i,pixelFormat:it.RGBA,dataType:Ht.UNSIGNED_BYTE,samplingMode:gt.NEAREST,wrapMode:kt.CLAMP_TO_EDGE,width:e.width,height:e.height})}function Y$(t,e){t.target!==Pt.TEXTURE_2D&&t.target!==Pt.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),e.width!==void 0&&e.width>=0&&e.height!==void 0&&e.height>=0?e.width===t.width&&e.height===t.height||console.error("Color attachment texture must match the framebuffer's!"):(e.width=t.width,e.height=t.height)}function o9(t,e){e.width!==void 0&&e.width>=0&&e.height!==void 0&&e.height>=0?e.width===t.width&&e.height===t.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(e.width=t.width,e.height=t.height)}function xae(t){return t.descriptor.target===Pt.TEXTURE_CUBE_MAP?Pt.TEXTURE_CUBE_MAP_POSITIVE_X:Pt.TEXTURE_2D}Bs._MAX_COLOR_ATTACHMENTS=-1;let YR=class extends $e{constructor(e){super(e),this._needsRender=!0,this._passParameters=new W2e,this._frameBuffer=new Bs(e.context.renderContext.rctx,{colorTarget:gs.TEXTURE,width:xp,height:xp},{target:Pt.TEXTURE_2D,pixelFormat:it.RGBA,dataType:Ht.UNSIGNED_BYTE,wrapMode:kt.CLAMP_TO_EDGE,samplingMode:gt.LINEAR,hasMipmap:!1,width:xp,height:xp}),this._vao=ka(e.context.renderContext.rctx)}get _techniqueRepository(){return this.context.techniqueRepository}get textureAtlas(){return v(this._texture)?v(this._weatherMapTechnique)&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(Hu.WeatherMap)):v(this._fullTechnique)&&this._fullTechnique.compiled&&(this._texture=this._render(Hu.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(Fn(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=Wr(this._fullTechniqueCached),this._weatherMapTechniqueCached=Wr(this._weatherMapTechniqueCached),this._frameBuffer=ft(this._frameBuffer),this._vao=ft(this._vao)}get _fullTechnique(){if(C(this._fullTechniqueCached)){const e=new Dq;e.mode=Hu.Full,this._fullTechniqueCached=this._techniqueRepository.acquire(Nq,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(C(this._weatherMapTechniqueCached)){const e=new Dq;e.mode=Hu.WeatherMap,this._weatherMapTechniqueCached=this._techniqueRepository.acquire(Nq,e)}return this._weatherMapTechniqueCached}_render(e){if(C(this._vao)||C(this._frameBuffer))return null;const i=e===Hu.Full?this._fullTechnique:this._weatherMapTechnique,r=this.context.renderContext.rctx,s=r.getViewport();r.setViewport(0,0,xp,xp),r.bindFramebuffer(this._frameBuffer);const n=r.bindTechnique(i,this._passParameters,null);return r.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.setViewport(s.x,s.y,s.width,s.height),this._needsRender=!1,this._frameBuffer.colorTexture}};u([d({constructOnly:!0})],YR.prototype,"context",void 0),u([d({readOnly:!0})],YR.prototype,"_techniqueRepository",null),YR=u([I("esri.views.3d.environment.NoiseTextureAtlas")],YR);function Y2e(t){t.include(rh),t.uniforms.add([new zt("geometryDepthTexture",(e,i)=>i.multipassGeometry.linearDepthTexture),new zi("nearFar",(e,i)=>i.camera.nearFar)]),t.code.add(x`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}let Dit=class{constructor(){this.enabled=!1}};function sh(t,e){e.hasMultipassTerrain&&(t.fragment.include(rh),t.fragment.uniforms.add(new zt("terrainDepthTexture",(i,r)=>r.multipassTerrain.linearDepthTexture)),t.fragment.uniforms.add(new zi("nearFar",(i,r)=>r.camera.nearFar)),t.fragment.uniforms.add(new zi("inverseViewport",(i,r)=>r.inverseViewport)),t.fragment.code.add(x`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${e.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}let Nit=class{constructor(){this.enabled=!1,this.cullAboveGround=!1}};function Fit(t,e){const i=t.fragment;i.include(rh),i.uniforms.add(new zi("nearFar",(r,s)=>s.camera.nearFar)),i.uniforms.add(new zt("depthMap",(r,s)=>s.linearDepthTexture)),i.uniforms.add(new Jr("proj",(r,s)=>s.ssr.camera.projectionMatrix)),i.uniforms.add(new He("invResolutionHeight",(r,s)=>1/s.ssr.camera.height)),i.uniforms.add(new Jr("reprojectionMatrix",(r,s)=>s.ssr.reprojectionMatrix)),i.code.add(x`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}let Uit=class{constructor(){this.enabled=!1,this.fadeFactor=1,this.reprojectionMatrix=We()}};function r8(t){return t?{ray:fo(t.ray),c0:t.c0,c1:t.c1}:{ray:fo(),c0:0,c1:Number.MAX_VALUE}}function Vit(t,e=r8()){return U4(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function kit(t,e,i=r8()){const r=je(t.vector);return uve(t.origin,e,i.ray),i.c0=0,i.c1=r,i}function wDt(t,e){return Z2e(t,t.c0,e)}function xDt(t,e){return Z2e(t,t.c1,e)}function Z2e(t,e,i){return ve(i,t.ray.origin,ue(i,t.ray.direction,e))}new n0(()=>r8());function cP(t){return t?[qi(t[0]),qi(t[1]),qi(t[2]),qi(t[3]),qi(t[4]),qi(t[5])]:[qi(),qi(),qi(),qi(),qi(),qi()]}function J2e(){return[M(),M(),M(),M(),M(),M(),M(),M()]}function w5(t,e){for(let i=0;i<r1.NUM;i++)TU(t[i],e[i])}function K2e(t,e,i,r=Hit){const s=Ts(hJ.get(),e,t);Go(s,s);for(let n=0;n<Fq.NUM;++n){const o=qu(uJ.get(),jit[n],s);fe(r[n],o[0]/o[3],o[1]/o[3],o[2]/o[3])}Q2e(i,r)}function Q2e(t,e){Ta(e[vt.FAR_BOTTOM_LEFT],e[vt.NEAR_BOTTOM_LEFT],e[vt.NEAR_TOP_LEFT],t[Sr.LEFT]),Ta(e[vt.NEAR_BOTTOM_RIGHT],e[vt.FAR_BOTTOM_RIGHT],e[vt.FAR_TOP_RIGHT],t[Sr.RIGHT]),Ta(e[vt.FAR_BOTTOM_LEFT],e[vt.FAR_BOTTOM_RIGHT],e[vt.NEAR_BOTTOM_RIGHT],t[Sr.BOTTOM]),Ta(e[vt.NEAR_TOP_LEFT],e[vt.NEAR_TOP_RIGHT],e[vt.FAR_TOP_RIGHT],t[Sr.TOP]),Ta(e[vt.NEAR_BOTTOM_LEFT],e[vt.NEAR_BOTTOM_RIGHT],e[vt.NEAR_TOP_RIGHT],t[Sr.NEAR]),Ta(e[vt.FAR_BOTTOM_RIGHT],e[vt.FAR_BOTTOM_LEFT],e[vt.FAR_TOP_LEFT],t[Sr.FAR])}function Cv(t,e){for(let i=0;i<r1.NUM;i++){const r=t[i];if(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]>=e[3])return!1}return!0}function Bit(t,e){return tSe(t,Vit(e,iSe.get()))}function TDt(t,e){for(let i=0;i<r1.NUM;i++){const r=t[i];if(!bke(r,e))return!1}return!0}function zit(t,e,i){return tSe(t,kit(e,i,iSe.get()))}function eSe(t,e){for(let i=0;i<r1.NUM;i++)if(Er(t[i],e)>0)return!1;return!0}function tSe(t,e){for(let i=0;i<r1.NUM;i++)if(!vke(t[i],e))return!1;return!0}var Sr,vt;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.TOP=3]="TOP",t[t.NEAR=4]="NEAR",t[t.FAR=5]="FAR"})(Sr||(Sr={})),function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(vt||(vt={}));const Git={bottom:[vt.FAR_BOTTOM_RIGHT,vt.NEAR_BOTTOM_RIGHT,vt.NEAR_BOTTOM_LEFT,vt.FAR_BOTTOM_LEFT],near:[vt.NEAR_BOTTOM_LEFT,vt.NEAR_BOTTOM_RIGHT,vt.NEAR_TOP_RIGHT,vt.NEAR_TOP_LEFT],far:[vt.FAR_BOTTOM_RIGHT,vt.FAR_BOTTOM_LEFT,vt.FAR_TOP_LEFT,vt.FAR_TOP_RIGHT],right:[vt.NEAR_BOTTOM_RIGHT,vt.FAR_BOTTOM_RIGHT,vt.FAR_TOP_RIGHT,vt.NEAR_TOP_RIGHT],left:[vt.FAR_BOTTOM_LEFT,vt.NEAR_BOTTOM_LEFT,vt.NEAR_TOP_LEFT,vt.FAR_TOP_LEFT],top:[vt.FAR_TOP_LEFT,vt.NEAR_TOP_LEFT,vt.NEAR_TOP_RIGHT,vt.FAR_TOP_RIGHT]};var r1,Fq;(function(t){t[t.NUM=6]="NUM"})(r1||(r1={})),function(t){t[t.NUM=8]="NUM"}(Fq||(Fq={}));const jit=[si(-1,-1,-1,1),si(1,-1,-1,1),si(1,1,-1,1),si(-1,1,-1,1),si(-1,-1,1,1),si(1,-1,1,1),si(1,1,1,1),si(-1,1,1,1)],iSe=new n0(r8),Hit=J2e();function qit(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/e)}function Wit(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/i)}function Xit(t,e,i){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}function Yit(t,e,i){return 2*Math.atan(i*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}var Uq;let Ut=Uq=class extends $e{constructor(t={}){super(t),this._center=M(),this._up=M(),this._viewUp=M(),this._viewForward=M(),this._viewRight=M(),this._ray=fo(),this._viewport=si(0,0,1,1),this._padding=si(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Ni(1,1e3),this._viewDirty=!0,this._viewMatrix=We(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=We(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=We(),this._frustumDirty=!0,this._frustum=cP(),this._fullViewport=fi(),this._pixelRatio=1,this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return be(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){Xn(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=XC(fi(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&JY(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[bi.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[bi.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[bi.RIGHT]+this._padding[bi.LEFT]}set fullWidth(t){this.width=t-(this._padding[bi.RIGHT]+this._padding[bi.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[bi.TOP]+this._padding[bi.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[bi.TOP]+this._padding[bi.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[bi.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[bi.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){mE(this._padding,t)||(this._viewport[0]+=t[bi.LEFT]-this._padding[bi.LEFT],this._viewport[1]+=t[bi.BOTTOM]-this._padding[bi.BOTTOM],this._viewport[2]-=t[bi.RIGHT]+t[bi.LEFT]-(this._padding[bi.RIGHT]+this._padding[bi.LEFT]),this._viewport[3]-=t[bi.TOP]+t[bi.BOTTOM]-(this._padding[bi.TOP]+this._padding[bi.BOTTOM]),Op(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Ts(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){const t=this.width,e=this.height,i=this.near*Math.tan(this.fovY/2),r=i*this._aspect,s=d_e(We(),-r*(1+2*this._padding[bi.LEFT]/t),r*(1+2*this._padding[bi.RIGHT]/t),-i*(1+2*this._padding[bi.BOTTOM]/e),i*(1+2*this._padding[bi.TOP]/e),this.near,this.far),n=this._get("projectionMatrix");return n&&QZ(n,s)?n:s}get inverseProjectionMatrix(){return Go(We(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||We()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return Xit(this._fov,this.width,this.height)}set fovX(t){this._fov=qit(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return Yit(this._fov,this.width,this.height)}set fovY(t){this._fov=Wit(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Ar(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Go(this._viewInverseTransposeMatrix,this.viewMatrix),tu(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}copyFrom(t){he(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,Op(this._viewport,t.viewport),this.notifyChange("_viewport"),Op(this._padding,t.padding),this.notifyChange("_padding"),Fn(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(Xn(this._viewMatrix,t.viewMatrix),he(this._viewRight,t.viewRight),he(this._viewUp,t.viewUp),he(this._viewForward,t.viewForward)),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(w5(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Xn(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Op(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new Uq().copyFrom(this)}equals(t){return cl(this.eye,t.eye)&&cl(this.center,t.center)&&cl(this.up,t.up)&&mE(this._viewport,t.viewport)&&mE(this._padding,t.padding)&&l2e(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){if(Math.abs(t.fov-this._fov)>=.001||y4(t.padding,this._padding)>=.5||y4(this.screenViewport,t.screenViewport)>=.5)return!1;po(ma,t.eye,t.center),po(a9,this.eye,this.center);const e=Ae(ma,a9),i=m7(ma),r=m7(a9),s=5e-4;return e*e>=(1-1e-10)*i*r&&WY(t.eye,this.eye)<Math.max(i,r)*s*s}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(NM(this.viewForward,be(ma,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=ms()){return t[0]=(this.padding[bi.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[bi.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,i=.5){return t[0]=this.padding[bi.LEFT]+this.width*e,t[1]=this.padding[bi.BOTTOM]+this.height*i,t[2]=.5,t}setGLViewport(t){const e=this.viewport,i=this.padding;t.setViewport(e[0]-i[3],e[1]-i[2],e[2]+i[1]+i[3],e[3]+i[0]+i[2])}applyProjection(t,e){t!==_i&&he(_i,t),_i[3]=1,qu(_i,_i,this.projectionMatrix);const i=Math.abs(_i[3]);ue(_i,_i,1/i);const r=this.fullViewport;e[0]=Yt(0,r[0]+r[2],.5+.5*_i[0]),e[1]=Yt(0,r[1]+r[3],.5+.5*_i[1]),e[2]=.5*(_i[2]+1),e[3]=i}unapplyProjection(t,e){const i=this.fullViewport;_i[0]=(t[0]/(i[0]+i[2])*2-1)*t[3],_i[1]=(t[1]/(i[1]+i[3])*2-1)*t[3],_i[2]=(2*t[2]-1)*t[3],_i[3]=t[3],this.inverseProjectionMatrix!=null&&(qu(_i,_i,this.inverseProjectionMatrix),e[0]=_i[0],e[1]=_i[1],e[2]=_i[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,l9),this.renderToScreen(l9,e),e}projectToRenderScreen(t,e){if(_i[0]=t[0],_i[1]=t[1],_i[2]=t[2],_i[3]=1,qu(_i,_i,this.viewProjectionMatrix),_i[3]===0)return null;ue(_i,_i,1/Math.abs(_i[3]));const i=this.fullViewport;return"x"in e?(e.x=Yt(0,i[0]+i[2],.5+.5*_i[0]),e.y=Yt(0,i[1]+i[3],.5+.5*_i[1])):(e[0]=Yt(0,i[0]+i[2],.5+.5*_i[0]),e[1]=Yt(0,i[1]+i[3],.5+.5*_i[1]),e.length>2&&(e[2]=.5*(_i[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,l9),e)}unprojectFromRenderScreen(t,e){if(Ts(Z$,this.projectionMatrix,this.viewMatrix),!Go(Z$,Z$))return null;const i=this.fullViewport;return _i[0]=2*(t[0]-i[0])/i[2]-1,_i[1]=2*(t[1]-i[1])/i[3]-1,_i[2]=2*t[2]-1,_i[3]=1,qu(_i,_i,Z$),_i[3]===0?null:(e[0]=_i[0]/_i[3],e[1]=_i[1]/_i[3],e[2]=_i[2]/_i[3],e)}constrainWindowSize(t,e,i,r){const s=t*this.pixelRatio,n=e*this.pixelRatio,o=Math.max(s-i/2,0),a=Math.max(this.fullHeight-n-r/2,0),l=-Math.min(s-i/2,0),c=-Math.min(this.fullHeight-n-r/2,0);return[o,a,i-l- -Math.min(this.fullWidth-s-i/2,0),r-c- -Math.min(n-r/2,0)]}computeUp(t){t===st.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const i=t[0]*this.pixelRatio,r=this.fullHeight-t[1]*this.pixelRatio;return e[0]=i,e[1]=r,e}renderToScreen(t,e){const i=t[0]/this.pixelRatio,r=(this.fullHeight-t[1])/this.pixelRatio;e[0]=i,e[1]=r}_computeUpGlobal(){be(ma,this.center,this.eye);const t=je(this.center);t<1?(fe(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(Ae(ma,this.center))>.9999*je(ma)*t||(Et(this._up,ma,this.center),Et(this._up,this._up,ma),Oe(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){i0(ma,this.eye,this.center),Math.abs(ma[2])<=.9999&&(ue(ma,ma,ma[2]),fe(this._up,-ma[0],-ma[1],1-ma[2]),Oe(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,i=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?cl(t,e)||(he(e,t),this._markViewDirty(),i.length&&this.notifyChange(i)):oe.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(K2e(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(yU(this._viewMatrix,this.eye,this.center,this.up),fe(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),fe(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),fe(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};u([d()],Ut.prototype,"_center",void 0),u([d()],Ut.prototype,"_up",void 0),u([d()],Ut.prototype,"_viewport",void 0),u([d()],Ut.prototype,"_padding",void 0),u([d()],Ut.prototype,"_fov",void 0),u([d()],Ut.prototype,"_nearFar",void 0),u([d()],Ut.prototype,"_pixelRatio",void 0),u([d()],Ut.prototype,"pixelRatio",null),u([d()],Ut.prototype,"eye",null),u([d()],Ut.prototype,"center",null),u([d()],Ut.prototype,"up",null),u([d({readOnly:!0})],Ut.prototype,"nearFar",null),u([d()],Ut.prototype,"near",null),u([d()],Ut.prototype,"far",null),u([d()],Ut.prototype,"viewport",null),u([d({readOnly:!0})],Ut.prototype,"screenViewport",null),u([d()],Ut.prototype,"x",null),u([d()],Ut.prototype,"y",null),u([d()],Ut.prototype,"width",null),u([d()],Ut.prototype,"height",null),u([d()],Ut.prototype,"fullWidth",null),u([d()],Ut.prototype,"fullHeight",null),u([d({readOnly:!0})],Ut.prototype,"_aspect",null),u([d()],Ut.prototype,"padding",null),u([d({readOnly:!0})],Ut.prototype,"projectionMatrix",null),u([d({readOnly:!0})],Ut.prototype,"inverseProjectionMatrix",null),u([d()],Ut.prototype,"fov",null),u([d()],Ut.prototype,"fovX",null),u([d()],Ut.prototype,"fovY",null),Ut=Uq=u([I("esri.views.3d.webgl-engine.lib.Camera")],Ut);const _i=fi(),Z$=We(),ma=M(),a9=M(),l9=na();var bi;(function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"})(bi||(bi={}));var Fe;(function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",t[t.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",t[t.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",t[t.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",t[t.LASERLINES=12]="LASERLINES",t[t.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",t[t.HUD_MATERIAL=14]="HUD_MATERIAL",t[t.LABEL_MATERIAL=15]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=16]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",t[t.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",t[t.DRAPED_WATER=19]="DRAPED_WATER",t[t.VOXEL=20]="VOXEL",t[t.MAX_SLOTS=21]="MAX_SLOTS"})(Fe||(Fe={}));var $t;(function(t){t[t.Color=0]="Color",t[t.Alpha=1]="Alpha",t[t.FrontFace=2]="FrontFace",t[t.NONE=3]="NONE",t[t.COUNT=4]="COUNT"})($t||($t={}));let iQ=class{constructor(e=M()){this.intensity=e}},rSe=class{constructor(e=M(),i=Xe(.57735,.57735,.57735)){this.intensity=e,this.direction=i}},x5=class{constructor(e=M(),i=Xe(.57735,.57735,.57735),r=!0,s=1,n=1){this.intensity=e,this.direction=i,this.castShadows=r,this.specularStrength=s,this.environmentStrength=n}},sSe=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function Zit(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e[r];return i}function c9(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e;return i}function AE(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]+e[r];return i}function nSe(t){return(t+1)*(t+1)}function Jit(t){return we(Math.floor(Math.sqrt(t)-1),0,2)}function oSe(t,e,i){const r=t[0],s=t[1],n=t[2],o=i||[];return o.length=nSe(e),e>=0&&(o[0]=.28209479177),e>=1&&(o[1]=.4886025119*r,o[2]=.4886025119*n,o[3]=.4886025119*s),e>=2&&(o[4]=1.09254843059*r*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*r*n,o[8]=.54627421529*(r*r-s*s)),o}function Kit(t,e){const i=nSe(t),r=e||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let s=0;s<i;s++)r.r[s]=r.g[s]=r.b[s]=0;return r}function Qit(t,e){const i=Jit(e.r.length);for(const r of t)Pa(Vq,r.direction),oSe(Vq,i,yy),Zit(yy,fF),c9(yy,r.intensity[0],PT),AE(e.r,PT),c9(yy,r.intensity[1],PT),AE(e.g,PT),c9(yy,r.intensity[2],PT),AE(e.b,PT);return e}function ert(t,e){oSe(Vq,0,yy);for(const i of t)e.r[0]+=yy[0]*fF[0]*i.intensity[0]*4*Math.PI,e.g[0]+=yy[0]*fF[0]*i.intensity[1]*4*Math.PI,e.b[0]+=yy[0]*fF[0]*i.intensity[2]*4*Math.PI;return e}function trt(t,e,i,r){Kit(e,r),fe(i.intensity,0,0,0);let s=!1;const n=irt,o=rrt,a=srt;n.length=0,o.length=0,a.length=0;for(const l of t)l instanceof x5&&!s?(he(i.direction,l.direction),he(i.intensity,l.intensity),i.specularStrength=l.specularStrength,i.environmentStrength=l.environmentStrength,i.castShadows=l.castShadows,s=!0):l instanceof x5||l instanceof rSe?n.push(l):l instanceof iQ?o.push(l):l instanceof sSe&&a.push(l);Qit(n,r),ert(o,r);for(const l of a)AE(r.r,l.r),AE(r.g,l.g),AE(r.b,l.b)}const irt=[],rrt=[],srt=[],yy=[0],PT=[0],Vq=M(),fF=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let Tae=class{constructor(){this.color=M(),this.intensity=1}},nrt=class{constructor(){this.direction=M(),this.ambient=new Tae,this.diffuse=new Tae}};const aSe=.4;let u9=class{constructor(){this._shOrder=2,this._legacy=new nrt,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new sSe,this._mainLight=new x5(M(),Xe(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){trt(e,this._shOrder,this._mainLight,this._sphericalHarmonics),he(this._legacy.direction,this._mainLight.direction);const i=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*i,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*i,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*i,ue(this._legacy.diffuse.color,this._mainLight.intensity,i),he(J$,this._legacy.diffuse.color),ue(J$,J$,aSe*this.globalFactor),ve(this._legacy.ambient.color,this._legacy.ambient.color,J$)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),this._mainLight.direction=xs(e.mainLight.direction),this._mainLight.intensity=xs(e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,i,r){if(tn(this._mainLight.intensity,e.mainLight.intensity,i.mainLight.intensity,r),this._mainLight.environmentStrength=Yt(e.mainLight.environmentStrength,i.mainLight.environmentStrength,r),this._mainLight.specularStrength=Yt(e.mainLight.specularStrength,i.mainLight.specularStrength,r),he(this._mainLight.direction,i.mainLight.direction),this._mainLight.castShadows=i.mainLight.castShadows,this.globalFactor=Yt(e.globalFactor,i.globalFactor,r),this.noonFactor=Yt(e.noonFactor,i.noonFactor,r),e.sh.r.length===i.sh.r.length)for(let s=0;s<i.sh.r.length;s++)this._sphericalHarmonics.r[s]=Yt(e.sh.r[s],i.sh.r[s],r),this._sphericalHarmonics.g[s]=Yt(e.sh.g[s],i.sh.g[s],r),this._sphericalHarmonics.b[s]=Yt(e.sh.b[s],i.sh.b[s],r);else for(let s=0;s<i.sh.r.length;s++)this._sphericalHarmonics.r[s]=i.sh.r[s],this._sphericalHarmonics.g[s]=i.sh.g[s],this._sphericalHarmonics.b[s]=i.sh.b[s]}};const J$=M();let s8=class{constructor(e,i,r){this.shadowMap=e,this.ssaoHelper=i,this.slicePlane=r,this.slot=Fe.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=$t.NONE,this._camera=new Ut,this._inverseViewport=et(),this.oldLighting=new u9,this.newLighting=new u9,this._fadedLighting=new u9,this._lighting=this.newLighting,this.ssr=new Uit,this.multipassTerrain=new Nit,this.multipassGeometry=new Dit,this.overlays=[],this.cloudsFade=new iit}get camera(){return this._camera}set camera(e){this._camera=this.ssr.camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:i,newLighting:r}=this;e>=1?this._lighting=r:(this._fadedLighting.lerpLighting(i,r,e),this._lighting=this._fadedLighting)}},Bl=class extends $e{constructor(e){super(e),this._handles=new Ki,this._techniques=new Array,this._techniqueConfiguration=new pF,this._bindParameters=new s8(null,null,null),this._passParameters=new G2e,this._drawParameters=new j2e,this._weatherTile=et(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=Yt(ba.default.coverage[0],ba.default.coverage[1],.5),this.density=Yt(ba.default.density[0],ba.default.density[1],.5),this.absorption=Yt(ba.default.absorption[0],ba.default.absorption[1],.5),this.cloudSize=Yt(ba.default.cloudSize[0],ba.default.cloudSize[1],.5),this.detailSize=Yt(ba.default.detailSize[0],ba.default.detailSize[1],.5),this.smoothness=Yt(ba.default.smoothness[0],ba.default.smoothness[1],.5),this.cloudHeight=Yt(ba.default.cloudHeight[0],ba.default.cloudHeight[1],.5),this.raymarchingSteps=ba.default.raymarchingSteps,this._viewMatrix=We(),this._dirty=!1,this.running=!1}_getTechnique(e){const i=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,r=i===jx.RG?2*e:2*e+1;return this._techniques[r]||(this._techniqueConfiguration.writeTextureChannels=i,this._techniqueConfiguration.steps=e,this._techniques[r]=new H2e({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[r])}updateWeatherTile(){const e=this.view.camera.position.latitude,i=this.view.camera.position.longitude;if(e==null||i==null)return;It(this._weatherTile,(e+90)/180,(i+180)/360);const r=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-r)*this._weatherTile[1]);let s=0,n=0;if(v(this.view.environment)&&this.view.environment.lighting.type!=="virtual"&&v(this.view.environment.lighting.date)){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),s=31*o.getUTCMonth()+o.getUTCDate(),n=o.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+s)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+n%100)%(4*this._weatherTileCount),c2e(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){this._vao=ka(this.context.renderContext.rctx);const e=tr(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this._handles.add([this.view.resourceController.scheduler.registerTask(Rt.CLOUDS_GENERATOR,this),re(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),Zt)])}destroy(){this._handles.destroy(),this._techniques.forEach(e=>Wr(e)),this._frameBufferCube=ft(this._frameBufferCube),this._techniques.length=0,this._vao=ft(this._vao),this._passParameters.noiseTexture=Je(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case sc.SIXTEEN:return 1;case sc.HUNDRED:return 4;case sc.COUNT:case sc.TWOHUNDRED:return 8}}_ensureNoiseTexture(){if(v(this._passParameters.noiseTexture))this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);else{const e=this.context;this._passParameters.noiseTexture=new YR({context:e}),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile)}return v(this._passParameters.noiseTexture.textureAtlas)}_ensureFrameBufferCube(e){if(C(this._frameBufferCube)){const i={target:Pt.TEXTURE_CUBE_MAP,pixelFormat:it.RGBA,dataType:Ht.UNSIGNED_BYTE,wrapMode:kt.CLAMP_TO_EDGE,samplingMode:gt.LINEAR,hasMipmap:!1,width:e,height:e};this._frameBufferCube=new Bs(this.context.renderContext.rctx,{colorTarget:gs.CUBEMAP,width:e,height:e},i)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=ft(this._frameBufferCube)}applyPreset(e,i){const r=e.median,s=n=>{const o=Yt(n[0],n[1],r);return i<.5?Yt(n[0],o,2*i):Yt(o,n[1],2*(i-.5))};this.coverage=s(e.coverage),this.density=s(e.density),this.absorption=s(e.absorption),this.cloudSize=s(e.cloudSize),this.detailSize=s(e.detailSize),this.smoothness=s(e.smoothness),this.cloudHeight=s(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){if(C(this._vao))return this._dirty=this.running=!1,this.context.renderContext.bindParameters.cloudsFade.renderingStage=Us.FINISHED_RENDERING,void e.madeProgress();this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),Fn(this._passParameters.weatherTile,this._weatherTile));const i=this._getTechnique(this._passParameters.raymarchingSteps);if(!i.compiled||!this.context.renderContext.bindParameters.cloudsFade.isCameraPositionFinal||this.context.renderContext.bindParameters.cloudsFade.isFading||!this._ensureNoiseTexture())return ua.YIELD;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=Us.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const r=this.context.renderContext.rctx,s=r.bindTechnique(i,this._passParameters,this._bindParameters);r.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao);const n=r.getViewport(),o=i.configuration.cubeMapSize,a=o/this._tilesPerFace,l=this._tileIndex*a;r.setViewport(0,l,o,a);const c=this._ensureFrameBufferCube(o);r.bindFramebuffer(c);const h=ort[this._faceIndex],p=art[this._faceIndex];f_e(this._viewMatrix,lrt,h,p),bd(this._drawParameters.viewMatrix,this._viewMatrix);const f=Pt.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return c.setColorTextureTarget(f),s.bindDraw(this._drawParameters,this._bindParameters,this._passParameters),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.gl.flush(),r.setViewport(n.x,n.y,n.width,n.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.context.renderContext.bindParameters.cloudsFade.renderingStage=Us.FINISHED_RENDERING):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),ua.YIELD}};u([d({constructOnly:!0})],Bl.prototype,"context",void 0),u([d({constructOnly:!0})],Bl.prototype,"view",void 0),u([d({constructOnly:!0})],Bl.prototype,"requestRender",void 0),u([d()],Bl.prototype,"coverage",void 0),u([d()],Bl.prototype,"density",void 0),u([d()],Bl.prototype,"absorption",void 0),u([d()],Bl.prototype,"cloudSize",void 0),u([d()],Bl.prototype,"detailSize",void 0),u([d()],Bl.prototype,"smoothness",void 0),u([d()],Bl.prototype,"cloudHeight",void 0),u([d()],Bl.prototype,"raymarchingSteps",void 0),u([d()],Bl.prototype,"running",void 0),Bl=u([I("esri.views.3d.environment.CloudsGenerator")],Bl);const ort=[er(1,0,0),er(-1,0,0),er(0,1,0),er(0,-1,0),er(0,0,1)],art=[er(0,1,0),er(0,1,0),er(0,0,-1),er(0,0,1),er(0,1,0)],lrt=jK();let rQ=class extends yr{constructor(){super(...arguments),this.fogColor=M(),this.hazeColor=M(),this.fogStrength=4e-6,this.hazeStrength=4e-6,this.atmosphereC=1,this.fogAmount=0,this.hazeAmount=0}};function crt(t){const e=new Ui;e.attributes.add(A.POSITION,"vec2"),e.include(Im,{textureCoordinateType:Ks.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:i,fragment:r}=e;return i.uniforms.add([new Jr("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new Jr("inverseViewMatrix",(s,n)=>rA(urt,n.camera.viewMatrix))]),i.code.add(x`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new He("atmosphereC",s=>s.atmosphereC)),r.uniforms.add(new ni("cameraPosition",(s,n)=>n.camera.eye)),r.uniforms.add(new zi("nearFar",(s,n)=>n.camera.nearFar)),r.uniforms.add(new zt("depthTex",s=>s.depthTexture)),r.uniforms.add(new He("fogStrength",s=>t.haze?s.hazeStrength:s.fogStrength)),r.uniforms.add(new He("fogAmount",s=>t.haze?s.hazeAmount:s.fogAmount)),r.uniforms.add(new ni("fogColor",s=>t.haze?s.hazeColor:s.fogColor)),e.include(e8),r.include(rh),r.code.add(x`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(x`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),r.code.add(x`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture2D(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${t.haze?x`
          if(terrainDepth == -1.0){
            gl_FragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      gl_FragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `),e}const urt=We(),lSe=Object.freeze(Object.defineProperty({__proto__:null,FogHazePassParameters:rQ,build:crt},Symbol.toStringTag,{value:"Module"}));let cSe=class uSe extends ji{initializeProgram(e){return new ki(e.rctx,uSe.shader.get().build(this.configuration),Li)}initializePipeline(){return this.configuration.haze?Qt({blending:Yn(Ve.ONE,Ve.ZERO,Ve.ONE_MINUS_SRC_COLOR,Ve.ONE),colorWrite:ui}):Qt({blending:Yn(Ve.SRC_ALPHA,Ve.ZERO,Ve.ONE_MINUS_SRC_ALPHA,Ve.ONE),colorWrite:ui})}};cSe.shader=new Vi(lSe,()=>ee(()=>import("./FogHaze.glsl-f829a94e.js"),[],import.meta.url));let sQ=class extends Va{constructor(){super(...arguments),this.haze=!1}};u([z()],sQ.prototype,"haze",void 0);const hrt=.95,drt=1;let ZR=class extends $e{constructor(e){super(e),this._passParameters=new rQ;const i=e.context.renderContext.rctx;this._vao=ka(i,gA),this._technique=e.context.techniqueRepository.acquire(cSe,new sQ);const r=tr(e.view.spatialReference);this._planetRadius=r.radius,this._atmosphereRadius=r.radius+oP}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,i){if(this._update(e,i),this._passParameters.fogAmount<=0)return;const r=this._technique;if(!r.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper;s.renderDepthDetached(()=>{this._passParameters.depthTexture=s.depthTexture;const n=e.rctx.bindTechnique(r,this._passParameters,e.bindParameters);this._renderFog(n,e)})}_renderFog(e,i){const r=i.rctx;r.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(jt.TRIANGLE_STRIP,0,4)}_update(e,i){const r=e.bindParameters.camera;Oe(Sae,r.eye);const s=Math.max(0,Ae(Sae,e.bindParameters.lighting.mainLight.direction)),n=i.color;ue(Eae,n,.1),tn(this._passParameters.fogColor,Eae,n,s);const o=je(r.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-ZE(hrt*zh,drt*zh,Math.abs(o-this._planetRadius)))*i.amount,this._passParameters.fogStrength=i.strength}static isSupported(e){return e.capabilities.depthTexture}};u([d({constructOnly:!0})],ZR.prototype,"context",void 0),u([d({constructOnly:!0})],ZR.prototype,"view",void 0),ZR=u([I("esri.views.3d.environment.Fog")],ZR);let prt=class{constructor(){this.color=M(),this.strength=0,this.amount=0}};const Sae=M(),Eae=M();let uo=class extends Va{constructor(){super(...arguments),this.hasWebGL2Context=!1}};u([z({constValue:!0})],uo.prototype,"hasSliceHighlight",void 0),u([z({constValue:!1})],uo.prototype,"hasSliceInVertexProgram",void 0),u([z({constValue:!1})],uo.prototype,"instancedDoublePrecision",void 0),u([z({constValue:!1})],uo.prototype,"useLegacyTerrainShading",void 0),u([z({constValue:!1})],uo.prototype,"hasModelTransformation",void 0),u([z({constValue:gr.Pass})],uo.prototype,"pbrTextureBindType",void 0),u([z()],uo.prototype,"hasWebGL2Context",void 0);var Wm;(function(t){t[t.Cone=0]="Cone",t[t.Cylinder=1]="Cylinder",t[t.Underground=2]="Underground",t[t.COUNT=3]="COUNT"})(Wm||(Wm={}));let nQ=class extends uo{constructor(){super(...arguments),this.geometry=Wm.Cone}};u([z({count:Wm.COUNT})],nQ.prototype,"geometry",void 0);var k;(function(t){t[t.Color=0]="Color",t[t.Depth=1]="Depth",t[t.Normal=2]="Normal",t[t.Shadow=3]="Shadow",t[t.ShadowHighlight=4]="ShadowHighlight",t[t.ShadowExcludeHighlight=5]="ShadowExcludeHighlight",t[t.Highlight=6]="Highlight",t[t.Alpha=7]="Alpha",t[t.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",t[t.COUNT=9]="COUNT"})(k||(k={}));function TI(t){t.attributes.add(A.POSITION,"vec3"),t.vertex.code.add(x`vec3 positionModel() { return position; }`)}function T5({code:t},e){e.doublePrecisionRequiresObfuscation?t.add(x`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add(x`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}let ng=class extends Os{constructor(e,i){super(e,"mat3",gr.Pass,(r,s,n)=>r.setUniformMatrix3fv(e,i(s,n)))}};function OE(t,e){t.include(TI);const i=t.vertex;i.include(T5,e),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),i.uniforms.add([new ni("transformWorldFromViewTH",r=>r.transformWorldFromViewTH),new ni("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new ng("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new Jr("transformProjFromView",r=>r.transformProjFromView),new lP("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new Ku("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new Ku("transformWorldFromModelTL",r=>r.transformWorldFromModelTL)]),i.code.add(x`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),i.code.add(x`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?x`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:x`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new ni("transformWorldFromViewTL",r=>r.transformWorldFromViewTL)),i.code.add(x`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add(x`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let hSe=class extends yr{constructor(){super(...arguments),this.transformWorldFromViewTH=M(),this.transformWorldFromViewTL=M(),this.transformViewFromCameraRelativeRS=ls(),this.transformProjFromView=We()}},dSe=class extends yr{constructor(){super(...arguments),this.transformWorldFromModelRS=ls(),this.transformWorldFromModelTH=qr(),this.transformWorldFromModelTL=qr()}};function s1(t){t.varyings.add("linearDepth","float")}function Hx(t){t.vertex.uniforms.add(new zi("nearFar",(e,i)=>i.camera.nearFar))}function n8(t){t.vertex.code.add(x`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function yA(t,e){const{vertex:i}=t;switch(e.output){case k.Color:if(e.receiveShadows)return s1(t),void i.code.add(x`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case k.Depth:case k.Shadow:case k.ShadowHighlight:case k.ShadowExcludeHighlight:return t.include(OE,e),s1(t),Hx(t),n8(t),void i.code.add(x`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}i.code.add(x`void forwardLinearDepth() {}`)}function nc(t,e){if(n8(t),e.hasModelTransformation)return t.vertex.code.add(x`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = calculateLinearDepth(nearFar, eye.z);
return proj * eye;
}`),void t.vertex.code.add(x`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`);t.vertex.code.add(x`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(x`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}let oQ=class extends yr{constructor(){super(...arguments),this.texV=et(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new pSe}},pSe=class{constructor(){this.center=M(),this.v1=M(),this.v2=M()}};function frt(t){const e=new Ui,{vertex:i,fragment:r}=e;if(l0(i),t.geometry===Wm.Underground)e.attributes.add(A.POSITION,"vec2"),e.varyings.add("color","vec4"),i.uniforms.add([new ni("cameraPosition",(s,n)=>n.camera.eye),new He("undergroundFadeAlpha",s=>s.undergroundFadeAlpha)]),i.code.add(x`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),r.code.add(x`void main() {
gl_FragColor = color;
}`);else{e.include(nc,t),e.attributes.add(A.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const s=t.geometry===Wm.Cylinder;i.uniforms.add([new Jr("proj",(a,l)=>l.camera.projectionMatrix),new Jr("view",(a,l)=>l.camera.viewMatrix)]),s||(e.varyings.add("innerFactor","float"),i.uniforms.add(new ni("silCircleCenter",a=>a.silhouette.center)),i.uniforms.add(new ni("silCircleV1",a=>a.silhouette.v1)),i.uniforms.add(new ni("silCircleV2",a=>a.silhouette.v2)),i.uniforms.add(new zi("texV",a=>a.texV)),i.uniforms.add(new He("innerScale",a=>a.innerScale)));const n=6.2831853,o=1/128;i.code.add(x`
		void main(void) {
      ${s?x`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:x`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${x.float(n*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${x.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),r.uniforms.add(new zt("tex",a=>a.texture)),s||r.uniforms.add(new He("altitudeFade",a=>a.altitudeFade)),r.code.add(x`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${s?x`gl_FragColor = atmosphereColor;`:x`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return e}const mrt=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:pSe,SimpleAtmospherePassParameters:oQ,build:frt},Symbol.toStringTag,{value:"Module"}));let S5=class fSe extends ji{initializeProgram(e){return new ki(e.rctx,fSe.shader.get().build(this.configuration),Li)}initializePipeline(){return this.configuration.geometry===Wm.Cylinder?Qt({blending:Yn(Ve.SRC_ALPHA,Ve.ONE,Ve.ONE_MINUS_SRC_ALPHA,Ve.ONE_MINUS_SRC_ALPHA),culling:kK,depthTest:{func:Dr.LEQUAL},colorWrite:ui}):Qt({blending:Yn(Ve.SRC_ALPHA,Ve.ONE,Ve.ONE_MINUS_SRC_ALPHA,Ve.ONE_MINUS_SRC_ALPHA),depthTest:{func:Dr.LEQUAL},colorWrite:ui})}};S5.shader=new Vi(mrt,()=>ee(()=>import("./SimpleAtmosphere.glsl-542c79cb.js"),[],import.meta.url));const mSe=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function au(t,e=0){const i=t.stride;return t.fieldNames.filter(r=>{const s=t.fields.get(r).optional;return!(s&&s.glPadding)}).map(r=>{const s=t.fields.get(r),n=s.constructor.ElementCount,o=grt(s.constructor.ElementType),a=s.offset,l=!(!s.optional||!s.optional.glNormalized);return new jo(r,n,o,a,i,l,e)})}function grt(t){const e=yrt[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}const yrt={u8:wt.UNSIGNED_BYTE,u16:wt.UNSIGNED_SHORT,u32:wt.UNSIGNED_INT,i8:wt.BYTE,i16:wt.SHORT,i32:wt.INT,f32:wt.FLOAT};let aQ=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=9;const o=this.TypedArrayConstructor;s===void 0&&(s=9*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<9;s++)i[s]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[r++]=i[s]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<9;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};aQ.ElementCount=9;let lQ=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=16;const o=this.TypedArrayConstructor;s===void 0&&(s=16*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<16;s++)i[s]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[r++]=i[s]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<16;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};lQ.ElementCount=16;let h0=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=1;const o=this.TypedArrayConstructor;s===void 0&&(s=o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.stride=s,this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,i){this.typedBuffer[e*this.typedBufferStride]=i}get buffer(){return this.typedBuffer.buffer}};h0.ElementCount=1;let d0=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=2;const o=this.TypedArrayConstructor;s===void 0&&(s=2*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,It(i,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e]=i[1]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e]=r}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};d0.ElementCount=2;let p0=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=3;const o=this.TypedArrayConstructor;s===void 0&&(s=3*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,fe(i,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e]=i[2]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,s){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e]=s}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};p0.ElementCount=3;let f0=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.start=r,this.elementCount=4;const o=this.TypedArrayConstructor;s===void 0&&(s=4*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,nr(i,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e++]=i[2],this.typedBuffer[e]=i[3]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,s,n){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e++]=s,this.typedBuffer[e]=n}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};f0.ElementCount=4;let cQ=class gSe extends h0{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}static fromTypedArray(e,i){return new gSe(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};cQ.ElementType="f32";let m0=class kq extends d0{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(kq,e,i)}static fromTypedArray(e,i){return new kq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};m0.ElementType="f32";let Lr=class Bq extends p0{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(Bq,e,i)}static fromTypedArray(e,i){return new Bq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Lr.ElementType="f32";let iu=class zq extends f0{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(zq,e,i)}static fromTypedArray(e,i){return new zq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};iu.ElementType="f32";let n1=class Gq extends aQ{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(Gq,e,i)}static fromTypedArray(e,i){return new Gq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};n1.ElementType="f32";let uQ=class jq extends aQ{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(jq,e,i)}static fromTypedArray(e,i){return new jq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};uQ.ElementType="f64";let hQ=class Hq extends lQ{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(Hq,e,i)}static fromTypedArray(e,i){return new Hq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};hQ.ElementType="f32";let uP=class qq extends lQ{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(qq,e,i)}static fromTypedArray(e,i){return new qq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};uP.ElementType="f64";let dQ=class Wq extends h0{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(Wq,e,i)}static fromTypedArray(e,i){return new Wq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};dQ.ElementType="f64";let pQ=class Xq extends d0{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(Xq,e,i)}static fromTypedArray(e,i){return new Xq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};pQ.ElementType="f64";let Da=class Yq extends p0{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(Yq,e,i)}static fromTypedArray(e,i){return new Yq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Da.ElementType="f64";let o8=class Zq extends f0{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(Zq,e,i)}static fromTypedArray(e,i){return new Zq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};o8.ElementType="f64";let MC=class Jq extends h0{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(Jq,e,i)}static fromTypedArray(e,i){return new Jq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};MC.ElementType="u8";let a8=class Kq extends d0{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(Kq,e,i)}static fromTypedArray(e,i){return new Kq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};a8.ElementType="u8";let hP=class Qq extends p0{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(Qq,e,i)}static fromTypedArray(e,i){return new Qq(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};hP.ElementType="u8";let Na=class eW extends f0{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(eW,e,i)}static fromTypedArray(e,i){return new eW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Na.ElementType="u8";let l8=class tW extends h0{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(tW,e,i)}static fromTypedArray(e,i){return new tW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};l8.ElementType="u16";let fQ=class iW extends d0{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(iW,e,i)}static fromTypedArray(e,i){return new iW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};fQ.ElementType="u16";let c8=class rW extends p0{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(rW,e,i)}static fromTypedArray(e,i){return new rW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};c8.ElementType="u16";let SI=class sW extends f0{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(sW,e,i)}static fromTypedArray(e,i){return new sW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};SI.ElementType="u16";let u8=class nW extends h0{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(nW,e,i)}static fromTypedArray(e,i){return new nW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};u8.ElementType="u32";let mQ=class oW extends d0{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(oW,e,i)}static fromTypedArray(e,i){return new oW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};mQ.ElementType="u32";let ySe=class aW extends p0{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(aW,e,i)}static fromTypedArray(e,i){return new aW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ySe.ElementType="u32";let _Se=class lW extends f0{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(lW,e,i)}static fromTypedArray(e,i){return new lW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};_Se.ElementType="u32";let gQ=class cW extends h0{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(cW,e,i)}static fromTypedArray(e,i){return new cW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};gQ.ElementType="i8";let h8=class uW extends d0{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(uW,e,i)}static fromTypedArray(e,i){return new uW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};h8.ElementType="i8";let vSe=class hW extends p0{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(hW,e,i)}static fromTypedArray(e,i){return new hW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};vSe.ElementType="i8";let bSe=class dW extends f0{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(dW,e,i)}static fromTypedArray(e,i){return new dW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};bSe.ElementType="i8";let wSe=class pW extends h0{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(pW,e,i)}static fromTypedArray(e,i){return new pW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};wSe.ElementType="i16";let d8=class fW extends d0{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(fW,e,i)}static fromTypedArray(e,i){return new fW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};d8.ElementType="i16";let xSe=class mW extends p0{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(mW,e,i)}static fromTypedArray(e,i){return new mW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};xSe.ElementType="i16";let TSe=class gW extends f0{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(gW,e,i)}static fromTypedArray(e,i){return new gW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};TSe.ElementType="i16";let SSe=class yW extends h0{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(yW,e,i)}static fromTypedArray(e,i){return new yW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};SSe.ElementType="i32";let ESe=class _W extends d0{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(_W,e,i)}static fromTypedArray(e,i){return new _W(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ESe.ElementType="i32";let CSe=class vW extends p0{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(vW,e,i)}static fromTypedArray(e,i){return new vW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};CSe.ElementType="i32";let ASe=class bW extends f0{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(bW,e,i)}static fromTypedArray(e,i){return new bW(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ASe.ElementType="i32";function OSe(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}function _rt(t){switch(t){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0}}function vrt(t){switch(t){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1}}function brt(t){switch(t){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303}}let Cae=class RSe{constructor(e,i){this.layout=e,this.buffer=typeof i=="number"?new ArrayBuffer(i*e.stride):i;for(const r of e.fieldNames){const s=e.fields.get(r);this[r]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,i){const r=this[e];return r&&r.elementCount===i.ElementCount&&r.elementType===i.ElementType?r:null}slice(e,i){return new RSe(this.layout,this.buffer.slice(e*this.stride,i*this.stride))}copyFrom(e,i,r,s){const n=this.stride;if(n%4==0){const o=new Uint32Array(e.buffer,i*n,s*n/4);new Uint32Array(this.buffer,r*n,s*n/4).set(o)}else{const o=new Uint8Array(e.buffer,i*n,s*n);new Uint8Array(this.buffer,r*n,s*n).set(o)}}},wrt=class MSe{constructor(){this.stride=0,this.fields=new Map,this.fieldNames=[]}vec2f(e,i){return this._appendField(e,m0,i),this}vec2f64(e,i){return this._appendField(e,pQ,i),this}vec3f(e,i){return this._appendField(e,Lr,i),this}vec3f64(e,i){return this._appendField(e,Da,i),this}vec4f(e,i){return this._appendField(e,iu,i),this}vec4f64(e,i){return this._appendField(e,o8,i),this}mat3f(e,i){return this._appendField(e,n1,i),this}mat3f64(e,i){return this._appendField(e,uQ,i),this}mat4f(e,i){return this._appendField(e,hQ,i),this}mat4f64(e,i){return this._appendField(e,uP,i),this}vec4u8(e,i){return this._appendField(e,Na,i),this}f32(e,i){return this._appendField(e,cQ,i),this}f64(e,i){return this._appendField(e,dQ,i),this}u8(e,i){return this._appendField(e,MC,i),this}u16(e,i){return this._appendField(e,l8,i),this}i8(e,i){return this._appendField(e,gQ,i),this}vec2i8(e,i){return this._appendField(e,h8,i),this}vec2i16(e,i){return this._appendField(e,d8,i),this}vec2u8(e,i){return this._appendField(e,a8,i),this}vec4u16(e,i){return this._appendField(e,SI,i),this}u32(e,i){return this._appendField(e,u8,i),this}_appendField(e,i,r){const s=i.ElementCount*OSe(i.ElementType),n=this.stride;this.fields.set(e,{size:s,constructor:i,offset:n,optional:r}),this.stride+=s,this.fieldNames.push(e)}alignTo(e){return this.stride=Math.floor((this.stride+e-1)/e)*e,this}hasField(e){return this.fieldNames.includes(e)}createBuffer(e){return new Cae(this,e)}createView(e){return new Cae(this,e)}clone(){const e=new MSe;return e.stride=this.stride,e.fields=new Map,this.fields.forEach((i,r)=>e.fields.set(r,i)),e.fieldNames=this.fieldNames.slice(),e.BufferType=this.BufferType,e}};function cs(){return new wrt}let ht=class{constructor(e,i,r=!1,s=i){this.data=e,this.size=i,this.exclusive=r,this.stride=s}};var wW;(function(t){function e(o,a){const l=o[a],c=o[a+1],h=o[a+2];return Math.sqrt(l*l+c*c+h*h)}function i(o,a){const l=o[a],c=o[a+1],h=o[a+2],p=1/Math.sqrt(l*l+c*c+h*h);o[a]*=p,o[a+1]*=p,o[a+2]*=p}function r(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function s(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]+l[c],h[p+1]=o[a+1]+l[c+1],h[p+2]=o[a+2]+l[c+2]}function n(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]-l[c],h[p+1]=o[a+1]-l[c+1],h[p+2]=o[a+2]-l[c+2]}t.length=e,t.normalize=i,t.scale=r,t.add=s,t.subtract=n})(wW||(wW={}));var Vs;(function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"})(Vs||(Vs={}));function ru(t,e=!1){return t<=Nm?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function xrt(t){return length<=Nm?Array.from(t):new Float64Array(t)}function ld(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}function Qs(t,e=!1){return t<=Nm?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function Aae(t){return length<=Nm?Array.from(t):new Float32Array(t)}function Oae(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}function Trt(t){if(t.length<Nm)return Array.from(t);if(Array.isArray(t))return Float64Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return Uint16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}const Ha=fi();let Srt=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function Ct(t,e){if(!t){e=e||"Assertion";const i=new Error(e).stack;throw new Srt(`${e} at ${i}`)}}function IT(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function Rae(t,e,i,r){let s,n=(i[0]-t[0])/e[0],o=(r[0]-t[0])/e[0];n>o&&(s=n,n=o,o=s);let a=(i[1]-t[1])/e[1],l=(r[1]-t[1])/e[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let c=(i[2]-t[2])/e[2],h=(r[2]-t[2])/e[2];return c>h&&(s=c,c=h,h=s),!(n>h||c>o)&&(h<o&&(o=h),!(o<0))}function K$(t,e,i,r,s,n=et()){const o=(r[s]-i[s])*(e[0]-t[0])-(r[0]-i[0])*(e[s]-t[s]),a=(r[0]-i[0])*(t[s]-i[s])-(r[s]-i[s])*(t[0]-i[0]);if(o===0)return!1;const l=a/o;return n[0]=t[0]+l*(e[0]-t[0]),n[1]=t[s]+l*(e[s]-t[s]),!0}function Mae(t,e,i,r,s){Ha[0]=t[0],Ha[1]=t[1],Ha[2]=t[2],Ha[3]=1,qu(Ha,Ha,e),s.length>2&&(s[2]=-Ha[2]),qu(Ha,Ha,i),Ct(Ha[3]!==0),s[0]=Ha[0]/Ha[3],s[1]=Ha[1]/Ha[3],s[2]=Ha[2]/Ha[3],s[0]=(.5*s[0]+.5)*r[2]+r[0],s[1]=(.5*s[1]+.5)*r[3]+r[1]}function Ert(t,e){return Math.log(t)/Math.log(e)}function Crt(t,e,i,r){t[12]=e,t[13]=i,t[14]=r}function PSe(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}let ISe=class $Se{constructor(e,i,r,s){this.primitiveIndices=e,this._numIndexPerPrimitive=i,this.indices=r,this.position=s,this._children=void 0,Ct(e.length>=1),Ct(r.length%this._numIndexPerPrimitive==0),Ct(r.length>=e.length*this._numIndexPerPrimitive),Ct(s.size===3||s.size===4);const{data:n,size:o}=s,a=e.length;let l=o*r[this._numIndexPerPrimitive*e[0]];U1.clear(),U1.push(l);const c=Xe(n[l],n[l+1],n[l+2]),h=xs(c);for(let m=0;m<a;++m){const y=this._numIndexPerPrimitive*e[m];for(let _=0;_<this._numIndexPerPrimitive;++_){l=o*r[y+_],U1.push(l);let b=n[l];c[0]=Math.min(b,c[0]),h[0]=Math.max(b,h[0]),b=n[l+1],c[1]=Math.min(b,c[1]),h[1]=Math.max(b,h[1]),b=n[l+2],c[2]=Math.min(b,c[2]),h[2]=Math.max(b,h[2])}}this.bbMin=c,this.bbMax=h;const p=tn(M(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(h[0]-c[0],h[1]-c[1]),h[2]-c[2]);let f=this.radius*this.radius;for(let m=0;m<U1.length;++m){l=U1.getItemAt(m);const y=n[l]-p[0],_=n[l+1]-p[1],b=n[l+2]-p[2],w=y*y+_*_+b*b;if(w<=f)continue;const S=Math.sqrt(w),T=.5*(S-this.radius);this.radius=this.radius+T,f=this.radius*this.radius;const E=T/S;p[0]+=y*E,p[1]+=_*E,p[2]+=b*E}this.center=p,U1.clear()}getChildren(){if(this._children||Bo(this.bbMin,this.bbMax)<=1)return this._children;const e=tn(M(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,r=new Uint8Array(i),s=new Array(8);for(let c=0;c<8;++c)s[c]=0;const{data:n,size:o}=this.position;for(let c=0;c<i;++c){let h=0;const p=this._numIndexPerPrimitive*this.primitiveIndices[c];let f=o*this.indices[p],m=n[f],y=n[f+1],_=n[f+2];for(let b=1;b<this._numIndexPerPrimitive;++b){f=o*this.indices[p+b];const w=n[f],S=n[f+1],T=n[f+2];w<m&&(m=w),S<y&&(y=S),T<_&&(_=T)}m<e[0]&&(h|=1),y<e[1]&&(h|=2),_<e[2]&&(h|=4),r[c]=h,++s[h]}let a=0;for(let c=0;c<8;++c)s[c]>0&&++a;if(a<2)return;const l=new Array(8);for(let c=0;c<8;++c)l[c]=s[c]>0?new Uint32Array(s[c]):void 0;for(let c=0;c<8;++c)s[c]=0;for(let c=0;c<i;++c){const h=r[c];l[h][s[h]++]=this.primitiveIndices[c]}this._children=new Array;for(let c=0;c<8;++c)l[c]!==void 0&&this._children.push(new $Se(l[c],this._numIndexPerPrimitive,this.indices,this.position));return this._children}static prune(){U1.prune()}};const U1=new li({deallocator:null});let EI=class{constructor(){this.id=Zc()}unload(){}};function Art(t){return t?{p0:xs(t.p0),p1:xs(t.p1),p2:xs(t.p2)}:{p0:M(),p1:M(),p2:M()}}function Pae(t,e,i){const r=e[0]-t[0],s=e[1]-t[1],n=i[0]-t[0],o=i[1]-t[1];return .5*Math.abs(r*o-s*n)}function Ort(t,e,i){return be(h9,e,t),be(Iae,i,t),je(Et(h9,h9,Iae))/2}new n0(nf);new n0(()=>Art());const h9=M(),Iae=M();function Rrt(t,e,i){if(!t||!e)return!1;const{size:r,data:s}=t;fe(i,0,0,0),fe(Uh,0,0,0);let n=0,o=0;for(let a=0;a<e.length-2;a+=3){const l=e[a+0]*r,c=e[a+1]*r,h=e[a+2]*r;fe(lo,s[l+0],s[l+1],s[l+2]),fe(_y,s[c+0],s[c+1],s[c+2]),fe(Q$,s[h+0],s[h+1],s[h+2]);const p=Ort(lo,_y,Q$);p?(ve(lo,lo,_y),ve(lo,lo,Q$),ue(lo,lo,1/3*p),ve(i,i,lo),n+=p):(ve(Uh,Uh,lo),ve(Uh,Uh,_y),ve(Uh,Uh,Q$),o+=3)}return(o!==0||n!==0)&&(n!==0?(ue(i,i,1/n),!0):o!==0&&(ue(i,Uh,1/o),!0))}function Mrt(t,e,i){if(!t||!e)return!1;const{size:r,data:s}=t;fe(i,0,0,0);let n=-1,o=0;for(let a=0;a<e.length;a++){const l=e[a]*r;n!==l&&(i[0]+=s[l+0],i[1]+=s[l+1],i[2]+=s[l+2],o++),n=l}return o>1&&ue(i,i,1/o),o>0}function Prt(t,e,i,r){if(!t)return!1;fe(r,0,0,0),fe(Uh,0,0,0);let s=0,n=0;const{size:o,data:a}=t,l=e?e.length-1:a.length/o-1,c=l+(i?2:0);for(let h=0;h<c;h+=2){const p=h<l?h:l,f=h<l?h+1:0,m=(e?e[p]:p)*o,y=(e?e[f]:f)*o;lo[0]=a[m],lo[1]=a[m+1],lo[2]=a[m+2],_y[0]=a[y],_y[1]=a[y+1],_y[2]=a[y+2],ue(lo,ve(lo,lo,_y),.5);const _=XP(lo,_y);_>0?(ve(r,r,ue(lo,lo,_)),s+=_):s===0&&(ve(Uh,Uh,lo),n++)}return s!==0?(ue(r,r,1/s),!0):n!==0&&(ue(r,Uh,1/n),!0)}const lo=M(),_y=M(),Q$=M(),Uh=M();function RE(t){if(Array.isArray(t)){if(t.length<Nm)return t;for(const e of t)if(e>=65536)return new Uint32Array(t);return new Uint16Array(t)}if(t.length<Nm)return Array.from(t);if(t.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return t;for(const e of t)if(e>=65536)return t;return new Uint16Array(t)}function LSe(t){const e=3*t;return e<=Nm?new Array(e):e<=65536?new Uint16Array(e):new Uint32Array(e)}let Q_=(()=>{const t=new Uint32Array(131072);for(let e=0;e<t.length;++e)t[e]=e;return t})();const DSe=[0],ME=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function PC(t){if(t===1)return DSe;if(t<Nm)return Array.from(new Uint16Array(ME.buffer,0,t));if(t<ME.length)return new Uint16Array(ME.buffer,0,t);if(t>Q_.length){const e=Math.max(2*Q_.length,t);Q_=new Uint32Array(e);for(let i=0;i<Q_.length;i++)Q_[i]=i}return new Uint32Array(Q_.buffer,0,t)}function QDt(t){if(t===1)return DSe;if(t<Nm)return Array.from(new Uint16Array(ME.buffer,0,t));if(t<ME.length)return new Uint16Array(ME.slice(0,t));if(t>Q_.length){const e=new Uint32Array(t);for(let i=0;i<e.length;i++)e[i]=i;return e}return new Uint32Array(Q_.slice(0,t))}let E5=class{constructor(e){this.channel=e,this.id=Zc()}};function xW(t,e,i){for(let r=0;r<i;++r)e[2*r]=t[r],e[2*r+1]=t[r]-e[2*r]}function Irt(t,e){const i=t.length;for(let r=0;r<i;++r)KS[0]=t[r],e[r]=KS[0];return e}function $rt(t,e){const i=t.length;for(let r=0;r<i;++r)KS[0]=t[r],KS[1]=t[r]-KS[0],e[r]=KS[1];return e}const KS=new Float32Array(2);function TW(t,e){return C(t)&&(t=[]),t.push(e),t}function SW(t,e){if(C(t))return null;const i=t.filter(r=>r!==e);return i.length===0?null:i}function Lrt(t,e,i,r,s){eL[0]=t.get(e,0),eL[1]=t.get(e,1),eL[2]=t.get(e,2),xW(eL,V1,3),i.set(s,0,V1[0]),r.set(s,0,V1[1]),i.set(s,1,V1[2]),r.set(s,1,V1[3]),i.set(s,2,V1[4]),r.set(s,2,V1[5])}const eL=M(),V1=new Float32Array(6);let fn=class NSe extends EI{constructor(e,i,r=[],s=null,n=Vs.Mesh,o=null,a=-1){super(),this.material=e,this.mapPositions=s,this.type=n,this.objectAndLayerIdColor=o,this.edgeIndicesLength=a,this.visible=!0,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[l,c]of i)c&&this._vertexAttributes.set(l,{...c});if(r==null||r.length===0){const l=Drt(this._vertexAttributes),c=PC(l);this.edgeIndicesLength=this.edgeIndicesLength<0?l:this.edgeIndicesLength;for(const h of this._vertexAttributes.keys())this._indices.set(h,c)}else for(const[l,c]of r)c&&(this._indices.set(l,RE(c)),l===A.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(l).length:this.edgeIndicesLength))}instantiate(e={}){const i=new NSe(e.material||this.material,[],void 0,this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._vertexAttributes.forEach((r,s)=>{r.exclusive=!1,i._vertexAttributes.set(s,r)}),this._indices.forEach((r,s)=>i._indices.set(s,r)),i._boundingInfo=this._boundingInfo,i.transformation=e.transformation||this.transformation,i}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(e){let i=this._vertexAttributes.get(e);return i&&!i.exclusive&&(i={...i,exclusive:!0,data:Trt(i.data)},this._vertexAttributes.set(e,i)),i}get indices(){return this._indices}get indexCount(){const e=this._indices.values().next().value;return e?e.length:0}get faceCount(){return this.indexCount/3}get boundingInfo(){return C(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===Vs.Mesh?this._computeAttachmentOriginTriangles(e):this.type===Vs.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(v(this._transformation)&&ut(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const i=this.indices.get(A.POSITION),r=this.vertexAttributes.get(A.POSITION);return Rrt(r,i,e)}_computeAttachmentOriginLines(e){const i=this.vertexAttributes.get(A.POSITION),r=this.indices.get(A.POSITION);return Prt(i,r,r&&Nrt(this.material.parameters,i,r),e)}_computeAttachmentOriginPoints(e){const i=this.indices.get(A.POSITION),r=this.vertexAttributes.get(A.POSITION);return Mrt(r,i,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.indices.get(A.POSITION),i=this.vertexAttributes.get(A.POSITION);if(!e||e.length===0||!i)return null;const r=this.type===Vs.Mesh?3:1;Ct(e.length%r==0,"Indexing error: "+e.length+" not divisible by "+r);const s=PC(e.length/r);return new ISe(s,r,e,i)}get transformation(){return Gt(this._transformation,th)}set transformation(e){this._transformation=e&&e!==th?hC(e):null}get shaderTransformation(){return v(this._shaderTransformer)?this._shaderTransformer(this.transformation):this.transformation}get shaderTransformer(){return this._shaderTransformer}set shaderTransformer(e){this._shaderTransformer=e}get hasVolatileTransformation(){return v(this._shaderTransformer)}addHighlight(){const e=new E5(Zy.Highlight);return this.highlights=TW(this.highlights,e),e}removeHighlight(e){this.highlights=SW(this.highlights,e)}};function Drt(t){const e=t.values().next().value;return e==null?0:e.data.length/e.size}function Nrt(t,e,i){return!(!("isClosed"in t)||!t.isClosed)&&(i?i.length>2:e.data.length>6)}const $T=wW,d9=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],Frt=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],Urt=[0,0,1,0,1,1,0,1],Vrt=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],FSe=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)FSe[6*t+e]=t;const rw=new Array(36);for(let t=0;t<6;t++)rw[6*t+0]=0,rw[6*t+1]=1,rw[6*t+2]=2,rw[6*t+3]=2,rw[6*t+4]=3,rw[6*t+5]=0;function krt(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(24);for(let r=0;r<8;r++)i[3*r]=d9[r][0]*e[0],i[3*r+1]=d9[r][1]*e[1],i[3*r+2]=d9[r][2]*e[2];return new fn(t,[[A.POSITION,new ht(i,3,!0)],[A.NORMAL,new ht(Frt,3)],[A.UV0,new ht(Urt,2)]],[[A.POSITION,Vrt],[A.NORMAL,FSe],[A.UV0,rw]])}const p9=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],Brt=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],zrt=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],Grt=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function jrt(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(18);for(let r=0;r<6;r++)i[3*r]=p9[r][0]*e[0],i[3*r+1]=p9[r][1]*e[1],i[3*r+2]=p9[r][2]*e[2];return new fn(t,[[A.POSITION,new ht(i,3,!0)],[A.NORMAL,new ht(Brt,3)]],[[A.POSITION,zrt],[A.NORMAL,Grt]])}const mF=er(-.5,0,-.5),gF=er(.5,0,-.5),yF=er(0,0,.5),_F=er(0,.5,0),LT=qr(),DT=qr(),PE=qr(),IE=qr(),$E=qr();be(LT,mF,_F),be(DT,mF,gF),Et(PE,LT,DT),Oe(PE,PE),be(LT,gF,_F),be(DT,gF,yF),Et(IE,LT,DT),Oe(IE,IE),be(LT,yF,_F),be(DT,yF,mF),Et($E,LT,DT),Oe($E,$E);const f9=[mF,gF,yF,_F],Hrt=[0,-1,0,PE[0],PE[1],PE[2],IE[0],IE[1],IE[2],$E[0],$E[1],$E[2]],qrt=[0,1,2,3,1,0,3,2,1,3,0,2],Wrt=[0,0,0,1,1,1,2,2,2,3,3,3];function Xrt(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(12);for(let r=0;r<4;r++)i[3*r]=f9[r][0]*e[0],i[3*r+1]=f9[r][1]*e[1],i[3*r+2]=f9[r][2]*e[2];return new fn(t,[[A.POSITION,new ht(i,3,!0)],[A.NORMAL,new ht(Hrt,3)]],[[A.POSITION,qrt],[A.NORMAL,Wrt]])}function tNt(t,e,i,r,s={uv:!0}){const n=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(i)),h=Math.max(2,Math.floor(r)),p=(c+1)*(h+1),f=Qs(3*p),m=Qs(3*p),y=Qs(2*p),_=[];let b=0;for(let E=0;E<=h;E++){const O=[],R=E/h,L=a+R*l,P=Math.cos(L);for(let F=0;F<=c;F++){const V=F/c,B=n+V*o,G=Math.cos(B)*P,te=Math.sin(L),se=-Math.sin(B)*P;f[3*b]=G*e,f[3*b+1]=te*e,f[3*b+2]=se*e,m[3*b]=G,m[3*b+1]=te,m[3*b+2]=se,y[2*b]=V,y[2*b+1]=R,O.push(b),++b}_.push(O)}const w=new Array;for(let E=0;E<h;E++)for(let O=0;O<c;O++){const R=_[E][O],L=_[E][O+1],P=_[E+1][O+1],F=_[E+1][O];E===0?(w.push(R),w.push(P),w.push(F)):E===h-1?(w.push(R),w.push(L),w.push(P)):(w.push(R),w.push(L),w.push(P),w.push(P),w.push(F),w.push(R))}const S=[[A.POSITION,w],[A.NORMAL,w]],T=[[A.POSITION,new ht(f,3,!0)],[A.NORMAL,new ht(m,3,!0)]];return s.uv&&(T.push([A.UV0,new ht(y,2,!0)]),S.push([A.UV0,w])),s.offset&&(S[0][0]=A.OFFSET,T[0][0]=A.OFFSET,S.push([A.POSITION,new Array(w.length).fill(0)]),T.push([A.POSITION,new ht(Float64Array.from(s.offset),3,!0)])),new fn(t,T,S)}function Yrt(t,e,i,r){const{vertexAttributes:s,indices:n}=USe(e,i,r);return new fn(t,s,n)}function USe(t,e,i){const r=t;let s,n;if(i)s=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const h=r*(1+Math.sqrt(5))/2;s=[-r,h,0,r,h,0,-r,-h,0,r,-h,0,0,-r,h,0,r,h,0,-r,-h,0,r,-h,h,0,-r,h,0,r,-h,0,-r,-h,0,r],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let h=0;h<s.length;h+=3)$T.scale(s,h,t/$T.length(s,h));let o={};function a(h,p){h>p&&([h,p]=[p,h]);const f=h.toString()+"."+p.toString();if(o[f])return o[f];let m=s.length;return s.length+=3,$T.add(s,3*h,s,3*p,s,m),$T.scale(s,m,t/$T.length(s,m)),m/=3,o[f]=m,m}for(let h=0;h<e;h++){const p=n.length,f=new Array(4*p);for(let m=0;m<p;m+=3){const y=n[m],_=n[m+1],b=n[m+2],w=a(y,_),S=a(_,b),T=a(b,y),E=4*m;f[E]=y,f[E+1]=w,f[E+2]=T,f[E+3]=_,f[E+4]=S,f[E+5]=w,f[E+6]=b,f[E+7]=T,f[E+8]=S,f[E+9]=w,f[E+10]=S,f[E+11]=T}n=f,o={}}const l=Aae(s);for(let h=0;h<l.length;h+=3)$T.normalize(l,h);const c=[[A.POSITION,n],[A.NORMAL,n]];return{vertexAttributes:[[A.POSITION,new ht(Aae(s),3,!0)],[A.NORMAL,new ht(l,3,!0)]],indices:c}}function EW(t,e,i,r,s,n,o,a,l=null){const c=i?[i[0],i[1],i[2]]:[0,0,0],h=e?[e[0],e[1],e[2]]:[0,0,1];o=o||[0,0];const p=r?[255*r[0],255*r[1],255*r[2],r.length>3?255*r[3]:255]:[255,255,255,255],f=v(s)&&s.length===2?s:[1,1],m=[[A.POSITION,new ht(c,3,!0)],[A.NORMAL,new ht(h,3,!0)],[A.UV0,new ht(o,o.length)],[A.COLOR,new ht(p,4,!0)],[A.SIZE,new ht(f,2)]];if(n!=null){const y=[n[0],n[1],n[2],n[3]];m.push([A.AUXPOS1,new ht(y,4)])}if(a!=null){const y=[a[0],a[1],a[2],a[3]];m.push([A.AUXPOS2,new ht(y,4)])}return new fn(t,m,null,null,Vs.Point,l)}const Zrt=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function iNt(t,e=Zrt){const i=new Array(12);for(let h=0;h<4;h++)for(let p=0;p<3;p++)i[3*h+p]=e[h][p];const r=[0,1,2,2,3,0],s=[0,0,1],n=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[A.POSITION,r],[A.NORMAL,n],[A.UV0,r],[A.COLOR,n]],c=[[A.POSITION,new ht(i,3,!0)],[A.NORMAL,new ht(s,3,!0)],[A.UV0,new ht(o,2,!0)],[A.COLOR,new ht(a,4,!0)]];return new fn(t,c,l)}function $ae(t,e,i,r,s,n=!0,o=!0){let a=0;const l=i,c=e;let h=er(0,a,0),p=er(0,a+c,0),f=er(0,-1,0),m=er(0,1,0);s&&(a=c,p=er(0,0,0),h=er(0,a,0),f=er(0,1,0),m=er(0,-1,0));const y=[p,h],_=[f,m],b=r+2,w=Math.sqrt(c*c+l*l);if(s)for(let P=r-1;P>=0;P--){const F=P*(2*Math.PI/r),V=er(Math.cos(F)*l,a,Math.sin(F)*l);y.push(V);const B=er(c*Math.cos(F)/w,-l/w,c*Math.sin(F)/w);_.push(B)}else for(let P=0;P<r;P++){const F=P*(2*Math.PI/r),V=er(Math.cos(F)*l,a,Math.sin(F)*l);y.push(V);const B=er(c*Math.cos(F)/w,l/w,c*Math.sin(F)/w);_.push(B)}const S=new Array,T=new Array;if(n){for(let P=3;P<y.length;P++)S.push(1),S.push(P-1),S.push(P),T.push(0),T.push(0),T.push(0);S.push(y.length-1),S.push(2),S.push(1),T.push(0),T.push(0),T.push(0)}if(o){for(let P=3;P<y.length;P++)S.push(P),S.push(P-1),S.push(0),T.push(P),T.push(P-1),T.push(1);S.push(0),S.push(2),S.push(y.length-1),T.push(1),T.push(2),T.push(_.length-1)}const E=Qs(3*b);for(let P=0;P<b;P++)E[3*P]=y[P][0],E[3*P+1]=y[P][1],E[3*P+2]=y[P][2];const O=Qs(3*b);for(let P=0;P<b;P++)O[3*P]=_[P][0],O[3*P+1]=_[P][1],O[3*P+2]=_[P][2];const R=[[A.POSITION,S],[A.NORMAL,T]],L=[[A.POSITION,new ht(E,3,!0)],[A.NORMAL,new ht(O,3,!0)]];return new fn(t,L,R)}function Jrt(t,e,i,r,s,n,o){const a=s?v5(s):er(1,0,0),l=n?v5(n):er(0,0,0);o=o??!0;const c=qr();Oe(c,a);const h=qr();ue(h,c,Math.abs(e));const p=qr();ue(p,h,-.5),ve(p,p,l);const f=er(0,1,0);Math.abs(1-Ae(c,f))<.2&&fe(f,0,0,1);const m=qr();Et(m,c,f),Oe(m,m),Et(f,m,c);const y=2*r+(o?2:0),_=r+(o?2:0),b=Qs(3*y),w=Qs(3*_),S=Qs(2*y),T=new Array(3*r*(o?4:2)),E=new Array(3*r*(o?4:2));o&&(b[3*(y-2)+0]=p[0],b[3*(y-2)+1]=p[1],b[3*(y-2)+2]=p[2],S[2*(y-2)]=0,S[2*(y-2)+1]=0,b[3*(y-1)+0]=b[3*(y-2)+0]+h[0],b[3*(y-1)+1]=b[3*(y-2)+1]+h[1],b[3*(y-1)+2]=b[3*(y-2)+2]+h[2],S[2*(y-1)]=1,S[2*(y-1)+1]=1,w[3*(_-2)+0]=-c[0],w[3*(_-2)+1]=-c[1],w[3*(_-2)+2]=-c[2],w[3*(_-1)+0]=c[0],w[3*(_-1)+1]=c[1],w[3*(_-1)+2]=c[2]);const O=(B,G,te)=>{T[B]=G,E[B]=te};let R=0;const L=qr(),P=qr();for(let B=0;B<r;B++){const G=B*(2*Math.PI/r);ue(L,f,Math.sin(G)),ue(P,m,Math.cos(G)),ve(L,L,P),w[3*B+0]=L[0],w[3*B+1]=L[1],w[3*B+2]=L[2],ue(L,L,i),ve(L,L,p),b[3*B+0]=L[0],b[3*B+1]=L[1],b[3*B+2]=L[2],S[2*B+0]=B/r,S[2*B+1]=0,b[3*(B+r)+0]=b[3*B+0]+h[0],b[3*(B+r)+1]=b[3*B+1]+h[1],b[3*(B+r)+2]=b[3*B+2]+h[2],S[2*(B+r)+0]=B/r,S[2*B+1]=1;const te=(B+1)%r;O(R++,B,B),O(R++,B+r,B),O(R++,te,te),O(R++,te,te),O(R++,B+r,B),O(R++,te+r,te)}if(o){for(let B=0;B<r;B++){const G=(B+1)%r;O(R++,y-2,_-2),O(R++,B,_-2),O(R++,G,_-2)}for(let B=0;B<r;B++){const G=(B+1)%r;O(R++,B+r,_-1),O(R++,y-1,_-1),O(R++,G+r,_-1)}}const F=[[A.POSITION,T],[A.NORMAL,E],[A.UV0,T]],V=[[A.POSITION,new ht(b,3,!0)],[A.NORMAL,new ht(w,3,!0)],[A.UV0,new ht(S,2,!0)]];return new fn(t,V,F)}function rNt(t,e,i,r,s,n,o=er(0,0,0)){const a=e.length,l=Qs(i.length*a*3+(6*r.length||0)),c=Qs(i.length*a*3+(r?6:0)),h=new Array,p=new Array;let f=0,m=0;const y=qr(),_=qr(),b=qr(),w=qr(),S=qr(),T=qr(),E=qr(),O=M(),R=qr(),L=qr(),P=qr(),F=qr(),V=qr(),B=qi();fe(R,0,1,0),be(_,i[1],i[0]),Oe(_,_),n?(ve(O,i[0],o),Oe(b,O)):fe(b,0,0,1),C5(_,b,R,R,S,b,Lae),he(w,b),he(F,S);for(let U=0;U<r.length;U++)ue(T,S,r[U][0]),ue(O,b,r[U][2]),ve(T,T,O),ve(T,T,i[0]),l[f++]=T[0],l[f++]=T[1],l[f++]=T[2];c[m++]=-_[0],c[m++]=-_[1],c[m++]=-_[2];for(let U=0;U<s.length;U++)h.push(s[U][0]>0?s[U][0]:-s[U][0]-1+r.length),h.push(s[U][1]>0?s[U][1]:-s[U][1]-1+r.length),h.push(s[U][2]>0?s[U][2]:-s[U][2]-1+r.length),p.push(0),p.push(0),p.push(0);let G=r.length;const te=r.length-1;for(let U=0;U<i.length;U++){let q=!1;U>0&&(he(y,_),U<i.length-1?(be(_,i[U+1],i[U]),Oe(_,_)):q=!0,ve(L,y,_),Oe(L,L),ve(P,i[U-1],w),nI(i[U],L,B),hT(B,ih(P,y),O)?(be(O,O,i[U]),Oe(b,O),Et(S,L,b),Oe(S,S)):C5(L,w,F,R,S,b,Lae),he(w,b),he(F,S)),n&&(ve(O,i[U],o),Oe(V,O));for(let Y=0;Y<a;Y++)if(ue(T,S,e[Y][0]),ue(O,b,e[Y][1]),ve(T,T,O),Oe(E,T),c[m++]=E[0],c[m++]=E[1],c[m++]=E[2],ve(T,T,i[U]),l[f++]=T[0],l[f++]=T[1],l[f++]=T[2],!q){const Q=(Y+1)%a;h.push(G+Y),h.push(G+a+Y),h.push(G+Q),h.push(G+Q),h.push(G+a+Y),h.push(G+a+Q);for(let X=0;X<6;X++){const pe=h.length-6;p.push(h[pe+X]-te)}}G+=a}const se=i[i.length-1];for(let U=0;U<r.length;U++)ue(T,S,r[U][0]),ue(O,b,r[U][1]),ve(T,T,O),ve(T,T,se),l[f++]=T[0],l[f++]=T[1],l[f++]=T[2];const ie=m/3;c[m++]=_[0],c[m++]=_[1],c[m++]=_[2];const H=G-a;for(let U=0;U<s.length;U++)h.push(s[U][0]>=0?G+s[U][0]:-s[U][0]-1+H),h.push(s[U][2]>=0?G+s[U][2]:-s[U][2]-1+H),h.push(s[U][1]>=0?G+s[U][1]:-s[U][1]-1+H),p.push(ie),p.push(ie),p.push(ie);const $=[[A.POSITION,h],[A.NORMAL,p]],N=[[A.POSITION,new ht(l,3,!0)],[A.NORMAL,new ht(c,3,!0)]];return new fn(t,N,$)}function sNt(t,e,i,r){Ct(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),Ct(e[0].length===3,"createPolylineGeometry(): malformed vertex"),Ct(i==null||i.length===e.length,"createPolylineGeometry: need same number of points and normals"),Ct(i==null||i[0].length===3,"createPolylineGeometry(): malformed normal");const s=ru(3*e.length),n=new Array(2*(e.length-1));let o=0,a=0;for(let h=0;h<e.length;h++){for(let p=0;p<3;p++)s[o++]=e[h][p];h>0&&(n[a++]=h-1,n[a++]=h)}const l=[],c=[];if(l.push([A.POSITION,n]),c.push([A.POSITION,new ht(s,3,!0)]),i){const h=Qs(3*i.length);let p=0;for(let f=0;f<e.length;f++)for(let m=0;m<3;m++)h[p++]=i[f][m];l.push([A.NORMAL,n]),c.push([A.NORMAL,new ht(h,3,!0)])}return r&&(c.push([A.COLOR,new ht(r,4)]),l.push([A.COLOR,PC(r.length/4)])),new fn(t,c,l,null,Vs.Line)}function Krt(t,e=t){const i=t.vertexAttributes,r=i.get(A.POSITION).data,s=i.get(A.NORMAL).data;if(s){const n=e.getMutableAttribute(A.NORMAL).data;for(let o=0;o<s.length;o+=3){const a=s[o+1];n[o+1]=-s[o+2],n[o+2]=a}}if(r){const n=e.getMutableAttribute(A.POSITION).data;for(let o=0;o<r.length;o+=3){const a=r[o+1];n[o+1]=-r[o+2],n[o+2]=a}}}function m9(t,e,i,r,s){return!(Math.abs(Ae(e,t))>s)&&(Et(i,t,e),Oe(i,i),Et(r,i,t),Oe(r,r),!0)}function C5(t,e,i,r,s,n,o){return m9(t,e,s,n,o)||m9(t,i,s,n,o)||m9(t,r,s,n,o)}const Lae=.99619469809;let Qrt=class{constructor(e,i){this.type=Vn.Panoramic,this._configuration=new nQ,this._passParameters=new oQ,this._configuration.geometry=Wm.Cylinder,this._technique=i.techniqueRepository.acquire(S5,this._configuration);const r=i.renderContext.rctx;this._vao=this._createVertexArrayObject(r),this._vaoCount=oa(this._vao,"geometry"),this._passParameters.texture=new xt(r,{pixelFormat:it.RGBA,dataType:Ht.UNSIGNED_BYTE,wrapMode:kt.CLAMP_TO_EDGE,samplingMode:gt.LINEAR,flipped:!0,width:1,height:512},mSe)}destroy(){this._passParameters.texture=ft(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(e){const i=e.rctx,r=i.bindTechnique(this._technique,this._passParameters,e.bindParameters);est(Dae,e.bindParameters.camera.viewMatrix),r.setUniformMatrix4fv("view",Dae),i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(jt.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(e){const i=USe(1,2,!1),r=i.indices[0][1],s=i.vertexAttributes[0][1];for(let l=0;l<r.length;l+=3){const c=r[l];r[l]=r[l+2],r[l+2]=c}const n=s.data,o=Nae.createBuffer(r.length),a=o.position;for(let l=0;l<r.length;++l){const c=3*r[l];a.set(l,0,n[c]),a.set(l,1,n[c+1]),a.set(l,2,n[c+2])}return new af(e,Li,{geometry:au(Nae)},{geometry:Yi.createVertex(e,Fi.STATIC_DRAW,o.buffer)})}};function est(t,e){Xn(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}const Dae=We(),Nae=cs().vec3f(A.POSITION);var Jy;(function(t){t[t.Rain=0]="Rain",t[t.Snow=1]="Snow",t[t.COUNT=2]="COUNT"})(Jy||(Jy={}));let CW=class extends Va{constructor(){super(...arguments),this.type=Jy.Rain}};u([z({count:Jy.COUNT})],CW.prototype,"type",void 0);function tst(t){const e=new Ui;return e.attributes.add(A.POSITION,"vec3"),e.attributes.add(A.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new ni("cameraPosition",(i,r)=>r.camera.eye)),e.vertex.uniforms.add(new ni("offset",(i,r)=>ist(i,r))),e.vertex.uniforms.add(new He("width",i=>i.width)),e.vertex.uniforms.add(new Jr("proj",(i,r)=>r.camera.projectionMatrix)),e.vertex.uniforms.add(new Jr("view",(i,r)=>r.camera.viewMatrix)),e.vertex.uniforms.add(new He("time",i=>i.time)),e.varyings.add("vUv","vec2"),e.vertex.code.add(x`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===Jy.Rain?x`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:x`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),e.fragment.uniforms.add([new He("opacity",i=>i.opacity),new ni("particleColor",(i,r)=>rst(r,t))]),e.fragment.code.add(x`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${t.type===Jy.Rain?x`d = 0.35 * smoothstep(0.5, 0.0, d);`:x`d = smoothstep(0.5, 0.1, d);`}
      gl_FragColor = opacity * vec4(particleColor * d, d);
    }
  `),e}function ist(t,e){const i=e.camera.eye,r=.5*t.width,s=1/t.width,n=lge(AW,fe(AW,(i[0]+r)*s,(i[1]+r)*s,(i[2]+r)*s));return po(n,i,ue(n,n,t.width))}function rst(t,e){const i=e.type===Jy.Rain?nst:sst,r=ue(AW,i,ost),s=t.camera.eye;Oe(Fae,s);const n=Math.max(0,Ae(Fae,t.lighting.mainLight.direction));return tn(r,r,i,n)}const AW=M(),Fae=M(),sst=Xe(1,1,1),nst=Xe(.85,.85,.85),ost=.7,ast=Object.freeze(Object.defineProperty({__proto__:null,build:tst},Symbol.toStringTag,{value:"Module"}));let lst=class extends yr{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}},OW=class VSe extends ji{initializeProgram(e){return new ki(e.rctx,VSe.shader.get().build(this.configuration),vF)}initializePipeline(){return Qt({blending:Yn(Ve.ONE,Ve.ONE,Ve.ONE_MINUS_SRC_ALPHA,Ve.ONE_MINUS_SRC_ALPHA),depthTest:{func:Dr.LEQUAL},colorWrite:ui})}};OW.shader=new Vi(ast,()=>ee(()=>import("./Precipitation.glsl-fe75ba4c.js"),[],import.meta.url));const vF=new Map([[A.POSITION,0],[A.INSTANCEFEATUREATTRIBUTE,1]]);let kSe=class{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance({deltaTime:e,fixedTime:i}){return v(i)?this._time!==i&&(this._time=i,!0):(this._time=this._time+e,e!==0)}},cst=class{constructor(e,i){this.deltaTime=e,this.fixedTime=i}},sw=class extends $e{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new lst,this._animation=new kSe,this._updatingTracking=new Cm,this._passParameters.time=0,this._passParameters.radius=tr(e.view.spatialReference).radius,this._techniqueRepository=e.context.techniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechniqueCached=Wr(this._snowTechniqueCached),this._rainTechniqueCached=Wr(this._rainTechniqueCached),this._vao=ft(this._vao),this._instanceIdBuffer=ft(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(C(this._rainTechniqueCached)){const e=new CW;e.type=Jy.Rain,this._rainTechniqueCached=this._techniqueRepository.acquire(OW,e)}return this._rainTechniqueCached}get _snowTechnique(){if(C(this._snowTechniqueCached)){const e=new CW;e.type=Jy.Snow,this._snowTechniqueCached=this._techniqueRepository.acquire(OW,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,i,r){var l;const s=r==="rainy"?this._rainTechnique:this._snowTechnique;if(!s.compiled)return void this.context.requestRender();const n=e.rctx;if(this._ensureResources(n),C(s)||C(this._vao)||C(this._instanceIdBuffer)||(v(e.bindParameters.cloudsFade.data)&&(this._passParameters.opacity=1-e.bindParameters.cloudsFade.fadeInOutHeight.factor),this._passParameters.opacity<=0))return;const o=.35;i=i<.5?Yt(0,o,2*i):Yt(o,1,2*(i-.5)),this._passParameters.time=(r==="rainy"?this._rainSpeed:this._snowSpeed)*UY(this._animation.time)%1e5;const a=n.bindTechnique(s,this._passParameters,e.bindParameters);n.bindVAO(this._vao),a.assertCompatibleVertexAttributeLocations(this._vao),zK(n,vF,this._instanceIdBuffer,Uae,0),(l=n.capabilities.instancing)==null||l.drawArraysInstanced(jt.TRIANGLES,0,3,this._numParticles*i),GK(n,vF,this._instanceIdBuffer,Uae)}_ensureResources(e){C(this._vao)&&(this._vao=this._createVertexArrayObject(e)),C(this._instanceIdBuffer)&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const i=[];for(let r=0;r<this._numParticles;r++)i.push(r);return Yi.createVertex(e,Fi.STATIC_DRAW,new Float32Array(i))}_createVertexArrayObject(e){const i=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new af(e,vF,{geometry:au(ust)},{geometry:Yi.createVertex(e,Fi.STATIC_DRAW,i)})}};u([d({constructOnly:!0})],sw.prototype,"context",void 0),u([d({constructOnly:!0})],sw.prototype,"view",void 0),u([d({readOnly:!0})],sw.prototype,"updating",null),u([d()],sw.prototype,"_updatingTracking",void 0),sw=u([I("esri.views.3d.environment.Precipitation")],sw);const ust=cs().vec3f(A.POSITION),Uae=au(cs().f32(A.INSTANCEFEATUREATTRIBUTE),1),hst=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),tL=128,Vae=-Rq,kae=0,g9=50,dst=()=>1-511/512,pst=MN([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let fst=class{constructor(e,i){this.view=e,this.type=Vn.Simple,this._passParameters=new oQ,this._vaoCount=0,this._texV1=1,this._isMars=Zm(e.spatialReference);const r=tr(e.spatialReference);this._planetRadius=r.radius,this._outerRimWidth=r.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+Vae)/this._planetRadius,this._middleRimFactor=(this._planetRadius+kae)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=kae/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniqueRepository=i.techniqueRepository;const s=i.renderContext.rctx;this._cameraChangeHandle=re(()=>{var a;return(a=this.view.state)==null?void 0:a.camera},()=>i.requestRender(),Br),this._vao=this._createRibbon(s),this._vaoCount=oa(this._vao,"geometry"),this._fadeVao=ka(s),this._fadeVaoCount=oa(this._fadeVao,"geometry");const n=this._isMars?hst:mSe;this._passParameters.texture=new xt(s,{pixelFormat:it.RGBA,dataType:Ht.UNSIGNED_BYTE,wrapMode:kt.CLAMP_TO_EDGE,samplingMode:gt.LINEAR,flipped:!0,width:1,height:512},n);const o=new nQ;o.geometry=Wm.Cone,this._coneTechnique=this._techniqueRepository.acquire(S5,o),o.geometry=Wm.Underground,this._undergroundTechnique=this._techniqueRepository.acquire(S5,o)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=ft(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(e){const i=e.bindParameters.camera;this._update(i);const r=e.rctx;this._passParameters.undergroundFadeAlpha<1&&(r.bindTechnique(this._coneTechnique,this._passParameters,e.bindParameters),r.bindVAO(this._vao),r.drawArrays(jt.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(r.bindTechnique(this._undergroundTechnique,this._passParameters,e.bindParameters),r.bindVAO(this._fadeVao),r.drawArrays(jt.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(e){const i=M(),r=this._planetRadius,s=je(e.eye),n=s-r;if(n<0){const m=Math.min(-n/5e3,1);this._passParameters.undergroundFadeAlpha=m}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(g9,n),a=r+Vae;this._passParameters.innerScale=mst(r+o,r,a)-1,this._passParameters.altitudeFade=UK(n),ue(i,e.eye,(r+g9)/s),Bae(i,e.center,e.up,r,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,i,e.up,this._passParameters.silhouette),c=dst(),h=pst(n);let p=this._texV0+c*this._texVScale,f=this._texV0+l*h*this._texVScale;if(n>g9){Bae(e.eye,e.center,e.up,r,this._passParameters.silhouette);const m=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),y=we((m-1.5)/(l-1.5),0,1);p=this._texV0+y*c*this._texVScale,f=this._texV0+Yt(this._texV1,l*h,y)*this._texVScale}It(this._passParameters.texV,p,f)}_createRibbon(e){const i=Qs(3+3*tL*3),r=new Uint32Array(3*tL*5);i[0]=0,i[1]=0,i[2]=-1;for(let o=0;o<tL;o++){const a=9*o+3;i[a+0]=o,i[a+1]=this._innerRimFactor,i[a+2]=-1,i[a+3]=o,i[a+4]=this._middleRimFactor,i[a+5]=0,i[a+6]=o,i[a+7]=this._outerRimFactor,i[a+8]=1;const l=3*o+1,c=o===tL-1?1:l+3,h=15*o;r[h+0]=l,r[h+1]=l+1,r[h+2]=c+1,r[h+3]=c+1,r[h+4]=c,r[h+5]=l,r[h+6]=l+1,r[h+7]=l+2,r[h+8]=c+2,r[h+9]=c+2,r[h+10]=c+1,r[h+11]=l+1,r[h+12]=l,r[h+13]=c,r[h+14]=0}const s=zae.createBuffer(r.length),n=s.position;for(let o=0;o<r.length;++o){const a=3*r[o];n.set(o,0,i[a]),n.set(o,1,i[a+1]),n.set(o,2,i[a+2])}return new af(e,Li,{geometry:au(zae)},{geometry:Yi.createVertex(e,Fi.STATIC_DRAW,s.buffer)})}_computeScreenRimWidth(e,i,r,s){return ve(NT,s.center,s.v2),ue(iL,NT,this._outerRimFactor),yU(y9,i,NT,r),Mae(NT,y9,e.projectionMatrix,e.viewport,NT),Mae(iL,y9,e.projectionMatrix,e.viewport,iL),Ar(NT,iL)/e.height}};function Bae(t,e,i,r,s){const n=je(t),o=r*Math.sqrt(n*n-r*r)/n,a=Math.sqrt(r*r-o*o),l=s.v1,c=s.v2;return ue(s.center,t,a/n),Et(l,t,e),Ea(l)<1&&Et(l,t,i),ue(l,l,o/je(l)),Et(c,l,t),ue(c,c,o/je(c)),o}const y9=We(),NT=M(),iL=M();function mst(t,e,i){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-i*i)+e*i)}const zae=cs().vec3f(A.POSITION);let BSe=class zSe extends ji{initializeProgram(e){return new ki(e.rctx,zSe.shader.get().build(this.configuration),Li)}initializePipeline(){return Qt({blending:Yn(Ve.ONE,Ve.ZERO,Ve.ONE_MINUS_SRC_COLOR,Ve.ONE),colorWrite:ui})}};BSe.shader=new Vi(lSe,()=>ee(()=>import("./FogHaze.glsl-f829a94e.js"),[],import.meta.url));const gst=.7,yst=1;let JR=class extends $e{constructor(e){super(e),this._passParameters=new rQ;const i=e.context.renderContext.rctx;this._vao=ka(i,gA);const r=tr(e.view.spatialReference);this._planetRadius=r.radius,this._atmosphereRadius=r.radius+oP;const s=new sQ;s.haze=!0,this._hazeTechnique=e.context.techniqueRepository.acquire(BSe,s)}destroy(){this._hazeTechnique.release(),this._vao.dispose()}set strength(e){this._passParameters.hazeStrength=e}get strength(){return this._passParameters.hazeStrength}render(e,i){if(this.view.basemapTerrain.baseOpacity===0||(this._update(e,i),this._passParameters.hazeAmount<=0))return;const r=this._hazeTechnique;if(!r.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper;s.renderDepthDetached(()=>{this._passParameters.depthTexture=s.depthTexture;const n=e.rctx.bindTechnique(r,this._passParameters,e.bindParameters);this._renderSimpleHaze(n,e)})}_renderSimpleHaze(e,i){const r=i.rctx;r.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(jt.TRIANGLE_STRIP,0,4)}_update(e,i){const r=e.bindParameters.camera;Oe(Gae,r.eye);const s=Math.max(0,Ae(Gae,e.bindParameters.lighting.mainLight.direction)),n=vst;ue(jae,n,0),tn(this._passParameters.hazeColor,jae,n,s);const o=je(r.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.hazeAmount=(1-ZE(gst*zh,yst*zh,Math.abs(o-this._planetRadius)))*i.amount,this._passParameters.fogStrength=i.strength}static isSupported(e){return e.capabilities.depthTexture}};u([d({constructOnly:!0})],JR.prototype,"context",void 0),u([d({constructOnly:!0})],JR.prototype,"view",void 0),JR=u([I("esri.views.3d.environment.SimpleHaze")],JR);let _st=class{constructor(){this.strength=0,this.amount=0}};const vst=Xe(.24,.44,.8),Gae=M(),jae=M();function yQ(t){const e=x`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,i=x`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;t.vertex.code.add(e),t.vertex.code.add(i),t.fragment.code.add(e),t.fragment.code.add(i)}function bst(){const t=new Ui;return t.attributes.add(A.POSITION,"vec3"),t.attributes.add(A.COLOR,"vec4"),t.attributes.add(A.SIZE,"float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add([new Jr("transform",(e,i)=>wst(e,i)),new Si("viewport",(e,i)=>i.camera.fullViewport),new He("pixelRatio",(e,i)=>i.camera.pixelRatio)]),t.include(yQ),t.vertex.code.add(x`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),t.fragment.code.add(x`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`),t}function wst(t,e){return Xn(F0,e.camera.projectionMatrix),F0[10]=24e-8-1,F0[11]=-1,F0[14]=(24e-8-2)*e.camera.near,Ts(F0,F0,e.camera.viewMatrix),Ts(F0,F0,t.modelMatrix)}const F0=We(),xst=Object.freeze(Object.defineProperty({__proto__:null,build:bst},Symbol.toStringTag,{value:"Module"}));let Tst=class extends yr{constructor(){super(...arguments),this.modelMatrix=We()}},GSe=class jSe extends ji{constructor(e){super(e,new Va,()=>this.destroy())}initializeProgram(e){return new ki(e.rctx,jSe.shader.get().build(),Li)}initializePipeline(){return Qt({blending:Yn(Ve.SRC_ALPHA,Ve.ONE,Ve.ONE_MINUS_SRC_ALPHA,Ve.ONE_MINUS_SRC_ALPHA),depthTest:{func:Dr.LEQUAL},colorWrite:ui})}};GSe.shader=new Vi(xst,()=>ee(()=>import("./Stars.glsl-7aa058b7.js"),[],import.meta.url));let B_=class extends $e{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return v(this._loadDataTask)&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new Tst,this._updatingTracking=new Cm}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=hd(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=Wr(this._technique),this._vao=ft(this._vao)}render(e){const{rctx:i}=e;if(this._ensureResources(i),C(this._technique)||C(this._vao))return;if(!this._technique.compiled)return void this.requestRender();const r=i.bindTechnique(this._technique,this._renderParameter,e.bindParameters);i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(jt.POINTS,0,this._numPoints)}_ensureResources(e){if(v(this._technique)||C(FT))return;this._technique=new GSe({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=FT.byteLength/Hae;const i=new Float32Array(FT,0,2*this._numPoints),r=new Uint8Array(FT,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,i,r,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,s=>this._update(s),Zt)}_computeDayDuration(e){const i=e,r=new Date(e.getFullYear(),0,1,11,58,56);return(+i-+r)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+r)}_update(e){if(!e)return;const i=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,r=2*this._computeDayDuration(e),s=Xn(this._renderParameter.modelMatrix,Cst);cC(s,s,-r*Math.PI),Ts(s,Est,s),cC(s,s,-i*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,i,r,s){const n=qae.createBuffer(s),o=n.position,a=n.color,l=n.size;for(let c=0;c<s;c++){const h=i[2*c+0],p=i[2*c+1];o.set(c,0,-Math.cos(h)*Math.sin(p)),o.set(c,1,-Math.sin(h)*Math.sin(p)),o.set(c,2,-Math.cos(p));const f=this._unpackUint8Attributes(r[c]),m=this._hexToRGB(Sst[f[1]]);a.set(c,0,255*m[0]),a.set(c,1,255*m[1]),a.set(c,2,255*m[2]),a.set(c,3,255),l.set(c,f[0])}return new af(e,Li,{geometry:au(qae)},{geometry:Yi.createVertex(e,Fi.STATIC_DRAW,n.buffer)})}_createLoadDataTask(){if(v(FT))return null;const e=uI(async i=>{const{data:r}=await _8e("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:i});this._verifyStarData(r),FT=r});return e.promise.catch(i=>{ln(i)||oe.getLogger(this.declaredClass).error(i)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new W("stars:no-data-received","Failed to create stars because star catalogue is missing");const i=e.byteLength/Hae;if(i%1!=0||i>5e4||i<5e3)throw new W("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};u([d({constructOnly:!0})],B_.prototype,"view",void 0),u([d({constructOnly:!0})],B_.prototype,"requestRender",void 0),u([d({readOnly:!0})],B_.prototype,"updating",null),u([d()],B_.prototype,"_loadDataTask",void 0),u([d()],B_.prototype,"_updatingTracking",void 0),B_=u([I("esri.views.3d.environment.Stars")],B_);const Sst=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],Est=lJ(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),Cst=lJ(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),Hae=9,qae=cs().vec3f(A.POSITION).vec4u8(A.COLOR).f32(A.SIZE);let FT=null;function Ast(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function A5(t,e,i){i*=.5;const r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t}function _Q(t,e){const i=2*Math.acos(e[3]),r=Math.sin(i/2);return r>Fa()?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),i}function vQ(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=i[0],l=i[1],c=i[2],h=i[3];return t[0]=r*h+o*a+s*c-n*l,t[1]=s*h+o*l+n*a-r*c,t[2]=n*h+o*c+r*l-s*a,t[3]=o*h-r*a-s*l-n*c,t}function Ost(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+o*a,t[1]=s*l+n*a,t[2]=n*l-s*a,t[3]=o*l-r*a,t}function Rst(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l-n*a,t[1]=s*l+o*a,t[2]=n*l+r*a,t[3]=o*l-s*a,t}function Mst(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+s*a,t[1]=s*l-r*a,t[2]=n*l+o*a,t[3]=o*l-n*a,t}function Pst(t,e){const i=e[0],r=e[1],s=e[2];return t[0]=i,t[1]=r,t[2]=s,t[3]=Math.sqrt(Math.abs(1-i*i-r*r-s*s)),t}function bF(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=e[3];let l,c,h,p,f,m=i[0],y=i[1],_=i[2],b=i[3];return c=s*m+n*y+o*_+a*b,c<0&&(c=-c,m=-m,y=-y,_=-_,b=-b),1-c>Fa()?(l=Math.acos(c),h=Math.sin(l),p=Math.sin((1-r)*l)/h,f=Math.sin(r*l)/h):(p=1-r,f=r),t[0]=p*s+f*m,t[1]=p*n+f*y,t[2]=p*o+f*_,t[3]=p*a+f*b,t}function Ist(t){const e=WP,i=e(),r=e(),s=e(),n=Math.sqrt(1-i),o=Math.sqrt(i);return t[0]=n*Math.sin(2*Math.PI*r),t[1]=n*Math.cos(2*Math.PI*r),t[2]=o*Math.sin(2*Math.PI*s),t[3]=o*Math.cos(2*Math.PI*s),t}function $st(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=i*i+r*r+s*s+n*n,a=o?1/o:0;return t[0]=-i*a,t[1]=-r*a,t[2]=-s*a,t[3]=n*a,t}function qx(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function HSe(t,e){const i=e[0]+e[4]+e[8];let r;if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);const n=(s+1)%3,o=(s+2)%3;r=Math.sqrt(e[3*s+s]-e[3*n+n]-e[3*o+o]+1),t[s]=.5*r,r=.5/r,t[3]=(e[3*n+o]-e[3*o+n])*r,t[n]=(e[3*n+s]+e[3*s+n])*r,t[o]=(e[3*o+s]+e[3*s+o])*r}return t}function Lst(t,e,i,r){const s=.5*Math.PI/180;e*=s,i*=s,r*=s;const n=Math.sin(e),o=Math.cos(e),a=Math.sin(i),l=Math.cos(i),c=Math.sin(r),h=Math.cos(r);return t[0]=n*l*h-o*a*c,t[1]=o*a*h+n*l*c,t[2]=o*l*c-n*a*h,t[3]=o*l*h+n*a*c,t}function Dst(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const bQ=Op,Nst=nr,Fst=XY,Ust=vQ,Vst=XC,kst=yge,Bst=z6,qSe=YY,zst=qSe,WSe=ZY,Gst=WSe,wQ=gge,jst=mE,Hst=JY;function qst(t,e,i){const r=Ae(e,i);return r<-.999999?(Et(yf,Wst,e),Nc(yf)<1e-6&&Et(yf,Xst,e),Oe(yf,yf),A5(t,yf,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Et(yf,e,i),t[0]=yf[0],t[1]=yf[1],t[2]=yf[2],t[3]=1+r,wQ(t,t))}const yf=M(),Wst=Xe(1,0,0),Xst=Xe(0,1,0);function Yst(t,e,i,r,s,n){return bF(Wae,e,s,n),bF(Xae,i,r,n),bF(t,Wae,Xae,2*n*(1-n)),t}const Wae=Cd(),Xae=Cd();function Zst(t,e,i,r){const s=Jst;return s[0]=i[0],s[3]=i[1],s[6]=i[2],s[1]=r[0],s[4]=r[1],s[7]=r[2],s[2]=-e[0],s[5]=-e[1],s[8]=-e[2],wQ(t,HSe(t,s))}const Jst=ls();Object.freeze(Object.defineProperty({__proto__:null,add:Fst,calculateW:Pst,conjugate:qx,copy:bQ,dot:kst,equals:Hst,exactEquals:jst,fromEuler:Lst,fromMat3:HSe,getAxisAngle:_Q,identity:Ast,invert:$st,len:zst,length:qSe,lerp:Bst,mul:Ust,multiply:vQ,normalize:wQ,random:Ist,rotateX:Ost,rotateY:Rst,rotateZ:Mst,rotationTo:qst,scale:Vst,set:Nst,setAxes:Zst,setAxisAngle:A5,slerp:bF,sqlerp:Yst,sqrLen:Gst,squaredLength:WSe,str:Dst},Symbol.toStringTag,{value:"Module"}));function CI(t=Qst){return[t[0],t[1],t[2],t[3]]}function gNt(t,e,i=CI()){return he(i,t),i[3]=e,i}function Yae(t,e,i=CI()){return Et(i,t,e),Oe(i,i),i[3]=-hge(t,e),i}function yNt(t,e,i=CI()){return A5(rL,t,Zae(t)),A5(Jae,e,Zae(e)),vQ(rL,Jae,rL),Kst(i,yl(_Q(i,rL)))}function _Nt(t){return t}function Zae(t){return ii(t[3])}function Kst(t,e){return t[3]=e,t}const Qst=[0,0,1,0],rL=Cd(),Jae=Cd();CI();function ent(t,e,i){const r=t.parallax.anchorPointClouds;t.fadeIn.stage===kc.FINISHED&&(t.fadeIn.factor=0,he(r,mm),t.fadeIn.stage=kc.CHANGE_ANCHOR,t.crossFade.enabled=!1,t.fadeInOut.stage=kn.FINISHED),t.fadeIn.stage===kc.CHANGE_ANCHOR&&t.isCameraPositionFinal&&(YK(t.data)&&t.renderingStage!==Us.RENDERING||t.renderingStage===Us.FADING_TEXTURE_CHANNELS)&&(he(r,mm),t.fadeIn.stage=kc.FADE_IN,t.startTime=e,t.renderingStage===Us.FADING_TEXTURE_CHANNELS&&(t.renderingStage=Us.SWITCH_CHANNELS)),t.fadeIn.factor<1&&t.fadeIn.stage===kc.FADE_IN?t.fadeIn.factor=i?we((e-t.startTime)/(XSe*i),0,1):1:t.fadeIn.factor>=1&&t.fadeIn.stage===kc.FADE_IN&&(t.fadeIn.stage=kc.FINISHED,t.fadeIn.factor=1)}function tnt(t,e,i){const{fadeInOut:r,crossFade:s}=t;r.stage===kn.FINISHED&&(t.startTime=e,r.factor=1,r.stage=kn.FADE_OUT),r.factor>0&&r.stage===kn.FADE_OUT?r.factor=i?1-we((e-t.startTime)/(ont*i),0,1):0:(r.factor<=0&&r.stage===kn.FADE_OUT&&(r.factor=0,he(t.parallax.anchorPointClouds,mm)),r.factor<=0&&r.stage===kn.FADE_OUT&&t.isCameraPositionFinal&&(r.factor=0,r.stage=kn.SWITCH,t.crossFade.enabled=!1,s.factor=1),r.stage===kn.SWITCH&&(YK(t.data)&&t.renderingStage!==Us.RENDERING||t.renderingStage===Us.FADING_TEXTURE_CHANNELS)&&(t.startTime=e,r.factor=0,r.stage=kn.FADE_IN,he(t.parallax.anchorPointClouds,mm),t.crossFade.enabled=!1,s.factor=1,t.renderingStage===Us.FADING_TEXTURE_CHANNELS&&(t.renderingStage=Us.SWITCH_CHANNELS)),r.factor<1&&r.stage===kn.FADE_IN?r.factor=i?we((e-t.startTime)/(XSe*i),0,1):1:r.factor>=1&&r.stage===kn.FADE_IN&&(r.stage=kn.FINISHED,r.factor=1))}function int(t,e,i,r){const{crossFade:s}=t,n=t.parallax.anchorPointClouds;t.crossFade.enabled&&!r||(he(t.parallaxNew.anchorPointClouds,mm),t.startTime=e,s.factor=0,t.crossFade.enabled=!0),s.factor<1&&t.crossFade.enabled?s.factor=i?we((e-t.startTime)/(ant*i),0,1):1:s.factor>=1&&t.crossFade.enabled&&(t.crossFade.enabled=!1,s.factor=1,he(n,t.parallaxNew.anchorPointClouds),t.renderingStage===Us.FADING_TEXTURE_CHANNELS&&(t.renderingStage=Us.SWITCH_CHANNELS))}function Kae(t,e,i,r){const s=t.fadeInOutHeight,n=s.stage===i1.FINISHED?i:t.startTimeHeightFade;if(r!==0){const o=(i-n)/(lnt*r);s.factor+=e?-o:o}else s.factor=e?0:1;t.startTimeHeightFade=i,s.factor=we(s.factor,0,1),s.stage=i1.HEIGHT_FADE}function rnt(t,e,i,r,s){t.renderingStage===Us.FINISHED_RENDERING&&(t.renderingStage=Us.FADING_TEXTURE_CHANNELS);const n=je(e.eye);t.fadeInOutHeight.factor<0&&(t.fadeInOutHeight.factor=n-Oi.radius>zh?1:0),t.isCameraPositionFinal=Wv(t.cameraPositionLastFrame,e.eye),Oe(mm,e.eye),ue(mm,mm,Oi.radius);const o=t.parallax;o.anchorPointClouds[0]===0&&o.anchorPointClouds[1]===0&&o.anchorPointClouds[2]===0&&he(o.anchorPointClouds,mm);const a=je(be(nnt,o.anchorPointClouds,mm));let l=!0;a>t.fadeIn.distanceThresholdFactor*o.cloudsHeight||t.fadeIn.stage!==kc.FINISHED?ent(t,r,s):a>t.fadeInOut.distanceThresholdFactor*o.cloudsHeight||t.fadeInOut.stage!==kn.FINISHED?tnt(t,r,s):a>t.crossFade.distanceThresholdFactor*o.cloudsHeight||t.crossFade.enabled||t.renderingStage===Us.FADING_TEXTURE_CHANNELS?int(t,r,s,(i!==Mi.IDLE||!YK(t.data))&&t.renderingStage!==Us.FADING_TEXTURE_CHANNELS):l=!1;const c=n-Oi.radius;if((c>1.7*zh||c<-zh)&&t.fadeInOutHeight.factor<1?t.fadeInOutHeight.factor=1:(c>zh||c<-.35*zh)&&t.fadeInOutHeight.factor<1?Kae(t,!1,r,s):c<zh&&c>-.35*zh&&t.fadeInOutHeight.factor>0?Kae(t,!0,r,s):t.fadeInOutHeight.stage=i1.FINISHED,t.renderingStage===Us.SWITCH_CHANNELS&&(t.readChannels=1-t.readChannels,t.renderingStage=Us.FINISHED),o.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(n*n-Oi.radius*Oi.radius,0))/n,Yae(Qae,o.anchorPointClouds,UT),Wc(o.transform,th,UT[3],UT),l){const{parallaxNew:h}=t;Yae(Qae,h.anchorPointClouds,UT),Wc(h.transform,th,UT[3],UT)}he(t.cameraPositionLastFrame,e.eye)}function snt(t){return t.crossFade.enabled||t.fadeInOut.stage!==kn.FINISHED||t.fadeIn.stage!==kc.FINISHED||t.fadeInOutHeight.stage!==i1.FINISHED||t.renderingStage!==Us.FINISHED}const Qae=Xe(0,0,1),UT=CI(),mm=M(),nnt=M(),XSe=1,ont=.5,ant=1.3,lnt=1;let _A=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(e,i){var r;return(r=this._outer.get(e))==null?void 0:r.get(i)}set(e,i,r){const s=this._outer.get(e);s?s.set(i,r):this._outer.set(e,new Map([[i,r]]))}delete(e,i){const r=this._outer.get(e);r&&(r.delete(i),r.size===0&&this._outer.delete(e))}forEach(e){this._outer.forEach((i,r)=>e(i,r))}};var Xs;function ele(t=de("enable-feature:high-quality-idle")){const e=new _A;return t&&(e.set(Mi.INTERACTING,Xs.Antialiasing,!0),e.set(Mi.IDLE,Xs.Antialiasing,!0),e.set(Mi.INTERACTING,Xs.HighQualityTransparency,!0),e.set(Mi.IDLE,Xs.HighQualityTransparency,!0),e.set(Mi.INTERACTING,Xs.RealisticAtmosphere,!0),e.set(Mi.IDLE,Xs.RealisticAtmosphere,!0),e.set(Mi.IDLE,Xs.SSAO,!0),e.set(Mi.IDLE,Xs.WaterReflection,!0),e.set(Mi.IDLE,Xs.PhysicalPixelRendering,!0)),e.set(Mi.ANIMATING,Xs.ShadowMapUpdate,!0),e.set(Mi.INTERACTING,Xs.ShadowMapUpdate,!0),e.set(Mi.IDLE,Xs.ShadowMapUpdate,!0),e.set(Mi.IDLE,Xs.HighQualityVoxel,!0),e}(function(t){t[t.Antialiasing=0]="Antialiasing",t[t.HighQualityTransparency=1]="HighQualityTransparency",t[t.HighQualityVoxel=2]="HighQualityVoxel",t[t.RealisticAtmosphere=3]="RealisticAtmosphere",t[t.SSAO=4]="SSAO",t[t.WaterReflection=5]="WaterReflection",t[t.ShadowMapUpdate=6]="ShadowMapUpdate",t[t.PhysicalPixelRendering=7]="PhysicalPixelRendering"})(Xs||(Xs={}));var LE;(function(t){t[t.Immediate=0]="Immediate",t[t.Faded=1]="Faded"})(LE||(LE={}));var KR;const cnt=[Fe.POSTPROCESSING_ENVIRONMENT_OPAQUE,Fe.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let to=KR=class extends $e{constructor(t){super(t),this._context=null,this._atmosphere=null,this._hqAtmosphere=null,this._oldWeatherParameters=new _9,this._newWeatherParameters=new _9,this._fadedWeatherParameters=new _9,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(cnt,this)}destroy(){var t;this.removeHandles(),((t=this.view)==null?void 0:t._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return v(this._hqAtmosphere)&&this.view._stage.renderer.isFeatureEnabled(Xs.RealisticAtmosphere)?this._hqAtmosphere:this._atmosphere}get _atmosphereType(){return v(this.atmosphere)?this.atmosphere.type:Vn.None}get canRender(){var t;return!!((t=this.view.basemapTerrain)!=null&&t.renderer.canRender)||this.view.viewingMode!=="global"}get needsLinearDepth(){return this._atmosphereType===Vn.Realistic}updateAnimation(t){return!!v(this._precipitation)&&this._precipitation.update(t)}get updating(){return v(this._stars)&&this._stars.updating||v(this._clouds)&&this._clouds.running}get weatherVisible(){return je(this.view.state.camera.eye)-tr(this.view.spatialReference).radius<=zh}get _stars(){var r;const t=this.view,e=((r=t.environment)==null?void 0:r.starsEnabled)??!1,i=this._get("_stars");return!e||C(this._context)?(Je(i),null):v(i)?i:new B_({view:t,requestRender:()=>this._setNeedsRender()})}get _precipitation(){const t=this._get("_precipitation");if(!this._precipitationEnabled||C(this._context))return Je(t),null;const e=this.view,i=this._context;return v(t)&&t.context===i?t:(Je(t),new sw({context:i,view:e}))}get _clouds(){const t=this._get("_clouds");if(!this.weatherEnabled||C(this._context))return Je(t),null;if(v(t))return t;const e=this.view,i=this._context;return Je(t),new Bl({context:i,view:e,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const t=this._get("_cloudsComposition");if(!this.weatherEnabled||C(this._context))return Je(t),null;const e=this.view.state.viewingMode,i=this._context.renderContext.rctx,r=tr(this.view.spatialReference).radius;return v(t)&&t.viewingMode===e&&t.planetRadius===r?t:(Je(t),new iw({rctx:i,viewingMode:e,planetRadius:r,requestRender:()=>this._setNeedsRender()}))}get _fog(){const t=this._get("_fog");if(!this.weatherEnabled||C(this._context))return Je(t),null;if(v(t))return t;const e=this.view,i=this._context;return new ZR({context:i,view:e})}get _simpleHaze(){const t=this._get("_simpleHaze");if(!this.weatherEnabled||C(this._context))return Je(t),null;if(v(t))return t;const e=this.view,i=this._context;return new JR({context:i,view:e})}get weatherEnabled(){var t,e;return!!((e=(t=this.view)==null?void 0:t.environmentManager)!=null&&e.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(t=null){this._context=t;const e=()=>this._setNeedsRender();this.addHandles([qo(()=>{var i;return(i=this.view)==null?void 0:i.basemapTerrain},()=>this._updateBasemapTerrain(),Br),re(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled,quality:this.view.environment.atmosphere.quality}),i=>this._updateAtmosphere(i),Br),re(()=>this._stars,e),re(()=>this._precipitation,e),re(()=>this._clouds,()=>this._updateWeather(),Zt),re(()=>this._fog,()=>this._updateFogHaze(),Zt),re(()=>this._simpleHaze,()=>this._updateFogHaze(),Zt),re(()=>this.view.state.mode,()=>{this._setNeedsRender()},Wi),re(()=>this._atmosphereType,()=>this._updateBasemapTerrain(),Br),re(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},Br)])}uninitializeRenderContext(){this._context=null,this._atmosphere=Je(this._atmosphere),this._hqAtmosphere=Je(this._hqAtmosphere),this._set("_stars",Je(this._stars)),this._set("_precipitation",Je(this._precipitation)),this._set("_clouds",Je(this._clouds)),this._set("_cloudsComposition",Je(this._cloudsComposition)),this._set("_fog",Je(this._fog)),this._set("_simpleHaze",Je(this._simpleHaze))}prepareRender(t){t.bindParameters.cloudsFade.data=tit(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&(rnt(t.bindParameters.cloudsFade,t.bindParameters.camera,this.view.state.mode,t.time,this.view.qualitySettings.fadeDuration),this._updateWeatherFading(t.bindParameters),t.bindParameters.cloudsFade.renderingStage===Us.FINISHED&&v(this._clouds)&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),t.bindParameters.cloudsFade.data=null))}render(t){if(t.output===k.Color)switch(t.bindParameters.slot){case Fe.POSTPROCESSING_ENVIRONMENT_OPAQUE:v(this._stars)&&this._stars.render(t),v(this.atmosphere)&&(this.atmosphere.render(t),v(this._cloudsComposition)&&v(t.bindParameters.cloudsFade.data)&&(this.weatherVisible&&v(this._clouds)&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(t)),snt(t.bindParameters.cloudsFade)&&v(this._context)&&this._context.requestRender());break;case Fe.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(v(this.atmosphere)&&(this.atmosphere.renderHaze(t,this._weatherParameters.haze.amount),this._weatherParameters.haze.amount>0&&this._atmosphereType!==Vn.Realistic&&v(this._simpleHaze)&&this._simpleHaze.render(t,this._weatherParameters.haze),this._weatherParameters.fog.amount>0&&v(this._fog)&&this._fog.render(t,this._weatherParameters.fog),v(this._precipitation))){const e=this.view.environment.weather;e.type!=="rainy"&&e.type!=="snowy"||this._precipitation.render(t,e.precipitation,e.type)}}}updateLightSources(t,e,i,r){if(v(this._context)){const s=this._context.renderContext;s.bindParameters.oldLighting.copyFrom(s.bindParameters.lighting),s.bindParameters.newLighting.noonFactor=e,s.bindParameters.newLighting.globalFactor=i,s.bindParameters.newLighting.set(t),r===LE.Faded||s.bindParameters.weatherFading?s.bindParameters.fadeLighting(0):s.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const t=this.weatherEnabled?this.view.environment.weather:null;return C(t)?null:t.type==="rainy"||t.type==="snowy"?{type:t.type,weatherAdjustment:t.cloudCover,effect:t.precipitation}:{type:t.type,weatherAdjustment:t.type==="foggy"?t.fogStrength:t.cloudCover}}_updateWeatherFading(t){if(!t.weatherFading)return;const e=t.cloudsFade;return e.fadeIn.stage===kc.FADE_IN?(t.fadeLighting(e.fadeIn.factor),void this._fadeWeather(e.fadeIn.factor)):e.fadeInOut.stage===kn.FADE_IN?(t.fadeLighting(e.fadeInOut.factor),void this._fadeWeather(e.fadeInOut.factor)):e.crossFade.enabled?(t.fadeLighting(e.crossFade.factor),void this._fadeWeather(e.crossFade.factor)):(t.fadeLighting(0),void this._fadeWeather(0))}_fadeWeather(t){const{_newWeatherParameters:e,_oldWeatherParameters:i}=this;t>=1?this._weatherParameters=e:(this._fadedWeatherParameters.lerp(i,e,t),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const t=this._weatherUpdateParameters;C(t)||C(this._clouds)||(this._clouds.applyPreset(ba[t.type],t.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){v(this._context)&&this._context.requestRender()}_updateFogHaze(){const t=this._weatherUpdateParameters;if(C(this._fog)||C(this._simpleHaze)||C(t)||C(this._context))return;const e=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),t.type){case"foggy":this._newWeatherParameters.fog.strength=Yt(3e-5,.005,t.weatherAdjustment**3),he(this._newWeatherParameters.fog.color,tle),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=this._atmosphereType===Vn.Realistic?1:0,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=Yt(4e-6,2e-4,(t.effect??0)**3),he(this._newWeatherParameters.fog.color,unt),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=Yt(4e-6,2e-4,(t.effect??0)**3),he(this._newWeatherParameters.fog.color,tle),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=this._atmosphereType===Vn.Realistic?1:0,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.haze.strength=4e-6,this._newWeatherParameters.haze.amount=1,this._setNeedsRender()}e.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(t){const e=this._selectAtmosphereType(t);if(v(this._atmosphere)?this._atmosphere.type===e:e===Vn.None)return;this._atmosphere=Je(this._atmosphere),this._hqAtmosphere=Je(this._hqAtmosphere);const i=this._getAtmosphereClass(e);i&&v(this._context)&&(this._atmosphere=new i(this.view,this._context),e===Vn.Simple&&(this._hqAtmosphere=new s9(this.view,this._context))),this._setNeedsRender(),this._updateBasemapTerrain()}_getAtmosphereClass(t){switch(t){case Vn.Realistic:return s9;case Vn.Panoramic:return Qrt;case Vn.Simple:return fst;default:case Vn.None:return null}}_selectAtmosphereType(t){const{enabled:e,quality:i,viewingMode:r}=t;return!e||Jm(this.view.spatialReference)?Vn.None:r===st.Local?Vn.Panoramic:v(this._context)&&i==="high"&&s9.isSupported(this._context)&&P3(this.view.spatialReference)?Vn.Realistic:Vn.Simple}_updateBasemapTerrain(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=this._atmosphereType===Vn.Simple)}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled,quality:this.view.environment.atmosphere.quality}),stubGetAtmosphereClass:t=>{ile=KR.prototype._getAtmosphereClass,KR.prototype._getAtmosphereClass=t},restoreGetAtmosphereClass:()=>{KR.prototype._getAtmosphereClass=ile}}}};u([d({constructOnly:!0})],to.prototype,"view",void 0),u([d({readOnly:!0})],to.prototype,"atmosphere",null),u([d({readOnly:!0})],to.prototype,"_atmosphereType",null),u([d({type:Boolean,readOnly:!0})],to.prototype,"updating",null),u([d({readOnly:!0})],to.prototype,"weatherVisible",null),u([d()],to.prototype,"_context",void 0),u([d()],to.prototype,"_atmosphere",void 0),u([d()],to.prototype,"_hqAtmosphere",void 0),u([d({readOnly:!0})],to.prototype,"_stars",null),u([d({readOnly:!0})],to.prototype,"_precipitation",null),u([d({readOnly:!0})],to.prototype,"_clouds",null),u([d({readOnly:!0})],to.prototype,"_cloudsComposition",null),u([d({readOnly:!0})],to.prototype,"_fog",null),u([d({readOnly:!0})],to.prototype,"_simpleHaze",null),u([d({readOnly:!0})],to.prototype,"weatherEnabled",null),u([d({readOnly:!0})],to.prototype,"_precipitationEnabled",null),u([d({readOnly:!0})],to.prototype,"_weatherUpdateParameters",null),to=KR=u([I("esri.views.3d.environment.EnvironmentRenderer")],to);let _9=class{constructor(){this.fog=new prt,this.haze=new _st}copyFrom(e){this.fog.amount=e.fog.amount,this.haze.amount=e.haze.amount,this.fog.strength=e.fog.strength,this.haze.strength=e.haze.strength,he(this.fog.color,e.fog.color)}lerp(e,i,r){this.fog.amount=Yt(e.fog.amount,i.fog.amount,r),this.haze.amount=Yt(e.haze.amount,i.haze.amount,r),this.fog.strength=Yt(e.fog.strength,i.fog.strength,r),this.haze.strength=Yt(e.haze.strength,i.haze.strength,r),tn(this.fog.color,e.fog.color,i.fog.color,r)}};const unt=Xe(.5,.5,.5),tle=Xe(1.5,1.5,1.5);let ile;function rle(t,e,i){if(C(e.longitude)||C(e.latitude)||C(i.longitude)||C(i.latitude))throw new Error("Invalid points: no lon/lat");return hnt(t,e.longitude,e.latitude,i.longitude,i.latitude)}function hnt(t,e,i,r,s){const n=ii(i),o=ii(s),a=n-o,l=ii(e)-ii(r),c=Math.sin(a/2),h=Math.sin(l/2),p=2*pd(Math.sqrt(c*c+Math.cos(n)*Math.cos(o)*h*h))*t;return Math.round(1e4*p)/1e4}function dnt(t,e,i){const r=e.spatialReference,s=tr(r),n=new pt(e.x,t.y,r),o=new pt(i.x,t.y,r),a=new pt(t.x,e.y,r),l=new pt(t.x,i.y,r);return{lon:rle(s.radius,n,o),lat:rle(s.radius,a,l)}}function pnt(t,e,i){const r=e/i,s=ii(t),n=Math.sin(r/2),o=Math.cos(s),a=2*pd(Math.sqrt(n*n/(o*o)));return yl(a)}function fnt(t,e){let i=t/15;return e||(i=Math.round(i)),i}function sle(t,e){const i=t==null?void 0:t[0];if(i==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=fnt(i,!0);const r=e.hours%1;e.hours-=r,e.minutes=60*r;const s=e.minutes%1;return e.minutes-=s,e.seconds=Math.round(60*s),e}var nle,ole,ale,RW={},mnt={get exports(){return RW},set exports(t){RW=t}};nle=mnt,ole=function(){var t=Math.PI,e=Math.sin,i=Math.cos,r=Math.tan,s=Math.asin,n=Math.atan2,o=Math.acos,a=t/180,l=864e5,c=2440588,h=2451545,p={dec:0,ra:0};function f($){return $.valueOf()/l-.5+c}function m($){return new Date(($+.5-c)*l)}function y($){return f($)-h}var _=23.4397*a;function b($,N){return n(e($)*i(_)-r(N)*e(_),i($))}function w($,N){return s(e(N)*i(_)+i(N)*e(_)*e($))}function S($,N,U){return n(e($),i($)*e(N)-r(U)*i(N))}function T($,N,U){return s(e(N)*e(U)+i(N)*i(U)*i($))}function E($,N){return a*(280.16+360.9856235*$)-N}function O($){return a*(357.5291+.98560028*$)}function R($){return a*(1.9148*e($)+.02*e(2*$)+3e-4*e(3*$))}function L($,N){return $+N+102.9372*a+t}function P($,N){var U=O($),q=L(U,R(U));return N||(N={dec:0,ra:0}),N.dec=w(q,0),N.ra=b(q,0),N}var F={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function($,N,U,q){var Y=a*-U,Q=a*N,X=y($),pe=P(X,p),ye=E(X,Y)-pe.ra;return q||(q={azimuth:0,altitude:0}),q.azimuth=S(ye,Q,pe.dec),q.altitude=T(ye,Q,pe.dec),q}},V=[[-.83,"sunrise","sunset"]];F.addTime=function($,N,U){V.push([$,N,U])};var B=9e-4;function G($,N){return Math.round($-B-N/(2*t))}function te($,N,U){return B+($+N)/(2*t)+U}function se($,N,U){return h+$+.0053*e(N)-.0069*e(2*U)}function ie($,N,U){return o((e($)-e(N)*e(U))/(i(N)*i(U)))}function H($){var N=a*(134.963+13.064993*$),U=a*(93.272+13.22935*$),q=a*(218.316+13.176396*$)+6.289*a*e(N),Y=5.128*a*e(U),Q=385001-20905*i(N);return{ra:b(q,Y),dec:w(q,Y),dist:Q}}return F.getTimes=function($,N,U){var q=a*-U,Y=a*N,Q=G(y($),q),X=te(0,q,Q),pe=O(X),ye=R(pe),xe=L(pe,ye),De=w(xe,0),rt=se(X,pe,xe);function qe(Ce){return se(te(ie(Ce,Y,De),q,Q),pe,xe)}function Pe(Ce){var Le=(e(Ce)-e(Y)*e(De))/(i(Y)*i(De));return Le<-1?F.PolarException.MIDNIGHT_SUN:Le>1?F.PolarException.POLAR_NIGHT:F.PolarException.NORMAL}var Ye,j,J,ne,ge,_e={solarNoon:m(rt),nadir:m(rt-.5),polarException:F.PolarException.NORMAL};for(Ye=0,j=V.length;Ye<j;Ye+=1)ge=rt-((ne=qe((J=V[Ye])[0]*a))-rt),_e[J[1]]=m(ge),_e[J[2]]=m(ne);return _e.polarException=Pe(V[0][0]*a),_e},F.getMoonPosition=function($,N,U){var q=a*-U,Y=a*N,Q=y($),X=H(Q),pe=E(Q,q)-X.ra,ye=T(pe,Y,X.dec);return ye+=.017*a/r(ye+10.26*a/(ye+5.1*a)),{azimuth:S(pe,Y,X.dec),altitude:ye,distance:X.dist}},F.getMoonFraction=function($){var N=y($),U=P(N),q=H(N),Y=149598e3,Q=o(e(U.dec)*e(q.dec)+i(U.dec)*i(q.dec)*i(U.ra-q.ra)),X=n(Y*e(Q),q.dist-Y*i(Q));return(1+i(X))/2},F},(ale=ole())!==void 0&&(nle.exports=ale);const Wx=RW,lm={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function gnt(t,e,i,r,s,n){fe(n.ambient.color,1,1,1),n.ambient.intensity=lm.global.ambient,fe(n.direct.color,1,1,1),n.direct.intensity=lm.global.direct;const o=e[2],a=we((Math.abs(o)-lm.local.altitude)/(lm.global.altitude-lm.local.altitude),0,1);let l;if(n.globalFactor=a,v(t)&&(l=Wx.getTimes(t,e[1],e[0])),a<1){let c;if(v(t))c=Tnt(t,l,r);else{const h=JSe(r);c={direct:{intensity:lm.local.directAtNoon*h.direct,color:Xe(1,1,1)},ambient:{intensity:lm.local.ambientAtNoon*h.ambient,color:Xe(1,1,1)},timeOfDay:"early afternoon"}}tn(n.ambient.color,c.ambient.color,n.ambient.color,a),n.ambient.intensity=Yt(c.ambient.intensity,n.ambient.intensity,a),tn(n.direct.color,c.direct.color,n.direct.color,a),n.direct.intensity=Yt(c.direct.intensity,n.direct.intensity,a),n.specularStrength=r==="rainy"||r==="snowy"||r==="foggy"?0:1,n.environmentStrength=r==="rainy"?.7:r==="snowy"||r==="foggy"?.75:1}n.noonFactor=v(t)?xnt(t,l):1,v(t)?ynt(t,e,i,n.direct.directionToLightSource):YSe(s,i,n.direct.directionToLightSource)}function YSe(t,e,i){e===st.Global?Oe(v9,t.eye):fe(v9,0,0,1),ue(b9,t.viewForward,-1);const r=RN(b9,v9),s=Math.max(r-2*w9,0),n=.85*s/(s+1),o=Math.max(w9,r-w9-n);eh(cle,-o,t.viewRight),ut(i,b9,cle),ve(i,i,ue(Snt,t.viewRight,Ent)),Oe(i,i)}function ynt(t,e,i,r){const s=wnt,n=_d(bnt);if(i===st.Global)Wx.getPosition(t,0,0,s),fe(r,0,0,-1),lC(n,n,-s.azimuth),mU(n,n,-s.altitude),ut(r,r,n);else{const o=lm.planarDirection,a=o.globalAngles,l=e[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=we(c,0,1),c<1?(Wx.getPosition(t,e[1],e[0],s),s.azimuth=(1-c)*s.azimuth+c*a.azimuth,s.altitude=(1-c)*s.altitude+c*a.altitude):(s.azimuth=a.azimuth,s.altitude=a.altitude),fe(r,0,-1,0),cC(n,n,-s.azimuth),lC(n,n,-s.altitude),ut(r,r,n)}}function _nt(t,e){if(e===st.Global)return!0;const i=lm.planarDirection;return Math.abs(t)<i.localAltitude}const vnt=Xe(.5773502691896258,-.5773502691896258,.5773502691896258);let ZSe=class{constructor(){this.ambient={color:Xe(1,1,1),intensity:.55},this.direct={color:Xe(1,1,1),intensity:.55,directionToLightSource:xs(vnt)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const bnt=We(),wnt={azimuth:0,altitude:0};function xnt(t,e){const i=t.valueOf();let r,s;e.polarException===Wx.PolarException.MIDNIGHT_SUN?(r=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=r+432e6):e.polarException===Wx.PolarException.POLAR_NIGHT?(r=i-2,s=i-1):(r=e.sunrise.valueOf(),s=e.sunset.valueOf());const n=r+(s-r)/2;return 1-we(Math.abs(i-n)/432e5,0,1)}function JSe(t){switch(t){case"disabled":case"sunny":case"cloudy":return{direct:1,ambient:1};case"rainy":return{direct:.4,ambient:1.2};case"snowy":return{direct:.5,ambient:1.3};case"foggy":return{direct:.2,ambient:1.6}}}function lle(t,e){const i=(t[0]+t[1]+t[2])/3;for(let r=0;r<3;r++)t[r]=t[r]+(i-t[r])*e;return t}function Tnt(t,e,i){const r=t.valueOf();let s,n;e.polarException===Wx.PolarException.MIDNIGHT_SUN?(s=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=s+432e6):e.polarException===Wx.PolarException.POLAR_NIGHT?(s=r-2,n=r-1):(s=e.sunrise.valueOf(),n=e.sunset.valueOf());const o=n-s,a=s+o/2,l=o/4,c=a-l,h=a+l,p=.06*o,f=s-p/2,m=s+p/2,y=n-p/2,_=n+p/2,b=lm.local,w=[.01,b.ambientAtNight],S=[.8,.8,1],T=[.01,.01,.01],E=[b.directAtTwilight,b.ambientAtTwilight],O=[1,.6,.5],R=[.8,.8,1],L=[.9*b.directAtNoon,b.ambientAtNoon],P=[1,.98,.98],F=[.98,.98,1],V=[b.directAtNoon,b.ambientAtNoon],B=[1,1,1],G=[1,1,1],te=L,se=P,ie=F,H=E,$=O,N=R;let U,q,Y=[0,0],Q=[0,0,0],X=[0,0,0];r<f||r>_?(Y=w,Q=T,X=S,q="night"):r<m?(U=m-f,Y=Zo(r-f,U,w,E),Q=Zo(r-f,U,T,O),X=Zo(r-f,U,S,R),q="sun rising"):r<c?(U=c-m,Y=Zo(r-m,U,E,L),Q=Zo(r-m,U,O,P),X=Zo(r-m,U,R,F),q="early morning"):r<a?(U=a-c,Y=Zo(r-c,U,L,V),Q=Zo(r-c,U,P,B),X=Zo(r-c,U,F,G),q="late morning"):r<h?(U=h-a,Y=Zo(r-a,U,V,te),Q=Zo(r-a,U,B,se),X=Zo(r-a,U,G,ie),q="early afternoon"):r<y?(U=y-h,Y=Zo(r-h,U,te,H),Q=Zo(r-h,U,se,$),X=Zo(r-h,U,ie,N),q="late afternoon"):r<_&&(U=_-y,Y=Zo(r-y,U,H,w),Q=Zo(r-y,U,$,T),X=Zo(r-y,U,N,S),q="sun setting");let pe=0;switch(i){case"rainy":case"foggy":case"snowy":pe=.5}pe>0&&(Q=lle(Q,pe),X=lle(X,pe));const ye=Xe(Q[0],Q[1],Q[2]),xe=Xe(X[0],X[1],X[2]),De=JSe(i);return{direct:{intensity:Y[0]*De.direct,color:ye},ambient:{intensity:Y[1]*De.ambient,color:xe},timeOfDay:q}}function Zo(t,e,i,r){const s=[];for(let n=0;n<i.length;n++)s[n]=(r[n]-i[n])*t/e+i[n];return s}const cle=We(),v9=M(),b9=M(),Snt=M(),w9=.25,Ent=.2;let sp=class extends As.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new Ki,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new x5,this._ambientLight=new iQ,this._moonLight=new rSe,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)!=null&&e.updating))}get weatherEnabled(){var e,i,r;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((r=(i=this._view)==null?void 0:i.state)==null?void 0:r.viewingMode)===st.Global&&P3(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new to({view:e});const i=()=>this._updateRenderParameters(),r=()=>this._cameraHandler();this._viewHandles.add([re(()=>e.environment.lighting,s=>this._updateLightingHandler(s),Wi),re(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,s=>this._lightingDateHandler(s),Wi),re(()=>e.stationary,()=>this._interactingStationaryHandler()),re(()=>e.environment.lighting.directShadowsEnabled,i,Wi),re(()=>e.environment.lighting.ambientOcclusionEnabled,i,Wi),re(()=>e.environment.lighting.waterReflectionEnabled,i,Wi),re(()=>{var s;return(s=e.environment.background)==null?void 0:s.color},i,Wi),re(()=>e.spatialReference,()=>this._resetReferencePosition(!0),Wi),re(()=>e.environment.weather.type,()=>this._updateLighting(null,LE.Faded),Wi),re(()=>this.weatherEnabled,()=>this._updateLighting(null,LE.Faded),Wi),re(()=>e.viewingMode,()=>this._resetReferencePosition(!0),Br),re(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,s=>this._updateCameraTracking(s),Br),re(()=>e.state.camera,r,Br),re(()=>this.disableQueries,r)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=Je(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const i=this._view.environment.lighting;(i==null?void 0:i.type)!=="virtual"&&(i.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const i=this._view.environment.lighting;if((i==null?void 0:i.type)!=="virtual"){if(e){if(!i.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const r=this._view.spatialReference;if(!$x(r)){const s=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(s))return void this._requestReferencePositionUpdate(s)}if(this._preupdateTracking(e),v(this._referencePosWGS84Comparable)){const s=sle(this._referencePosWGS84Comparable,ule);v(s)&&(i.autoUpdate(null,s),this._trackingEnabled&&(i.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const i=this._view;if(!i.ready)return;const r=i.stateManager.camera;r&&(this._cameraHandlerClientSide(r,e)||this._cameraHandlerServerSide(r))}_cameraHandlerClientSide(e,i){const r=P3(this._view.spatialReference);if(r&&!$x(this._view.spatialReference))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const s=e.position;return C(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=M()),r?EVe(s,this._referencePosWGS84Comparable):fe(this._referencePosWGS84Comparable,s.longitude??0,s.latitude??0,s.z??0),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,i)||this._updateLighting(i),!0}_cameraHandlerServerSide(e){const i=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(i))&&this._requestReferencePositionUpdate(i,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=(i.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,i=LE.Immediate){const r=this._view;e=e||(r.environment.lighting.type==="virtual"?null:r.environment.lighting.date);const s=this._referencePosWGS84Comparable,n=v(s)?Cnt:Ant,o=this.weatherVisible?r.environment.weather.type:"disabled";v(s)?gnt(e,s,r.state.viewingMode,o,r.state.camera,n):r.environment.lighting.type==="virtual"&&YSe(r.state.camera,r.state.viewingMode,n.direct.directionToLightSource);const a=this._mainLight,l=n.direct;ue(a.intensity,l.color,l.intensity*Math.PI),he(a.direction,l.directionToLightSource),a.specularStrength=n.specularStrength,a.environmentStrength=n.environmentStrength;const c=this._ambientLight;ue(c.intensity,n.ambient.color,n.ambient.intensity);const h=this._moonLight;tn(h.intensity,Rnt,Mnt,n.globalFactor);const p=(1-.5*n.globalFactor)*(1-.4*n.noonFactor*(1-n.globalFactor));ue(h.intensity,h.intensity,p),he(h.direction,l.directionToLightSource),this._renderer.updateLightSources([a,c,h],n.noonFactor,n.globalFactor,i),this._updateRenderParameters()}_autoUpdateTimezone(e,i=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||C(e))return!1;const r=Ont;r.setTime((i||this._view.environment.lighting.date).getTime());const s=sle(e,ule);if(C(s))return!1;let n=this._view.environment.lighting.positionTimezoneInfo;if(n.autoUpdated){if(n.hours===s.hours&&n.minutes===s.minutes&&n.seconds===s.seconds)return!1}else n=s;const o=r.getUTCHours()-(s.hours-n.hours),a=r.getUTCMinutes()-(s.minutes-n.minutes),l=r.getUTCSeconds()-(s.seconds-n.seconds);return r.setUTCHours(o),r.setUTCMinutes(a),r.setUTCSeconds(l),!i&&this._view.environment.lighting.autoUpdate(r,s)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const i=Vu(this._referencePosWGS84Comparable,!0,n=>_nt(n[2],this._view.state.viewingMode)),r=this._view.environment.background,s=r instanceof t2e?{type:"color",color:cJ(ot.toUnitRGBA(r.color))}:{type:"color",color:si(0,0,0,1)};e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&i,background:s,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,i=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!i,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const r=this._referencePosUpdateQuery=_x(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===r){const n=()=>this._referencePosUpdateQuery!==r;return this._doReferencePositionUpdateQuery(n)}}).catch(n=>{n.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===r&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),s=this._referencePosUpdateTimer=_x(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===s&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const i=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(i[0])&&!isNaN(i[1])){const r=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=i[0],this._referencePosWGS84Comparable[1]=i[1],this._referencePosWGS84Comparable[2]=r):this._referencePosWGS84Comparable=[i[0],i[1],r],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let i=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(i*=this._view.mapCoordsHelper.unitInMeters),i>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(i){e._referencePointUpdateInterval=i},set referencePointUpdateDistThreshold(i){e._referencePointUpdateDistThreshold=i},set referencePosUpdateTimer(i){e._referencePosUpdateTimer=i},set referencePointUpdateDelay(i){e._referencePointUpdateDelay=i},set disableWeather(i){e._disableWeather=i}}}};u([d({type:Boolean,readOnly:!0})],sp.prototype,"updating",null),u([d()],sp.prototype,"disableQueries",void 0),u([d()],sp.prototype,"_disableWeather",void 0),u([d()],sp.prototype,"weatherEnabled",null),u([d()],sp.prototype,"weatherVisible",null),u([d()],sp.prototype,"referencePositionWGS84Comparable",null),u([d()],sp.prototype,"_renderer",void 0),u([d()],sp.prototype,"_referencePosWGS84Comparable",void 0),sp=u([I("esri.views.3d.environment.SceneViewEnvironmentManager")],sp);const Cnt=new ZSe,Ant=new ZSe,Ont=new Date,ule={hours:0,minutes:0,seconds:0},Rnt=Xe(.22,.22,.33),Mnt=Xe(.22,.22,.22);var kr;(function(t){t[t.NONE=0]="NONE",t[t.TILT=1]="TILT",t[t.ALTITUDE=2]="ALTITUDE",t[t.DISTANCE=4]="DISTANCE",t[t.COLLISION=8]="COLLISION",t[t.ALL=15]="ALL",t[t.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(kr||(kr={}));var mi;(function(t){t[t.NONE=0]="NONE",t[t.ZOOM=1]="ZOOM",t[t.TUMBLE=2]="TUMBLE",t[t.LOOK_AROUND=3]="LOOK_AROUND",t[t.PAN=4]="PAN",t[t.ASCEND=5]="ASCEND"})(mi||(mi={}));var vo;(function(t){t[t.TUMBLE=0]="TUMBLE",t[t.LOOK_AROUND=1]="LOOK_AROUND"})(vo||(vo={}));function dP(t,e){return(t&e)!=0}function O5(t,e,i,r,s,n){t!==0&&(i?(n.min=Math.min(n.min,e),n.max=Math.max(n.max,e)):r!=null?(n.min-=Math.max(0,(e-n.min)*(1-r)),n.max+=Math.max(0,(e-n.max)*(1-r))):s&&(n.min-=Math.max(0,e-n.min-s),n.max+=Math.max(0,e-n.max-s)))}const o1={selection:kr.NONE,interactionType:mi.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:vo.TUMBLE};function KSe(t,e,i,r){return e=e||t.viewForward,he(r,e),ue(r,r,Math.sign(Ae(e,i))),r}function Pnt(t,e,i,r){return Nnt(t,e,i,Lnt(r,e,i,!0))}function Int(t,e,i,r){const s=Ae(i,be(t,r,e));return ve(t,e,ue(t,i,s))}const $nt={dir:M(),len:0,clip:et()};function Lnt(t,e,i,r){const s=$nt;return t?(i&&r&&(s.len=Ar(e,i)),he(s.dir,t)):r?(s.len=Ar(e,i),be(s.dir,i,e),ue(s.dir,s.dir,1/s.len)):(be(s.dir,i,e),Oe(s.dir,s.dir)),s}function Dnt(t,e,i){const r=Ae(t,i.dir),s=-Er(t,e);if(s<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return s>0;if((s<0||r<0)&&!(s<0&&r<0))return!0;const n=s/r;return r>0?n<i.clip[1]&&(i.clip[1]=n):n>i.clip[0]&&(i.clip[0]=n),i.clip[0]<=i.clip[1]}function Nnt(t,e,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let s=0;s<t.length;s++)if(!Dnt(t[s],e,r))return!1;return!0}function Fnt(t,e,i=o1){const r=xQ(t,e,i);if(r===0)return!1;const s=t.renderCoordsHelper,n=s.getAltitude(e.eye)+r,o=KSe(e,i.interactionDirection,knt(t,e,Math.sign(r),jnt),Gnt),a=he(Hnt,e.viewForward),l=s.intersectInfiniteManifold(ih(e.eye,o),n,x9);return e.eye=v(l)?l:s.setAltitude(x9,n,e.eye),e.center=Int(x9,e.eye,a,e.center),!0}function xQ(t,e,i=o1){if(!Unt(t,i)||!t.state.constraints.altitude)return 0;const r=Bnt(t.state.constraints.altitude,znt);Vnt(t,i,r);const s=t.renderCoordsHelper.getAltitude(e.eye),n=we(s,r.min,r.max)-s;return Math.abs(n)<=1e-6?0:n}function Unt(t,e){const i=t.state.constraints.altitude;return!(!t.state.isGlobal||!i)&&(e.interactionType!==mi.TUMBLE||!dP(e.selection,kr.TILT))}function Vnt(t,e,i){const r=e.interactionType;if(r===mi.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=r===mi.TUMBLE||r===mi.ZOOM,c=xQ(t,o),h=c===0?0:t.renderCoordsHelper.getAltitude(o.eye);i.min=s,i.max=n,O5(c,h,l,a,.05*h,i)}function knt(t,e,i,r){return t.renderCoordsHelper.worldUpAtPosition(e.eye,r),ue(r,r,i),r}function Bnt(t,e){return e.min=t.min,e.max=t.max,e}const znt={min:0,max:0},Gnt=M(),jnt=M(),Hnt=M(),x9=M();function TQ(t,e,i=o1){if(!t.state.isLocal)return 0;const r=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;sL.min=0,sL.max=r,Wnt(t,i,sL);const s=SQ(t,e),n=sL.max-s;return n>=-1e-6?0:n}function qnt(t,e,i=o1){const r=TQ(t,e,i);if(r===0)return!1;const s=t.pointsOfInterest.surfaceOrigin;if(!s.renderLocation)return!1;const n=SQ(t,e)+r,o=he(Ynt,e.eye),a=KSe(e,i.interactionDirection,Xnt(e,s.renderLocation,Knt),Jnt);if(!v1(dve(s.renderLocation,n),ih(e.eye,a),nL))return!1;e.eye=nL;const l=be(Znt,e.eye,o);e.center=ve(nL,e.center,l);const c=t.renderCoordsHelper.getAltitude(e.center),h=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,nL);return v(h)&&(e.center=h),!0}function Wnt(t,e,i){const r=e.interactionType;if(r===mi.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=r===mi.ZOOM||r===mi.PAN,c=TQ(t,o),h=c===0?0:SQ(t,o);i.min=s,i.max=n,O5(c,h,l,a,.05*h,i)}function SQ(t,e){const i=t.pointsOfInterest.surfaceOrigin;return i.renderLocation?Ar(e.eye,i.renderLocation):0}function Xnt(t,e,i){return i0(i,t.eye,e)}const sL={min:0,max:0},Ynt=M(),Znt=M(),Jnt=M(),Knt=M(),nL=M();var as,Ho;(function(t){t[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL"})(as||(as={}));let Qnt=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=Ho.ALL}};(function(t){t[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL"})(Ho||(Ho={}));let eot=class{constructor(e,i,r){this.object=e,this.geometryId=i,this.triangleNr=r}},tot=class extends eot{constructor(e,i,r,s){super(e,i,r),this.center=v(s)?xs(s):null}},QSe=class{constructor(e){this.layerUid=e}},p8=class extends QSe{constructor(e,i){super(e),this.graphicUid=i}};function lf(t){return v(t)&&v(t.dist)}function hle(t){return(e,i,r)=>(tn(dle,e,i,r),!_J(t,dle))}function f8(t){return lf(t)&&t.intersector===as.OBJECT&&!!t.target}function m8(t){return lf(t)&&t.intersector===as.HUD&&!!t.target&&"center"in t.target&&v(t.target.center)}const dle=M();let iot=class{constructor(){this._transform=We(),this._transformInverse=new oL({value:this._transform},Go,We),this._transformInverseTranspose=new oL(this._transformInverse,tu,We),this._transformTranspose=new oL({value:this._transform},tu,We),this._transformInverseRotation=new oL({value:this._transform},B2e,ls)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){Xn(this._transform,e)}multiplyTransform(e){Ts(this._transform,this._transform,e)}set(e){Xn(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,i){this.setTransformMatrix(e),this.multiplyTransform(i),this._invalidateLazyTransforms()}},oL=class{constructor(e,i,r){this._original=e,this._update=i,this._dirty=!0,this._transform=r()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},rot=class{constructor(e=0){this.offset=e,this.tmpVertex=M()}applyToVertex(e,i,r){const s=e+this.localOrigin[0],n=i+this.localOrigin[1],o=r+this.localOrigin[2],a=this.offset/Math.sqrt(s*s+n*n+o*o);return this.tmpVertex[0]=e+s*a,this.tmpVertex[1]=i+n*a,this.tmpVertex[2]=r+o*a,this.tmpVertex}applyToAabb(e){for(let n=0;n<3;++n)U0[n]=e[0+n]+this.localOrigin[n],aL[n]=e[3+n]+this.localOrigin[n],VT[n]=U0[n];const i=this.applyToVertex(U0[0],U0[1],U0[2]);for(let n=0;n<3;++n)e[n]=i[n],e[n+3]=i[n];const r=n=>{const o=this.applyToVertex(n[0],n[1],n[2]);for(let a=0;a<3;++a)e[a+0]=Math.min(e[a+0],o[a]),e[a+3]=Math.max(e[a+3],o[a])};for(let n=1;n<8;++n){for(let o=0;o<3;++o)VT[o]=n&1<<o?aL[o]:U0[o];r(VT)}let s=0;for(let n=0;n<3;++n)U0[n]*aL[n]<0&&(s|=1<<n);if(s!==0&&s!==7){for(let n=0;n<8;++n)if(!(s&n)){for(let o=0;o<3;++o)s[o]?VT[o]=0:VT[o]=n&1<<o?U0[o]:aL[o];r(VT)}}for(let n=0;n<3;++n)e[n+0]-=this.localOrigin[n],e[n+3]-=this.localOrigin[n];return e}};const U0=M(),aL=M(),VT=M();let sot=class{constructor(e=0){this.componentLocalOriginLength=0,this._tmpVertex=M(),this._mbs=gn(),this._obb={center:M(),halfSize:qr(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}applyToVertex(e,i,r){const s=e,n=i,o=r+this.componentLocalOriginLength,a=this._totalOffset/Math.sqrt(s*s+n*n+o*o);return this._tmpVertex[0]=e+s*a,this._tmpVertex[1]=i+n*a,this._tmpVertex[2]=r+o*a,this._tmpVertex}applyToAabb(e){const i=e[0],r=e[1],s=e[2]+this.componentLocalOriginLength,n=e[3],o=e[4],a=e[5]+this.componentLocalOriginLength,l=i*n<0?0:Math.min(Math.abs(i),Math.abs(n)),c=r*o<0?0:Math.min(Math.abs(r),Math.abs(o)),h=s*a<0?0:Math.min(Math.abs(s),Math.abs(a)),p=Math.sqrt(l*l+c*c+h*h);if(p<this._totalOffset)return e[0]-=i<0?this._totalOffset:0,e[1]-=r<0?this._totalOffset:0,e[2]-=s<0?this._totalOffset:0,e[3]+=n>0?this._totalOffset:0,e[4]+=o>0?this._totalOffset:0,e[5]+=a>0?this._totalOffset:0,e;const f=Math.max(Math.abs(i),Math.abs(n)),m=Math.max(Math.abs(r),Math.abs(o)),y=Math.max(Math.abs(s),Math.abs(a)),_=Math.sqrt(f*f+m*m+y*y),b=this._totalOffset/_,w=this._totalOffset/p;return e[0]+=i*(i>0?b:w),e[1]+=r*(r>0?b:w),e[2]+=s*(s>0?b:w),e[3]+=n*(n<0?b:w),e[4]+=o*(o<0?b:w),e[5]+=a*(a<0?b:w),e}applyToMbs(e){const i=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),r=this._totalOffset/i;return this._mbs[0]=e[0]+e[0]*r,this._mbs[1]=e[1]+e[1]*r,this._mbs[2]=e[2]+e[2]*r,this._mbs[3]=e[3]+e[3]*this._totalOffset/i,this._mbs}applyToObb(e){const i=e.center,r=this._totalOffset/Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);this._obb.center[0]=i[0]+i[0]*r,this._obb.center[1]=i[1]+i[1]*r,this._obb.center[2]=i[2]+i[2]*r,kp(this._obb.halfSize,e.halfSize,e.quaternion),ve(this._obb.halfSize,this._obb.halfSize,e.center);const s=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*s,this._obb.halfSize[1]+=this._obb.halfSize[1]*s,this._obb.halfSize[2]+=this._obb.halfSize[2]*s,be(this._obb.halfSize,this._obb.halfSize,e.center),qx(gle,e.quaternion),kp(this._obb.halfSize,this._obb.halfSize,gle),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=e.quaternion,this._obb}},not=class{constructor(e=0){this.offset=e,this.sphere=gn(),this.tmpVertex=M()}applyToVertex(e,i,r){const s=this.objectTransform.transform;let n=s[0]*e+s[4]*i+s[8]*r+s[12],o=s[1]*e+s[5]*i+s[9]*r+s[13],a=s[2]*e+s[6]*i+s[10]*r+s[14];const l=this.offset/Math.sqrt(n*n+o*o+a*a);n+=n*l,o+=o*l,a+=a*l;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*n+c[4]*o+c[8]*a+c[12],this.tmpVertex[1]=c[1]*n+c[5]*o+c[9]*a+c[13],this.tmpVertex[2]=c[2]*n+c[6]*o+c[10]*a+c[14],this.tmpVertex}applyToMinMax(e,i){const r=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*r,e[1]+=e[1]*r,e[2]+=e[2]*r;const s=this.offset/Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);i[0]+=i[0]*s,i[1]+=i[1]*s,i[2]+=i[2]*s}applyToAabb(e){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const r=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*r,e[4]+=e[4]*r,e[5]+=e[5]*r,e}applyToBoundingSphere(e){const i=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),r=this.offset/i;return this.sphere[0]=e[0]+e[0]*r,this.sphere[1]=e[1]+e[1]*r,this.sphere[2]=e[2]+e[2]*r,this.sphere[3]=e[3]+e[3]*this.offset/i,this.sphere}};const ple=new not;function MW(t){return v(t)?(ple.offset=t,ple):null}const fle=new sot;function oot(t){return v(t)?(fle.offset=t,fle):null}const mle=new rot;function aot(t){return v(t)?(mle.offset=t,mle):null}const av="terrain",gle=Cd(),IC=1e-5;let lot=class{constructor(e){this.options=new Qnt,this._results=new cot,this.transform=new iot,this.tolerance=IC,this.verticalOffset=null,this._ray=fo(),this._rayEnd=M(),this._rayBeginTransformed=M(),this._rayEndTransformed=M(),this.viewingMode=e??st.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,i,r){this.resetWithRay(KVe(e,i,this._ray),r)}resetWithRay(e,i){this.camera=i,e!==this._ray&&U4(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===st.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,ve(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,i,r,s,n){this.point=i,this.filterPredicate=s,this.tolerance=r??IC;const o=MW(this.verticalOffset);if(v(e)&&e.length>0){const a=n?l=>{n(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of e){const c=l.getSpatialQueryAccelerator&&l.getSpatialQueryAccelerator();v(c)?(v(o)?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(h=>a(h))}}this.sortResults()}intersectObject(e){const i=e.geometries;if(!i)return;const r=e.transformation,s=MW(this.verticalOffset);for(const n of i){if(!n.visible)continue;const{material:o,id:a}=n;this.transform.setAndInvalidateLazyTransforms(r,n.shaderTransformation),ut(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),ut(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;v(s)&&(s.objectTransform=this.transform),o.intersect(n,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,h,p,f,m,y)=>{if(c>=0){if(v(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const _=f?this._results.hud:this._results,b=f?w=>{const S=new tot(e,a,p,y);w.set(as.HUD,S,c,h,th,m)}:w=>w.set(as.OBJECT,{object:e,geometryId:a,triangleNr:p},c,h,l,m);if((_.min.drapedLayerOrder==null||m>=_.min.drapedLayerOrder)&&(_.min.dist==null||c<_.min.dist)&&b(_.min),this.options.store!==Ho.MIN&&(_.max.drapedLayerOrder==null||m<_.max.drapedLayerOrder)&&(_.max.dist==null||c>_.max.dist)&&b(_.max),this.options.store===Ho.ALL)if(f){const w=new PW(this._ray);b(w),this._results.hud.all.push(w)}else{const w=new DE(this._ray);b(w),this._results.all.push(w)}}})}}sortResults(e=this._results.all){e.sort((i,r)=>i.dist!==r.dist?Gt(i.dist,0)-Gt(r.dist,0):i.drapedLayerOrder!==r.drapedLayerOrder?Gt(i.drapedLayerOrder,Number.MAX_VALUE)-Gt(r.drapedLayerOrder,Number.MAX_VALUE):Gt(r.drapedLayerGraphicOrder,Number.MIN_VALUE)-Gt(i.drapedLayerGraphicOrder,Number.MIN_VALUE))}};function xd(t){return new lot(t)}let cot=class{constructor(){this.min=new DE(fo()),this.max=new DE(fo()),this.hud={min:new PW(fo()),max:new PW(fo()),all:new Array},this.ground=new DE(fo()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},DE=class{get ray(){return this._ray}get distanceInRenderSpace(){return v(this.dist)?(ue(lL,this.ray.direction,this.dist),je(lL)):null}getIntersectionPoint(e){return!!lf(this)&&(ue(lL,this.ray.direction,this.dist),ve(e,this.ray.origin,lL),!0)}getTransformedNormal(e){return he(tO,this.normal),tO[3]=0,qu(tO,tO,this.transformation),he(e,tO),Oe(e,e)}constructor(e){this.intersector=as.OBJECT,this.normal=M(),this.transformation=We(),this._ray=fo(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=as.OBJECT,U4(e,this._ray)}set(e,i,r,s,n,o,a){this.intersector=e,this.dist=r,he(this.normal,Gt(s,age)),Xn(this.transformation,Gt(n,th)),this.target=i,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(e){U4(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,he(this.normal,e.normal),Xn(this.transformation,e.transformation)}},PW=class extends DE{constructor(){super(...arguments),this.intersector=as.HUD}};function EQ(t){return new DE(t)}const lL=M(),tO=fi();function eEe(t,e,i,r){return v(t.renderCoordsHelper.fromRenderCoords(e.eye,R5,r))&&Zye(i,R5)}function g8(t,e){return t.elevationProvider?Gt(t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground"),0):0}function gT(t,e,i,r){const s=t.state.camera.clone();e&&i&&r&&(s.eye=e,s.center=i,s.up=r),uot(t,s.ray,V0)||he(V0,s.center);const n=t.state.constraints,o=n.minimumPoiDistance;if(Bo(s.eye,V0)<o){const a=n.collision.enabled;he(k1,s.viewForward),ue(k1,k1,o),a?s.eye=be(R5,V0,k1):ve(V0,s.eye,k1);const l=t.renderCoordsHelper,c=l.getAltitude(s.eye),h=n.collision.elevationMargin;a&&c<h&&(be(k1,V0,s.eye),s.eye=l.setAltitude(R5,h,s.eye),ve(V0,s.eye,k1))}return s.center=V0,s}function yle(t,e,i){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const r=g8(t,e),s=t.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(e,i,t.renderDataExtent,r,dot),o=n*n;return Bo(e,i)>o}function uot(t,e,i){let r=_le[t.viewingMode];r||(r=xd(t.state.viewingMode),r.options.backfacesTerrain=!t.state.isGlobal,r.options.invisibleTerrain=!0,_le[t.viewingMode]=r);const{isGlobal:s}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,r,i)||yle(t,e.origin,i))||!(!t.renderCoordsHelper.intersectManifold(e,0,i)||yle(t,e.origin,i))||!!s&&hot(e,i,tr(t.spatialReference).radius)}function hot(t,e,i){const r=Ae(t.origin,t.origin)-i*i,s=r>0?Math.sqrt(r)/3:1;return ue(e,t.direction,s/je(t.direction)),ve(e,e,t.origin),!0}const _le={},R5=M(),V0=M(),k1=M(),dot={near:0,far:0};function vA(t,e,i=rd.EYE){const r=t.state.constraints;if(!r.collision.enabled)return!1;const s=g8(t,e.eye),n=t.renderCoordsHelper.getAltitude(e.eye),o=s+r.collision.elevationMargin;if(n>=o)return!1;const a=je(e.eye);if(be(cL,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude(pot,o,e.eye),i===rd.EYE_AND_CENTER)e.center=ve(cL,e.eye,cL);else if(i===rd.EYE_AND_CENTER_SCALE){const l=(a-n+o)/a;e.center=ue(cL,e.center,l)}return!0}var rd;(function(t){t[t.EYE=0]="EYE",t[t.EYE_AND_CENTER=1]="EYE_AND_CENTER",t[t.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(rd||(rd={}));const cL=M(),pot=M();function a1(t,e,i){t.worldUpAtPosition(e,vle),be(T9,i,e);const r=je(T9);return r===0?0:Dn(Ae(T9,vle)/r)}const vle=M(),T9=M();function tEe(t,e,i=o1,r=!0){iO.eyeCenterDistance=0,iO.requiresTwoSteps=!1;const s=CQ(t,e,i,void 0,iO);if(s===0)return!1;switch(eh(uL,-s,e.viewRight),i.tiltMode){case vo.LOOK_AROUND:ut(k0,e.viewForward,uL),ue(k0,k0,iO.eyeCenterDistance),e.center=ve(lv,e.eye,k0);break;case vo.TUMBLE:be(k0,e.center,e.eye),ut(k0,k0,uL),e.eye=be(lv,e.center,k0);break;default:i.tiltMode}return e.up=ut(lv,e.up,uL),!iO.requiresTwoSteps||!r||tEe(t,e,i,!1)}function CQ(t,e,i=o1,r=o1,s){if(!t.state.constraints.tilt)return 0;const n=e.distance,o=t.state.constraints.tilt(n,Tot);return xot(t,i,o),r.interactionType===mi.TUMBLE&&dP(r.selection,kr.ALTITUDE)&&iEe(t,r.interactionStartCamera,o),i.tiltMode===vo.LOOK_AROUND||r.tiltMode===vo.LOOK_AROUND?mot(t,e,o,s):fot(t,e,o)}function fot(t,e,i){const r=a1(t.renderCoordsHelper,e.center,e.eye),s=r-we(r,i.min,i.max);return pP(s)?s:0}function mot(t,e,i,r){switch(r&&(r.requiresTwoSteps=!1),t.viewingMode){case"global":return yot(t,e,i,r);case"local":return got(t,e,i,r)}}function got(t,e,i,r){const s=a1(t.renderCoordsHelper,e.center,e.eye),n=we(s,i.min,i.max),o=s-n;if(!pP(o))return 0;if(r){const a=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=t.renderCoordsHelper.getAltitude(e.eye)-a,c=Math.cos(n);Math.abs(c)>1e-4?r.eyeCenterDistance=l/c:r.eyeCenterDistance=e.distance}return o}function yot(t,e,i,r){const s=_ot(t,e,Sot),n=we(s.tiltAtCenter,i.min,i.max);if(!pP(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=vot(s),a=bot(s,o)):(o=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),r&&o<Math.PI/2&&(r.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=wot(s,o)),r&&(r.eyeCenterDistance=IW(s,o)),a}function _ot(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=r+tr(t.spatialReference).radius,n=t.renderCoordsHelper.intersectManifold(e.ray,r,lv);return i.eyeCenterDistance=e.distance,i.centerIsOnSurface=!1,v(n)?(i.eyeCenterDistance=Ar(e.eye,n),i.tiltAtCenter=a1(t.renderCoordsHelper,n,e.eye),i.centerIsOnSurface=!0):t.state.isLocal?i.tiltAtCenter=a1(t.renderCoordsHelper,e.center,e.eye):(nA(wU(xU,s),e.ray,lv),i.eyeCenterDistance=Ar(e.eye,lv),i.tiltAtCenter=Dn(-Ae(e.viewForward,Oe(lv,lv)))),i.radius=s,i.eyeRadius=je(e.eye),i.constraints=t.state.constraints,i}function pP(t){return Math.abs(t)>1e-9}function vot(t){const{constraints:e,eyeCenterDistance:i,tiltAtCenter:r}=t;let s=r,n=e.clampTilt(i,r);const o=IW(t,n);if(e.clampTilt(o,r)===n)return n;let a=0;for(;a<10&&pP(n-s);){const l=(s+n)/2,c=IW(t,l);pP(e.clampTilt(c,l)-l)?s=l:n=l,a++}return n}function IW(t,e){if(!t.centerIsOnSurface)return t.eyeCenterDistance;const i=Math.PI-we(e,0,Math.PI),r=pd(t.radius/t.eyeRadius*Math.sin(i)),s=Math.PI-i-r,n=Math.sin(s)/Math.sin(i);if(t.eyeRadius<t.radius&&n>1){const o=Math.PI-r,a=Math.PI-i-o;return Math.sin(a)/Math.sin(i)*t.eyeRadius}return n*t.eyeRadius}function bot(t,e){const i=pd(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),r=pd(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?i-r:r-i}function wot(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function xot(t,e,i){if(e.interactionType===mi.NONE)return;const{interactionStartCamera:r,interactionFactor:s}=e;if(!r)return;const{min:n,max:o}=i,a=CQ(t,r,o1,e),l=a===0?0:a1(t.renderCoordsHelper,r.center,r.eye);i.min=n,i.max=o,e.interactionType===mi.TUMBLE?(dP(e.selection,kr.ALTITUDE)&&iEe(t,r,i),O5(a,l,!0,s,ble,i)):O5(a,l,!1,s,ble,i)}function iEe(t,e,i){const r=t.state.constraints;if(t.state.isLocal||!r.altitude||!e)return;const s=Ea(e.center),n=Math.sqrt(s),o=e.distance,a=tr(t.spatialReference).radius,l=r.altitude.min+a,c=r.altitude.max+a,h=(l*l-o*o-s)/(-2*n*o),p=(c*c-o*o-s)/(-2*n*o);i.min=Math.max(i.min,Math.min(Math.PI-Dn(p),i.max)),i.max=Math.min(i.max,Math.PI-Dn(h))}const k0=M(),uL=We(),lv=M(),ble=ii(5),Tot={min:0,max:0},Sot={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},iO={eyeCenterDistance:0,requiresTwoSteps:!1};function Eot(t){return t}const y8=t=>t*t,AQ=t=>1-y8(1-t),Cot=t=>t<.5?y8(2*t)/2:(AQ(2*(t-.5))+1)/2,OQ=t=>t*t*t,rEe=t=>1-OQ(1-t),sEe=t=>t<.5?OQ(2*t)/2:(rEe(2*(t-.5))+1)/2,RQ=t=>t*t*t*t,nEe=t=>1-RQ(1-t),Aot=t=>t<.5?RQ(2*t)/2:(nEe(2*(t-.5))+1)/2,MQ=t=>t*t*t*t*t,oEe=t=>1-MQ(1-t),Oot=t=>t<.5?MQ(2*t)/2:(oEe(2*(t-.5))+1)/2,PQ=t=>1-Math.cos(t*Math.PI/2),aEe=t=>1-PQ(1-t),Rot=t=>t<.5?PQ(2*t)/2:(aEe(2*(t-.5))+1)/2,IQ=t=>2**(10*(t-1)),AI=t=>1-IQ(1-t),Mot=t=>t<.5?IQ(2*t)/2:(AI(2*(t-.5))+1)/2,$Q=t=>-(Math.sqrt(1-t*t)-1),lEe=t=>1-$Q(1-t),Pot=t=>t<.5?$Q(2*t)/2:(lEe(2*(t-.5))+1)/2;function Od(t){const e=2*(t-Math.sqrt((t-1)*t)),i=e/2/t;return r=>r<i?t*r*r:e*r-e+1}function Rd(t,e){return(i,r)=>i<e?e*t(i/e,r):1-t((1-i)/(1-e),r)*(1-e)}const Iot=Rd(Od(1),1),$ot=Rd(Od(1),0),cEe=Rd(Od(1),.5),Lot=Rd(Od(2),1),Dot=Rd(Od(2),0),Not=Rd(Od(2),.5),Fot=Rd(Od(3),1),Uot=Rd(Od(3),0),Vot=Rd(Od(3),.5),kot=Rd(Od(4),1),Bot=Rd(Od(4),0),zot=Rd(Od(4),.5),Got={linear:Eot,"in-quad":y8,"out-quad":AQ,"in-out-quad":Cot,"in-coast-quad":Iot,"out-coast-quad":$ot,"in-out-coast-quad":cEe,"in-cubic":OQ,"out-cubic":rEe,"in-out-cubic":sEe,"in-coast-cubic":Lot,"out-coast-cubic":Dot,"in-out-coast-cubic":Not,"in-quart":RQ,"out-quart":nEe,"in-out-quart":Aot,"in-coast-quart":Fot,"out-coast-quart":Uot,"in-out-coast-quart":Vot,"in-quint":MQ,"out-quint":oEe,"in-out-quint":Oot,"in-coast-quint":kot,"out-coast-quint":Bot,"in-out-coast-quint":zot,"in-sine":PQ,"out-sine":aEe,"in-out-sine":Rot,"in-expo":IQ,"out-expo":AI,"in-out-expo":Mot,"in-circ":$Q,"out-circ":lEe,"in-out-circ":Pot};function Js(t,e,i=Wot,r=e){r!==e&&r.copyFrom(e),r.computeUp(t.state.viewingMode);let s=!1;for(let a=0;a<Xot;a++){let l=0;for(const c of qot)if(dP(i.selection,c.type)){const h=Math.abs(c.error(t,r,i));c.apply(t,r,i)&&(s=!0,l+=h)}if(l===0)break}const n=dP(i.selection,kr.COLLISION),o=jot(i.interactionType,t);return n&&vA(t,r,o)&&(s=!0),s&&r.computeUp(t.state.viewingMode),s}function jot(t,e){switch(t){case mi.PAN:return rd.EYE_AND_CENTER;case mi.ASCEND:return e.state.isGlobal?rd.EYE_AND_CENTER_SCALE:rd.EYE_AND_CENTER;default:return rd.EYE}}function Tp(t){const e=Math.min(1,t/150);return sEe(e)}function Hot(t,e,i){return CQ(t,e,i)*e.distance}const qot=[{type:kr.TILT,error:Hot,apply:tEe},{type:kr.ALTITUDE,error:xQ,apply:Fnt},{type:kr.DISTANCE,error:TQ,apply:qnt}],Wot={selection:kr.ALL,interactionType:mi.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:vo.TUMBLE},Xot=5,uu=M(),mc=M(),B0=M(),ga=M(),B1=M(),Yot=M(),hu={upward:Xe(0,0,1),forward:Xe(0,1,0),sideway:Xe(1,0,0)},wle=ls();let xle=class{constructor(e=st.Global){this.viewingMode=e,this.center=M(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=xs(hu.forward)}pixelsPerPanAtZoom(e){return this.size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this.size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/e}compareTo(e,i){if(i||(i={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===st.Global){const n=(je(this.center)+je(e.center))/2;i.pan=RN(this.center,e.center)*n}else i.pan=Ar(this.center,e.center);let r=Math.abs(e.yaw-this.yaw);r>=Math.PI&&(r=2*Math.PI-r);const s=Math.abs(e.pitch-this.pitch);return i.rotate=Math.max(r,s),i.sourceZoom=this.distance,i.targetZoom=e.distance,i}interpolate(e,i,r){this.viewingMode===st.Global?pke(e.center,i.center,r.pan,this.center):tn(this.center,e.center,i.center,r.pan),this.distance=isFinite(i.distance)?Yt(e.distance,i.distance,r.zoom):e.distance,this.pitch=Yt(e.pitch,i.pitch,r.rotate);let s=e.yaw;const n=i.yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this.yaw=Yt(s,n,r.rotate)}copyFrom(e){he(this.center,e.center),this.pitch=e.pitch,this.yaw=e.yaw,this.distance=e.distance,he(this.lookAtDirection,e.lookAtDirection),this.size=e.size,this.copyFromCommon(e),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const i=this._lookAtOrientation(e.center,wle);he(this.center,e.center),be(ga,e.center,e.eye),qc(ga,ga,i),qc(B1,e.up,i),this.distance=je(ga),this.distance!==0&&(ga[0]/=this.distance,ga[1]/=this.distance,ga[2]/=this.distance),this.pitch=this._eyeUpToPitch(ga),this.yaw=this._eyeUpToYaw(ga,B1),this.size=Math.sqrt(e.width*e.width+e.height*e.height),this.copyFromCommon(e)}copyFromCommon(e){this.fov=e.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(e){const i=this._lookAtOrientation(this.center,wle);wd(i,i),this._axisAngleVec3(hu.sideway,this.pitch-Math.PI/2,hu.forward,ga),this._axisAngleVec3(hu.upward,this.yaw,ga),this._axisAngleVec3(hu.sideway,this.pitch-Math.PI/2,hu.upward,B1),this._axisAngleVec3(hu.upward,this.yaw,B1),ue(ga,ga,this.distance),qc(ga,ga,i),qc(B1,B1,i),e.center=this.center,e.eye=be(ga,this.center,ga),e.up=B1}_axisAngleVec3(e,i,r,s=r){const n=Math.cos(i),o=Math.sin(i);return ue(uu,r,n),Et(mc,e,r),ue(mc,mc,o),ue(B0,e,(1-n)*Ae(e,r)),ve(s,ve(s,uu,mc),B0)}_lookAtOrientation(e,i=ls()){return this._upAtLookAt(e,B0),Et(uu,this.lookAtDirection,B0),Oe(uu,uu),uu[0]===0&&uu[1]===0&&uu[2]===0&&he(uu,hu.sideway),Et(mc,B0,uu),Oe(mc,mc),i[0]=uu[0],i[1]=mc[0],i[2]=B0[0],i[3]=uu[1],i[4]=mc[1],i[5]=B0[1],i[6]=uu[2],i[7]=mc[2],i[8]=B0[2],i}_upAtLookAt(e,i){return this.viewingMode===st.Local?he(i,hu.upward):Oe(i,e)}_eyeUpToPitch(e){return Math.PI-RN(hu.upward,e)}_eyeUpToYaw(e,i){const r=Yot;return Math.abs(i[2])<.5?(he(r,i),e[2]>0&&ue(r,r,-1)):he(r,e),Et(mc,r,hu.upward),Oe(mc,mc),RN(hu.sideway,mc,hu.upward)}};const M5={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};let Zot=class uEe{constructor(e){this._createCamera=e,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:M5.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new uEe(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,i,r){this.source!==e&&this.source.copyFrom(e),this.target!==i&&this.target.copyFrom(i),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=r.desiredScreenFlow!=null?r.desiredScreenFlow:M5.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const i=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}},Jot=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((e,i)=>e+i.time,0)}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1),e*=this.time;let r=0,s=0;const n=this.definition;for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(e<=a.time||o===this.segments.length-1){if(i=this.segmentInterpolateComponentsAt(a,a.time===0?0:e/a.time,i),n.hasPan&&!isNaN(i.pan)&&isFinite(n.compared.pan)?i.pan=(r+l.compared.pan*i.pan)/n.compared.pan:i.pan=1,n.hasRotate&&!isNaN(i.rotate)&&isFinite(n.compared.rotate)?i.rotate=(s+l.compared.rotate*i.rotate)/n.compared.rotate:i.rotate=1,n.hasZoom&&!isNaN(i.zoom)&&isFinite(l.compared.targetZoom)){const c=i.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,h=this.segments[0].definition.compared.sourceZoom,p=this.segments[this.segments.length-1].definition.compared.targetZoom;i.zoom=(c-h)/(p-h)}else i.zoom=1;return i}e-=a.time,r+=l.compared.pan,s+=l.compared.rotate}}segmentInterpolateComponentsAt(e,i,r){return e.interpolateComponentsAt(i,r)}},S9=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,i=e.compared,r=i.sourceZoom,s=i.targetZoom;this._zoomSign=r>s?1:-1,this._panPixelsAtSource=i.pan*e.source.pixelsPerPanAtZoom(r);const n=(e.source.pixelsPerRotateAtZoom(r)+e.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=i.rotate*n}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:r,hasPan:s,hasRotate:n}=this.definition;let o=0,a=0;r&&(s&&(o=(i/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(e/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(r&&s&&n){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(r&&s){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(r&&n){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,h=1+c;this._panPixelFlow=c/h*l,this._rotatePixelFlow=1/h*l}else s?this._panPixelFlow=l:r?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);this._time=n?this.rotateTime:r?this.zoomTime:s?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=e*this._panPixelsAtSource;return Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const i=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(i*(i/r)**-e-i)/(r-i)}return e}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*e*this._time)-1))/(i*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1);const r=this._interpolateComponentsZoom(e),s=this._interpolateComponentsPan(e),n=this._interpolateComponentsRotate(e);return i?(i.zoom=r,i.pan=s,i.rotate=n):i={zoom:r,pan:s,rotate:n},i}};function Kot(t,e,i){const r=e-t.compared.sourceZoom,s=t.halfWindowPanAtZoom(r);return-t.halfWindowSize*(i.ascensionFactor*Math.LN2*t.compared.pan+s)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*s)}function Qot(t,e,i){const r=1/e,s=Math.log(t.compared.sourceZoom*r),n=1/t.desiredPixelFlow,o=1/Math.LN2,a=e-t.compared.sourceZoom,l=1/a,c=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(a))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*r*n*o*l*c-t.halfWindowSize*s*n*o*l+t.halfWindowSize*s*n*o*c/(a*a)}function eat(t,e,i){const r=e-t.compared.sourceZoom,s=1/r,n=1/e,o=Math.log(t.compared.sourceZoom*n),a=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(r))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(r*r)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function tat(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function iat(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function rat(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function sat(t,e,i){return-t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function nat(t,e,i){return t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function oat(t,e,i){return-2*t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function aat(t,e,i){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function lat(t,e,i){const r=Math.log(e/t.compared.targetZoom),s=1/t.desiredPixelFlow,n=1/Math.LN2,o=-e+t.compared.targetZoom,a=1/o,l=(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*r*s*n*a+t.halfWindowSize*r*s*n*l/(o*o)+t.halfWindowSize*s*n*a*l/e}function cat(t,e,i){const r=e-t.compared.targetZoom,s=1/r,n=1/e,o=Math.log(e/t.compared.targetZoom),a=(t.halfWindowPanAtZoom(e)+i.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(r*r)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function uat(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function hat(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function dat(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function pat(t){const e=Math.LN2*t.compared.pan,i=t.compared.sourceZoom-t.compared.targetZoom,r=t.halfWindowPanAtZoom(i),s=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*r);return t.compared.sourceZoom<=t.compared.targetZoom?s*(e-r):s*(e+r)}function fat(t,e){let i=mat(t,e);const r={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},s=r.ascensionFactor===0,n=r.descensionFactor===0,o=s?tat:Kot,a=s?iat:Qot,l=s?rat:eat,c=n?uat:aat,h=n?hat:lat,p=n?dat:cat,f=E=>o(t,E,r)+sat(t,E,r)+c(t,E,r),m=E=>a(t,E,r)+nat(t,E,r)+h(t,E,r),y=E=>l(t,E,r)+oat(t,E,r)+p(t,E,r);let _=f(i);const b=pat(t);let w;const S=e.maximumIterations||20,T=e.maximumDistance!=null?e.maximumDistance:1/0;for(w=0;w<S;w++){const O=(m(i)+1e-6)/y(i);if(isNaN(O)||i>=T&&O<0){if(!isFinite(T))return null;i=T,_=f(i);break}if(i-=O,i<t.compared.sourceZoom||i<t.compared.targetZoom)return null;const R=f(i);if(Math.abs(R-_)/_<=.005)break;_=R}return _>b*(1-.3)||i<t.compared.sourceZoom||i<t.compared.targetZoom?null:i}function mat(t,e){const i=Math.max(t.compared.sourceZoom,t.compared.targetZoom),r=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return r<i?e.maximumDistance!=null?i+(e.maximumDistance-i)/2:1.5*i:e.maximumDistance?Math.min(e.maximumDistance,r):r}let gat=class extends Jot{constructor(e,i){super(),this._preallocSegments=[new S9,new S9,new S9],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,i)}update(e,i){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();let r=null;i&&i.apex&&(r=fat(e,i.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,r==null?this._updateWithoutApex():this._updateWithApex(r,i==null?void 0:i.apex)}segmentInterpolateComponentsAt(e,i,r){return r=e.interpolateComponentsAt(i,r),e===this._ascensionSegment?r.zoom=AQ(r.zoom):e===this._descensionSegment&&(r.zoom=y8(r.zoom)),r}_updateWithApex(e,i){const[r,s,n]=this._preallocSegments,o=(i==null?void 0:i.ascensionFactor)??.5,a=Math.min(1-o,(i==null?void 0:i.ascensionFactor)!=null&&i.descensionFactor!=null?i.descensionFactor:.5),l=1-o-a;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=e,r.definition.compared.pan=this.definition.compared.pan*o,r.definition.compared.rotate=this.definition.compared.rotate*o,r.update(),this._ascensionSegment=r,this.segments.push(r),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=e,s.definition.compared.targetZoom=e,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=e,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const yat={zoom:0,pan:0,rotate:0};let _at=class{get time(){return this._time}constructor(e){this._createCamera=e,this._time=0,this.definition=new Zot(e),this.path=new gat}update(e,i,r){this.definition.update(e,i,r),this.path.update(this.definition,r),this._time=this._applyTimeSettings(Mme(isFinite(this.path.time)?this.path.time:0),r),this._easing=r.easing?r.easing:this._time>=1e3?cEe:AI}cameraAt(e,i){i=i||this._createCamera(),e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const r=this.path.interpolateComponentsAt(e,yat);return i.interpolate(this.definition.source,this.definition.target,r),i}_normalizedEasing(e){const i=this._easing(0,this._time),r=this._easing(1,this._time);return(this._easing(e,this._time)-i)/(r-i)}_applyTimeSettings(e,i){const r=i.speedFactor!=null?i.speedFactor:1;i.duration!=null?e=i.duration:i.speedFactor!=null&&(e=e/r);const s=i.minDuration!=null?i.minDuration:M5.minDuration/r,n=i.maxDuration!=null?i.maxDuration:M5.maxDuration/r;return Math.min(Math.max(s,e),n)}};const vat=M();let bat=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new _at(()=>new xle(e)),this._current=new xle(e)}update(e,i,r){const s=this._animation.definition.source,n=this._animation.definition.target,o=be(vat,i.center,e.center),a=je(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),he(s.lookAtDirection,o),he(n.lookAtDirection,o),s.copyFromRenderCamera(e),n.copyFromRenderCamera(i),this._current.copyFrom(s),this._animation.update(s,n,r),this.currentTime=0,e.almostEquals(i)&&(this.currentTime=this._animation.time)}cameraAt(e,i){return this._animation.cameraAt(e,this._current),i=i||new Ut,this._current.copyToRenderCamera(i),i}step(e,i){return this.finished||(this.currentTime=this.currentTime+Mme(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,i)}};var fs;(function(t){t.Ready="ready",t.Rejected="rejected",t.Running="running",t.Stopped="stopped",t.Finished="finished"})(fs||(fs={}));let dy=class extends $e{constructor(e){super(e),this.state=fs.Ready}get active(){return this.state===fs.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=fs.Stopped,!0)}finishController(){this.state=fs.Finished}get steppingFinished(){return!1}};u([d({constructOnly:!0})],dy.prototype,"view",void 0),u([d({readOnly:!0})],dy.prototype,"active",null),u([d()],dy.prototype,"state",void 0),u([d({readOnly:!0})],dy.prototype,"isInteractive",null),dy=u([I("esri.views.3d.state.controllers.CameraController")],dy);let fP=class extends dy{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(Bi()),this._asyncResult=null),this.state===fs.Finished||this.state===fs.Stopped?($6(e),this.state===fs.Finished?e.resolve():e.reject(Bi())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=fs.Running,v(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){!v(this.viewAnimation)||this.state!==fs.Ready&&this.state!==fs.Running||(this.viewAnimation.state===Yy.State.FINISHED?this.finish():this.viewAnimation.state===Yy.State.STOPPED&&(this.state=fs.Stopped))}onControllerEnd(){v(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===fs.Finished?this.viewAnimation.finish():this.state===fs.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===fs.Finished?this._asyncResult.resolve():this._asyncResult.reject(Bi()))}finish(){this.finishController()}};fP=u([I("esri.views.3d.state.controllers.AnimationController")],fP);let xy=class extends fP{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new bat(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new Yy}get isInteractive(){return this.mode==="interaction"}begin(e,i){this._hasTarget=!0;const r=this.animationSettings(i);hL.copyFrom(this.view.state.camera);const s=xd(this.view.state.viewingMode);this.intersectionHelper.intersectRay(hL.ray,s,Tle)&&(hL.center=Tle),this.animation.update(hL,e,r),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,i){this._hasTarget&&this.animation.step(e,i)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?Got[e.easing]:e.easing}}};u([d({constructOnly:!0})],xy.prototype,"mode",void 0),u([d({readOnly:!0})],xy.prototype,"isInteractive",null),xy=u([I("esri.views.3d.state.controllers.PointToPointAnimationController")],xy);const hL=new Ut,Tle=M();function _8(t=xat){return[t[0],t[1],t[2],t[3]]}function mP(t,e){return wat(t[0],t[1],t[2],e,uJ.get())}function wat(t,e,i,r,s=_8()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function LQ(t,e,i){return Et(i,t,e),Oe(i,i),i[3]=pJ(t,e),i}const xat=[0,0,1,0];function hEe(t,e,i){return Tat(t,t.screenToRender(e,at.get()),i)}function Tat(t,e,i){const r=Fn(at.get(),e);if(r[2]=0,!t.unprojectFromRenderScreen(r,i.origin))return null;const s=Fn(at.get(),e);s[2]=1;const n=t.unprojectFromRenderScreen(s,at.get());return C(n)?null:(be(i.direction,n,i.origin),i)}function bA(t,e,i){return DQ(t,t.screenToRender(e,at.get()),i)}function DQ(t,e,i){he(i.origin,t.eye);const r=fe(at.get(),e[0],e[1],1),s=t.unprojectFromRenderScreen(r,at.get());return C(s)?null:(be(i.direction,s,i.origin),i)}function NQ(t,e,i,r){const s=bA(e,i,Sat);return v1(t,s,r)}const Sat=fo();var $C;(function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"})($C||($C={}));const dEe=30,P5=[1,3e8],v8=80,pEe=8,fEe=200,mEe=1508e5,gEe=5,yEe=50,Eat=5,Cat=10,E9=90,yT={exclude:new Set([av])};function ux(t,e,i){return i[0]=e[0]/(t.fullWidth/t.pixelRatio),i[1]=e[1]/(t.fullHeight/t.pixelRatio),i}function $W(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function l1(t,e,i){const r=eh(hJ.get(),i[3],i);C(r)||g_e(r,th)||(be(pr,t.eye,e),ut(pr,pr,r),t.eye=ve(pr,pr,e),be(pr,t.center,e),ut(pr,pr,r),t.center=ve(pr,pr,e),t.up=ut(pr,t.up,r))}function Aat(t,e,i,r){return hT(t,hEe(e,i,VQ),r)}function LW(t,e,i,r){return hT(t,bA(e,i,VQ),r)}function FQ(t,e,i,r){const s=at.get();let n=1-i;be(s,e,t.eye);const o=je(s);let a=o*(1-n);n>=0&&a<r&&(a=r,n=-(a-o)/o),Math.abs(o-a)<1e-6||(ue(s,s,n),t.eye=ve(pr,t.eye,s),t.center=tn(pr,t.center,e,n))}function _Ee(t,e,i){e.getScreenCenter(Sle),NQ(t,e,Sle,pr)&&(e.center=pr);const r=e.distance,s=r*i;if(Math.abs(r-s)<1e-6)return;const n=ue(at.get(),e.viewForward,s);e.eye=be(pr,e.center,n)}const Sle=ms();function C9(t,e){fe(e,0,0,0);for(const i of t)ve(e,e,i);ue(e,e,1/t.length)}function wF(t,e,i,r){return Math.sin(t/je(e))*(i+r.radius)}function Ele(t,e,i,r){return wF(Math.PI/2,e,i,r)+(t-Math.PI/2)}var mo;(function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"})(mo||(mo={}));const Cle={Elevation:3e4,Angle:ii(16)},dL={Pole:.95,Angle:ii(18),Tilt:45},vEe=ii(80);function bEe(t,e,i,r,s,n){const o=M(),a=gn();let l=!0,c=!0;return t.intersectScreen(i,o,n)?a[3]=je(o):(c=!1,e.aboveGround&&s!==$C.Ellipsoid?a[3]=Math.max(je(e.center),.9*r.radius):a[3]=je(e.eye)-e.relativeElevation,s===$C.Silhouette?gP(a,e,i,o):l=NQ(a,e,i,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function b8(t,e,i){return je(t.eye)-i.radius>Cle.Elevation?mo.Horizontal:(bA(t,e,Lle),-Math.sign(t.relativeElevation)*(.5*Math.PI+pJ(t.eye,Lle.direction))<Cle.Angle?mo.Vertical:mo.Horizontal)}function wEe(t,e,i){be(A9,i,e),t.eye=be(pr,t.eye,A9),t.center=be(pr,t.center,A9)}const A9=M();function gP(t,e,i,r){const s=bA(e,i,VQ);return!C(s)&&(nA(t,s,pL),v1(t,s,r)?!(Bo(pL,s.origin)<Bo(r,s.origin))||(he(r,pL),!1):(be(kT,e.eye,e.center),Oe(kT,kT),bve(kT,-Ae(Oe(kT,kT),pL),Ale),hT(Ale,s,r),!1))}const pL=M(),kT=M(),Ale=qi();function xEe(t,e,i,r,s,n){let o=0;if(Et(L5,t,e),be(yL,t,e),je(t)<=s||!r.aboveGround){Et(i,yL,r.eye);const a=Ae(t,e)/(je(t)*je(e));if(a<.9999)o=Dn(a);else{const c=je(Et(M(),t,e))/(je(t)*je(e));o=pd(c)}const l=Math.cos(we(Yv.normalize(ii(n)),0,vEe));o=-o-Math.max(0,je(e)-s)/(l*s)}else be(Ole,r.eye,r.center),Et(i,yL,Ole),o=-je(yL)/s;return Oe(i,i),ue(i,i,je(L5)),o}const Ole=M();function Rle(t,e,i,r){let s,n;const o=Math.cos(we(Yv.normalize(ii(r)),0,vEe));return s=e>i?-(e-i)/(o*i):e<-i?Math.PI-(e+i)/(o*i):Dn(e/i),n=t>i?-(t-i)/(o*i):t<-i?Math.PI-(t+i)/(o*i):Dn(t/i),(n-s)*i}function Oat(t,e,i,r,s,n,o,a,l,c){const h=Rle(t[2],e[2],n[3],a),p=l?Rle(t[0],e[0],n[3],180):e[0]-t[0],f=Math.sin(o)*p-Math.cos(o)*h,m=Math.cos(o)*p+Math.sin(o)*h;Oe(pr,s);const y=l?f/Math.sqrt(Math.abs(n[3]**2-Ae(i,pr)**2)):f/n[3],_=m/Math.sqrt(Math.abs(n[3]**2-Ae(i,r)**2));It(c,y,_)}function TEe(t,e,i,r,s,n,o,a,l,c){Et(L5,t,e),hj(n.up,n.eye,fL,mL,gL),hj([0,0,1],n.eye,Py,Vv,AEe),he(i,Vv),he(r,Py),Oe(i,i),ue(i,i,je(L5)),Cre(t,Oe(mL,mL),Oe(gL,gL),Oe(fL,fL),Mle),Cre(e,mL,gL,fL,Ple),Oat(Mle,Ple,t,Py,Vv,o,a,l,c,s)}function Rat(t,e,i,r,s,n,o){eh(I5,s,r),eh($5,o,n),Ts(QS,I5,$5),be(e,t,i),ut(e,e,QS),ve(e,e,i)}function SEe(t,e,i,r,s,n){eh(I5,r,i),eh($5,n,s),Ts(QS,I5,$5),be(pr,t.eye,e),ut(pr,pr,QS),t.eye=ve(pr,pr,e),be(pr,t.center,e),ut(pr,pr,QS),t.center=ve(pr,pr,e),be(pr,t.up,e),ut(pr,pr,QS),t.up=ve(pr,pr,e)}function UQ(t,e,i,r,s,n){return(Math.abs(r)>Math.PI-dL.Angle||Math.abs(r)<dL.Angle)&&(Math.abs(t[2])<i*dL.Pole||Math.abs(e)>i)&&n.aboveGround&&s<dL.Tilt}function EEe(t,e,i,r,s,n){if(n)LQ(i,r,Ile),l1(e,t,Ile);else{const o=xEe(i,r,$le,e,t[3],s);l1(e,t,mP($le,o))}}function CEe(t,e,i,r,s,n,o){const a=o?20:1,l=1e-12;let c,h;he(z1,r),_L.copyFrom(e);for(let p=0;p<a&&Bo(i,z1)>l&&(c=Bo(i,z1),TEe(i,z1,Vv,Py,rO,_L,t,s,n,o),SEe(_L,t,Py,rO[1],Vv,rO[0]),Rat(z1,z1,t,Py,rO[1],Vv,rO[0]),h=Bo(i,z1),h<c||p===0);p++)e.copyFrom(_L)}function Mat(t,e,i,r,s,n,o){UQ(i,Ae(e.up,i),t[3],-Yv.normalize(ii(s)),n,e)?CEe(t,e,i,r,-Yv.normalize(ii(s)),n,o):EEe(t,e,i,r,n,o)}function Pat(t,e,i,r,s,n){const{eye:o}=t;hj([0,0,1],o,Py,Vv,AEe);const a=e.translation[0]*i.pan,l=s.mode==="zoom"?0:e.translation[1]*i.pan,c=Math.max(Math.sqrt(Math.abs(1-Ae(t.center,Py)**2/je(t.center)**2)),.5),h=(Math.sin(n)*l+Math.cos(n)*a)/c,p=-Math.cos(n)*l+Math.sin(n)*a;switch(Wc(r.pan.matrix,r.pan.matrix,h,Py),r.pan.enabled=!0,s.mode){case"pan":Wc(r.pan.matrix,r.pan.matrix,p,Vv),r.pan.enabled=!0;break;case"zoom":r.zoom=-e.translation[1]*i.zoom}}function Iat(t,e,i,r,s){const{eye:n,viewRight:o}=t,a=Et(at.get(),o,n),l=e.translation[0]*i.pan;switch(l!==0&&(Wc(r.pan.matrix,r.pan.matrix,-l,a),r.pan.enabled=!0),s.mode){case"pan":{const c=e.translation[1]*i.pan;c!==0&&(Wc(r.pan.matrix,r.pan.matrix,c,o),r.pan.enabled=!0);break}case"zoom":r.zoom=-e.translation[1]*i.zoom}}function $at(t,e,i,r,s,n,o,a,l){UQ(t.center,Ae(t.up,t.center),je(t.center),-Yv.normalize(ii(n)),o,e)?Pat(e,i,r,a,l,-Yv.normalize(ii(s))):Iat(e,i,r,a,l)}const Py=M(),Vv=M(),AEe=M(),fL=M(),mL=M(),gL=M(),Mle=M(),Ple=M(),rO=et(),Ile=_8(),I5=We(),$5=We(),QS=We(),z1=M(),pr=M(),yL=M(),_L=new Ut,L5=M(),$le=M(),VQ={origin:M(),direction:M()},Lle={origin:M(),direction:M()},Dle=.6,O9=4,Lat=60;let D5=class extends xy{constructor(){super(...arguments),this._zoomLocation=M(),this._tmpCamera=new Ut,this._tmpViewDir=M(),this._tmpRayDir={origin:M(),direction:M()},this._targetOnSphere=M(),this._tmpCenter=M(),this._constraintOptions={selection:kr.ALL_EXCEPT_COLLISION,interactionType:mi.ZOOM,interactionFactor:null,interactionStartCamera:new Ut,interactionDirection:null,tiltMode:vo.TUMBLE},this._sphere=gn()}initialize(){this._intersector=xd(this.view.state.viewingMode)}zoomStep(e,i){if(!this.active)return;const r=this.view.state,{interactionStartCamera:s}=this._constraintOptions;s&&(this.animation.finished?s.copyFrom(r.camera):this.animation.cameraAt(1,s));let n=!1,o=!1;this.intersectionHelper.intersectScreen(i,this._zoomLocation,this.view.map.ground.opacity===0?yT:{})&&(n=e>0,o=!0),this._tmpCamera.copyFrom(r.camera),n?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:he(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,i,o),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:AI}}_updateCamera(e,i,r,s,n){const o=tr(this.view.spatialReference),a=b8(e,s,o),l=Math.abs(this.view.camera.position.z);Oe(bL,e.eye),ue(bL,bL,-1),bA(e,s,this._tmpRayDir),Oe(this._tmpRayDir.direction,this._tmpRayDir.direction);const c=we(Math.min(pEe,1/Math.abs(Ae(bL,this._tmpRayDir.direction)))*l,fEe,mEe);if(a===mo.Horizontal){let h=Dle**i;this._sphere[3]=je(r),be(this._tmpViewDir,e.center,e.eye);const p=Math.min(je(this._tmpViewDir),c);let f=p*h;if(h<=1&&f<O9&&(f=O9,h=f/p),Math.abs(p-f)<1e-6)return;const m=je(e.center);if(this._sphere[3]!==m){const y=this._sphere[3]+h*(m-this._sphere[3]);e.center=ue(vL,e.center,y/m)}ue(this._tmpViewDir,this._tmpViewDir,-h),e.eye=ve(vL,e.center,this._tmpViewDir),Js(this.view,e,this._constraintOptions),Bo(r,e.center)>1e-12&&NQ(this._sphere,e,s,this._targetOnSphere)&&Mat(this._sphere,e,r,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let h=Dle**Math.abs(i);const p=i>0?1:-1;be(this._tmpViewDir,r,e.eye);const f=je(this._tmpViewDir),m=this.view._stage.renderView.getMinimalDepthForArea(null,s[0],s[1],this.view.state.camera,Lat);let y=v(m)?m:c;y=n&&i>0?Math.min(y,f):y,ue(this._tmpRayDir.direction,this._tmpRayDir.direction,y),ve(r,this._tmpRayDir.origin,this._tmpRayDir.direction);let _=y*h;const b=Math.max(O9,1.01*e.nearFar[0]);if(i>0&&_<b&&(_=b,h=_/y),Math.abs(y-_)<1e-6)return;ue(this._tmpRayDir.direction,this._tmpRayDir.direction,p*(1-h)),e.eye=ve(vL,e.eye,this._tmpRayDir.direction),e.center=ve(vL,e.center,this._tmpRayDir.direction)}vA(this.view,e)}};D5=u([I("esri.views.3d.state.controllers.global.ZoomStepController")],D5);const vL=M(),bL=M(),Dat=.6,Nat=4,Fat=60;let N5=class extends xy{constructor(){super(...arguments),this._zoomLocation=M(),this._tmpCamera=new Ut,this._tmpRayDir=M(),this._tmpCenter=M(),this._constraintOptions={selection:kr.ALL,interactionType:mi.ZOOM,interactionFactor:null,interactionStartCamera:new Ut,interactionDirection:null,tiltMode:vo.TUMBLE}}zoomStep(e,i){if(!this.active)return;const r=this.view.state,{interactionStartCamera:s}=this._constraintOptions;s&&(this.animation.finished?s.copyFrom(r.camera):this.animation.cameraAt(1,s)),this._tmpCamera.copyFrom(r.camera);const n=xd(this.view.state.viewingMode);let o=!1;e>0?(o=this.intersectionHelper.intersectScreenFreePointFallback(i,this._zoomLocation,this.view.map.ground.opacity===0?yT:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,n,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,n,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:he(this._zoomLocation,this._tmpCamera.center);const a=Dat**e;let l=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,i[0],i[1],this.view.state.camera,Fat);be(wL,this._tmpCamera.eye,this._zoomLocation),Oe(wL,wL);const c=we(Math.min(pEe,1/Math.abs(Ae(Uat,wL)))*Math.abs(this.view.camera.position.z),fEe,mEe);if(l=v(l)?l:c,l){const h=M();be(h,this._zoomLocation,this._tmpCamera.eye),(l<je(h)||!o)&&(Oe(h,h),ve(this._zoomLocation,this._tmpCamera.eye,ue(h,h,l)))}this._updateCamera(this._tmpCamera,a,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:AI}}_updateCamera(e,i,r){be(this._tmpRayDir,r,e.eye);const s=je(this._tmpRayDir);let n=s*i;const o=i<=1,a=Math.max(Nat,1.01*e.nearFar[0]);n!==0&&(o&&n<a&&(n=a,i=n/s),Math.abs(s-n)<1e-6||(ue(this._tmpRayDir,this._tmpRayDir,i),e.eye=be(Nle,r,this._tmpRayDir),e.center=tn(Nle,e.center,r,1-i),Js(this.view,e,this._constraintOptions)))}};N5=u([I("esri.views.3d.state.controllers.local.ZoomStepController")],N5);const Nle=M(),Uat=Xe(0,0,1),wL=M();function w8(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function kQ(t,e){if(t.pointerType==="touch")return!1;switch(e){case"primary":return t.button===0;case"secondary":return t.button===2;case"tertiary":return t.button===1}}let Vat=class extends Kr{constructor(e,i){super(!0),this._view=e,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r))}_handleDoubleClick(e){const i=e.data;if(w8(i,"primary")){const r=this._view.state.isGlobal?new D5({view:this._view,mode:"animation"}):new N5({view:this._view,mode:"animation"});this._view.state.switchCameraController(r),r.zoomStep(Math.log(.5)/Math.log(.6),ms(i.x,i.y)),e.stopPropagation()}}};function kat(t,e,i){return t===st.Global?new zat(i):new Bat(e,i)}let Bat=class{constructor(e,i){this._elevationProvider=e,this._referenceEllipsoid=tr(i),this._unitInMeters=_l(i,this._referenceEllipsoid.metersPerDegree)}compute(e,i,r,s,n){var T;n||(n={near:0,far:0});let o=e[2]*this._unitInMeters;const a=o,l=o-s,c=(T=this._elevationProvider)==null?void 0:T.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const h={x:(r=v(r)?r:new Pi({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},p=Math.max(h.x,h.y,h.z);be(G1,i,e),BT[0]=G1[0]>0?r.xmax:r.xmin,BT[1]=G1[1]>0?r.ymax:r.ymin,BT[2]=G1[2]>0?p/2:-p/2,be(BT,BT,e),Oe(G1,G1);const f=1.1*Ae(BT,G1)*this._unitInMeters,m=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),y=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),_=y*Hat*this._unitInMeters,b=y*qat*this._unitInMeters,w=we((o-b)/(_-b),0,1)**3,S=Math.min(Yt(m,f,w),m)*Math.max(Math.log(Math.abs(l)),1);return OEe(Math.min(S,Math.max(34064e4,p))/this._unitInMeters,Gat,this._unitInMeters,n)}},zat=class{constructor(e){this._referenceEllipsoid=tr(e)}compute(e,i,r,s,n){n||(n={near:0,far:0});const o=je(e),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,s),c=Math.abs(a-s),h=Math.max(c,Math.abs(a)),p=Math.sqrt(h*(h+2*l)),f=o+this._referenceEllipsoid.radius;return OEe(1.2*Yt(p,f,UK(h)),we(2e4-(Math.log(h)-7.983)/9.011*19e3,1e3,2e4),1,n)}};function OEe(t,e,i,r){const s=jat/i;return t/e>s?(r.far=t,r.near=r.far/e):(r.near=s,r.far=r.near*e),r}const Gat=2e4,jat=2,Hat=.001,qat=1e-4,BT=M(),G1=M();let xF=class extends $e{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const i=this.view.state.camera;v(e.spatialReference)&&eEe(this.view,i,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>vA(this.view,e,rd.EYE_AND_CENTER))}};u([d({constructOnly:!0})],xF.prototype,"view",void 0),xF=u([I("esri.views.3d.state.ElevationCollisionConstraint")],xF);let QR=class extends $e{constructor(e){super(e),this.nearFarHeuristic=kat(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([re(()=>{var e,i,r,s;return[(i=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:i.near,(s=(r=this.view.constraints)==null?void 0:r.clipDistance)==null?void 0:s.far]},()=>this._clipDistanceNearFarChanged()),re(()=>{var e,i;return(i=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:i.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),re(()=>this.view.renderDataExtent,()=>this._updateNearFar(),Wi),re(()=>{var e,i,r,s;return[(i=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:i.min,(s=(r=this.view.constraints)==null?void 0:r.altitude)==null?void 0:s.max]},()=>this._updateAltitude(),Wi),re(()=>{var e,i;return(i=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:i.max},()=>this._updateTiltMax(),Wi),re(()=>{var e,i;return(i=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:i.mode},()=>this._updateTilt(),Wi),re(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),Wi),re(()=>{var e,i,r,s,n,o;return[(r=(i=(e=this.view.map)==null?void 0:e.ground)==null?void 0:i.navigationConstraint)==null?void 0:r.type,(o=(n=(s=this.view.state)==null?void 0:s.constraints)==null?void 0:n.collision)==null?void 0:o.enabled]},()=>this._updateCollision(),Wi)]),this.view.state.isLocal&&this.addHandles(re(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),Zt)),this._updateNearFar(),this.view.state.viewingMode!==st.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new xF({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var i;const e=(i=this.view.constraints)==null?void 0:i.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(r=>this._updateCameraNearFarManual(r,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const i=this.view.constraints&&this.view.constraints.clipDistance;(i?i.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,i):this._updateCameraNearFarAuto(e,i)}_updateCameraNearFarAuto(e,i){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,g8(this.view,e.eye),e),i&&i.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,i){i&&(e.near=i.near,e.far=i.far)}_updateCollision(){var s,n,o;const e=(o=(n=(s=this.view.map)==null?void 0:s.ground)==null?void 0:n.navigationConstraint)==null?void 0:o.type,i=!e||e==="stay-above",r=this.view.state.constraints.collision;if(i!==r.enabled){r.enabled=i,i&&this._reapplyConstraints(kr.COLLISION);const a=this.view.constraints&&this.view.constraints.tilt;a&&a.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==st.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const i=this.view.state.constraints;i.tilt=i.createConstantMaxTilt(ii(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const i=this.view.state.constraints;if(i.tilt){const r=i.tilt(this.view.state.camera.distance).max;e.autoUpdate(yl(r))}}_updateLocalSurfaceDistance(e){if(C(e))return;let i=Math.max(e.width,e.height);if(i<=0)return;e.zmax!=null&&e.zmin!=null&&(i=Math.max(i,e.zmax-e.zmin));const r=this.view.state,s=3*i/Math.atan(r.camera.fov/2);s!==r.constraints.distance&&(r.constraints.distance=s)}_reapplyConstraints(e=kr.ALL){this.view.state.updateCamera(i=>Js(this.view,i,{selection:e,interactionType:mi.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:vo.TUMBLE}))}};u([d({constructOnly:!0})],QR.prototype,"view",void 0),u([d({readOnly:!0})],QR.prototype,"surfaceCollisionConstraint",void 0),QR=u([I("esri.views.3d.state.ConstraintsManager")],QR);let cv=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}constructor(e){this.renderCoordsHelper=e,this.frustum=cP(),this._points=J2e(),this.lines=new Array(12),this._origin=M(),this._direction=M(),this._altitude=null;for(let i=0;i<12;i++)this.lines[i]={origin:null,direction:M(),endpoint:null}}update(e){K2e(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),he(this._origin,e.eye),he(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let i=0;i<this._points.length;i++)he(this._points[i],e[i]);Q2e(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return Cv(this.frustum,e)}intersectsRay(e){return Bit(this.frustum,e)}intersectsLineSegment(e,i){return zit(this.frustum,e,i)}intersectsPoint(e){return eSe(this.frustum,e)}_updateLines(){const e=this._points;for(let i=0;i<4;i++){const r=i+4;R9(this.lines[i],e[i],e[r]),R9(this.lines[i+4],e[i],i===3?e[0]:e[i+1]),R9(this.lines[i+8],e[r],i===3?e[4]:e[r+1])}}};function R9(t,e,i){t.origin=e,t.endpoint=i,i0(t.direction,e,i)}cv.planePointIndices=Git,cv.nearFarLineIndices=[[vt.NEAR_BOTTOM_LEFT,vt.FAR_BOTTOM_LEFT],[vt.NEAR_BOTTOM_RIGHT,vt.FAR_BOTTOM_RIGHT],[vt.NEAR_TOP_RIGHT,vt.FAR_TOP_RIGHT],[vt.NEAR_TOP_LEFT,vt.FAR_TOP_LEFT]];let e3=class extends dy{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e),this._handles=new Ki}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=fs.Running,this._handles.add(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this._handles.removeAll()}stepController(){}_handleElevationChangeEvent(e){v(e.spatialReference)&&!eEe(this.view,this.desiredCamera,e.extent,e.spatialReference)||this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),vA(this.view,e,rd.EYE_AND_CENTER)||this.constraintEnabled||(this.state=fs.Stopped)})}};u([d({constructOnly:!0})],e3.prototype,"desiredCamera",null),e3=u([I("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],e3);const Wat=M(),xL=M();function BQ(){return{direction:M(),up:M()}}function REe(t,e,i,r,s){let n=Oe(Wat,t),o=Ae(n,r);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(Ae(e,r)),o<.99?(he(n,e),a&&ue(n,n,-1)):n=null);let l=0;if(n){ue(xL,r,Ae(r,n)),be(n,n,xL);const h=Ae(n,s)/(je(n)*je(s));Et(xL,n,s),l=(Ae(xL,r)>0?1:-1)*yl(Dn(h))}const c=yl(Dn(-Ae(r,t)/je(t)));return i?(i.heading=l,i.tilt=c,i):{heading:l,tilt:c}}const MEe=Xe(0,1,0),PEe=Xe(0,0,1),sO=We(),_g=M(),vg=M();function IEe(t,e,i,r=BQ()){const{direction:s,up:n}=r;return c_e(sO,-ii(e)),lC(sO,sO,ii(i)),ut(s,PEe,sO),ue(s,s,-1),ut(n,MEe,sO),r}function Xat(t,e,i,r){return REe(e,i,r,PEe,MEe)}function Yat(t,e,i,r){const s=IEe(t,i,r),n=M();return ue(n,s.direction,-e),ve(n,n,t),{up:s.up,eye:n,heading:i,tilt:r}}function Zat(t){return yl(t)}function Jat(t){return ii(t)}function $Ee(t,e,i,r,s){const n=t.renderSpatialReference,o=t.map&&t.spatialReference||e.spatialReference;return da(e,_g,n),da(e,vg,n),_g[0]-=i/2,vg[0]+=i/2,_g[1]-=r/2,vg[1]+=r/2,_o(_g,n,_g,o),_o(vg,n,vg,o),s?(s.xmin=_g[0],s.ymin=_g[1],s.xmax=vg[0],s.ymax=vg[1],s.spatialReference=o):s=new Pi(_g[0],_g[1],vg[0],vg[1],o),s}const Kat=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:Xat,eyeForCenterWithHeadingTilt:Yat,eyeTiltToLookAtTilt:Jat,headingTiltToDirectionUp:IEe,lookAtTiltToEyeTilt:Zat,toExtent:$Ee},Symbol.toStringTag,{value:"Module"})),LEe=Xe(0,0,1),DEe=Oe(M(),Xe(1,1,1)),Qat=new Xv(-180,180),nO=We(),ev=M(),zT=M();function NEe(t,e,i,r=BQ()){Et(ev,t,LEe),Ae(ev,ev)===0&&Et(ev,t,DEe),eh(nO,-ii(e),t),Wc(nO,nO,-ii(i),ev);const{up:s,direction:n}=r;return Et(s,ev,t),Oe(s,s),ut(s,s,nO),Oe(n,t),Pa(n,n),ut(n,n,nO),r}function elt(t,e,i,r){const s=ev,n=zT;return Oe(s,t),Et(zT,s,LEe),Ae(zT,zT)===0&&Et(zT,s,DEe),Et(n,zT,s),REe(e,i,r,s,n)}function tlt(t,e,i,r){const s={eye:M(),up:null,tilt:r,heading:i},n=ev;n[0]=t[0],n[1]=t[2],n[2]=-t[1];const o=e,a=ii(i),l=ii(r),c=Math.sin(a),h=Math.cos(a),p=Math.sin(l),f=Math.cos(l),m=je(n);let y;if(Math.abs(l)<1e-8)y=o+m;else{const H=m/p,$=pd(o/H),N=Math.PI-l-$;y=H*Math.sin(N)}const _=f*o,b=o*o*(p*p),w=h*h*b,S=y-_,T=S*S,E=w*(w+T-n[1]*n[1]);if(E<0)return ue(s.eye,n,y/m),s.tilt=0,TL(s,t);const O=Math.sqrt(E),R=n[1]*S,L=w+T;let P;if(P=h>0?-O+R:O+R,Math.abs(L)<1e-8)return m<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):ue(s.eye,n,y/m),s.tilt=0,M9(s.eye),TL(s,t);s.eye[1]=P/L;const F=c*c*b,V=p*o,B=h*V*s.eye[1],G=s.eye[1]*s.eye[1],te=1-G,se=Math.sqrt(te),ie=w*G+F-2*B*se*S+te*T;return Math.abs(ie)<1e-8?(ue(s.eye,n,y/m),s.tilt=0,M9(s.eye),TL(s,t)):(s.eye[0]=(te*(y*n[0]-_*n[0])-V*se*(n[0]*s.eye[1]*h+n[2]*c))/ie,s.eye[2]=(te*(y*n[2]-_*n[2])-V*se*(n[2]*s.eye[1]*h-n[0]*c))/ie,ue(s.eye,s.eye,y),M9(s.eye),TL(s,t))}function M9(t){const e=t[1];t[1]=-t[2],t[2]=e}function TL(t,e){const i=NEe(e,t.heading,t.tilt);return t.up=i.up,t}function ilt(t,e,i){const r=je(e),s=Math.sqrt(i*i+r*r-2*i*r*Math.cos(Math.PI-t)),n=pd(i/(s/Math.sin(t)));return yl(t-n)}function rlt(t,e,i){const r=ii(t),s=je(e);return pd(i/(s/Math.sin(r)))+r}function FEe(t,e,i,r,s){let n,o,a,l;const c=e.latitude,h=tr(t.spatialReference).radius,p=e.longitude,f=pnt(c,i,h)/2;n=p-f,o=p+f;const m=ii(c),y=(1+Math.sin(m))/(1-Math.sin(m)),_=(y+1)*Math.tan(r/h/2),b=_*_;function w(T){const E=Math.PI/2;return(T=OFe.normalize(T,-E))>E&&(T=Math.PI-T),T}if(a=1.5*Math.PI-2*Math.atan(.5*(_+Math.sqrt(4*y+b))),l=a+r/h,a=w(a),l=w(l),l<a){const T=l;l=a,a=T}if(a=Math.max(yl(a),-90),l=Math.min(yl(l),90),o=Qat.monotonic(n,o),o-n>180){const T=(o-n-180)/2;n+=T,o-=T}const S=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:mt.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=S):s=new Pi(n,a,o,l,S),t.spatialReference&&t.spatialReference.isWebMercator&&Ey(s,!1,s),s}const slt=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:elt,eyeForCenterWithHeadingTilt:tlt,eyeTiltToLookAtTilt:rlt,headingTiltToDirectionUp:NEe,lookAtTiltToEyeTilt:ilt,toExtent:FEe},Symbol.toStringTag,{value:"Module"}));function F5(t){return t.type==="point"}let UEe=class{constructor(e,i=null,r=0){this.array=e,this.spatialReference=i,this.offset=r}};function VEe(t){return"array"in t}function wm(t,e,i="ground"){if(F5(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,i);if(VEe(e)){let r=e.offset;return t.getElevation(e.array[r++],e.array[r++],e.array[r]||0,Gt(e.spatialReference,t.spatialReference),i)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,i)}function U5(t,e){return t!=null&&(e==null||(e===st.Local?!t.isGeographic||t.isWGS84||t.wkid===Qh.CGCS2000:t.isWebMercator||t.isWGS84||t.wkid===Qh.CGCS2000||t.wkid===Qh.GCSMARS2000||t.wkid===Qh.GCSMARS2000_SPHERE||t.wkid===Qh.GCSMOON2000))}const kEe=oe.getLogger("esri.views.3d.support.cameraUtils"),BEe=39.37,zEe=96,DW=1,nlt=8,olt=5,GEe=1,Fle=M(),alt={heading:0,tilt:0},uv=new pt,llt=new Xv(-20037508342788905e-9,20037508342788905e-9),clt=new Xv(-180,180);var aa;function OI(t){return t.spatialReference||mt.WGS84}function wA(t){return t.viewingMode==="global"?slt:Kat}function ult(t,e,i,r,s){return wA(t).headingTiltToDirectionUp(e,i,r,s)}function ly(t,e){if(C(e))return null;const i=t.renderSpatialReference,r=wA(t).headingTiltToDirectionUp,s=M();if(!da(e.position,s,i))return null;const n=r(s,e.heading,e.tilt);ue(n.direction,n.direction,t.state.camera.distance),ve(n.direction,n.direction,s);const o=gT(t,s,n.direction,n.up);return o.fov=ii(e.fov),o}(function(t){t[t.LOCKED=0]="LOCKED",t[t.ADJUST=1]="ADJUST"})(aa||(aa={}));const GT=M();function LC(t,e,i){const r=t.renderSpatialReference,s=x8(t,e.eye,e.viewForward,e.up,alt);let n=OI(t);return _o(e.eye,r,GT,n)||(n=mt.WGS84,_o(e.eye,r,GT,n)),C(i)?new fd(new pt(GT,n),s.heading,s.tilt,yl(e.fov)):(i.position.x=GT[0],i.position.y=GT[1],i.position.z=GT[2],i.position.spatialReference=n,i.heading=s.heading,i.tilt=s.tilt,i.fov=yl(e.fov),i)}function zQ(t,e,i){const r=t.state.camera,s=r.width/2/r.pixelRatio;return t.renderCoordsHelper.viewingMode===st.Global&&i!=null&&(e*=Math.cos(ii(i))),e/=t.renderCoordsHelper.unitInMeters,s/(zEe*BEe/e)/Math.tan(r.fovX/2)}function Xx(t,e,i){const r=t.state.camera,s=e*Math.tan(r.fovX/2),n=r.width/2/r.pixelRatio;let o=zEe*BEe/(n/s);return t.renderCoordsHelper.viewingMode===st.Global&&i!=null&&(o/=Math.cos(ii(i))),o*=t.renderCoordsHelper.unitInMeters,o}function jEe(t,e,i,r,s,n){return HEe(t,e,zQ(t,i,e.latitude),r,s,n)}function HEe(t,e,i,r,s,n){if(hx(n)){const a=new xA(n.signal);return yP(t,r.heading,r.tilt,e,i,s,a),void a.resolver.promise.then(l=>{const c=k5(t,l,r.fov);if(!C(c))return n.resolver.resolve(c);n.resolver.reject()},l=>n.resolver.reject(l))}const o=yP(t,r.heading,r.tilt,e,i,s);return k5(t,o,r.fov,n)}function x8(t,e,i,r,s){return wA(t).directionToHeadingTilt(e,i,r,s)}function hlt(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,uv,t.spatialReference)&&t.elevationProvider&&Gt(wm(t.elevationProvider,uv),0)>(uv.z??0)-GEe)}async function dlt(t,e,i){if(!t.renderCoordsHelper.fromRenderCoords(e,uv,t.spatialReference)||!t.elevationProvider)return!1;const r=uv.z??0,s=await t.elevationProvider.queryElevation(uv.x,uv.y,r,uv.spatialReference,"ground",i);return Gt(s,0)>r-GEe}async function plt(t,e,i){const r=M();if(e)if(e instanceof pt){if(da(e,r,t.renderSpatialReference),e.z==null&&t.basemapTerrain!=null&&t.elevationProvider!=null){const s=await t.elevationProvider.queryElevation(e.x,e.y,e.z??0,e.spatialReference,"ground",i);return v(s)&&t.renderCoordsHelper.setAltitude(r,s),r}}else he(r,e);else he(r,t.state.camera.center);return r}function flt(t,e){const i=M();if(e&&e instanceof pt){if(da(e,i,t.renderSpatialReference),e.z==null&&t.basemapTerrain!=null&&t.elevationProvider!=null){const r=wm(t.elevationProvider,e);v(r)&&t.renderCoordsHelper.setAltitude(i,r)}}else he(i,e||t.state.camera.center);return i}function yP(t,e,i,r,s,n,o){const a=r&&r instanceof pt?r:null;if(hx(o))return plt(t,r,o.signal).then(c=>{NW(t,e,i,a,c,s,n,o)},c=>o.resolver.reject(c)),null;const l=flt(t,r);return NW(t,e,i,a,l,s,n,o)}function NW(t,e,i,r,s,n,o,a){if(C(r)){const p=t.renderSpatialReference;if(r=Kv(s,p,OI(t)),C(r))return null}n=Math.max(n,t.state.constraints.minimumPoiDistance);const l=ylt(t,e,i,s,n,o),c=(0,wA(t).eyeForCenterWithHeadingTilt)(s,n,l.heading,l.tilt);if(o===aa.ADJUST&&t.viewingMode==="global"&&i>0){const p=()=>{const m=qEe(t,s,n,vlt(t,n,i,s));return o=i-m<1?aa.LOCKED:aa.ADJUST,NW(t,e,m,r,s,n,o,a)},f=t.map.ground.navigationConstraint;if(!f||f.type==="stay-above"){if(hlt(t,c.eye))return p();if(hx(a))return dlt(t,c.eye,a.signal).then(m=>m?p():(a.resolver.resolve({eye:c.eye,up:c.up,center:xs(s),heading:c.heading,tilt:c.tilt}),null)),null}}const h=!a||hx(a)?{center:M(),eye:M(),up:M(),tilt:0,heading:0}:a;return h.eye=c.eye,h.up=c.up,h.center=xs(s),h.heading=c.heading,h.tilt=c.tilt,hx(a)&&a.resolver.resolve(h),h}function t3(t,e,i,r,s,n=null){let o,a,l;if(t.state.isGlobal){if(!U5(e.spatialReference,st.Global))return hx(n)&&n.resolver.reject(),null;const b=new pt(e.xmin,e.ymin,e.spatialReference),w=new pt(e.xmax,e.ymax,e.spatialReference),S=e.spatialReference.isGeographic?clt:llt;o=new pt({x:S.center(b.x,w.x),y:(w.y+b.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const T=tr(e.spatialReference),E=dnt(o,b,w);a=E.lon,l=E.lat,S.diff(b.x,w.x)>S.range/2&&(a+=T.halfCircumference),a=Math.min(a,T.halfCircumference),l=Math.min(l,T.halfCircumference)}else{const b=Gt(t.renderSpatialReference,e.spatialReference);b.equals(e.spatialReference)||(e=tg(e,b)),a=e.xmax-e.xmin,l=e.ymax-e.ymin;const w=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;o=new pt({x:e.xmin+.5*a,y:e.ymin+.5*l,z:w,spatialReference:b})}const c=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,h=t.state.camera,p=1/Math.tan(h.fovX/2),f=1/Math.tan(h.fovY/2),m=1/Math.tan(h.fov/2),y=Math.max(.5*a*p,.5*l*f,.5*c*m)/DW;if(hx(n)){const b=new xA(n.signal);return yP(t,i,r,o,y,s,b),void b.resolver.promise.then(w=>{const S=k5(t,w,t.camera.fov);if(!C(S))return n.resolver.resolve(S);n.resolver.reject()},w=>n.resolver.reject(w))}const _=yP(t,i,r,o,y,s);return k5(t,_,t.camera.fov,n)}function mlt(t,e,i){const r=t.renderSpatialReference,s=Kv(i,r,OI(t));if(C(s))return null;const n=Math.tan(e.fovX/2),o=Math.tan(e.fovY/2),a=XP(e.eye,i),l=2*a*n*DW,c=2*a*o*DW;return t.viewingMode==="global"?FEe(t,s,l,c):$Ee(t,s,l,c)}function glt(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(i/r)/Math.LN2>nlt)return!0;const s=t.renderSpatialReference,n=OI(t),o=Kv(e,s,n),a=Kv(t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s,n);if(C(o)||C(a))return!1;const l=Math.tan(.5*t.state.camera.fov)*r;return a.distance(o)/l>olt}function ylt(t,e,i,r,s,n){let o=0;return n===aa.ADJUST&&glt(t,r,s)?(e=0,o=_lt(t,s,i,r)):o=GQ(t,r,s,i),o=t.state.constraints.clampTilt(s,o),{heading:e,tilt:i=qEe(t,r,s,o)}}const V5=.7;function _lt(t,e,i,r){const s=GQ(t,r,e,i);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);n.max=Math.min(n.max,.5*Math.PI);const o=n.min*(1-V5)+n.max*V5;return Math.min(s,o)}function vlt(t,e,i,r){let s=GQ(t,r,e,i);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);return s=Math.min(s,.5*Math.PI),n.min*(1-V5)+s*V5}function qEe(t,e,i,r){return wA(t).lookAtTiltToEyeTilt(r,e,i)}function GQ(t,e,i,r){return wA(t).eyeTiltToLookAtTilt(r,e,i)}function k5(t,e,i,r){if(C(e))return null;const s=t.renderSpatialReference,n=Kv(e.eye,s,OI(t));return C(n)?null:v(r)?(r.position=n,r.heading=e.heading,r.tilt=e.tilt,r.fov=i,r):new fd(n,e.heading,e.tilt,i)}function blt(t,e){var r;const i=(r=t.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.levelAtScale(e);kEe.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function WEe(t,e){var r;const i=(r=t.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.scaleAtLevel(e);kEe.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function XEe(t,e){return _o(e.center,t.renderSpatialReference,Fle,mt.WGS84),Xx(t,e.distance,Fle[1])}let xA=class{constructor(e){this.signal=e,this.resolver=qv()}};function hx(t){return t&&"resolver"in t}const wlt=.66;function YEe(t){return 360-QY.normalize(t)}function T8(t){return QY.normalize(360-t)}function oO(t){return v(t)&&t.resolver&&t.resolver.reject(),null}function xlt(t,e){return v(t)&&t.resolver&&t.resolver.resolve(e),e}function ZEe(t,e,i,r=null){if(!e)return oO(r);const s=t.spatialReference||mt.WGS84;if(v(e.camera)){const c=sT(e.camera.position,s);if(C(c))return oO(r);const h=e.camera.clone();return h.position=c,xlt(r,h)}if(C(e.targetGeometry))return oO(r);const n=e.get("targetGeometry.spatialReference");if(n&&!Iv(n,s))return oO(r);const o=LC(t,t.state.camera);let a=aa.ADJUST;if(e.rotation!=null&&(o.heading=YEe(e.rotation),a=aa.LOCKED),i!=null&&(o.tilt=i),e.targetGeometry.type==="point"){const c=e.targetGeometry;let h;const p=e.targetGeometry.clone();return h=e.scale!=null?zQ(t,e.scale,c.latitude):t.state.camera.distance,HEe(t,p,h,o,a,r)}const l=e.targetGeometry.extent;return l?t3(t,l,o.heading,o.tilt,a,r):oO(r)}function Tlt(t,e,i=null){return C(i)&&(i=new zo),qQ(t,null,e.clone(),i)}async function Slt(t,e,i){const r=Llt(t,e);if(!r)throw new W("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new fd({fov:t.camera.fov}),n=new zo({camera:s});if(r.target instanceof zo)return j1(await Alt(t,r.target,r,i,n));if(r.target instanceof fd)return j1(KEe(t,r.target,n));const o=r.scale!=null||r.zoom!=null;if(r.target instanceof Pi){const c=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return j1(o||c?await FW(t,r,r.target.center,s,i,n):await Plt(t,r,r.target,s,i,n))}const a={boundingBox:$r(),hasZ:!1,screenSpaceObjects:[]},l=o?Elt(t,r):void 0;if(await JEe(t,r.target,l,a),isFinite(a.boundingBox[0])){let c;if(Mp(a.boundingBox,Zs),Lu.x=Zs[0],Lu.y=Zs[1],Lu.z=Zs[2],Lu.spatialReference=t.spatialReference,isFinite(Lu.z)&&a.hasZ?c=$Z(a.boundingBox):(Lu.z=void 0,c=_6e(IZ(a.boundingBox,Nlt))),o||c)return j1(await FW(t,r,Lu,s,i,n));const h=Dlt(t,a.screenSpaceObjects);return j1(await $lt(t,r,Lu,a.boundingBox,h,s,i,n))}return r.position?j1(Rlt(t,r,s,n)):j1(await Mlt(t,r,s,i,n))}function jQ(t,e){return e.scale==null&&e.zoom!=null?WEe(t,e.zoom):e.scale}function Elt(t,e){const i=jQ(t,e);return i?Kke(i):void 0}function HQ(t,e){let i=!1;return e.heading!=null?(t.heading=e.heading,i=!0):e.rotation!=null&&(t.heading=YEe(e.rotation),i=!0),e.tilt!=null&&(t.tilt=e.tilt,i=!0),e.fov!=null&&(t.fov=e.fov),i}function qQ(t,e,i,r){const s=t.spatialReference||mt.WGS84;return e=v(e)?e:ly(t,i),C(e)||(r.targetGeometry=Kv(e.center,t.renderSpatialReference,s),r.scale=XEe(t,e),r.rotation=T8(i.heading),r.camera=i),r}function B5(t,e,i){var a,l;const r=()=>new W("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw r();if(!Iv(e.spatialReference,t.spatialReference))throw new W("viewpointutils:incompatible-spatialreference",`Spatial reference (${e.spatialReference?e.spatialReference.wkid:"unknown"}) is incompatible with the view (${(a=t.spatialReference)==null?void 0:a.wkid})`,{geometry:e});const s=[];if(!e.hasZ&&t.basemapTerrain){let c;switch(e.type){case"point":c=e;break;case"multipoint":case"polyline":c=(l=e.extent)==null?void 0:l.center;break;case"mesh":c=e.origin;break;case"extent":c=e.center;break;case"polygon":c=e.centroid}c&&v(t.basemapTerrain.spatialReference)&&Iv(c,t.basemapTerrain.spatialReference)&&t.elevationProvider?Zs[2]=Gt(wm(t.elevationProvider,c),0):Zs[2]=0}(0,Flt[e.type])(e,c=>{s.push(c[0],c[1],c[2])},Zs);const n=s.length/3;if(n===0)throw r();const o=new Array(s.length);if(Es(s,e.spatialReference,0,o,t.spatialReference,0,n)){e.hasZ&&(i.hasZ=!0);for(let c=0;c<o.length;c+=3)e.hasZ?(Zs[0]=o[c+0],Zs[1]=o[c+1],Zs[2]=o[c+2]):(Zs[0]=o[c+0],Zs[1]=o[c+1]),zm(i.boundingBox,Zs)}}async function Clt(t,e,i,r){const s=await Kp(t.whenViewForGraphic(e));if(s.ok===!1||C(s.value)||!("whenGraphicBounds"in s.value))return void B5(t,e.geometry,r);const n=s.value,o=await Kp(n.whenGraphicBounds(e,{minDemResolution:i}));if(o.ok===!1)return void B5(t,e.geometry,r);const{screenSpaceObjects:a,boundingBox:l}=o.value;rC(r.boundingBox,l),a&&a.forEach(c=>{r.screenSpaceObjects.push(c)}),isFinite(l[2])&&(r.hasZ=!0)}async function JEe(t,e,i,r){var s;if(Array.isArray(e)&&e.length===2){const n=e[0],o=e[1];if(typeof n=="number"&&typeof o=="number")return Lu.x=n,Lu.y=o,Lu.z=void 0,Lu.spatialReference=(s=t.spatialReference)!=null&&s.isGeographic?t.spatialReference:mt.WGS84,void B5(t,Lu,r)}e&&typeof e.map=="function"?await lc(e.map(n=>JEe(t,n,i,r))):e instanceof r0?B5(t,e,r):e instanceof ha&&await Clt(t,e,i,r)}async function Alt(t,e,i,r,s){if(v(e.camera))return KEe(t,e.camera,s);s.scale=e.scale,s.rotation=e.rotation,s.targetGeometry=v(e.targetGeometry)?e.targetGeometry.clone():null,s.camera=null,i.heading!=null?s.rotation=T8(i.heading):i.rotation!=null&&(s.rotation=i.rotation);const n=jQ(t,i);n!=null&&(s.scale=n);const o=new xA(r);return ZEe(t,s,i.tilt,o),s.camera=await o.resolver.promise,s}function KEe(t,e,i){const r=t.spatialReference,s=sT(e.position,r);return C(s)?null:((e=e.clone()).fov=t.camera.fov,e.position=s,qQ(t,null,e,i))}function Olt(t,e,i,r,s,n){const o=t.renderSpatialReference;return da(i,EL,o),da(e,P9,o),n.targetGeometry=new pt(e),s.position=new pt(i),be(z5,P9,EL),x8(t,EL,z5,r.up,s),n.scale=Xx(t,Ar(EL,P9),n.targetGeometry.latitude),n.rotation=T8(s.heading),n.camera=s,n}async function FW(t,e,i,r,s,n){if(C(i))throw new W("createfromcenter","invalid point");n.targetGeometry=i.clone();const o=gT(t);if(e.position)return Olt(t,n.targetGeometry,e.position,o,r,n);if(e.zoomFactor){const l=o.distance/e.zoomFactor,c=ue(Zs,o.viewForward,-l);o.eye=ve(Zs,o.center,c),n.scale=Xx(t,l,i.latitude)}LC(t,o,r);const a=HQ(r,e)?aa.LOCKED:aa.ADJUST;if(!e.zoomFactor){const l=jQ(t,e);l==null?(da(i,Zs,t.renderSpatialReference),eSe(o.frustum,Zs)?n.scale=Xx(t,Ar(o.eye,Zs),i.latitude):n.scale=XEe(t,o)):n.scale=l;const c=new xA(s);jEe(t,n.targetGeometry,n.scale,r,a,c),n.camera=await c.resolver.promise}return n}function Rlt(t,e,i,r){const s=gT(t);return he(z5,s.viewForward),x8(t,s.eye,z5,s.up,I9),i.position=new pt(e.position),i.heading=e.heading!=null?e.heading:I9.heading,i.tilt=e.tilt!=null?e.tilt:I9.tilt,qQ(t,null,i,r)}async function Mlt(t,e,i,r,s){const n=gT(t);return FW(t,e,Kv(n.center,t.renderSpatialReference,t.spatialReference),i,r,s)}async function Plt(t,e,i,r,s,n){n.targetGeometry=i.clone();const o=gT(t);LC(t,o,r);const a=HQ(r,e)?aa.LOCKED:aa.ADJUST,l=new xA(s);return t3(t,i,r.heading,r.tilt,a,l),n.camera=await l.resolver.promise,n}function Ilt(t,e,i,r,s){let n=0;i.z!=null?n=i.z:t.basemapTerrain&&t.elevationProvider&&(n=wm(t.elevationProvider,i)),fe(Zs,i.x,i.y,n),Jp(t.spatialReference,Zs,Ule,t.renderSpatialReference),bd(SL,Ule),wd(SL,SL),$r(aO);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let y=0;y<o.length;y++){const _=o[y];let b=r[_[2]];isFinite(b)||(b=n),fe(Zs,r[_[0]],r[_[1]],b),_o(Zs,t.spatialReference,Zs,t.renderSpatialReference),zm(aO,qc(Zs,Zs,SL))}const a=oT(aO),l=g1(aO),c=aT(aO),h=1/Math.tan(e.fovX/2),p=1/Math.tan(e.fovY/2),f=.5*Math.sqrt(a*a+c*c)*Math.max(p,h)+.5*l,m=.5*l*p+.5*Math.max(a,c);return Math.max(f,m)/s}async function $lt(t,e,i,r,s,n,o,a){a.targetGeometry=i.clone();const l=gT(t),c=Ilt(t,l,i,r,s);LC(t,l,n);const h=HQ(n,e)?aa.LOCKED:aa.ADJUST;a.scale=Xx(t,c,a.targetGeometry.latitude);const p=new xA(o);return jEe(t,a.targetGeometry,a.scale,n,h,p),a.camera=await p.resolver.promise,a}function Llt(t,e){if(!e||!t.spatialReference)return null;const i={target:void 0};if("declaredClass"in e||Array.isArray(e))i.target=e;else{for(const r in e)i[r]=e[r];e.center&&!i.target&&(i.target=e.center)}return i}function j1(t){return t&&v(t.camera)&&(t.rotation=T8(t.camera.heading)),t}function Dlt(t,e){const i=wlt;if(!e.length)return i;let r=Number.NEGATIVE_INFINITY;for(let s=0;s<e.length;s++){const n=e[s].screenSpaceBoundingRect;r=Math.max(r,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return i-r/Math.min(t.width,t.height)*2}const Zs=M(),Ule=We(),SL=ls(),aO=Nn(),Nlt=ci(),z5=M(),EL=M(),P9=M(),I9={heading:0,tilt:0},Lu=new pt,Flt={point(t,e,i){i[0]=t.x,i[1]=t.y,t.z!=null&&(i[2]=t.z),e(i)},polygon(t,e,i){const r=t.hasZ;for(let s=0;s<t.rings.length;s++){const n=t.rings[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),e(i)}},polyline(t,e,i){const r=t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),e(i)}},multipoint(t,e,i){const r=t.points,s=t.hasZ;for(let n=0;n<r.length;n++)i[0]=r[n][0],i[1]=r[n][1],s&&(i[2]=r[n][2]),e(i)},extent(t,e,i){t.zmin!=null&&t.zmax!=null?(e(fe(i,t.xmin,t.ymin,t.zmin)),e(fe(i,t.xmax,t.ymin,t.zmin)),e(fe(i,t.xmin,t.ymax,t.zmin)),e(fe(i,t.xmax,t.ymax,t.zmin)),e(fe(i,t.xmin,t.ymin,t.zmax)),e(fe(i,t.xmax,t.ymin,t.zmax)),e(fe(i,t.xmin,t.ymax,t.zmax)),e(fe(i,t.xmax,t.ymax,t.zmax))):(e(fe(i,t.xmin,t.ymin,i[2])),e(fe(i,t.xmax,t.ymin,i[2])),e(fe(i,t.xmin,t.ymax,i[2])),e(fe(i,t.xmax,t.ymax,i[2])))},mesh(t,e,i){const r=t.vertexAttributes&&t.vertexAttributes.position;if(r)for(let s=0;s<r.length;s+=3)e(fe(i,r[s+0],r[s+1],r[s+2]))}};let Ult=class{constructor(e,i,r){this.target=e,this.options=i,this.view=r,this.state="pending",this._animationController=null,this._promise=new Promise((s,n)=>{this._resolveCallback=s,this._rejectCallback=n;const o=new AbortController;v(this.options.signal)&&ca(this.options.signal,()=>{this.abort()}),this._abortController=o,this.waitForReady()})}then(e,i){return this._promise.then(e,i)}catch(e){return this._promise.catch(e)}resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&v(this._animationController)&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this.reject(Bi())}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await aC(()=>this.view.ready,this._abortController.signal)}catch(e){return this.reject(e)}this.createViewPoint()}createViewPoint(){this.state!=="finished"&&(this.state="wait-for-viewpoint",this._animationController=this.options.animate?this._getAnimationController():null,Slt(this.view,this.target,this._abortController.signal).then(e=>{if(this.state==="finished")return;const i=e?this._getCameraFromViewpoint(e):null;if(!C(i))if(this.options.animate){if(C(this._animationController))return;this.startAnimation(i,this._animationController)}else this.view.stateManager.setStateCamera(i.camera,{applyConstraints:!i.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},e=>{this.reject(e)}))}_getCameraFromViewpoint(e){var n;const i=!!(this.target instanceof zo&&this.target.camera||this.target instanceof fd),r=e.camera;if(C(r))return null;if(!this.view.stateManager.isCompatible(r)){const o=r.position,a=o&&o.spatialReference,l=a?a.wkid:"none",c=(n=this.view.spatialReference)==null?void 0:n.wkid;return this.reject(new W("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${l}, view: ${c})`,{camera:r})),null}const s=ly(this.view,r);return C(s)?(this.reject(new W("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:s,isFullySpecified:i}}startAnimation(e,i){this.state="wait-for-animation-finish";const r=i.viewAnimation;if(C(r))return void this.reject(new W("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(e.viewpoint,"running"),!i.active||C(i.viewAnimation)||i.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==i)return this.abort();let s;e.isFullySpecified?(s=new e3({view:this.view,desiredCamera:e.camera}),vA(this.view,e.camera,rd.EYE_AND_CENTER)):Js(this.view,e.camera),i.begin(e.camera,this.options);const n=()=>{const a=this.view.state.cameraController;s&&(a&&a.active?a instanceof xy&&v(a.viewAnimation)&&a.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=s):v(i.viewAnimation)&&i.viewAnimation.target===e.viewpoint&&i.state==="finished"&&(this.view.state.cameraController=s))},o=a=>{if(!C(this.view.state))switch(i.state){case fs.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case fs.Ready:case fs.Rejected:case fs.Running:case fs.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};r.when(n,a=>o(a)),i.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let e=null,i=null;const r=this.view.state.cameraController;return r instanceof xy&&(r.updateStateFromViewAnimation(),r.active&&(e=r,i=e.viewAnimation)),e!=null||(e=new xy({view:this.view,mode:"animation"}),i=e.viewAnimation,this.view.state.switchCameraController(e))?e:(v(i)&&i.stop(),this.reject(new W("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}},bn=class extends $e{get camera(){const e=this._get("camera");if(!this.ready)return e;const i=LC(this.view,this.view.state.camera,$9);return i&&e&&i.equals(e)?e:i.clone()}set camera(e){var i,r;this._updatePropertyBeforeReady("camera",e)||((i=this.view.elevationProvider)==null||i.enableElevationCache(!0),this.setStateCamera(ly(this.view,e),{applyConstraints:!1})||oe.getLogger(this.declaredClass).error("#camera=","Invalid camera",e),(r=this.view.elevationProvider)==null||r.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const i=LC(this.view,this.view.state.contentCamera,$9);return i&&e&&i.equals(e)?e:i.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const i=ly(this.view,e);C(i)?this.view.state.contentCamera=null:(this._updateElevation(i),this.view.state.contentCamera=i)}installContentCameraReset(e){if(this.removeHandles(L9),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const i=this.zoom,r=this.view.state.camera.distance**2,s=Kl(this.view.state.camera.center),n=e.sticky?this.contentCamera.clone():null;return this.addHandles([re(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(L9),this.test.contentCameraResetState.clear())}),re(()=>this.zoom,o=>{o!==void 0&&i!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(o-i)/2),Math.abs(o-i)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n))}),re(()=>this.view.state.camera,o=>{const a=Bo(s,o.center);this.test.contentCameraResetState.set("camera.center",a/r),a>r?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n)})],L9),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){var i;this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():oe.getLogger(this.declaredClass).error("#center=","Invalid center",e):oe.getLogger(this.declaredClass).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((i=this.view.spatialReference)==null?void 0:i.wkid)+")",e):oe.getLogger(this.declaredClass).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,i=mlt(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return v(i)?i:this._get("extent")}set extent(e){var i;this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||oe.getLogger(this.declaredClass).error("#extent=","Invalid extent",e):oe.getLogger(this.declaredClass).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((i=this.view.spatialReference)==null?void 0:i.wkid)+")",e):oe.getLogger(this.declaredClass).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return Xx(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||oe.getLogger(this.declaredClass).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,i=e.padding,r=e.pixelRatio,s=this._get("padding"),n=Math.round(i[bi.TOP]/r),o=Math.round(i[bi.RIGHT]/r),a=Math.round(i[bi.BOTTOM]/r),l=Math.round(i[bi.LEFT]/r);return s!=null&&s.top===n&&s.right===o&&s.bottom===a&&s.left===l?s:{top:n,right:o,bottom:a,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,CL),this.view.state.updateCamera(i=>i.padding=CL))}_paddingToArray(e,i,r){e?nr(r,e.top||0,e.right||0,e.bottom||0,e.left||0):nr(r,0,0,0,0);for(let s=0;s<4;s++)r[s]=Math.round(r[s]*i)}get screenCenter(){const e=this.padding;return Ra((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?Tlt(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){var i;if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||oe.getLogger(this.declaredClass).error("#viewpoint=","Invalid viewpoint",e);else{const r=v(e.camera)?e.camera.position:e.targetGeometry,s=v(r)&&r.spatialReference;oe.getLogger(this.declaredClass).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(s?s.wkid:"none")+", view: "+((i=this.view.spatialReference)==null?void 0:i.wkid)+")",e)}else oe.getLogger(this.declaredClass).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?blt(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||oe.getLogger(this.declaredClass).error("#zoom=","Invalid zoom",e)}get _pixelRatio(){var e;return v(this._devicePixelRatioOverride)?this._devicePixelRatioOverride:this._usePhysicalPixelRendering?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,(e=this.view)==null?void 0:e.qualitySettings.maximumPixelRatio)}get _rasterPixelRatio(){return v(this._devicePixelRatioOverride)?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){var e,i;return((i=(e=this.view)==null?void 0:e._stage)==null?void 0:i.renderer.isFeatureEnabled(Xs.PhysicalPixelRendering))??!1}get _usePhysicalPixelRenderingAny(){var i,r;const e=(r=(i=this.view)==null?void 0:i._stage)==null?void 0:r.renderer;return e&&(e.isFeatureEnabled(Xs.PhysicalPixelRendering,Mi.IDLE)||e.isFeatureEnabled(Xs.PhysicalPixelRendering,Mi.INTERACTING)||e.isFeatureEnabled(Xs.PhysicalPixelRendering,Mi.ANIMATING))}constructor(e){super(e),this._propertiesPool=new Xy({frustum:cv},this),this._cameraSetByUser=!1,this._gotoOperation=null,this.constraintsManager=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._cameraChangeTime=0,this._updatingIgnoreRenderState=!1,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:i=>this._devicePixelRatioOverride=i,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},set updatingIgnoreRenderState(i){this.viewStateManager._updatingIgnoreRenderState=i},get updatingIgnoreRenderState(){return this.viewStateManager._updatingIgnoreRenderState||v(this.renderState)}}}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([pn(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),re(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},(e,i)=>this._cameraChangedHandler(e,i),Wi)]),qo(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([By({prepare:()=>this._prepareFrame()}),re(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(AL)}),pn(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=Je(this._propertiesPool)}init(){this.constraintsManager=new QR({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const i of e)this.set(i.name,i.value);if(!this._cameraSetByUser){const i=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;i&&this.isCompatible(i)?this._setInitialView(i):this.view.state.viewingMode===st.Local&&this.addHandles(qo(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(AL),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),AL)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(AL),this.constraintsManager=Je(this.constraintsManager))}async goTo(e,i){const r={animate:!0,...i};return v(this._gotoOperation)&&this._gotoOperation.abort(r.animate),this._gotoOperation=new Ult(e,r,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation}debugSetCameraOnContent(){this.setStateCamera(gT(this.view),{applyConstraints:!1})}step(e){const i=this.view.state,r=i==null?void 0:i.cameraController;r&&(i.updateCamera(s=>r.stepController(e,s)),r.steppingFinished&&r.finishController())}_cancelGoToOperation(){v(this._gotoOperation)&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,i=[];for(const{propertyName:r,overrides:s}of klt){const n=e.has(r),o=this._isOverridden(r);!n&&o&&i.push({name:r,value:this._get(r)}),this._clearOverride(r),(n||o)&&s.forEach(a=>e.add(a))}return i}_setInitialView(e){if(C(e)||this._cameraSetByUser)return;if(e instanceof fd)return void this.setStateCamera(ly(this.view,e),{applyConstraints:!1});if(e instanceof zo){if(e.targetGeometry instanceof Pi){const n=t3(this.view,e.targetGeometry,0,.5,aa.LOCKED);return void(v(n)&&this.setStateCamera(ly(this.view,n),{applyConstraints:!0}))}const r={applyConstraints:!e.camera},s=this._viewpointToCamera(e);return void this.setStateCamera(s,r)}const i=t3(this.view,e,0,.5,aa.LOCKED);v(i)&&this.setStateCamera(ly(this.view,i),{applyConstraints:!0})}_updatePropertyBeforeReady(e,i){return!this.ready&&(this._override(e,i),i&&Vlt.includes(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return!C(e)&&(e instanceof zo?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof fd?this.isCompatible(e.position):e.spatialReference&&Iv(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=Blt){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,i,r=z0){const{heading:s,tilt:n}=this._getPreservingHeadingTilt(),o=yP(this.view,s,n,e,i,aa.ADJUST);return C(o)?null:(r.copyFrom(this.view.state.camera),r.eye=o.eye,r.center=o.center,r.up=o.up,r)}_centerToCamera(e){const i=this.view.pointsOfInterest.centerOnContent;i.runTask();const r=i.distance;return this._centerPointAtDistanceToCamera(e,r)}_extentToCamera(e){const{heading:i,tilt:r}=this._getPreservingHeadingTilt(),s=t3(this.view,e,i,r,aa.ADJUST,$9);return s?ly(this.view,s):null}_scaleToCamera(e){if(e==null)return null;const i=this.view.pointsOfInterest.centerOnContent;i.runTask();const r=i.renderLocation,s=i.location.latitude;if(s==null)return null;const n=zQ(this.view,e,s);return this._centerPointAtDistanceToCamera(r,n)}_zoomToCamera(e){return this._scaleToCamera(WEe(this.view,e))}_viewpointToCamera(e){return ly(this.view,ZEe(this.view,e))}setStateCamera(e,i){return!(C(e)||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,i.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(r=>{i.positionAndOrientationOnly?(r.eye=e.eye,r.center=e.center,r.up=e.up):r.copyFrom(e),i.applyConstraints&&Js(this.view,r)}),i.applyConstraints||(this.view.state.cameraController=new e3({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:i}=this.view;if(!e||!i)return;this._windowDevicePixelRatio=window.devicePixelRatio;const r=this._pixelRatio,s=Math.round(e.clientWidth*r),n=Math.round(e.clientHeight*r);if(s!==0&&n!==0&&(i.width===s&&i.height===n||(i.width=s,i.height=n),this.view.state)){const o=this.view.state.camera;o.fullWidth===s&&o.fullHeight===n&&o.pixelRatio===r||(z0.copyFrom(o),z0.pixelRatio!==r&&(this._paddingToArray(this.padding,r,CL),z0.padding=CL),z0.fullWidth=s,z0.fullHeight=n,z0.pixelRatio=r,this.view.state.camera=z0),this._updateViewState()}}_updateElevation(e){var n;const i=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,r=((n=this.view.renderCoordsHelper)==null?void 0:n.getAltitude(e.eye))??0,s=i?g8(this.view,e.eye):0;e.relativeElevation=r-s}_updateViewState(){v(this.test.renderState)?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=Mi.ANIMATING:this.view.interacting?this.view.state.mode=Mi.INTERACTING:(this.view.state.mode===Mi.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<=zlt?this.view.state.mode=Mi.INTERACTING:this.view.state.mode=Mi.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio,this.view.state.contentPixelRatio=Math.min(this._pixelRatio,this.view.qualitySettings.maximumPixelRatio)}_cameraChangedHandler(e,i){e&&i&&e.almostEquals(i)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};u([d({type:fd,dependsOn:["view.state.camera","ready"]})],bn.prototype,"camera",null),u([d({type:fd,dependsOn:["view.state.contentCamera","ready"]})],bn.prototype,"contentCamera",null),u([d({type:pt})],bn.prototype,"center",null),u([d({type:Pi})],bn.prototype,"extent",null),u([d({readOnly:!0})],bn.prototype,"frustum",null),u([d({readOnly:!0})],bn.prototype,"hasInitialView",null),u([d({readOnly:!0,type:Boolean})],bn.prototype,"ready",void 0),u([d({type:Number})],bn.prototype,"scale",null),u([d()],bn.prototype,"padding",null),u([d({readOnly:!0})],bn.prototype,"screenCenter",null),u([d({constructOnly:!0})],bn.prototype,"view",void 0),u([d({type:zo})],bn.prototype,"viewpoint",null),u([d({type:Number})],bn.prototype,"zoom",null),u([d({readOnly:!0})],bn.prototype,"_pixelRatio",null),u([d({readOnly:!0})],bn.prototype,"_rasterPixelRatio",null),u([d({readOnly:!0})],bn.prototype,"_usePhysicalPixelRendering",null),u([d({readOnly:!0})],bn.prototype,"_usePhysicalPixelRenderingAny",null),u([d()],bn.prototype,"_windowDevicePixelRatio",void 0),u([d()],bn.prototype,"_devicePixelRatioOverride",void 0),bn=u([I("esri.views.3d.state.ViewStateManager")],bn);const Vlt=["camera","viewpoint","extent","scale","center","zoom"],klt=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],Blt={heading:0,tilt:0},$9=new fd,z0=new Ut,CL=fi(),AL="pending-initial-view",L9="content-camera-reset",zlt=300,Vle=100;let xm=class extends dy{constructor(){super(...arguments),this.startCamera=new Ut,this.currentCamera=new Ut,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<Vle}stepController(e,i){i.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(i)}onControllerStart(e){this.state=fs.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),Vle),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};u([d({readOnly:!0})],xm.prototype,"isInteractive",null),u([d()],xm.prototype,"_lastInteraction",void 0),xm=u([I("esri.views.3d.state.controllers.InteractiveController")],xm);var Uc;(function(t){t[t.CENTER=0]="CENTER",t[t.EYE=1]="EYE"})(Uc||(Uc={}));let i3=class extends xm{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=Uc.CENTER,this._rotScale=0,this._lastPoint=et(),this._tmpWorldUp=M(),this._tmpViewDir=M(),this._tmpRotCurPoint=et(),this._tmpTransf=We(),this._tmpAxis=M(),this._tmpPivotPoint=M(),this._pivotPos=M(),this._constraintOptions={selection:kr.ALL,interactionType:mi.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:vo.TUMBLE}}initialize(){this._rotScale=this.pivot===Uc.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case Uc.EYE:he(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=mi.LOOK_AROUND,this._constraintOptions.tiltMode=vo.LOOK_AROUND,this._constraintOptions.selection=kr.NONE;break;case Uc.CENTER:{const i=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?yT:{});i||he(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,i),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=mi.TUMBLE,this._constraintOptions.tiltMode=vo.TUMBLE,this._constraintOptions.selection=kr.ALL&~kr.DISTANCE;break}}this._constraintOptions.interactionStartCamera=this.startCamera,ux(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,i){const r=this.startCamera,s=M();be(s,this._pivotPos,r.eye);const n=je(s),o=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(r.eye,kle);let a=Math.max(Math.min(Eat,1/Math.abs(Ae(kle,r.viewForward)))*o,Cat);i&&(a=Math.min(n,a));const l=tr(this.view.spatialReference),c=ms(r.width/r.pixelRatio*.5,r.height/r.pixelRatio*.5),h=b8(this.startCamera,c,l);let p=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,r.fullWidth/r.pixelRatio*.5,r.fullHeight/r.pixelRatio*.5,r,2.5*E9,E9),f=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],r,E9);(v(p)||v(f))&&(p=Gt(p,f),f=C(f)||h===mo.Horizontal?p:f,a=p>f?f:p,a=i?Math.min(a,n):a),Oe(s,s),he(this._pivotPos,ve(this._tmpPivotPoint,r.eye,ue(this._tmpPivotPoint,s,a)))}update(e){if(this.active){switch(this.pivot){case Uc.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case Uc.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}Js(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,i,r,s){this.view.renderCoordsHelper.worldUpAtPosition(s,this._tmpWorldUp),ux(e,i,this._tmpRotCurPoint);let n=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,o=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;be(this._tmpViewDir,r,s);const a=je(this._tmpViewDir),l=Dn(Ae(this._tmpViewDir,this._tmpWorldUp)/a);if(this.pivot===Uc.EYE){n*=-.5;const c=.5*Math.PI-l,h=.5*Math.PI*.99;n=c-Math.max(-h,Math.min(h,c+n))}return n=we(n+l,ia.min,ia.max)-l,Et(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===Uc.CENTER&&(o=-o),eh(this._tmpTransf,o,this._tmpWorldUp),Wc(this._tmpTransf,this._tmpTransf,n,this._tmpAxis),ut(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=ut(D9,e.up,this._tmpTransf),ve(D9,s,this._tmpViewDir),Fn(this._lastPoint,this._tmpRotCurPoint),D9}};u([d()],i3.prototype,"pivot",void 0),i3=u([I("esri.views.3d.state.controllers.RotateController")],i3);const D9=M(),kle=M();let N9=class extends Kr{constructor(e,i,r,s){super(!0),this._view=e,this.pointerAction=i,this._pivot=r,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(e){const i=e.data;if(i.pointers.size>1||!kQ(e.data,this.pointerAction))return;const r=ms(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new i3({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},UW=class extends xm{constructor(){super(...arguments),this._pickPoint=M(),this._tmpP0=et(),this._panAxisAngle=_8(),this._tmpRayDir=M(),this._tmpRayDirPick=M(),this._targetOnSphere=M(),this._navMode=mo.Horizontal,this._tmpRay={origin:M(),direction:M()},this.dragBeginPoint=ms(),this._normalizedAnchorPoint=et(),this._constraintOptions={selection:kr.ALL_EXCEPT_COLLISION,interactionType:mi.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:vo.TUMBLE},this._sphere=gn(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Fn(this.dragBeginPoint,e),ux(this.startCamera,e,this._normalizedAnchorPoint);const i=tr(this.view.spatialReference),r=bEe(this._intersectionHelper,this.startCamera,e,i,$C.Ellipsoid,this.view.map.ground.opacity===0?yT:{});if(this._navMode=b8(this.startCamera,e,i),this._navMode===mo.Horizontal)this._hasPickPoint=!!r.scenePickPoint,this._pickPoint=Gt(r.scenePickPoint,this._pickPoint),this._sphere=r.sphere;else{let s;bA(this.startCamera,e,this._tmpRay),Oe(this._tmpRay.direction,this._tmpRay.direction),v(r.scenePickPoint)&&(be(this._tmpRayDirPick,this.startCamera.eye,r.scenePickPoint),s=je(this._tmpRayDirPick));const n=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,Ble);let o=we(Math.min(dEe,1/Math.abs(Ae(Ble,this._tmpRay.direction)))*n,P5[0],P5[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,v8);o=v(a)?a:o,o=s!=null?Math.min(o,s):o,this._hasPickPoint=!0,ue(this._tmpRay.direction,this._tmpRay.direction,o),ve(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===mo.Horizontal){be(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const i=je(this._tmpRayDir);ux(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=i*2**r;const n=this.view.state.constraints.minimumPoiDistance;if(r<0&&s<n&&(s=n),Math.abs(i-s)<1e-6)return;if(this._hasPickPoint&&s<i){const o=1-(1-s/i)*(1-this._sphere[3]/je(this.currentCamera.center));this.currentCamera.center=ue(OL,this.currentCamera.center,o)}ue(this._tmpRayDir,this._tmpRayDir,-s/i),this.currentCamera.eye=ve(OL,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=Tp(Hm(this.dragBeginPoint,e)),Js(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(gP(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),LQ(this._pickPoint,this._targetOnSphere,this._panAxisAngle),l1(this.currentCamera,this._sphere,this._panAxisAngle))}else{const i=je(this._tmpRay.direction);ux(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=i*2**r;const n=this.view.state.constraints.minimumPoiDistance;if(r<0&&s<n&&(s=n),Math.abs(i-s)<1e-6)return;ue(this._tmpRayDir,this._tmpRay.direction,1-s/i),this.currentCamera.eye=ve(OL,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=ve(OL,this.currentCamera.center,this._tmpRayDir)}vA(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};UW=u([I("esri.views.3d.state.controllers.global.ZoomController")],UW);const OL=M(),Ble=M();let VW=class extends xm{constructor(){super(...arguments),this._tmpP=M(),this._tmpDir=M(),this._tmpN=M(),this._tmpP0=et(),this._tmpPoi=M(),this._tmpRayDir=M(),this.dragBeginPoint=ms(),this._normalizedAnchorPoint=et(),this._constraintOptions={selection:kr.ALL,interactionType:mi.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:M(),tiltMode:vo.TUMBLE},this._plane=qi()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Fn(this.dragBeginPoint,e),ux(this.startCamera,e,this._normalizedAnchorPoint);const i=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?yT:{});be(this._tmpDir,this._tmpP,this.startCamera.eye);const r=je(this._tmpDir);Oe(this._tmpDir,this._tmpDir);const s=Math.abs(this.view.camera.position.z);let n=we(Math.min(dEe,1/Math.abs(Ae(Glt,this._tmpDir)))*s,P5[0],P5[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],this.view.state.camera,v8);n=v(o)?o:n,n=i?Math.min(n,r):n,ue(this._tmpDir,this._tmpDir,n),ve(this._tmpP,this.startCamera.eye,this._tmpDir),be(this._tmpN,this.startCamera.eye,this.startCamera.center),Oe(this._tmpN,this._tmpN),this._tmpN[1]<0&&Pa(this._tmpN,this._tmpN),nI(this._tmpP,this._tmpN,this._plane),this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;Aat(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||he(this._tmpPoi,this.currentCamera.center),ux(this.currentCamera,e,this._tmpP0);let i=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);Fn(this._normalizedAnchorPoint,this._tmpP0),be(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const r=je(this._tmpRayDir);let s=r*(1-i);this._constraintOptions.interactionDirection&&(he(this._constraintOptions.interactionDirection,this._tmpRayDir),ue(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(i)/r));const n=this.view.state.constraints.minimumPoiDistance;i>=0&&s<n&&(s=n,i=-(s-r)/r),Math.abs(r-s)<1e-6||(ue(this._tmpRayDir,this._tmpRayDir,i),this.currentCamera.eye=ve(H1,this.currentCamera.eye,this._tmpRayDir),tn(H1,this.currentCamera.center,this._tmpPoi,i),this._tmpPoi[2]>this.startCamera.center[2]?H1[2]=Math.max(this.startCamera.center[2],H1[2]):H1[2]=Math.min(this.startCamera.center[2],H1[2]),this.currentCamera.center=H1,this._constraintOptions.interactionFactor=Tp(Hm(this.dragBeginPoint,e)),Js(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};VW=u([I("esri.views.3d.state.controllers.local.ZoomController")],VW);const H1=M(),Glt=Xe(0,0,1);let jlt=class extends Kr{constructor(e,i,r){super(!0),this._view=e,this.pointerAction=i,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(e){const i=e.data;if(i.pointers.size>1||!kQ(e.data,this.pointerAction))return;const r=ms(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new UW({view:this._view}):this._cameraController=new VW({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}};function Nd(t){let e=t*t;return t<0&&(e*=-1),e}function Hlt(t){return t.translation[0]=0,t.translation[1]=0,t.translation[2]=0,t.heading=0,t.tilt=0,t}function kW(t,e,i){const r=i,s=t.state,n=t.device,o=e.tiltDirection==="forward-down"?1:-1,a=1;return n.deviceType==="standard"?(r.translation[0]=Nd(s.axes[0]),r.translation[1]=Nd(s.axes[1]),r.translation[2]=Nd(s.buttons[7])-Nd(s.buttons[6]),r.heading=Nd(s.axes[2]),r.tilt=Nd(s.axes[3])):n.deviceType==="spacemouse"&&(r.translation[0]=1.2*Nd(s.axes[0]),r.translation[1]=1.2*Nd(s.axes[1]),r.translation[2]=2*-Nd(s.axes[2]),r.heading=1.2*Nd(s.axes[5]),r.tilt=1.2*Nd(s.axes[3])),r.tilt*=o,ue(r.translation,r.translation,a),r}function zle(t,e){const i=e;return i.translation[0]=t[1]-t[0],i.translation[1]=t[3]-t[2],i.translation[2]=t[4]-t[5],i.heading=t[7]-t[6],i.tilt=t[8]-t[9],i.zoom=t[10]-t[11],i}function TF(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let Jw=class extends xm{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new Ut,this._headingStart=0,this._constraintOptions={selection:kr.ALL,interactionType:mi.NONE,interactionStartCamera:new Ut,interactionFactor:0,interactionDirection:null,tiltMode:vo.LOOK_AROUND}}handleEventGamepad(e){const i=kW(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||TF(i))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,zle(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const i=zle(this._keysButtonState,this._transformation);TF(i)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const i=this.view.pointsOfInterest.cameraOnSurface.location.z,r=1;this._filteredSurfaceElevation+=r*(i-this._filteredSurfaceElevation)*e}stepController(e,i){var r;this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(i),this._updateCameraCenter(),(r=this._constraintOptions.interactionStartCamera)==null||r.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,q1),this._applyDisabledMovementTypes(q1),this._applyPan(q1.pan),this._applyRotate(q1.rotate),this._applyZoom(q1.zoom),this._applyAscend(q1.ascend),this._constraintOptions.interactionType=mi.NONE,this._constraintOptions.selection=kr.COLLISION,Js(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,i)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const i=this.currentCamera;be(Al,i.center,i.eye),ut(Al,Al,e.matrix),i.center=ve(Al,Al,i.eye),i.up=ut(Al,i.up,e.matrix),this._constraintOptions.interactionType=mi.LOOK_AROUND,this._constraintOptions.selection=kr.ALL_EXCEPT_COLLISION,Js(this.view,i,this._constraintOptions)}_applyPan(e,i=this.currentCamera){e.enabled&&(i.eye=ut(Al,i.eye,e.matrix),i.center=ut(Al,i.center,e.matrix),this.view.state.isGlobal&&(i.up=ut(Al,i.up,e.matrix)),this._constraintOptions.interactionType=mi.PAN,this._constraintOptions.selection=kr.ALL,Js(this.view,i,this._constraintOptions))}_applyZoom(e){if(!e)return;const i=this.currentCamera.viewForward;this.currentCamera.eye=ve(Al,this.currentCamera.eye,ue(at.get(),i,e)),he(lO,i),Pa(lO,lO),this._constraintOptions.interactionDirection=lO,this._constraintOptions.interactionType=mi.ZOOM,this._constraintOptions.selection=kr.ALL_EXCEPT_COLLISION,Js(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const i=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,at.get());if(this._constraintOptions.interactionDirection=he(lO,i),this.view.state.isGlobal){const r=je(this.currentCamera.eye),s=(r+e)/r;this.currentCamera.eye=ue(Al,this.currentCamera.eye,s),this.currentCamera.center=ue(Al,this.currentCamera.center,s)}else{const r=ue(at.get(),i,e);this.currentCamera.eye=ve(Al,this.currentCamera.eye,r),this.currentCamera.center=ve(Al,this.currentCamera.center,r)}this._updateCameraCenter(),this._constraintOptions.interactionType=mi.ASCEND,this._constraintOptions.selection=kr.COLLISION,Js(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=kr.ALL_EXCEPT_COLLISION,Js(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,i,r){Klt(r);const s=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(s,i,r):this._calculateControlTransformationGlobal(s,i,r)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,i=this.view.renderCoordsHelper,r=this.currentCamera.ray;this.currentCamera.center=i.intersectManifoldClosestSilhouette(r,e,Al)}_calculateControlTransformationLocal(e,i,r){const{viewRight:s,viewForward:n}=i,o=this._transformation,a=this.view.navigation.gamepad,l=fe(at.get(),n[0],n[1],0);Oe(l,l);const c=o.translation[0]*e.pan;if(c!==0){const _=ue(at.get(),s,c);hc(r.pan.matrix,r.pan.matrix,_),r.pan.enabled=!0}switch(a.mode){case"pan":{const _=-o.translation[1]*e.pan;if(_!==0){const b=ue(at.get(),l,_);hc(r.pan.matrix,r.pan.matrix,b),r.pan.enabled=!0}r.zoom=o.zoom*e.zoom;break}case"zoom":r.zoom=(-o.translation[1]+o.zoom)*e.zoom;break;default:a.mode}const h=o.translation[2]*e.ascend;r.ascend=h;const p=-o.heading*e.rotate;p!==0&&(Wc(r.rotate.matrix,r.rotate.matrix,p,this.view.renderCoordsHelper.worldUpAtPosition(i.eye,at.get())),r.rotate.enabled=!0);const f=o.tilt*e.rotate,m=a1(this.view.renderCoordsHelper,i.center,i.eye),y=we(m+f,ia.min,ia.max)-m;y&&(Wc(r.rotate.matrix,r.rotate.matrix,y,s),r.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,i,r){const{eye:s,viewRight:n}=i,o=this._transformation,a=this.view.navigation.gamepad,l=Et(at.get(),n,s);Oe(l,l),Pa(l,l),$at(this.startCamera,i,o,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,r,a),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(q1.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,h=o.translation[2]*e.ascend;r.ascend=h;const p=-o.heading*e.rotate;p!==0&&(Wc(r.rotate.matrix,r.rotate.matrix,p,this._tmpCamera.eye),r.rotate.enabled=!0);const f=o.tilt*e.rotate,m=this._clampTiltDeltaGlobalToValidRange(f,i.ray,c);m!==0&&(Wc(r.rotate.matrix,r.rotate.matrix,m,this._tmpCamera.viewRight),r.rotate.enabled=!0),r.zoom+=o.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,i,r){const s=tr(this.view.spatialReference),n=wF(ia.min,i.origin,r,s);let o=0,a=0;const l=at.get();if(this.view.renderCoordsHelper.intersectManifold(i,r,l)){const c=a1(this.view.renderCoordsHelper,l,i.origin);o=wF(c,i.origin,r,s),a=wF(ia.max,i.origin,r,s)}else{nA(wU(xU,r+s.radius),i,l);const c=Dn(-Ae(i.direction,Oe(l,l)));o=Ele(c,i.origin,r,s),a=Ele(ia.max,i.origin,r,s)}return we(o+e,n,a)-o}_getPointAbsoluteSurfaceElevation(e,i,r){const{renderCoordsHelper:s}=this.view,n=s.getAltitude(e),o=i+Math.abs(n-i);return s.setAltitude(r,o,e),o}_clampedDistanceToSurface(e,i){const{renderCoordsHelper:r}=this.view,{camera:s}=this.view.state,{direction:n}=ult(this.view,i,0,QEe,Jlt),o=r.intersectManifoldClosestSilhouette(ih(i,n),e,at.get()),a=Ar(i,o),l=r.intersectManifoldClosestSilhouette(ih(i,i0(at.get(),i,s.center)),e,at.get()),c=Ar(i,l);return Math.min(a,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:i,state:r}=this.view,{camera:s,isGlobal:n}=r,o=i.intersectManifoldClosestSilhouette(s.ray,this._filteredSurfaceElevation,at.get());if(n){const a=be(at.get(),e,o),l=je(a);ue(a,a,1/l);const c=Oe(at.get(),e),h=Dn(Ae(c,a));return l*Math.sin(Math.min(Wlt,h))}{const a=he(at.get(),e);return i.setAltitude(a,this._filteredSurfaceElevation),Ar(o,a)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:Xlt}_computeVelocities(e){const i=this._filteredSurfaceElevation,r=i+tr(this.view.spatialReference).radius,{camera:s,isGlobal:n}=this.view.state,o=at.get(),a=this._getPointAbsoluteSurfaceElevation(s.eye,i,o),l=this._clampedDistanceToSurface(i,o),c=s.width/2,h=Gle*s.width,p=Gle*s.width,f=l*Math.tan(.5*s.fovX)/c,m=f/r,y=f/this._computeHeadingRotateRadius(o),_=a-i;return{pan:(n?m:f)*h*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(h*e/c)*_-_),zoom:2**(h*e/c)*l-l,rotate:we(y*p,Ylt,Zlt)*e}}_applyDisabledMovementTypes(e){!v(this.disableMovements)||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&_d(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&_d(e.rotate.matrix))}static activatesFor(e,i){const r=kW(i,e.navigation.gamepad,qlt);return!(i.action==="end"||TF(r))}};u([d({constructOnly:!0})],Jw.prototype,"gamepadDevice",void 0),u([d({constructOnly:!0})],Jw.prototype,"disableMovements",void 0),Jw=u([I("esri.views.3d.state.controllers.GamepadKeyboardController")],Jw);const qlt={translation:[0,0,0],heading:0,tilt:0,zoom:0},QEe=80,Wlt=ii(QEe),Gle=.75,Xlt=5,Ylt=ii(30),Zlt=ii(80),q1={zoom:0,ascend:0,pan:{enabled:!1,matrix:We()},rotate:{enabled:!1,matrix:We()}},Al=M(),lO=M(),Jlt=BQ();function Klt(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,_d(t.pan.matrix),t.rotate.enabled=!1,_d(t.rotate.matrix)}let Qlt=class extends Kr{constructor(e){super(!0),this._view=e,this._watchHandles=new Ki,this._handle=this.registerIncoming("gamepad",i=>this._handleEventGamepad(i)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([re(()=>this._view.navigation.gamepad.enabled,i=>{i?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},Zt),re(()=>this._view.navigation.gamepad.device,i=>{this._cameraControllerGamepad&&i&&this._cameraControllerGamepad.gamepadDevice!==i&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const i=this._view.navigation.gamepad.device;if(i&&e.data.device!==i)return;const r=this._cameraControllerGamepad&&this._cameraControllerGamepad.active;if(r||Jw.activatesFor(this._view,e.data)){if(!r){const s=new Jw({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(s)&&(this._cameraControllerGamepad=s)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};var Ic;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.FORWARD=2]="FORWARD",t[t.BACKWARD=3]="BACKWARD",t[t.UP=4]="UP",t[t.DOWN=5]="DOWN",t[t.HEADINGLEFT=6]="HEADINGLEFT",t[t.HEADINGRIGHT=7]="HEADINGRIGHT",t[t.TILTUP=8]="TILTUP",t[t.TILTDOWN=9]="TILTDOWN",t[t.ZOOMIN=10]="ZOOMIN",t[t.ZOOMOUT=11]="ZOOMOUT"})(Ic||(Ic={}));let ect=class extends Kr{constructor(e,i){super(!0),this._view=e,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:st.Local},this._keyToNumber={[i.left]:Ic.LEFT,[i.right]:Ic.RIGHT,[i.forward]:Ic.FORWARD,[i.backward]:Ic.BACKWARD,[i.up]:Ic.UP,[i.down]:Ic.DOWN,[i.headingLeft]:Ic.HEADINGLEFT,[i.headingRight]:Ic.HEADINGRIGHT,[i.tiltUp]:Ic.TILTUP,[i.tiltDown]:Ic.TILTDOWN,[i.zoomIn]:Ic.ZOOMIN,[i.zoomOut]:Ic.ZOOMOUT},this.registerIncoming("key-down",null,r=>this._handleKeyDown(r)),this.registerIncoming("key-up",null,r=>this._handleKeyUp(r)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const i=this._keyToNumber[e.data.key];i!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new Jw({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(i),e.stopPropagation()))}_handleBlur(){this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const i=this._keyToNumber[e.data.key];i!=null&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(i),e.stopPropagation())}},tct=class extends Kr{constructor(e,i){super(!0),this._view=e,this.registerIncoming("mouse-wheel",i,r=>this._handleMouseWheel(r))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled)return;const i=e.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new D5({view:this._view,mode:"interaction"}):new N5({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*i.deltaY,ms(i.x,i.y)),e.preventDefault(),e.stopPropagation()}},G5=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},Yx=class extends fP{constructor(){super(...arguments),this._beginCamera=new Ut,this._elapsedTimeSec=0,this.constraintOptions={selection:kr.ALL,interactionType:mi.PAN,interactionFactor:0,interactionStartCamera:new Ut,interactionDirection:null,tiltMode:vo.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new Yy}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this._beginCamera,super.onControllerStart(e)}stepController(e,i){i.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,i),Js(this.view,i,this.constraintOptions)}};Yx=u([I("esri.views.3d.state.controllers.momentum.MomentumController")],Yx);let r3=class extends Yx{constructor(e){super(e),this.interactionType=mi.PAN,this._tmpPan=M()}momentumStep(e,i){const r=this.momentum.value(e);ue(this._tmpPan,this.momentum.direction,r),i.eye=be(jle,i.eye,this._tmpPan),i.center=be(jle,i.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};u([d({constructOnly:!0})],r3.prototype,"momentum",void 0),r3=u([I("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],r3);const jle=M(),ict=M(),RL=M();let SF=class extends Yx{constructor(e){super(e),this.interactionType=mi.PAN}momentumStep(e,i){const r=this.momentum.value1(e),s=this.momentum.value2(e);he(RL,i.eye),Oe(RL,RL),Et(this.momentum.axis2,RL,this.momentum.axis1),SEe(i,ict,this.momentum.axis1,r,this.momentum.axis2,s)}};u([d({constructOnly:!0})],SF.prototype,"momentum",void 0),SF=u([I("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],SF);let Lw=class extends Yx{set center(e){this._set("center",xs(e))}set axis(e){this._set("axis",xs(e))}constructor(e){super(e),this.interactionType=mi.TUMBLE}momentumStep(e,i){const r=this.momentum.value(e);l1(i,this.center,mP(this.axis,r))}};u([d({constructOnly:!0})],Lw.prototype,"momentum",void 0),u([d({constructOnly:!0})],Lw.prototype,"center",null),u([d({constructOnly:!0})],Lw.prototype,"axis",null),Lw=u([I("esri.views.3d.state.controllers.momentum.MomentumController")],Lw);let eE=class extends Yx{set zoomCenter(e){this._set("zoomCenter",xs(e))}constructor(e){super(e),this.interactionType=mi.ZOOM,this.constraintOptions.interactionDirection=M()}momentumStep(e,i){const{interactionDirection:r}=this.constraintOptions;if(!r)return;he(r,i.eye);const s=this.momentum.valueDelta(0,e);FQ(i,this.zoomCenter,s,this.view.state.constraints.minimumPoiDistance),i0(r,i.eye,r)}};u([d({constructOnly:!0})],eE.prototype,"momentum",void 0),u([d({constructOnly:!0})],eE.prototype,"zoomCenter",null),eE=u([I("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],eE);let nw=class extends Yx{set screenCenter(e){this._set("screenCenter",ms(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",xs(e))}constructor(e){super(e),this.interactionType=mi.ZOOM,this.radius=0,this._tmpSceneCenter=M(),this._tmpZoomAxisAngle=_8(),this._sphere=gn()}initialize(){this._sphere[3]=this.radius}momentumStep(e,i){const r=this.momentum.valueDelta(0,e);_Ee(this._sphere,i,r),this.constraintOptions.interactionType=mi.ZOOM,Js(this.view,i,this.constraintOptions),gP(this._sphere,i,this.screenCenter,this._tmpSceneCenter),LQ(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),l1(i,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=mi.PAN}};u([d({constructOnly:!0})],nw.prototype,"momentum",void 0),u([d({constructOnly:!0})],nw.prototype,"screenCenter",null),u([d({constructOnly:!0})],nw.prototype,"sceneCenter",null),u([d({constructOnly:!0})],nw.prototype,"radius",void 0),nw=u([I("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],nw);let Sp=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const i=this.computeDelta(e);this._updateDelta(i)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},S8=class{constructor(e,i,r){this._initialVelocity=e,this._stopVelocity=i,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,i){const r=this.value(e);return this.value(e+i)-r}valueFromInitialVelocity(e,i){i=Math.min(i,this.duration);const r=1-this.friction;return e*(r**i-1)/Math.log(r)}},rct=class extends S8{constructor(e,i,r,s,n){super(e,i,r),this._sceneVelocity=s,this.direction=n}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},eCe=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._time=new Sp(.6),this._screen=[new Sp(.4),new Sp(.4)],this._scene=[new Sp(.6),new Sp(.6),new Sp(.6)],this._tmpDirection=M()}add(e,i,r){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(r)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(i[0]),this._scene[1].update(i[1]),this._scene[2].update(i[2]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?0:Math.sqrt(e*e+i*i),s=this._time.filteredDelta,n=s==null||r==null?0:r/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,i,r){fe(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const s=je(this._tmpDirection);s>0&&ue(this._tmpDirection,this._tmpDirection,1/s);const n=this._time.filteredDelta;return new rct(e,i,r,n==null?0:s/n,this._tmpDirection)}},Hle=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const qle=1e-5;let sct=class extends S8{constructor(e,i,r,s,n,o=0,a){super(e,i,r),this._angularVelocity1=s,this.axis1=n,this.angularVelocity2=o,this.axis2=a}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},nct=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._tmpAxis1=M(),this._tmpAxis2=M(),this._tmpAngles=et(),this._time=new Sp(.3),this._screen=[new Sp(.4),new Sp(.4)],this._angle1=new Hle(.6),this._angle2=new Hle(.6),this._axis1=M(),this._axis2=M(),this._lastScene=M()}addMomentumDirectRotation(e,i,r,s,n,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;let a=xEe(this._lastScene,i,this._tmpAxis2,s,n,o);this._angle2.update(0),Ea(this._tmpAxis2)<qle?a=0:Oe(this._axis1,this._tmpAxis2),this._angle1.update(a),he(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}addMomentumPreserveHeading(e,i,r,s,n,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;TEe(this._lastScene,i,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,s,n,o,a,!1),Ea(this._tmpAxis2)<qle?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),Oe(this._axis1,this._tmpAxis1),Oe(this._axis2,this._tmpAxis2)),he(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?null:Math.sqrt(e*e+i*i),s=this._time.filteredDelta,n=r==null||s==null?0:r/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,i,r){const s=this._time.filteredDelta,n=this._angle1.filteredValue,o=this._angle2.filteredValue,a=s==null||o==null?0:o/s;return new sct(e,i,r,s==null||n==null?0:n/s,this._axis1,a,this._axis2)}},tCe=class{constructor(e=2.5,i=.01,r=.95,s=12){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this._maxVelocity=s,this.enabled=!0,this.value=new Sp(.8),this.time=new Sp(.3)}add(e,i){if(this.enabled&&i!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(i)<.01)return;if(this.value.hasFilteredDelta()){const r=this.value.computeDelta(e);this.value.filteredDelta*r<0&&this.value.reset()}}this.time.update(i),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=we(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,i,r){return new S8(e,i,r)}},iCe=class extends tCe{constructor(e=3,i=.01,r=.95,s=12){super(e,i,r,s)}add(e,i){const r=this.value.lastValue;if(r!=null){let s=e-r;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;e=r+s}super.add(e,i)}},oct=class extends S8{constructor(e,i,r){super(e,i,r)}value(e){const i=super.value(e);return Math.exp(i)}valueDelta(e,i){const r=super.value(e),s=super.value(e+i)-r;return Math.exp(s)}},rCe=class extends tCe{constructor(e=2.5,i=.01,r=.95,s=12){super(e,i,r,s)}add(e,i){super.add(Math.log(e),i)}createMomentum(e,i,r){return new oct(e,i,r)}},BW=class extends xm{constructor(){super(...arguments),this._smoothRotation=new G5(.05),this._rotationAxis=M(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=qi(),this._beginRadius=0,this._smoothScaling=new G5(.05),this._zoomCenterScreen=ms(),this._zoomMomentumEstimator=new rCe,this._rotationMomentumEstimator=new iCe,this._panSphericalMomentumEstimator=new nct,this._panPlanarMomentumEstimator=new eCe,this._adjustedSphere=gn(),this._tmp3d=M(),this._tmpScreenPointArray=ms(),this._beginScreenPoint=ms(),this._beginScenePoint=M(),this._screenPickPoint=ms(),this._scenePickPoint=M(),this._mode=mo.Horizontal,this._sphere=gn(),this._pointerCount=0,this._tmpInteractionDirection=M(),this._constraintOptions={selection:kr.ALL,interactionType:mi.NONE,interactionFactor:0,interactionStartCamera:new Ut,interactionDirection:null,tiltMode:vo.TUMBLE}}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){var n;if(!this.active)return;const i=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=i,this._rotationMomentumEstimator.enabled=i,this._panPlanarMomentumEstimator.enabled=i,this._panSphericalMomentumEstimator.enabled=i,this._beginHeading=-Yv.normalize(ii(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),pm(e.center,this._screenPickPoint),Fn(this._beginScreenPoint,this._screenPickPoint);const r=tr(this.view.spatialReference),s=bEe(this._intersectionHelper,this.startCamera,this._screenPickPoint,r,$C.Silhouette,this.view.map.ground.opacity===0?yT:{});C(s.scenePickPoint)||(this._scenePickPoint=s.scenePickPoint,this._sphere=s.sphere,he(this._beginScenePoint,this._scenePickPoint),this._mode=b8(this.startCamera,this._screenPickPoint,r),this._mode===mo.Vertical&&this._preparePlanarPanMode(e,s.hasGeometryIntersection),(n=this._constraintOptions.interactionStartCamera)==null||n.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1;this._mode===mo.Horizontal?(i&&this._zoomSpherical(e),this._panningSpherical(e),i&&this._rotateSpherical(e)):(i&&this._zoomPlanar(e),this._panningPlanar(e),i&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return this._mode===mo.Horizontal?new nw({view:this.view,momentum:i,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new eE({view:this.view,momentum:i,zoomCenter:this._beginScenePoint});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new Lw({view:this.view,momentum:r,center:this._sphere,axis:this._rotationAxis});if(this._mode===mo.Horizontal){const s=this._panSphericalMomentumEstimator.evaluateMomentum();if(s)return new SF({view:this.view,momentum:s})}else{const s=this._panPlanarMomentumEstimator.evaluateMomentum();if(s)return new r3({view:this.view,momentum:s})}return null}_preparePlanarPanMode(e,i){const r=Pa(this._tmp3d,this.startCamera.viewForward);nI(this._scenePickPoint,r,this._panningPlane);const s=ms(this._screenPickPoint[0],0),n=M(),o=je(this.startCamera.eye);this._adjustedSphere[3]=o<this._sphere[3]?o-100:this._sphere[3],gP(this._adjustedSphere,this.startCamera,s,n);const a=na();this.startCamera.projectToRenderScreen(n,a);const l=M(),c=M(),h=M();be(l,this._scenePickPoint,this.currentCamera.eye);const p=je(l);Oe(l,l);const f=gEe*Math.max(Math.abs(this.view.camera.position.z),yEe),m=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,v8);let y=v(m)?m:f;y=i?Math.min(y,p):y,he(h,ve(c,this.currentCamera.eye,ue(c,l,y))),this._panningPlane[3]=-Ae(this._panningPlane,h),this.startCamera.center=ve(c,this.startCamera.eye,ue(c,this.startCamera.viewForward,y));const _=pm(e.center,this._tmpScreenPointArray);LW(this._panningPlane,this.startCamera,_,this._beginScenePoint)}_zoomSpherical(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),_Ee(this._sphere,this.currentCamera,this._smoothScaling.value),pm(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=mi.ZOOM,this._constraintOptions.interactionFactor=Tp(e.radius-this._beginRadius),Js(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const i=pm(e.center,this._tmpScreenPointArray);gP(this._sphere,this.currentCamera,i,this._tmp3d),UQ(this._beginScenePoint,Ae(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(CEe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(EEe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=mi.PAN,this._constraintOptions.interactionFactor=Tp(Hm(this._screenPickPoint,i)),Js(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){Oe(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||Pa(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value,r=i+$W(e.angle-i),s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(r);const n=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(n,.001*e.timestamp),l1(this.currentCamera,this._sphere,mP(this._rotationAxis,n)),this._constraintOptions.interactionType=mi.TUMBLE,this._constraintOptions.interactionFactor=Tp(e.radius*r),Js(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const i=pm(e.center,this._tmpScreenPointArray);LW(this._panningPlane,this.currentCamera,i,this._tmp3d)&&(wEe(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(i,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=mi.PAN,this._constraintOptions.interactionFactor=Tp(Hm(this._beginScreenPoint,i)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),Js(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),FQ(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=mi.ZOOM,this._constraintOptions.interactionFactor=Tp(e.radius-this._beginRadius),Js(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){he(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||Pa(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value;let r=e.angle-i;r=$W(r);const s=i+r,n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(s);const o=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(o,.001*e.timestamp),l1(this.currentCamera,this._sphere,mP(this._rotationAxis,o)),this._constraintOptions.interactionType=mi.TUMBLE,this._constraintOptions.interactionFactor=Tp(e.radius*o),Js(this.view,this.currentCamera,this._constraintOptions)}};BW=u([I("esri.views.3d.state.controllers.global.PinchAndPanController")],BW);const Wle=Xe(0,0,1),act={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI};let zW=class extends xm{constructor(){super(...arguments),this._rotationValueSmooth=new G5(.05),this._scalingValueSmooth=new G5(.05),this._planeHorizontal=qi(),this._planeVertical=qi(),this._rotationMomentumEstimator=new iCe,this._panMomentumEstimator=new eCe(300,12,.9),this._zoomMomentumEstimator=new rCe,this._beginRadius=0,this._beginCenter=M(),this._beginAngle=0,this._tmpPoints=[],this._panMode=mo.Horizontal,this._beginCenterScreen=ms(),this._tmpCentroid3d=M(),this._tmpCentroid2d=ms(),this._tmp2d=ms(),this._pointerCount=0,this._constraintOptions={selection:kr.ALL,interactionType:mi.NONE,interactionFactor:0,interactionStartCamera:new Ut,interactionDirection:null,tiltMode:vo.TUMBLE}}begin(e){var y;if(!this.active)return;const i=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=i,this._rotationMomentumEstimator.enabled=i,this._panMomentumEstimator.enabled=i,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),pm(e.center,this._beginCenterScreen),bve(Wle,0,this._planeHorizontal);const r=M(),s=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,r,this.view.map.ground.opacity===0?yT:{}),n=M();Pa(n,this.startCamera.viewForward);const o=M();he(o,Wle);const a=Ae(n,o),l=pd(a<0?-a:a);this._panMode=l>=act.ANGLE_THRESHOLD?mo.Horizontal:mo.Vertical;const c=Math.min(gEe,1/Math.abs(Ae(o,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),yEe);lj(this._planeHorizontal,this._planeHorizontal,r),this.startCamera.aboveGround||cj(this._planeHorizontal,this._planeHorizontal);const h=M(),p=M(),f=M();be(h,r,this.currentCamera.eye);const m=je(h);if(Oe(h,h),this._panMode===mo.Vertical){ue(o,o,a),be(this._planeVertical,n,o),Oe(this._planeVertical,this._planeVertical),lj(this._planeVertical,this._planeVertical,r);const _=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,v8);let b=v(_)?_:c;b=s?Math.min(b,m):b,he(f,ve(p,this.currentCamera.eye,ue(p,h,b))),this._planeVertical[3]=-Ae(this._planeVertical,f),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),C9(this._tmpPoints,this._beginCenter)}else{const _=s?m:c;he(f,ve(p,this.currentCamera.eye,ue(p,h,_))),this._planeHorizontal[3]=-Ae(this._planeHorizontal,f),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),C9(this._tmpPoints,this._beginCenter)}(y=this._constraintOptions.interactionStartCamera)==null||y.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1,r=this._panMode===mo.Horizontal?this._planeHorizontal:this._planeVertical,s=this._beginCenter;if(i){const n=this._beginRadius/e.radius,o=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=o,this._scalingValueSmooth.update(n),FQ(this.currentCamera,s,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=mi.ZOOM,this._constraintOptions.interactionFactor=Tp(Math.abs(e.radius-this._beginRadius)),Js(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,r,this.currentCamera,this._tmpPoints),C9(this._tmpPoints,this._tmpCentroid3d),pm(e.center,this._tmpCentroid2d),wEe(this.currentCamera,s,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=mi.PAN,this._constraintOptions.interactionFactor=Tp(Hm(this._beginCenterScreen,this._tmpCentroid2d)),Js(this.view,this.currentCamera,this._constraintOptions),i){const n=this._planeHorizontal,o=s,a=this._rotationValueSmooth.value,l=a+$W(e.angle-a),c=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=c,this._rotationValueSmooth.update(l);const h=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(h,.001*e.timestamp),l1(this.currentCamera,o,mP(n,h)),this._constraintOptions.interactionType=mi.TUMBLE,this._constraintOptions.interactionFactor=Tp(Math.abs(e.radius*h)),Js(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return new eE({view:this.view,momentum:i,zoomCenter:this._beginCenter});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new Lw({view:this.view,momentum:r,center:this._beginCenter,axis:this._planeHorizontal});const s=this._panMomentumEstimator.evaluateMomentum();return s?new r3({view:this.view,momentum:s}):null}_computePlanePoints(e,i,r,s){s.length=e.size;const n=this._tmp2d;let o=0;return e.forEach(a=>{n[0]=a.x,n[1]=a.y,s[o]===void 0&&(s[o]=M()),LW(i,r,n,s[o]),o+=1}),s}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};zW=u([I("esri.views.3d.state.controllers.local.PinchAndPanController")],zW);let Xle=class extends Kr{constructor(e,i,r){super(!0),this._view=e,this.pointerAction=i,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!kQ(e.data,this.pointerAction))return;const i=e.timestamp-this._lastEndTimestamp,r=40,s=this._momentum&&this._momentum.active&&i<r;switch(e.data.action){case"start":case"update":if(s)break;this._controller&&this._controller.active?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,i){if(this._controller&&this._controller.active){this._lastEndTimestamp=e.timestamp;const r=this._controller.end(e.data);i&&r&&(this._momentum=r,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new BW({view:this._view}):new zW({view:this._view})}},lct=class extends Kr{constructor(e,i){super(!0),this.view=e,this.registerIncoming("pointer-down",i,()=>this.view.state.stopActiveCameraController())}},sCe=class extends Kr{constructor(e,i){super(!0),this.key=e,this.registerIncoming("key-down",i,r=>this._handleKeyDown(r))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}},cct=class extends sCe{constructor(e,i,r){super(i,r),this.view=e}activate(){this.view.goTo({heading:0}).catch(()=>{})}},uct=class extends sCe{constructor(e,i,r){super(i,r),this.view=e}activate(){this.view.goTo({tilt:0}).catch(()=>{})}},hct=class extends Kr{constructor(e,i=!1){super(!0),this._view=e,this._invert=i,this.registerIncoming("vertical-two-finger-drag",r=>this._handleTwoFinger(r))}_handleTwoFinger(e){var s,n,o;const i=this._invert?-1:1,r=ms(0,e.data.delta*i);switch(e.data.action){case"begin":(s=this._cameraController)==null||s.end(),this._cameraController=new i3({view:this._view,pivot:Uc.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":(n=this._cameraController)==null||n.update(r);break;case"end":(o=this._cameraController)==null||o.end(),this._cameraController=null}}};function Yle(t){const e=t.native;return e?{buttons:e.buttons.map(i=>i.pressed?i.value?i.value:1:0),axes:e.axes.map(i=>fct(i,t.axisThreshold))}:{buttons:[],axes:[]}}function dct(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let i=0;i<t.axes.length;i++)if(t.axes[i]!==e.axes[i])return!1;for(let i=0;i<t.buttons.length;i++)if(t.buttons[i]!==e.buttons[i])return!1;return!0}function pct(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function fct(t,e){const i=Math.abs(t);return i<e?0:Math.sign(t)*(i-e)/(1-e)}let mct=class{constructor(e,i){this._element=e,this._input=i,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const o=n.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,Yle(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const r="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=r&&s,this.supported&&(this._forEachGamepad(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const i=new DK(e);i.deviceType!=="unknown"&&(this._inputDevices[e.index]=i,this._input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=By({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),i=this._element.contains(document.activeElement),r=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!i;this._forEachGamepad(s=>{const n=this._inputDevices[s.index];if(!n)return;const o=this._latestUpdate[s.index],a=Yle(n),l=r||pct(a);o&&(o.timestamp===s.timestamp||!o.active&&l||dct(o.state,a))||this._emitGamepadEvent(s,a,!l)})}_forEachGamepad(e){const i=window.navigator.getGamepads();for(let r=0;r<i.length;r++){const s=i[r];this._validate(s)&&e(s)}}_emitGamepadEvent(e,i,r){const s=this._latestUpdate[e.index],n=s&&s.active;if(!n&&!r)return;const o=!n&&r?"start":n&&r?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:i,active:r},this._callback&&this._callback({device:this._inputDevices[e.index],state:i,action:o})}_validate(e){if(!e||!e.connected)return!1;for(let i=0;i<e.axes.length;i++)if(isNaN(e.axes[i]))return!1;return!0}};const Zle=de("edge"),gct=de("chrome"),yct=de("ff"),_ct=de("safari"),Jle="esri-view-surface",jT={touchNone:`${Jle}--touch-none`,touchPan:`${Jle}--touch-pan`};let WQ=class nCe{constructor(e,i){this._input=i,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new mct(e,this._input),this._gamepadSource.onEvent=r=>this._callback("gamepad",r)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=Je(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const i in this._active)if(!e||!e.has(i)){const r=this._active[i];this._element.removeEventListener(F9[i],r),delete this._active[i]}e&&e.forEach(i=>{if(!this._active[i]&&F9[i]){const r=(this._eventHandlers[i]||this._handleDefault).bind(this,i);this._element.addEventListener(F9[i],r),this._active[i]=r}}),this._gamepadSource.hasEventListeners=(e==null?void 0:e.has("gamepad"))??!1}setPointerCapture(e,i){i?(this._element.setPointerCapture(e.pointerId),this._activePointerCaptures.add(e.pointerId)):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?jT.touchNone:jT.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?jT.touchPan:jT.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(jT.touchNone),this._element.classList.remove(jT.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,i){const r=GTe(this._element,e);return nCe.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y)),i.x=r.x,i.y=r.y,i}_handleKey(e,i){const r=JKe(i);r&&e==="key-up"&&this._keyDownState.delete(r);const s={native:i,key:r,repeat:!!r&&this._keyDownState.has(r)};r&&e==="key-down"&&this._keyDownState.add(s.key),this._callback(e,s)}_handlePointer(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});this._callback(e,r)}_handlePointerPreventDefault(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});i.preventDefault(),this._callback(e,r)}_handleMouseWheel(e,i){let r=i.deltaY;switch(i.deltaMode){case 0:Zle&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}Zle?r*=.7:gct||_ct?r*=.6:yct&&(r*=1.375);const s=100,n=Math.abs(r);n>s&&(r=r/n*200/(1+Math.exp(-.02*(n-s))));const o=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,deltaY:r});this._callback(e,o)}_handlePointerCaptureLost(e,i){this._activePointerCaptures.delete(i.pointerId),this._handleDefault(e,i)}_handleDefault(e,i){const r={native:i};i.preventDefault(),this._callback(e,r)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};WQ.test={disableSubpixelCoordinates:!1};const F9={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let oCe=class extends Kr{constructor(){super(!0),this.registerIncoming("context-menu",e=>{e.data.native.preventDefault()})}};function XQ(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function vct(t,e){const i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)}function bct(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:Ra()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[T,E]=t,[O,R]=[E.x-T.x,E.y-T.y];return e.radius=Math.sqrt(O*O+R*R)/2,e.center.x=(T.x+E.x)/2,e.center.y=(T.y+E.y)/2,e}let i=0,r=0;for(let T=0;T<t.length;T++)i+=t[T].x,r+=t[T].y;i/=t.length,r/=t.length;const s=t.map(T=>T.x-i),n=t.map(T=>T.y-r);let o=0,a=0,l=0,c=0,h=0,p=0,f=0;for(let T=0;T<s.length;T++){const E=s[T],O=n[T],R=E*E,L=O*O;o+=R,a+=L,l+=E*O,c+=R*E,h+=L*O,p+=E*L,f+=O*R}const m=.5*(c+p),y=.5*(h+f),_=o*a-l*l,b=(m*a-y*l)/_,w=(o*y-l*m)/_,S=Ra(b+i,w+r);return{radius:Math.sqrt(b*b+w*w+(o+a)/t.length),center:S}}function dx(t){const{native:e}=t,{pointerId:i,button:r,pointerType:s}=e;return s==="mouse"?`${i}:${r}`:`${s}`}let aCe=class extends Kr{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,i,r,s){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:i.buttons,timestamp:s,pointers:wct(this._activePointerMap),pointer:i,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(e){const i=e.native.pointerId,r=ML(this._activePointerMap).angle,s={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(i,s);const n=EF(s,lCe(this._activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(r)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const i=e.native.pointerId,r=this._activePointerMap.get(i);r?r.event=e:this._addPointer(e)}_removePointer(e){const i=ML(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(i)}_updatePointerAngles(e){const i=ML(this._activePointerMap);this._activePointerMap.forEach(r=>{r.initialAngle=EF(r,i)-e,r.lastAngle=EF(r,i)-e})}_emitEvent(e,i,r){const s=ML(this._activePointerMap);this._drag.emit(this._createPayload(e,i,s,r),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const i=e.data.native.pointerId,r=e.timestamp;this._activePointerMap.get(i)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,r),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const i=e.data,r=i.currentEvent,s=e.timestamp;switch(i.action){case"start":case"update":this._isDragging?this._activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this._isCurrentDragSuppressed&&this._emitEvent("update",r,s)):(this._addPointer(r),this._emitEvent("added",r,s),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(r),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",r,s))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function lCe(t){const e=[];return t.forEach(i=>{e.push(Ra(i.event.x,i.event.y))}),bct(e)}function ML(t){const e=lCe(t);let i=0;return t.forEach(r=>{let s=EF(r,e),n=s-r.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=r.lastAngle+n,r.lastAngle=s;const o=s-r.initialAngle;i+=o}),i/=t.size||1,{angle:i,radius:e.radius,center:e.center}}function wct(t){const e=new Map;return t.forEach((i,r)=>e.set(r,i.event)),e}function EF(t,e){const i=t.event,r=i.x-e.center.x,s=i.y-e.center.y;return Math.atan2(s,r)}var Kle;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(Kle||(Kle={}));const sd={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};let cCe=class extends Kr{constructor(e=sd.maximumDoubleClickDelay,i=sd.maximumDoubleClickDistance,r=sd.maximumDoubleTouchDelay,s=sd.maximumDoubleTouchDistance,n=jP){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=Rr(e.doubleClickTimer))}get hasPendingInputs(){return Vo(this._pointerState,e=>e.doubleClickTimer!=null)}_clearDoubleClickTimer(e,i){const r=this._pointerState.get(e);r&&(r.doubleClickTimer=Rr(r.doubleClickTimer),i&&this._click.emit(r.event.data,void 0,r.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const i=this._pointerState.get(e);i.pointerDownCount===1&&this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_getPointerId(e){const{pointerId:i,pointerType:r,button:s}=e.native;return r==="mouse"?`${i}:${s}`:`${r}`}_handleImmediateClick(e){const i=e.data,{pointerType:r}=i.native,s=this._getPointerId(i);if(!this._pointerState.has(s))return void this._startClick(e);const n=this._pointerState.get(s),{data:o,modifiers:a}=n.event,l=r==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;XQ(o,i)>l?(this._clearDoubleClickTimer(s,!0),this._startClick(e)):(this._clearDoubleClickTimer(s,!1),n.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(e){const i=dx(e.data),r=this._pointerState.get(i);r&&(r.pointerDownCount+=1)}_startClick(e){const{data:i}=e,{native:{pointerType:r}}=i,s=dx(i),n=r==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(s),n),a=1;this._pointerState.set(s,{event:e,doubleClickTimer:o,pointerDownCount:a}),this.refreshHasPendingInputs()}},uCe=class extends Kr{constructor(e=sd.maximumDoubleClickDelay,i=sd.maximumDoubleClickDistance,r=sd.maximumDoubleTouchDelay,s=sd.maximumDoubleTouchDistance,n=jP){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=dx(i);if(!this._pointerState.has(r)){const s={downButton:i.native.button,immediateDoubleClick:null};this._pointerState.set(r,s),this.startCapturingPointer(i.native)}}_handlePointerUp(e){const i=e.data,r=dx(i),s=this._pointerState.get(r);if(s&&s.downButton===i.native.button){const n=s.immediateDoubleClick;if(n){n.timeoutHandle.remove();const o=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;XQ(n,e.data)>o?this._startImmediateDoubleClick(e,s):(this._immediateDoubleClick.emit(e.data,void 0,n.modifiers),this._removeState(i))}else this._startImmediateDoubleClick(e,s)}}_startImmediateDoubleClick(e,i){const r=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;i.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),r)}}_removeState(e){const i=dx(e);this._pointerState.delete(i),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}};const cO={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};let hCe=class extends Kr{constructor(e=cO.maximumClickDelay,i=cO.movementUntilMouseDrag,r=cO.movementUntilPenDrag,s=cO.movementUntilTouchDrag,n=cO.holdDelay,o=jP){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=i,this._movementUntilPenDrag=r,this._movementUntilTouchDrag=s,this._holdDelay=n,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=Rr(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=i.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const o=this._pointerState.get(r);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,e.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const n={startEvent:i,previousEvent:i,startTimestamp:e.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(r,n),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_createPointerDragData(e,i,r){return{action:e,startEvent:i.startEvent,previousEvent:i.previousEvent,currentEvent:r}}_handlePointerMove(e){const i=e.data,r=i.native.pointerId,s=this._pointerState.get(r);s&&(s.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",s,i),void 0,s.modifiers):vct(i,s.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(e),s.previousEvent=i)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const i=e.data,r=i.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=e.modifiers,s.isDragging=!0,r===s.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",s,i)):this._pointerDrag.emit(this._createPointerDragData("start",s,s.previousEvent),e.timestamp))})}_handlePointerLoss(e,i){const r=e.data,s=r.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",n,i==="pointer-up"?r:n.previousEvent),void 0,n.modifiers):i==="pointer-up"&&n.downButton===r.native.button&&e.timestamp-n.startTimestamp<=this._maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(s),this.stopCapturingPointer(r.native),this._pointerState.size===0&&this._moveHandle.pause())}},RI=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const i=e.data,r=i.pointers.size;switch(i.action){case"start":this._currentCount=r,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){var i,r;this._startEvent=e,(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){var i,r;(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){var i,r;(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},xct=class extends Kr{constructor(e=20,i=40){super(!1),this._threshold=e,this._maxDelta=i,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new RI({start:(r,s)=>this._observeStart(r,s),update:(r,s,n)=>this._observeUpdate(r,s,n),end:(r,s)=>this._observeEnd(s)}),this.registerIncoming("drag",r=>this._dragEventSeparator.handle(r))}get failed(){return this._state==="failed"}_observeStart(e,i){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),i.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,i,r){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void i.stopPropagation()):void(this._checkMovementWithinLimits(i.data,r.data)?this._checkVerticalThresholdReached(i.data,r.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=i.data.center,this._artificalDrag.emit({action:"end",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),i.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,i){let r=-1/0,s=1/0,n=-1/0,o=1/0;for(const{x:_,y:b}of i.pointers.values())r=Math.max(r,_),s=Math.min(s,_),n=Math.max(n,b),o=Math.min(o,b);let a=-1/0,l=1/0,c=-1/0,h=1/0;for(const{x:_,y:b}of e.pointers.values())a=Math.max(a,_),l=Math.min(l,_),c=Math.max(c,b),h=Math.min(h,b);const p=r-s,f=n-o,m=a-l,y=c-h;return Math.abs(e.center.x-i.center.x)<this._threshold&&Math.abs(m-p)<=this._maxDelta&&Math.abs(y-f)<=this._maxDelta}_checkVerticalThresholdReached(e,i){let r=Math.abs(e.center.y-i.center.y);return e.pointers.forEach((s,n)=>{const o=i.pointers.get(n);r=Math.min(r,Math.abs(s.y-o.y))}),r>=this._threshold}},np=class extends $e{constructor(){super(...arguments),this._handles=new Ki}destroy(){this._handles=Je(this._handles),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get hasPendingInputs(){var e;return!!((e=this._inputManager)!=null&&e.hasPendingInputs)}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}get multiTouchActive(){var e;return((e=this._inputManager)==null?void 0:e.multiTouchActive)??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=Je(this._inputManager)}connect(){const e=this.view;this._source=new WQ(this.view.surface,e.input);const i=[new uCe,new hCe,new cCe,new aCe(this.view.navigation),new xct],r=new hp({eventSource:this._source,recognizers:i});this._inputManager=r,r.installHandlers("prevent-context-menu",[new oCe],Pm.INTERNAL),this._modeDragPan=new Xle(e,"primary"),this._modeDragRotate=new N9(e,"secondary",Uc.CENTER),this._modeDragZoom=new jlt(e,"tertiary");const s={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};r.installHandlers("navigation",[new lct(e),new Vat(e),new Qlt(e),new ect(e,s.pan),new tct(e),new uct(e,s.resetTilt),new cct(e,s.resetHeading),new N9(e,"primary",Uc.EYE,[s.lookAround]),new N9(e,"secondary",Uc.CENTER,[s.lookAround]),new Xle(e,"tertiary",[s.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new hct(e)],Pm.INTERNAL),this.view.viewEvents.connect(r),this._updateMode(),this._handles.add(re(()=>{var n;return(n=this.view.navigation)==null?void 0:n.browserTouchPanEnabled},n=>{this._source.browserTouchPanningEnabled=!n},Zt))}_updateMode(){var s;const e=this.mode,i=this.primaryDragAction,r=(s=GW.get(e))==null?void 0:s.get(i);r&&(this._modeDragPan&&(this._modeDragPan.pointerAction=r.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=r.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=r.zoom))}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};u([d()],np.prototype,"view",void 0),u([d({value:"pan"})],np.prototype,"primaryDragAction",null),u([d({value:"default"})],np.prototype,"mode",null),u([d({readOnly:!0})],np.prototype,"hasPendingInputs",null),u([d()],np.prototype,"latestPointerType",null),u([d()],np.prototype,"latestPointerLocation",null),u([d()],np.prototype,"multiTouchActive",null),u([d()],np.prototype,"_inputManager",void 0),np=u([I("esri.views.3d.input.SceneInputManager")],np);const GW=new Map,U9=new Map,V9=new Map;U9.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),U9.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),V9.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),V9.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),GW.set("default",U9),GW.set("pro",V9);const Tct=np;let Du,NE,jW=!1,HW=!1,qW=!1,WW=!1,s3=null;function Sct(t,e){if(!HW||!NE)return;dCe();const i=NE;let r=0;for(let s=0;s<t.accBinsNumX;s++)for(let n=0;n<t.accBinsNumY;n++){const o=t.accBins[s][t.accBinsNumY-1-n];r+=o.length;const a=s*t.accBinsSizeX,l=(s+1)*t.accBinsSizeX,c=n*t.accBinsSizeY,h=(n+1)*t.accBinsSizeY;i.fillText(o.length.toFixed(),a+5,c+15),pCe(a,l,c,h,"blue")}i.fillText("total totalShownLabels: "+r,70,40),i.fillText("total visible labels: "+e.size,70,50),i.fillText("total numTests: "+t.accNumTests,70,30)}function Ect(t){qW=Ji.DECONFLICTOR_SHOW_VISIBLE,WW=Ji.DECONFLICTOR_SHOW_INVISIBLE,jW=qW||WW,HW=Ji.DECONFLICTOR_SHOW_GRID,s3=null,jW||HW?s3=()=>Cct(t):Du&&(Du.parentElement.removeChild(Du),Du=null)}function dCe(){s3&&(s3(),s3=null)}function Cct(t){Du==null&&(Du=document.createElement("canvas"),Du.setAttribute("id","canvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(Du));const{state:e}=t,{camera:i,pixelRatio:r}=e,{width:s,height:n}=i,o=s*r,a=n*r;Du.setAttribute("width",`${o}px`),Du.setAttribute("height",`${a}px`),Du.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),NE=Du.getContext("2d"),NE.clearRect(0,0,s,n),NE.font="12px Arial"}function pCe(t,e,i,r,s){dCe();const n=Du.height,o=NE;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(t,n-i),o.lineTo(e,n-i),o.stroke(),o.lineTo(e,n-r),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.closePath()}function Act(t,e){jW&&(e&&qW||!e&&WW)&&pCe(t.aabr[0],t.aabr[2],t.aabr[1],t.aabr[3],e?"green":"red")}var Fo,jc;(function(t){t[t.GRAPHIC=0]="GRAPHIC",t[t.LABEL=1]="LABEL",t[t._COUNT=2]="_COUNT"})(Fo||(Fo={})),function(t){t[t.USER_SETTING=0]="USER_SETTING",t[t.SCALE_RANGE=1]="SCALE_RANGE",t[t.FILTER=2]="FILTER",t[t.DECONFLICTION=3]="DECONFLICTION",t[t._COUNT=4]="_COUNT"}(jc||(jc={}));function fCe(t,e){return new _Ce(t,bCe,e)}function Oct(t,e){const{curvatureDependent:i,scaleStart:r,scaleFallOffRange:s}=bCe;return new _Ce(t,{curvatureDependent:{min:{curvature:i.min.curvature,tiltAngle:i.min.tiltAngle,scaleFallOffFactor:k9.curvatureDependent.min.scaleFallOffFactor},max:{curvature:i.max.curvature,tiltAngle:i.max.tiltAngle,scaleFallOffFactor:k9.curvatureDependent.max.scaleFallOffFactor}},scaleStart:r,scaleFallOffRange:s,minPixelSize:k9.minPixelSize},e)}function Rct(t){return Math.abs(t*t*t)}function mCe(t,e,i){const r=i.parameters,s=i.paddingPixelsOverride;return uO.scale=Math.min(r.divisor/(e-r.offset),1),uO.factor=Rct(t),uO.minPixelSize=r.minPixelSize,uO.paddingPixels=s,uO}function gCe(t,e){return t===0?e.minPixelSize:e.minPixelSize*(1+2*e.paddingPixels/t)}function YQ(t,e){return Math.max(Yt(t*e.scale,t,e.factor),gCe(t,e))}function Mct(t,e,i){const r=mCe(t,e,i);return r.minPixelSize=0,r.paddingPixels=0,YQ(1,r)}function Qle(t,e,i,r){r.scale=Mct(t,e,i),r.factor=0,r.minPixelSize=i.parameters.minPixelSize,r.paddingPixels=i.paddingPixelsOverride}function yCe(t,e,i=[0,0]){const r=Math.min(Math.max(e.scale,gCe(t[1],e)/Math.max(1e-5,t[1])),1);return i[0]=t[0]*r,i[1]=t[1]*r,i}function Pct(t,e,i,r){return YQ(t,mCe(e,i,r))}let _Ce=class vCe{get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}constructor(e,i,r,s=Ict(),n){this._viewingMode=e,this._description=i,this._ellipsoidRadius=r,this.parameters=s,this._paddingPixelsOverride=n,this._viewingMode===st.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overridePadding(e){return e!==this.paddingPixelsOverride?new vCe(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,i,r){const{scaleStart:s,scaleFallOffRange:n,minPixelSize:o}=this._description,{fovY:a,distance:l}=e,c=this._calculateCurvatureDependentParameters(e,i),h=this._coverageCompensation(e,i,c),{tiltAngle:p,scaleFallOffFactor:f}=c,m=Math.sin(p)*l,y=.5*Math.PI-p-a*(.5-s*h),_=m/Math.cos(y),b=y+a*n*h,w=(_-f*(m/Math.cos(b)))/(1-f);return r.camera.fovY=e.fovY,r.camera.distance=e.distance,r.offset=w,r.divisor=_-w,r.minPixelSize=o,r}_calculateCurvatureDependentParametersLocal(e,i,r=ece){return r.tiltAngle=this._description.curvatureDependent.min.tiltAngle,r.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,r}_calculateCurvatureDependentParametersGlobal(e,i,r=ece){const s=this._description.curvatureDependent,n=1+e.distance/i,o=Math.sqrt(n*n-1),[a,l]=[s.min.curvature,s.max.curvature],c=we((o-a)/(l-a),0,1),[h,p]=[s.min,s.max];return r.tiltAngle=Yt(h.tiltAngle,p.tiltAngle,c),r.scaleFallOffFactor=Yt(h.scaleFallOffFactor,p.scaleFallOffFactor,c),r}_surfaceCoverageCompensationLocal(e,i,r){return(e.fovY-r.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,i,r){const s=i*i,n=r.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=e,l=a*a+s-2*Math.cos(n)*a*i,c=Math.sqrt(l),h=Math.sqrt(l-s);return(Math.acos(h/c)-Math.asin(i/(c/Math.sin(n)))+.5*o)/o}};const bCe={curvatureDependent:{min:{curvature:ii(10),tiltAngle:ii(12),scaleFallOffFactor:.5},max:{curvature:ii(70),tiltAngle:ii(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},k9={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function Ict(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const uO={scale:0,factor:0,minPixelSize:0,paddingPixels:0},ece={tiltAngle:0,scaleFallOffFactor:0};function $ct(t){return t instanceof Float32Array&&t.length>=16}function Lct(t){return Array.isArray(t)&&t.length>=16}function Dct(t){return $ct(t)||Lct(t)}function ZQ(t){t.vertex.code.add(x`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),t.vertex.code.add(x`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(x`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),t.vertex.code.add(x`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),t.vertex.code.add(x`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(x`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),t.vertex.code.add(x`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function Nct(t){t.uniforms.add(new Si("screenSizePerspective",e=>wCe(e.screenSizePerspective)))}function E8(t){t.uniforms.add(new Si("screenSizePerspectiveAlignment",e=>wCe(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function wCe(t){return nr(Fct,t.parameters.divisor,t.parameters.offset,t.parameters.minPixelSize,t.paddingPixelsOverride)}const Fct=fi();let xCe=class extends Os{constructor(e,i){super(e,"mat4",gr.Draw,(r,s,n)=>r.setUniformMatrix4fv(e,i(s,n)))}};function rf(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",Ma):t.uniforms.add(new Ku("cameraPosition",(i,r)=>fe(TCe,r.camera.viewInverseTransposeMatrix[3]-i.origin[0],r.camera.viewInverseTransposeMatrix[7]-i.origin[1],r.camera.viewInverseTransposeMatrix[11]-i.origin[2])))}function Kc(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add([new Jr("proj",(r,s)=>s.camera.projectionMatrix),new xCe("view",(r,s)=>hc(tce,s.camera.viewMatrix,r.origin)),new Ku("localOrigin",r=>r.origin)]);const i=r=>fe(TCe,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]);t.uniforms.add([new Jr("proj",(r,s)=>s.camera.projectionMatrix),new Jr("view",(r,s)=>hc(tce,s.camera.viewMatrix,i(s))),new ni("localOrigin",(r,s)=>i(s))])}const tce=hI(),TCe=M();function DC(t){t.uniforms.add(new Jr("viewNormal",(e,i)=>i.camera.viewInverseTransposeMatrix))}function SCe(t,e){const i=t.vertex;e.hasVerticalOffset?(ECe(i),e.hasScreenSizePerspective&&(t.include(ZQ),E8(i),rf(t.vertex,e)),i.code.add(x`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?x`vec3 worldNormal = normalize(worldPos + localOrigin);`:x`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?x`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:x`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):i.code.add(x`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const Uct=fi();function ECe(t){t.uniforms.add(new Si("verticalOffset",(e,i)=>{const{minWorldLength:r,maxWorldLength:s,screenLength:n}=e.verticalOffset,o=Math.tan(.5*i.camera.fovY)/(.5*i.camera.fullViewport[3]),a=i.camera.pixelRatio||1;return nr(Uct,n*a,o,r,s)}))}var Pu;(function(t){t[t.Occluded=0]="Occluded",t[t.NotOccluded=1]="NotOccluded",t[t.Both=2]="Both",t[t.COUNT=3]="COUNT"})(Pu||(Pu={}));var ic;function CCe(t,e){t.include(ZQ),t.attributes.add(A.POSITION,"vec3"),t.attributes.add(A.NORMAL,"vec3"),t.attributes.add(A.AUXPOS1,"vec4");const i=t.vertex;Kc(i,e),rf(i,e),i.uniforms.add([new Si("viewport",(r,s)=>s.camera.fullViewport),new He("polygonOffset",r=>r.shaderPolygonOffset),new He("cameraGroundRelative",(r,s)=>s.camera.aboveGround?1:-1),new He("renderTransparentlyOccludedHUD",(r,s)=>s.renderTransparentlyOccludedHUD===Pu.Occluded?1:s.renderTransparentlyOccludedHUD===Pu.NotOccluded?0:.75),new zt("hudVisibilityTexture",(r,s)=>s.hudVisibilityTexture)]),e.hasVerticalOffset&&ECe(i),i.constants.add("smallOffsetAngle","float",.984807753012208),i.code.add(x`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.code.add(x`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),e.isDraped&&!e.hasVerticalOffset||DC(i),e.isDraped||(i.uniforms.add(new He("perDistancePixelRatio",(r,s)=>Math.tan(s.camera.fovY/2)/(s.camera.fullViewport[2]/2))),i.code.add(x`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),e.screenCenterOffsetUnitsEnabled===ic.Screen&&i.uniforms.add(new He("pixelRatio",(r,s)=>s.camera.pixelRatio)),e.hasScreenSizePerspective&&E8(i),i.code.add(x`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled===ic.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?x`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled!==ic.Screen?x`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled===ic.Screen?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled===ic.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),i.code.add(x`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(function(t){t[t.World=0]="World",t[t.Screen=1]="Screen",t[t.COUNT=2]="COUNT"})(ic||(ic={}));const PL=Nn();function ACe(t,e,i,r,s,n){if(t.visible)if(t.boundingInfo){Ct(t.type===Vs.Mesh);const o=e.tolerance;OCe(t.boundingInfo,i,r,o,s,n)}else{const o=t.indices.get(A.POSITION),a=t.vertexAttributes.get(A.POSITION);MI(i,r,0,o.length/3,o,a,void 0,s,n)}}const Vct=M();function OCe(t,e,i,r,s,n){if(C(t))return;const o=MCe(e,i,Vct);if(Qye(PL,t.bbMin),e0e(PL,t.bbMax),v(s)&&s.applyToAabb(PL),KQ(PL,e,o,r)){const{primitiveIndices:a,indices:l,position:c}=t,h=a?a.length:l.length/3;if(h>Gct){const p=t.getChildren();if(p!==void 0){for(const f of p)OCe(f,e,i,r,s,n);return}}MI(e,i,0,h,l,c,a,s,n)}}const RCe=M();function MI(t,e,i,r,s,n,o,a,l){if(o)return kct(t,e,i,r,s,n,o,a,l);const{data:c,stride:h}=n,p=t[0],f=t[1],m=t[2],y=e[0]-p,_=e[1]-f,b=e[2]-m;for(let w=i,S=3*i;w<r;++w){let T=h*s[S++],E=c[T++],O=c[T++],R=c[T];T=h*s[S++];let L=c[T++],P=c[T++],F=c[T];T=h*s[S++];let V=c[T++],B=c[T++],G=c[T];v(a)&&([E,O,R]=a.applyToVertex(E,O,R,w),[L,P,F]=a.applyToVertex(L,P,F,w),[V,B,G]=a.applyToVertex(V,B,G,w));const te=L-E,se=P-O,ie=F-R,H=V-E,$=B-O,N=G-R,U=_*N-$*b,q=b*H-N*y,Y=y*$-H*_,Q=te*U+se*q+ie*Y;if(Math.abs(Q)<=Number.EPSILON)continue;const X=p-E,pe=f-O,ye=m-R,xe=X*U+pe*q+ye*Y;if(Q>0){if(xe<0||xe>Q)continue}else if(xe>0||xe<Q)continue;const De=pe*ie-se*ye,rt=ye*te-ie*X,qe=X*se-te*pe,Pe=y*De+_*rt+b*qe;if(Q>0){if(Pe<0||xe+Pe>Q)continue}else if(Pe>0||xe+Pe<Q)continue;const Ye=(H*De+$*rt+N*qe)/Q;Ye>=0&&l(Ye,JQ(te,se,ie,H,$,N,RCe),w,!1)}}function kct(t,e,i,r,s,n,o,a,l){const{data:c,stride:h}=n,p=t[0],f=t[1],m=t[2],y=e[0]-p,_=e[1]-f,b=e[2]-m;for(let w=i;w<r;++w){const S=o[w];let T=3*S,E=h*s[T++],O=c[E++],R=c[E++],L=c[E];E=h*s[T++];let P=c[E++],F=c[E++],V=c[E];E=h*s[T];let B=c[E++],G=c[E++],te=c[E];v(a)&&([O,R,L]=a.applyToVertex(O,R,L,w),[P,F,V]=a.applyToVertex(P,F,V,w),[B,G,te]=a.applyToVertex(B,G,te,w));const se=P-O,ie=F-R,H=V-L,$=B-O,N=G-R,U=te-L,q=_*U-N*b,Y=b*$-U*y,Q=y*N-$*_,X=se*q+ie*Y+H*Q;if(Math.abs(X)<=Number.EPSILON)continue;const pe=p-O,ye=f-R,xe=m-L,De=pe*q+ye*Y+xe*Q;if(X>0){if(De<0||De>X)continue}else if(De>0||De<X)continue;const rt=ye*H-ie*xe,qe=xe*se-H*pe,Pe=pe*ie-se*ye,Ye=y*rt+_*qe+b*Pe;if(X>0){if(Ye<0||De+Ye>X)continue}else if(Ye>0||De+Ye<X)continue;const j=($*rt+N*qe+U*Pe)/X;j>=0&&l(j,JQ(se,ie,H,$,N,U,RCe),S,!1)}}const ice=M(),rce=M();function JQ(t,e,i,r,s,n,o){return fe(ice,t,e,i),fe(rce,r,s,n),Et(o,ice,rce),Oe(o,o),o}function MCe(t,e,i){return fe(i,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function KQ(t,e,i,r){return QQ(t,e,i,r,1/0)}function QQ(t,e,i,r,s){const n=(t[0]-r-e[0])*i[0],o=(t[3]+r-e[0])*i[0];let a=Math.min(n,o),l=Math.max(n,o);const c=(t[1]-r-e[1])*i[1],h=(t[4]+r-e[1])*i[1];if(l=Math.min(l,Math.max(c,h)),l<0||(a=Math.max(a,Math.min(c,h)),a>l))return!1;const p=(t[2]-r-e[2])*i[2],f=(t[5]+r-e[2])*i[2];return l=Math.min(l,Math.max(p,f)),!(l<0)&&(a=Math.max(a,Math.min(p,f)),!(a>l)&&a<s)}function PCe(t,e,i,r,s){let n=(i.screenLength||0)*t.pixelRatio;v(s)&&(n=Pct(n,r,e,s));const o=n*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return we(o*e,i.minWorldLength||0,i.maxWorldLength!=null?i.maxWorldLength:1/0)}function ICe(t,e){const i=e?ICe(e):{};for(const r in t){let s=t[r];s&&s.forEach&&(s=zct(s)),s==null&&r in i||(i[r]=s)}return i}function Bct(t,e){let i=!1;for(const r in e){const s=e[r];s!==void 0&&(Array.isArray(s)?t[r]===null?(t[r]=s.slice(),i=!0):AY(t[r],s)&&(i=!0):t[r]!==s&&(i=!0,t[r]=s))}return i}function zct(t){const e=[];return t.forEach(i=>e.push(i)),e}const $Ce={multiply:1,ignore:2,replace:3,tint:4},Gct=1e3;let x1=class extends EI{constructor(e,i){super(),this.type=Vs.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=Li,this._pp0=Xe(0,0,1),this._pp1=Xe(0,0,0),this._parameters=ICe(e,i),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(e){return!1}setParameters(e,i=!0){Bct(this._parameters,e)&&(this.validateParameters(this._parameters),i&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleForOutput(e.output)&&(this.renderOccluded&e.renderOccludedMask)!=0}isVisibleForOutput(e){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){v(this.repository)&&this.repository.materialChanged(this)}intersectDraped(e,i,r,s,n,o){return this._pp0[0]=this._pp1[0]=s[0],this._pp0[1]=this._pp1[1]=s[1],this.intersect(e,i,r,this._pp0,this._pp1,n)}},LCe=class extends cst{constructor(e,i,r){super(i,r),this.camera=e}};var ps;(function(t){t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(ps||(ps={}));let TA=class extends yr{constructor(){super(...arguments),this.renderOccluded=ps.Occlude}},DCe=class{constructor(){this.factor=new sce,this.factorAlignment=new sce}},sce=class{constructor(){this.scale=0,this.factor=0,this.minPixelSize=0,this.paddingPixels=0}};function i4t(t,e,i,r,s=1){const n=i.typedBuffer,o=i.typedBufferStride,a=t.length;if(r*=o,s===1)for(let l=0;l<a;++l)n[r]=e[t[l]],r+=o;else for(let l=0;l<a;++l){const c=e[t[l]];for(let h=0;h<s;h++)n[r]=c,r+=o}}function jct(t,e,i,r){const s=i.typedBuffer,n=i.typedBufferStride,o=t.length;r*=n;for(let a=0;a<o;++a){const l=2*t[a];s[r]=e[l],s[r+1]=e[l+1],r+=n}}function NCe(t,e,i,r,s){const n=i.typedBuffer,o=i.typedBufferStride,a=t.length;if(r*=o,s==null||s===1)for(let l=0;l<a;++l){const c=3*t[l];n[r]=e[c],n[r+1]=e[c+1],n[r+2]=e[c+2],r+=o}else for(let l=0;l<a;++l){const c=3*t[l];for(let h=0;h<s;++h)n[r]=e[c],n[r+1]=e[c+1],n[r+2]=e[c+2],r+=o}}function NC(t,e,i,r,s=1){const n=i.typedBuffer,o=i.typedBufferStride,a=t.length;if(r*=o,s===1)for(let l=0;l<a;++l){const c=4*t[l];n[r]=e[c],n[r+1]=e[c+1],n[r+2]=e[c+2],n[r+3]=e[c+3],r+=o}else for(let l=0;l<a;++l){const c=4*t[l];for(let h=0;h<s;++h)n[r]=e[c],n[r+1]=e[c+1],n[r+2]=e[c+2],n[r+3]=e[c+3],r+=o}}function nce(t,e,i){const r=t.typedBuffer,s=t.typedBufferStride;e*=s;for(let n=0;n<i;++n)r[e]=0,r[e+1]=0,r[e+2]=0,r[e+3]=0,e+=s}function C8(t,e,i,r,s,n=1){if(!i)return void NCe(t,e,r,s,n);const o=r.typedBuffer,a=r.typedBufferStride,l=t.length,c=i[0],h=i[1],p=i[2],f=i[4],m=i[5],y=i[6],_=i[8],b=i[9],w=i[10],S=i[12],T=i[13],E=i[14];s*=a;let O=0,R=0,L=0;const P=_U(i)?F=>{O=e[F]+S,R=e[F+1]+T,L=e[F+2]+E}:F=>{const V=e[F],B=e[F+1],G=e[F+2];O=c*V+f*B+_*G+S,R=h*V+m*B+b*G+T,L=p*V+y*B+w*G+E};if(n===1)for(let F=0;F<l;++F)P(3*t[F]),o[s]=O,o[s+1]=R,o[s+2]=L,s+=a;else for(let F=0;F<l;++F){P(3*t[F]);for(let V=0;V<n;++V)o[s]=O,o[s+1]=R,o[s+2]=L,s+=a}}function eee(t,e,i,r,s,n=1){if(!i)return void NCe(t,e,r,s,n);const o=i,a=r.typedBuffer,l=r.typedBufferStride,c=t.length,h=o[0],p=o[1],f=o[2],m=o[4],y=o[5],_=o[6],b=o[8],w=o[9],S=o[10],T=!eJ(o),E=1e-6,O=1-E;s*=l;let R=0,L=0,P=0;const F=_U(o)?V=>{R=e[V],L=e[V+1],P=e[V+2]}:V=>{const B=e[V],G=e[V+1],te=e[V+2];R=h*B+m*G+b*te,L=p*B+y*G+w*te,P=f*B+_*G+S*te};if(n===1)if(T)for(let V=0;V<c;++V){F(3*t[V]);const B=R*R+L*L+P*P;if(B<O&&B>E){const G=1/Math.sqrt(B);a[s]=R*G,a[s+1]=L*G,a[s+2]=P*G}else a[s]=R,a[s+1]=L,a[s+2]=P;s+=l}else for(let V=0;V<c;++V)F(3*t[V]),a[s]=R,a[s+1]=L,a[s+2]=P,s+=l;else for(let V=0;V<c;++V){if(F(3*t[V]),T){const B=R*R+L*L+P*P;if(B<O&&B>E){const G=1/Math.sqrt(B);R*=G,L*=G,P*=G}}for(let B=0;B<n;++B)a[s]=R,a[s+1]=L,a[s+2]=P,s+=l}}function Hct(t,e,i,r,s,n=1){if(!i)return void NC(t,e,r,s,n);const o=i,a=r.typedBuffer,l=r.typedBufferStride,c=t.length,h=o[0],p=o[1],f=o[2],m=o[4],y=o[5],_=o[6],b=o[8],w=o[9],S=o[10],T=!eJ(o),E=1e-6,O=1-E;if(s*=l,n===1)for(let R=0;R<c;++R){const L=4*t[R],P=e[L],F=e[L+1],V=e[L+2],B=e[L+3];let G=h*P+m*F+b*V,te=p*P+y*F+w*V,se=f*P+_*F+S*V;if(T){const ie=G*G+te*te+se*se;if(ie<O&&ie>E){const H=1/Math.sqrt(ie);G*=H,te*=H,se*=H}}a[s]=G,a[s+1]=te,a[s+2]=se,a[s+3]=B,s+=l}else for(let R=0;R<c;++R){const L=4*t[R],P=e[L],F=e[L+1],V=e[L+2],B=e[L+3];let G=h*P+m*F+b*V,te=p*P+y*F+w*V,se=f*P+_*F+S*V;if(T){const ie=G*G+te*te+se*se;if(ie<O&&ie>E){const H=1/Math.sqrt(ie);G*=H,te*=H,se*=H}}for(let ie=0;ie<n;++ie)a[s]=G,a[s+1]=te,a[s+2]=se,a[s+3]=B,s+=l}}function tee(t,e,i,r,s,n=1){const o=r.typedBuffer,a=r.typedBufferStride,l=t.length;if(s*=a,i!==e.length||i!==4)if(n!==1)if(i!==4)for(let c=0;c<l;++c){const h=3*t[c];for(let p=0;p<n;++p)o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=255,s+=a}else for(let c=0;c<l;++c){const h=4*t[c];for(let p=0;p<n;++p)o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=e[h+3],s+=a}else{if(i===4){for(let c=0;c<l;++c){const h=4*t[c];o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=e[h+3],s+=a}return}for(let c=0;c<l;++c){const h=3*t[c];o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=255,s+=a}}else{o[s]=e[0],o[s+1]=e[1],o[s+2]=e[2],o[s+3]=e[3];const c=new Uint32Array(r.typedBuffer.buffer,r.start),h=a/4,p=c[s/=4];s+=h;const f=l*n;for(let m=1;m<f;++m)c[s]=p,s+=h}}function FCe(t,e,i,r,s=1){const n=e.typedBuffer,o=e.typedBufferStride;if(r*=o,s===1)for(let a=0;a<i;++a)n[r]=t[0],n[r+1]=t[1],n[r+2]=t[2],n[r+3]=t[3],r+=o;else for(let a=0;a<i;++a)for(let l=0;l<s;++l)n[r]=t[0],n[r+1]=t[1],n[r+2]=t[2],n[r+3]=t[3],r+=o}function UCe(t,e,i,r,s,n){for(const o of e.fieldNames){const a=t.vertexAttributes.get(o),l=t.indices.get(o);if(a&&l)switch(o){case A.POSITION:{Ct(a.size===3);const c=s.getField(o,Lr);Ct(!!c,`No buffer view for ${o}`),c&&C8(l,a.data,i,c,n);break}case A.NORMAL:{Ct(a.size===3);const c=s.getField(o,Lr);Ct(!!c,`No buffer view for ${o}`),c&&eee(l,a.data,r,c,n);break}case A.UV0:{Ct(a.size===2);const c=s.getField(o,m0);Ct(!!c,`No buffer view for ${o}`),c&&jct(l,a.data,c,n);break}case A.COLOR:case A.SYMBOLCOLOR:{Ct(a.size===3||a.size===4);const c=s.getField(o,Na);Ct(!!c,`No buffer view for ${o}`),c&&tee(l,a.data,a.size,c,n);break}case A.TANGENT:{Ct(a.size===4);const c=s.getField(o,iu);Ct(!!c,`No buffer view for ${o}`),c&&Hct(l,a.data,r,c,n);break}case A.PROFILERIGHT:case A.PROFILEUP:case A.PROFILEVERTEXANDNORMAL:case A.FEATUREVALUE:{Ct(a.size===4);const c=s.getField(o,iu);Ct(!!c,`No buffer view for ${o}`),c&&NC(l,a.data,c,n)}}else if(o===A.OBJECTANDLAYERIDCOLOR&&v(t.objectAndLayerIdColor)){const c=t.indices.get(A.POSITION);if(Ct(!!c,`No buffer view for ${o}`),c){const h=c.length,p=s.getField(o,Na);FCe(t.objectAndLayerIdColor,p,h,n)}}}}function _P(t,e,i=0){const r=we(t,0,Xct);for(let s=0;s<4;s++)e[i+s]=Math.floor(256*Yct(r*qct[s]))}function iee(t,e=0){let i=0;for(let r=0;r<4;r++)i+=t[e+r]*Wct[r];return i}const qct=[1,256,65536,16777216],Wct=[1/256,1/65536,1/16777216,1/4294967296],Xct=iee(new Uint8ClampedArray([255,255,255,255]));function Yct(t){return t-Math.floor(t)}async function Ky(t,e){const{data:i}=await zr(t,{responseType:"image",...e});return i}let ree=class extends yr{constructor(){super(...arguments),this.color=si(1,1,1,1)}};function Zct(){const t=new Ui;return t.include(Ad),t.fragment.uniforms.add([new zt("tex",e=>e.texture),new Si("uColor",e=>e.color)]),t.fragment.code.add(x`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`),t}const Jct=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:ree,build:Zct},Symbol.toStringTag,{value:"Module"}));function Kct(){if(C(B9)){const t=e=>ir(`esri/libs/basisu/${e}`);B9=ee(()=>import("./basis_transcoder-e0466ff6.js"),["./basis_transcoder-e0466ff6.js","./_commonjsHelpers-2f3e7994.js"],import.meta.url).then(e=>e.b).then(({default:e})=>e({locateFile:t}).then(i=>(i.initializeBasis(),delete i.then,i)))}return B9}let B9;var Dw;(function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"})(Dw||(Dw={}));let Hp=null,IL=null;async function VCe(){return C(IL)&&(IL=Kct(),Hp=await IL),IL}function Qct(t,e){if(C(Hp))return t.byteLength;const i=new Hp.BasisFile(new Uint8Array(t)),r=BCe(i)?kCe(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),e):0;return i.close(),i.delete(),r}function eut(t,e){if(C(Hp))return t.byteLength;const i=new Hp.KTX2File(new Uint8Array(t)),r=zCe(i)?kCe(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),e):0;return i.close(),i.delete(),r}function kCe(t,e,i,r,s){const n=C2e(e?Ns.COMPRESSED_RGBA8_ETC2_EAC:Ns.COMPRESSED_RGB8_ETC2),o=s&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(i*r*n*o)}function BCe(t){return t.getNumImages()>=1&&!t.isUASTC()}function zCe(t){return t.getFaces()>=1&&t.isETC1S()}async function tut(t,e,i){C(Hp)&&(Hp=await VCe());const r=new Hp.BasisFile(new Uint8Array(i));if(!BCe(r))return null;r.startTranscoding();const s=GCe(t,e,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),(n,o)=>r.getImageTranscodedSizeInBytes(0,n,o),(n,o,a)=>r.transcodeImage(a,0,n,o,0,0));return r.close(),r.delete(),s}async function iut(t,e,i){C(Hp)&&(Hp=await VCe());const r=new Hp.KTX2File(new Uint8Array(i));if(!zCe(r))return null;r.startTranscoding();const s=GCe(t,e,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),(n,o)=>r.getImageTranscodedSizeInBytes(n,0,0,o),(n,o,a)=>r.transcodeImage(a,n,0,0,o,0,-1,-1));return r.close(),r.delete(),s}function GCe(t,e,i,r,s,n,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[h,p]=l?r?[Dw.ETC2_RGBA,Ns.COMPRESSED_RGBA8_ETC2_EAC]:[Dw.ETC1_RGB,Ns.COMPRESSED_RGB8_ETC2]:c?r?[Dw.BC3_RGBA,Ns.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[Dw.BC1_RGB,Ns.COMPRESSED_RGB_S3TC_DXT1_EXT]:[Dw.RGBA32,it.RGBA],f=e.hasMipmap?i:Math.min(1,i),m=[];for(let w=0;w<f;w++)m.push(new Uint8Array(o(w,h))),a(w,h,m[w]);const y=m.length>1,_=y?gt.LINEAR_MIPMAP_LINEAR:gt.LINEAR,b={...e,samplingMode:_,hasMipmap:y,internalFormat:p,width:s,height:n};return new xt(t,b,{type:"compressed",levels:m})}const hO=oe.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),rut=542327876,sut=131072,nut=4;function see(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function out(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const aut=see("DXT1"),lut=see("DXT3"),cut=see("DXT5"),uut=31,hut=0,dut=1,put=2,fut=3,mut=4,gut=7,yut=20,_ut=21;function vut(t,e,i){const{textureData:r,internalFormat:s,width:n,height:o}=Jl(but(i,e.hasMipmap??!1));return e.samplingMode=r.levels.length>1?gt.LINEAR_MIPMAP_LINEAR:gt.LINEAR,e.hasMipmap=r.levels.length>1,e.internalFormat=s,e.width=n,e.height=o,new xt(t,e,r)}function but(t,e){const i=new Int32Array(t,0,uut);if(i[hut]!==rut)return hO.error("Invalid magic number in DDS header"),null;if(!(i[yut]&nut))return hO.error("Unsupported format, must contain a FourCC code"),null;const r=i[_ut];let s,n;switch(r){case aut:s=8,n=Ns.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case lut:s=16,n=Ns.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case cut:s=16,n=Ns.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return hO.error("Unsupported FourCC code:",out(r)),null}let o=1,a=i[mut],l=i[fut];!(3&a)&&!(3&l)||(hO.warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,h=l;let p,f;i[put]&sut&&e!==!1&&(o=Math.max(1,i[gut])),o===1||Yp(a)&&Yp(l)||(hO.warn("Ignoring mipmaps of non power of two sized compressed texture."),o=1);let m=i[dut]+4;const y=[];for(let _=0;_<o;++_)f=(a+3>>2)*(l+3>>2)*s,p=new Uint8Array(t,m,f),y.push(p),m+=f,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:y},internalFormat:n,width:c,height:h}}let _T=class CF extends EI{constructor(e,i){super(),this._data=e,this.type=Vs.Texture,this._glTexture=null,this._powerOfTwoStretchInfo=null,this._loadingPromise=null,this._loadingController=null,this.events=new As,this._passParameters=new ree,this.params=i||{},this.params.mipmap=this.params.mipmap!==!1,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:kt.REPEAT,t:kt.REPEAT},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||Fv.STRETCH,this.estimatedTexMemRequired=CF._estimateTexMemRequired(this._data,this.params),this._startPreload()}_startPreload(){const e=this._data;C(e)||(e instanceof HTMLVideoElement?this._startPreloadVideoElement(e):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(nC(e.src)||e.preload==="auto"&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const i=!e.paused;if(e.src=e.src,i&&e.autoplay){const r=()=>{e.removeEventListener("canplay",r),e.play()};e.addEventListener("canplay",r)}}}_startPreloadImageElement(e){Qm(e.src)||nC(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}static _getDataDimensions(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}static _estimateTexMemRequired(e,i){if(C(e))return 0;if(PA(e)||xw(e))return i.encoding===gy.KTX2_ENCODING?eut(e,!!i.mipmap):i.encoding===gy.BASIS_ENCODING?Qct(e,!!i.mipmap):e.byteLength;const{width:r,height:s}=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?CF._getDataDimensions(e):i;return(i.mipmap?4/3:1)*r*s*(i.components||4)||0}dispose(){this._data=void 0}get width(){return this.params.width}get height(){return this.params.height}_createDescriptor(e){return{target:Pt.TEXTURE_2D,pixelFormat:it.RGBA,dataType:Ht.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?gt.LINEAR_MIPMAP_LINEAR:gt.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:this.params.maxAnisotropy??(this.params.mipmap?e.parameters.maxMaxAnisotropy:1)}}get glTexture(){return this._glTexture}load(e,i){if(v(this._glTexture))return this._glTexture;if(v(this._loadingPromise))return this._loadingPromise;const r=this._data;return C(r)?(this._glTexture=new xt(e,this._createDescriptor(e),null),this._glTexture):typeof r=="string"?this._loadFromURL(e,i,r):r instanceof Image?this._loadFromImageElement(e,i,r):r instanceof HTMLVideoElement?this._loadFromVideoElement(e,i,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this._loadFromImage(e,r,i):(PA(r)||xw(r))&&this.params.encoding===gy.DDS_ENCODING?(this._data=void 0,this._loadFromDDSData(e,r)):(PA(r)||xw(r))&&this.params.encoding===gy.KTX2_ENCODING?(this._data=void 0,this._loadFromKTX2(e,r)):(PA(r)||xw(r))&&this.params.encoding===gy.BASIS_ENCODING?(this._data=void 0,this._loadFromBasis(e,r)):xw(r)?this._loadFromPixelData(e,r):PA(r)?this._loadFromPixelData(e,new Uint8Array(r)):null}get requiresFrameUpdates(){return this._data instanceof HTMLVideoElement}frameUpdate(e,i,r){if(!(this._data instanceof HTMLVideoElement)||C(this._glTexture)||this._data.readyState<n3.HAVE_CURRENT_DATA||r===this._data.currentTime)return r;if(v(this._powerOfTwoStretchInfo)){const{framebuffer:s,vao:n,sourceTexture:o}=this._powerOfTwoStretchInfo;o.setData(this._data),this._drawStretchedTexture(e,i,s,n,o,this._glTexture)}else{const{videoWidth:s,videoHeight:n}=this._data,{width:o,height:a}=this._glTexture.descriptor;s!==o||n!==a?this._glTexture.updateData(0,0,0,Math.min(s,o),Math.min(n,a),this._data):this._glTexture.setData(this._data)}return this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.params.updateCallback&&this.params.updateCallback(),this._data.currentTime}_loadFromDDSData(e,i){return this._glTexture=vut(e,this._createDescriptor(e),i),this._glTexture}_loadFromKTX2(e,i){return this._loadAsync(()=>iut(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromBasis(e,i){return this._loadAsync(()=>tut(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromPixelData(e,i){Ct(this.params.width>0&&this.params.height>0);const r=this._createDescriptor(e);return r.pixelFormat=this.params.components===1?it.LUMINANCE:this.params.components===3?it.RGB:it.RGBA,r.width=this.params.width,r.height=this.params.height,this._glTexture=new xt(e,r,i),this._glTexture}_loadFromURL(e,i,r){return this._loadAsync(async s=>{const n=await Ky(r,{signal:s});return gi(s),this._loadFromImage(e,n,i)})}_loadFromImageElement(e,i,r){return r.complete?this._loadFromImage(e,r,i):this._loadAsync(async s=>{const n=await C0e(r,r.src,!1,s);return gi(s),this._loadFromImage(e,n,i)})}_loadFromVideoElement(e,i,r){return r.readyState>=n3.HAVE_CURRENT_DATA?this._loadFromImage(e,r,i):this._loadFromVideoElementAsync(e,i,r)}_loadFromVideoElementAsync(e,i,r){return this._loadAsync(s=>new Promise((n,o)=>{const a=()=>{r.removeEventListener("loadeddata",l),r.removeEventListener("error",c),Rr(h)},l=()=>{r.readyState>=n3.HAVE_CURRENT_DATA&&(a(),n(this._loadFromImage(e,r,i)))},c=p=>{a(),o(p||new W("Failed to load video"))};r.addEventListener("loadeddata",l),r.addEventListener("error",c);const h=ca(s,()=>c(Bi()))}))}_loadFromImage(e,i,r){const s=CF._getDataDimensions(i);this.params.width=s.width,this.params.height=s.height;const n=this._createDescriptor(e);return n.pixelFormat=this.params.components===3?it.RGB:it.RGBA,!this._requiresPowerOfTwo(e,n)||Yp(s.width)&&Yp(s.height)?(n.width=s.width,n.height=s.height,this._glTexture=new xt(e,n,i),this._glTexture):(this._glTexture=this._makePowerOfTwoTexture(e,i,s,n,r),this._glTexture)}_loadAsync(e){const i=new AbortController;this._loadingController=i;const r=e(i.signal);this._loadingPromise=r;const s=()=>{this._loadingController===i&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null)};return r.then(s,s),r}_requiresPowerOfTwo(e,i){const r=kt.CLAMP_TO_EDGE,s=typeof i.wrapMode=="number"?i.wrapMode===r:i.wrapMode.s===r&&i.wrapMode.t===r;return e.type===Mt.WEBGL1&&(i.hasMipmap||!s)}_makePowerOfTwoTexture(e,i,r,s,n){const{width:o,height:a}=r,l=YE(o),c=YE(a);let h;switch(s.width=l,s.height=c,this.params.powerOfTwoResizeMode){case Fv.PAD:s.textureCoordinateScaleFactor=[o/l,a/c],h=new xt(e,s),h.updateData(0,0,0,o,a,i);break;case Fv.STRETCH:case null:case void 0:h=this._stretchToPowerOfTwo(e,i,s,n());break;default:this.params.powerOfTwoResizeMode}return s.hasMipmap&&h.generateMipmap(),h}_stretchToPowerOfTwo(e,i,r,s){const n=new xt(e,r),o=new Bs(e,{colorTarget:gs.TEXTURE,depthStencilTarget:Di.NONE},n),a=new xt(e,{target:Pt.TEXTURE_2D,pixelFormat:r.pixelFormat,dataType:Ht.UNSIGNED_BYTE,wrapMode:kt.CLAMP_TO_EDGE,samplingMode:gt.LINEAR,flipped:!!r.flipped,maxAnisotropy:8,preMultiplyAlpha:r.preMultiplyAlpha},i),l=ka(e),c=e.getBoundFramebufferObject();return this._drawStretchedTexture(e,s,o,l,a,n),this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:l,sourceTexture:a,framebuffer:o}:(l.dispose(!0),a.dispose(),o.detachColorTexture(),o.dispose()),e.bindFramebuffer(c),n}_drawStretchedTexture(e,i,r,s,n,o){this._passParameters.texture=n,e.bindFramebuffer(r);const a=e.getViewport();e.setViewport(0,0,o.descriptor.width,o.descriptor.height),e.bindTechnique(i,this._passParameters,null),e.bindVAO(s),e.drawArrays(jt.TRIANGLE_STRIP,0,oa(s,"geometry")),e.bindFramebuffer(null),e.setViewport(a.x,a.y,a.width,a.height),this._passParameters.texture=null}unload(){if(v(this._powerOfTwoStretchInfo)){const{framebuffer:e,vao:i,sourceTexture:r}=this._powerOfTwoStretchInfo;i.dispose(!0),r.dispose(),e.dispose(),this._glTexture=null,this._powerOfTwoStretchInfo=null}if(v(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),v(this._loadingController)){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}};var n3;(function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(n3||(n3={}));const vP=128,nee=.5;function jCe(t,e=vP,i=e*nee,r=0){const s=wut(t,e,i,r);return new _T(s,{mipmap:!1,wrap:{s:kt.CLAMP_TO_EDGE,t:kt.CLAMP_TO_EDGE},width:e,height:e,components:4,noUnpackFlip:!0})}function wut(t,e=vP,i=e*nee,r=0){switch(t){case"circle":default:return xut(e,i);case"square":return Tut(e,i);case"cross":return Eut(e,i,r);case"x":return Cut(e,i,r);case"kite":return Sut(e,i);case"triangle":return Aut(e,i);case"arrow":return Out(e,i)}}function xut(t,e){const i=t/2-.5;return PI(t,WCe(i,i,e/2))}function Tut(t,e){return HCe(t,e,!1)}function Sut(t,e){return HCe(t,e,!0)}function Eut(t,e,i=0){return qCe(t,e,!1,i)}function Cut(t,e,i=0){return qCe(t,e,!0,i)}function Aut(t,e){return PI(t,XCe(t/2,e,e/2))}function Out(t,e){const i=e,r=e/2,s=t/2,n=.8*i,o=WCe(s,(t-e)/2-n,Math.sqrt(n*n+r*r)),a=XCe(s,i,r);return PI(t,(l,c)=>Math.max(a(l,c),-o(l,c)))}function HCe(t,e,i){return i&&(e/=Math.SQRT2),PI(t,(r,s)=>{let n=r-.5*t+.25,o=.5*t-s-.75;if(i){const a=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=a}return Math.max(Math.abs(n),Math.abs(o))-.5*e})}function qCe(t,e,i,r=0){e-=r,i&&(e*=Math.SQRT2);const s=.5*e;return PI(t,(n,o)=>{let a,l=n-.5*t,c=.5*t-o-1;if(i){const h=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=h}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>s?Math.sqrt((l-s)*(l-s)+c*c):c:c>s?Math.sqrt(l*l+(c-s)*(c-s)):l,a-=r/2,a})}function WCe(t,e,i){return(r,s)=>{const n=r-t,o=s-e;return Math.sqrt(n*n+o*o)-i}}function XCe(t,e,i){const r=Math.sqrt(e*e+i*i);return(s,n)=>{const o=Math.abs(s-t)-i,a=n-t+e/2+.75,l=(e*o+i*a)/r,c=-a;return Math.max(l,c)}}function PI(t,e){const i=new Uint8Array(4*t*t);for(let r=0;r<t;r++)for(let s=0;s<t;s++){const n=s+t*r;let o=e(s,r);o=o/t+.5,_P(o,i,4*n)}return i}let s4t=class extends yr{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function Rut(t,e){YCe(t,e,[new ni("slicePlaneOrigin",(i,r)=>QCe(e,i,r)),new ni("slicePlaneBasis1",(i,r)=>{var s;return j5(e,i,r,(s=r.slicePlane)==null?void 0:s.basis1)}),new ni("slicePlaneBasis2",(i,r)=>{var s;return j5(e,i,r,(s=r.slicePlane)==null?void 0:s.basis2)})])}function en(t,e){YCe(t,e,[new Ku("slicePlaneOrigin",(i,r)=>QCe(e,i,r)),new Ku("slicePlaneBasis1",(i,r)=>{var s;return j5(e,i,r,(s=r.slicePlane)==null?void 0:s.basis1)}),new Ku("slicePlaneBasis2",(i,r)=>{var s;return j5(e,i,r,(s=r.slicePlane)==null?void 0:s.basis2)})])}function YCe(t,e,i){if(!e.hasSlicePlane){const o=x`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return e.hasSliceInVertexProgram&&t.vertex.code.add(o),void t.fragment.code.add(o)}t.extensions.add("GL_OES_standard_derivatives"),e.hasSliceInVertexProgram&&t.vertex.uniforms.add(i),t.fragment.uniforms.add(i);const r=x`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,s=x`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=e.hasSliceHighlight?x`
        ${s}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:x`#define highlightSlice(_color_, _pos_) (_color_)`;e.hasSliceInVertexProgram&&t.vertex.code.add(r),t.fragment.code.add(r),t.fragment.code.add(n)}function ZCe(t,e,i){return t.instancedDoublePrecision?fe(Mut,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function JCe(t,e){return v(t)?be(H5,e.origin,t):e.origin}function KCe(t,e,i){return t.hasSliceTranslatedView?v(e)?hc(Put,i.camera.viewMatrix,e):i.camera.viewMatrix:null}function QCe(t,e,i){if(C(i.slicePlane))return Ma;const r=ZCe(t,e,i),s=JCe(r,i.slicePlane),n=KCe(t,r,i);return v(n)?ut(H5,s,n):s}function j5(t,e,i,r){if(C(r)||C(i.slicePlane))return Ma;const s=ZCe(t,e,i),n=JCe(s,i.slicePlane),o=KCe(t,s,i);return v(o)?(ve(dO,r,n),ut(H5,n,o),ut(dO,dO,o),be(dO,dO,H5)):r}const Mut=M(),H5=M(),dO=M(),Put=We();function A8(t,e){const i=e.output===k.ObjectAndLayerIdColor,r=e.objectAndLayerIdColorInstanced;i&&(t.varyings.add("objectAndLayerIdColorVarying","vec4"),r?t.attributes.add(A.OBJECTANDLAYERIDCOLOR_INSTANCED,"vec4"):t.attributes.add(A.OBJECTANDLAYERIDCOLOR,"vec4")),t.vertex.code.add(x`
     void forwardObjectAndLayerIdColor() {
      ${i?r?x`objectAndLayerIdColorVarying = objectAndLayerIdColor_instanced * 0.003921568627451;`:x`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:x``} }`),t.fragment.code.add(x`
      void outputObjectAndLayerIdColor() {
        ${i?x`gl_FragColor = objectAndLayerIdColorVarying;`:x``} }`)}function Iut(t,e){const{vertex:i,fragment:r}=t;e.hasMultipassGeometry&&i.include(Y2e),e.hasMultipassTerrain&&t.varyings.add("depth","float"),i.code.add(x`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${e.hasMultipassGeometry?x`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${e.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),e.hasMultipassTerrain&&r.include(rh),e.hasMultipassTerrain&&r.uniforms.add([...jp("terrainDepthTexture",(s,n)=>n.multipassTerrain.linearDepthTexture,e.hasWebGL2Context?sr.None:sr.InvSize),new zi("nearFar",(s,n)=>n.camera.nearFar)]),r.include(ou),r.code.add(x`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${e.hasMultipassTerrain?x`
          vec2 uv = gl_FragCoord.xy;

          // Read the rgba data from the texture linear depth
          vec4 terrainDepthData = ${hl(e,"terrainDepthTexture","uv")};

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          // If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          // Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}const $ut=si(1,1,0,1),eAe=si(1,0,1,1);function g0(t,e){t.fragment.uniforms.add(jp("depthTex",(i,r)=>r.highlightDepthTexture,e.hasWebGL2Context?sr.None:sr.InvSize)),t.fragment.constants.add("occludedHighlightFlag","vec4",$ut).add("unoccludedHighlightFlag","vec4",eAe),t.fragment.code.add(x`
    void outputHighlight() {
      vec3 fragCoord = gl_FragCoord.xyz;

      float sceneDepth = ${hl(e,"depthTex","fragCoord.xy")}.x;
      if (fragCoord.z > sceneDepth + 5e-7) {
        gl_FragColor = occludedHighlightFlag;
      }
      else {
        gl_FragColor = unoccludedHighlightFlag;
      }
    }
  `)}let O8=class extends Os{constructor(e,i,r){super(e,"vec4",gr.Pass,(s,n,o)=>s.setUniform4fv(e,i(n,o)),r)}},Aa=class extends Os{constructor(e,i,r){super(e,"float",gr.Pass,(s,n,o)=>s.setUniform1fv(e,i(n,o)),r)}},oee=class extends TA{constructor(){super(...arguments),this.vvSizeEnabled=!1,this.vvSizeMinSize=Xe(1,1,1),this.vvSizeMaxSize=Xe(100,100,100),this.vvSizeOffset=Xe(0,0,0),this.vvSizeFactor=Xe(1,1,1),this.vvSizeValue=Xe(1,1,1),this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvOpacityEnabled=!1,this.vvOpacityValues=[0,0,0,0,0,0,0,0],this.vvOpacityOpacities=[1,1,1,1,1,1,1,1],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=ls()}};const qp=8;function FE(t,e){e.hasVvInstancing&&(e.vvSize||e.vvColor)&&t.attributes.add(A.INSTANCEFEATUREATTRIBUTE,"vec4");const i=t.vertex;e.vvSize?(i.uniforms.add(new ni("vvSizeMinSize",r=>r.vvSizeMinSize)),i.uniforms.add(new ni("vvSizeMaxSize",r=>r.vvSizeMaxSize)),i.uniforms.add(new ni("vvSizeOffset",r=>r.vvSizeOffset)),i.uniforms.add(new ni("vvSizeFactor",r=>r.vvSizeFactor)),i.uniforms.add(new ng("vvSymbolRotationMatrix",r=>r.vvSymbolRotationMatrix)),i.uniforms.add(new ni("vvSymbolAnchor",r=>r.vvSymbolAnchor)),i.code.add(x`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),i.code.add(x`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?x`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):i.code.add(x`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vvColor?(i.constants.add("vvColorNumber","int",qp),e.hasVvInstancing&&i.uniforms.add([new Aa("vvColorValues",r=>r.vvColorValues,qp),new O8("vvColorColors",r=>r.vvColorColors,qp)]),i.code.add(x`
      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${e.hasVvInstancing?x`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):i.code.add(x`vec4 vvColor() { return vec4(1.0); }`)}const q5=.1,la=.001;function Lut(t){const e=new Ui,i=t.signedDistanceFieldEnabled;if(e.include(yQ),e.include(CCe,t),e.include(en,t),t.occlusionPass)return e.include(Iut,t),e;const{vertex:r,fragment:s}=e;e.include(ZQ),s.include(ou),s.include(sg),e.include(FE,t),e.include(A8,t),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2"),t.binaryHighlightOcclusionEnabled&&e.varyings.add("voccluded","float"),r.uniforms.add([new Si("viewport",(c,h)=>h.camera.fullViewport),new zi("screenOffset",(c,h)=>It(tAe,2*c.screenOffset[0]*h.camera.pixelRatio,2*c.screenOffset[1]*h.camera.pixelRatio)),new zi("anchorPosition",c=>W5(c)),new Si("materialColor",c=>c.color),new He("pixelRatio",(c,h)=>h.camera.pixelRatio)]),i&&(r.uniforms.add(new Si("outlineColor",c=>c.outlineColor)),s.uniforms.add([new Si("outlineColor",c=>oce(c)?c.outlineColor:Am),new He("outlineSize",c=>oce(c)?c.outlineSize:0)])),t.hasScreenSizePerspective&&(Nct(r),E8(r)),(t.debugDrawLabelBorder||t.binaryHighlightOcclusionEnabled)&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add(A.UV0,"vec2"),e.attributes.add(A.COLOR,"vec4"),e.attributes.add(A.SIZE,"vec2"),e.attributes.add(A.AUXPOS2,"vec4"),r.code.add(x`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${t.hasScreenSizePerspective?x`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:x`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${t.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${t.occlusionTestEnabled||t.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${t.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const n=x`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,o=t.pixelSnappingEnabled?i?x`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:x`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:x`posProj += quadOffset;`;t.vvColor&&r.uniforms.add([new O8("vvColorColors",c=>c.vvColorColors,qp),new Aa("vvColorValues",c=>c.vvColorValues,qp)]),r.uniforms.add(new zi("textureCoordinateScaleFactor",c=>v(c.texture)&&v(c.texture.descriptor.textureCoordinateScaleFactor)?c.texture.descriptor.textureCoordinateScaleFactor:eve)),r.code.add(x`
    ${t.occlusionTestEnabled?"if (visible) {":""}
    ${n}
    ${t.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${t.output===k.ObjectAndLayerIdColor?x`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${x.float(la)};
    ${i?`alphaDiscard = alphaDiscard && outlineColor.a < ${x.float(la)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv * textureCoordinateScaleFactor;

    ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${t.occlusionTestEnabled?x`} else { vtc = vec2(0.0);
      ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),s.uniforms.add(new zt("tex",c=>c.texture));const a=t.debugDrawLabelBorder?x`(isBorder > 0.0 ? 0.0 : ${x.float(q5)})`:x.float(q5),l=x`
    ${t.debugDrawLabelBorder?x`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${i?x`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${x.float(vP)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${x.float(la)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:x`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${t.debugDrawLabelBorder?x`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return t.output===k.Alpha&&s.code.add(x`
      void main() {
        ${l}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),t.output===k.ObjectAndLayerIdColor&&s.code.add(x`
      void main() {
        ${l}
        outputObjectAndLayerIdColor();
      }
      `),t.output===k.Color&&s.code.add(x`
    void main() {
      ${l}
      ${t.transparencyPassType===$t.FrontFace?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),t.output===k.Highlight&&(e.include(g0,t),s.code.add(x`
    void main() {
      ${l}
      ${t.binaryHighlightOcclusionEnabled?x`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),e}function oce(t){return t.outlineColor[3]>0&&t.outlineSize>0}function W5(t,e=tAe){return t.textureIsSignedDistanceField?Dut(t.anchorPosition,t.distanceFieldBoundingBox,e):Fn(e,t.anchorPosition),e}function Dut(t,e,i){v(e)?It(i,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1]):It(i,0,0)}const tAe=et(),Nut=Object.freeze(Object.defineProperty({__proto__:null,build:Lut,calculateAnchorPosForRendering:W5},Symbol.toStringTag,{value:"Module"})),Qu=Yn(Ve.SRC_ALPHA,Ve.ONE,Ve.ONE_MINUS_SRC_ALPHA,Ve.ONE_MINUS_SRC_ALPHA),Fut=of(Ve.ONE,Ve.ONE),iAe=of(Ve.ZERO,Ve.ONE_MINUS_SRC_ALPHA);function y0(t){return t===$t.FrontFace?null:t===$t.Alpha?iAe:Fut}function R8(t){return t===$t.FrontFace?pc:null}const M8=5e5,P8={factor:-1,units:-2};function I8(t){return t?P8:null}function T1(t,e=Dr.LESS){return t===$t.NONE||t===$t.FrontFace?e:Dr.LEQUAL}let rAe=class sAe extends ji{initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Mt.WEBGL2,i.spherical=e.viewingMode===st.Global}initializeProgram(e){return new ki(e.rctx,sAe.shader.get().build(this.configuration),Li)}_setPipelineState(e){const i=this.configuration,r=e===$t.NONE,s=e===$t.FrontFace,n=this.configuration.hasPolygonOffset?Uut:null,o=(r||s)&&i.output!==k.Highlight&&(i.depthEnabled||i.occlusionPass)?pc:null;return Qt({blending:i.output===k.Color||i.output===k.Alpha||i.output===k.Highlight?r?Vut:y0(e):null,depthTest:{func:Dr.LEQUAL},depthWrite:o,colorWrite:ui,polygonOffset:n})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.occlusionPass?jt.POINTS:jt.TRIANGLES}};rAe.shader=new Vi(Nut,()=>ee(()=>import("./HUDMaterial.glsl-4bae8eba.js"),[],import.meta.url));const Uut={factor:0,units:-4},Vut=of(Ve.ONE,Ve.ONE_MINUS_SRC_ALPHA);let qs=class extends uo{constructor(){super(...arguments),this.output=k.Color,this.screenCenterOffsetUnitsEnabled=ic.World,this.transparencyPassType=$t.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}};u([z({count:k.COUNT})],qs.prototype,"output",void 0),u([z({count:ic.COUNT})],qs.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([z({count:$t.COUNT})],qs.prototype,"transparencyPassType",void 0),u([z()],qs.prototype,"spherical",void 0),u([z()],qs.prototype,"occlusionTestEnabled",void 0),u([z()],qs.prototype,"signedDistanceFieldEnabled",void 0),u([z()],qs.prototype,"vvSize",void 0),u([z()],qs.prototype,"vvColor",void 0),u([z()],qs.prototype,"hasVerticalOffset",void 0),u([z()],qs.prototype,"hasScreenSizePerspective",void 0),u([z()],qs.prototype,"debugDrawLabelBorder",void 0),u([z()],qs.prototype,"binaryHighlightOcclusionEnabled",void 0),u([z()],qs.prototype,"hasSlicePlane",void 0),u([z()],qs.prototype,"hasPolygonOffset",void 0),u([z()],qs.prototype,"depthEnabled",void 0),u([z()],qs.prototype,"pixelSnappingEnabled",void 0),u([z()],qs.prototype,"isDraped",void 0),u([z()],qs.prototype,"hasMultipassGeometry",void 0),u([z()],qs.prototype,"hasMultipassTerrain",void 0),u([z()],qs.prototype,"cullAboveGround",void 0),u([z()],qs.prototype,"occlusionPass",void 0),u([z()],qs.prototype,"objectAndLayerIdColorInstanced",void 0),u([z({constValue:!0})],qs.prototype,"hasSliceInVertexProgram",void 0),u([z({constValue:!1})],qs.prototype,"hasVvInstancing",void 0);let FC=class extends x1{constructor(e){super(e,new Yut),this._configuration=new qs}getConfiguration(e,i){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?ic.Screen:ic.World,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.isDraped=this.parameters.isDraped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.vvSize=!!this.parameters.vvSizeEnabled,this._configuration.vvColor=!!this.parameters.vvColorEnabled,this._configuration.occlusionPass=i.slot===Fe.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(e===k.Color||e===k.Alpha),e===k.Color&&(this._configuration.debugDrawLabelBorder=!!Ji.LABELS_SHOW_BORDER),e===k.Highlight&&(this._configuration.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.hasMultipassGeometry=i.multipassGeometry.enabled,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(e,i,r,s,n,o){if(!r.options.selectionMode||!r.options.hud||!e.visible)return;const a=this.parameters;let l=1,c=1;if(bd(G9,i),v(e.shaderTransformer)){const S=e.shaderTransformer(cce);l=S[0],c=S[5],zut(G9)}const h=e.vertexAttributes.get(A.POSITION),p=e.vertexAttributes.get(A.SIZE),f=e.vertexAttributes.get(A.NORMAL),m=e.vertexAttributes.get(A.AUXPOS1);Ct(h.size>=3);const y=r.point,_=r.camera,b=W5(a);l*=_.pixelRatio,c*=_.pixelRatio;const w=this.parameters.centerOffsetUnits==="screen";for(let S=0;S<h.data.length/h.size;S++){const T=S*h.size;fe(ya,h.data[T],h.data[T+1],h.data[T+2]),ut(ya,ya,i);const E=S*p.size;G0[0]=p.data[E]*l,G0[1]=p.data[E+1]*c,ut(ya,ya,_.viewMatrix);const O=S*m.size;if(fe(du,m.data[O+0],m.data[O+1],m.data[O+2]),!w&&(ya[0]+=du[0],ya[1]+=du[1],du[2]!==0)){const L=du[2];Oe(du,ya),be(ya,ya,ue(du,du,L))}const R=S*f.size;if(fe(pO,f.data[R],f.data[R+1],f.data[R+2]),this._normalAndViewAngle(pO,G9,_,j9),this._applyVerticalOffsetTransformationView(ya,j9,_,z9),_.applyProjection(ya,qa),qa[0]>-1){qa[0]=Math.floor(qa[0]),qa[1]=Math.floor(qa[1]),w&&(du[0]||du[1])&&(qa[0]+=du[0],du[1]!==0&&(qa[1]+=YQ(du[1],z9.factorAlignment)),_.unapplyProjection(qa,ya)),qa[0]+=this.parameters.screenOffset[0],qa[1]+=this.parameters.screenOffset[1],yCe(G0,z9.factor,G0);const L=qut*_.pixelRatio;let P=0;if(a.textureIsSignedDistanceField&&(P=a.outlineSize*_.pixelRatio/2),y&&ace(y,qa[0],qa[1],G0,L,P,a,b)){const F=r.ray;if(ut(lce,ya,Go(Hut,_.viewMatrix)),qa[0]=y[0],qa[1]=y[1],_.unprojectFromRenderScreen(qa,ya)){const V=M();he(V,F.direction);const B=1/je(V);ue(V,V,B),o(Ar(F.origin,ya)*B,V,-1,!0,1,lce)}}}}}intersectDraped(e,i,r,s,n,o){const a=e.vertexAttributes.get(A.POSITION),l=e.vertexAttributes.get(A.SIZE),c=this.parameters,h=W5(c);let p=1,f=1;if(v(e.shaderTransformer)){const y=e.shaderTransformer(cce);p=y[0],f=y[5]}p*=e.screenToWorldRatio,f*=e.screenToWorldRatio;const m=Wut*e.screenToWorldRatio;for(let y=0;y<a.data.length/a.size;y++){const _=y*a.size,b=a.data[_],w=a.data[_+1],S=y*l.size;G0[0]=l.data[S]*p,G0[1]=l.data[S+1]*f;let T=0;c.textureIsSignedDistanceField&&(T=c.outlineSize*e.screenToWorldRatio/2),ace(s,b,w,G0,m,T,c,h)&&n(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new Jut(this)}_normalAndViewAngle(e,i,r,s){return Dct(i)&&(i=bd(jut,i)),qc(s.normal,e,i),ut(s.normal,s.normal,r.viewInverseTransposeMatrix),s.cosAngle=Ae(nAe,Xut),s}_updateScaleInfo(e,i,r){const s=this.parameters;v(s.screenSizePerspective)?Qle(r,i,s.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),v(s.screenSizePerspectiveAlignment)?Qle(r,i,s.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}applyShaderOffsetsView(e,i,r,s,n,o,a){const l=this._normalAndViewAngle(i,r,n,j9);return this._applyVerticalGroundOffsetView(e,l,n,a),this._applyVerticalOffsetTransformationView(a,l,n,o),this._applyPolygonOffsetView(a,l,s[3],n,a),this._applyCenterOffsetView(a,s,a),a}applyShaderOffsetsNDC(e,i,r,s,n){return this._applyCenterOffsetNDC(e,i,r,s),v(n)&&he(n,s),this._applyPolygonOffsetNDC(s,i,r,s),s}_applyPolygonOffsetView(e,i,r,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(r);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return he(n,e);const c=we(Math.abs(i.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/s.viewport[2];return ue(n,e,l>0?h:1/h),n}_applyVerticalGroundOffsetView(e,i,r,s){const n=je(e),o=r.aboveGround?1:-1,a=.5*r.computeRenderPixelSizeAtDist(n),l=ue(ya,i.normal,o*a);return ve(s,e,l),s}_applyVerticalOffsetTransformationView(e,i,r,s){const n=this.parameters;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const c=je(e);this._updateScaleInfo(s,c,i.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return e}const o=je(e),a=Gt(n.screenSizePerspectiveAlignment,n.screenSizePerspective),l=PCe(r,o,n.verticalOffset,i.cosAngle,a);return this._updateScaleInfo(s,o,i.cosAngle),ue(i.normal,i.normal,l),ve(e,e,i.normal)}_applyCenterOffsetView(e,i,r){const s=this.parameters.centerOffsetUnits!=="screen";return r!==e&&he(r,e),s&&(r[0]+=i[0],r[1]+=i[1],i[2]&&(Oe(pO,r),ve(r,r,ue(pO,pO,i[2])))),r}_applyCenterOffsetNDC(e,i,r,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==e&&he(s,e),n||(s[0]+=i[0]/r.fullWidth*2,s[1]+=i[1]/r.fullHeight*2),s}_applyPolygonOffsetNDC(e,i,r,s){const n=this.parameters.shaderPolygonOffset;if(e!==s&&he(s,e),n){const o=r.aboveGround?1:-1,a=o*Math.sign(i[3]);s[2]-=(a||o)*n}return s}requiresSlot(e,i){if(i===k.Color||i===k.Alpha||i===k.Highlight||i===k.ObjectAndLayerIdColor){if(e===Fe.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:r,occlusionTest:s}=this.parameters;return e===(r?Fe.LABEL_MATERIAL:Fe.HUD_MATERIAL)||s&&e===Fe.OCCLUSION_PIXELS}return!1}createGLMaterial(e){return new kut(e)}calculateRelativeScreenBounds(e,i,r=ci()){return But(this.parameters,e,i,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}},kut=class extends qK{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(rAe,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}};function But(t,e,i,r=Gut){return Fn(r,t.anchorPosition),r[0]*=-e[0],r[1]*=-e[1],r[0]+=t.screenOffset[0]*i,r[1]+=t.screenOffset[1]*i,r}function zut(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=1/Math.sqrt(e*e+i*i+r*r),p=1/Math.sqrt(s*s+n*n+o*o),f=1/Math.sqrt(a*a+l*l+c*c);return t[0]=e*h,t[1]=i*h,t[2]=r*h,t[3]=s*p,t[4]=n*p,t[5]=o*p,t[6]=a*f,t[7]=l*f,t[8]=c*f,t}function ace(t,e,i,r,s,n,o,a){let l=e-s-(a[0]>0?r[0]*a[0]:0),c=l+r[0]+2*s,h=i-s-(a[1]>0?r[1]*a[1]:0),p=h+r[1]+2*s;const f=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&v(f)&&(l+=r[0]*f[0],h+=r[1]*f[1],c-=r[0]*(1-f[2]),p-=r[1]*(1-f[3]),l-=n,c+=n,h-=n,p+=n),t[0]>l&&t[0]<c&&t[1]>h&&t[1]<p}const z9=new DCe,Gut=et(),ya=M(),pO=M(),qa=fi(),nAe=M(),lce=M(),G9=ls(),jut=ls(),Hut=We(),du=M(),j9={normal:nAe,cosAngle:0},cce=We(),qut=1,Wut=2,G0=[0,0],Xut=Xe(0,0,1);let Yut=class extends F2e{constructor(){super(...arguments),this.renderOccluded=ps.Occlude,this.color=si(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=Ni(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=si(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}};const oAe=cs().vec3f(A.POSITION).vec3f(A.NORMAL).vec2f(A.UV0).vec4u8(A.COLOR).vec2f(A.SIZE).vec4f(A.AUXPOS1).vec4f(A.AUXPOS2),Zut=oAe.clone().vec4u8(A.OBJECTANDLAYERIDCOLOR);let Jut=class{constructor(e){this._material=e,this.vertexBufferLayout=de("enable-feature:objectAndLayerId-rendering")?Zut:oAe}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get(A.POSITION).length}write(e,i,r,s,n){C8(r.indices.get(A.POSITION),r.vertexAttributes.get(A.POSITION).data,e,s.position,n,6),eee(r.indices.get(A.NORMAL),r.vertexAttributes.get(A.NORMAL).data,i,s.normal,n,6);const o=r.vertexAttributes.get(A.UV0).data;let a,l,c,h;if(o==null||o.length<4){const w=this._material.parameters;a=0,l=0,c=w.texCoordScale[0],h=w.texCoordScale[1]}else a=o[0],l=o[1],c=o[2],h=o[3];c=Math.min(1.99999,c+1),h=Math.min(1.99999,h+1);let p=r.indices.get(A.POSITION).length,f=n;const m=s.uv0;for(let w=0;w<p;++w)m.set(f,0,a),m.set(f,1,l),f+=1,m.set(f,0,c),m.set(f,1,l),f+=1,m.set(f,0,c),m.set(f,1,h),f+=1,m.set(f,0,c),m.set(f,1,h),f+=1,m.set(f,0,a),m.set(f,1,h),f+=1,m.set(f,0,a),m.set(f,1,l),f+=1;tee(r.indices.get(A.COLOR),r.vertexAttributes.get(A.COLOR).data,4,s.color,n,6);const y=r.indices.get(A.SIZE),_=r.vertexAttributes.get(A.SIZE).data;p=y.length;const b=s.size;f=n;for(let w=0;w<p;++w){const S=_[2*y[w]],T=_[2*y[w]+1];for(let E=0;E<6;++E)b.set(f,0,S),b.set(f,1,T),f+=1}if(r.indices.get(A.AUXPOS1)&&r.vertexAttributes.get(A.AUXPOS1)?NC(r.indices.get(A.AUXPOS1),r.vertexAttributes.get(A.AUXPOS1).data,s.auxpos1,n,6):nce(s.auxpos1,n,6*p),r.indices.get(A.AUXPOS2)&&r.vertexAttributes.get(A.AUXPOS2)?NC(r.indices.get(A.AUXPOS2),r.vertexAttributes.get(A.AUXPOS2).data,s.auxpos2,n,6):nce(s.auxpos2,n,6*p),v(r.objectAndLayerIdColor)&&r.indices.get(A.POSITION)){const w=r.indices.get(A.POSITION).length,S=s.getField(A.OBJECTANDLAYERIDCOLOR,Na);FCe(r.objectAndLayerIdColor,S,w,n,6)}}};const _f=M(),HT=fi(),fO=fi(),H9=M(),Kut=We(),Qut=gn(),q9=fo(),eht=M(),tht=ci();class iht{constructor(){this.aabr=ci(),this.distance=0,this.culled=!1,this.visible=!1}}class rht{constructor(e,i){this.graphics3DGraphic=e,this.slicePlaneEnabled=i,this.info={}}}var Dc;(function(t){t[t.Idle=0]="Idle",t[t.Process=1]="Process",t[t.Sort=2]="Sort",t[t.Deconflict=3]="Deconflict",t[t.NumStates=4]="NumStates"})(Dc||(Dc={}));class aAe{constructor(){this.camera=new Ut,this.slicePlane=o0(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),dT(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let tE=class extends $e{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._runningViewState=new aAe,this._state=Dc.Idle,this._active=new Map,this._visible=new Map,this._iterators=new aht,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==Dc.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const t=this._state/Dc.NumStates;return this._dirty?.5*t:t}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(t){switch(this._state){case Dc.Idle:this._startUpdate(),t.madeProgress();case Dc.Process:if(this._state=Dc.Process,!this._processActiveGraphics(t))return;case Dc.Sort:if(this._state=Dc.Sort,!this._sortVisibleGraphics(t))return;case Dc.Deconflict:if(this._state=Dc.Deconflict,!this._deconflictVisibleGraphics(t))return;default:Sct(this,this._visible),this._state=Dc.Idle,this.notifyChange("updating")}}modifyGraphics(t,e){e?t.forEach(i=>this.addToActiveGraphics(i)):t.forEach(i=>this.removeFromActiveGraphics(i)),this.setDirty()}layerSupportsDeconfliction(t){if(C(t)||t.type!=="object3d")return!1;const e=t.stageObject;if((e?e.geometries.length:0)!==1)return!1;const i=e==null?void 0:e.geometries[0];return(i==null?void 0:i.material)instanceof FC}_startUpdate(){Ect(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._runningViewState.camera;this._initBins(t,e),this._resetIterators()}addToActiveGraphics(t){t.info[this.visibilityGroup]=new iht,this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){this._visible.delete(t.graphics3DGraphic.graphic.uid),sht(t,this.visibilityGroup),delete t.info[this.visibilityGroup],this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),i=rA(Kut,this._runningViewState.camera.projectionMatrix),r=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?Qut:null;let s=0;for(v(r)&&(ut(r,Ma,this._runningViewState.camera.viewMatrix),r[3]=tr(this.view.spatialReference).radius,s=gve(r,Ma));!t.done;){t.madeProgress();const n=e.next();if(n.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=n.value,a=o&&o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,i,r,s),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(t){const e=this._ensureSortGraphicsIterator();for(;!t.done;){const i=e.next();if(t.madeProgress(),i.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(t){const e=this._ensureVisibleGraphicsIterator(),i=this.visibilityGroup===Fo.LABEL;for(;!t.done;){t.madeProgress();const r=e.next();if(r.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=r.value,n=s.info[this.visibilityGroup];if(!n||n.culled)continue;const o=s.graphics3DGraphic,a=(!i||o.isVisible())&&!this._isConflicted(s);a&&this._addToBins(s),n.visible=a,this._setGraphicVisibility(s,a),Act(n,a)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=uce(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=uce(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=nht(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(t,e,i,r){const s=t.graphics3DGraphic;if(s.destroyed)return;const n=t.info[this.visibilityGroup];if(!s.isVisible(Fo.GRAPHIC,jc.DECONFLICTION))return void(n.culled=!0);const o=this.getGraphicsLayers(s);yd(n.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(C(a)){if(a=uht,this._getProjectionInfo(l,e,a),a.isOutsideScreen||this._isCulledBySlice(t,_f)||v(i)&&this._isCulledByHorizon(a,i,r))return void(n.culled=!0);!Ji.TESTS_DISABLE_OPTIMIZATIONS&&n.visible&&(a.distance*=.7)}this._expandBoundingRect(n,l,c,a)}C(a)?n.culled=!0:(n.distance=a.distance,n.culled=!1)}_getProjectionInfo(t,e,i){const r=this._runningViewState.camera,s=t.stageObject,n=s.geometries[0],o=n.material,a=s.boundingVolumeWorldSpace.bounds;ut(_f,a,r.viewMatrix);const l=n.vertexAttributes,c=l.get(A.NORMAL).data,h=l.get(A.AUXPOS1).data;o.applyShaderOffsetsView(_f,c,s.transformation,h,r,i.scaleInfo,_f),nr(HT,_f[0],_f[1],_f[2],1),qu(fO,HT,r.projectionMatrix),ue(i.positionNDC,fO,1/fO[3]),o.applyShaderOffsetsNDC(i.positionNDC,h,r,i.positionNDC,H9),i.distanceWithoutPolygonOffset=r.depthNDCToWorld(H9[2]),i.distance=H9[2]===i.positionNDC[2]?i.distanceWithoutPolygonOffset:r.depthNDCToWorld(i.positionNDC[2]),nr(fO,i.positionNDC[0],i.positionNDC[1],i.positionNDC[2],1),qu(HT,fO,e),XC(HT,HT,1/HT[3]),fe(i.positionView,_f[0],_f[1],_f[2])}_isCulledByHorizon(t,e,i){return he(q9.direction,t.positionView),fe(q9.origin,0,0,0),!!v1(e,q9,eht)&&t.distanceWithoutPolygonOffset>i}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&_J(this._runningViewState.slicePlane,e)}_expandBoundingRect(t,e,i,{positionNDC:r,scaleInfo:s}){const n=this._runningViewState.camera,o=e.getScreenSize(lht);yCe(o,s.factor,o),o[0]*=n.pixelRatio,o[1]*=n.pixelRatio;const a=E4(i.calculateRelativeScreenBounds(o,s.factorAlignment.scale,tht),Yt(0,n.fullWidth,.5+.5*r[0]),Yt(0,n.fullHeight,.5+.5*r[1])),l=this.iconMarginFactor;if(l!==0){const c=l*Math.min(zu(a),Zp(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}Lv(t.aabr,a,t.aabr)}_isConflicted(t){const e=t.graphics3DGraphic.graphic.uid,i=t.info[this.visibilityGroup];for(let r=Math.floor(i.aabr[0]/this._accBinsSizeX);r<=Math.floor(i.aabr[2]/this._accBinsSizeX);r++)if(!(r<0||r>=this._accBinsNumX))for(let s=Math.floor(i.aabr[1]/this._accBinsSizeY);s<=Math.floor(i.aabr[3]/this._accBinsSizeY);s++){if(s<0||s>=this._accBinsNumY)continue;const n=this._accBins[r][s];for(let o=0;o<n.length;o++){const a=n.data[o],l=a.info[this.visibilityGroup];if(l&&l.visible&&a.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,iU(l.aabr,i.aabr)))return!0}}return!1}_initBins(t,e){if(this._accBins==null){this._accBins=[];for(let i=0;i<this._accBinsNumX;i++){this._accBins.push([]);const r=this._accBins[this._accBins.length-1];for(let s=0;s<this._accBinsNumY;s++)r.push(new li)}}else for(let i=0;i<this._accBinsNumX;i++)for(let r=0;r<this._accBinsNumY;r++)this._accBins[i][r].clear();this._accBinsSizeX=t/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(t){const e=t.info[this.visibilityGroup],i=Math.floor(e.aabr[0]/this._accBinsSizeX),r=Math.floor(e.aabr[2]/this._accBinsSizeX),s=Math.floor(e.aabr[1]/this._accBinsSizeY),n=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let o=i;o<=r;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=s;a<=n;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(t)}_setGraphicVisibility(t,e){const i=t.graphics3DGraphic;i.destroyed||(i.setVisibilityFlag(jc.DECONFLICTION,e,this.visibilityGroup),this.visibilityGroup===Fo.LABEL&&this.view.labeler.setLabelGraphicVisibility(i,e))}};function sht(t,e){const i=t.graphics3DGraphic;i.destroyed||i.clearVisibilityFlag(jc.DECONFLICTION,e)}function*uce(t){if(Map.prototype.entries){const e=t.entries();for(let i=e.next();!i.done;i=e.next())yield i.value[1]}else yield*t.values()}function*nht(t,e,i){e.clear(),t.forEach((s,n)=>{const o=e.pushNew();o.id=n,o.visible=s.graphics3DGraphic.hasVisibilityFlag(jc.DECONFLICTION,i),o.prio=s.info?s.info[i].distance:Number.MAX_VALUE}),yield;const r=e.iterableSort((s,n)=>s.visible!==n.visible?s.visible?-1:1:s.prio!==n.prio?s.prio-n.prio:s.id-n.id);for(let s=r.next();!s.done;s=r.next())yield;e.forAll(s=>{const n=t.get(s.id);n&&(t.delete(s.id),t.set(s.id,n))}),e.clear()}u([d({constructOnly:!0})],tE.prototype,"view",void 0),u([d({type:Boolean,readOnly:!0})],tE.prototype,"updating",null),tE=u([I("esri.views.3d.layers.graphics.Deconflictor")],tE);class oht{}class aht{constructor(e=null,i=null,r=null){this.active=e,this.visible=i,this.sort=r,this.sortArray=new li({allocator:s=>s||new oht})}}const lht=et();class cht{constructor(){this.positionView=M(),this.positionNDC=M(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new DCe}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}}const uht=new cht,hht=2e3;let AF=class extends tE{constructor(e){super(e),this.visibilityGroup=Fo.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return ua.YIELD;const i=performance.now();if(e.state!==Mi.IDLE&&i-this._lastDeconfliction<hht)return ua.YIELD;super.runTask(e),this.state===Dc.Idle&&(this._lastDeconfliction=i)}enabledChanged(e,i){this.modifyGraphics(i,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};u([d({constructOnly:!0})],AF.prototype,"parent",void 0),AF=u([I("esri.views.3d.layers.graphics.LabelDeconflictor")],AF);let XW=class extends tE{constructor(){super(...arguments),this._handles=new Ki,this._contexts=new Map,this._viewState=new aAe,this.visibilityGroup=Fo.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([re(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.state)==null?void 0:i.camera},()=>{this._updateViewState(),this.setDirty()}),re(()=>{var e,i,r;return(r=(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.ground)==null?void 0:r.opacity},(e,i)=>{e!==1&&i!==1||this.setDirty()}),re(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},Zt)]),this._frameTask=this.view.resourceController.scheduler.registerTask(Rt.GRAPHICS_DECONFLICTOR,this),this._labels=new AF({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,i){const r=!(this._graphicSupportsDeconfliction(i)&&W9(e));i.setVisibilityFlag(jc.DECONFLICTION,r,Fo.GRAPHIC)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;v(e)&&Pve(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=v(e)}_slicePlaneChanged(){Vo(this._contexts,(e,i)=>i.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const i=this._getGraphicsContext(e);return{addGraphic:r=>this._addGraphic(e,i,r),removeGraphic:r=>this._removeGraphic(i,r),labelingInfoChange:()=>this._labels.enabledChanged(e,i),featureReductionChange:()=>this.enabledChanged(e,i),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,i),clear:()=>i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic))}}removeGraphicsOwner(e){const i=this._contexts.get(e);i&&(i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,i,r){const s=r.graphic.uid,n=new rht(r,e.symbolCreationContext.slicePlaneEnabled);i.set(s,n),W9(e)&&this.addToActiveGraphics(n),e.labelsEnabled&&this._labels.addToActiveGraphics(n)}_removeGraphic(e,i){const r=i.graphic.uid,s=e.get(r);s&&(this.removeFromActiveGraphics(s),this._labels.removeFromActiveGraphics(s),e.delete(r),this.setDirty())}enabledChanged(e,i){const r=W9(e);r||dht(e),this.modifyGraphics(i,r)}_slicePlaneEnabledChanged(e,i){const r=e.symbolCreationContext.slicePlaneEnabled;i.forEach(s=>s.slicePlaneEnabled=r),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const i=e.layers;if(!i||!i.length)return!1;for(const r of i)if(this.layerSupportsDeconfliction(r))return!0;return!1}_getGraphicsContext(e){const i=this._contexts.get(e);if(i)return i;const r=new Map;return this._contexts.set(e,r),this.setDirty(),r}};function W9(t){const e=t.layer;return!(!e||!e.featureReduction||e.featureReduction.type!=="selection")}function dht(t){const e=t.graphics3DGraphics;e&&e.forEach(i=>i.clearVisibilityFlag(jc.DECONFLICTION))}XW=u([I("esri.views.3d.layers.graphics.GraphicsDeconflictor")],XW);const SA=(t,e,i)=>[e,i],Td=(t,e,i)=>[e,i,t[2]],EA=(t,e,i)=>[e,i,t[2],t[3]];function g4t(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance]:[1,1],translate:v(t.extent)?[t.extent.xmin,t.extent.ymax]:[0,0]}:null}function bP({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function wP({scale:t,translate:e},i){return Math.round((e[1]-i)/t[1])}function aee(t,e,i){const r=[];let s,n,o,a;for(let l=0;l<i.length;l++){const c=i[l];l>0?(o=bP(t,c[0]),a=wP(t,c[1]),o===s&&a===n||(r.push(e(c,o-s,a-n)),s=o,n=a)):(s=bP(t,c[0]),n=wP(t,c[1]),r.push(e(c,s,n)))}return r.length>0?r:null}function pht(t,e,i,r){return aee(t,i?r?EA:Td:r?Td:SA,e)}function fht(t,e,i,r){const s=[],n=i?r?EA:Td:r?Td:SA;for(let o=0;o<e.length;o++){const a=aee(t,n,e[o]);a&&a.length>=3&&s.push(a)}return s.length?s:null}function mht(t,e,i,r){const s=[],n=i?r?EA:Td:r?Td:SA;for(let o=0;o<e.length;o++){const a=aee(t,n,e[o]);a&&a.length>=2&&s.push(a)}return s.length?s:null}function lAe({scale:t,translate:e},i){return i*t[0]+e[0]}function cAe({scale:t,translate:e},i){return e[1]-i*t[1]}function uAe(t,e,i){const r=new Array(i.length);if(!i.length)return r;const[s,n]=t.scale;let o=lAe(t,i[0][0]),a=cAe(t,i[0][1]);r[0]=e(i[0],o,a);for(let l=1;l<i.length;l++){const c=i[l];o+=c[0]*s,a-=c[1]*n,r[l]=e(c,o,a)}return r}function hAe(t,e,i){const r=new Array(i.length);for(let s=0;s<i.length;s++)r[s]=uAe(t,e,i[s]);return r}function ght(t,e,i,r){return uAe(t,i?r?EA:Td:r?Td:SA,e)}function yht(t,e,i,r){return hAe(t,i?r?EA:Td:r?Td:SA,e)}function _ht(t,e,i,r){return hAe(t,i?r?EA:Td:r?Td:SA,e)}function vht(t,e,i,r,s){return e.xmin=bP(t,i.xmin),e.ymin=wP(t,i.ymin),e.xmax=bP(t,i.xmax),e.ymax=wP(t,i.ymax),e!==i&&(r&&(e.zmin=i.zmin,e.zmax=i.zmax),s&&(e.mmin=i.mmin,e.mmax=i.mmax)),e}function bht(t,e,i,r,s){return e.points=pht(t,i.points,r,s)??[],e}function wht(t,e,i,r,s){return e.x=bP(t,i.x),e.y=wP(t,i.y),e!==i&&(r&&(e.z=i.z),s&&(e.m=i.m)),e}function xht(t,e,i,r,s){const n=fht(t,i.rings,r,s);return n?(e.rings=n,e):null}function Tht(t,e,i,r,s){const n=mht(t,i.paths,r,s);return n?(e.paths=n,e):null}function y4t(t,e){return t&&e?q6(e)?wht(t,{},e,!1,!1):W6(e)?Tht(t,{},e,!1,!1):$v(e)?xht(t,{},e,!1,!1):H6(e)?bht(t,{},e,!1,!1):fZ(e)?vht(t,{},e,!1,!1):null:null}function dAe(t,e,i,r,s){return v(i)&&(e.points=ght(t,i.points,r,s)),e}function pAe(t,e,i,r,s){return C(i)||(e.x=lAe(t,i.x),e.y=cAe(t,i.y),e!==i&&(r&&(e.z=i.z),s&&(e.m=i.m))),e}function fAe(t,e,i,r,s){return v(i)&&(e.rings=_ht(t,i.rings,r,s)),e}function mAe(t,e,i,r,s){return v(i)&&(e.paths=yht(t,i.paths,r,s)),e}let _4t=class{constructor(e,i,r){this.uid=e,this.geometry=i,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}};function b4t(t){return v(t.geometry)}let w4t=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function T4t(t){var n;const e=lye.fromJSON(t.geometryType),i=mt.fromJSON(t.spatialReference),r=t.transform,s=t.features.map(o=>{const a=Sht(o,e,i,t.objectIdFieldName),l=a.geometry;if(v(l)&&r)switch(l.type){case"point":a.geometry=pAe(r,l,l,l.hasZ,l.hasM);break;case"multipoint":a.geometry=dAe(r,l,l,!!l.hasZ,!!l.hasM);break;case"polygon":a.geometry=fAe(r,l,l,!!l.hasZ,!!l.hasM);break;case"polyline":a.geometry=mAe(r,l,l,!!l.hasZ,!!l.hasM);break;case"extent":case"mesh":a.geometry=l}return a});return{geometryType:e,features:s,spatialReference:i,fields:((n=t.fields)==null?void 0:n.map(o=>UU.fromJSON(o)))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null}}function Sht(t,e,i,r){return{uid:Zc(),objectId:r&&t.attributes?t.attributes[r]:null,attributes:t.attributes,geometry:Eht(t.geometry,e,i),visible:!0}}function Eht(t,e,i){if(C(t))return null;switch(e){case"point":{const r=t;return{x:r.x,y:r.y,z:r.z,m:r.m,hasZ:r.z!=null,hasM:r.m!=null,type:"point",spatialReference:i}}case"polyline":{const r=t;return{paths:r.paths,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polyline",spatialReference:i}}case"polygon":{const r=t;return{rings:r.rings,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polygon",spatialReference:i}}case"multipoint":{const r=t;return{points:r.points,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"multipoint",spatialReference:i}}}}function _0(t,e,i,r){return{x:t,y:e,z:i,hasZ:i!=null,hasM:!1,spatialReference:r,type:"point"}}function Cht(t){if(C(t))return 0;let e=32;switch(t.type){case"point":e+=42;break;case"polyline":case"polygon":{let i=0;const r=2+(t.hasZ?1:0)+(t.hasM?1:0),s=t.type==="polyline"?t.paths:t.rings;for(const n of s)i+=n.length;e+=8*i*r+64,e+=128*i,e+=34,e+=32*(s.length+1);break}case"multipoint":{const i=2+(t.hasZ?1:0)+(t.hasM?1:0),r=t.points.length;e+=8*r*i+64,e+=128*r,e+=34,e+=32;break}case"extent":e+=98,t.hasM&&(e+=32),t.hasZ&&(e+=32);break;case"mesh":e+=ZI(t.vertexAttributes.position),e+=ZI(t.vertexAttributes.normal),e+=ZI(t.vertexAttributes.uv),e+=ZI(t.vertexAttributes.tangent)}return e}function S4t(t){let e=32;return e+=B_e(t.attributes),e+=3,e+=8+Cht(t.geometry),e}function Aht(t){if(C(t))return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const i of t.paths)e+=i.length;return e}case"polygon":{let e=0;for(const i of t.rings)e+=i.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function E4t(t){if(C(t))return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function C4t(t,e){switch($r(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let i=0;i<t.paths.length;i++)IV(e,t.paths[i],!!t.hasZ);break;case"polygon":for(let i=0;i<t.rings.length;i++)IV(e,t.rings[i],!!t.hasZ);break;case"multipoint":IV(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}}function Oht(t,e){switch(yd(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let i=0;i<t.paths.length;i++)PV(e,t.paths[i]);break;case"polygon":for(let i=0;i<t.rings.length;i++)PV(e,t.rings[i]);break;case"multipoint":PV(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function A4t(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}function gAe(t){return"declaredClass"in t}function hce(t){return"declaredClass"in t}function Rht(t){return"declaredClass"in t}function Mht(t,e){return t?Rht(t)?t:new ha({layer:e,sourceLayer:e,visible:t.visible,symbol:ae(t.symbol),attributes:ae(t.attributes),geometry:yAe(t.geometry)}):null}function yAe(t){return C(t)?null:gAe(t)?t:Gy(Pht(t))}function Pht(t){const{wkid:e,wkt:i,latestWkid:r}=t.spatialReference,s={wkid:e,wkt:i,latestWkid:r};switch(t.type){case"point":{const{x:n,y:o,z:a,m:l}=t;return{x:n,y:o,z:a,m:l,spatialReference:s}}case"polygon":{const{rings:n,hasZ:o,hasM:a}=t;return{rings:dce(n),hasZ:o,hasM:a,spatialReference:s}}case"polyline":{const{paths:n,hasZ:o,hasM:a}=t;return{paths:dce(n),hasZ:o,hasM:a,spatialReference:s}}case"extent":{const{xmin:n,xmax:o,ymin:a,ymax:l,zmin:c,zmax:h,mmin:p,mmax:f,hasZ:m,hasM:y}=t;return{xmin:n,xmax:o,ymin:a,ymax:l,zmin:c,zmax:h,mmin:p,mmax:f,hasZ:m,hasM:y,spatialReference:s}}case"multipoint":{const{points:n,hasZ:o,hasM:a}=t;return{points:vAe(n)?_Ae(n):n,hasZ:o,hasM:a,spatialReference:s}}default:return}}function dce(t){return Iht(t)?t.map(e=>_Ae(e)):t}function _Ae(t){return t.map(e=>Array.from(e))}function Iht(t){for(const e of t)if(e.length!==0)return vAe(e);return!1}function vAe(t){return t.length>0&&(PY(t[0])||IY(t[0]))}function $ht(t,e){if(!t)return null;let i;if(hce(t)){if(e==null)return t.clone();if(hce(e))return e.copy(t)}return e!=null?(i=e,i.x=t.x,i.y=t.y,i.spatialReference=t.spatialReference,t.hasZ?(i.z=t.z,i.hasZ=t.hasZ):(i.z=void 0,i.hasZ=!1),t.hasM?(i.m=t.m,i.hasM=!0):(i.m=void 0,i.hasM=!1)):(i=_0(t.x,t.y,t.z,t.spatialReference),t.hasM&&(i.m=t.m,i.hasM=!0)),i}function O4t(t){const{wkid:e,wkt:i,latestWkid:r}=t,s={wkid:e,wkt:i,latestWkid:r};return mt.fromJSON(s)}const X9=oe.getLogger("esri.layers.support.labelFormatUtils"),Y9={type:"simple",evaluate:()=>null},Lht={getAttribute:(t,e)=>t.field(e)};async function bAe(t,e,i){if(!t||!t.symbol||!e)return Y9;const r=t.where,s=WU(t),n=r?await ee(()=>import("./WhereClause-d3d68e94.js").then(a=>a.W),["./WhereClause-d3d68e94.js","./executionError-fb3f283a.js"],import.meta.url):null;let o;if(s.type==="arcade"){const a=await s5e(s.expression,i,e);if(C(a))return Y9;o={type:"arcade",evaluate(l){try{const c=a.evaluate({$feature:"attributes"in l?a.repurposeFeature(l):l});if(c!=null)return c.toString()}catch{X9.error(new W("arcade-expression-error","Encountered an error when evaluating label expression for feature",{feature:l,expression:s}))}return null},needsHydrationToEvaluate:()=>SK(s.expression)==null}}else o={type:"simple",evaluate:a=>s.expression.replace(/{[^}]*}/g,l=>{const c=l.slice(1,-1),h=e.get(c);if(!h)return l;let p=null;return"attributes"in a?a&&a.attributes&&(p=a.attributes[h.name]):p=a.field(h.name),p==null?"":wAe(p,h)})};if(r){let a;try{a=n.WhereClause.create(r,e)}catch(c){return X9.error(new W("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:r,error:c})),Y9}const l=o.evaluate;o.evaluate=c=>{const h="attributes"in c?void 0:Lht;try{if(a.testFeature(c,h))return l(c)}catch(p){X9.error(new W("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:r,feature:c,error:p}))}return null}}return o}function wAe(t,e){if(t==null)return"";const i=e.domain;if(i){if(i.type==="codedValue"||i.type==="coded-value"){const s=t;for(const n of i.codedValues)if(n.code===s)return n.name}else if(i.type==="range"){const s=+t,n="range"in i?i.range[0]:i.minValue,o="range"in i?i.range[1]:i.maxValue;if(n<=s&&s<=o)return i.name}}let r=t;return e.type==="date"||e.type==="esriFieldTypeDate"?r=Vm(r,Y6("short-date")):X6(e)&&(r=km(+r)),r||""}const R4t=Object.freeze(Object.defineProperty({__proto__:null,createLabelFunction:bAe,formatField:wAe},Symbol.toStringTag,{value:"Module"}));let xAe=class{constructor(e=null,i="center",r="center",s=null,n=[0,0,0],o=0,a=[0,0,0,1],l=[0,0],c="world",h=0,p=0){this.verticalOffset=e,this.horizontalPlacement=i,this.verticalPlacement=r,this.text=s,this.translation=n,this.elevationOffset=o,this.centerOffset=a,this.screenOffset=l,this.centerOffsetUnits=c,this.displayWidth=h,this.displayHeight=p}};function lee(t,e){if(t.type==="point")return j0(t,e,!1);if(gAe(t))switch(t.type){case"extent":return j0(t.center,e,!1);case"polygon":return j0(t.centroid,e,!1);case"polyline":return j0(pce(t),e,!0);case"mesh":return j0(t.origin,e,!1)}else switch(t.type){case"extent":return j0(Dht(t),e,!0);case"polygon":return j0(Nht(t),e,!0);case"polyline":return j0(pce(t),e,!0)}}function pce(t){const e=t.paths[0];if(!e||e.length===0)return null;const i=Wge(e,qge(e)/2);return _0(i[0],i[1],i[2],t.spatialReference)}function Dht(t){return _0(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function Nht(t){const e=t.rings[0];if(!e||e.length===0)return null;const i=uZ(t.rings,!!t.hasZ);return _0(i[0],i[1],i[2],t.spatialReference)}function j0(t,e,i){const r=i?t:$ht(t);return e&&t?wVe(t,r,e)?r:null:r}function P4t(t,e,i,r=0){if(t){e||(e=ci());const s=t;let n=.5*s.width*(i-1),o=.5*s.height*(i-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),nr(e,s.xmin-n-r,s.ymin-o-r,s.xmax+n+r,s.ymax+o+r),e}return null}function TAe(t,e){for(let i=0;i<t.geometries.length;++i){const r=t.geometries[i].getMutableAttribute(A.AUXPOS1);r&&r.data[3]!==e&&(r.data[3]=e,t.geometryVertexAttrsUpdated(t.geometries[i]))}}function o3(t,e){const i=sI(ed);return v(t)&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),v(e)?i[3]=e:v(t)&&t.length>3&&(i[3]=t[3]),i}function I4t(t,e,i,r,s,n=[0,0,0,0]){for(let o=0;o<3;++o)v(t)&&t[o]!=null?n[o]=t[o]:v(i)&&i[o]!=null?n[o]=i[o]:n[o]=s[o];return v(e)?n[3]=e:v(r)?n[3]=r:n[3]=s[3],n}function fce(t=_m,e,i,r=1){const s=new Array(3);if(C(e)||C(i))s[0]=1,s[1]=1,s[2]=1;else{let n,o=0;for(let a=2;a>=0;a--){const l=t[a];let c;const h=l!=null,p=a===0&&!n&&!h,f=i[a];l==="symbol-value"||p?c=f!==0?e[a]/f:1:h&&l!=="proportional"&&isFinite(l)&&(c=f!==0?l/f:1),c!=null&&(s[a]=c,n=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)s[a]==null?s[a]=n:s[a]===0&&(s[a]=.001*o)}for(let n=2;n>=0;n--)s[n]/=r;return Kl(s)}function Fht(t){return t.isPrimitive!=null}function $8(t){return X5(Fht(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function X5(t){if(Array.isArray(t)){for(const e of t)if(!X5(e))return!1;return!0}return t==null||t>=0}function Uht(t,e,i,r=We()){const s=t||0,n=e||0,o=i||0;return s!==0&&cC(r,r,-s/180*Math.PI),n!==0&&lC(r,r,n/180*Math.PI),o!==0&&mU(r,r,o/180*Math.PI),r}function cee(t,e,i){if(i.minDemResolution!=null)return i.minDemResolution;const r=_l(e),s=oT(t)*r,n=aT(t)*r,o=g1(t)*(e.isGeographic?1:r);return s===0&&n===0&&o===0?i.minDemResolutionForPoints:.01*Math.max(s,n,o)}function SAe(t,e,i,r,s,n,o,a,l,c,h){const p=qht[h.mode];let f,m,y=0;if(Es(t,e,i,r,l.spatialReference,s,a))return p.requiresAlignment(h)?(y=p.applyElevationAlignmentBuffer(r,s,n,o,a,l,c,h),f=n,m=o):(f=r,m=s),Es(f,l.spatialReference,m,n,c.spatialReference,o,a)?y:void 0}function CA(t,e,i,r,s){const n=(F5(t)?t.z:VEe(t)?t.array[t.offset+2]:t[2])||0;switch(i.mode){case"on-the-ground":{const o=Gt(wm(e,t,"ground"),0);return s.verticalDistanceToGround=0,s.sampledElevation=o,void(s.z=o)}case"relative-to-ground":{const o=Gt(wm(e,t,"ground"),0),a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"relative-to-scene":{const o=Gt(wm(e,t,"scene"),0),a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"absolute-height":{const o=i.geometryZWithOffset(n,r),a=Gt(wm(e,t,"ground"),0);return s.verticalDistanceToGround=o-a,s.sampledElevation=a,void(s.z=o)}default:return void(s.z=0)}}function Vht(t,e,i,r){return CA(t,e,i,r,iE),iE.z}function II(t,e,i){return e==null||i==null?t.definedChanged:e==="on-the-ground"&&i==="on-the-ground"?t.staysOnTheGround:e===i||e!=="on-the-ground"&&i!=="on-the-ground"?Ss.UPDATE:t.onTheGroundChanged}function Sd(t){return t==="relative-to-ground"||t==="relative-to-scene"}function c1(t){return t!=="absolute-height"}function kht(t,e,i,r,s){CA(e,i,s,r,iE),TAe(t,iE.verticalDistanceToGround);const n=iE.sampledElevation,o=Xn(Wht,t.transformation);return $L[0]=e.x,$L[1]=e.y,$L[2]=iE.z,Jp(e.spatialReference,$L,o,r.spatialReference)?t.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function Bht(t,e,i,r,s,n){let o=0;const a=n.spatialReference;e*=3,r*=3;for(let l=0;l<s;++l){const c=t[e+0],h=t[e+1],p=t[e+2],f=Gt(n.getElevation(c,h,p,a,"ground"),0);o+=f,i[r+0]=c,i[r+1]=h,i[r+2]=f,e+=3,r+=3}return o/s}function zht(t,e,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=n.spatialReference;e*=3,r*=3;for(let f=0;f<s;++f){const m=t[e+0],y=t[e+1],_=t[e+2],b=Gt(n.getElevation(m,y,_,p,"ground"),0);l+=b,i[r+0]=m,i[r+1]=y,i[r+2]=h==null?_+b+c:b+c,e+=3,r+=3}return l/s}function Ght(t,e,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=n.spatialReference;e*=3,r*=3;for(let f=0;f<s;++f){const m=t[e+0],y=t[e+1],_=t[e+2],b=Gt(n.getElevation(m,y,_,p,"scene"),0);l+=b,i[r+0]=m,i[r+1]=y,i[r+2]=h==null?_+b+c:b+c,e+=3,r+=3}return l/s}function jht(t){const e=t.meterUnitOffset,i=t.featureExpressionInfoContext;return e!==0||i!=null}function Hht(t,e,i,r,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;e*=3,r*=3;for(let h=0;h<s;++h){const p=t[e+0],f=t[e+1],m=t[e+2];i[r+0]=p,i[r+1]=f,i[r+2]=c==null?m+l:l,e+=3,r+=3}return 0}let $I=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var Ss;(function(t){t[t.NONE=0]="NONE",t[t.UPDATE=1]="UPDATE",t[t.RECREATE=2]="RECREATE"})(Ss||(Ss={}));const qht={"absolute-height":{applyElevationAlignmentBuffer:Hht,requiresAlignment:jht},"on-the-ground":{applyElevationAlignmentBuffer:Bht,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:zht,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:Ght,requiresAlignment:()=>!0}},Wht=We(),iE=new $I,$L=M();function uee(t){return v(t.mapPositions)}function EAe(t,e,i,r,s){const n=t.stageObject,o=n.geometries;let a=0;for(const l of o){if(!uee(l))continue;const{update:c,averageGeometrySampledElevation:h}=AAe(l,e,i,r,s);a+=h,c&&n.geometryVertexAttrsUpdated(l)}return a/o.length}function xP(t,e,i,r,s){var p;const n=t.stageObject,o=e.centerPointInElevationSR;let a=0;(p=n.metadata)!=null&&p.usesVerticalDistanceToGround?(r(o,ec),TAe(n,ec.verticalDistanceToGround),a=ec.sampledElevation):(r(o,ec),e.mode!=="absolute-height"&&(a=ec.sampledElevation));const l=Xn(Xht,n.transformation),c=fe(CAe,l[12],l[13],l[14]);Ji.TESTS_DISABLE_OPTIMIZATIONS?(Ql[0]=o.x,Ql[1]=o.y,Ql[2]=ec.z,Jp(o.spatialReference,Ql,l,s.spatialReference)&&(n.transformation=l)):s.setAltitudeOfTransformation(ec.z,l);const h=hee/s.unitInMeters;return(Math.abs(l[12]-c[0])>=h||Math.abs(l[13]-c[1])>=h||Math.abs(l[14]-c[2])>=h)&&(n.transformation=l),a}const Xht=We();function Yht(t,e,i,r,s){const n=t.graphics3DSymbolLayer.lodRenderer;if(C(n))return 0;const o=e.centerPointInElevationSR;r(o,ec);const a=e.mode!=="absolute-height"?ec.sampledElevation:0,l=n.instanceData,c=t.instanceIndex,h=Jht;l.getGlobalTransform(c,h);const p=fe(CAe,h[12],h[13],h[14]);Ji.TESTS_DISABLE_OPTIMIZATIONS?(Ql[0]=o.x,Ql[1]=o.y,Ql[2]=ec.z,Jp(o.spatialReference,Ql,h,s.spatialReference)&&l.setGlobalTransform(c,h)):s.setAltitudeOfTransformation(ec.z,h);const f=hee/s.unitInMeters;return(Ji.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(h[12]-p[0])>=f||Math.abs(h[13]-p[1])>=f||Math.abs(h[14]-p[2])>=f)&&l.setGlobalTransform(c,h),a}function Zht(t,e,i,r,s){const n=t.stageObject,o=n.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,h=!1;for(const p of o){if(!uee(p))continue;const f=p.vertexAttributes.get(A.POSITION);if(f!==l){const{update:m,averageGeometrySampledElevation:y}=AAe(p,e,i,r,s);c=y,l=f,h=m}h&&n.geometryVertexAttrsUpdated(p),a+=c}return a/o.length}const hee=.01,Ql=M(),uh=M(),qT=M(),Jht=We(),CAe=M(),ec=new $I;function AAe(t,e,i,r,s){let n=!1;const o=t.shaderTransformation,a=e.requiresSampledElevationInfo;uh[0]=o[12],uh[1]=o[13],uh[2]=o[14],t.invalidateBoundingInfo();const l=t.getMutableAttribute(A.POSITION),c=l.data,h=l.size,p=c.length/h,f=new UEe(t.mapPositions,i);let m=0,y=0;for(let _=0;_<p;_++){if(qT[0]=c[m],qT[1]=c[m+1],qT[2]=c[m+2],r(f,ec),a&&(y+=ec.sampledElevation),Ji.TESTS_DISABLE_OPTIMIZATIONS)c[m]=f.array[f.offset],c[m+1]=f.array[f.offset+1],c[m+2]=ec.z,Es(c,i,m,c,s.spatialReference,m,1),c[m]-=uh[0],c[m+1]-=uh[1],c[m+2]-=uh[2],n=!0;else{Ql[0]=c[m]+uh[0],Ql[1]=c[m+1]+uh[1],Ql[2]=c[m+2]+uh[2],s.setAltitude(Ql,ec.z),c[m]=Ql[0]-uh[0],c[m+1]=Ql[1]-uh[1],c[m+2]=Ql[2]-uh[2];const b=hee/s.unitInMeters;(Math.abs(qT[0]-c[m])>=b||Math.abs(qT[1]-c[m+1])>=b||Math.abs(qT[2]-c[m+2])>=b)&&(n=!0)}m+=h,f.offset+=3}return y/=p,{update:n,averageGeometrySampledElevation:y}}const Kht=oe.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function Qht(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function L4t(t){const e=t&&t.expression;if(typeof e=="string"){const i=MAe(e);if(i!=null)return{cachedResult:i}}return null}async function D4t(t,e,i,r){const s=t&&t.expression;if(typeof s!="string")return null;const n=MAe(s);if(n!=null)return{cachedResult:n};const o=await Um();gi(i);const a=o.arcadeUtils,l=a.createSyntaxTree(s);return a.dependsOnView(l)?(r!=null&&r.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:e}),modules:o}}}function OAe(t,e,i){return t.arcadeUtils.createFeature(e.attributes,e.geometry,i)}function dee(t,e){if(t!=null&&!RAe(t)){if(!e||!t.arcade)return void Kht.errorOncePerTick("Arcade support required but not provided");const i=e;i._geometry&&(i._geometry=yAe(i._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function edt(t){if(t!=null){if(RAe(t))return t.cachedResult;const e=t.arcade;let i=e==null?void 0:e.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof i!="number"&&(t.cachedResult=0,i=0),i}return 0}function N4t(t,e=!1){let i=t&&t.featureExpressionInfo;const r=i&&i.expression;return e||r==="0"||(i=null),i??null}const tdt={cachedResult:0};function RAe(t){return t.cachedResult!=null}function MAe(t){return t==="0"?0:null}let cf=class PAe{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=NWe(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,i){const r=this.calculateOffsetRenderUnits(i);return this.featureExpressionInfoContext!=null?r:e+r}calculateOffsetRenderUnits(e){let i=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return r!=null&&(i+=edt(r)*this._metersPerElevationInfoUnit),i/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=DWe(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=Gt(e.offset,0)}updateFeatureExpressionInfoContext(e,i,r){if(C(e))return void(this._featureExpressionInfoContext=null);const s=e&&e.arcade;s&&v(i)&&v(r)?(this._featureExpressionInfoContext=Qht(e),dee(this._featureExpressionInfoContext,OAe(s.modules,i,r))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const i=new PAe;return v(e)&&i.setFromElevationInfo(e),i}},idt=class{constructor(e,i,r){this.graphic=e,this.renderingInfo=i,this.layer=r}};var pi;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OPAQUE=2]="OPAQUE"})(pi||(pi={}));let rdt=class{constructor(e,i,r){this.baseMaterial=e,this.edgeMaterials=i,this.properties=r}},og=class{get isElevationSource(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}constructor(e,i,r,s,n,o,a,l=null){this.graphics3DSymbolLayer=e,this.stageObject=i,this._uniqueGeometries=r,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e,i){this._stageLayer=i,this._stage=e,e.addMany(this._uniqueMaterials),e.addMany(this._uniqueGeometries),e.add(this.stageObject)}destroy(){const e=this._stage;this._stageLayer&&(e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries)),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const i=this._stage.renderer.ensureEdgeView();i.hasObject(this.stageObject)&&i.removeObject(this.stageObject),this.stageObject.dispose(),v(this._sharedResource)&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null,this._stage=null}layerOpacityChanged(e,i){if(C(this._edgeState))return;const r=mce(this._edgeState.baseMaterial);let s=!1;for(const n of this._edgeState.edgeMaterials)n.objectTransparency!==r&&(n.objectTransparency=r,s=!0);s&&this._resetEdgeObject(i),this._stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e])}slicePlaneEnabledChanged(e,i){C(this._edgeState)||(this._stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:e},!i),this._edgeState.properties.hasSlicePlane=e)}setVisibility(e){if(this._stage!=null&&this._visible!==e&&(this._visible=e,this.stageObject.visible=e,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),v(this._edgeState))){const i=this._stage.renderer.ensureEdgeView();i.hasObject(this.stageObject)?i.updateObjectVisibility(this.stageObject,e):e&&this._addOrUpdateEdgeObject(i,!1)}}get visible(){return this._visible}alignWithElevation(e,i,r,s){if(this.elevationAligner==null)return;v(r)&&dee(this.elevationContext.featureExpressionInfoContext,r);const n=(o,a)=>CA(o,e,this.elevationContext,i,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,n,i),this._resetEdgeObject(s)}alignWithAbsoluteElevation(e,i,r){const s=(n,o)=>{o.sampledElevation=e,o.verticalDistanceToGround=0,o.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,s,i),this._resetEdgeObject(r)}getCenterObjectSpace(e=M()){return he(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=Nn()){const i=this.stageObject.boundingVolumeObjectSpace;return Qye(e,i.min),e0e(e,i.max),e}computeAttachmentOrigin(e){if(this.useObjectOriginAsAttachmentOrigin){const i=this.stageObject.transformation;e.render.origin[0]+=i[12],e.render.origin[1]+=i[13],e.render.origin[2]+=i[14],e.render.num++}else for(const i of this.stageObject.geometries)i.computeAttachmentOrigin(bg)&&(ut(bg,bg,this.stageObject.transformation),ve(e.render.origin,e.render.origin,bg),e.render.num++)}async getProjectedBoundingBox(e,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=sdt,l=$Z(o)?1:a.length;for(let h=0;h<l;h++){const p=a[h];H0[0]=o[p[0]],H0[1]=o[p[1]],H0[2]=o[p[2]],ut(H0,H0,this.stageObject.transformation),W1[3*h+0]=H0[0],W1[3*h+1]=H0[1],W1[3*h+2]=H0[2]}if(!e(W1,0,l))return null;$r(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],W1[h+p]),o[p+3]=Math.max(o[p+3],W1[h+p]);c&&r.push({location:W1.slice(h,h+3),screenSpaceBoundingRect:c})}if(i&&i.service&&this.elevationContext.mode!=="absolute-height"){Mp(o,bg);const h=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let p=0;if(i.useViewElevation)p=Gt(i.service.getElevation(bg[0],bg[1],h),0);else try{const f=cee(o,i.service.spatialReference,i);p=Gt(await i.service.queryElevation(bg[0],bg[1],s,f,h),0)}catch{}Kye(o,0,0,-this.alignedSampledElevation+p)}return o}addObjectState(e,i){e===Zy.Highlight&&i.addObject(this.stageObject,this.stageObject.highlight()),e===Zy.MaskOccludee&&i.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}_resetEdgeObject(e){if(C(this._edgeState))return;const i=this._stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(i,e):i.removeObject(this.stageObject)}_addOrUpdateEdgeObject(e,i){const r=this._edgeState;if(C(r))return;const s=mce(r.baseMaterial);for(const n of r.edgeMaterials)n.objectTransparency=s;e.addOrUpdateObject3D(this.stageObject,r.edgeMaterials,r.properties,!i).then(()=>{var n;return(n=this._stageLayer)==null?void 0:n.sync()})}};function mce(t){return t.isVisible()?t.parameters.transparent?pi.TRANSPARENT:pi.OPAQUE:pi.INVISIBLE}const W1=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],H0=M(),bg=M(),sdt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let IAe=class{constructor(e,i=null){this.labelText=i,this.elevationOffset=Gt(e,0)}};var $n;(function(t){t[t.Recreate_Symbol=0]="Recreate_Symbol",t[t.Recreate_Graphics=1]="Recreate_Graphics",t[t.Fast_Update=2]="Fast_Update"})($n||($n={}));let pee=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=Uu.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,i){return this._loadStatus===Uu.LOADED?(e&&e(),Gt(this._loader,Promise.resolve())):this._loadStatus===Uu.FAILED?(i&&i(this._loadError),Gt(this._loader,Promise.resolve())):(C(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=Uu.LOADED},r=>{throw this._loadError=r,this._abortController=null,this._loadStatus=Uu.FAILED,!ln(r)&&this.logger&&r.message&&this.logger.warn(r.message),r})),this._loader.then(e,i).catch(()=>{}),this._loader)}abortLoad(){v(this._abortController)?this._abortController=hd(this._abortController):this._loadStatus===Uu.LOADING&&(this._loadStatus=Uu.FAILED),this._loader=null}};var Uu;(function(t){t[t.LOADING=0]="LOADING",t[t.LOADED=1]="LOADED",t[t.FAILED=2]="FAILED"})(Uu||(Uu={}));const $Ae=3,YW=3,LAe=10;let DAe=class{constructor(e,i=null){this.geometry=e,this.textures=i}};function LL(t){const e=[];return t.levels.forEach(i=>i.components.forEach(r=>e.push(r.geometry.material))),kP(e)}function gce(t){const e=new Array;return t.levels.forEach(i=>{i.components.forEach(r=>{v(r.textures)&&e.push(...r.textures)})}),kP(e)}function NAe(t){const e=t.components.map(i=>i.geometry);return kP(e)}function yce(t){const e=[];return t.levels.forEach(i=>{i.components.forEach(r=>{e.push(r.geometry)})}),kP(e)}function ndt(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function FAe(t,e){const i=(r,s,n=!1)=>({levels:r.map(o=>{const a=s(o.tesselation);return n&&Krt(a),{components:[new DAe(a)],faceCount:a.indexCount/3,minScreenSpaceRadius:o.minScreenSpaceRadius}})});switch(t){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],r=>Yrt(e,.5,r,!0));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>krt(e,1));case"cone":return i(Z9,r=>$ae(e,1,.5,r,!1),!0);case"inverted-cone":return i(Z9,r=>$ae(e,1,.5,r,!0),!0);case"cylinder":return i(Z9,r=>Jrt(e,1,.5,r,[0,0,1],[0,0,.5]));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>Xrt(e,1),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>jrt(e,1),!0);default:return}}const Z9=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];function odt(t){return t.type==="fill"}function adt(t){return t.type==="extrude"}function ldt(t){return t&&t.enabled&&(adt(t)||odt(t))&&v(t.edges)}function cdt(t){return t&&t.enabled&&t.edges||null}function UAe(t,e){return udt(cdt(t),e)}function udt(t,e){if(C(t))return null;const i=v(t.color)?cJ(ot.toUnitRGBA(t.color)):si(0,0,0,0),r=ko(t.size),s=ko(t.extensionLength);switch(t.type){case"solid":return hdt({color:i,size:r,extensionLength:s,...e});case"sketch":return ddt({color:i,size:r,extensionLength:s,...e});default:return}}function hdt(t){return{...pdt,...t,type:"solid"}}function ddt(t){return{...fdt,...t,type:"sketch"}}const pdt={color:si(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:pi.OPAQUE,hasSlicePlane:!1},fdt={color:si(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:pi.OPAQUE,hasSlicePlane:!1},fee={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function G4t(t){return t.type==="web-style"?fee:mee(t.symbolLayers.toArray().map(e=>VAe(t,e)))}function mee(t){let e=0,i=0,r=0,s=!1,n=0;const o={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const a of t)C(a)||(e+=a.primitivesPerFeature,i+=a.primitivesPerCoordinate,r+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.bytesPerCoordinate+=a.memory.bytesPerCoordinate,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.draped.bytesPerCoordinate+=a.memory.bytesPerCoordinate,s=s||a.estimated,++n);return{primitivesPerFeature:e,primitivesPerCoordinate:i,drawCallsPerFeature:r,estimated:s,memory:o,numComplexities:n}}function j4t(t){const e=mee(t);return e.numComplexities>0&&(e.primitivesPerFeature/=e.numComplexities,e.primitivesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.bytesPerCoordinate/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities,e.memory.draped.bytesPerCoordinate/=e.numComplexities),e}const _ce={};function VAe(t,e){const i=kAe(t,e),r=ldt(e)?2:0;switch(e.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:r,estimated:!1,memory:i};case"fill":return t.type==="mesh-3d"?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:r,estimated:!1,memory:i}:v(e.outline)&&e.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:i}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:i};case"object":return e.resource&&e.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:i}:{...mdt(e.resource&&e.resource.primitive||M0e),memory:i};case"path":{let s=0,n=0;switch(e.profile){case"circle":s=LAe;break;case"quad":s=4;break;default:return void(e.profile,void 0)}switch(e.join??"simple"){case"round":n=$Ae;break;case"miter":case"bevel":n=1;break;default:return}const o=2*s,a=s*n*2;let l=-2*a-o;switch(e.cap){case"none":break;case"butt":case"square":l+=2*(s-1);break;case"round":l+=2*(s*(YW-1)*2+s);break;default:return}return{primitivesPerFeature:l,primitivesPerCoordinate:a+o,drawCallsPerFeature:0,estimated:!1,memory:i}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:i};default:return}}function kAe(t,e){const i=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?Ol.EXTRUDE_EDGES:Ol.EXTRUDE;case"fill":return v(e.outline)&&e.outline.size>0?Ol.FILL_OUTLINE:Ol.FILL;case"water":return Ol.FILL;case"line":return e.join==="round"?Ol.LINE_ROUND:Ol.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return Ol.PATH_ROUND_CIRCLE;case"quad":return Ol.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return Ol.PATH_MITER_CIRCLE;case"quad":return Ol.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return i?Ol.OBJECT_POINT:Ol.OBJECT_POLYGON;case"icon":case"text":return i?Ol.ICON_POINT:Ol.ICON_POLYGON;default:return}}function mdt(t){let e=_ce[t];if(e)return e;const i=FAe(t,null);return e={primitivesPerFeature:NAe(i.levels[0]).reduce((r,s)=>r+s.indices.get(A.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},_ce[t]=e,e}const Ol={ICON_POINT:{bytesPerFeature:3293.7707557538765,bytesPerFeatureLabel:1020.2764,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:2213.51585392203,bytesPerFeatureLabel:1008.84664,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:4745.397589234022,bytesPerFeatureLabel:1006.5440666666666,bytesPerCoordinate:3.8971910718981526,resourceBytes:0,draped:{bytesPerFeature:3711.9299672493826,bytesPerFeatureLabel:991.1003999999999,bytesPerCoordinate:3.916858016273668}},OBJECT_POINT:{bytesPerFeature:1751.6405617660876,bytesPerFeatureLabel:1024.7827699999998,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:1751.6405617660876,bytesPerFeatureLabel:1024.7827699999998,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:3265.877223973855,bytesPerFeatureLabel:1002.3207366666666,bytesPerCoordinate:4.003101524580855,resourceBytes:0,draped:{bytesPerFeature:3265.877223973855,bytesPerFeatureLabel:1002.3207366666666,bytesPerCoordinate:4.003101524580855}},LINE_MITER:{bytesPerFeature:5757.019675077085,bytesPerFeatureLabel:998.6150266666667,bytesPerCoordinate:24.456810187064043,resourceBytes:0,draped:{bytesPerFeature:4101.480288021862,bytesPerFeatureLabel:1007.7540599999999,bytesPerCoordinate:18.25629912730874}},LINE_ROUND:{bytesPerFeature:5770.95297166408,bytesPerFeatureLabel:1017.77396,bytesPerCoordinate:24.60919037084966,resourceBytes:0,draped:{bytesPerFeature:4089.5796612121826,bytesPerFeatureLabel:987.8320266666666,bytesPerCoordinate:18.43599029126731}},PATH_MITER_CIRCLE:{bytesPerFeature:36120.81813311945,bytesPerFeatureLabel:977.3815,bytesPerCoordinate:2713.2216607858863,resourceBytes:0,draped:{bytesPerFeature:36120.81813311945,bytesPerFeatureLabel:977.3815,bytesPerCoordinate:2713.2216607858863}},PATH_ROUND_CIRCLE:{bytesPerFeature:23268.96777866874,bytesPerFeatureLabel:985.2637,bytesPerCoordinate:5284.873051323177,resourceBytes:0,draped:{bytesPerFeature:23268.96777866874,bytesPerFeatureLabel:985.2637,bytesPerCoordinate:5284.873051323177}},PATH_MITER_QUAD:{bytesPerFeature:24548.629753007182,bytesPerFeatureLabel:964.6924,bytesPerCoordinate:2114.107276663994,resourceBytes:0,draped:{bytesPerFeature:24548.629753007182,bytesPerFeatureLabel:964.6924,bytesPerCoordinate:2114.107276663994}},PATH_ROUND_QUAD:{bytesPerFeature:34316.219663191616,bytesPerFeatureLabel:975.7985,bytesPerCoordinate:3331.3952550120293,resourceBytes:0,draped:{bytesPerFeature:34316.219663191616,bytesPerFeatureLabel:975.7985,bytesPerCoordinate:3331.3952550120293}},FILL:{bytesPerFeature:6141.501452970723,bytesPerFeatureLabel:1008.2056066666665,bytesPerCoordinate:9.669541106191478,resourceBytes:0,draped:{bytesPerFeature:4615.812654782311,bytesPerFeatureLabel:1004.2114200000001,bytesPerCoordinate:7.378043214430644}},FILL_OUTLINE:{bytesPerFeature:9038.575581319641,bytesPerFeatureLabel:1017.9996066666668,bytesPerCoordinate:14.96569682175086,resourceBytes:0,draped:{bytesPerFeature:6369.386021594582,bytesPerFeatureLabel:1008.9863733333334,bytesPerCoordinate:10.25287774000214}},EXTRUDE:{bytesPerFeature:20071.2337049912,bytesPerFeatureLabel:1019.49468,bytesPerCoordinate:49.39369614206849,resourceBytes:0,draped:{bytesPerFeature:20071.2337049912,bytesPerFeatureLabel:1019.49468,bytesPerCoordinate:49.39369614206849}},EXTRUDE_EDGES:{bytesPerFeature:22300.21739345088,bytesPerFeatureLabel:1017.4348466666665,bytesPerCoordinate:49.40242281963031,resourceBytes:0,draped:{bytesPerFeature:22300.21739345088,bytesPerFeatureLabel:1017.4348466666665,bytesPerCoordinate:49.40242281963031}}},WT=oe.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let ag=class extends pee{constructor(e,i,r,s){super(r.schedule),this.symbol=e,this.symbolLayer=i,this._context=r,this._elevationInfoOverride=null,this._ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=WT,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new cf,this.complexity=this.computeComplexity(),this._ignoreDrivers=s.ignoreDrivers,this._ignoreDrivers||(this._drivenProperties=vce(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(e){if(this._ignoreDrivers)return!1;const i=this._drivenProperties,r=vce(e);return r.color!==i.color||r.opacity!==i.opacity||r.opacityAlwaysOpaque!==i.opacityAlwaysOpaque||r.size!==i.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,i,r,s){const n=e.projectionSuccess,o="polygons"in e?e.polygons:null,a=`${s} geometry failed to be created`;let l=null;n?!this._logGeometryValidationWarnings(i,r,s)&&o&&o.length===0&&r==="rings"&&i.length>0&&i[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (failed to project geometry to view spatial reference)`,l&&WT.warnOncePerTick(l)}_logGeometryValidationWarnings(e,i,r){const s=`${r} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(WT.warnOncePerTick(`${s} (no ${i} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(WT.warnOncePerTick(`${s} (${i} should be defined as a 2D array)`),!0)}_validateGeometry(e,i=null,r=null){if(v(i)&&!i.includes(e.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${e.type}`),!1;if(e.type==="point"){const s=e;if(!isFinite(s.x)||!isFinite(s.y))return WT.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return gdt}_defaultElevationInfoZ(){return ydt}_updateElevationContext(){v(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,i=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||i.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,i){const r=e.geometry,s=this.getDefaultElevationInfo(r);i.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,i.mode=this.getGeometryElevationMode(r,s),i.offsetMeters=Gt(this._elevationContext.meterUnitOffset,Gt(s.offset,0));const n=!this._elevationOptions.supportsOnTheGround&&i.mode==="on-the-ground";n&&(i.mode="relative-to-ground",i.offsetMeters=0);const o=n?tdt:this._elevationContext.featureExpressionInfoContext;return i.updateFeatureExpressionInfoContext(o,e,this._context.layer),i}prepareSymbolLayerPatch(e){}updateGeometry(e,i){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,i=bce){let r=1;return this.draped||(r*=this._getLayerOpacity()),this._drivenProperties.opacity||(v(e)?r*=e.a:i.hasIntrinsicColor||(r=0)),r}_getCombinedOpacityAndColor(e,i=bce){const r=this._getCombinedOpacity(e,i);if(this._drivenProperties.color)return o3(null,r);const s=v(e)?ot.toUnitRGB(e):_m;return o3(s,r)}_getVertexOpacityAndColor(e,i=null){const r=this._drivenProperties.color?e.color:null,s=this._drivenProperties.opacity?e.opacity:null,n=o3(r,s);return v(i)&&(n[0]*=i,n[1]*=i,n[2]*=i,n[3]*=i),n}isFastUpdatesEnabled(){return this._fastUpdates&&this._fastUpdates.enabled}computeComplexity(){return VAe(this.symbol,this.symbolLayer)}globalPropertyChanged(e,i,r){switch(e){case"opacity":return this.layerOpacityChanged(i,r),!0;case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(i,r,s)!==Ss.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(i,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged();case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged();default:return!1}}updateGraphics3DGraphicElevationInfo(e,i,r){let s=Ss.UPDATE;return e.forEach(n=>{const o=i(n);if(v(o)){const a=n.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=r(o.elevationContext.mode)}else s=Ss.RECREATE}),s}applyRendererDiff(e,i){return $n.Recreate_Symbol}getFastUpdateAttrValues(e){if(!this._fastUpdates.enabled)return null;const i=this._fastUpdates.visualVariables,r=i.size?Iy(i.size.field,e):0,s=i.color?Iy(i.color.field,e):0,n=i.opacity?Iy(i.opacity.field,e):0;return si(r,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&WT.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>{var i,r,s,n,o,a,l,c,h,p,f,m;return{size:((s=(r=(i=this._fastUpdates)==null?void 0:i.visualVariables)==null?void 0:r.size)==null?void 0:s.field)??null,color:((a=(o=(n=this._fastUpdates)==null?void 0:n.visualVariables)==null?void 0:o.color)==null?void 0:a.field)??null,opacity:((h=(c=(l=this._fastUpdates)==null?void 0:l.visualVariables)==null?void 0:c.opacity)==null?void 0:h.field)??null,rotation:((m=(f=(p=this._fastUpdates)==null?void 0:p.visualVariables)==null?void 0:f.rotation)==null?void 0:m.field)??null}};return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function Iy(t,e){const i=t!=null?e.attributes[t]:0;return i!=null&&isFinite(i)?i:0}function vce(t){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(i=>{switch(i.type){case"color":if(e.color=!0,i.stops)for(let r=0;r<i.stops.length;r++){const s=i.stops[r].color;s&&(e.opacity=!0,s.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0}}),e}const gdt={mode:"on-the-ground",offset:0,unit:"meters"},ydt={mode:"absolute-height",offset:0,unit:"meters"},bce={hasIntrinsicColor:!1};let v0=class extends EI{get geometries(){return this._geometries}get transformation(){return this._transformation}set transformation(e){Xn(this._transformation,e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}constructor(e={}){super(),this.type=Vs.Object,this._geometries=new Array,this._transformation=We(),this._bvObjectSpace=new wce,this._bvWorldSpace=new wce,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=e.castShadow==null||e.castShadow,this.metadata=e.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new BAe);const i=e.geometries;v(i)&&(this._geometries=Array.from(i))}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){Ct(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._hasVolatileTransformation=this._hasVolatileTransformation||e.hasVolatileTransformation,this._emit("objectGeometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const i=this._geometries.splice(e,1)[0];i&&(this._emit("objectGeometryRemoved",{object:this,geometry:i}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(e){this._emit("objectGeometryUpdated",{object:this,geometry:e}),this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const i of this._geometries)i.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new E5(Zy.MaskOccludee);for(const i of this._geometries)i.occludees=TW(i.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const i of this._geometries)i.occludees=SW(i.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new E5(Zy.Highlight);for(const i of this._geometries)i.highlights=TW(i.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const i of this._geometries)i.highlights=SW(i.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,i){return Ts(i,this.transformation,e.transformation)}_getCombinedShaderTransformation(e){return Ts(We(),this.transformation,e.shaderTransformation)}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(const s of this._geometries){const n=s.boundingInfo;v(n)&&(xce(n,this._bvObjectSpace,s.shaderTransformation),xce(n,this._bvWorldSpace,this._getCombinedShaderTransformation(s)))}tn(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),tn(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const e=M(),i=M(),r=Lx(this.transformation);for(const s of this._geometries){const n=s.boundingInfo;if(C(n))continue;const o=s.shaderTransformation,a=Lx(o);ut(e,n.center,o);const l=Ar(e,this._bvObjectSpace.bounds),c=n.radius*a;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],l+c),ut(i,e,this.transformation);const h=Ar(i,this._bvWorldSpace.bounds),p=c*r;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],h+p)}this._bvDirty=!1}_invalidateBoundingVolume(){this._bvDirty=!0,v(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(e,i){v(this._parentLayer)&&this._parentLayer.events.emit(e,i)}get test(){const e=this;return{hasGeometry:i=>e._geometries.includes(i),getGeometryIndex:i=>e._geometries.indexOf(i)}}},BAe=class{constructor(){this.min=Xe(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Xe(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},wce=class extends BAe{constructor(){super(...arguments),this.bounds=gn()}init(){fe(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),fe(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),pve(this.bounds)}};function xce(t,e,i){const r=t.bbMin,s=t.bbMax;if(_U(i)){const n=fe(_dt,i[12],i[13],i[14]);ve(pu,r,n),ve(Fd,s,n);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],pu[o]),e.max[o]=Math.max(e.max[o],Fd[o])}else if(ut(pu,r,i),cl(r,s))for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],pu[n]),e.max[n]=Math.max(e.max[n],pu[n]);else{ut(Fd,s,i);for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],pu[n],Fd[n]),e.max[n]=Math.max(e.max[n],pu[n],Fd[n]);for(let n=0;n<3;++n){he(pu,r),he(Fd,s),pu[n]=s[n],Fd[n]=r[n],ut(pu,pu,i),ut(Fd,Fd,i);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],pu[o],Fd[o]),e.max[o]=Math.max(e.max[o],pu[o],Fd[o])}}}const _dt=M(),pu=M(),Fd=M();function gee(t,e,i,r,s,n){const o=t.clippingExtent;if(da(e,Av,t.elevationProvider.spatialReference),v(o)&&!PZ(o,Av))return null;da(e,Av,t.renderCoordsHelper.spatialReference);const a=t.localOriginFactory.getOrigin(Av),l=new v0({castShadow:!1,metadata:{layerUid:t.layer.uid,graphicUid:s,usesVerticalDistanceToGround:!0}});return i.shaderTransformer=n,i.localOrigin=a,l.addGeometry(i),{object:l,sampledElevation:kht(l,e,t.elevationProvider,t.renderCoordsHelper,r)}}function TP(t,e,i){const r=t.elevationContext,s=i.spatialReference;da(e,Av,s),r.centerPointInElevationSR=_0(Av[0],Av[1],e.hasZ?Av[2]:0,v(s)?s:null)}function SP(t){switch(t.type){case"point":return t;case"polygon":case"extent":return lee(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const i=Wge(e,qge(e)/2);return _0(i[0],i[1],i[2],t.spatialReference)}case"mesh":return t.origin}return null}const Av=M();function yee(){return new Float32Array(2)}function vdt(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function Xh(t,e){const i=new Float32Array(2);return i[0]=t,i[1]=e,i}function bdt(t,e){return new Float32Array(t,e,2)}function zAe(){return yee()}function GAe(){return Xh(1,1)}function jAe(){return Xh(1,0)}function HAe(){return Xh(0,1)}const qAe=zAe(),WAe=GAe(),wdt=jAe(),xdt=HAe();Object.freeze(Object.defineProperty({__proto__:null,ONES:WAe,UNIT_X:wdt,UNIT_Y:xdt,ZEROS:qAe,clone:vdt,create:yee,createView:bdt,fromValues:Xh,ones:GAe,unitX:jAe,unitY:HAe,zeros:zAe},Symbol.toStringTag,{value:"Module"}));function Tdt(t){const e=new Ui;e.include(yQ),e.include(CCe,t),e.include(en,t),e.attributes.add(A.UV0,"vec2");const{vertex:i,fragment:r}=e;return i.uniforms.add([new Si("viewport",(s,n)=>n.camera.fullViewport),new He("lineSize",(s,n)=>Math.ceil(s.size)*n.camera.pixelRatio),new zi("pixelToNDC",(s,n)=>It(Sce,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new He("borderSize",(s,n)=>v(s.borderColor)?n.camera.pixelRatio:0),new zi("screenOffset",(s,n)=>It(Sce,s.screenOffset[0]*n.camera.pixelRatio,s.screenOffset[1]*n.camera.pixelRatio))]),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),t.hasMultipassGeometry&&e.varyings.add("depth","float"),t.hasScreenSizePerspective&&E8(i),i.code.add(x`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${t.occlusionTestEnabled?x`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${t.hasScreenSizePerspective?x`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:x`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${t.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${t.depthHudEnabled?t.depthHudAlignStartEnabled?x`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:x`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?x`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:x`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),r.uniforms.add([new Si("uColor",s=>Tce(s.color)),new Si("borderColor",s=>Tce(s.borderColor))]),t.hasMultipassGeometry&&(r.include(Y2e,t),r.uniforms.add(new zi("inverseViewport",(s,n)=>n.inverseViewport))),r.code.add(x`
    void main() {
      ${t.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${t.depthHudEnabled?x`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:x`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),e}function Tce(t){return v(t)?t:Am}const Sce=et(),Sdt=Object.freeze(Object.defineProperty({__proto__:null,build:Tdt},Symbol.toStringTag,{value:"Module"}));let XAe=class YAe extends ji{initializeConfiguration(e,i){i.spherical=e.viewingMode===st.Global}initializeProgram(e){return new ki(e.rctx,YAe.shader.get().build(this.configuration),Li)}setPipelineState(e){const i=e?Dr.ALWAYS:Dr.LESS;return this.configuration.depthHudEnabled?Qt({depthTest:{func:i},depthWrite:pc}):Qt({blending:Yn(Ve.ONE,Ve.SRC_ALPHA,Ve.ONE_MINUS_SRC_ALPHA,Ve.ONE_MINUS_SRC_ALPHA),depthTest:{func:i},colorWrite:ui})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}};XAe.shader=new Vi(Sdt,()=>ee(()=>import("./LineCallout.glsl-9f8fc930.js"),[],import.meta.url));let Ph=class extends uo{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=ic.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}};u([z({count:ic.COUNT})],Ph.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([z()],Ph.prototype,"spherical",void 0),u([z()],Ph.prototype,"occlusionTestEnabled",void 0),u([z()],Ph.prototype,"hasVerticalOffset",void 0),u([z()],Ph.prototype,"hasScreenSizePerspective",void 0),u([z()],Ph.prototype,"depthHudEnabled",void 0),u([z()],Ph.prototype,"depthHudAlignStartEnabled",void 0),u([z()],Ph.prototype,"hasSlicePlane",void 0),u([z()],Ph.prototype,"hasMultipassGeometry",void 0),u([z({constValue:!0})],Ph.prototype,"hasSliceInVertexProgram",void 0),u([z({constValue:!1})],Ph.prototype,"isDraped",void 0);let DL=class ZW extends x1{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(e){super(e,new ZAe),this._configuration=new Ph,this._uniqueMaterialIdentifier=ZW.uniqueMaterialIdentifier(this.parameters)}getPassParameters(){return this.parameters}getConfiguration(e,i){const r=(i==null?void 0:i.slot)!==Fe.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=v(this.parameters.verticalOffset),this._configuration.hasScreenSizePerspective=v(this.parameters.screenSizePerspective),this._configuration.depthHudEnabled=r,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?ic.Screen:ic.World,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasMultipassGeometry=i.multipassGeometry.enabled,this._configuration}intersect(){}requiresSlot(e,i){if(i===k.Color)switch(e){case Fe.LINE_CALLOUTS:case Fe.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(e){return new Edt(e)}createBufferWriter(){return new Adt}validateParameters(e){const i=ZW.uniqueMaterialIdentifier(e);i!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=i)}static uniqueMaterialIdentifier(e){return JSON.stringify({screenOffset:e.screenOffset||[0,0],centerOffsetUnits:e.centerOffsetUnits||"world"})}},Edt=class extends w1{beginSlot(e){return this.ensureTechnique(XAe,e)}},ZAe=class extends TA{constructor(){super(...arguments),this.screenOffset=dc,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const Cdt=cs().vec3f(A.POSITION).vec3f(A.NORMAL).vec2f(A.UV0).vec4f(A.AUXPOS1),Ece=[Xh(0,0),Xh(1,0),Xh(0,1),Xh(1,0),Xh(1,1),Xh(0,1)];let Adt=class{constructor(){this.vertexBufferLayout=Cdt}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get(A.POSITION).length}write(e,i,r,s,n){C8(r.indices.get(A.POSITION),r.vertexAttributes.get(A.POSITION).data,e,s.position,n,6),eee(r.indices.get(A.NORMAL),r.vertexAttributes.get(A.NORMAL).data,i,s.normal,n,6),NC(r.indices.get(A.AUXPOS1),r.vertexAttributes.get(A.AUXPOS1).data,s.auxpos1,n,6);for(let o=0;o<Ece.length;++o)s.uv0.setVec(n+o,Ece[o])}},JAe=class KAe extends ag{constructor(e,i){super(e,null,i,Mdt),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new DL(this._materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(e){const i=this._materialParameters;return i.screenOffset=e.screenOffset||dc,i.centerOffsetUnits=e.centerOffsetUnits||"world",i}get _materialParameters(){const e=new ZAe,i=this.symbol,r=i.callout;if(e.color=v(r.color)?ot.toUnitRGBA(r.color):[0,0,0,0],e.color[3]*=this._getLayerOpacity(),e.size=ko(r.size||0),i.verticalOffset){const{screenLength:o,minWorldLength:a,maxWorldLength:l}=i.verticalOffset;e.verticalOffset={screenLength:ko(o),minWorldLength:a||0,maxWorldLength:v(l)?l:1/0}}e.borderColor=v(r.border)&&v(r.border.color)?ot.toUnitRGBA(r.border.color):null;const s=i.symbolLayers.getItemAt(0).type==="object",n=i.type==="label-3d";return e.occlusionTest=!s,e.shaderPolygonOffset=s?0:void 0,e.depthHUDAlignStart=n,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return Rdt}createGraphics3DGraphic(e){const i=e.renderingInfo,r=e.graphic,s=this.setGraphicElevationContext(r,new cf,i.elevationOffset||0),n=i.symbol,o=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(n.type!=="label-3d"&&o||n.type==="point-3d"&&n.symbolLayers.every(l=>l.type==="text"&&!N0e(l)))return null;const a=lee(r.geometry);return C(a)?null:this._createAs3DShape(a,s,i,r.uid)}layerOpacityChanged(){v(this._material)&&this._material.setParameters(this._materialParameters)}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=II(KAe.elevationModeChangeTypes,r,s);return n!==Ss.UPDATE||e.forEach(o=>{const a=i(o);v(a)&&this.updateGraphicElevationContext(o.graphic,a)}),n}slicePlaneEnabledChanged(){return C(this._material)||this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}setGraphicElevationContext(e,i,r=0){const s=super.setGraphicElevationContext(e,i);return s.addOffsetRenderUnits(r),s}updateGraphicElevationContext(e,i){this.setGraphicElevationContext(e,i.elevationContext,v(i.metadata)?i.metadata.elevationOffset:0),i.needsElevationUpdates=Sd(i.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:fee.memory}}_createVertexData(e){const{translation:i,centerOffset:r}=e,s=new ht(i?[i[0],i[1],i[2]]:[0,0,0],3,!0),n=new ht(r?[r[0],r[1],r[2],r[3]]:[0,0,0,1],4,!0);return[[A.POSITION,s],[A.NORMAL,new ht([0,0,1],3,!0)],[A.AUXPOS1,n]]}_getOrCreateMaterial(e){const i=this._perInstanceMaterialParameters(e),r=DL.uniqueMaterialIdentifier(i);if(v(this._material)&&r===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(v(e.materialCollection)){let s=e.materialCollection.get(r);return C(s)&&(s=new DL(i),e.materialCollection.add(r,s)),{material:s,isUnique:!1}}return{material:new DL(i),isUnique:!0}}_createAs3DShape(e,i,r,s){const n=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:n}),a=this._getOrCreateMaterial(r),l=new fn(a.material,this._createVertexData(r),Odt,null,Vs.Point,o),c=gee(this._context,e,l,i,s);if(C(c))return null;const h=new og(this,c.object,[l],a.isUnique?[a.material]:null,null,xP,i);return h.metadata=new IAe(r.elevationOffset),h.alignedSampledElevation=c.sampledElevation,h.needsElevationUpdates=Sd(i.mode),TP(h,e,this._context.elevationProvider),h}};JAe.elevationModeChangeTypes={definedChanged:Ss.UPDATE,staysOnTheGround:Ss.UPDATE,onTheGroundChanged:Ss.RECREATE};const J9=[0],Odt=[[A.POSITION,J9],[A.NORMAL,J9],[A.AUXPOS1,J9]],Rdt={mode:"relative-to-ground",offset:0},Mdt={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let Pdt=class{constructor(e,i,r=M(),s=fi(),n=et(),o="world",a=0,l=null){this.renderer=e,this.symbol=i,this.translation=r,this.centerOffset=s,this.screenOffset=n,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}},Idt=class extends idt{};const Cce=oe.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function $dt(t,e){if(!YZ(t))return Cce.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const i=Ldt[t.callout.type];return i?new i(t,e):(Cce.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const Ldt={line:JAe},Ace=new yo(Array,t=>rU(t,t0e),null,10,5),Ddt=ci();let Ndt=class{get labelLayers(){return this._labelLayers}get extent(){return this._extent}constructor(e,i,r,s,n){this.graphic=e,this.graphics3DSymbol=i,this.layers=r,this._labelLayers=new Array,this._auxiliaryLayers=new Array,this._visibilityFlags=Fdt(Fo._COUNT,jc._COUNT),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++i.referenced,this._featureExpressionFeature=n?OAe(n,e,s):null;for(const o of r)v(o)&&(this.isElevationSource=this.isElevationSource||o.isElevationSource)}initialize(e,i){this._layer=i,this._stage=e,this._forEachSymbolLayerGraphic(r=>{r.initialize(e,i),r.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this.layers=null,this._auxiliaryLayers=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers.length=0}addLabelGraphic(e,i,r){this._labelLayers.push(e),e.initialize(i,r),e.setVisibility(this.isVisible(Fo.LABEL))}addAuxiliaryGraphic(e){this._auxiliaryLayers.push(e),this._layer&&(e.initialize(this._stage,this._layer),e.setVisibility(this.isVisible()))}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(i=>{i.type==="draped"&&(e=!0)}),e}isVisible(e=Fo.GRAPHIC,i){for(let r=0;r<=e;r++){const s=this._visibilityFlags[r];for(let n=0;n<s.length;++n)if(s[n]===!1&&n!==i)return!1}return!0}hasVisibilityFlag(e,i){return this._visibilityFlags[i][e]!=null}setVisibilityFlag(e,i,r){const s=this.isVisible(r);this._visibilityFlags[r][e]=i;const n=this.isVisible(r);if(s===n)return!1;if(r===Fo.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(n));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(n));const o=this.isVisible(Fo.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}clearVisibilityFlag(e,i=Fo.GRAPHIC){return this.setVisibilityFlag(e,void 0,i)}computeExtent(e){if(!this._extent){const i=this.graphic.geometry;if(C(i))return!1;this._extent=ci(),Oht(i,this._extent);const r=i.spatialReference;if(!rn(r,e)&&!vU(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,i){return v(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===e&&this._optimizedGeometry.hasM===i||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,i),this._optimizedGeometry.hasZ=e,this._optimizedGeometry.hasM=i),this._optimizedGeometry.geometry}_convertGraphicToOptimizedGeometry(e,i,r){let s=e.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=md.fromExtent(s.type==="mesh"?s.extent:s)),yHe(s,i,r)}get usedMemory(){let e=B_e(this.graphic.attributes);return this._forEachSymbolLayerGraphic(i=>{const r=i.graphics3DSymbolLayer.complexity;if(C(r))return;const s=i.type==="draped"?r.memory.draped:r.memory;e+=s.bytesPerFeature,s.bytesPerCoordinate&&(e+=Aht(this.graphic.geometry)*s.bytesPerCoordinate)}),e}computeAttachmentOrigin(){const e={render:{origin:M(),num:0},draped:{origin:et(),num:0}};for(const i of this.layers)C(i)||i.computeAttachmentOrigin(e);return e.render.num>1&&ue(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&Ca(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,i,r,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?$r(n.boundingBox):n.boundingBox=$r(),n.requiresDrapedElevation=!1,await DU(this.layers,async o=>{if(C(o))return;const a=o.type==="draped"?i:e,l=Ace.acquire(),c=await o.getProjectedBoundingBox(a,r,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&rC(n.boundingBox,l),Ace.release(l)}),w6e(n.boundingBox)||sG(IZ(n.boundingBox,Ddt))?n:null}needsElevationUpdates(){for(const e of this.layers)if(v(e)&&(e.type==="object3d"||e.type==="lod-instance")&&e.needsElevationUpdates)return!0;for(const e of this._labelLayers)if(e&&e.needsElevationUpdates)return!0;return!1}alignWithElevation(e,i,r){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(e,i,this._featureExpressionFeature,r)})}alignWithAbsoluteElevation(e,i,r){this._forEachRenderedGraphic(s=>{s.type==="object3d"&&s.alignWithAbsoluteElevation(e,i,r)})}addObjectStateSet(e,i){this._forEachSymbolLayerGraphic(r=>r.addObjectState(e,i))}removeObjectState(e){this._forEachSymbolLayerGraphic(i=>i.removeObjectState(e))}_forEachGraphicList(e,i){e.forEach(r=>r&&i(r))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._forEachGraphicList(this._auxiliaryLayers,e)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}};function Fdt(t,e){const i=new Array(t);for(let r=0;r<i.length;r++)i[r]=new Array(e);return i}var Oce,Rce,Mce,u1={},Udt={get exports(){return u1},set exports(t){u1=t}};Oce=Udt,Rce=function(){function t($,N,U){U=U||2;var q,Y,Q,X,pe,ye,xe,De=N&&N.length,rt=De?N[0]*U:$.length,qe=e($,0,rt,U,!0),Pe=[];if(!qe||qe.next===qe.prev)return Pe;if(De&&(qe=l($,N,qe,U)),$.length>80*U){q=Q=$[0],Y=X=$[1];for(var Ye=U;Ye<rt;Ye+=U)(pe=$[Ye])<q&&(q=pe),(ye=$[Ye+1])<Y&&(Y=ye),pe>Q&&(Q=pe),ye>X&&(X=ye);xe=(xe=Math.max(Q-q,X-Y))!==0?1/xe:0}return r(qe,Pe,U,q,Y,xe),Pe}function e($,N,U,q,Y){var Q,X;if(Y===H($,N,U,q)>0)for(Q=N;Q<U;Q+=q)X=te(Q,$[Q],$[Q+1],X);else for(Q=U-q;Q>=N;Q-=q)X=te(Q,$[Q],$[Q+1],X);if(X&&O(X,X.next)){var pe=X.next;se(X),X=pe}return X}function i($,N){if(!$)return $;N||(N=$);var U,q=$;do if(U=!1,q.steiner||!O(q,q.next)&&E(q.prev,q,q.next)!==0)q=q.next;else{var Y=q.prev;if(se(q),(q=N=Y)===q.next)break;U=!0}while(U||q!==N);return N}function r($,N,U,q,Y,Q,X){if($){!X&&Q&&y($,q,Y,Q);for(var pe,ye,xe=$;$.prev!==$.next;)if(pe=$.prev,ye=$.next,Q?n($,q,Y,Q):s($))N.push(pe.i/U),N.push($.i/U),N.push(ye.i/U),se($),$=ye.next,xe=ye.next;else if(($=ye)===xe){X?X===1?r($=o(i($),N,U),N,U,q,Y,Q,2):X===2&&a($,N,U,q,Y,Q):r(i($),N,U,q,Y,Q,1);break}}}function s($){var N=$.prev,U=$,q=$.next;if(E(N,U,q)>=0)return!1;for(var Y=$.next.next;Y!==$.prev;){if(S(N.x,N.y,U.x,U.y,q.x,q.y,Y.x,Y.y)&&E(Y.prev,Y,Y.next)>=0)return!1;Y=Y.next}return!0}function n($,N,U,q){var Y=$.prev,Q=$,X=$.next;if(E(Y,Q,X)>=0)return!1;for(var pe=Y.x<Q.x?Y.x<X.x?Y.x:X.x:Q.x<X.x?Q.x:X.x,ye=Y.y<Q.y?Y.y<X.y?Y.y:X.y:Q.y<X.y?Q.y:X.y,xe=Y.x>Q.x?Y.x>X.x?Y.x:X.x:Q.x>X.x?Q.x:X.x,De=Y.y>Q.y?Y.y>X.y?Y.y:X.y:Q.y>X.y?Q.y:X.y,rt=b(pe,ye,N,U,q),qe=b(xe,De,N,U,q),Pe=$.prevZ,Ye=$.nextZ;Pe&&Pe.z>=rt&&Ye&&Ye.z<=qe;){if(Pe!==$.prev&&Pe!==$.next&&S(Y.x,Y.y,Q.x,Q.y,X.x,X.y,Pe.x,Pe.y)&&E(Pe.prev,Pe,Pe.next)>=0||(Pe=Pe.prevZ,Ye!==$.prev&&Ye!==$.next&&S(Y.x,Y.y,Q.x,Q.y,X.x,X.y,Ye.x,Ye.y)&&E(Ye.prev,Ye,Ye.next)>=0))return!1;Ye=Ye.nextZ}for(;Pe&&Pe.z>=rt;){if(Pe!==$.prev&&Pe!==$.next&&S(Y.x,Y.y,Q.x,Q.y,X.x,X.y,Pe.x,Pe.y)&&E(Pe.prev,Pe,Pe.next)>=0)return!1;Pe=Pe.prevZ}for(;Ye&&Ye.z<=qe;){if(Ye!==$.prev&&Ye!==$.next&&S(Y.x,Y.y,Q.x,Q.y,X.x,X.y,Ye.x,Ye.y)&&E(Ye.prev,Ye,Ye.next)>=0)return!1;Ye=Ye.nextZ}return!0}function o($,N,U){var q=$;do{var Y=q.prev,Q=q.next.next;!O(Y,Q)&&R(Y,q,q.next,Q)&&V(Y,Q)&&V(Q,Y)&&(N.push(Y.i/U),N.push(q.i/U),N.push(Q.i/U),se(q),se(q.next),q=$=Q),q=q.next}while(q!==$);return i(q)}function a($,N,U,q,Y,Q){var X=$;do{for(var pe=X.next.next;pe!==X.prev;){if(X.i!==pe.i&&T(X,pe)){var ye=G(X,pe);return X=i(X,X.next),ye=i(ye,ye.next),r(X,N,U,q,Y,Q),void r(ye,N,U,q,Y,Q)}pe=pe.next}X=X.next}while(X!==$)}function l($,N,U,q){var Y,Q,X,pe=[];for(Y=0,Q=N.length;Y<Q;Y++)(X=e($,N[Y]*q,Y<Q-1?N[Y+1]*q:$.length,q,!1))===X.next&&(X.steiner=!0),pe.push(w(X));for(pe.sort(c),Y=0;Y<pe.length;Y++)U=i(U=p(pe[Y],U),U.next);return U}function c($,N){return $.x-N.x}function h($){if($.next.prev===$)return $;let N=$;for(;;){const U=N.next;if(U.prev===N||U===N||U===$)break;N=U}return N}function p($,N){var U=f($,N);if(!U)return N;var q=G(U,$),Y=i(U,U.next);let Q=h(q);return i(Q,Q.next),Y=h(Y),h(N===U?Y:N)}function f($,N){var U,q=N,Y=$.x,Q=$.y,X=-1/0;do{if(Q<=q.y&&Q>=q.next.y&&q.next.y!==q.y){var pe=q.x+(Q-q.y)*(q.next.x-q.x)/(q.next.y-q.y);if(pe<=Y&&pe>X){if(X=pe,pe===Y){if(Q===q.y)return q;if(Q===q.next.y)return q.next}U=q.x<q.next.x?q:q.next}}q=q.next}while(q!==N);if(!U)return null;if(Y===X)return U;var ye,xe=U,De=U.x,rt=U.y,qe=1/0;q=U;do Y>=q.x&&q.x>=De&&Y!==q.x&&S(Q<rt?Y:X,Q,De,rt,Q<rt?X:Y,Q,q.x,q.y)&&(ye=Math.abs(Q-q.y)/(Y-q.x),V(q,$)&&(ye<qe||ye===qe&&(q.x>U.x||q.x===U.x&&m(U,q)))&&(U=q,qe=ye)),q=q.next;while(q!==xe);return U}function m($,N){return E($.prev,$,N.prev)<0&&E(N.next,$,$.next)<0}function y($,N,U,q){var Y=$;do Y.z===null&&(Y.z=b(Y.x,Y.y,N,U,q)),Y.prevZ=Y.prev,Y.nextZ=Y.next,Y=Y.next;while(Y!==$);Y.prevZ.nextZ=null,Y.prevZ=null,_(Y)}function _($){var N,U,q,Y,Q,X,pe,ye,xe=1;do{for(U=$,$=null,Q=null,X=0;U;){for(X++,q=U,pe=0,N=0;N<xe&&(pe++,q=q.nextZ);N++);for(ye=xe;pe>0||ye>0&&q;)pe!==0&&(ye===0||!q||U.z<=q.z)?(Y=U,U=U.nextZ,pe--):(Y=q,q=q.nextZ,ye--),Q?Q.nextZ=Y:$=Y,Y.prevZ=Q,Q=Y;U=q}Q.nextZ=null,xe*=2}while(X>1);return $}function b($,N,U,q,Y){return($=1431655765&(($=858993459&(($=252645135&(($=16711935&(($=32767*($-U)*Y)|$<<8))|$<<4))|$<<2))|$<<1))|(N=1431655765&((N=858993459&((N=252645135&((N=16711935&((N=32767*(N-q)*Y)|N<<8))|N<<4))|N<<2))|N<<1))<<1}function w($){var N=$,U=$;do(N.x<U.x||N.x===U.x&&N.y<U.y)&&(U=N),N=N.next;while(N!==$);return U}function S($,N,U,q,Y,Q,X,pe){return(Y-X)*(N-pe)-($-X)*(Q-pe)>=0&&($-X)*(q-pe)-(U-X)*(N-pe)>=0&&(U-X)*(Q-pe)-(Y-X)*(q-pe)>=0}function T($,N){return $.next.i!==N.i&&$.prev.i!==N.i&&!F($,N)&&(V($,N)&&V(N,$)&&B($,N)&&(E($.prev,$,N.prev)||E($,N.prev,N))||O($,N)&&E($.prev,$,$.next)>0&&E(N.prev,N,N.next)>0)}function E($,N,U){return(N.y-$.y)*(U.x-N.x)-(N.x-$.x)*(U.y-N.y)}function O($,N){return $.x===N.x&&$.y===N.y}function R($,N,U,q){var Y=P(E($,N,U)),Q=P(E($,N,q)),X=P(E(U,q,$)),pe=P(E(U,q,N));return Y!==Q&&X!==pe||!(Y!==0||!L($,U,N))||!(Q!==0||!L($,q,N))||!(X!==0||!L(U,$,q))||!(pe!==0||!L(U,N,q))}function L($,N,U){return N.x<=Math.max($.x,U.x)&&N.x>=Math.min($.x,U.x)&&N.y<=Math.max($.y,U.y)&&N.y>=Math.min($.y,U.y)}function P($){return $>0?1:$<0?-1:0}function F($,N){var U=$;do{if(U.i!==$.i&&U.next.i!==$.i&&U.i!==N.i&&U.next.i!==N.i&&R(U,U.next,$,N))return!0;U=U.next}while(U!==$);return!1}function V($,N){return E($.prev,$,$.next)<0?E($,N,$.next)>=0&&E($,$.prev,N)>=0:E($,N,$.prev)<0||E($,$.next,N)<0}function B($,N){var U=$,q=!1,Y=($.x+N.x)/2,Q=($.y+N.y)/2;do U.y>Q!=U.next.y>Q&&U.next.y!==U.y&&Y<(U.next.x-U.x)*(Q-U.y)/(U.next.y-U.y)+U.x&&(q=!q),U=U.next;while(U!==$);return q}function G($,N){var U=new ie($.i,$.x,$.y),q=new ie(N.i,N.x,N.y),Y=$.next,Q=N.prev;return $.next=N,N.prev=$,U.next=Y,Y.prev=U,q.next=U,U.prev=q,Q.next=q,q.prev=Q,q}function te($,N,U,q){var Y=new ie($,N,U);return q?(Y.next=q.next,Y.prev=q,q.next.prev=Y,q.next=Y):(Y.prev=Y,Y.next=Y),Y}function se($){$.next.prev=$.prev,$.prev.next=$.next,$.prevZ&&($.prevZ.nextZ=$.nextZ),$.nextZ&&($.nextZ.prevZ=$.prevZ)}function ie($,N,U){this.i=$,this.x=N,this.y=U,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function H($,N,U,q){for(var Y=0,Q=N,X=U-q;Q<U;Q+=q)Y+=($[X]-$[Q])*($[Q+1]+$[X+1]),X=Q;return Y}return t.deviation=function($,N,U,q){var Y=N&&N.length,Q=Y?N[0]*U:$.length,X=Math.abs(H($,0,Q,U));if(Y)for(var pe=0,ye=N.length;pe<ye;pe++){var xe=N[pe]*U,De=pe<ye-1?N[pe+1]*U:$.length;X-=Math.abs(H($,xe,De,U))}var rt=0;for(pe=0;pe<q.length;pe+=3){var qe=q[pe]*U,Pe=q[pe+1]*U,Ye=q[pe+2]*U;rt+=Math.abs(($[qe]-$[Ye])*($[Pe+1]-$[qe+1])-($[qe]-$[Pe])*($[Ye+1]-$[qe+1]))}return X===0&&rt===0?0:Math.abs((rt-X)/X)},t.flatten=function($){for(var N=$[0][0].length,U={vertices:[],holes:[],dimensions:N},q=0,Y=0;Y<$.length;Y++){for(var Q=0;Q<$[Y].length;Q++)for(var X=0;X<N;X++)U.vertices.push($[Y][Q][X]);Y>0&&(q+=$[Y-1].length,U.holes.push(q))}return U},t},(Mce=Rce())!==void 0&&(Oce.exports=Mce);const L8=oe.getLogger("esri.views.3d.support.buffer.math");function LI(t,e,i){if(t.count!==e.count)return void L8.error("source and destination buffers need to have the same number of elements");const r=t.count,s=i[0],n=i[1],o=i[2],a=i[4],l=i[5],c=i[6],h=i[8],p=i[9],f=i[10],m=i[12],y=i[13],_=i[14],b=t.typedBuffer,w=t.typedBufferStride,S=e.typedBuffer,T=e.typedBufferStride;for(let E=0;E<r;E++){const O=E*w,R=E*T,L=S[R],P=S[R+1],F=S[R+2];b[O]=s*L+a*P+h*F+m,b[O+1]=n*L+l*P+p*F+y,b[O+2]=o*L+c*P+f*F+_}}function h1(t,e,i){if(t.count!==e.count)return void L8.error("source and destination buffers need to have the same number of elements");const r=t.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],p=i[7],f=i[8],m=t.typedBuffer,y=t.typedBufferStride,_=e.typedBuffer,b=e.typedBufferStride;for(let w=0;w<r;w++){const S=w*y,T=w*b,E=_[T],O=_[T+1],R=_[T+2];m[S]=s*E+a*O+h*R,m[S+1]=n*E+l*O+p*R,m[S+2]=o*E+c*O+f*R}}function JW(t,e,i){const r=Math.min(t.count,e.count),s=t.typedBuffer,n=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=i*o[h],s[c+1]=i*o[h+1],s[c+2]=i*o[h+2]}}function _ee(t,e){const i=Math.min(t.count,e.count),r=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<i;a++){const l=a*s,c=a*o,h=n[c],p=n[c+1],f=n[c+2],m=h*h+p*p+f*f;if(m>0){const y=1/Math.sqrt(m);r[l]=y*h,r[l+1]=y*p,r[l+2]=y*f}}}function Vdt(t,e,i){const r=Math.min(t.count,e.count),s=t.typedBuffer,n=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=o[h]>>i,s[c+1]=o[h+1]>>i,s[c+2]=o[h+2]>>i}}Object.freeze(Object.defineProperty({__proto__:null,normalize:_ee,scale:JW,shiftRight:Vdt,transformMat3:h1,transformMat4:LI},Symbol.toStringTag,{value:"Module"}));function kdt(t,e,i){return{objectId:t,target:e,distance:i,type:"vertex"}}function Pce(t,e,i,r,s,n=!1){return{objectId:t,target:e,distance:i,type:"edge",start:r,end:s,draped:n}}function D8(t,e){if(!t||t.symbol)return null;const i=e&&e.renderer;return t&&v(i)&&i.getObservationRenderer?i.getObservationRenderer(t):i}function Bdt(t,e){if(v(t.symbol))return t.symbol;const i=D8(t,e);return v(i)&&i.type!=="dot-density"?i.getSymbol(t,e):null}function i5t(t,e){const i=D8(t,e),r=Bdt(t,e);if(C(r))return null;const s={renderer:i,symbol:r};if(C(i)||!("visualVariables"in i)||!i.visualVariables)return s;const n=sK(i,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)switch(a.type){case"color":s.color=l.toRgba();break;case"size":if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=h;break;case"depth":o[1]=h;break;case"height":o[2]=h;break;case"width-and-depth":o[0]=o[1]=h;break;default:o[0]=o[1]=o[2]=h}}break;case"opacity":s.opacity=l;break;case"rotation":switch(a.axis){case"tilt":s.tilt=l;break;case"roll":s.roll=l;break;default:s.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(s.size=o),s}async function zdt(t,e){if(v(t.symbol))return t.symbol;const i=D8(t,e);return v(i)?i.getSymbolAsync(t,e):null}async function r5t(t,e){const i=D8(t,e),r=await zdt(t,e);if(!r)return null;const s={renderer:i,symbol:r};if(!i||!("visualVariables"in i)||!i.visualVariables)return s;const n=sK(i,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)if(a.type==="color")s.color=ot.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=h:c==="depth"?o[1]=h:c==="height"?o[2]=h:o[0]=o[1]=c==="width-and-depth"?h:o[2]=h}else a.type==="opacity"?s.opacity=l:a.type==="rotation"&&a.axis==="tilt"?s.tilt=l:a.type==="rotation"&&a.axis==="roll"?s.roll=l:a.type==="rotation"&&(s.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(s.size=o),s}function Gdt(t,e=0){const i=t[e];return typeof i=="number"&&isFinite(i)?i:null}function jdt(t){for(let e=0;e<3;e++){const i=t[e];if(typeof i=="number")return isFinite(i)?i:0}return 0}function Ice(t){const e=[[A.POSITION,t.indices]],i=[[A.POSITION,new ht(t.attributeData.position,3,!0)]];return v(t.attributeData.color)&&(i.push([A.COLOR,new ht(t.attributeData.color,4,!0)]),e.push([A.COLOR,new Array(t.indices.length).fill(0)])),v(t.attributeData.uvMapSpace)&&(i.push([A.UVMAPSPACE,new ht(t.attributeData.uvMapSpace,4,!0)]),e.push([A.UVMAPSPACE,t.indices])),v(t.attributeData.boundingRect)&&(i.push([A.BOUNDINGRECT,new ht(t.attributeData.boundingRect,9,!0)]),e.push([A.BOUNDINGRECT,t.indices])),new fn(t.material,i,e,t.mapPositions,Vs.Mesh,t.attributeData.objectAndLayerIdColor)}function $ce(t){const e=[[A.POSITION,t.indices],[A.UV0,t.indices]],i=[[A.POSITION,new ht(t.attributeData.position,3,!0)],[A.UV0,new ht(t.attributeData.uv0,2,!0)]];return new fn(t.material,i,e,t.mapPositions)}function EP(t){switch(t.type){case"extent":if(t instanceof Pi)return md.fromExtent(t);break;case"polygon":return t}return null}let N8=class{constructor(e,i,r){this.renderData=e,this.layerUid=i,this.graphicUid=r,this.outGeometries=new Array}};function KW(t,e,i){const r=Array.isArray(t),s=r?t.length/e:t.byteLength/(4*e),n=r?t:new Uint32Array(t,0,s*e),o=(i==null?void 0:i.minReduction)??0,a=(i==null?void 0:i.originalIndices)||null,l=a?a.length:0,c=(i==null?void 0:i.componentOffsets)||null;let h=0;if(c)for(let R=0;R<c.length-1;R++){const L=c[R+1]-c[R];L>h&&(h=L)}else h=s;const p=Math.floor(1.1*h)+1;(vf==null||vf.length<2*p)&&(vf=new Uint32Array(YE(2*p)));for(let R=0;R<2*p;R++)vf[R]=0;let f=0;const m=!!c&&!!a,y=m?l:s;let _=LSe(s/3);const b=new Uint32Array(l),w=1.96;let S=o!==0?Math.ceil(4*w*w/(o*o)*o*(1-o)):y,T=1,E=c?c[1]:y;for(let R=0;R<y;R++){if(R===S){const G=1-f/R;if(G+w*Math.sqrt(G*(1-G)/R)<o)return null;S*=2}if(R===E){for(let G=0;G<2*p;G++)vf[G]=0;if(a)for(let G=c[T-1];G<c[T];G++)b[G]=_[a[G]];E=c[++T]}const L=m?a[R]:R,P=L*e,F=Wdt(n,P,e);let V=F%p,B=f;for(;vf[2*V+1]!==0;){if(vf[2*V]===F){const G=vf[2*V+1]-1;if(Hdt(n,P,G*e,e)){B=_[G];break}}V++,V>=p&&(V-=p)}B===f&&(vf[2*V]=F,vf[2*V+1]=L+1,f++),_[L]=B}if(o!==0&&1-f/s<o)return null;if(m){for(let R=c[T-1];R<b.length;R++)b[R]=_[a[R]];_=RE(b)}const O=r?new Array(f):new Uint32Array(f*e);f=0;for(let R=0;R<y;R++)_[R]===f&&(qdt(n,(m?a[R]:R)*e,O,f*e,e),f++);if(a&&!m){const R=new Uint32Array(l);for(let L=0;L<R.length;L++)R[L]=_[a[L]];_=RE(R)}return{buffer:Array.isArray(O)?O:O.buffer,indices:_,uniqueCount:f}}function Hdt(t,e,i,r){for(let s=0;s<r;s++)if(t[e+s]!==t[i+s])return!1;return!0}function qdt(t,e,i,r,s){for(let n=0;n<s;n++)i[r+n]=t[e+n]}function Wdt(t,e,i){let r=0;for(let s=0;s<i;s++)r=t[e+s]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let vf=null;function n5t(t){const e=DI(t.rings,t.hasZ,Xm.CCW_IS_HOLE),i=new Array;let r=0,s=0;for(const a of e.polygons){const l=a.count,c=a.index,h=ld(e.position,3*c,3*l),p=a.holeIndices.map(m=>m-c),f=new Uint32Array(u1(h,p,3));i.push({position:h,faces:f}),r+=h.length,s+=f.length}const n=Xdt(i,r,s),o=Array.isArray(n.position)?KW(n.position,3,{originalIndices:n.faces}):KW(n.position.buffer,6,{originalIndices:n.faces});return n.position=new Float64Array(o.buffer),n.faces=o.indices,n}function Xdt(t,e,i){if(t.length===1)return t[0];const r=ru(e),s=new Uint32Array(i);let n=0,o=0,a=0;for(const l of t){for(let c=0;c<l.position.length;c++)r[n++]=l.position[c];for(let c=0;c<l.faces.length;c++)s[o++]=l.faces[c]+a;a=n/3}return{position:r,faces:s}}function DI(t,e,i){const r=t.length,s=new Array(r),n=new Array(r),o=new Array(r);let a=0,l=0,c=0,h=0;for(let m=0;m<r;++m)h+=t[m].length;const p=ru(3*h);let f=0;for(let m=r-1;m>=0;m--){const y=t[m],_=i===Xm.CCW_IS_HOLE&&Ydt(y);if(_&&r!==1)s[a++]=y;else{let b=y.length;for(let S=0;S<a;++S)b+=s[S].length;const w={index:f,pathLengths:new Array(a+1),count:b,holeIndices:new Array(a)};w.pathLengths[0]=y.length,y.length>0&&(o[c++]={index:f,count:y.length}),f=_?NL(y,y.length-1,-1,p,f,y.length,e):NL(y,0,1,p,f,y.length,e);for(let S=0;S<a;++S){const T=s[S];w.holeIndices[S]=f,w.pathLengths[S+1]=T.length,T.length>0&&(o[c++]={index:f,count:T.length}),f=NL(T,0,1,p,f,T.length,e)}a=0,w.count>0&&(n[l++]=w)}}for(let m=0;m<a;++m){const y=s[m];y.length>0&&(o[c++]={index:f,count:y.length}),f=NL(y,0,1,p,f,y.length,e)}return n.length=l,o.length=c,{position:p,polygons:n,outlines:o}}function NL(t,e,i,r,s,n,o){s*=3;for(let a=0;a<n;++a){const l=t[e];r[s++]=l[0],r[s++]=l[1],r[s++]=o?l[2]:0,e+=i}return s/3}function Ydt(t){return!cZ(t,!1,!1)}var Xm;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(Xm||(Xm={}));var a3,Y5,QW;(function(t){t[t.RasterImage=0]="RasterImage",t[t.Features=1]="Features"})(a3||(a3={})),function(t){t[t.MapLayer=0]="MapLayer",t[t.ViewLayer=1]="ViewLayer",t[t.Outline=2]="Outline",t[t.SnappingHint=3]="SnappingHint"}(Y5||(Y5={})),function(t){t[t.WithRasterImage=0]="WithRasterImage",t[t.WithoutRasterImage=1]="WithoutRasterImage"}(QW||(QW={}));var os,Yh,Vt,l3,ws,On,xa;(function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"})(os||(os={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(Yh||(Yh={})),function(t){t[t.NORTH=0]="NORTH",t[t.NORTH_EAST=1]="NORTH_EAST",t[t.EAST=2]="EAST",t[t.SOUTH_EAST=3]="SOUTH_EAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTH_WEST=5]="SOUTH_WEST",t[t.WEST=6]="WEST",t[t.NORTH_WEST=7]="NORTH_WEST"}(Vt||(Vt={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(l3||(l3={})),function(t){t[t.Color=0]="Color",t[t.ColorNoRasterImage=1]="ColorNoRasterImage",t[t.Highlight=2]="Highlight",t[t.Water=3]="Water",t[t.Occluded=4]="Occluded",t[t.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(ws||(ws={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(On||(On={})),function(t){t[t.INSIDE=0]="INSIDE",t[t.INTERSECTS=1]="INTERSECTS",t[t.OUTSIDE=2]="OUTSIDE"}(xa||(xa={}));let Zdt=class{constructor(e,i){this.vec3=e,this.id=i}};function c3(t,e,i,r){return new Zdt(Xe(t,e,i),r)}var Zl;(function(t){t[t.None=0]="None",t[t.ColorAndWater=1]="ColorAndWater",t[t.Highlight=2]="Highlight",t[t.Occluded=3]="Occluded",t[t.ObjectAndLayerIdColor=4]="ObjectAndLayerIdColor"})(Zl||(Zl={}));let Lce=class{get extent(){return this._extent}constructor(e,i){this.index=e,this.renderTargets=i,this._extent=ci(),this.resolution=0,this.renderLocalOrigin=c3(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new Jdt,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=e,this.validTargets=new Array(i.renderTargets.length).fill(!1)}getValidTexture(e){return this.validTargets[e]?this.renderTargets.getTarget(e).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(e){const i=e===Zl.ColorAndWater?this.renderTargets.getTarget(ws.Color):e===Zl.Highlight?this.renderTargets.getTarget(ws.Highlight):e===Zl.ObjectAndLayerIdColor?this.renderTargets.getTarget(ws.ObjectAndLayerIdColor):this.renderTargets.getTarget(ws.Occluded);return i?i.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(ws.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(ws.Color):null}getNormalTexture(e){const i=e===Zl.ColorAndWater?this.renderTargets.getTarget(ws.Water):null;return i?i.getTexture():null}draw(e,i){const r=this.computeRenderTargetValidityBitfield();for(const s of this.renderTargets.renderTargets)s.type!==ws.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[s.type]=e.drawTarget(this,s,i):this.validTargets[s.type]=!1;return r^this.computeRenderTargetValidityBitfield()?AC.CHANGED:AC.UNCHANGED}computeRenderTargetValidityBitfield(){const e=this.validTargets;return+e[ws.Color]|+e[ws.ColorNoRasterImage]<<1|+e[ws.Highlight]<<2|+e[ws.Water]<<3|+e[ws.Occluded]<<4}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const i=.001*e.range;if(this._extent[0]-i<=e.min){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];E4(this._extent,e.range,0,r)}if(this._extent[2]+i>=e.max){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];E4(this._extent,-e.range,0,r)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,jy(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const i=this.canvasGeometries.extents[e];if(i[0]!==i[2]&&i[1]!==i[3])return!0}return!1}applyViewport(e){e.setViewport(this.index===os.INNER?0:this.resolution,0,this.resolution,this.resolution)}},Jdt=class{constructor(){this.extents=[ci(),ci(),ci()],this.numViews=0}},QAe=class{constructor(e,i){this._size=yee(),this._fbo=null,this._fbo=new Bs(e,{colorTarget:gs.TEXTURE,depthStencilTarget:Di.NONE},{target:Pt.TEXTURE_2D,pixelFormat:it.RGBA,dataType:Ht.UNSIGNED_BYTE,wrapMode:kt.CLAMP_TO_EDGE,samplingMode:gt.LINEAR_MIPMAP_LINEAR,hasMipmap:i,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=ft(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return this._fbo!==null}resize(e,i){this._size[0]=e,this._size[1]=i,this._fbo.resize(this._size[0],this._size[1])}bind(e){e.bindFramebuffer(this._fbo)}generateMipMap(){const e=this._fbo.colorTexture;e.descriptor.hasMipmap&&e.generateMipmap()}disposeRenderTargetMemory(){var e;(e=this._fbo)==null||e.resize(0,0)}get gpuMemoryUsage(){var e;return((e=this._fbo)==null?void 0:e.gpuMemoryUsage)??0}},XT=class{constructor(e,i,r,s=!0){this.output=i,this.type=r,this.valid=!1,this.lastUsed=1/0,this.fbo=new QAe(e,s)}},Kdt=class{constructor(e){this.renderTargets=[new XT(e,k.Color,ws.Color),new XT(e,k.Color,ws.ColorNoRasterImage),new XT(e,k.Highlight,ws.Highlight,!1),new XT(e,k.Normal,ws.Water),new XT(e,k.Color,ws.Occluded)],de("enable-feature:objectAndLayerId-rendering")&&this.renderTargets.push(new XT(e,k.ObjectAndLayerIdColor,ws.ObjectAndLayerIdColor))}getTarget(e){return this.renderTargets[e].fbo}dispose(){for(const e of this.renderTargets)e.fbo.dispose()}disposeRenderTargetMemory(){for(const e of this.renderTargets)e.fbo.disposeRenderTargetMemory()}validateUsageForTarget(e,i,r){if(e)i.lastUsed=r;else if(r-i.lastUsed>Qdt)i.fbo.disposeRenderTargetMemory(),i.lastUsed=1/0;else if(i.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce((e,i)=>e+i.fbo.gpuMemoryUsage,0)}};const Qdt=1e3;let eOe=class{constructor(e){this._context=e,this._perConstructorInstances=new _A,this._frameCounter=0,this._keepAliveFrameCount=Dce}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(e=>e.forEach(i=>i.technique.destroy())),this._perConstructorInstances.clear()}acquire(e,i=tpt){const r=i.key;let s=this._perConstructorInstances.get(e,r);if(C(s)){const n=new e(this._context,i,()=>this.release(n));s=new ept(n),this._perConstructorInstances.set(e,r,s)}return++s.refCount,s.technique}releaseAndAcquire(e,i,r){if(v(r)){if(i.key===r.key)return r;this.release(r)}return this.acquire(e,i)}release(e){if(C(e)||this._perConstructorInstances.empty)return;const i=this._perConstructorInstances.get(e.constructor,e.key);C(i)||(--i.refCount,i.refCount===0&&(i.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==Dce&&this._perConstructorInstances.forEach((e,i)=>{e.forEach((r,s)=>{r.refCount===0&&r.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(r.technique.destroy(),this._perConstructorInstances.delete(i,s))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((i,r)=>{const s=async(n,o)=>{const a=o.shader;a&&(await a.reload(),n.forEach(l=>l.technique.reload(this._context)))};e.push(s(i,r))}),await Promise.all(e)}},ept=class{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}};const Dce=-1,tpt=new Va;let tOe=class{constructor(e,i,r,s){this._textureRepository=e,this._techniqueRepository=i,this.materialChanged=r,this.requestRender=s,this._id2glMaterialRef=new _A}dispose(){this._textureRepository.destroy()}acquire(e,i,r){if(this._ownMaterial(e),!e.requiresSlot(i,r))return null;let s=this._id2glMaterialRef.get(r,e.id);if(C(s)){const n=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:r});s=new ipt(n),this._id2glMaterialRef.set(r,e.id,s)}return s.ref(),s.glMaterial}release(e,i){const r=this._id2glMaterialRef.get(i,e.id);v(r)&&(r.unref(),r.referenced||(ft(r.glMaterial),this._id2glMaterialRef.delete(i,e.id)))}_ownMaterial(e){v(e.repository)&&e.repository!==this&&oe.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},ipt=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,Ct(this._refCnt>=0)}get referenced(){return this._refCnt>0}};const rpt={orderedRepackingEnabled:!1},spt={rootOrigin:null},npt=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","objectGeometryUpdated"];let eX=class tX{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,i){this._objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new so,this._objectCount=0,i&&(i.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=i.maximumObjectsPerNode),i.maximumDepth!==void 0&&(this._maximumDepth=i.maximumDepth))}destroy(){this._degenerateObjects.clear(),so.clearPool(),iX[0]=null,X1.prune(),ow.prune()}add(e,i=e.length){this._objectCount+=i,this._grow(e,i);const r=so.acquire();for(let s=0;s<i;s++){const n=e[s];this._isDegenerate(n)?this._degenerateObjects.add(n):(r.init(this._root),this._add(n,r))}so.release(r)}remove(e,i=null){this._objectCount-=e.length;const r=so.acquire();for(const s of e){const n=v(i)?i:pC(this._objectToBoundingSphere(s),upt);eM(n[3])?(r.init(this._root),this._remove(s,n,r)):this._degenerateObjects.delete(s)}so.release(r),this._shrink()}update(e,i){if(!eM(i[3])&&this._isDegenerate(e))return;const r=cpt(e);this.remove(r,i),this.add(r)}forEachAlongRay(e,i,r){const s=ih(e,i);this._forEachNode(this._root,n=>{if(!this._intersectsNode(s,n))return!1;const o=n.node;return o.terminals.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),!0})}forEachAlongRayWithVerticalOffset(e,i,r,s){const n=ih(e,i);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(n,o,s))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),!0})}forEach(e){this._forEachNode(this._root,i=>{const r=i.node;return r.terminals.forAll(e),r.residents!==null&&r.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,i,r,s=()=>!0,n=1/0){let o=1/0,a=1/0,l=null;const c=K9(e,i),h=p=>{if(--n,!s(p))return;const f=this._objectToBoundingSphere(p);if(!Cv(r,f))return;const m=tv(e,i,f),y=m-f[3],_=m+f[3];y<o&&(o=y,a=_,l=p)};return this._forEachNodeDepthOrdered(this._root,p=>{if(n<=0||!Cv(r,p.bounds)||(ue(hh,c,p.halfSize),ve(hh,hh,p.bounds),tv(e,i,hh)>a))return!1;const f=p.node;return f.terminals.forAll(m=>h(m)),f.residents!==null&&f.residents.forAll(m=>h(m)),!0},e,i),l}forEachInDepthRange(e,i,r,s,n,o,a){let l=-1/0,c=1/0;const h={setRange:_=>{r===tX.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,_.near),c=Math.min(c,_.far)):(l=Math.max(l,-_.far),c=Math.min(c,-_.near))}};h.setRange(s);const p=tv(i,r,e),f=K9(i,r),m=K9(i,-r),y=_=>{if(!a(_))return;const b=this._objectToBoundingSphere(_),w=b,S=tv(i,r,w)-p,T=S-b[3],E=S+b[3];T>c||E<l||!Cv(o,b)||n(_,h)};this._forEachNodeDepthOrdered(this._root,_=>{if(!Cv(o,_.bounds)||(ue(hh,f,_.halfSize),ve(hh,hh,_.bounds),tv(i,r,hh)-p>c)||(ue(hh,m,_.halfSize),ve(hh,hh,_.bounds),tv(i,r,hh)-p<l))return!1;const b=_.node;return b.terminals.forAll(w=>y(w)),b.residents!==null&&b.residents.forAll(w=>y(w)),!0},i,r)}forEachNode(e){this._forEachNode(this._root,i=>e(i.node,i.bounds,i.halfSize))}forEachNeighbor(e,i){const r=Cy(i),s=i,n=l=>{const c=this._objectToBoundingSphere(l),h=Cy(c),p=r+h;return!(Bo(c,s)-p*p<=0)||e(l)};let o=!0;const a=l=>{o&&(o=n(l))};this._forEachNode(this._root,l=>{const c=Cy(l.bounds),h=r+c;if(Bo(l.bounds,s)-h*h>0)return!1;const p=l.node;return p.terminals.forAll(a),o&&p.residents!==null&&p.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsNode(e,i){return FL(i.bounds,2*-i.halfSize,Nu),FL(i.bounds,2*i.halfSize,Fu),Rae(e.origin,e.direction,Nu,Fu)}_intersectsNodeWithOffset(e,i,r){return FL(i.bounds,2*-i.halfSize,Nu),FL(i.bounds,2*i.halfSize,Fu),r.applyToMinMax(Nu,Fu),Rae(e.origin,e.direction,Nu,Fu)}_intersectsObject(e,i){const r=this._objectToBoundingSphere(i);return!(r[3]>0)||oj(r,e)}_intersectsObjectWithOffset(e,i,r){const s=this._objectToBoundingSphere(i);return!(s[3]>0)||oj(r.applyToBoundingSphere(s),e)}_forEachNode(e,i){let r=so.acquire().init(e);const s=[r];for(;s.length!==0;){if(r=s.pop(),i(r)&&!r.isLeaf())for(let n=0;n<r.node.children.length;n++)r.node.children[n]&&s.push(so.acquire().init(r).advance(n));so.release(r)}}_forEachNodeDepthOrdered(e,i,r,s=tX.DepthOrder.FRONT_TO_BACK){let n=so.acquire().init(e);const o=[n];for(lpt(r,s,Uce);o.length!==0;){if(n=o.pop(),i(n)&&!n.isLeaf())for(let a=7;a>=0;--a){const l=Uce[a];n.node.children[l]&&o.push(so.acquire().init(n).advance(l))}so.release(n)}}_remove(e,i,r){X1.clear();const s=r.advanceTo(i,(n,o)=>{X1.push(n.node),X1.push(o)})?r.node.terminals:r.node.residents;if(s.removeUnordered(e),s.length===0)for(let n=X1.length-2;n>=0;n-=2){const o=X1.data[n],a=X1.data[n+1];if(!this._purge(o,a))break}}_nodeIsEmpty(e){if(e.terminals.length!==0)return!1;if(e.residents!==null)return e.residents.length===0;for(let i=0;i<e.children.length;i++)if(e.children[i])return!1;return!0}_purge(e,i){return i>=0&&(e.children[i]=null),!!this._nodeIsEmpty(e)&&(e.residents===null&&(e.residents=new li({shrink:!0})),!0)}_add(e,i){i.advanceTo(this._objectToBoundingSphere(e))?i.node.terminals.push(e):(i.node.residents.push(e),i.node.residents.length>this._maximumObjectsPerNode&&i.depth<this._maximumDepth&&this._split(i))}_split(e){const i=e.node.residents;e.node.residents=null;for(let r=0;r<i.length;r++){const s=so.acquire().init(e);this._add(i.getItemAt(r),s),so.release(s)}}_grow(e,i){if(i!==0&&(Nce(e,i,r=>this._objectToBoundingSphere(r),wg),eM(wg[3])&&!this._fitsInsideTree(wg)))if(this._nodeIsEmpty(this._root.node))pC(wg,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const r=this._rootBoundsForRootAsSubNode(wg);this._placingRootViolatesMaxDepth(r)?this._rebuildTree(wg,r):this._growRootAsSubNode(r),so.release(r)}}_rebuildTree(e,i){he(eB,i.bounds),eB[3]=i.halfSize,Nce([e,eB],2,s=>s,tB);const r=so.acquire().init(this._root);this._root.initFrom(null,tB,tB[3]),this._root.increaseHalfSize(1.25),this._forEachNode(r,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),so.release(r)}_placingRootViolatesMaxDepth(e){const i=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return this._forEachNode(this._root,s=>(r=Math.max(r,s.depth),r+i<=this._maximumDepth)),r+i>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const i=e[3],r=e;let s=-1/0;const n=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=n[l]-o-(r[l]-i),h=r[l]+i-(n[l]+o),p=Math.max(0,Math.ceil(c/(2*o))),f=Math.max(0,Math.ceil(h/(2*o)))+1,m=2**Math.ceil(Math.log(p+f)*Math.LOG2E);s=Math.max(s,m),UL[l].min=p,UL[l].max=f}for(let l=0;l<3;l++){let c=UL[l].min,h=UL[l].max;const p=(s-(c+h))/2;c+=Math.ceil(p),h+=Math.floor(p);const f=n[l]-o-c*o*2;Q9[l]=f+(h+c)*o}const a=s*o;return Q9[3]=a*rOe,so.acquire().initFrom(null,Q9,a,0)}_growRootAsSubNode(e){const i=this._root.node;he(wg,this._root.bounds),wg[3]=this._root.halfSize,this._root.init(e),e.advanceTo(wg,null,!0),e.node.children=i.children,e.node.residents=i.residents,e.node.terminals=i.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const i=this._root.node.children;let r=0,s=0;for(;s<i.length&&e==null;)r=s++,e=i[r];for(;s<i.length;)if(i[s++])return-1;return r}_isDegenerate(e){return!eM(this._objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const i=this._root.bounds,r=this._root.halfSize;return e[3]<=r&&e[0]>=i[0]-r&&e[0]<=i[0]+r&&e[1]>=i[1]-r&&e[1]<=i[1]+r&&e[2]>=i[2]-r&&e[2]<=i[2]+r}},so=class TS{constructor(){this.bounds=gn(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,i,r,s=this.depth){return this.node=v(e)?e:TS.createEmptyNode(),v(i)&&pC(i,this.bounds),this.halfSize=r,this.depth=s,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*rOe}advance(e){let i=this.node.children[e];i||(i=TS.createEmptyNode(),this.node.children[e]=i),this.node=i,this.halfSize/=2,this.depth++;const r=iOe[e];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,i,r=!1){for(;;){if(this.isTerminalFor(e))return i&&i(this,-1),!0;if(this.isLeaf()){if(!r)return i&&i(this,-1),!1;this.node.residents=null}const s=this._childIndex(e);i&&i(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const i=this.bounds;return(i[0]<e[0]?1:0)+(i[1]<e[1]?2:0)+(i[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new li({shrink:!0}),residents:new li({shrink:!0})}}static acquire(){return TS._pool.acquire()}static release(e){TS._pool.release(e)}static clearPool(){TS._pool.prune()}};function opt(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function apt(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function FL(t,e,i){i[0]=t[0]+e,i[1]=t[1]+e,i[2]=t[2]+e}function Nce(t,e,i,r){if(e===1){const s=i(t[0]);pC(s,r)}else{Nu[0]=1/0,Nu[1]=1/0,Nu[2]=1/0,Fu[0]=-1/0,Fu[1]=-1/0,Fu[2]=-1/0;for(let s=0;s<e;s++){const n=i(t[s]);eM(n[3])&&(opt(Nu,n),apt(Fu,n))}tn(r,Nu,Fu,.5),r[3]=Math.max(Fu[0]-Nu[0],Fu[1]-Nu[1],Fu[2]-Nu[2])/2}}function lpt(t,e,i){if(!ow.length)for(let r=0;r<8;++r)ow.push({index:0,distance:0});for(let r=0;r<8;++r){const s=iOe[r];ow.data[r].index=r,ow.data[r].distance=tv(t,e,s)}ow.sort((r,s)=>r.distance-s.distance);for(let r=0;r<8;++r)i[r]=ow.data[r].index}function K9(t,e){let i,r=1/0;for(let s=0;s<8;++s){const n=tv(t,e,Fce[s]);n<r&&(r=n,i=Fce[s])}return i}function tv(t,e,i){return e*(t[0]*i[0]+t[1]*i[1]+t[2]*i[2])}function eM(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}so._pool=new yo(so),function(t){var e;(e=t.DepthOrder||(t.DepthOrder={}))[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(eX||(eX={}));const iOe=[Xe(-1,-1,-1),Xe(1,-1,-1),Xe(-1,1,-1),Xe(1,1,-1),Xe(-1,-1,1),Xe(1,-1,1),Xe(-1,1,1),Xe(1,1,1)],Fce=[Xe(-1,-1,-1),Xe(-1,-1,1),Xe(-1,1,-1),Xe(-1,1,1),Xe(1,-1,-1),Xe(1,-1,1),Xe(1,1,-1),Xe(1,1,1)],rOe=Math.sqrt(3),iX=[null];function cpt(t){return iX[0]=t,iX}const Q9=gn(),hh=M(),Nu=M(),Fu=M(),X1=new li,upt=gn(),wg=gn(),eB=gn(),tB=gn(),UL=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],ow=new li,Uce=[0,0,0,0,0,0,0,0],Np=eX;var kv;(function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"})(kv||(kv={}));let sOe=class extends EI{get objects(){return this._objects}constructor(e,i=""){super(),this.apiLayerUid=i,this.type=Vs.Layer,this.events=new As,this.sliceable=!1,this._objects=new li,this._objectsAdded=new li,this._stageHandles=new Ki,this.apiLayerUid=i,this.visible=(e==null?void 0:e.visible)??!0,this.pickable=(e==null?void 0:e.pickable)??!0,this.updatePolicy=(e==null?void 0:e.updatePolicy)??kv.ASYNC,this._disableOctree=(e==null?void 0:e.disableOctree)??!1}destroy(){this.detachStage(),this._stage=null}attachStage(e){this.detachStage(),this._stage=e;for(const i of npt)this._stageHandles.add(this.events.on(i,r=>e.handleEvent(i,r)))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),v(this._octree)&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),v(this._octree)&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const i of e)i.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),v(this._octree)&&this._objectsAdded.pushArray(e)}removeMany(e){const i=new Array;if(this._objects.removeUnorderedMany(e,e.length,i),i.length!==0){for(const r of i)r.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:i}),v(this._octree)){for(let r=0;r<i.length;)this._objectsAdded.removeUnordered(i[r])?(i[r]=i[i.length-1],i.length-=1):++r;this._octree.remove(i)}}}sync(){v(this._stage)&&this.updatePolicy!==kv.SYNC&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(e,i){v(this._octree)&&!this._objectsAdded.includes(e)&&this._octree.update(e,i)}getSpatialQueryAccelerator(){return C(this._octree)&&this._objects.length>50&&!this._disableOctree?(this._octree=new Np(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):v(this._octree)&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=Je(this._octree),this._objectsAdded.clear()}};function Z5(t){return v(t)&&t.type===Vs.Layer}var cd,Zx;(function(t){t[t.Draped=0]="Draped",t[t.Screen=1]="Screen",t[t.World=2]="World",t[t.COUNT=3]="COUNT"})(cd||(cd={})),function(t){t[t.Center=0]="Center",t[t.Tip=1]="Tip",t[t.COUNT=2]="COUNT"}(Zx||(Zx={}));let Io=class extends uo{constructor(){super(...arguments),this.output=k.Color,this.transparencyPassType=$t.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=cd.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=Zx.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};u([z({count:k.COUNT})],Io.prototype,"output",void 0),u([z({count:$t.COUNT})],Io.prototype,"transparencyPassType",void 0),u([z()],Io.prototype,"occluder",void 0),u([z()],Io.prototype,"hasSlicePlane",void 0),u([z()],Io.prototype,"writeDepth",void 0),u([z({count:cd.COUNT})],Io.prototype,"space",void 0),u([z()],Io.prototype,"hideOnShortSegments",void 0),u([z()],Io.prototype,"hasCap",void 0),u([z({count:Zx.COUNT})],Io.prototype,"anchor",void 0),u([z()],Io.prototype,"hasTip",void 0),u([z()],Io.prototype,"vvSize",void 0),u([z()],Io.prototype,"vvColor",void 0),u([z()],Io.prototype,"vvOpacity",void 0),u([z()],Io.prototype,"hasOccludees",void 0),u([z()],Io.prototype,"hasMultipassTerrain",void 0),u([z()],Io.prototype,"cullAboveGround",void 0),u([z({constValue:!0})],Io.prototype,"hasVvInstancing",void 0),u([z({constValue:!0})],Io.prototype,"hasSliceTranslatedView",void 0);const Vce=8;function nOe(t,e){const i=t.vertex;i.uniforms.add(new He("intrinsicWidth",r=>r.width)),e.vvSize?(t.attributes.add(A.SIZEFEATUREATTRIBUTE,"float"),i.uniforms.add(new ni("vvSizeMinSize",r=>r.vvSizeMinSize)),i.uniforms.add(new ni("vvSizeMaxSize",r=>r.vvSizeMaxSize)),i.uniforms.add(new ni("vvSizeOffset",r=>r.vvSizeOffset)),i.uniforms.add(new ni("vvSizeFactor",r=>r.vvSizeFactor)),i.code.add(x`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(t.attributes.add(A.SIZE,"float"),i.code.add(x`float getSize(){
return intrinsicWidth * size;
}`)),e.vvOpacity?(t.attributes.add(A.OPACITYFEATUREATTRIBUTE,"float"),i.constants.add("vvOpacityNumber","int",8),i.uniforms.add([new Aa("vvOpacityValues",r=>r.vvOpacityValues,Vce),new Aa("vvOpacityOpacities",r=>r.vvOpacityOpacities,Vce)]),i.code.add(x`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):i.code.add(x`vec4 applyOpacity( vec4 color ){
return color;
}`),e.vvColor?(t.attributes.add(A.COLORFEATUREATTRIBUTE,"float"),i.constants.add("vvColorNumber","int",qp),i.uniforms.add(new Aa("vvColorValues",r=>r.vvColorValues,qp)),i.uniforms.add(new O8("vvColorColors",r=>r.vvColorColors,qp)),i.code.add(x`vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(t.attributes.add(A.COLOR,"vec4"),i.code.add(x`vec4 getColor(){
return applyOpacity(color);
}`))}function Qy(t,e){switch(t.fragment.include(ou),e.output){case k.Shadow:case k.ShadowHighlight:case k.ShadowExcludeHighlight:t.extensions.add("GL_OES_standard_derivatives"),t.fragment.code.add(x`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`);break;case k.Depth:t.fragment.code.add(x`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}}let oOe=class{constructor(e){this._rctx=e,this._cache=new Map}destroy(){this._cache.forEach(e=>ft(e.stippleTexture)),this._cache.clear()}_acquire(e){if(C(e))return null;const i=this._patternId(e),r=this._cache.get(i);if(r)return r.refCount++,r;const{encodedData:s,paddedPixels:n}=dpt(e),o=new hpt(new xt(this._rctx,{width:n,height:1,internalFormat:it.RGBA,pixelFormat:it.RGBA,dataType:Ht.UNSIGNED_BYTE,wrapMode:kt.CLAMP_TO_EDGE},s));return this._cache.set(i,o),o}release(e){if(C(e))return;const i=this._patternId(e),r=this._cache.get(i);r&&(r.refCount--,r.refCount===0&&(v(r.stippleTexture)&&r.stippleTexture.dispose(),this._cache.delete(i)))}swap(e,i){const r=this._acquire(i);return this.release(e),r}_patternId(e){return`${e.pattern.join(",")}-r${e.pixelRatio}`}},hpt=class extends yr{constructor(e){super(),this.stippleTexture=e,this.refCount=1}};function dpt(t){const e=vee(t),i=1/t.pixelRatio,r=aOe(t),s=lOe(t),n=(Math.floor(.5*(s-1))+.5)*i,o=[];let a=1;for(const m of e){for(let y=0;y<m;y++){const _=a*(Math.min(y,m-1-y)+.5)*i/n*.5+.5;o.push(_)}a=-a}const l=Math.round(e[0]/2),c=[...o.slice(l),...o.slice(0,l)],h=r+cOe,p=new Uint8Array(4*h);let f=4;for(const m of c)_P(m,p,f),f+=4;return p.copyWithin(0,f-4,f),p.copyWithin(f,4,8),{encodedData:p,paddedPixels:h}}function vee(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function aOe(t){if(C(t))return 1;const e=vee(t);return Math.floor(e.reduce((i,r)=>i+r))}function lOe(t){return vee(t).reduce((e,i)=>Math.max(e,i))}const cOe=2;function ppt(t){return C(t)?Am:t.length===4?t:nr(fpt,t[0],t[1],t[2],1)}const fpt=fi();function uOe(t,e){t.constants.add("stippleAlphaColorDiscard","float",.001),t.constants.add("stippleAlphaHighlightDiscard","float",.5),e.stippleEnabled?mpt(t,e):gpt(t)}function mpt(t,e){const i=!(e.draped&&e.stipplePreferContinuous),{vertex:r,fragment:s}=t;s.include(ou),e.draped||(rf(r,e),r.uniforms.add(new He("worldToScreenPerDistanceRatio",(o,a)=>1/a.camera.perScreenPixelRatio)),r.code.add(x`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),e.stippleRequiresClamp&&t.varyings.add("vStippleDistanceLimits","vec2"),e.stippleRequiresStretchMeasure&&t.varyings.add("vStipplePatternStretch","float"),r.code.add(x`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${_pt};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),r.code.add(x`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),r.code.add(x`
    if (segmentLengthPseudoScreen >= ${i?"patternLength":"1e4"}) {
  `),r.uniforms.add(new He("pixelRatio",(o,a)=>a.camera.pixelRatio)),r.code.add(x`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${e.stippleRequiresStretchMeasure?x`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),s.constants.add("stippleTexturePadding","float",cOe);const n=e.hasWebGL2Context?sr.None:sr.Size;s.uniforms.add(jp("stipplePatternTexture",o=>o.stippleTexture,n)),s.uniforms.add([new He("stipplePatternSDFNormalizer",o=>ypt(o.stipplePattern)),new He("stipplePatternPixelSizeInv",o=>1/bee(o))]),s.code.add(x`
    float padStippleTexture(float u) {
      float paddedTextureSize = ${ad(e,"stipplePatternTexture")}.x;
      float unpaddedTextureSize = paddedTextureSize - stippleTexturePadding;

      return (u * unpaddedTextureSize + stippleTexturePadding * 0.5) / paddedTextureSize;
    }
  `),s.code.add(x`
    float getStippleSDF(out bool isClamped) {
      ${e.stippleRequiresClamp?x`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:x`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${e.stippleScaleWithLineWidth?x`u *= vLineSizeInv;`:""}
      u = padStippleTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${e.stippleRequiresStretchMeasure?x`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:x`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${e.stippleScaleWithLineWidth?x`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:x`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),e.stippleOffColorEnabled?(s.uniforms.add(new Si("stippleOffColor",o=>ppt(o.stippleOffColor))),s.code.add(x`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):s.code.add(x`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function gpt(t){t.fragment.code.add(x`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function ypt(t){return v(t)?(Math.floor(.5*(lOe(t)-1))+.5)/t.pixelRatio:1}function bee(t){const e=t.stipplePattern;return v(e)?aOe(t.stipplePattern)/e.pixelRatio:1}const _pt=x.float(.4),CP=64,wee=CP/2,hOe=wee/5,vpt=CP/hOe,bpt=.25;function wpt(t,e){return t.fromData(`${e}-marker`,()=>jCe(e,CP,wee,hOe))}function dOe(t,e){const i=t.vertex;t.constants.add("markerSizePerLineWidth","float",vpt),i.uniforms.add(new He("pixelRatio",(r,s)=>s.camera.pixelRatio)),C(i.uniforms.get("markerScale"))&&i.constants.add("markerScale","float",1),i.code.add(x`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),e.space===cd.World&&(i.constants.add("maxSegmentLengthFraction","float",.45),i.uniforms.add(new He("perRenderPixelRatio",(r,s)=>s.camera.perRenderPixelRatio)),i.code.add(x`float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}
bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}`))}var ud;(function(t){t[t.BUTT=0]="BUTT",t[t.SQUARE=1]="SQUARE",t[t.ROUND=2]="ROUND",t[t.COUNT=3]="COUNT"})(ud||(ud={}));let ns=class extends uo{constructor(){super(...arguments),this.output=k.Color,this.capType=ud.BUTT,this.transparencyPassType=$t.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}};u([z({count:k.COUNT})],ns.prototype,"output",void 0),u([z({count:ud.COUNT})],ns.prototype,"capType",void 0),u([z({count:$t.COUNT})],ns.prototype,"transparencyPassType",void 0),u([z()],ns.prototype,"occluder",void 0),u([z()],ns.prototype,"hasSlicePlane",void 0),u([z()],ns.prototype,"hasPolygonOffset",void 0),u([z()],ns.prototype,"writeDepth",void 0),u([z()],ns.prototype,"draped",void 0),u([z()],ns.prototype,"stippleEnabled",void 0),u([z()],ns.prototype,"stippleOffColorEnabled",void 0),u([z()],ns.prototype,"stippleScaleWithLineWidth",void 0),u([z()],ns.prototype,"stipplePreferContinuous",void 0),u([z()],ns.prototype,"roundJoins",void 0),u([z()],ns.prototype,"applyMarkerOffset",void 0),u([z()],ns.prototype,"vvSize",void 0),u([z()],ns.prototype,"vvColor",void 0),u([z()],ns.prototype,"vvOpacity",void 0),u([z()],ns.prototype,"falloffEnabled",void 0),u([z()],ns.prototype,"innerColorEnabled",void 0),u([z()],ns.prototype,"hasOccludees",void 0),u([z()],ns.prototype,"hasMultipassTerrain",void 0),u([z()],ns.prototype,"cullAboveGround",void 0),u([z()],ns.prototype,"wireframe",void 0),u([z({constValue:!0})],ns.prototype,"stippleRequiresClamp",void 0),u([z({constValue:!0})],ns.prototype,"stippleRequiresStretchMeasure",void 0),u([z({constValue:!0})],ns.prototype,"hasVvInstancing",void 0),u([z({constValue:!0})],ns.prototype,"hasSliceTranslatedView",void 0),u([z()],ns.prototype,"objectAndLayerIdColorInstanced",void 0);const J5=1;function xpt(t){const e=new Ui,{vertex:i,fragment:r}=e,s=t.hasMultipassTerrain&&(t.output===k.Color||t.output===k.Alpha);e.include(xI),e.include(nOe,t),e.include(uOe,t);const n=t.applyMarkerOffset&&!t.draped;n&&(i.uniforms.add(new He("markerScale",m=>m.markerScale)),e.include(dOe,{space:cd.World})),t.output===k.Depth&&e.include(Qy,t),e.include(A8,t),Kc(i,t),i.uniforms.add([new Jr("inverseProjectionMatrix",(m,y)=>y.camera.inverseProjectionMatrix),new zi("nearFar",(m,y)=>y.camera.nearFar),new He("miterLimit",m=>m.join!=="miter"?0:m.miterLimit),new Si("viewport",(m,y)=>y.camera.fullViewport)]),i.constants.add("LARGE_HALF_FLOAT","float",65500),e.attributes.add(A.POSITION,"vec3"),e.attributes.add(A.SUBDIVISIONFACTOR,"float"),e.attributes.add(A.UV0,"vec2"),e.attributes.add(A.AUXPOS1,"vec3"),e.attributes.add(A.AUXPOS2,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),s1(e),s&&e.varyings.add("depth","float");const o=t.capType===ud.ROUND,a=t.stippleEnabled&&t.stippleScaleWithLineWidth||o;a&&e.varyings.add("vLineWidth","float");const l=t.stippleEnabled&&t.stippleScaleWithLineWidth;l&&e.varyings.add("vLineSizeInv","float");const c=t.innerColorEnabled||o;c&&e.varyings.add("vLineDistance","float");const h=t.stippleEnabled&&o,p=t.falloffEnabled||h;p&&e.varyings.add("vLineDistanceNorm","float"),o&&(e.varyings.add("vSegmentSDF","float"),e.varyings.add("vReverseSegmentSDF","float")),i.code.add(x`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),i.code.add(x`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),n8(e),i.code.add(x`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${s?"depth = pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),i.uniforms.add(new He("pixelRatio",(m,y)=>y.camera.pixelRatio)),i.code.add(x`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${a?x`vLineWidth = lineWidth;`:""}
      ${l?x`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);
  `),n&&i.code.add(x`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),i.code.add(x`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(t.stippleEnabled||o)&&i.code.add(x`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${o?x`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),i.code.add(x`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),t.roundJoins?i.code.add(x`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${t.stippleEnabled?x`min(1.0, subdivisionFactor * ${x.float((J5+2)/(J5+1))})`:x`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):i.code.add(x`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const f=t.capType!==ud.BUTT;return i.code.add(x`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${f?x`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),i.code.add(x`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${p||c?x`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${c?x`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${p?x`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),o&&i.code.add(x`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),t.stippleEnabled&&(t.draped?i.uniforms.add(new He("worldToScreenRatio",(m,y)=>1/y.screenToPCSRatio)):i.code.add(x`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),i.code.add(x`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),t.draped?i.code.add(x`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):i.code.add(x`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),i.uniforms.add(new He("stipplePatternPixelSize",m=>bee(m))),i.code.add(x`
      float patternLength = ${t.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),i.code.add(x`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${t.wireframe&&!t.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),s&&e.include(sh,t),e.include(en,t),r.include(sg),r.code.add(x`
  void main() {
    discardBySlice(vpos);
    ${s?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),t.wireframe?r.code.add(x`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(o&&r.code.add(x`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${x.float(la)}) {
        discard;
      }
    `),h?r.code.add(x`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${x.float(la)}, stippleCoverage);
      `):r.code.add(x`float stippleAlpha = getStippleAlpha();`),r.uniforms.add(new Si("intrinsicColor",m=>m.color)),t.output!==k.ObjectAndLayerIdColor&&r.code.add(x`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),r.code.add(x`vec4 color = intrinsicColor * vColor;`),t.innerColorEnabled&&(r.uniforms.add(new Si("innerColor",m=>Gt(m.innerColor,m.color))),r.uniforms.add(new He("innerWidth",(m,y)=>m.innerWidth*y.camera.pixelRatio)),r.code.add(x`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),r.code.add(x`vec4 finalColor = blendStipple(color, stippleAlpha);`),t.falloffEnabled&&(r.uniforms.add(new He("falloff",m=>m.falloff)),r.code.add(x`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),r.code.add(x`
    ${t.output===k.ObjectAndLayerIdColor?x`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${x.float(la)}) {
      discard;
    }

    ${t.output===k.Alpha?x`gl_FragColor = vec4(finalColor.a);`:""}
    ${t.output===k.Color?x`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===k.Color&&t.transparencyPassType===$t.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${t.output===k.Highlight?x`gl_FragColor = vec4(1.0);`:""}
    ${t.output===k.Depth?x`outputDepth(linearDepth);`:""}
    ${t.output===k.ObjectAndLayerIdColor?x`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const Tpt=Object.freeze(Object.defineProperty({__proto__:null,RIBBONLINE_NUM_ROUND_JOIN_SUBDIVISIONS:J5,build:xpt},Symbol.toStringTag,{value:"Module"})),xee={func:Dr.LESS},K5={func:Dr.ALWAYS},Ym={mask:255},pOe={mask:0},Spt=t=>({function:{func:Dr.NOTEQUAL,ref:t,mask:t},operation:{fail:ks.KEEP,zFail:ks.KEEP,zPass:ks.KEEP}}),Ept=t=>({function:{func:Dr.ALWAYS,ref:t,mask:t},operation:{fail:ks.KEEP,zFail:ks.KEEP,zPass:ks.REPLACE}}),S1={function:{func:Dr.ALWAYS,ref:oc.OutlineVisualElementMask,mask:oc.OutlineVisualElementMask},operation:{fail:ks.KEEP,zFail:ks.KEEP,zPass:ks.ZERO}},d1={function:{func:Dr.ALWAYS,ref:oc.OutlineVisualElementMask,mask:oc.OutlineVisualElementMask},operation:{fail:ks.KEEP,zFail:ks.KEEP,zPass:ks.REPLACE}},fOe={function:{func:Dr.EQUAL,ref:oc.OutlineVisualElementMask,mask:oc.OutlineVisualElementMask},operation:{fail:ks.KEEP,zFail:ks.KEEP,zPass:ks.KEEP}},mOe={function:{func:Dr.NOTEQUAL,ref:oc.OutlineVisualElementMask,mask:oc.OutlineVisualElementMask},operation:{fail:ks.KEEP,zFail:ks.KEEP,zPass:ks.KEEP}},gOe=new Map([[A.POSITION,0],[A.SUBDIVISIONFACTOR,1],[A.UV0,2],[A.AUXPOS1,3],[A.AUXPOS2,4],[A.COLOR,5],[A.COLORFEATUREATTRIBUTE,5],[A.SIZE,6],[A.SIZEFEATUREATTRIBUTE,6],[A.OPACITYFEATUREATTRIBUTE,7],[A.OBJECTANDLAYERIDCOLOR,8]]);let yOe=class _Oe extends ji{initializeProgram(e){return new ki(e.rctx,_Oe.shader.get().build(this.configuration),gOe)}_makePipelineState(e,i){const r=this.configuration,s=e===$t.NONE,n=e===$t.FrontFace;return Qt({blending:r.output===k.Color||r.output===k.Alpha?s?Qu:y0(e):null,depthTest:{func:T1(e)},depthWrite:s?r.writeDepth?pc:null:R8(e),colorWrite:ui,stencilWrite:r.hasOccludees?Ym:null,stencilTest:r.hasOccludees?i?d1:S1:null,polygonOffset:s||n?r.hasPolygonOffset?kce:null:P8})}initializePipeline(){const e=this.configuration;if(e.occluder){const i=e.hasPolygonOffset?kce:null;this._occluderPipelineTransparent=Qt({blending:Qu,polygonOffset:i,depthTest:K5,depthWrite:null,colorWrite:ui,stencilWrite:null,stencilTest:mOe}),this._occluderPipelineOpaque=Qt({blending:Qu,polygonOffset:i,depthTest:K5,depthWrite:null,colorWrite:ui,stencilWrite:pOe,stencilTest:fOe}),this._occluderPipelineMaskWrite=Qt({blending:null,polygonOffset:i,depthTest:xee,depthWrite:null,colorWrite:null,stencilWrite:Ym,stencilTest:d1})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?jt.LINES:jt.TRIANGLE_STRIP}getPipelineState(e,i){return i?this._occludeePipelineState:this.configuration.occluder?e===Fe.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===Fe.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,i)}};yOe.shader=new Vi(Tpt,()=>ee(()=>import("./RibbonLine.glsl-2223457d.js"),[],import.meta.url));const kce={factor:0,units:-4};var $c;(function(t){t[t.LEFT_JOIN_START=-2]="LEFT_JOIN_START",t[t.LEFT_JOIN_END=-1]="LEFT_JOIN_END",t[t.LEFT_CAP_START=-4]="LEFT_CAP_START",t[t.LEFT_CAP_END=-5]="LEFT_CAP_END",t[t.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",t[t.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",t[t.RIGHT_CAP_START=4]="RIGHT_CAP_START",t[t.RIGHT_CAP_END=5]="RIGHT_CAP_END"})($c||($c={}));let rE=class extends x1{constructor(e){super(e,new Apt),this._configuration=new ns,this._vertexAttributeLocations=gOe,this._layout=this.createLayout()}isClosed(e,i){return bOe(this.parameters,e,i)}getConfiguration(e,i){this._configuration.output=e,this._configuration.draped=i.slot===Fe.DRAPED_MATERIAL;const r=v(this.parameters.stipplePattern)&&e!==k.Highlight;return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&v(this.parameters.stippleOffColor),this._configuration.stippleScaleWithLineWidth=r&&this.parameters.stippleScaleWithLineWidth,this._configuration.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=!!v(this.parameters.markerParameters)&&Rpt(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&v(this.parameters.innerColor),this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===ps.OccludeAndTransparentStencil,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,i,r,s,n,o){if(!r.options.selectionMode)return;const a=e.vertexAttributes.get(A.POSITION).data,l=e.vertexAttributes.get(A.SIZE);let c=this.parameters.width;if(this.parameters.vvSizeEnabled){const _=e.vertexAttributes.get(A.SIZEFEATUREATTRIBUTE).data[0];c*=we(this.parameters.vvSizeOffset[0]+_*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else l&&(c*=l.data[0]);const h=s[0],p=s[1],f=(c/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,y=0;for(let _=0;_<a.length-5;_+=3){const b=a[_],w=a[_+1],S=h-b,T=p-w,E=a[_+3]-b,O=a[_+4]-w,R=we((E*S+O*T)/(E*E+O*O),0,1),L=E*R-S,P=O*R-T,F=L*L+P*P;F<m&&(m=F,y=_/3)}m<f*f&&n(o.dist,o.normal,y,!1)}intersect(e,i,r,s,n,o){if(!r.options.selectionMode||!e.visible)return;if(!PSe(i))return void oe.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=e.vertexAttributes,l=a.get(A.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSizeEnabled){const S=a.get(A.SIZEFEATUREATTRIBUTE).data[0];c*=we(this.parameters.vvSizeOffset[0]+S*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else a.has(A.SIZE)&&(c*=a.get(A.SIZE).data[0]);const h=r.camera,p=Mpt;Fn(p,r.point);const f=c*h.pixelRatio/2+4*h.pixelRatio;fe(mO[0],p[0]-f,p[1]+f,0),fe(mO[1],p[0]+f,p[1]+f,0),fe(mO[2],p[0]+f,p[1]-f,0),fe(mO[3],p[0]-f,p[1]-f,0);for(let S=0;S<4;S++)if(!h.unprojectFromRenderScreen(mO[S],xg[S]))return;Ta(h.eye,xg[0],xg[1],rB),Ta(h.eye,xg[1],xg[2],sB),Ta(h.eye,xg[2],xg[3],nB),Ta(h.eye,xg[3],xg[0],oB);let m=Number.MAX_VALUE,y=0;const _=vOe(this.parameters,a,e.indices)?l.length-2:l.length-5;for(let S=0;S<_;S+=3){Rl[0]=l[S]+i[12],Rl[1]=l[S+1]+i[13],Rl[2]=l[S+2]+i[14];const T=(S+3)%l.length;if(Ml[0]=l[T]+i[12],Ml[1]=l[T+1]+i[13],Ml[2]=l[T+2]+i[14],Er(rB,Rl)<0&&Er(rB,Ml)<0||Er(sB,Rl)<0&&Er(sB,Ml)<0||Er(nB,Rl)<0&&Er(nB,Ml)<0||Er(oB,Rl)<0&&Er(oB,Ml)<0)continue;if(h.projectToRenderScreen(Rl,Z1),h.projectToRenderScreen(Ml,J1),Z1[2]<0&&J1[2]>0){be(bf,Rl,Ml);const O=h.frustum,R=-Er(O[Sr.NEAR],Rl)/Ae(bf,O[Sr.NEAR]);ue(bf,bf,R),ve(Rl,Rl,bf),h.projectToRenderScreen(Rl,Z1)}else if(Z1[2]>0&&J1[2]<0){be(bf,Ml,Rl);const O=h.frustum,R=-Er(O[Sr.NEAR],Ml)/Ae(bf,O[Sr.NEAR]);ue(bf,bf,R),ve(Ml,Ml,bf),h.projectToRenderScreen(Ml,J1)}else if(Z1[2]<0&&J1[2]<0)continue;Z1[2]=0,J1[2]=0;const E=dJ(ax(Z1,J1,Gce),p);E<m&&(m=E,he(Bce,Rl),he(zce,Ml),y=S/3)}const b=r.rayBegin,w=r.rayEnd;if(m<f*f){let S=Number.MAX_VALUE;if(lve(ax(Bce,zce,Gce),ax(b,w,Ppt),Y1)){be(Y1,Y1,b);const T=je(Y1);ue(Y1,Y1,1/T),S=T/Ar(b,w)}o(S,Y1,y,!1)}}createLayout(){const e=cs().vec3f(A.POSITION).f32(A.SUBDIVISIONFACTOR).vec2f(A.UV0).vec3f(A.AUXPOS1).vec3f(A.AUXPOS2);return this.parameters.vvSizeEnabled?e.f32(A.SIZEFEATUREATTRIBUTE):e.f32(A.SIZE),this.parameters.vvColorEnabled?e.f32(A.COLORFEATUREATTRIBUTE):e.vec4f(A.COLOR),this.parameters.vvOpacityEnabled&&e.f32(A.OPACITYFEATUREATTRIBUTE),de("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(A.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new Opt(this._layout,this.parameters)}requiresSlot(e,i){return i===k.Color||i===k.Alpha||i===k.Highlight||i===k.Depth||i===k.ObjectAndLayerIdColor?e===Fe.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===ps.OccludeAndTransparentStencil?e===Fe.OPAQUE_MATERIAL||e===Fe.OCCLUDER_MATERIAL||e===Fe.TRANSPARENT_OCCLUDER_MATERIAL:i===k.Color||i===k.Alpha?e===(this.parameters.writeDepth?Fe.TRANSPARENT_MATERIAL:Fe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===Fe.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new Cpt(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),v(e.markerParameters)&&(e.markerScale=e.markerParameters.width/e.width)}},Cpt=class extends w1{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==k.Color&&this._output!==k.Alpha||this._updateOccludeeState(e);const i=this._material.parameters.stipplePattern;return this._stipplePattern!==i&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,i)),this._stipplePattern=i),this.ensureTechnique(yOe,e)}},Apt=class extends oee{constructor(){super(...arguments),this.width=0,this.color=ed,this.join="miter",this.cap=ud.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}},Opt=class{constructor(e,i){this._parameters=i,this.numJoinSubdivisions=0,this.vertexBufferLayout=e;const r=i.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=J5+r}}_isClosed(e){return vOe(this._parameters,e.vertexAttributes,e.indices)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const r=e.indices.get(A.POSITION).length/2+1,s=this._isClosed(e);let n=s?2:2*2;return n+=((s?r:r-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this._parameters.wireframe&&(n=2+4*(n-2)),n}write(e,i,r,s,n){var ie;const o=Ipt,a=$pt,l=Lpt,c=r.vertexAttributes.get(A.POSITION).data,h=r.indices&&r.indices.get(A.POSITION),p=(ie=r.vertexAttributes.get(A.DISTANCETOSTART))==null?void 0:ie.data;h&&h.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let f=1,m=0;this._parameters.vvSizeEnabled?m=r.vertexAttributes.get(A.SIZEFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(A.SIZE)&&(f=r.vertexAttributes.get(A.SIZE).data[0]);let y=[1,1,1,1],_=0;this._parameters.vvColorEnabled?_=r.vertexAttributes.get(A.COLORFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(A.COLOR)&&(y=r.vertexAttributes.get(A.COLOR).data);const b=de("enable-feature:objectAndLayerId-rendering")?r.objectAndLayerIdColor:null;let w=0;this._parameters.vvOpacityEnabled&&(w=r.vertexAttributes.get(A.OPACITYFEATUREATTRIBUTE).data[0]);const S=c.length/3,T=new Float32Array(s.buffer),E=de("enable-feature:objectAndLayerId-rendering")?new Uint8Array(s.buffer):null,O=this.vertexBufferLayout.stride/4;let R=n*O;const L=R;let P=0;const F=p?(H,$,N)=>P=p[N]:(H,$,N)=>P+=Ar(H,$),V=de("enable-feature:objectAndLayerId-rendering"),B=(H,$,N,U,q,Y,Q)=>{if(T[R++]=$[0],T[R++]=$[1],T[R++]=$[2],T[R++]=U,T[R++]=Q,T[R++]=q,T[R++]=H[0],T[R++]=H[1],T[R++]=H[2],T[R++]=N[0],T[R++]=N[1],T[R++]=N[2],this._parameters.vvSizeEnabled?T[R++]=m:T[R++]=f,this._parameters.vvColorEnabled)T[R++]=_;else{const X=Math.min(4*Y,y.length-4);T[R++]=y[X],T[R++]=y[X+1],T[R++]=y[X+2],T[R++]=y[X+3]}this._parameters.vvOpacityEnabled&&(T[R++]=w),V&&(v(b)&&(E[4*R]=b[0],E[4*R+1]=b[1],E[4*R+2]=b[2],E[4*R+3]=b[3]),R++)};R+=O,fe(a,c[0],c[1],c[2]),e&&ut(a,a,e);const G=this._isClosed(r);if(G){const H=c.length-3;fe(o,c[H],c[H+1],c[H+2]),e&&ut(o,o,e)}else fe(l,c[3],c[4],c[5]),e&&ut(l,l,e),B(a,a,l,1,$c.LEFT_CAP_START,0,0),B(a,a,l,1,$c.RIGHT_CAP_START,0,0),he(o,a),he(a,l);const te=G?0:1,se=G?S:S-1;for(let H=te;H<se;H++){const $=(H+1)%S*3;fe(l,c[$],c[$+1],c[$+2]),e&&ut(l,l,e),F(o,a,H),B(o,a,l,0,$c.LEFT_JOIN_END,H,P),B(o,a,l,0,$c.RIGHT_JOIN_END,H,P);const N=this.numJoinSubdivisions;for(let U=0;U<N;++U){const q=(U+1)/(N+1);B(o,a,l,q,$c.LEFT_JOIN_END,H,P),B(o,a,l,q,$c.RIGHT_JOIN_END,H,P)}B(o,a,l,1,$c.LEFT_JOIN_START,H,P),B(o,a,l,1,$c.RIGHT_JOIN_START,H,P),he(o,a),he(a,l)}G?(fe(l,c[3],c[4],c[5]),e&&ut(l,l,e),P=F(o,a,se),B(o,a,l,0,$c.LEFT_JOIN_END,te,P),B(o,a,l,0,$c.RIGHT_JOIN_END,te,P)):(P=F(o,a,se),B(o,a,a,0,$c.LEFT_CAP_END,se,P),B(o,a,a,0,$c.RIGHT_CAP_END,se,P)),iB(T,L+O,T,L,O),R=iB(T,R-O,T,R,O),this._parameters.wireframe&&this._addWireframeVertices(s,L,R,O)}_addWireframeVertices(e,i,r,s){const n=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT,r-i);let a=0;const l=c=>a=iB(o,c,n,a,s);for(let c=0;c<o.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}};function iB(t,e,i,r,s){for(let n=0;n<s;n++)i[r++]=t[e++];return r}function vOe(t,e,i){return bOe(t,e.get(A.POSITION).data,i?i.get(A.POSITION):null)}function bOe(t,e,i){return!!t.isClosed&&(i?i.length>2:e.length>6)}function Rpt(t){return t.anchor===Zx.Tip&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const Rl=M(),Ml=M(),bf=M(),Y1=M(),Mpt=M(),Z1=na(),J1=na(),Bce=M(),zce=M(),Gce=nf(),Ppt=nf(),Ipt=M(),$pt=M(),Lpt=M(),mO=[na(),na(),na(),na()],xg=[M(),M(),M(),M()],rB=qi(),sB=qi(),nB=qi(),oB=qi();let Tee=class{constructor(e){this._originSR=e,this._origins=new Map,this._objects=new Map,this._gridSize=5e5,this._rootOriginId="root/"+Zc()}getOrigin(e){const i=this._origins.get(this._rootOriginId);if(i==null){const h=spt.rootOrigin;if(v(h))return this._origins.set(this._rootOriginId,c3(h[0],h[1],h[2],this._rootOriginId)),this.getOrigin(e);const p=c3(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,p),p}const r=this._gridSize,s=Math.round(e[0]/r),n=Math.round(e[1]/r),o=Math.round(e[2]/r),a=`${s}/${n}/${o}`;let l=this._origins.get(a);const c=.5*r;if(be(xo,e,i.vec3),xo[0]=Math.abs(xo[0]),xo[1]=Math.abs(xo[1]),xo[2]=Math.abs(xo[2]),xo[0]<c&&xo[1]<c&&xo[2]<c){if(l){const h=Math.max(...xo);if(be(xo,e,l.vec3),xo[0]=Math.abs(xo[0]),xo[1]=Math.abs(xo[1]),xo[2]=Math.abs(xo[2]),Math.max(...xo)<h)return l}return i}return l||(l=c3(s*r,n*r,o*r,a),this._origins.set(a,l)),l}_drawOriginBox(e,i=si(1,1,0,1)){const r=window.view,s=r._stage,n=i.toString();if(!this._objects.has(n)){this._material=new rE({width:2,color:i}),s.add(this._material);const m=new sOe({pickable:!1}),y=new v0({castShadow:!1});s.add(y),m.add(y),s.add(m),this._objects.set(n,y)}const o=this._objects.get(n),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),h=new Array,p=.5*this._gridSize;for(let m=0;m<l;m++)c[3*m+0]=e[0]+(1&a[m]?p:-p),c[3*m+1]=e[1]+(2&a[m]?p:-p),c[3*m+2]=e[2]+(4&a[m]?p:-p),m>0&&h.push(m-1,m);Es(c,this._originSR,0,c,r.renderSpatialReference,0,l);const f=new fn(this._material,[[A.POSITION,new ht(c,3,!0)]],[[A.POSITION,h]],null,Vs.Line);s.add(f),o.addGeometry(f)}get test(){const e=this;return{set gridSize(i){e._gridSize=i}}}};const xo=M();let wOe=class{constructor(e,i,r,s=null){this.rctx=e,this.sliceHelper=s,this.lastFrameCamera=new Ut,this.output=k.Color,this.renderOccludedMask=jce,this.bindParameters=new s8(i,r,v(s)?s.plane:null)}resetRenderOccludedMask(){this.renderOccludedMask=jce}},Dpt=class extends wOe{constructor(e,i,r,s,n){super(e,r,s,n),this.offscreenRenderingHelper=i,this.sliceHelper=n,this.time=0}};const jce=ps.Occlude|ps.OccludeAndTransparent|ps.OccludeAndTransparentStencil;let tM=class extends Ut{constructor(){super(...arguments),this._projectionMatrix=We()}get projectionMatrix(){return this._projectionMatrix}};u([d()],tM.prototype,"_projectionMatrix",void 0),u([d({readOnly:!0})],tM.prototype,"projectionMatrix",null),tM=u([I("esri.views.3d.webgl-engine.lib.CascadeCamera")],tM);var UC;(function(t){t[t.Highlight=0]="Highlight",t[t.Default=1]="Default"})(UC||(UC={}));let VL=class{constructor(){this.camera=new tM,this.lightMat=We()}},See=class{get depthTexture(){return this._depthTexture}get textureSize(){return this._textureSize}get numCascades(){return this._numCascades}get cascadeDistances(){return nr(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}constructor(e,i){this._rctx=e,this._viewingMode=i,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this._numCascades=1,this._maxNumCascades=4,this._projectionView=We(),this._projectionViewInverse=We(),this._modelViewLight=We(),this._splitSchemeLambda=0,this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=fi(),this._cascades=[new VL,new VL,new VL,new VL],this._lastOrigin=null,this._maxTextureSize=Math.min(de("esri-mobile")?2048:8192,this._rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._discardDepthTexture(),this._discardAllSnapshots()}set maxCascades(e){this._maxNumCascades=we(Math.floor(e),1,4)}get maxCascades(){return this._maxNumCascades}set enabled(e){this._enabled=e,e||(this._discardDepthTexture(),this._discardAllSnapshots())}get enabled(){return this._enabled}get ready(){return this._enabled&&v(this._depthTexture)}getSnapshot(e){return this.enabled?this._snapshots[e]:null}get cascades(){for(let e=0;e<this._numCascades;++e)lB[e]=this._cascades[e];return lB.length=this._numCascades,lB}start(e,i,r){Ct(this.enabled),this._textureSize=this._computeTextureSize(e.fullWidth,e.fullHeight),this._ensureDepthTexture();const{near:s,far:n}=this._clampNearFar(r);this._computeCascadeDistances(n,s),this._setupMatrices(e,i);const{viewMatrix:o,projectionMatrix:a}=e;for(let l=0;l<this._numCascades;++l)this._constructCascade(l,a,o,i);this._lastOrigin=null,this.clear()}finish(e){Ct(this.enabled),this._rctx.bindFramebuffer(e)}getShadowMapMatrices(e){if(!this._lastOrigin||!cl(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||M(),he(this._lastOrigin,e);for(let i=0;i<this._numCascades;++i){hc(Zce,this._cascades[i].lightMat,e);for(let r=0;r<16;++r)Jce[16*i+r]=Zce[r]}}return Jce}takeCascadeSnapshotTo(e,i){Ct(this.enabled);const r=this._ensureSnapshot(i);this._bindFbo();const s=this._rctx,n=s.bindTexture(r,xt.TEXTURE_UNIT_FOR_UPDATES);s.gl.copyTexSubImage2D(Pt.TEXTURE_2D,0,e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[2],e.camera.viewport[3]),s.bindTexture(n,xt.TEXTURE_UNIT_FOR_UPDATES)}clear(){const e=this._rctx;this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(Vr.COLOR_BUFFER_BIT|Vr.DEPTH_BUFFER_BIT)}_computeTextureSize(e,i){const r=.5*Math.log(e*e+i*i)*Math.LOG2E,s=.35,n=2**Math.round(r+s);return Math.min(this._maxTextureSize,2*n)}_ensureDepthTexture(){if(v(this._depthTexture)&&this._depthTexture.descriptor.width===this._textureSize)return;this._discardDepthTexture();const e={target:Pt.TEXTURE_2D,pixelFormat:it.RGBA,dataType:Ht.UNSIGNED_BYTE,wrapMode:kt.CLAMP_TO_EDGE,samplingMode:gt.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};this._depthTexture=new xt(this._rctx,e),this._fbo=new Bs(this._rctx,{colorTarget:gs.TEXTURE,depthStencilTarget:Di.DEPTH_RENDER_BUFFER,width:this._textureSize,height:this._textureSize},this._depthTexture)}_ensureSnapshot(e){let i=this._snapshots[e];if(v(i)&&i.descriptor.width===this._textureSize)return i;this._discardSnapshot(e);const r={target:Pt.TEXTURE_2D,pixelFormat:it.RGBA,dataType:Ht.UNSIGNED_BYTE,wrapMode:kt.CLAMP_TO_EDGE,samplingMode:gt.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};return i=new xt(this._rctx,r),this._snapshots[e]=i,i}_discardDepthTexture(){this._fbo=ft(this._fbo),this._depthTexture=ft(this._depthTexture)}_discardSnapshot(e){this._snapshots[e]=ft(this._snapshots[e])}_discardAllSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){const e=this._rctx;e.unbindTexture(this._depthTexture),e.bindFramebuffer(this._fbo)}_constructCascade(e,i,r,s){const n=this._cascades[e],o=-this._cascadeDistances[e],a=-this._cascadeDistances[e+1],l=(i[10]*o+i[14])/Math.abs(i[11]*o+i[15]),c=(i[10]*a+i[14])/Math.abs(i[11]*a+i[15]);Ct(l<c);for(let m=0;m<8;++m){nr(Hce,m%4==0||m%4==3?-1:1,m%4==0||m%4==1?-1:1,m<4?l:c,1);const y=Vh[m];qu(y,Hce,this._projectionViewInverse),y[0]/=y[3],y[1]/=y[3],y[2]/=y[3]}Pa(aB,Vh[0]),n.camera.viewMatrix=hc(Npt,this._modelViewLight,aB);for(let m=0;m<8;++m)ut(Vh[m],Vh[m],n.camera.viewMatrix);let h=Vh[0][2],p=Vh[0][2];for(let m=1;m<8;++m)h=Math.min(h,Vh[m][2]),p=Math.max(p,Vh[m][2]);h-=200,p+=200,n.camera.near=-p,n.camera.far=-h,kpt(r,s,h,p,n.camera),Ts(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const f=this._textureSize/2;n.camera.viewport=[e%2==0?0:f,Math.floor(e/2)===0?0:f,f,f]}_setupMatrices(e,i){Ts(this._projectionView,e.projectionMatrix,e.viewMatrix),Go(this._projectionViewInverse,this._projectionView);const r=this._viewingMode===st.Global?e.eye:fe(aB,0,0,1);yU(this._modelViewLight,[0,0,0],[-i[0],-i[1],-i[2]],r)}_clampNearFar(e){let{near:i,far:r}=e;return i<2&&(i=2),r<2&&(r=2),i>=r&&(i=2,r=4),{near:i,far:r}}_computeCascadeDistances(e,i){this._numCascades=Math.min(1+Math.floor(Ert(e/i,4)),this._maxNumCascades);const r=(e-i)/this._numCascades,s=(e/i)**(1/this._numCascades);let n=i,o=i;for(let a=0;a<this._numCascades+1;++a)this._cascadeDistances[a]=Yt(n,o,this._splitSchemeLambda),n*=s,o+=r}get gpuMemoryUsage(){var e;return this._snapshots.reduce((i,r)=>i+Gx(r),((e=this._fbo)==null?void 0:e.gpuMemoryUsage)??0)}get test(){const e=this;return{maxNumCascades:this._maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(i){e._splitSchemeLambda=i},get splitSchemeLambda(){return e._splitSchemeLambda}}}};const Npt=We(),Hce=fi(),Vh=[];for(let t=0;t<8;++t)Vh.push(fi());const qce=et(),Wce=et(),Fpt=et(),Xce=et(),Yce=et(),aB=M(),lB=[],Zce=We(),Jce=new Float32Array(64),fu=et(),YT=et(),K1=[et(),et(),et(),et()],Un=et(),cB=et(),q0=et(),gO=et(),ZT=et(),JT=et(),kL=et();function Upt(t,e,i,r,s,n,o,a){It(fu,0,0);for(let O=0;O<4;++O)Gh(fu,fu,t[O]);Ca(fu,fu,.25),It(YT,0,0);for(let O=4;O<8;++O)Gh(YT,YT,t[O]);Ca(YT,YT,.25),vS(K1[0],t[4],t[5],.5),vS(K1[1],t[5],t[6],.5),vS(K1[2],t[6],t[7],.5),vS(K1[3],t[7],t[4],.5);let l=0,c=EC(K1[0],fu);for(let O=1;O<4;++O){const R=EC(K1[O],fu);R<c&&(c=R,l=O)}ju(Un,K1[l],t[l+4]);const h=Un[0];let p,f;Un[0]=-Un[1],Un[1]=h,ju(cB,YT,fu),dn(cB,Un)<0&&NK(Un,Un),vS(Un,Un,cB,i),kx(Un,Un),p=f=dn(ju(q0,t[0],fu),Un);for(let O=1;O<8;++O){const R=dn(ju(q0,t[O],fu),Un);R<p?p=R:R>f&&(f=R)}Fn(r,fu),Ca(q0,Un,p-e),Gh(r,r,q0);let m=-1,y=1,_=0,b=0;for(let O=0;O<8;++O){ju(gO,t[O],r),kx(gO,gO);const R=Un[0]*gO[1]-Un[1]*gO[0];R>0?R>m&&(m=R,_=O):R<y&&(y=R,b=O)}IT(m>0,"leftArea"),IT(y<0,"rightArea"),Ca(ZT,Un,p),Gh(ZT,ZT,fu),Ca(JT,Un,f),Gh(JT,JT,fu),kL[0]=-Un[1],kL[1]=Un[0];const w=K$(r,t[b],JT,Gh(q0,JT,kL),1,s),S=K$(r,t[_],JT,q0,1,n),T=K$(r,t[_],ZT,Gh(q0,ZT,kL),1,o),E=K$(r,t[b],ZT,q0,1,a);IT(w,"rayRay"),IT(S,"rayRay"),IT(T,"rayRay"),IT(E,"rayRay")}function Ii(t,e){return 3*e+t}const Kce=et();function gc(t,e){return It(Kce,t[e],t[e+3]),Kce}const Pl=et(),_t=ls();function Vpt(t,e,i,r,s){ju(Pl,i,r),Ca(Pl,Pl,.5),_t[0]=Pl[0],_t[1]=Pl[1],_t[2]=0,_t[3]=Pl[1],_t[4]=-Pl[0],_t[5]=0,_t[6]=Pl[0]*Pl[0]+Pl[1]*Pl[1],_t[7]=Pl[0]*Pl[1]-Pl[1]*Pl[0],_t[8]=1,_t[Ii(0,2)]=-dn(gc(_t,0),t),_t[Ii(1,2)]=-dn(gc(_t,1),t);let n=dn(gc(_t,0),i)+_t[Ii(0,2)],o=dn(gc(_t,1),i)+_t[Ii(1,2)],a=dn(gc(_t,0),r)+_t[Ii(0,2)],l=dn(gc(_t,1),r)+_t[Ii(1,2)];n=-(n+a)/(o+l),_t[Ii(0,0)]+=_t[Ii(1,0)]*n,_t[Ii(0,1)]+=_t[Ii(1,1)]*n,_t[Ii(0,2)]+=_t[Ii(1,2)]*n,n=1/(dn(gc(_t,0),i)+_t[Ii(0,2)]),o=1/(dn(gc(_t,1),i)+_t[Ii(1,2)]),_t[Ii(0,0)]*=n,_t[Ii(0,1)]*=n,_t[Ii(0,2)]*=n,_t[Ii(1,0)]*=o,_t[Ii(1,1)]*=o,_t[Ii(1,2)]*=o,_t[Ii(2,0)]=_t[Ii(1,0)],_t[Ii(2,1)]=_t[Ii(1,1)],_t[Ii(2,2)]=_t[Ii(1,2)],_t[Ii(1,2)]+=1,n=dn(gc(_t,1),e)+_t[Ii(1,2)],o=dn(gc(_t,2),e)+_t[Ii(2,2)],a=dn(gc(_t,1),i)+_t[Ii(1,2)],l=dn(gc(_t,2),i)+_t[Ii(2,2)],n=-.5*(n/o+a/l),_t[Ii(1,0)]+=_t[Ii(2,0)]*n,_t[Ii(1,1)]+=_t[Ii(2,1)]*n,_t[Ii(1,2)]+=_t[Ii(2,2)]*n,n=dn(gc(_t,1),e)+_t[Ii(1,2)],o=dn(gc(_t,2),e)+_t[Ii(2,2)],a=-o/n,_t[Ii(1,0)]*=a,_t[Ii(1,1)]*=a,_t[Ii(1,2)]*=a,s[0]=_t[0],s[1]=_t[1],s[2]=0,s[3]=_t[2],s[4]=_t[3],s[5]=_t[4],s[6]=0,s[7]=_t[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=_t[6],s[13]=_t[7],s[14]=0,s[15]=_t[8]}function kpt(t,e,i,r,s){const n=1/Vh[0][3],o=1/Vh[4][3];Ct(n<o);let a=n+Math.sqrt(n*o);const l=Math.sin(Dn(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));a/=l,Upt(Vh,a,l,qce,Wce,Fpt,Xce,Yce),Vpt(qce,Wce,Xce,Yce,s.projectionMatrix),s.projectionMatrix[10]=2/(i-r),s.projectionMatrix[14]=-(i+r)/(i-r)}function Bpt(t){return lf(t)&&t.intersector===as.TERRAIN&&!!t.target}let zpt=class extends p8{constructor(e,i,r){super(e,i),this.triangleNr=r}};function xOe(t){return lf(t)&&t.intersector===as.OVERLAY&&!!t.target}let rX=class{constructor(){this.adds=new li,this.removes=new li,this.updates=new li({allocator:e=>e||new Gpt,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},Gpt=class{},jpt=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var ds,Gn;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})(ds||(ds={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(Gn||(Gn={}));function TOe(t){const e=new Map,i=r=>{let s=e.get(r);return s||(s=new jpt,e.set(r,s)),s};return t.removes.forAll(r=>{uB(r)&&i(r.material).removes.push(r)}),t.adds.forAll(r=>{uB(r)&&i(r.material).adds.push(r)}),t.updates.forAll(r=>{uB(r.renderGeometry)&&i(r.renderGeometry.material).updates.push(r)}),e}function uB(t){return t.geometry.indexCount>=1}let Hpt=class{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createProgram()}_createProgram(){const e=`
    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,i=`
    void main(void) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`;return this._rctx.programCache.acquire(e,i,new Map([]))}_createIndexbuffer(){return Yi.createIndex(this._rctx,Fi.STATIC_DRAW,new Uint32Array([0]))}resetIndicesType(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,Bt.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(jt.POINTS,1,wt.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}},SOe=class{constructor(e,i){this._material=e,this._repository=i,this._map=new Map}destroy(){this._map.forEach((e,i)=>{v(e)&&this._repository.release(this._material,i)})}load(e,i,r){if(!this._material.requiresSlot(i,r))return null;this._map.has(r)||this._map.set(r,this._repository.acquire(this._material,i,r));const s=this._map.get(r);if(v(s)){if(s.ensureResources(e)===Ry.LOADED)return s;this._repository.requestRender()}return null}};function qpt(t){const e=x`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;t.vertex.code.add(e)}function NI(t,e){switch(e.normalType){case lr.CompressedAttribute:t.include(qpt),t.attributes.add(A.NORMALCOMPRESSED,"vec2"),t.vertex.code.add(x`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`);break;case lr.Attribute:t.attributes.add(A.NORMAL,"vec3"),t.vertex.code.add(x`vec3 normalModel() {
return normal;
}`);break;case lr.ScreenDerivative:t.extensions.add("GL_OES_standard_derivatives"),t.fragment.code.add(x`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:e.normalType;case lr.COUNT:case lr.Ground:}}var lr;(function(t){t[t.Attribute=0]="Attribute",t[t.CompressedAttribute=1]="CompressedAttribute",t[t.Ground=2]="Ground",t[t.ScreenDerivative=3]="ScreenDerivative",t[t.COUNT=4]="COUNT"})(lr||(lr={}));function F8(t,e){switch(e.normalType){case lr.Attribute:case lr.CompressedAttribute:t.include(NI,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add([new lP("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel),new ng("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal)]),t.vertex.code.add(x`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case lr.Ground:t.include(OE,e),t.varyings.add("vNormalWorld","vec3"),t.vertex.code.add(x`
        void forwardNormal() {
          vNormalWorld = ${e.spherical?x`normalize(vPositionWorldCameraRelative);`:x`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case lr.ScreenDerivative:t.vertex.code.add(x`void forwardNormal() {}`);break;default:e.normalType;case lr.COUNT:}}let EOe=class extends hSe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=ls()}},COe=class extends dSe{constructor(){super(...arguments),this.transformNormalGlobalFromModel=ls(),this.toMapSpace=fi()}},sX=class extends COe{constructor(e=M()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}},AA=class{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(A.POSITION).length}write(e,i,r,s,n){UCe(r,this.vertexBufferLayout,e,i,s,n)}};const Wpt=cs().vec3f(A.POSITION),Xpt=cs().vec3f(A.POSITION).vec2f(A.UV0),AOe=cs().vec3f(A.POSITION).vec4u8(A.COLOR);cs().vec3f(A.POSITION).vec4u8(A.OBJECTANDLAYERIDCOLOR);cs().vec3f(A.POSITION).vec2f(A.UV0).vec4u8(A.OBJECTANDLAYERIDCOLOR);const Ypt=cs().vec3f(A.POSITION).vec4u8(A.COLOR).vec4u8(A.OBJECTANDLAYERIDCOLOR);let Eee=class extends x1{intersect(e,i,r,s,n,o){return ACe(e,r,s,n,void 0,o)}};function Zpt(t){t.fragment.code.add(x`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function Jpt(t){t.fragment.code.add(x`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function Qce(t){t.fragment.uniforms.add(new zt("texWaveNormal",e=>e.waveNormal)),t.fragment.uniforms.add(new zt("texWavePerturbation",e=>e.wavePertubation)),t.fragment.uniforms.add([new Si("waveParams",e=>nr(Kpt,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)),new zi("waveDirection",e=>It(Qpt,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity))]),t.include(Zpt),t.fragment.code.add(x`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const Kpt=fi(),Qpt=et();function AP(t,e){e.spherical?t.vertex.code.add(x`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(x`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(x`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(x`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}let FI=class extends Os{constructor(e,i){super(e,"int",gr.Pass,(r,s,n)=>r.setUniform1i(e,i(s,n)))}},eft=class extends Os{constructor(e,i,r){super(e,"mat4",gr.Draw,(s,n,o)=>s.setUniformMatrix4fv(e,i(n,o)),r)}},tft=class extends Os{constructor(e,i,r){super(e,"mat4",gr.Pass,(s,n,o)=>s.setUniformMatrix4fv(e,i(n,o)),r)}},OOe=class extends yr{constructor(){super(...arguments),this.origin=M()}};function U8(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new tft("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),ROe(t,e))}function Jx(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new eft("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),ROe(t,e))}function ROe(t,e){const i=t.fragment;i.include(ou),i.uniforms.add([...jp("shadowMapTex",(r,s)=>s.shadowMap.depthTexture,e.hasWebGL2Context?sr.None:sr.Size),new FI("numCascades",(r,s)=>s.shadowMap.numCascades),new Si("cascadeDistances",(r,s)=>s.shadowMap.cascadeDistances)]),i.code.add(x`
    int chooseCascade(float depth, out mat4 mat) {
      vec4 distance = cascadeDistances;

      // choose correct cascade
      int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;

      mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];

      return i;
    }

    vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
      vec4 lv = mat * vec4(_vpos, 1.0);
      lv.xy /= lv.w;
      return 0.5 * lv.xyz + vec3(0.5);
    }

    vec2 cascadeCoordinates(int i, vec3 lvpos) {
      return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
    }

    float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
      return rgba2float(texture2D(_depthTex, uv));
    }

    float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
      return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
    }

    float filterShadow(vec2 uv, vec3 lvpos, float textureSize, sampler2D _depthTex) {
      float halfPixelSize = 0.5 / textureSize;

      // filter, offset by half pixels
      vec2 st = fract((vec2(halfPixelSize) + uv) * textureSize);

      float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
      float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
      float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
      float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);

      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
    }

    float readShadowMap(const in vec3 _vpos, float _linearDepth) {
      mat4 mat;
      int i = chooseCascade(_linearDepth, mat);

      if (i >= numCascades) { return 0.0; }

      vec3 lvpos = lightSpacePosition(_vpos, mat);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0) { return 0.0; }
      if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }

      // calc coord in cascade texture
      vec2 uv = cascadeCoordinates(i, lvpos);

      vec2 textureSize = ${ad(e,"shadowMapTex")};

      return filterShadow(uv, lvpos, textureSize.x, shadowMapTex);
    }
  `)}function ift(t){const e=t.fragment.code;e.add(x`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.add(x`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.add(x`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function Cee(t,e){const i=t.fragment.code;t.include(xI),e.pbrMode!==St.Normal&&e.pbrMode!==St.Schematic&&e.pbrMode!==St.Terrain&&e.pbrMode!==St.TerrainWithWater||(i.add(x`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),i.add(x`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==St.Normal&&e.pbrMode!==St.Schematic||(t.include(ift),i.add(x`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),i.add(x`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),i.add(x`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),i.add(x`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function rft(t,e){const i=t.fragment.code;t.include(xI),i.add(x`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),i.add(x`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),i.add(x`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),i.add(x`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),i.add(x`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}function MOe(t,e){t.include(rft,e),t.include(e8),t.include(Jpt),e.hasCloudsReflections&&t.include(U2e,e),e.hasScreenSpaceReflections&&t.include(Fit,e);const i=t.fragment;i.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add(x`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),i.uniforms.add([new He("lightingSpecularStrength",(r,s)=>s.lighting.mainLight.specularStrength),new He("lightingEnvironmentStrength",(r,s)=>s.lighting.mainLight.environmentStrength)]),i.code.add(x`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.hasCloudsReflections&&i.code.add(x`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),e.hasScreenSpaceReflections?(i.uniforms.add([new Jr("view",(r,s)=>s.ssr.camera.viewMatrix),new zt("lastFrameColorTexture",(r,s)=>s.ssr.lastFrameColorTexture),new He("fadeFactor",(r,s)=>s.ssr.fadeFactor)]),i.code.add(x`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactor;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):i.code.add(x`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.hasCloudsReflections?e.hasScreenSpaceReflections?i.code.add(x`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):i.code.add(x`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):i.code.add(x`return waterRenderedColor;
}`)}function sft(t){const e=new Ui,{vertex:i,fragment:r}=e;Kc(i,t),e.include(nc,t),e.attributes.add(A.POSITION,"vec3"),e.attributes.add(A.UV0,"vec2");const s=new Si("waterColor",n=>n.color);if(t.output===k.Color&&t.isDraped)return e.varyings.add("vpos","vec3"),i.uniforms.add(s),i.code.add(x`
        void main(void) {
          if (waterColor.a < ${x.float(la)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(s),r.code.add(x`void main() {
gl_FragColor = waterColor;
}`),e;switch(t.output!==k.Color&&t.output!==k.Alpha||(e.include(AP,t),e.include(yA,t),e.varyings.add("vuv","vec2"),e.varyings.add("vpos","vec3"),e.varyings.add("vnormal","vec3"),e.varyings.add("vtbnMatrix","mat3"),t.hasMultipassTerrain&&e.varyings.add("depth","float"),i.uniforms.add(s),i.code.add(x`
      void main(void) {
        if (waterColor.a < ${x.float(la)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${t.output===k.Color?"forwardLinearDepth();":""}
      }
    `)),e.include(sh,t),t.output){case k.Alpha:e.include(en,t),r.uniforms.add(s),r.code.add(x`
        void main() {
          discardBySlice(vpos);
          ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `);break;case k.Color:e.include(g5,t),e.include(XK,{pbrMode:St.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(Qce),e.include(en,t),e.include(Jx,t),e.include(MOe,t),r.uniforms.add([s,new He("timeElapsed",n=>n.timeElapsed),i.uniforms.get("view"),i.uniforms.get("localOrigin")]),rf(r,t),r.include(sg),l0(r),rg(r),r.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${t.receiveShadows?x`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${t.transparencyPassType===$t.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `);break;case k.Normal:e.include(AP,t),e.include(Qce,t),e.include(en,t),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),i.uniforms.add(s),i.code.add(x`
        void main(void) {
          if (waterColor.a < ${x.float(la)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(new He("timeElapsed",n=>n.timeElapsed)),r.code.add(x`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case k.Highlight:e.include(g0,t),e.varyings.add("vpos","vec3"),i.uniforms.add(s),i.code.add(x`
      void main(void) {
        if (waterColor.a < ${x.float(la)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),e.include(en,t),r.code.add(x`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const nft=Object.freeze(Object.defineProperty({__proto__:null,build:sft},Symbol.toStringTag,{value:"Module"}));let POe=class IOe extends ji{initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Mt.WEBGL2,i.spherical=e.viewingMode===st.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new ki(e.rctx,IOe.shader.get().build(this.configuration),Li)}_setPipelineState(e){const i=this.configuration,r=e===$t.NONE,s=e===$t.FrontFace;return Qt({blending:i.output!==k.Normal&&i.output!==k.Highlight&&i.transparent?r?Qu:y0(e):null,depthTest:{func:T1(e)},depthWrite:r?i.writeDepth?pc:null:R8(e),colorWrite:ui,polygonOffset:r||s?null:I8(i.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};POe.shader=new Vi(nft,()=>ee(()=>import("./WaterSurface.glsl-acf0cf64.js"),[],import.meta.url));let $o=class extends uo{constructor(){super(...arguments),this.output=k.Color,this.transparencyPassType=$t.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};u([z({count:k.COUNT})],$o.prototype,"output",void 0),u([z({count:$t.COUNT})],$o.prototype,"transparencyPassType",void 0),u([z()],$o.prototype,"spherical",void 0),u([z()],$o.prototype,"receiveShadows",void 0),u([z()],$o.prototype,"hasSlicePlane",void 0),u([z()],$o.prototype,"transparent",void 0),u([z()],$o.prototype,"enableOffset",void 0),u([z()],$o.prototype,"writeDepth",void 0),u([z()],$o.prototype,"hasScreenSpaceReflections",void 0),u([z()],$o.prototype,"doublePrecisionRequiresObfuscation",void 0),u([z()],$o.prototype,"hasCloudsReflections",void 0),u([z()],$o.prototype,"isDraped",void 0),u([z()],$o.prototype,"hasMultipassTerrain",void 0),u([z()],$o.prototype,"cullAboveGround",void 0),u([z({constValue:St.Water})],$o.prototype,"pbrMode",void 0),u([z({constValue:!0})],$o.prototype,"useCustomDTRExponentForWater",void 0),u([z({constValue:!0})],$o.prototype,"highStepCount",void 0),u([z({constValue:!1})],$o.prototype,"useFillLights",void 0);let oft=class extends w1{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){e.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:e.ssr.enabled})}_updateCloudsReflectionState(e){const i=v(e.cloudsFade.data);i!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:i})}ensureResources(e){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(e)}beginSlot(e){return this._output===k.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(POe,e)}},$Oe=class extends Eee{constructor(e){super(e,new LOe),this._configuration=new $o,this.animation=new kSe}getConfiguration(e,i){return this._configuration.output=e,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<M8,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}update(e){const i=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*i<aft;const r=this.animation.advance(e);return this.setParameters({timeElapsed:UY(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&r}requiresSlot(e,i){switch(i){case k.Normal:return e===Fe.DRAPED_WATER;case k.Color:if(this.parameters.isDraped)return e===Fe.DRAPED_MATERIAL;break;case k.Alpha:break;case k.Highlight:return e===Fe.OPAQUE_MATERIAL||e===Fe.DRAPED_MATERIAL;default:return!1}let r=Fe.OPAQUE_MATERIAL;return this.parameters.transparent&&(r=this.parameters.writeDepth?Fe.TRANSPARENT_MATERIAL:Fe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===r}createGLMaterial(e){return new oft(e)}createBufferWriter(){return new AA(Xpt)}},LOe=class extends TA{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=Ni(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=si(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1}};const aft=35e3;let Aee=class{constructor(e=0,i=0){this.from=e,this.to=i}get numElements(){return this.to-this.from}};function eue(t){const e=new Map;t.forAll(r=>e.set(r.from,r));let i=!0;for(;i;)i=!1,t.forEach(r=>{const s=e.get(r.to);s&&(r.to=s.to,e.delete(s.from),t.removeUnordered(s),i=!0)})}let tue=class extends Aee{constructor(e,i,r){super(i,r),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return v(this.geometry.highlights)&&this.isVisible}get hasOccludees(){return v(this.geometry.occludees)}},lft=class{constructor(){this.first=0,this.count=0}},cft=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new li({allocator:e=>e||new Aee,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=BL(),this.drawCommandsHighlight=BL(),this.drawCommandsOccludees=BL(),this.drawCommandsShadowHighlightRest=BL()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,i){this.deleteInstance(e),this._instances.set(e,i),this._numElements+=i.numElements}deleteInstance(e){const i=this._instances.get(e);i&&(this._numElements-=i.numElements,this._instances.delete(e))}updateInstance(e,i,r){const s=this._instances.get(e);s&&(this._numElements-=s.numElements,s.from=i,s.to=r,this._numElements+=s.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const r=this.drawCommandsDefault.pushNew(),s=this.holes.front();return v(this.vao)&&this.holes.length===1&&s.to===Math.floor(this.vao.size/e)?(r.first=0,void(r.count=s.from)):(r.first=1/0,r.count=0,this._instances.forEach(n=>{r.first=Math.min(r.first,n.from),r.count=Math.max(r.count,n.to)}),void(r.count-=r.first))}const i=Array.from(this._instances.values()).sort((r,s)=>r.from===s.from?r.to-s.to:r.from-s.from);for(const r of i)r.isVisible&&(iue(r.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,r),iue(r.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,r))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function uft(t){return v(t.vao)}function BL(){return new li({allocator:t=>t||new lft,deallocator:t=>t})}function iue(t,e){const i=t.back();if(i==null){const r=t.pushNew();return r.first=e.from,void(r.count=e.numElements)}if(hft(i,e)){const r=e.from-i.first+e.numElements;i.count=r}else{const r=t.pushNew();r.first=e.from,r.count=e.numElements}}function hft(t,e){return t.first+t.count>=e.from}let dft=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(i=>i.instances.has(e))}};const pft=LN+1;let fft=class{constructor(e,i,r){this._rctx=e,this._locations=i,this._layout=r,this._cache=e.newCache(`VaoCache ${Zc()}`,mft)}dispose(){this._cache.destroy()}newVao(e){const i=e.toString(),r=this._cache.pop(i);if(v(r)){const n=r.pop();return r.length>0&&this._cache.put(i,r,e*r.length,pft),n}const s=new af(this._rctx,this._locations,{geometry:this._layout},{geometry:Yi.createVertex(this._rctx,Fi.STATIC_DRAW)});return s.vertexBuffers.geometry.setSize(e),s}deleteVao(e){if(C(e))return null;const i=e.size,r=i.toString(),s=this._cache.pop(r);return v(s)?(s.push(e),this._cache.put(r,s,i*s.length,-1)):this._cache.put(r,[e],i,-1),null}};function mft(t,e){if(e===hy.ALL)return void t.forEach(s=>s.dispose());const i=t.pop(),r=t.length*i.size;return i.dispose(),r}let DOe=class{constructor(e,i,r){this._rctx=e,this._materialRepository=i,this.material=r,this._dataByOrigin=new Map,this._appleAmdDriverHelper=null,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new SOe(this.material,this._materialRepository),this._bufferWriter=r.createBufferWriter(),this._vaoCache=new fft(e,r.vertexAttributeLocations,au(this._bufferWriter.vertexBufferLayout)),this._rctx.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper=new Hpt(this._rctx))}dispose(){var e;this._glMaterials.destroy(),this._dataByOrigin.forEach(i=>i.dispose()),this._dataByOrigin.clear(),this._vaoCache.dispose(),(e=this._appleAmdDriverHelper)==null||e.dispose()}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this.material instanceof $Oe}get rendersOccluded(){return!this.isEmpty&&this.material.renderOccluded!==ps.Occlude}get numGeometries(){let e=0;return this._dataByOrigin.forEach(i=>e+=i.buffers.reduce((r,s)=>r+s.instances.size,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(i=>i.buffers.forEach(r=>r.instances.forEach(s=>e(s.geometry))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){var s;const i=this._bufferWriter,r=i.vertexBufferLayout.stride/4;for(const n of e){const o=n.renderGeometry,a=(s=this._dataByOrigin.get(o.localOrigin.id))==null?void 0:s.findBuffer(o.id);if(C(a))return;const l=a.instances.get(o.id);if(n.updateType&(Gn.GEOMETRY|Gn.TRANSFORMATION)){const c=HL(i.elementCount(l.geometry.geometry)*r),h=i.vertexBufferLayout.createView(c.buffer);this._writeGeometry(o,h,0),a.vao.vertexBuffers.geometry.setSubData(c,l.from*r,0,l.numElements*r)}n.updateType&(Gn.HIGHLIGHT|Gn.OCCLUDEE|Gn.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(e,i){var s;const r=new _A;for(const n of e){const o=n.localOrigin;if(C(o))continue;let a=r.get(o.id,null);C(a)&&(a=new rue(o.vec3),r.set(o.id,null,a)),a.changes.push(n)}for(const n of i){const o=n.localOrigin;if(C(o))continue;const a=(s=this._dataByOrigin.get(o.id))==null?void 0:s.findBuffer(n.id);if(C(a))continue;let l=r.get(o.id,a);C(l)&&(l=new rue(o.vec3),r.set(o.id,a,l)),l.changes.push(n)}return r}_addAndRemoveGeometries(e,i){const{_bufferWriter:r,_dataByOrigin:s}=this,n=r.vertexBufferLayout.stride/4,o=this._computeDeltas(e,i);o.forEach((a,l)=>{const c=a.get(null),h=v(c)?c.changes:[];o.delete(l,null);let p=s.get(l);if(a.forEach((f,m)=>{if(o.delete(l,m),C(m))return void Ct(!1,"No VAO for removed geometries");if(m.instances.size===f.changes.length)return this._vaoCache.deleteVao(m.vao),A3(p.buffers,m),void(p.buffers.length===0&&h.length===0&&s.delete(l));const y=m.numElements,_=m.vao.size/4,b=h.reduce((E,O)=>E+r.elementCount(O.geometry),0),w=f.changes.reduce((E,O)=>E+r.elementCount(O.geometry),0),S=Math.min((y+b-w)*n,jL),T=S>_;S>Q5&&S<_/2?(f.changes.forEach(({id:E})=>m.deleteInstance(E)),m.instances.forEach(({geometry:E})=>h.push(E)),this._vaoCache.deleteVao(m.vao),A3(p.buffers,m)):T?this._applyAndRebuild(m,h,f):this._applyRemoves(m,f)}),h.length>0)for(C(p)&&(p=new dft(c.origin),s.set(l,p)),p.buffers.forEach(f=>this._applyAdds(f,h));h.length>0;)p.buffers.push(this._applyAndRebuild(new cft,h,null))})}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(i=>{i.drawCommandsDirty&&(i.hasHiddenInstances=!1,i.hasHighlights=!1,i.hasOccludees=!1,Vo(i.instances,r=>(i.updateDrawState(r),i.hasHiddenInstances&&i.hasHighlights&&i.hasOccludees)),i.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||i.hasHighlights,this._hasOccludees=this._hasOccludees||i.hasOccludees})})}_applyAndRebuild(e,i,r){if(v(r))for(const y of r.changes)e.deleteInstance(y.id);const s=this._bufferWriter,n=s.vertexBufferLayout.stride,o=n/4,a=Math.floor(jL/o);let l=e.numElements;for(;i.length>0;){const y=i.pop(),_=s.elementCount(y.geometry);if(l+_>a&&l>0){i.push(y);break}l+=_;const b=new tue(y,0,0);Ct(e.instances.get(y.id)==null),e.addInstance(y.id,b)}const c=l*o,h=HL(c),p=s.vertexBufferLayout.createView(h.buffer);let f=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach((y,_)=>{this._writeGeometry(y.geometry,p,f);const b=f;f+=s.elementCount(y.geometry.geometry),e.updateInstance(_,b,f),e.updateDrawState(y)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(nue(c)),e.vao.vertexBuffers.geometry.setSubData(h,0,0,f*o),e.holes.clear();const m=e.holes.pushNew();return m.from=f,m.to=Math.floor(e.vao.size/n),e.updateDrawCommands(n),e}_applyRemoves(e,i){if(i.changes.length===0)return;for(const a of i.changes){const l=a.id,c=e.instances.get(l);if(!c)continue;e.deleteInstance(l);const h=wf.back();if(h){if(h.to===c.from){h.to=c.to;continue}if(h.from===c.to){h.from=c.from;continue}}const p=wf.pushNew();p.from=c.from,p.to=c.to}eue(wf);const r=this._bufferWriter.vertexBufferLayout.stride/4,s=wf.reduce((a,l)=>Math.max(a,l.numElements),0)*r,n=HL(s);n.fill(0,0,s);const o=e.vao.vertexBuffers.geometry;wf.forAll(a=>o.setSubData(n,a.from*r,0,a.numElements*r)),e.holes.pushArray(wf.data,wf.length),wf.forAll((a,l)=>wf.data[l]=null),wf.clear(),e.drawCommandsDirty=!0}_applyAdds(e,i){if(i.length===0)return;if(!uft(e))return void this._applyAndRebuild(e,i,null);const r=this._bufferWriter,s=r.vertexBufferLayout.stride/4,n=e.numElements,o=i.reduce((w,S)=>w+r.elementCount(S.geometry),0),a=Math.min((n+o)*s,jL),l=4*a;if(e.vao.size<nue(jL-Q5)&&l>e.vao.size)return void this._applyAndRebuild(e,i,null);eue(e.holes);const c=new Array;for(const w of i){const S=r.elementCount(w.geometry),T=gft(e.holes,S);c.push(T)}const h=e.vao.vertexBuffers.geometry;let p=0,f=0,m=0;const y=HL(a),_=r.vertexBufferLayout.createView(y.buffer);i.forEach((w,S)=>{const T=c[S];if(C(T))return;if(m!==T){const R=m-f;R>0&&h.setSubData(y,f*s,0,R*s),f=T,p=0}const E=r.elementCount(w.geometry);this._writeGeometry(w,_,p),p+=E,m=T+E;const O=new tue(w,T,T+E);Ct(e.instances.get(w.id)==null),e.addInstance(w.id,O),e.drawCommandsDirty=!0});const b=m-f;b>0&&h.setSubData(y,f*s,0,b*s),sDe(i,(w,S)=>C(c[S]))}_writeGeometry(e,i,r){const s=e.localOrigin.vec3;Crt(sue,-s[0],-s[1],-s[2]);const n=Ts(yft,sue,e.transformation);Go(zL,n),tu(zL,zL),this._bufferWriter.write(n,zL,e.geometry,i,r)}updateAnimation(e){return this.material.update(e)}requiresSlot(e,i){return this.material.requiresSlot(e,i)}render(e,i){var c;if(!this.requiresSlot(i.slot,e))return!1;const r=e===k.Highlight||e===k.ShadowHighlight;if(r&&!this._hasHighlights)return!1;const s=e===k.ShadowExcludeHighlight,n=!(r||s),o=this._rctx;let a;const l=()=>{if(v(a))return a;const h=this._glMaterials.load(o,i.slot,e);return C(h)?null:(a=h.beginSlot(i),C(a)?null:(o.bindTechnique(a,this.material.parameters,i),a))};(c=this._appleAmdDriverHelper)==null||c.resetIndicesType();for(const h of this._dataByOrigin.values())for(const p of h.buffers){if(r&&!p.hasHighlights)continue;const f=(r?p.drawCommandsHighlight:s&&p.needsMultipleCommands()?p.drawCommandsShadowHighlightRest:p.drawCommandsDefault)||null,m=n&&p.drawCommandsOccludees||null;if(f!=null&&f.length||m!=null&&m.length){const y=l();if(C(y))return!1;y.program.bindDraw(new sX(h.origin),i,this.material.parameters),y.ensureAttributeLocations(p.vao),o.bindVAO(p.vao),f!=null&&f.length&&(y.bindPipelineState(o,i.slot,!1),f.forAll(_=>o.drawArrays(y.primitiveType,_.first,_.count))),m!=null&&m.length&&(y.bindPipelineState(o,i.slot,!0),m.forAll(_=>o.drawArrays(y.primitiveType,_.first,_.count)))}}return v(a)}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}},rue=class{constructor(e){this.origin=e,this.changes=new Array}};function gft(t,e){let i;if(!t.some(s=>!(s.numElements<e)&&(i=s,!0)))return null;const r=i.from;return i.from+=e,i.from>=i.to&&t.removeUnordered(i),r}const sue=We(),yft=We(),zL=We(),wf=new li({allocator:t=>t||new Aee,deallocator:null}),Q5=65536,GL=4*Q5,NOe=16777216,jL=NOe/4;let hB=new Float32Array(Q5);function HL(t){return hB.length<t&&(hB=new Float32Array(t)),hB}function nue(t){const e=4*t;return e<GL?GL:Math.max(Math.min(Math.ceil(1.5*e/GL)*GL,NOe),e)}let Au=class extends $e{constructor(e){super(e),this._pending=new _ft,this._changes=new rX,this._materialRenderers=new Map,this._sortedMaterialRenderers=new li,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return Vo(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=TOe(this._changes);let i=!1,r=!1,s=!1;return e.forEach((n,o)=>{let a=this._materialRenderers.get(o);if(!a&&n.adds.length>0&&(a=new DOe(this.rctx,this._materialRepository,o),this._materialRenderers.set(o,a),i=!0,r=!0,s=!0),!a)return;const l=r||a.hasHighlights,c=s||a.hasWater;a.modify(n),r=r||l!==a.hasHighlights,s=s||c!==a.hasWater,a.isEmpty&&(this._materialRenderers.delete(o),a.dispose(),i=!0)}),this._changes.clear(),i&&this._updateSortedMaterialRenderers(),r&&(this._hasHighlights=Vo(this._materialRenderers,n=>n.hasHighlights)),s&&(this._hasWater=Vo(this._materialRenderers,n=>n.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,i){if(e.length===0)return;const r=this._validateRenderGeometries(e);for(const n of r)this._geometries.set(n.id,n);const s=this._pending.empty;for(const n of r)this._pending.adds.add(n);s&&this.notifyChange("updating"),i===ds.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,i){const r=this._pending.empty,s=this._pending.adds;for(const n of e)s.has(n)?(this._pending.removed.add(n),s.delete(n)):this._pending.removed.has(n)||this._pending.removes.add(n),this._geometries.delete(n.id);r&&!this._pending.empty&&this.notifyChange("updating"),i===ds.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,i){const r=this._changes.updates.length===0;for(const s of e){const n=this._changes.updates.pushNew();n.renderGeometry=this._validateRenderGeometry(s),n.updateType=i}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),i){case Gn.TRANSFORMATION:case Gn.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case Gn.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let i=!1;return this._sortedMaterialRenderers.forAll(r=>i=r.updateAnimation(e)||i),i}render(e){this._sortedMaterialRenderers.forAll(i=>{i.material.shouldRender(e)&&i.render(e.output,e.bindParameters)})}intersect(e,i,r,s,n){return this._geometries.forEach(o=>{if(s&&!s(o))return;this._intersectRenderGeometry(o,r,i,0,e,n);const a=this.rendererContext.longitudeCyclical;a&&(o.boundingSphere[0]-o.boundingSphere[3]<a.min&&this._intersectRenderGeometry(o,r,i,a.range,e,n),o.boundingSphere[0]+o.boundingSphere[3]>a.max&&this._intersectRenderGeometry(o,r,i,-a.range,e,n)),n++}),n}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((i,r)=>{r.insertOrder=e++,this._sortedMaterialRenderers.push(i)}),this._sortedMaterialRenderers.sort((i,r)=>{const s=r.material.renderPriority-i.material.renderPriority;return s!==0?s:i.material.insertOrder-r.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const i=this._changes.updates.data[e];this._pending.has(i.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,i,r,s,n,o){if(!e.visible)return;let a=0;s+=e.transformation[12],a=e.transformation[13],dB[0]=r[0]-s,dB[1]=r[1]-a,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,n,dB,(l,c,h)=>{vft(i,h,e.material.renderPriority,o,n,e.layerUid,e.graphicUid)},i)}_notifyGraphicGeometryChanged(e){if(C(this.drapeSource.notifyGraphicGeometryChanged))return;let i;for(const r of e){const s=r.graphicUid;v(s)&&s!==i&&(this.drapeSource.notifyGraphicGeometryChanged(s),i=s)}}_notifyGraphicVisibilityChanged(e){if(C(this.drapeSource.notifyGraphicVisibilityChanged))return;let i;for(const r of e){const s=r.graphicUid;v(s)&&s!==i&&(this.drapeSource.notifyGraphicVisibilityChanged(s),i=s)}}_validateRenderGeometries(e){for(const i of e)this._validateRenderGeometry(i);return e}_validateRenderGeometry(e){return C(e.localOrigin)&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};u([d()],Au.prototype,"drapeSource",void 0),u([d()],Au.prototype,"updating",null),u([d()],Au.prototype,"rctx",null),u([d()],Au.prototype,"rendererContext",void 0),u([d()],Au.prototype,"_materialRepository",null),u([d()],Au.prototype,"_localOriginFactory",null),u([d({readOnly:!0})],Au.prototype,"isEmpty",null),u([d()],Au.prototype,"_materialRenderers",void 0),u([d()],Au.prototype,"_geometries",void 0),Au=u([I("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Au);let _ft=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function vft(t,e,i,r,s,n,o){const a=new zpt(n,o,e),l=c=>{c.set(as.OVERLAY,a,t.dist,t.normal,t.transformation,i,r)};if((s.results.min.drapedLayerOrder==null||i>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==Ho.MIN&&(s.results.max.drapedLayerOrder==null||i<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===Ho.ALL){const c=EQ(s.ray);l(c),s.results.all.push(c)}}const dB=et(),pB=4;function bft(){const t=new Ui,e=t.fragment;t.include(Ad);const i=(pB+1)/2,r=1/(2*i*i);return e.include(rh),e.uniforms.add([new zt("depthMap",s=>s.depthTexture),new wI("tex",s=>s.colorTexture),new aP("blurSize",s=>s.blurSize),new He("projScale",(s,n)=>{const o=Ar(n.camera.eye,n.camera.center);return o>5e4?Math.max(0,s.projScale-(o-5e4)):s.projScale}),new zi("nearFar",(s,n)=>n.camera.nearFar)]),e.code.add(x`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture2D(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${x.float(r)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),e.code.add(x`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${x.int(pB)}; r <= ${x.int(pB)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      gl_FragColor = vec4(b / w_total);
    }
  `),t}const wft=Object.freeze(Object.defineProperty({__proto__:null,build:bft},Symbol.toStringTag,{value:"Module"}));let FOe=class UOe extends ji{initializeProgram(e){return new ki(e.rctx,UOe.shader.get().build(),Li)}initializePipeline(){return Qt({colorWrite:ui})}};FOe.shader=new Vi(wft,()=>ee(()=>import("./SSAOBlur.glsl-49f65403.js"),[],import.meta.url));const xft="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";function V8(t){t.fragment.uniforms.add(new Si("projInfo",(e,i)=>Tft(i))),t.fragment.uniforms.add(new zi("zScale",(e,i)=>VOe(i))),t.fragment.code.add(x`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function Tft(t){const e=t.camera.projectionMatrix;return e[11]===0?nr(oue,2/(t.camera.fullWidth*e[0]),2/(t.camera.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):nr(oue,-2/(t.camera.fullWidth*e[0]),-2/(t.camera.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const oue=fi();function VOe(t){return t.camera.projectionMatrix[11]===0?It(aue,0,1):It(aue,1,0)}const aue=et(),lue=16;function Sft(){const t=new Ui,e=t.fragment;return t.include(Ad),e.include(rh),t.include(V8),e.uniforms.add(new He("radius",(i,r)=>Oee(r.camera))),e.code.add(x`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),e.code.add(x`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.uniforms.add([new zi("nearFar",(i,r)=>r.camera.nearFar),new zt("normalMap",i=>i.normalTexture),new zt("depthMap",i=>i.depthTexture),new zi("zScale",(i,r)=>VOe(r)),new He("projScale",i=>i.projScale),new zt("rnm",i=>i.noiseTexture),new zi("rnmScale",(i,r)=>It(cue,r.camera.fullWidth/i.noiseTexture.descriptor.width,r.camera.fullHeight/i.noiseTexture.descriptor.height)),new He("intensity",i=>i.intensity),new zi("screenSize",(i,r)=>It(cue,r.camera.fullWidth,r.camera.fullHeight))]),e.code.add(x`
    void main(void) {
      fillSphere();
      vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        gl_FragColor = vec4(0.0);
        return;
      }

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

      // get the normal of current fragment
      vec4 norm4 = texture2D(normalMap, uv);
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
      bool isTerrain = norm4.w<0.5;

      float sum = .0;
      vec3 tapPixelPos;

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${x.int(lue)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        //don't use current or very nearby samples
        if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        if (isTerrain) {
          bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
          if (isTerrainTap) {
            continue;
          }
        }

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${x.int(lue)}),0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
      gl_FragColor = vec4(A);
    }
  `),t}function Oee(t){return Math.max(10,20*t.computeRenderPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const cue=et(),Eft=Object.freeze(Object.defineProperty({__proto__:null,build:Sft,getRadius:Oee},Symbol.toStringTag,{value:"Module"}));let kOe=class BOe extends ji{initializeProgram(e){return new ki(e.rctx,BOe.shader.get().build(),Li)}initializePipeline(){return Qt({colorWrite:ui})}};kOe.shader=new Vi(Eft,()=>ee(()=>import("./SSAO.glsl-84d19909.js"),[],import.meta.url));let Cft=class extends yr{constructor(){super(...arguments),this.projScale=1}},Aft=class extends Cft{constructor(){super(...arguments),this.intensity=1}},Oft=class extends yr{},Rft=class extends Oft{constructor(){super(...arguments),this.blurSize=et()}};const iM=2;let zOe=class{constructor(e,i,r,s){this._view=e,this._techniqueRepository=i,this._rctx=r,this._requestRender=s,this._quadVAO=null,this._passParameters=new Aft,this._drawParameters=new Rft}dispose(){this.enabled=!1,this._quadVAO=ft(this._quadVAO)}disposeOffscreenBuffers(){go(this._ssaoFBO,e=>e.resize(0,0)),go(this._blur0FBO,e=>e.resize(0,0)),go(this._blur1FBO,e=>e.resize(0,0))}set enabled(e){e?this._enable():this._disable()}get enabled(){return v(this._enableTime)}get active(){return this.enabled&&this._ssaoTechnique.compiled&&this._blurTechnique.compiled}get colorTexture(){return v(this._blur1FBO)?this._blur1FBO.colorTexture:null}render(e,i,r,s){if(C(this._enableTime)||C(r)||C(s)||C(this._ssaoFBO)||C(this._blur0FBO)||C(this._blur1FBO))return;if(!this.active)return this._enableTime=i,void this._requestRender();this._enableTime===0&&(this._enableTime=i);const n=this._rctx,o=e.camera,a=this._view.qualitySettings.fadeDuration,l=a>0?Math.min(a,i-this._enableTime)/a:1;this._passParameters.normalTexture=s,this._passParameters.depthTexture=r,this._passParameters.projScale=1/o.computeRenderPixelSizeAtDist(1),this._passParameters.intensity=4*Mft/Oee(o)**6*l;const c=o.fullViewport,h=c[2],p=c[3],f=h/iM,m=p/iM;this._ssaoFBO.resize(h,p),this._blur0FBO.resize(f,m),this._blur1FBO.resize(f,m),C(this._quadVAO)&&(this._quadVAO=ka(this._rctx)),n.bindFramebuffer(this._ssaoFBO),n.setViewport(0,0,h,p),n.bindTechnique(this._ssaoTechnique,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),n.bindVAO(this._quadVAO);const y=oa(this._quadVAO,"geometry");n.drawArrays(jt.TRIANGLE_STRIP,0,y);const _=n.bindTechnique(this._blurTechnique,this._passParameters,e);n.setViewport(0,0,f,m),n.bindFramebuffer(this._blur0FBO),this._drawParameters.colorTexture=this._ssaoFBO.colorTexture,It(this._drawParameters.blurSize,0,iM/p),_.bindDraw(this._drawParameters,e,this._passParameters),n.setViewport(0,0,f,m),n.drawArrays(jt.TRIANGLE_STRIP,0,y),n.bindFramebuffer(this._blur1FBO),this._drawParameters.colorTexture=this._blur0FBO.colorTexture,It(this._drawParameters.blurSize,iM/h,0),_.bindDraw(this._drawParameters,e,this._passParameters),n.drawArrays(jt.TRIANGLE_STRIP,0,y),n.setViewport(c[0],c[1],c[2],c[3]),l<1&&this._requestRender()}_enable(){if(v(this._enableTime))return;const e={target:Pt.TEXTURE_2D,pixelFormat:it.RGBA,dataType:Ht.UNSIGNED_BYTE,samplingMode:gt.LINEAR,wrapMode:kt.CLAMP_TO_EDGE,width:0,height:0},i={colorTarget:gs.TEXTURE,depthStencilTarget:Di.NONE};this._ssaoFBO=new Bs(this._rctx,i,e),this._blur0FBO=new Bs(this._rctx,i,e),this._blur1FBO=new Bs(this._rctx,i,e);const r=Uint8Array.from(atob(xft),s=>s.charCodeAt(0));this._passParameters.noiseTexture=new xt(this._rctx,{target:Pt.TEXTURE_2D,pixelFormat:it.RGB,dataType:Ht.UNSIGNED_BYTE,hasMipmap:!0,width:32,height:32},r),C(this._ssaoTechnique)&&(this._ssaoTechnique=this._techniqueRepository.acquire(kOe)),C(this._blurTechnique)&&(this._blurTechnique=this._techniqueRepository.acquire(FOe)),this._enableTime=0,this._requestRender()}_disable(){this._enableTime=null,this._passParameters.noiseTexture=ft(this._passParameters.noiseTexture),this._blur1FBO=ft(this._blur1FBO),this._blur0FBO=ft(this._blur0FBO),this._ssaoFBO=ft(this._ssaoFBO)}get gpuMemoryUsage(){return(v(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(v(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(v(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}get test(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}};const Mft=.5;let Ree=class GOe extends ji{initializeProgram(e){return new ki(e.rctx,GOe.shader.get().build(),Li)}initializePipeline(){return this.configuration.hasAlpha?Qt({blending:Yn(Ve.SRC_ALPHA,Ve.ONE,Ve.ONE_MINUS_SRC_ALPHA,Ve.ONE_MINUS_SRC_ALPHA),colorWrite:ui}):Qt({colorWrite:ui})}};Ree.shader=new Vi(Jct,()=>ee(()=>import("./TextureOnly.glsl-31f6f66b.js"),[],import.meta.url));let Mee=class extends Va{constructor(){super(...arguments),this.hasAlpha=!1}};u([z()],Mee.prototype,"hasAlpha",void 0);let op=class extends $e{get _bindParameters(){return this._renderContext.bindParameters}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new Ki,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new li,this._passParameters=new ree,this._rctx=null,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this._camera=new Ut,this.worldToPCSRatio=1,this.events=new As,this.longitudeCyclical=null}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext;const i=e.waterTextureRepository;this._stippleTextureRepository=new oOe(e.renderingContext),this._shaderTechniqueRepository=new eOe({rctx:this._rctx,viewingMode:st.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:i}),this._renderContext=new wOe(this._rctx,new See(this._rctx,this.view.state.viewingMode),new zOe(this.view,this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([re(()=>i.updating,()=>this.events.emit("content-changed"),Br),re(()=>this.spatialReference,r=>this._localOriginFactory=new Tee(r),Br),pn(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new tOe(e.textureRepository,this._shaderTechniqueRepository,r=>{(r.renderOccluded&e6)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed")),this._bindParameters.slot=Fe.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=M2e(this._rctx),this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=$t.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new iQ(Xe(1,1,1))]),this._handles.add(this.view.resourceController.scheduler.registerTask(Rt.STAGE,this))}destroy(){this._handles.destroy(),this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=Wr(this._debugTextureTechnique),this._passParameters.texture=ft(this._passParameters.texture),this._bindParameters.highlightDepthTexture=ft(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Je(this._shaderTechniqueRepository),this._temporaryFBO=ft(this._temporaryFBO),this._quadVAO=ft(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||Vo(this._renderers,e=>e.updating)}get hasOverlays(){return v(this._overlays)&&v(this._overlayRenderTarget)}get gpuMemoryUsage(){return v(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,Au)}createDrapeSourceRenderer(e,i,r){const s=this._renderers.get(e);v(s)&&s.destroy();const n=new i({...r,rendererContext:this,drapeSource:e});return this._renderers.set(e,n),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(re(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),n}removeDrapeSourceRenderer(e){if(C(e))return;const i=this._renderers.get(e);C(i)||(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this._handles.remove(e),i.destroy())}collectUnusedRenderTargetMemory(e){let i=!1;if(v(this._overlayRenderTarget))for(const r of this._overlayRenderTarget.renderTargets){const[s,n]=this.overlays,o=s.validTargets[r.type]||!n.validTargets[r.type];i=this._overlayRenderTarget.validateUsageForTarget(o,r,e)||i}return i}get overlays(){return Gt(this._overlays,[])}ensureDrapeTargets(e){v(this._overlays)&&this._overlays.forEach(i=>i.hasTargetWithoutRasterImage=rN(e,r=>r.drapeTargetType===QW.WithoutRasterImage))}ensureDrapeSources(e){v(this._overlays)&&this._overlays.forEach(i=>{i.hasDrapedFeatureSource=rN(e,r=>r.drapeSourceType===a3.Features),i.hasDrapedRasterSource=rN(e,r=>r.drapeSourceType===a3.RasterImage)})}ensureOverlays(e,i){C(this._overlays)&&(this._overlayRenderTarget=new Kdt(this._rctx),this._overlays=[new Lce(os.INNER,this._overlayRenderTarget),new Lce(os.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(i)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=ft(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,i){let r=!1;for(const[s,n]of this._renderers){if(e.done)break;(s.destroyed||i(s))&&n.commitChanges()&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&(v(this._overlays)&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(ll,e=>e.updatePolicy===kv.SYNC)}get isEmpty(){return!Ji.OVERLAY_DRAW_DEBUG_TEXTURE&&!Vo(this._renderers,e=>!e.isEmpty)}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let i=!1;return this._renderers.forEach(r=>i=r.updateAnimation(e)||i),i}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,i,r){const s=e.canvasGeometries;if(s.numViews===0)return!1;this._screenToWorldRatio=r*e.mapUnitsPerPixel;const n=i.output;if(this.isEmpty||n===k.Highlight&&!this.hasHighlights||n===k.Normal&&!this.hasWater||!e.hasSomeSizedView())return!1;const o=i.fbo;if(!o.isValid())return!1;const a=2*e.resolution,l=e.resolution;o.resize(a,l);const c=this._rctx;if(this._camera.pixelRatio=e.pixelRatio*r,this._renderContext.output=n,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=n===k.Normal?Fe.DRAPED_WATER:Fe.DRAPED_MATERIAL,e.applyViewport(this._rctx),o.bind(c),e.index===os.INNER&&(c.setClearColor(0,0,0,0),c.clearSafe(Vr.COLOR_BUFFER_BIT)),i.type===ws.Occluded&&(this._renderContext.renderOccludedMask=e6),Ji.OVERLAY_DRAW_DEBUG_TEXTURE&&i.type!==ws.Occluded)for(let h=0;h<s.numViews;h++)this._setViewParameters(s.extents[h],e),this._drawDebugTexture(e.resolution,Ift[e.index]);return this._renderers.size>0&&this._sortedRenderers.forAll(({drapeSource:h,renderer:p})=>{if(i.type===ws.ColorNoRasterImage&&h.drapeSourceType===a3.RasterImage)return;const{fullOpacity:f}=h,m=v(f)&&f<1&&n===k.Color;m&&(this.bindTemporaryFramebuffer(this._rctx,a,l),c.clearSafe(Vr.COLOR_BUFFER_BIT));for(let y=0;y<s.numViews;y++)this._setViewParameters(s.extents[y],e),p.render(this._renderContext);m&&v(this._temporaryFBO)&&(o.bind(c),this.view._stage.renderView.compositingHelper.compositeOverlay(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),f,e.index))}),c.bindFramebuffer(null),o.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,i,r){C(this._temporaryFBO)&&(this._temporaryFBO=new QAe(e,!1)),this._temporaryFBO.resize(i,r),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,i,r,s){var o;let n=0;for(const a of this._renderers.values())n=((o=a.intersect)==null?void 0:o.call(a,e,i,r,s,n))??n}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers;this._renderers.forEach((i,r)=>{const s=e.indexOf(r.layer),n=s>=0,o=this._renderers.size*(r.renderGroup??(n?Y5.MapLayer:Y5.ViewLayer))+(n?s:0);this._sortedRenderers.push(new Pft(r,i,o))}),this._sortedRenderers.sort((i,r)=>i.index-r.index)}_setViewParameters(e,i){const r=this._camera;r.viewport=[0,0,i.resolution,i.resolution],p_e(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),gU(r.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=Vo(this._renderers,i=>i.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=Vo(this._renderers,i=>i.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=Vo(this._renderers,i=>i.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,i){this._ensureDebugPatternResources(e,e,i);const r=this._rctx;r.bindTechnique(this._debugTextureTechnique,this._passParameters,null),r.bindVAO(this._quadVAO),r.drawArrays(jt.TRIANGLE_STRIP,0,oa(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,i,r){if(fe(this._passParameters.color,r[0],r[1],r[2]),this._passParameters.texture)return;const s=new Uint8Array(e*i*4);let n=0;for(let a=0;a<i;a++)for(let l=0;l<e;l++){const c=Math.floor(l/10),h=Math.floor(a/10);c<2||h<2||10*c>e-20||10*h>i-20?(s[n++]=255,s[n++]=255,s[n++]=255,s[n++]=255):(s[n++]=255,s[n++]=255,s[n++]=255,s[n++]=1&c&&1&h?1&l^1&a?0:255:1&c^1&h?0:128)}this._passParameters.texture=new xt(this._rctx,{target:Pt.TEXTURE_2D,pixelFormat:it.RGBA,dataType:Ht.UNSIGNED_BYTE,samplingMode:gt.NEAREST,width:e,height:i},s);const o=new Mee;o.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(Ree,o),this._quadVAO=ka(this._rctx)}get test(){return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:e=>this._renderers.get(e)}}};u([d()],op.prototype,"_sortedDrapeSourceRenderersDirty",void 0),u([d({autoDestroy:!0})],op.prototype,"_shaderTechniqueRepository",void 0),u([d({autoDestroy:!0})],op.prototype,"_stippleTextureRepository",void 0),u([d({constructOnly:!0})],op.prototype,"view",void 0),u([d()],op.prototype,"worldToPCSRatio",void 0),u([d()],op.prototype,"spatialReference",void 0),u([d({type:Boolean,readOnly:!0})],op.prototype,"updating",null),u([d()],op.prototype,"isEmpty",null),op=u([I("esri.views.3d.terrain.OverlayRenderer")],op);let Pft=class{constructor(e,i,r){this.drapeSource=e,this.renderer=i,this.index=r}};const Ift=[[1,.5,.5],[.5,.5,1]],Pee=-2,e6=ps.OccludeAndTransparent;function Iee(t,e,i,r){const s=DI(t.rings,!!t.hasZ,Xm.CCW_IS_HOLE),n=ru(s.position.length),o=SAe(s.position,t.spatialReference,0,n,0,s.position,0,s.position.length/3,e,i,r),a=o!=null;return new Dft(s.position,n,qOe(s.polygons,s.position,n),HOe(s.outlines,s.position,n),a,o)}function jOe(t,e){const i=DI(t.rings,!1,Xm.CCW_IS_HOLE),r=Es(i.position,t.spatialReference,0,i.position,e,0,i.position.length/3);for(let s=2;s<i.position.length;s+=3)i.position[s]=Pee;return{position:i.position,polygons:qOe(i.polygons,i.position),outlines:HOe(i.outlines,i.position),projectionSuccess:r}}function HOe(t,e,i=null){return t.filter(({count:r})=>r>1).map(({index:r,count:s})=>{const n=3*r,o=3*s;return v(i)?new WOe(r,s,ld(e,n,o),ld(i,n,o)):new $ee(r,s,ld(e,n,o))})}function qOe(t,e,i=null){const r=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of t){if(n<=1)continue;const l=3*s,c=3*n,h=o.map(f=>f-s),p=v(i)?new $ft(s,n,ld(e,3*s,3*n),ld(i,l,c),h,a):new Lft(s,n,ld(e,3*s,3*n),h,a);r.push(p)}return r}let $ee=class{constructor(e,i,r){this.index=e,this.count=i,this.position=r}},WOe=class extends $ee{constructor(e,i,r,s){super(e,i,r),this.mapPositions=s}},$ft=class extends WOe{constructor(e,i,r,s,n,o){super(e,i,r,s),this.holeIndices=n,this.pathLengths=o}},Lft=class extends $ee{constructor(e,i,r,s,n){super(e,i,r),this.holeIndices=s,this.pathLengths=n}},Dft=class{constructor(e,i,r,s,n,o){this.position=e,this.mapPositions=i,this.polygons=r,this.outlines=s,this.projectionSuccess=n,this.sampledElevation=o}};function XOe(t,e){const i=t.fragment;switch(i.code.add(x`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case ys.None:i.code.add(x`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case ys.View:i.code.add(x`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case ys.WindingOrder:i.code.add(x`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case ys.COUNT:}}var ys;(function(t){t[t.None=0]="None",t[t.View=1]="View",t[t.WindingOrder=2]="WindingOrder",t[t.COUNT=3]="COUNT"})(ys||(ys={}));function YOe(t){t.vertex.code.add(x`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}let Nft=class extends Va{constructor(){super(...arguments),this.instancedDoublePrecision=!1}};function ZOe(t,e){e.instanced&&e.instancedDoublePrecision&&(t.attributes.add(A.MODELORIGINHI,"vec3"),t.attributes.add(A.MODELORIGINLO,"vec3"),t.attributes.add(A.MODEL,"mat3"),t.attributes.add(A.MODELNORMAL,"mat3"));const i=t.vertex;e.instancedDoublePrecision&&(i.include(T5,e),i.uniforms.add(new Ku("viewOriginHi",(r,s)=>Irt(fe(qL,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),qL))),i.uniforms.add(new Ku("viewOriginLo",(r,s)=>$rt(fe(qL,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),qL)))),i.code.add(x`
    vec3 calculateVPos() {
      ${e.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),i.code.add(x`
    vec3 subtractOrigin(vec3 _pos) {
      ${e.instancedDoublePrecision?x`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),i.code.add(x`
    vec3 dpNormal(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),e.output===k.Normal&&(DC(i),i.code.add(x`
    vec3 dpNormalView(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),e.hasVertexTangents&&i.code.add(x`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${e.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}u([z()],Nft.prototype,"instancedDoublePrecision",void 0);const qL=M();var Rn;function Fft(t){switch(t){case"multiply":default:return Rn.Multiply;case"ignore":return Rn.Ignore;case"replace":return Rn.Replace;case"tint":return Rn.Tint}}function JOe(t,e,i){if(C(t)||e===Rn.Ignore)return i[0]=255,i[1]=255,i[2]=255,void(i[3]=255);const r=we(Math.round(t[3]*t6),0,t6),s=r===0||e===Rn.Tint?0:e===Rn.Replace?Uft:Vft;i[0]=we(Math.round(t[0]*KT),0,KT),i[1]=we(Math.round(t[1]*KT),0,KT),i[2]=we(Math.round(t[2]*KT),0,KT),i[3]=r+s}(function(t){t[t.Multiply=1]="Multiply",t[t.Ignore=2]="Ignore",t[t.Replace=3]="Replace",t[t.Tint=4]="Tint"})(Rn||(Rn={}));const KT=255,t6=85,Uft=t6,Vft=2*t6;function KOe(t){t.vertex.code.add(x`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${x.int(Rn.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${x.int(Rn.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${x.int(Rn.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${x.int(Rn.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}function QOe(t,e){e.hasSymbolColors?(t.include(KOe),t.attributes.add(A.SYMBOLCOLOR,"vec4"),t.varyings.add("colorMixMode","mediump float"),t.vertex.code.add(x`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(t.fragment.uniforms.add(new FI("colorMixMode",i=>$Ce[i.colorMixMode])),t.vertex.code.add(x`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function vT(t,e){e.hasVertexColors?(t.attributes.add(A.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(x`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(x`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(x`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function kft(t){t.fragment.code.add(x`
    #define discardOrAdjustAlpha(color) { if (color.a < ${x.float(la)}) { discard; } }
  `)}let px=class extends Os{constructor(e,i){super(e,"float",gr.Draw,(r,s,n)=>r.setUniform1f(e,i(s,n)))}};function fx(t,e){eRe(t,e,new He("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function Bft(t,e){eRe(t,e,new px("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function eRe(t,e,i){const r=t.fragment;switch(e.alphaDiscardMode!==fr.Mask&&e.alphaDiscardMode!==fr.MaskBlend||r.uniforms.add(i),e.alphaDiscardMode){case fr.Blend:return t.include(kft);case fr.Opaque:r.code.add(x`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case fr.Mask:r.code.add(x`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case fr.MaskBlend:t.fragment.code.add(x`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function tRe(t,e){const{vertex:i,fragment:r}=t,s=e.hasModelTransformation;s&&i.uniforms.add(new Jr("model",o=>v(o.modelTransformation)?o.modelTransformation:th));const n=e.hasColorTexture&&e.alphaDiscardMode!==fr.Opaque;switch(e.output){case k.Depth:case k.Shadow:case k.ShadowHighlight:case k.ShadowExcludeHighlight:case k.ObjectAndLayerIdColor:Kc(i,e),t.include(nc,e),t.include(Im,e),t.include(FE,e),t.include(Qy,e),t.include(en,e),t.include(A8,e),Hx(t),t.varyings.add("depth","float"),n&&r.uniforms.add(new zt("tex",o=>o.texture)),i.code.add(x`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPositionWithDepth(proj, view, ${s?"model,":""} vpos, nearFar, depth);
            forwardTextureCoordinates();
            forwardObjectAndLayerIdColor();
          }
        `),t.include(fx,e),r.code.add(x`
          void main(void) {
            discardBySlice(vpos);
            ${n?x`
                    vec4 texColor = texture2D(tex, ${e.hasColorTextureTransform?x`colorUV`:x`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${e.output===k.ObjectAndLayerIdColor?x`outputObjectAndLayerIdColor();`:x`outputDepth(depth);`}
          }
        `);break;case k.Normal:Kc(i,e),t.include(nc,e),t.include(NI,e),t.include(F8,e),t.include(Im,e),t.include(FE,e),n&&r.uniforms.add(new zt("tex",o=>o.texture)),t.varyings.add("vPositionView","vec3"),i.code.add(x`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            ${e.normalType===lr.Attribute?x`
            vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
            forwardTextureCoordinates();
          }
        `),t.include(en,e),t.include(fx,e),r.code.add(x`
          void main() {
            discardBySlice(vpos);
            ${n?x`
                    vec4 texColor = texture2D(tex, ${e.hasColorTextureTransform?x`colorUV`:x`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${e.normalType===lr.ScreenDerivative?x`
                vec3 normal = screenDerivativeNormal(vPositionView);`:x`
                vec3 normal = normalize(vNormalWorld);
                if (gl_FrontFacing == false) normal = -normal;`}
            gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
          }
        `);break;case k.Highlight:Kc(i,e),t.include(nc,e),t.include(Im,e),t.include(FE,e),n&&r.uniforms.add(new zt("tex",o=>o.texture)),i.code.add(x`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
            forwardTextureCoordinates();
          }
        `),t.include(en,e),t.include(fx,e),t.include(g0,e),r.code.add(x`
          void main() {
            discardBySlice(vpos);
            ${n?x`
                    vec4 texColor = texture2D(tex, ${e.hasColorTextureTransform?x`colorUV`:x`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function iRe(t,e){const i=t.fragment;if(e.hasVertexTangents?(t.attributes.add(A.TANGENT,"vec4"),t.varyings.add("vTangent","vec4"),e.doubleSidedMode===ys.WindingOrder?i.code.add(x`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):i.code.add(x`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(t.extensions.add("GL_OES_standard_derivatives"),i.code.add(x`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`)),e.textureCoordinateType!==Ks.None){t.include(HK,e);const r=e.supportsTextureAtlas?e.hasWebGL2Context?sr.None:sr.Size:sr.None;i.uniforms.add(e.pbrTextureBindType===gr.Pass?jp("normalTexture",s=>s.textureNormal,r):Uv("normalTexture",s=>s.textureNormal,r)),i.code.add(x`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${e.supportsTextureAtlas?x`vtc.size = ${ad(e,"normalTexture")};`:""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `)}}function UI(t,e){const i=t.fragment;e.receiveAmbientOcclusion?(i.uniforms.add(jp("ssaoTex",(r,s)=>s.ssaoHelper.colorTexture,e.hasWebGL2Context?sr.None:sr.InvSize)),i.constants.add("blurSizePixelsInverse","float",1/iM),i.code.add(x`
      float evaluateAmbientOcclusionInverse() {
        vec2 ssaoTextureSizeInverse = ${ad(e,"ssaoTex",!0)};
        return texture2D(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).a;
      }

      float evaluateAmbientOcclusion() {
        return 1.0 - evaluateAmbientOcclusionInverse();
      }
    `)):i.code.add(x`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function VI(t){t.constants.add("ambientBoostFactor","float",aSe)}function OA(t){t.uniforms.add(new He("lightingGlobalFactor",(e,i)=>i.lighting.globalFactor))}function Kx(t,e){const i=t.fragment;switch(t.include(UI,e),e.pbrMode!==St.Disabled&&t.include(Cee,e),t.include(XK,e),t.include(xI),i.code.add(x`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${e.pbrMode===St.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),VI(i),OA(i),l0(i),i.code.add(x`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${e.spherical?x`normalize(vPosWorld)`:x`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),rg(i),i.code.add(x`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),e.pbrMode){case St.Disabled:case St.WaterOnIntegratedMesh:case St.Water:t.include(g5,e),i.code.add(x`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case St.Normal:case St.Schematic:i.code.add(x`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),i.code.add(x`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?i.uniforms.add(new My("hasFillLights",(r,s)=>s.enableFillLights)):i.constants.add("hasFillLights","bool",!1),i.code.add(x`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),i.uniforms.add([new He("lightingSpecularStrength",(r,s)=>s.lighting.mainLight.specularStrength),new He("lightingEnvironmentStrength",(r,s)=>s.lighting.mainLight.environmentStrength)]),i.code.add(x`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),i.code.add(x`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${e.pbrMode===St.Schematic?x`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:x`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case St.Terrain:case St.TerrainWithWater:t.include(g5,e),i.code.add(x`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluateTerrainLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:e.pbrMode;case St.COUNT:}}function ac(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function rRe(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function OF(t,e,i,r,s,n,o,a,l){const c=new Float32Array(9);return c[0]=t,c[1]=e,c[2]=i,c[3]=r,c[4]=s,c[5]=n,c[6]=o,c[7]=a,c[8]=l,c}function zft(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:rRe,create:ac,createView:zft,fromValues:OF},Symbol.toStringTag,{value:"Module"}));function Gft(t){t.vertex.uniforms.add(new ng("colorTextureTransformMatrix",e=>v(e.colorTextureTransformMatrix)?e.colorTextureTransformMatrix:ac())),t.varyings.add("colorUV","vec2"),t.vertex.code.add(x`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function jft(t){t.vertex.uniforms.add(new ng("normalTextureTransformMatrix",e=>v(e.normalTextureTransformMatrix)?e.normalTextureTransformMatrix:ac())),t.varyings.add("normalUV","vec2"),t.vertex.code.add(x`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function Hft(t){t.vertex.uniforms.add(new ng("emissiveTextureTransformMatrix",e=>v(e.emissiveTextureTransformMatrix)?e.emissiveTextureTransformMatrix:ac())),t.varyings.add("emissiveUV","vec2"),t.vertex.code.add(x`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function qft(t){t.vertex.uniforms.add(new ng("occlusionTextureTransformMatrix",e=>v(e.occlusionTextureTransformMatrix)?e.occlusionTextureTransformMatrix:ac())),t.varyings.add("occlusionUV","vec2"),t.vertex.code.add(x`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function Wft(t){t.vertex.uniforms.add(new ng("metallicRoughnessTextureTransformMatrix",e=>v(e.metallicRoughnessTextureTransformMatrix)?e.metallicRoughnessTextureTransformMatrix:ac())),t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.code.add(x`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function OP(t){t.include(sg),t.code.add(x`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${x.int(Rn.Multiply)}) {
        return allMixed;
      }
      if (mode == ${x.int(Rn.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${x.int(Rn.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${x.int(Rn.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${x.int(Rn.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function Xft(t){const e=new Ui,{vertex:i,fragment:r,varyings:s}=e;return Kc(i,t),e.include(TI),s.add("vpos","vec3"),e.include(FE,t),e.include(ZOe,t),e.include(SCe,t),t.hasColorTextureTransform&&e.include(Gft),t.output!==k.Color&&t.output!==k.Alpha||(t.hasNormalTextureTransform&&e.include(jft),t.hasEmissionTextureTransform&&e.include(Hft),t.hasOcclusionTextureTransform&&e.include(qft),t.hasMetallicRoughnessTextureTransform&&e.include(Wft),rf(i,t),e.include(NI,t),e.include(nc,t),t.normalType===lr.Attribute&&t.offsetBackfaces&&e.include(YOe),e.include(iRe,t),e.include(F8,t),t.instancedColor&&e.attributes.add(A.INSTANCECOLOR,"vec4"),s.add("localvpos","vec3"),e.include(Im,t),e.include(yA,t),e.include(QOe,t),e.include(vT,t),i.uniforms.add(new Si("externalColor",n=>n.externalColor)),s.add("vcolorExt","vec4"),t.hasMultipassTerrain&&s.add("depth","float"),t.hasModelTransformation&&i.uniforms.add(new Jr("model",n=>v(n.modelTransformation)?n.modelTransformation:th)),i.code.add(x`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${t.instancedColor?"vcolorExt *= instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${x.float(la)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${t.normalType===lr.Attribute?x`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${t.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, ${t.hasModelTransformation?"model,":""} vpos);
          ${t.normalType===lr.Attribute&&t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        ${t.hasColorTextureTransform?x`forwardColorUV();`:""}
        ${t.hasNormalTextureTransform?x`forwardNormalUV();`:""}
        ${t.hasEmissionTextureTransform?x`forwardEmissiveUV();`:""}
        ${t.hasOcclusionTextureTransform?x`forwardOcclusionUV();`:""}
        ${t.hasMetallicRoughnessTextureTransform?x`forwardMetallicRoughnessUV();`:""}
      }
    `)),t.output===k.Alpha&&(e.include(en,t),e.include(fx,t),e.include(sh,t),r.uniforms.add([new He("opacity",n=>n.opacity),new He("layerOpacity",n=>n.layerOpacity)]),t.hasColorTexture&&r.uniforms.add(new zt("tex",n=>n.texture)),r.include(OP),r.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${t.hasColorTexture?x`
                vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?x`colorUV`:x`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:x`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?x`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:x`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        gl_FragColor = vec4(opacity_);
      }
    `)),t.output===k.Color&&(e.include(en,t),e.include(Kx,t),e.include(UI,t),e.include(fx,t),e.include(t.instancedDoublePrecision?U8:Jx,t),e.include(sh,t),rf(r,t),r.uniforms.add([i.uniforms.get("localOrigin"),new ni("ambient",n=>n.ambient),new ni("diffuse",n=>n.diffuse),new He("opacity",n=>n.opacity),new He("layerOpacity",n=>n.layerOpacity)]),t.hasColorTexture&&r.uniforms.add(new zt("tex",n=>n.texture)),e.include(WK,t),e.include(Cee,t),r.include(OP),e.include(XOe,t),VI(r),OA(r),rg(r),r.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${t.hasColorTexture?x`
                vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?x`colorUV`:x`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:x`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${t.normalType===lr.ScreenDerivative?x`
                vec3 normal = screenDerivativeNormal(localvpos);`:x`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${t.pbrMode===St.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${t.receiveShadows?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?x`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:x`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.hasNormalTexture?x`
                mat3 tangentSpace = ${t.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`:x`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${t.spherical?x`normalize(posWorld);`:x`vec3(0.0, 0.0, 1.0);`}

        ${t.snowCover?x`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${t.pbrMode===St.Normal||t.pbrMode===St.Schematic?x`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?x`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:x`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===$t.Color?x`gl_FragColor = premultiplyAlpha(gl_FragColor);`:""}
      }
    `)),e.include(tRe,t),e}const Yft=Object.freeze(Object.defineProperty({__proto__:null,build:Xft},Symbol.toStringTag,{value:"Module"}));let Zft=class extends EOe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Xe(0,1,.5),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=Or.Back,this.emissiveFactor=Xe(0,0,0),this.instancedDoublePrecision=!1,this.normalType=lr.Attribute,this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Xe(.2,.2,.2),this.diffuse=Xe(.8,.8,.8),this.externalColor=si(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=M(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvSizeValue=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=ls(),this.vvOpacityEnabled=!1,this.vvOpacityValues=[],this.vvOpacityOpacities=[],this.transparent=!1,this.writeDepth=!0,this.customDepthTest=Bx.Less,this.textureAlphaMode=fr.Blend,this.textureAlphaCutoff=q5,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=ps.Occlude}},Jft=class extends COe{constructor(){super(...arguments),this.origin=M(),this.slicePlaneLocalOrigin=this.origin}},Lee=class sRe extends ji{initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Mt.WEBGL2,i.spherical=e.viewingMode===st.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,i.textureCoordinateType=i.hasColorTexture||i.hasMetallicRoughnessTexture||i.hasEmissionTexture||i.hasOcclusionTexture||i.hasNormalTexture?Ks.Default:Ks.None,i.objectAndLayerIdColorInstanced=i.instanced}initializeProgram(e){return this._initializeProgram(e,sRe.shader)}_initializeProgram(e,i){return new ki(e.rctx,i.get().build(this.configuration),Li)}_convertDepthTestFunction(e){return e===Bx.Lequal?Dr.LEQUAL:Dr.LESS}_makePipeline(e,i){const r=this.configuration,s=e===$t.NONE,n=e===$t.FrontFace;return Qt({blending:r.output!==k.Color&&r.output!==k.Alpha||!r.transparent?null:s?Qu:y0(e),culling:Kft(r)?i8(r.cullFace):null,depthTest:{func:T1(e,this._convertDepthTestFunction(r.customDepthTest))},depthWrite:(s||n)&&r.writeDepth?pc:null,colorWrite:ui,stencilWrite:r.hasOccludees?Ym:null,stencilTest:r.hasOccludees?i?d1:S1:null,polygonOffset:s||n?null:I8(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,i){return i?this._occludeePipelineState:super.getPipelineState(e,i)}};function Kft(t){return t.cullFace!==Or.None||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}Lee.shader=new Vi(Yft,()=>ee(()=>import("./DefaultMaterial.glsl-ed1367f9.js"),[],import.meta.url));let oi=class extends uo{constructor(){super(...arguments),this.output=k.Color,this.alphaDiscardMode=fr.Opaque,this.doubleSidedMode=ys.None,this.pbrMode=St.Disabled,this.cullFace=Or.None,this.transparencyPassType=$t.NONE,this.normalType=lr.Attribute,this.textureCoordinateType=Ks.None,this.customDepthTest=Bx.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}};u([z({count:k.COUNT})],oi.prototype,"output",void 0),u([z({count:fr.COUNT})],oi.prototype,"alphaDiscardMode",void 0),u([z({count:ys.COUNT})],oi.prototype,"doubleSidedMode",void 0),u([z({count:St.COUNT})],oi.prototype,"pbrMode",void 0),u([z({count:Or.COUNT})],oi.prototype,"cullFace",void 0),u([z({count:$t.COUNT})],oi.prototype,"transparencyPassType",void 0),u([z({count:lr.COUNT})],oi.prototype,"normalType",void 0),u([z({count:Ks.COUNT})],oi.prototype,"textureCoordinateType",void 0),u([z({count:Bx.COUNT})],oi.prototype,"customDepthTest",void 0),u([z()],oi.prototype,"spherical",void 0),u([z()],oi.prototype,"hasVertexColors",void 0),u([z()],oi.prototype,"hasSymbolColors",void 0),u([z()],oi.prototype,"hasVerticalOffset",void 0),u([z()],oi.prototype,"hasSlicePlane",void 0),u([z()],oi.prototype,"hasSliceHighlight",void 0),u([z()],oi.prototype,"hasColorTexture",void 0),u([z()],oi.prototype,"hasMetallicRoughnessTexture",void 0),u([z()],oi.prototype,"hasEmissionTexture",void 0),u([z()],oi.prototype,"hasOcclusionTexture",void 0),u([z()],oi.prototype,"hasNormalTexture",void 0),u([z()],oi.prototype,"hasScreenSizePerspective",void 0),u([z()],oi.prototype,"hasVertexTangents",void 0),u([z()],oi.prototype,"hasOccludees",void 0),u([z()],oi.prototype,"hasMultipassTerrain",void 0),u([z()],oi.prototype,"hasModelTransformation",void 0),u([z()],oi.prototype,"offsetBackfaces",void 0),u([z()],oi.prototype,"vvSize",void 0),u([z()],oi.prototype,"vvColor",void 0),u([z()],oi.prototype,"receiveShadows",void 0),u([z()],oi.prototype,"receiveAmbientOcclusion",void 0),u([z()],oi.prototype,"textureAlphaPremultiplied",void 0),u([z()],oi.prototype,"instanced",void 0),u([z()],oi.prototype,"instancedColor",void 0),u([z()],oi.prototype,"objectAndLayerIdColorInstanced",void 0),u([z()],oi.prototype,"instancedDoublePrecision",void 0),u([z()],oi.prototype,"doublePrecisionRequiresObfuscation",void 0),u([z()],oi.prototype,"writeDepth",void 0),u([z()],oi.prototype,"transparent",void 0),u([z()],oi.prototype,"enableOffset",void 0),u([z()],oi.prototype,"cullAboveGround",void 0),u([z()],oi.prototype,"snowCover",void 0),u([z()],oi.prototype,"hasColorTextureTransform",void 0),u([z()],oi.prototype,"hasEmissionTextureTransform",void 0),u([z()],oi.prototype,"hasNormalTextureTransform",void 0),u([z()],oi.prototype,"hasOcclusionTextureTransform",void 0),u([z()],oi.prototype,"hasMetallicRoughnessTextureTransform",void 0),u([z({constValue:!0})],oi.prototype,"hasVvInstancing",void 0),u([z({constValue:!1})],oi.prototype,"useCustomDTRExponentForWater",void 0),u([z({constValue:!1})],oi.prototype,"supportsTextureAtlas",void 0),u([z({constValue:!0})],oi.prototype,"useFillLights",void 0);function Qft(t){const e=new Ui,{vertex:i,fragment:r,varyings:s}=e;return Kc(i,t),e.include(TI),s.add("vpos","vec3"),e.include(FE,t),e.include(ZOe,t),e.include(SCe,t),t.output!==k.Color&&t.output!==k.Alpha||(rf(e.vertex,t),e.include(NI,t),e.include(nc,t),t.offsetBackfaces&&e.include(YOe),t.instancedColor&&e.attributes.add(A.INSTANCECOLOR,"vec4"),s.add("vNormalWorld","vec3"),s.add("localvpos","vec3"),t.hasMultipassTerrain&&s.add("depth","float"),e.include(Im,t),e.include(yA,t),e.include(QOe,t),e.include(vT,t),i.uniforms.add(new Si("externalColor",n=>n.externalColor)),s.add("vcolorExt","vec4"),i.code.add(x`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${t.instancedColor?"vcolorExt *= instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${x.float(la)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${t.hasMultipassTerrain?x`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),t.output===k.Alpha&&(e.include(en,t),e.include(fx,t),e.include(sh,t),r.uniforms.add([new He("opacity",n=>n.opacity),new He("layerOpacity",n=>n.layerOpacity)]),t.hasColorTexture&&r.uniforms.add(new zt("tex",n=>n.texture)),r.include(OP),r.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?x`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${t.hasColorTexture?x`
                vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?x`colorUV`:x`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:x`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?x`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:x`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        gl_FragColor = vec4(opacity_);
      }
    `)),t.output===k.Color&&(e.include(en,t),e.include(Kx,t),e.include(UI,t),e.include(fx,t),e.include(t.instancedDoublePrecision?U8:Jx,t),e.include(sh,t),rf(e.fragment,t),l0(r),VI(r),OA(r),r.uniforms.add([i.uniforms.get("localOrigin"),i.uniforms.get("view"),new ni("ambient",n=>n.ambient),new ni("diffuse",n=>n.diffuse),new He("opacity",n=>n.opacity),new He("layerOpacity",n=>n.layerOpacity)]),t.hasColorTexture&&r.uniforms.add(new zt("tex",n=>n.texture)),e.include(WK,t),e.include(Cee,t),r.include(OP),e.extensions.add("GL_OES_standard_derivatives"),rg(r),r.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?x`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${t.hasColorTexture?x`
                vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?x`colorUV`:x`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:x`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${t.pbrMode===St.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?x`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:x`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.snowCover?x`albedo = mix(albedo, vec3(1), 0.9);`:x``}
        ${x`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${t.pbrMode===St.Normal||t.pbrMode===St.Schematic?t.spherical?x`vec3 normalGround = normalize(vpos + localOrigin);`:x`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:x``}
        ${t.pbrMode===St.Normal||t.pbrMode===St.Schematic?x`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?x`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:x`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===$t.Color?x`gl_FragColor = premultiplyAlpha(gl_FragColor);`:x``}
      }
    `)),e.include(tRe,t),e}const emt=Object.freeze(Object.defineProperty({__proto__:null,build:Qft},Symbol.toStringTag,{value:"Module"}));let nRe=class oRe extends Lee{initializeConfiguration(e,i){super.initializeConfiguration(e,i),i.hasMetallicRoughnessTexture=!1,i.hasEmissionTexture=!1,i.hasOcclusionTexture=!1,i.hasNormalTexture=!1,i.hasModelTransformation=!1,i.normalType=lr.Attribute,i.doubleSidedMode=ys.WindingOrder,i.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,oRe.shader)}};nRe.shader=new Vi(emt,()=>ee(()=>import("./RealisticTree.glsl-da1d8956.js"),[],import.meta.url));let e0=class extends x1{constructor(e){super(e,rmt),this.supportsEdges=!0,this._configuration=new oi,this._vertexBufferLayout=smt(this.parameters)}isVisibleForOutput(e){return e!==k.Shadow&&e!==k.ShadowExcludeHighlight&&e!==k.ShadowHighlight||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||e.layerOpacity===0)return!1;const{instanced:i,hasVertexColors:r,hasSymbolColors:s,vvColorEnabled:n}=e,o=v(i)&&i.includes("color"),a=e.colorMixMode==="replace",l=e.opacity>0,c=e.externalColor&&e.externalColor[3]>0;return r&&(o||n||s)?!!a||l:r?a?c:l:o||n||s?!!a||l:a?c:l}getConfiguration(e,i){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=!!this.parameters.instanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.hasVerticalOffset=v(this.parameters.verticalOffset),this._configuration.hasScreenSizePerspective=v(this.parameters.screenSizePerspective),this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,v(this.parameters.customDepthTest)&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?Or.None:this.parameters.cullFace,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=v(this.parameters.modelTransformation),e!==k.Color&&e!==k.Alpha||(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=ys.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?ys.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?ys.WindingOrder:ys.None,this._configuration.instancedColor=v(this.parameters.instanced)&&this.parameters.instanced.includes("color"),this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=!!i.ssaoHelper.active&&this.parameters.receiveSSAO,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?St.Schematic:St.Normal:St.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<M8,this._configuration.snowCover=this.hasSnowCover(i),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return v(e.weather)&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}intersect(e,i,r,s,n,o){if(v(this.parameters.verticalOffset)){const a=r.camera;fe(mB,i[12],i[13],i[14]);let l=null;switch(r.viewingMode){case st.Global:l=Oe(uue,mB);break;case st.Local:l=he(uue,amt)}let c=0;const h=be(lmt,mB,a.eye),p=je(h),f=ue(h,h,1/p);let m=null;this.parameters.screenSizePerspective&&(m=Ae(l,f)),c+=PCe(a,p,this.parameters.verticalOffset,m??0,this.parameters.screenSizePerspective),ue(l,l,c),qc(fB,l,r.transform.inverseRotation),s=be(nmt,s,fB),n=be(omt,n,fB)}ACe(e,r,s,n,MW(r.verticalOffset),o)}requiresSlot(e,i){return i===k.Color||i===k.Alpha||i===k.Depth||i===k.Normal||i===k.Shadow||i===k.ShadowHighlight||i===k.ShadowExcludeHighlight||i===k.Highlight||i===k.ObjectAndLayerIdColor?e===(this.parameters.transparent?this.parameters.writeDepth?Fe.TRANSPARENT_MATERIAL:Fe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Fe.OPAQUE_MATERIAL)||e===Fe.DRAPED_MATERIAL:!1}createGLMaterial(e){return new tmt(e)}createBufferWriter(){return new AA(this._vertexBufferLayout)}},tmt=class extends qK{constructor(e){super({...e,...e.material.parameters})}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==k.Color&&this._output!==k.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e));const i=this._material.parameters;this.updateTexture(i.textureId);const r=e.camera.viewInverseTransposeMatrix;return fe(i.origin,r[3],r[7],r[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(i.treeRendering?nRe:Lee,e)}},imt=class extends Zft{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};const rmt=new imt;function smt(t){const e=cs().vec3f(A.POSITION).vec3f(A.NORMAL),i=t.textureId||t.normalTextureId||t.metallicRoughnessTextureId||t.emissiveTextureId||t.occlusionTextureId;return t.hasVertexTangents&&e.vec4f(A.TANGENT),i&&e.vec2f(A.UV0),t.hasVertexColors&&e.vec4u8(A.COLOR),t.hasSymbolColors&&e.vec4u8(A.SYMBOLCOLOR),de("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(A.OBJECTANDLAYERIDCOLOR),e}const nmt=M(),omt=M(),amt=Xe(0,0,1),uue=M(),fB=M(),mB=M(),lmt=M(),cmt=["polygon","extent"];let umt=class extends ag{constructor(e,i,r,s){super(e,i,r,s),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const a=$8(this._getSymbolSize());if(a)throw new W("graphics3dextrudesymbollayer:invalid-size",a)}const e=In(this.symbolLayer,"material","color"),i=this._getCombinedOpacityAndColor(e),r=Kl(i),s=i[3],n=s<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:r,ambient:r,opacity:s,transparent:n,cullFace:n?Or.None:Or.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new e0(o),this._bottomMaterial=new e0({...o,cullFace:Or.Back}),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,cmt,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(i,new cf);return this._createAs3DShape(i,e.renderingInfo,r,s,i.uid)}layerOpacityChanged(e,i){const r=In(this.symbolLayer,"material","color"),s=this._getCombinedOpacity(r),n=s<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:s,transparent:n}),this._bottomMaterial.setParameters({opacity:s,transparent:n});const o=this._getLayerOpacity();e.forEach(a=>{const l=i(a);v(l)&&l.layerOpacityChanged(o,this._context.isAsync)})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,c1)}slicePlaneEnabledChanged(e,i){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach(r=>{const s=i(r);v(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_getExtrusionSize(e){let i;return i=e.size&&this._drivenProperties.size?Gdt(e.size,2)??0:this._getSymbolSize(),i/=this._context.renderCoordsHelper.unitInMeters,i}applyRendererDiff(e,i){return this._drivenPropertiesChanged(i)?$n.Recreate_Symbol:$n.Recreate_Graphics}async queryForSnapping(e,i,r,s){const n=this._getExtrusionSize(r)*this._context.renderCoordsHelper.unitInMeters/wx(i),{objectId:o,target:a}=e,l=ae(a);switch(l.z=(l.z??0)+n,e.type){case"edge":{const{start:c,end:h}=e,p=ae(c),f=ae(h);return p.z=(p.z??0)+n,f.z=(f.z??0)+n,[Pce(o,l,1/0,p,f)]}case"vertex":return[kdt(o,l,1/0),Pce(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,i,r,s,n){const o=EP(e.geometry);if(C(o))return null;if(o.rings.length===0||!o.rings.some(te=>te.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=Iee(o,this._context.elevationProvider,this._context.renderCoordsHelper,s);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=lee(o);if(C(l))return null;const c=new Array,h=Nn(),p=We(),f=M(),m=this._context.renderCoordsHelper.viewingMode===st.Global;m||this._context.renderCoordsHelper.worldUpAtPosition(null,f),Jp(o.spatialReference,[l.x,l.y,0],p,this._context.renderCoordsHelper.spatialReference);const y=We();Go(y,p);const _=ls();RC(_,y);const{polygons:b,mapPositions:w,position:S}=a,T=S.length/3,E=new Float64Array(3*T*6),O=new Float64Array(3*T*6),R=new Float64Array(3*T*6),L=new Float64Array(1*T*6);let P=0;for(let te=0;te<b.length;++te){const se=b[te],ie=se.count;if(this._context.clippingExtent&&($r(h),Wu(h,se.mapPositions),!Pp(h,this._context.clippingExtent)))continue;const H=u1(se.mapPositions,se.holeIndices,3);if(H.length===0)continue;const $=3*ie*2+H.length,N=new Array($),U=new Array(H.length),q=6*ie,Y=3*E.BYTES_PER_ELEMENT,Q=new Da(E.buffer,P*Y,Y,(P+q)*Y),X=3*O.BYTES_PER_ELEMENT,pe=new Da(O.buffer,P*X,X,(P+q)*X),ye=new Float64Array(R.buffer,3*P*R.BYTES_PER_ELEMENT,3*q),xe=new Float64Array(L.buffer,1*P*L.BYTES_PER_ELEMENT,1*q),De=this._getExtrusionSize(i);hmt(S,w,H,se,Q.typedBuffer,ye,pe.typedBuffer,xe,N,U,De,f,m),LI(Q,Q,y),h1(pe,pe,_),P+=6*ie;const rt=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),qe=new gmt(Q.typedBuffer,ye,pe.typedBuffer,xe);c.push(hue(this._material,N,N.length-U.length,qe,r,rt)),c.push(hue(this._bottomMaterial,U,0,qe,r,rt))}if(c.length===0)return null;const F=new v0({geometries:c,metadata:{layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0}});F.transformation=p;const V=UAe(this.symbolLayer,{opacity:this._getLayerOpacity()}),B=v(V)?{baseMaterial:this._material,edgeMaterials:[V],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,G=new og(this,F,c,null,null,fmt,s,B);return G.alignedSampledElevation=a.sampledElevation,G.needsElevationUpdates=c1(s.mode),G}};function hue(t,e,i,r,s,n){const o=new Array(e.length).fill(0),a=[[A.POSITION,new ht(r.positions,3,!0)],[A.NORMAL,new ht(r.normals,3,!0)],[A.COLOR,new ht(s,4,!0)],[A.SIZE,new ht(r.heights,1,!0)]],l=[[A.POSITION,e],[A.NORMAL,e],[A.COLOR,o]];return new fn(t,a,l,r.elevation,Vs.Mesh,n,i)}function hmt(t,e,i,r,s,n,o,a,l,c,h,p,f){const m=i.length/3;let y=0,_=2*r.count;dmt(t,e,r.index,r.count,i,0,m,s,n,o,a,l,c,_,h,p,f);let b=2*r.count;_=0,due(s,n,a,o,y,r.pathLengths[0],r.count,b,l,_,h),b+=4*r.pathLengths[0],_+=2*r.pathLengths[0],y+=r.pathLengths[0];for(let w=1;w<r.pathLengths.length;++w)due(s,n,a,o,y,r.pathLengths[w],r.count,b,l,_,h),b+=4*r.pathLengths[w],_+=2*r.pathLengths[w],y+=r.pathLengths[w]}function dmt(t,e,i,r,s,n,o,a,l,c,h,p,f,m,y,_,b){he(Il,_);const w=y>0?1:-1;let S=3*i,T=0,E=3*T,O=r,R=3*O;for(let F=0;F<r;++F)b&&(Il[0]=t[S+0],Il[1]=t[S+1],Il[2]=t[S+2],Oe(Il,Il)),a[E+0]=t[S+0],a[E+1]=t[S+1],a[E+2]=t[S+2],l[E+0]=e[S+0],l[E+1]=e[S+1],l[E+2]=e[S+2],c[E+0]=-w*Il[0],c[E+1]=-w*Il[1],c[E+2]=-w*Il[2],h[T]=0,a[R+0]=t[S+0]+y*Il[0],a[R+1]=t[S+1]+y*Il[1],a[R+2]=t[S+2]+y*Il[2],l[R+0]=e[S+0],l[R+1]=e[S+1],l[R+2]=e[S+2],c[R+0]=w*Il[0],c[R+1]=w*Il[1],c[R+2]=w*Il[2],h[O]=y,E+=3,R+=3,S+=3,T+=1,O+=1;S=3*n,E=0,R=3*m;const L=y<0?_ue:yue,P=y<0?yue:_ue;for(let F=0;F<o;++F)f[E+0]=s[S+L[0]],f[E+1]=s[S+L[1]],f[E+2]=s[S+L[2]],p[R+0]=s[S+P[0]]+r,p[R+1]=s[S+P[1]]+r,p[R+2]=s[S+P[2]]+r,E+=3,R+=3,S+=3}function WL(t,e,i,r,s,n,o){r[n]=r[o],o*=3,t[(n*=3)+0]=t[o+0],t[n+1]=t[o+1],t[n+2]=t[o+2],e[n+0]=e[o+0],e[n+1]=e[o+1],e[n+2]=e[o+2],i[n+0]=s[0],i[n+1]=s[1],i[n+2]=s[2]}const yO=M();function due(t,e,i,r,s,n,o,a,l,c,h){let p=s,f=s+1,m=s+o,y=s+o+1,_=a,b=a+1,w=a+2*n,S=a+2*n+1;h<0&&(p=s+o+1,y=s),c*=3;for(let T=0;T<n;++T)T===n-1&&(h>0?(f=s,y=s+o):(f=s,p=s+o)),pmt(t,p,f,m,yO),WL(t,e,r,i,yO,_,p),WL(t,e,r,i,yO,b,f),WL(t,e,r,i,yO,w,m),WL(t,e,r,i,yO,S,y),l[c++]=_,l[c++]=w,l[c++]=S,l[c++]=_,l[c++]=S,l[c++]=b,p++,f++,m++,y++,_+=2,b+=2,w+=2,S+=2}const gB=M(),pue=M(),fue=M(),mue=M(),gue=M();function pmt(t,e,i,r,s){e*=3,i*=3,r*=3,fe(gB,t[e++],t[e++],t[e++]),fe(pue,t[i++],t[i++],t[i++]),fe(fue,t[r++],t[r++],t[r++]),be(mue,pue,gB),be(gue,fue,gB),Et(s,gue,mue),Oe(s,s)}const QT=M();function fmt(t,e,i,r,s){const n=t.stageObject,o=n.geometries,a=o.length,l=e.mode!=="absolute-height";let c=0;const h=n.transformation,p=rA(We(),h);for(let f=0;f<a;f+=2){const m=o[f];if(!uee(m))continue;const y=m.getMutableAttribute(A.POSITION).data,_=m.vertexAttributes.get(A.SIZE).data,b=new UEe(m.mapPositions),w=y.length/3;let S=0,T=!1,E=0;for(let O=0;O<w;O++){QT[0]=y[S],QT[1]=y[S+1],QT[2]=y[S+2],r(b,XL),l&&(E+=XL.sampledElevation),Ji.TESTS_DISABLE_OPTIMIZATIONS?(fe(yc,b.array[b.offset+0],b.array[b.offset+1],XL.z+_[S/3]),v(i)&&s.toRenderCoords(yc,i,yc),ut(yc,yc,p)):(fe(yc,y[S+0],y[S+1],y[S+2]),ut(yc,yc,h),s.setAltitude(yc,XL.z+_[S/3]),ut(yc,yc,p)),y[S]=yc[0],y[S+1]=yc[1],y[S+2]=yc[2];const R=mmt/s.unitInMeters;(Math.abs(QT[0]-y[S])>=R||Math.abs(QT[1]-y[S+1])>=R||Math.abs(QT[2]-y[S+2])>=R)&&(T=!0),b.offset+=3,S+=3}T&&(m.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(o[f]),o[f+1].invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(o[f+1])),c+=E/w}return c/a}const yc=M(),Il=M(),XL=new $I,yue=[0,2,1],_ue=[0,1,2],mmt=.01;let gmt=class{constructor(e,i,r,s){this.positions=e,this.elevation=i,this.normals=r,this.heights=s}};function ymt(t,e,i,r,s){if(C(t))return null;const n=t.referencesGeometry()&&s?_mt(e,r,s):e,o=t.repurposeFeature(n);try{return t.evaluate({...i,$feature:o})}catch(a){return oe.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const yB=new Map;function _mt(t,e,i){const{transform:r,hasZ:s,hasM:n}=i;yB.has(e)||yB.set(e,vmt(e));const o=yB.get(e)(t.geometry,r,s,n);return{...t,geometry:o}}function vmt(t){const e={};switch(t){case"esriGeometryPoint":return(i,r,s,n)=>pAe(r,e,i,s,n);case"esriGeometryPolygon":return(i,r,s,n)=>fAe(r,e,i,s,n);case"esriGeometryPolyline":return(i,r,s,n)=>mAe(r,e,i,s,n);case"esriGeometryMultipoint":return(i,r,s,n)=>dAe(r,e,i,s,n);default:return oe.getLogger("esri.views.2d.support.arcadeOnDemand").error(new W("mapview-arcade",`Unable to handle geometryType: ${t}`)),i=>i}}const R6t=1.2,bmt=Am;let k8=class{constructor(e,i,r,s){this.graphics3DSymbolLayer=e,this.renderGeometries=i,this.boundingBox=r,this._drapeSourceRenderer=s,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e}setVisibility(e){if(this.stage!=null&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,ds.ADD);if(e||this._addedToStage){for(const i of this.renderGeometries)i.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Gn.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,ds.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=M()){return fe(e,0,0,0)}getBoundingBoxObjectSpace(e=Nn()){return $r(e)}addObjectState(e,i){e===Zy.Highlight&&(this.renderGeometries.forEach(r=>{const s=r.geometry.addHighlight();i.addRenderGeometry(r,s,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Gn.HIGHLIGHT))}removeObjectState(e){this.renderGeometries.forEach(i=>{e.removeRenderGeometry(i)})}removeRenderGeometryObjectState(e,i){e.geometry.removeHighlight(i),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Gn.HIGHLIGHT)}computeAttachmentOrigin(e){for(const i of this.renderGeometries)i.geometry.computeAttachmentOrigin(e2)&&(e.draped.origin[0]+=e2[0],e.draped.origin[1]+=e2[1],e.draped.num++)}async getProjectedBoundingBox(e,i,r,s,n){$r(n);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,e,vue,r),b6e(n,vue)}if(i){let o;Mp(n,e2);const a=cee(n,i.service.spatialReference,i);try{o=await i.service.queryElevation(e2[0],e2[1],s,a,"ground")}catch{}v(o)&&(n[2]=Math.min(n[2],o),n[5]=Math.max(n[5],o))}return n}_getRenderGeometryProjectedBoundingRect(e,i,r,s){if(this.boundingBox)rU(xf,this.boundingBox);else{const n=e.boundingSphere,o=n[3];xf[0]=n[0]-o,xf[1]=n[1]-o,xf[2]=n[2]-o,xf[3]=n[0]+o,xf[4]=n[1]+o,xf[5]=n[2]+o}return i(xf,0,2),this.calculateRelativeScreenBounds&&s.push({location:Mp(xf),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),IZ(xf,r)}};const vue=ci(),xf=Nn(),e2=M();let aRe=class{constructor(e,i,r,s=2048){this.text=e,this._alignment=i,this._parameters=r,this._maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._backgroundHorizontalPadding)}get displayHeight(){const e=this._lineSpacing*(this._lines.length-1),i=this._lineHeight;return Math.ceil(e+i+2*this._haloSize+this._backgroundTopPadding+this._backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._baselinePosition)}get _firstLineYOffset(){return this._backgroundTopPadding+this._haloSize}get _metrics(){if(C(this._metricsCached)){const e=nX(bue,YL,YL).getContext("2d");this._setFontProperties(e,this._fontSize);let i=2*this._haloSize;const r=this._parameters.definition.font;r.style!=="italic"&&r.style!=="oblique"&&r.weight!=="bold"&&r.weight!=="bolder"||(i+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let s,n,o=0,a=0,l=0;this._lines.forEach((y,_)=>{const b=e.measureText(y),w=b.width,S=w+i;this._textWidths.push(w),this._lineWidths.push(S),o=Math.max(o,S),a=Math.max(a,b.actualBoundingBoxAscent),l=Math.max(l,b.actualBoundingBoxDescent),_===0&&(s=b),_===this._lines.length-1&&(n=b)});const c=e.font;let h=xue.get(c);if(!h){const y=e.measureText(xmt);h=new Smt(y.actualBoundingBoxAscent,y.actualBoundingBoxDescent),xue.set(c,h)}a=Math.max(a,h.actualBoundingBoxAscent),l=Math.max(l,h.actualBoundingBoxDescent);const p=a+l,f=this._hasBackground?s.actualBoundingBoxAscent:a,m=this._hasBackground?n.actualBoundingBoxDescent:l;this._metricsCached=new Tmt(a-f,l-m,p,o,a)}return this._metricsCached}get _lineSpacing(){return(this._lineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _lineHeight(){return this._metrics.lineHeight}get _linePadding(){return this._lineHeight*wmt}get _baselinePosition(){return this._metrics.baselinePosition}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _backgroundHorizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _backgroundVerticalPadding(){return this._hasBackground?this._parameters.definition.background.padding[1]:0}get _backgroundTopPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingTop)}get _backgroundBottomPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingBottom)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(C(this._renderPixelRatio)){const e=this._parameters.definition.pixelRatio;this._maxSize>0?this._renderPixelRatio=Math.min(e,Math.min(this._maxSize/this.displayWidth,this._maxSize/this.displayHeight)):this._renderPixelRatio=e}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case Bv.Left:return this._backgroundHorizontalPadding;case Bv.Center:return(this.displayWidth-this._lineWidths[e])/2;case Bv.Right:return this.displayWidth-this._backgroundHorizontalPadding-this._lineWidths[e]}}render(e,i=0,r=0){e.save();const s=i/=this.renderPixelRatio,n=r/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset;i+=o,r+=a+this._baselinePosition;const l=this._haloSize>0;l&&this._renderHalo(e,s,n,o,a),this._setFontProperties(e,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const h=this._lines[c],p=this._getLineXOffset(c);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,h,i+p,r),this._renderLineDecoration(e,i+p,r,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,h,i+this._getLineXOffset(c),r),this._renderLineDecoration(e,i+p,r,this._textWidths[c]),r+=this._lineSpacing}if(Ji.TEXT_SHOW_BASELINE){e.strokeStyle=wue,e.setLineDash([2,2]),e.lineWidth=1;let c=n+a;for(let h=0;h<this._lines.length;++h){const p=c+this._baselinePosition;this._drawLine(e,[s,p],[s+this.displayWidth,p]),c+=this._lineSpacing}}if(Ji.TEXT_SHOW_BORDER&&(e.strokeStyle=wue,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[s,n],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,s,n,c),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,i,r,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":r+=2*a;break;case"line-through":r-=.33*this._baselinePosition}const l=n?this._haloSize:0;e.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(a+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(i-l),this._toRenderUnit(r)),e.lineTo(this._toRenderUnit(i+s+l),this._toRenderUnit(r)),e.stroke()}_roundedRect(e,i,r,s){i=this._toRenderUnit(i),r=this._toRenderUnit(r);const n=this.renderedWidth,o=this.renderedHeight;s!==0?(s=we(s,0,Math.floor(o/2)),e.beginPath(),e.moveTo(i,r+s),e.arcTo(i,r,i+s,r,s),e.lineTo(i+n-s,r),e.arcTo(i+n,r,i+n,r+s,s),e.lineTo(i+n,r+o-s),e.arcTo(i+n,r+o,i+n-s,r+o,s),e.lineTo(i+s,r+o),e.arcTo(i,r+o,i,r+o-s,s),e.closePath()):e.rect(i,r,n,o)}_renderHalo(e,i,r,s,n){const o=this.renderedWidth,a=this.renderedHeight,l=nX(bue,Math.max(o,YL),Math.max(a,YL)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const h=this._renderedHaloSize<3;c.lineJoin=h?"miter":"round",h?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let p=n+this._baselinePosition;for(let f=0;f<this._lines.length;++f){const m=this._getLineXOffset(f);this._renderLineDecoration(c,s+m,p,this._textWidths[f],!0),p+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,o,a,this._toRenderUnit(i),this._toRenderUnit(r),o,a),e.globalAlpha=1}_renderHaloEmulated(e,i,r){r+=this._baselinePosition;for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s);for(const[a,l]of lRe)this._fillText(e,n,i+o+this._haloSize*a,r+this._haloSize*l);r+=this._lineSpacing}}_renderHaloNative(e,i,r){const s=2*this._haloSize;r+=this._baselinePosition;for(let n=0;n<this._lines.length;++n){const o=this._lines[n],a=this._getLineXOffset(n),l=5,c=.1;for(let h=0;h<l;h++){const p=1-(l-1)*c+h*c;e.lineWidth=this._toRenderUnit(p*s),this._strokeText(e,o,i+a,r)}r+=this._lineSpacing}}_setFontProperties(e,i){e.font=this._parameters.fontString(i),e.textAlign="left",e.textBaseline="alphabetic"}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,i,r,s){e.fillText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_strokeText(e,i,r,s){e.strokeText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_drawLine(e,i,r){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.stroke()}_drawBox(e,i,r){const s=this._toRenderUnit(i[0]),n=this._toRenderUnit(i[1]),o=this._toRenderUnit(r[0]),a=this._toRenderUnit(r[1]),l=Math.floor(s)+.5,c=Math.ceil(s+o)-.5,h=Math.floor(n)+.5,p=Math.ceil(n+a)-.5;e.beginPath(),e.moveTo(l,h),e.lineTo(c,h),e.lineTo(c,p),e.lineTo(l,p),e.lineTo(l,h),e.stroke()}};const lRe=[];for(let e=0;e<360;e+=360/16)lRe.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var Bv;function nX(t,e,i){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=i,t.canvas}(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})(Bv||(Bv={}));const bue={canvas:null},wmt=.2,YL=512,wue="rgb(255, 0, 255, 0.5)",xmt=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})();let Tmt=class{constructor(e,i,r,s,n){this.paddingTop=e,this.paddingBottom=i,this.lineHeight=r,this.displayWidth=s,this.baselinePosition=n}},Smt=class{constructor(e,i){this.actualBoundingBoxAscent=e,this.actualBoundingBoxDescent=i}};const xue=new Map,Emt=Object.freeze({left:0,center:.5,right:1}),RF=Object.freeze({"bottom-left":Ni(0,0),bottom:Ni(.5,0),"bottom-right":Ni(1,0),left:Ni(0,.5),center:Ni(.5,.5),right:Ni(1,.5),"top-left":Ni(0,1),top:Ni(.5,1),"top-right":Ni(1,1)});function cRe(t){switch(t){case"left":return Bv.Left;case"right":return Bv.Right;default:return Bv.Center}}function Tue(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function Cmt(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function Amt(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function Omt(t){return t==="middle"?"center":t}var Sa,Sue;function _O(t){return t!=null}function t2(t){return typeof t=="number"}function B8(t){return typeof t=="string"}function Rmt(t){return t==null||B8(t)}function Mn(t,e){t&&t.push(e)}function Mmt(t,e,i,r=We()){const s=t||0,n=e||0,o=i||0;return s!==0&&cC(r,r,-s/180*Math.PI),n!==0&&lC(r,r,n/180*Math.PI),o!==0&&mU(r,r,o/180*Math.PI),r}function W0(t,e,i,r,s){const n=t.minSize,o=t.maxSize;if(t.expression)return Mn(s,"Could not convert size info: expression not supported"),!1;if(t.useSymbolValue){const a=r.symbolSize[i];return e.minSize[i]=a,e.maxSize[i]=a,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=Sa.DefinedSize,!0}if(_O(t.field))return _O(t.stops)?t.stops.length===2&&t2(t.stops[0].size)&&t2(t.stops[1].size)?(Eue(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,i),e.type[i]=Sa.DefinedSize,!0):(Mn(s,"Could not convert size info: stops only supported with 2 elements"),!1):t2(n)&&t2(o)&&_O(t.minDataValue)&&_O(t.maxDataValue)?(Eue(n,o,t.minDataValue,t.maxDataValue,e,i),e.type[i]=Sa.DefinedSize,!0):_C[t.valueUnit]!=null?(e.minSize[i]=-1/0,e.maxSize[i]=1/0,e.offset[i]=0,e.factor[i]=1/_C[t.valueUnit],e.type[i]=Sa.DefinedSize,!0):t.valueUnit==="unknown"?(Mn(s,"Could not convert size info: proportional size not supported"),!1):(Mn(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!_O(t.field)){if(t.stops&&t.stops[0]&&t2(t.stops[0].size))return e.minSize[i]=t.stops[0].size,e.maxSize[i]=t.stops[0].size,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=Sa.DefinedSize,!0;if(t2(n))return e.minSize[i]=n,e.maxSize[i]=n,e.offset[i]=n,e.factor[i]=0,e.type[i]=Sa.DefinedSize,!0}return Mn(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function Eue(t,e,i,r,s,n){const o=Math.abs(r-i)>0?(e-t)/(r-i):0;s.minSize[n]=o>0?t:e,s.maxSize[n]=o>0?e:t,s.offset[n]=t-i*o,s.factor[n]=o}function Pmt(t,e,i,r){if(t.normalizationField||t.valueRepresentation)return Mn(r,"Could not convert size info: unsupported property"),null;if(!Rmt(t.field))return Mn(r,"Could not convert size info: field is not a string"),null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return Mn(r,"Could not convert size info: multiple fields in use"),null}else e.size.field=t.field}else e.size={field:t.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[Sa.Undefined,Sa.Undefined,Sa.Undefined]};let s;switch(t.axis){case"width":return s=W0(t,e.size,0,i,r),s?e:null;case"height":return s=W0(t,e.size,2,i,r),s?e:null;case"depth":return s=W0(t,e.size,1,i,r),s?e:null;case"width-and-depth":return s=W0(t,e.size,0,i,r),s&&W0(t,e.size,1,i,r),s?e:null;case null:case void 0:case"all":return s=W0(t,e.size,0,i,r),s=s&&W0(t,e.size,1,i,r),s=s&&W0(t,e.size,2,i,r),s?e:null;default:return Mn(r,`Could not convert size info: unknown axis "${t.axis}""`),null}}function Imt(t,e,i){for(let s=0;s<3;++s){let n=e.unitInMeters;t.type[s]===Sa.DefinedSize&&(n*=e.modelSize[s],t.type[s]=Sa.DefinedScale),t.minSize[s]=t.minSize[s]/n,t.maxSize[s]=t.maxSize[s]/n,t.offset[s]=t.offset[s]/n,t.factor[s]=t.factor[s]/n}let r;if(t.type[0]!==Sa.Undefined)r=0;else if(t.type[1]!==Sa.Undefined)r=1;else{if(t.type[2]===Sa.Undefined)return Mn(i,"No size axis contains a valid size or scale"),!1;r=2}for(let s=0;s<3;++s)t.type[s]===Sa.Undefined&&(t.minSize[s]=t.minSize[r],t.maxSize[s]=t.maxSize[r],t.offset[s]=t.offset[r],t.factor[s]=t.factor[r],t.type[s]=t.type[r]);return!0}function Cue(t,e,i){t[4*e+0]=i.r/255,t[4*e+1]=i.g/255,t[4*e+2]=i.b/255,t[4*e+3]=i.a}function $mt(t,e,i){if(t.normalizationField)return Mn(i,"Could not convert color info: unsupported property"),null;if(B8(t.field)){if(!t.stops)return Mn(i,"Could not convert color info: missing stops or colors"),null;{if(t.stops.length>8)return Mn(i,"Could not convert color info: too many color stops"),null;e.color={field:t.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};const r=t.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];e.color.values[s]=n.value,Cue(e.color.colors,s,n.color)}}}else{if(!(t.stops&&t.stops.length>=0))return Mn(i,"Could not convert color info: no field and no colors/stops"),null;{const r=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.color.values[s]=1/0,Cue(e.color.colors,s,r)}}return e}function Lmt(t,e,i){if(t.normalizationField)return Mn(i,"Could not convert opacity info: unsupported property"),null;if(B8(t.field)){if(!t.stops)return Mn(i,"Could not convert opacity info: missing stops or opacities"),null;{if(t.stops.length>8)return Mn(i,"Could not convert opacity info: too many opacity stops"),null;e.opacity={field:t.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};const r=t.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];e.opacity.values[s]=n.value,e.opacity.opacityValues[s]=n.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return Mn(i,"Could not convert opacity info: no field and no opacities/stops"),null;{const r=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.opacity.values[s]=1/0,e.opacity.opacityValues[s]=r}}return e}function _B(t,e,i){const r=i===2&&t.rotationType==="arithmetic";e.offset[i]=r?90:0,e.factor[i]=r?-1:1,e.type[i]=1}function Dmt(t,e,i){if(!B8(t.field))return Mn(i,"Could not convert rotation info: field is not a string"),null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return Mn(i,"Could not convert rotation info: multiple fields in use"),null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return _B(t,e.rotation,0),e;case"roll":return _B(t,e.rotation,1),e;case null:case void 0:case"heading":return _B(t,e.rotation,2),e;default:return Mn(i,`Could not convert rotation info: unknown axis "${t.axis}""`),null}}function uRe(t,e,i){if(!t)return null;const r=!e.supportedTypes||!!e.supportedTypes.size,s=!e.supportedTypes||!!e.supportedTypes.color,n=!e.supportedTypes||!!e.supportedTypes.rotation,o=!!e.supportedTypes&&!!e.supportedTypes.opacity,a=t.reduce((l,c)=>{if(!l)return l;if(c.valueExpression)return Mn(i,"Could not convert visual variables: arcade expressions not supported"),null;switch(c.type){case"size":return r?Pmt(c,l,e,i):l;case"color":return s?$mt(c,l,i):l;case"opacity":return o?Lmt(c,l,i):null;case"rotation":return n?Dmt(c,l,i):l;default:return null}},{size:null,color:null,opacity:null,rotation:null});return!(t.length>0&&a)||a.size||a.color||a.opacity||a.rotation?a&&a.size&&!Imt(a.size,e,i)?null:a:null}function Dee(t){return t&&t.size!=null}function RP(t,e){if(!t)return{enabled:!1};if(Ji.TESTS_DISABLE_FAST_UPDATES)return{enabled:!1};const i=uRe(t.visualVariables,e);return i?{enabled:!0,visualVariables:i,materialParameters:hRe(i,e),requiresShaderTransformation:Dee(i)}:{enabled:!1}}function MP(t,e,i){if(!e||!t.enabled)return!1;const r=t.visualVariables,s=uRe(e.visualVariables,i);return!!s&&!!(ZL(r.size,s.size,"size")&&ZL(r.color,s.color,"color")&&ZL(r.rotation,s.rotation,"rotation")&&ZL(r.opacity,s.opacity,"opacity"))&&(t.visualVariables=s,t.materialParameters=hRe(s,i),t.requiresShaderTransformation=Dee(s),!0)}function ZL(t,e,i){if(!!t!=!!e||t&&t.field!==e.field)return!1;if(t&&i==="rotation"){const r=t,s=e;for(let n=0;n<3;n++)if(r.type[n]!==s.type[n]||r.offset[n]!==s.offset[n]||r.factor[n]!==s.factor[n])return!1}return!0}function hRe(t,e){const i={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},r=Dee(t);return t&&t.size?(i.vvSizeEnabled=!0,i.vvSizeMinSize=t.size.minSize,i.vvSizeMaxSize=t.size.maxSize,i.vvSizeOffset=t.size.offset,i.vvSizeFactor=t.size.factor):t&&r&&(i.vvSizeValue=e.transformation.scale),t&&r&&(i.vvSymbolAnchor=e.transformation.anchor,i.vvSymbolRotationMatrix=ls(),_d(u3),Mmt(e.transformation.rotation[2],e.transformation.rotation[0],e.transformation.rotation[1],u3),bd(i.vvSymbolRotationMatrix,u3)),t&&t.color&&(i.vvColorEnabled=!0,i.vvColorValues=t.color.values,i.vvColorColors=t.color.colors),t&&t.opacity&&(i.vvOpacityEnabled=!0,i.vvOpacityValues=t.opacity.values,i.vvOpacityOpacities=t.opacity.opacityValues),i}function oX(t,e,i){if(!t.vvSizeEnabled)return i;Xn(X0,i);const r=t.vvSymbolRotationMatrix;eg(u3,r[0],r[1],r[2],0,r[3],r[4],r[5],0,r[6],r[7],r[8],0,0,0,0,1),Ts(X0,X0,u3);for(let s=0;s<3;++s){const n=t.vvSizeOffset[s]+e[0]*t.vvSizeFactor[s];Aue[s]=we(n,t.vvSizeMinSize[s],t.vvSizeMaxSize[s])}return fU(X0,X0,Aue),hc(X0,X0,t.vvSymbolAnchor),X0}function Nmt(t,e,i){if(!e.vvSizeEnabled)return fe(t,1,1,1);for(let r=0;r<3;++r){const s=e.vvSizeOffset[r]+i[0]*e.vvSizeFactor[r];t[r]=we(s,e.vvSizeMinSize[r],e.vvSizeMaxSize[r])}return t}(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(Sa||(Sa={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(Sue||(Sue={}));const X0=We(),Aue=M(),u3=We();let VC=class{constructor(e,i={}){this.geometry=e,this.boundingSphere=fi(),this.screenToWorldRatio=1,this._transformation=We(),this._shaderTransformationDirty=!0,this.id=Zc(),this.layerUid=i.layerUid,this.graphicUid=i.graphicUid,this.boundingInfo=i.boundingInfo,this.shaderTransformer=i.shaderTransformer,this.castShadow=!!i.castShadow&&i.castShadow}get transformation(){return this._transformation}updateTransformation(e){e(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(e,i,r=Lx(e)){C(this.boundingInfo)||(ut(i,this.boundingInfo.center,e),i[3]=this.boundingInfo.radius*r)}get hasShaderTransformation(){return v(this.shaderTransformer)}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return C(this.shaderTransformer)?this.transformation:(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=We()),Xn(this._shaderTransformation,this.shaderTransformer(this.transformation)),this._shaderTransformationDirty=!1),this._shaderTransformation)}get indices(){return this.geometry.indices}get vertexAttributes(){return this.geometry.vertexAttributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}};const Fmt=We(),Oue=Xe(0,0,1),Umt=16,Vmt=1.5,Kw=nee,kmt=[Kw/2,Kw/2,1-Kw/2,1-Kw/2],Bmt=[vP*Kw,vP*Kw];let aX=class dRe extends ag{getCachedSize(){return{size:this._getIconSize()}}constructor(e,i,r,s){super(e,i,r,s),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(e){this._validateOrThrow();const i=this._prepareMaterialParameters(),r=this._getPrimitive();if(v(r))this._prepareResourcesPrimitive(i,r);else{const s=zGe(this.symbolLayer),n=tI(s);n&&n.mediaType==="application/json"?await this._prepareResourcesCIM(i,JSON.parse(n.data),e):await this._prepareResourcesHref(i,s,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=$8(this._getIconSize());if(e)throw new W("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,i=Math.round(e.size!=null?ko(e.size):Umt);return this._drivenProperties.size?Math.max(i,64):i}_generateTextureCIM(e){const i=this._getGraphicHash(e);let r=i===""?null:this._cimSymbolTextures.get(i);if(!r){const s={scaleFactor:this._cimScaleFactorOrFunction},n=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,e,"esriGeometryPoint",s,void 0,void 0);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",n.anchorPosition);const o={width:n.imageData.width,height:n.imageData.height,powerOfTwoResizeMode:Fv.PAD};r=new _T(n.imageData,o),this._cimSymbolTextures.set(i,r),this._context.stage.add(r)}return r}_computeSize(e,i){const r=e.width/e.height;return r>1?[i,Math.round(i/r)]:[Math.round(i*r),i]}_prepareMaterialParameters(){const e={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},i=this.symbol;if(zmt(i)){const{screenLength:r,minWorldLength:s,maxWorldLength:n}=i.verticalOffset;e.verticalOffset={screenLength:ko(r),minWorldLength:s||0,maxWorldLength:v(n)?n:1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,i){const r=this._getOutlineSize();if(vB(i)&&r===0)throw new Error("Nothing to render");if(this._outlineSize=r,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,v(this._context.sharedResources.textures)){const n=this._context.sharedResources.textures.fromData(`${i}-icon`,()=>jCe(i));this._texture=n.texture,this._releaseTexture=n,e.textureId=this._texture.id}e.textureIsSignedDistanceField=!0,e.distanceFieldBoundingBox=kmt;const s=this._getIconSize();this._size=[s,s],this._symbolTextureRatio=1/Kw,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,i,r){this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const s=this._getIconSize(),n=s*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(v(this._context.sharedResources.textures)){const o=await Kp(this._context.sharedResources.textures.fromUrl(i,n,{signal:r}));if(o.ok===!1)throw zc(o.error),new W("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${i})`);this._releaseTexture=o.value;const a=o.value.texture,l=a.params;this._size=this._computeSize(l,s),e.textureId=a.id}this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,i,r){const s=new JC({data:i});if(!this._context.sharedResources.cimSymbolRasterizer){const h=(await ee(()=>import("./CIMSymbolRasterizer-ec41ae53.js"),["./CIMSymbolRasterizer-ec41ae53.js","./cimAnalyzer-02b73f26.js","./BidiEngine-836b7ef6.js","./GeometryUtils-53652037.js","./enums-4b2a86a0.js","./alignmentUtils-ae955d28.js","./definitions-19bfb61c.js","./number-b10bd8f5.js","./Rect-ea14f53a.js","./CIMResourceManager-95d877f0.js","./Rasterizer-2a7f140e.js","./_commonjsHelpers-2f3e7994.js","./rasterizingUtils-ea810fad.js","./imageutils-96926fa1.js"],import.meta.url)).CIMSymbolRasterizer;gi(r),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new h(this._context.renderCoordsHelper.spatialReference,!0))}const n=this._context.layer.fields?this._context.layer.fields.map(h=>h.toJSON()):null;let o,a;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(s,n,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:r}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const h=this._context.renderer;if(isNaN(h.scaleExpression)){const p=h.scaleExpression,f=await n5e(p,this._context.layer.spatialReference,n);a=(m,y,_)=>{const b=ymt(f,m,{$view:_},"esriGeometryPoint",y);return b!==null?b:1}}else o=Number(h.scaleExpression)}this._cimScaleFactorOrFunction=o||a||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];gi(r);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(h=>c.get(h).name),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||yUe}_getOutlineSize(){let e=0;const i=this.symbolLayer;return v(i.outline)&&i.outline.size!=null?Math.max(ko(i.outline.size),0):(e=vB(this._getPrimitive())?Vmt:0,Math.max(e,0))}_getOutlineColor(){const e=this._getLayerOpacity(),i=this.symbolLayer,r=In(i,"outline","color");if(v(r)){const s=ot.toUnitRGB(r),n=r.a*e;return[s[0],s[1],s[2],n]}return[0,0,0,0]}_getFillColor(){if(vB(this._getPrimitive()))return bmt;const e=C(this._getPrimitive()),i=In(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(i,{hasIntrinsicColor:e})}_getAnchorPos(e,i){return e==="relative"?Ni((i.x||0)+.5,.5-(i.y||0)):e in RF?RF[e]:RF.center}_createMaterialAndAddToStage(e,i){if(this._cimLayers?this._fastUpdates={enabled:!1}:this._fastUpdates=RP(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&Object.assign(e,this._fastUpdates.materialParameters),this._cimLayers){let r=v(e.textureId)?this._cimSymbolMaterials.get(e.textureId):null;return r||(r=new FC(e),this._cimSymbolMaterials.set(Gt(e.textureId,0),r),i.add(r)),r}return this._material=new FC(e),i.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(e=>this._context.stage.remove(e)),this._cimSymbolTextures.clear(),this._releaseTexture=Wr(this._releaseTexture)}_getScaleFactor(e,i){if(this._drivenProperties.size&&e.size){for(let r=0;r<3;r++){const s=e.size[r];s&&s!=="symbol-value"&&s!=="proportional"&&(e.size[r]=ko(s))}if(e.size[0]==="symbol-value")return 1;if(isFinite(+e.size[0]))return+e.size[0]/i;if(isFinite(+e.size[2]))return+e.size[2]/i}return 1}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry))return null;let r,s=[0,0];if(this._cimLayers){if(!this._cimLayers.length)return null;const p=this._generateTextureCIM(i),f={textureId:p.id,...this._cimMaterialParametersInfo};r=this._createMaterialAndAddToStage(f,this._context.stage),s=[p.params.width,p.params.height]}else s=this._size,r=this._material;const n=SP(i.geometry);if(C(n))return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const o=e.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!this._fastUpdates.enabled||!this._fastUpdates.visualVariables.size){const p=s[0]>s[1]?s[0]:s[1];l=this._getScaleFactor(o,p)}l*=this._symbolTextureRatio;const c=Ni(s[0]*l,s[1]*l),h=this.setGraphicElevationContext(i,new cf);return this.ensureDrapedStatus(h.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(i,n,r,a,c,e.layer.uid):this._createAs3DShape(i,n,r,a,c,h,i.uid)}layerOpacityChanged(){const e=this._getFillColor(),i=this._getOutlineColor();this._forEachMaterial(r=>{r.setParameters({color:e}),r.setParameters({outlineColor:i})})}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=II(dRe.elevationModeChangeTypes,r,s);if(n!==Ss.UPDATE)return n;const o=Sd(s)||s==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!!this._getPrimitive()}skipHighSymbolLodsChanged(){return!0}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables"||!MP(this._fastUpdates,i,this._fastVisualVariableConvertOptions()))return $n.Recreate_Symbol;v(this._material)&&this._material.setParameters(this._fastUpdates.materialParameters)}return $n.Fast_Update}_defaultElevationInfoNoZ(){return Gmt}_createAs3DShape(e,i,r,s,n,o,a){const l=this.getFastUpdateAttrValues(e),c=l?_=>oX(this._fastUpdates.materialParameters,l,_):void 0,h=this._context.layer.uid,p=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:h}),f=EW(r,Oue,null,s,n,jmt,null,l,p),m=gee(this._context,i,f,o,a,c);if(C(m))return null;const y=new og(this,m.object,[f],null,null,xP,o);return y.alignedSampledElevation=m.sampledElevation,y.needsElevationUpdates=Sd(o.mode)||o.mode==="absolute-height",y.getScreenSize=this._createScreenSizeGetter(n,c),y.calculateRelativeScreenBounds=_=>r.calculateRelativeScreenBounds(y.getScreenSize(),1,_),TP(y,i,this._context.elevationProvider),y}_createAsOverlay(e,i,r,s,n,o){r.renderPriority=this._renderPriority;const a=fi();da(i,a,this._context.overlaySR),a[2]=Pee;const l=this._context.clippingExtent;if(v(l)&&!PZ(l,a))return null;const c=this.getFastUpdateAttrValues(e),h=c?_=>oX(this._fastUpdates.materialParameters,c,_):void 0,p=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),f=EW(r,Oue,a,s,n,null,null,c,p),m=new VC(f,{layerUid:o,graphicUid:e.uid,shaderTransformer:h});a[3]=0,Op(m.boundingSphere,a);const y=new k8(this,[m],null,this._context.drapeSourceRenderer);return y.getScreenSize=this._createScreenSizeGetter(n,h),y.calculateRelativeScreenBounds=_=>r.calculateRelativeScreenBounds(y.getScreenSize(),1,_),y}_createScreenSizeGetter(e,i){const r=this._outlineSize+2;if(this._fastUpdates.enabled){const s=e[0]/this._symbolTextureRatio,n=e[1]/this._symbolTextureRatio;return(o=et())=>{const a=i(Fmt);return o[0]=a[0]*s+r,o[1]=a[5]*n+r,o}}{const s=e[0]/this._symbolTextureRatio+r,n=e[1]/this._symbolTextureRatio+r;return(o=et())=>(o[0]=s,o[1]=n,o)}}_fastVisualVariableConvertOptions(){const e=this._size[0]>this._size[1]?this._size[0]:this._size[1],i=Xe(e,e,e),r=gd(1),s=e*r;return{modelSize:i,symbolSize:Xe(s,s,s),unitInMeters:r,transformation:{anchor:Ma,scale:_m,rotation:Ma}}}_getGraphicHash(e){let i="";for(const r of this._cimRequiredFields)i+=r+e.attributes[r];return i}_forEachMaterial(e){v(this._material)&&e(this._material),this._cimSymbolMaterials.forEach(e)}test(){return{...super.test(),material:this._material}}};function zmt(t){return t&&t.type==="point-3d"&&t.hasVisibleVerticalOffset()}function vB(t){return!C(t)&&(t==="cross"||t==="x")}aX.PRIMITIVE_SIZE=Bmt,aX.elevationModeChangeTypes={definedChanged:Ss.UPDATE,staysOnTheGround:Ss.NONE,onTheGroundChanged:Ss.RECREATE};const Gmt={mode:"relative-to-ground",offset:0},jmt=si(0,0,0,1);function lX(t){switch(t){case"butt":return ud.BUTT;case"square":return ud.SQUARE;case"round":return ud.ROUND;default:return null}}function Hmt(t){return t==="diamond"?"kite":t}function cX(t,e,i=null){const r=[],s=[],n=e.mapPositions;qmt(e,s,r);const o=s[0][1].data,a=r[0][1].length,l=new Array(a).fill(0);return Wmt(e,s,r,l),Zmt(e,s,r,l),Xmt(e,s,r,l),Ymt(e,s,r,l),Jmt(e,s,r,l),Kmt(e,s,r,l),Qmt(e,s,r,o),new fn(t,s,r,n,Vs.Line,i)}function qmt(t,e,i){const{attributeData:{position:r},removeDuplicateStartEnd:s}=t,n=egt(r)&&s,o=r.length/3-(n?1:0),a=new Array(2*(o-1)),l=n?r.slice(0,r.length-3):r;let c=0;for(let h=0;h<o-1;h++)a[c++]=h,a[c++]=h+1;e.push([A.POSITION,new ht(l,3,n)]),i.push([A.POSITION,a])}function Wmt(t,e,i,r){if(v(t.attributeData.colorFeature))return;const s=t.attributeData.color;e.push([A.COLOR,new ht(Gt(s,ed),4)]),i.push([A.COLOR,r])}function Xmt(t,e,i,r){if(!v(t.attributeData.normal))return;const s=t.attributeData.normal;e.push([A.NORMAL,new ht(s,3)]),i.push([A.NORMAL,r])}function Ymt(t,e,i,r){const s=t.attributeData.colorFeature;C(s)||(e.push([A.COLORFEATUREATTRIBUTE,new ht([s],1,!0)]),i.push([A.COLOR,r]))}function Zmt(t,e,i,r){if(v(t.attributeData.sizeFeature))return;const s=t.attributeData.size;e.push([A.SIZE,new ht([Gt(s,1)],1,!0)]),i.push([A.SIZE,r])}function Jmt(t,e,i,r){const s=t.attributeData.sizeFeature;C(s)||(e.push([A.SIZEFEATUREATTRIBUTE,new ht([s],1,!0)]),i.push([A.SIZEFEATUREATTRIBUTE,r]))}function Kmt(t,e,i,r){const s=t.attributeData.opacityFeature;C(s)||(e.push([A.OPACITYFEATUREATTRIBUTE,new ht([s],1,!0)]),i.push([A.OPACITYFEATUREATTRIBUTE,r]))}function Qmt(t,e,i,r){if(C(t.overlayInfo)||t.overlayInfo.renderCoordsHelper.viewingMode!==st.Global||!t.overlayInfo.spatialReference.isGeographic)return;const s=ru(r.length),n=tr(t.overlayInfo.spatialReference);for(let f=0;f<s.length;f+=3)iJ(r,f,s,f,n);const o=r.length/3,a=Qs(o+1);let l=tgt,c=igt,h=0,p=0;fe(l,s[p++],s[p++],s[p++]),a[0]=0;for(let f=1;f<o+1;++f)f===o&&(p=0),fe(c,s[p++],s[p++],s[p++]),h+=u2e(l,c),a[f]=h,[l,c]=[c,l];e.push([A.DISTANCETOSTART,new ht(a,1,!0)]),i.push([A.DISTANCETOSTART,i[0][1]])}function egt(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const tgt=M(),igt=M();function D6t(t,e){if(C(t)||t.length===0)return[];const i=[];return t.forEach(r=>{const s=r.length,n=ru(3*s);r.forEach((a,l)=>{n[3*l+0]=a[0],n[3*l+1]=a[1],n[3*l+2]=a[2]});const o={attributeData:{position:n,normal:e},removeDuplicateStartEnd:!1};i.push(o)}),i}function rgt(t,e,i,r){const s=t.type==="polygon"?Xm.CCW_IS_HOLE:Xm.NONE,n=t.type==="polygon"?t.rings:t.paths,{position:o,outlines:a}=DI(n,!!t.hasZ,s),l=ru(o.length),c=SAe(o,t.spatialReference,0,l,0,o,0,o.length/3,e,i,r),h=c!=null;return{lines:h?pRe(a,o,l):[],projectionSuccess:h,sampledElevation:c}}function sgt(t,e){const i=t.type==="polygon"?Xm.CCW_IS_HOLE:Xm.NONE,r=t.type==="polygon"?t.rings:t.paths,{position:s,outlines:n}=DI(r,!1,i),o=Es(s,t.spatialReference,0,s,e,0,s.length/3);for(let a=2;a<s.length;a+=3)s[a]=Pee;return{lines:o?pRe(n,s):[],projectionSuccess:o}}function pRe(t,e,i=null){const r=new Array;for(const{index:s,count:n}of t){if(n<=1)continue;const o=3*s,a=3*n;r.push({position:ld(e,3*s,3*n),mapPositions:v(i)?ld(i,o,a):void 0})}return r}function ngt(t){const e=new Ui,i=t.hasMultipassTerrain&&(t.output===k.Color||t.output===k.Alpha),r=t.space===cd.World;t.hasTip&&r&&e.extensions.add("GL_OES_standard_derivatives"),e.include(nOe,t),e.include(dOe,t),t.output===k.Depth&&e.include(Qy,t);const{vertex:s,fragment:n}=e;return n.include(ou),Kc(s,t),e.attributes.add(A.POSITION,"vec3"),e.attributes.add(A.UV0,"vec2"),e.attributes.add(A.AUXPOS1,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vUV","vec2"),e.varyings.add("vSize","float"),s1(e),i&&e.varyings.add("depth","float"),t.hasTip&&e.varyings.add("vLineWidth","float"),s.uniforms.add([new zi("nearFar",(o,a)=>a.camera.nearFar),new Si("viewport",(o,a)=>a.camera.fullViewport)]),s.code.add(x`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),s.code.add(x`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),r?(e.attributes.add(A.NORMAL,"vec3"),DC(s),s.constants.add("tiltThreshold","float",.7),s.code.add(x`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):s.code.add(x`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),s.code.add(x`
      #define vecN ${r?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${r?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${t.anchor===Zx.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),t.space===cd.Screen&&(s.uniforms.add(new Jr("inverseProjectionMatrix",(o,a)=>a.camera.inverseProjectionMatrix)),s.code.add(x`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),s.code.add(x`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),s.uniforms.add(new He("perScreenPixelRatio",(o,a)=>a.camera.perScreenPixelRatio)),s.code.add(x`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${t.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += perpendicular(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),s.uniforms.add(new He("pixelRatio",(o,a)=>a.camera.pixelRatio)),n8(e),s.code.add(x`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
clip(pos, prev);`),r?(t.hideOnShortSegments&&s.code.add(x`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),s.code.add(x`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(s.code.add(x`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),t.space===cd.Screen&&s.code.add(x`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),s.code.add(x`
        ${i?"depth = pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${r?"":"vUV *= displacedPosScreen.w;"}

        ${t.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),i&&e.include(sh,t),e.include(en,t),n.uniforms.add([new Si("intrinsicColor",o=>o.color),new zt("tex",o=>o.texture)]),n.include(sg),e.constants.add("texelSize","float",1/CP),n.code.add(x`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture2D(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),t.hasTip&&(e.constants.add("relativeMarkerSize","float",wee/CP),e.constants.add("relativeTipLineWidth","float",bpt),n.code.add(x`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${r?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),e.constants.add("symbolAlphaCutoff","float",la),n.code.add(x`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${r?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${t.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${t.output===k.ObjectAndLayerIdColor?x`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${t.output===k.Alpha?x`gl_FragColor = vec4(finalColor.a);`:""}
    ${t.output===k.Color?x`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===k.Color&&t.transparencyPassType===$t.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${t.output===k.Highlight?x`gl_FragColor = vec4(1.0);`:""}
    ${t.output===k.Depth?x`outputDepth(linearDepth);`:""}
  }
  `),e}const ogt=Object.freeze(Object.defineProperty({__proto__:null,build:ngt},Symbol.toStringTag,{value:"Module"})),fRe=new Map([[A.POSITION,0],[A.UV0,2],[A.AUXPOS1,3],[A.NORMAL,4],[A.COLOR,5],[A.COLORFEATUREATTRIBUTE,5],[A.SIZE,6],[A.SIZEFEATUREATTRIBUTE,6],[A.OPACITYFEATUREATTRIBUTE,7]]);let mRe=class gRe extends ji{initializeProgram(e){return new ki(e.rctx,gRe.shader.get().build(this.configuration),fRe)}_makePipelineState(e,i){const r=this.configuration,s=e===$t.NONE;return Qt({blending:r.output===k.Color||r.output===k.Alpha?s?Qu:y0(e):null,depthTest:{func:T1(e)},depthWrite:s?r.writeDepth?pc:null:R8(e),colorWrite:ui,stencilWrite:r.hasOccludees?Ym:null,stencilTest:r.hasOccludees?i?d1:S1:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Qt({blending:Qu,depthTest:K5,depthWrite:null,colorWrite:ui,stencilWrite:null,stencilTest:mOe}),this._occluderPipelineOpaque=Qt({blending:Qu,depthTest:K5,depthWrite:null,colorWrite:ui,stencilWrite:pOe,stencilTest:fOe}),this._occluderPipelineMaskWrite=Qt({blending:null,depthTest:xee,depthWrite:null,colorWrite:null,stencilWrite:Ym,stencilTest:d1})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,i){return i?this._occludeePipelineState:this.configuration.occluder?e===Fe.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===Fe.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,i)}};mRe.shader=new Vi(ogt,()=>ee(()=>import("./LineMarker.glsl-20a4c01d.js"),[],import.meta.url));let agt=class extends x1{constructor(e){super(e,new cgt),this._vertexAttributeLocations=fRe,this._configuration=new Io,this._layout=this.createLayout()}dispose(){}getConfiguration(e,i){return this._configuration.output=e,this._configuration.space=i.slot===Fe.DRAPED_MATERIAL?cd.Draped:this.parameters.worldSpace?cd.World:cd.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==ud.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.occluder=this.parameters.renderOccluded===ps.OccludeAndTransparentStencil,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const e=cs().vec3f(A.POSITION).vec2f(A.UV0).vec3f(A.AUXPOS1);return this.parameters.worldSpace&&e.vec3f(A.NORMAL),this.parameters.vvSizeEnabled?e.f32(A.SIZEFEATUREATTRIBUTE):e.f32(A.SIZE),this.parameters.vvColorEnabled?e.f32(A.COLORFEATUREATTRIBUTE):e.vec4f(A.COLOR),this.parameters.vvOpacityEnabled&&e.f32(A.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new ugt(this._layout,this.parameters)}requiresSlot(e,i){return i===k.Color||i===k.Alpha||i===k.Highlight||i===k.Depth?e===Fe.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===ps.OccludeAndTransparentStencil?e===Fe.OPAQUE_MATERIAL||e===Fe.OCCLUDER_MATERIAL||e===Fe.TRANSPARENT_OCCLUDER_MATERIAL:i===k.Color||i===k.Alpha?e===(this.parameters.writeDepth?Fe.TRANSPARENT_MATERIAL:Fe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===Fe.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new lgt(e)}},lgt=class extends qK{_updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(mRe,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==k.Color&&this._output!==k.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},cgt=class extends oee{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.placement="end",this.cap=ud.BUTT,this.anchor=Zx.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1}},ugt=class{constructor(e,i){this.vertexBufferLayout=e,this._parameters=i}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(e,i,r,s,n){const o=r.vertexAttributes.get(A.POSITION).data,a=o.length/3;let l=[1,0,0];const c=r.vertexAttributes.get(A.NORMAL);this._parameters.worldSpace&&v(c)&&(l=c.data);let h=1,p=0;this._parameters.vvSizeEnabled?p=r.vertexAttributes.get(A.SIZEFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(A.SIZE)&&(h=r.vertexAttributes.get(A.SIZE).data[0]);let f=[1,1,1,1],m=0;this._parameters.vvColorEnabled?m=r.vertexAttributes.get(A.COLORFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(A.COLOR)&&(f=r.vertexAttributes.get(A.COLOR).data);let y=0;this._parameters.vvOpacityEnabled&&(y=r.vertexAttributes.get(A.OPACITYFEATUREATTRIBUTE).data[0]);const _=new Float32Array(s.buffer);let b=n*(this.vertexBufferLayout.stride/4);const w=(O,R,L,P)=>{if(_[b++]=O[0],_[b++]=O[1],_[b++]=O[2],_[b++]=L[0],_[b++]=L[1],_[b++]=R[0],_[b++]=R[1],_[b++]=R[2],this._parameters.worldSpace&&(_[b++]=l[0],_[b++]=l[1],_[b++]=l[2]),this._parameters.vvSizeEnabled?_[b++]=p:_[b++]=h,this._parameters.vvColorEnabled)_[b++]=m;else{const F=Math.min(4*P,f.length-4);_[b++]=f[F+0],_[b++]=f[F+1],_[b++]=f[F+2],_[b++]=f[F+3]}this._parameters.vvOpacityEnabled&&(_[b++]=y)};let S;(function(O){O[O.ASCENDING=1]="ASCENDING",O[O.DESCENDING=-1]="DESCENDING"})(S||(S={}));const T=(O,R)=>{const L=fe(hgt,o[3*O],o[3*O+1],o[3*O+2]),P=dgt;let F=O+R;do fe(P,o[3*F],o[3*F+1],o[3*F+2]),F+=R;while(Wv(L,P)&&F>=0&&F<a);e&&(ut(L,L,e),ut(P,P,e)),w(L,P,[-1,-1],O),w(L,P,[1,-1],O),w(L,P,[1,1],O),w(L,P,[-1,-1],O),w(L,P,[1,1],O),w(L,P,[-1,1],O)},E=this._parameters.placement;E!=="begin"&&E!=="begin-end"||T(0,S.ASCENDING),E!=="end"&&E!=="begin-end"||T(a-1,S.DESCENDING)}};const hgt=M(),dgt=M(),_a={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},pgt={dash:_a.dash,"dash-dot":[..._a.dash,..._a.dot],dot:_a.dot,"long-dash":_a["long-dash"],"long-dash-dot":[..._a["long-dash"],..._a.dot],"long-dash-dot-dot":[..._a["long-dash"],..._a.dot,..._a.dot],none:null,"short-dash":_a["short-dash"],"short-dash-dot":[..._a["short-dash"],..._a["short-dot"]],"short-dash-dot-dot":[..._a["short-dash"],..._a["short-dot"],..._a["short-dot"]],"short-dot":_a["short-dot"],solid:null},fgt=8;function mgt(t,e=2){return C(t)?t:{pattern:t.slice(),pixelRatio:e}}function k6t(t,e=2){return{pattern:[t,t],pixelRatio:e}}function yRe(t){return v(t)&&t.type==="style"?ggt(t.style):null}function ggt(t){return v(t)?mgt(pgt[t],fgt):null}const ygt=["polyline","polygon","extent"];let _Re=class vRe extends ag{constructor(e,i,r,s){super(e,i,r,s)}async doLoad(){if(this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=RP(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:gd(1))<0)throw new W("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._markerTexture=v(this.symbolLayer.marker)&&v(this._context.sharedResources.textures)?wpt(this._context.sharedResources.textures,Hmt(this.symbolLayer.marker.style)):null}_getMaterialParameters(e,i=!1){var n;const r=this._getCombinedOpacityAndColor(i&&this._markerColor||this._materialColor);this._patternHidesLine&&!i&&(r[3]=0);const s={width:this._computeMaterialWidth((n=this.symbolLayer)==null?void 0:n.size),color:r,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:lX(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:yRe(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?{...s,...this._fastUpdates.materialParameters}:s}get _materialColor(){return go(this.symbolLayer.material,e=>e.color)}get _markerColor(){return go(this.symbolLayer.marker,e=>e.color)}get _lineMaterial(){return C(this._lineMaterialCached)&&(this._lineMaterialCached=new rE(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterialCached)),this._lineMaterialCached}get _ringMaterial(){return C(this._ringMaterialCached)&&(this._ringMaterialCached=new rE(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterialCached)),this._ringMaterialCached}get _wireframeLineMaterial(){return C(this._wireframeLineMaterialCached)&&(this._wireframeLineMaterialCached=new rE({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterialCached)),this._wireframeLineMaterialCached}get _wireframeRingMaterial(){return C(this._wireframeRingMaterialCached)&&(this._wireframeRingMaterialCached=new rE({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterialCached)),this._wireframeRingMaterialCached}get _markerMaterial(){return C(this._markerMaterialCached)&&v(this.symbolLayer.marker)&&v(this._markerTexture)&&(this._markerMaterialCached=new agt({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id}),this._context.stage.add(this._markerMaterialCached)),this._markerMaterialCached}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._lineMaterialCached=null,this._ringMaterialCached=null,this._wireframeLineMaterialCached=null,this._wireframeRingMaterialCached=null,this._markerMaterialCached=null,this._markerTexture=Wr(this._markerTexture)}_getDrivenSize(e){return this._drivenProperties.size&&e.size?ko(jdt(e.size)):1}_getSizeFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?Iy(this._fastUpdates.visualVariables.size.field,e):null}_getDrivenColor(e){const i=si(1,1,1,1);return this._drivenProperties.color&&e.color&&(i[0]=e.color[0],i[1]=e.color[1],i[2]=e.color[2],e.color.length>0&&(i[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(i[3]=e.opacity),i}_getColorFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?Iy(this._fastUpdates.visualVariables.color.field,e):null}_getOpacityFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?Iy(this._fastUpdates.visualVariables.opacity.field,e):null}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,ygt,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new cf);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,r,i.uid)}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables"||!MP(this._fastUpdates,i,this._vvConvertOptions))return $n.Recreate_Symbol;this._forEachMaterial(s=>s.setParameters(this._fastUpdates.materialParameters))}return $n.Fast_Update}prepareSymbolLayerPatch(e){var n,o;if(e.diff.type!=="partial")return;const i=e.diff.diff,r={};((n=i.size)==null?void 0:n.type)==="complete"&&(r.width=this._computeMaterialWidth(i.size.newValue),delete i.size),((o=i.cap)==null?void 0:o.type)==="complete"&&(r.cap=lX(Gt(i.cap.newValue,"butt")),delete i.cap);const s=this._prepareMarkerPatch(e,i);this._prepareMaterialPatch(e,i,s),e.symbolLayerStatePatches.push(()=>this._forEachMaterial(a=>a.setParameters(r)))}layerOpacityChanged(){this._forEachMaterial((e,i)=>this._updateMaterialLayerOpacity(e,i))}_forEachMaterial(e){v(this._lineMaterialCached)&&e(this._lineMaterialCached),v(this._ringMaterialCached)&&e(this._ringMaterialCached),v(this._wireframeLineMaterialCached)&&e(this._wireframeLineMaterialCached),v(this._wireframeRingMaterialCached)&&e(this._wireframeRingMaterialCached),v(this._markerMaterialCached)&&e(this._markerMaterialCached,!0)}_updateMaterialLayerOpacity(e,i=!1){const r=e.parameters.color,s=In(this.symbolLayer,"material","color"),n=this._patternHidesLine&&!i?0:this._getCombinedOpacity(s),o=si(r[0],r[1],r[2],n);e.setParameters({color:o})}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=II(vRe.elevationModeChangeTypes,r,s);if(n!==Ss.UPDATE)return n;const o=Sd(s);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(i=>i.setParameters(e)),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_getGeometryAsPolygonOrPolyline(e){switch(e.type){case"extent":if(e instanceof Pi)return md.fromExtent(e);break;case"polygon":case"polyline":return e}return null}_createAs3DShape(e,i,r){const s=e.graphic,n=this._getGeometryAsPolygonOrPolyline(s.geometry),o=n.type==="polygon"?n.rings:n.paths,a=new Array,l=Nn(),c=rgt(n,this._context.elevationProvider,this._context.renderCoordsHelper,i),h=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(c,o,h,"LineSymbol3DLayer");for(let m=0;m<c.lines.length;m++){const y=c.lines[m],_=y.position,b=y.mapPositions;if(v(this._context.clippingExtent)&&($r(l),Wu(l,b),!Pp(l,this._context.clippingExtent)))continue;const w=this._createGeometry(n.type==="polygon"?this._ringMaterial:this._lineMaterial,e,_,b,n.type,h3.ELEVATED,r);a.push(w),Ji.LINE_WIREFRAMES&&a.push(w.instantiate({material:n.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial})),v(this._markerMaterial)&&a.push(w.instantiate({material:this._markerMaterial}))}if(a.length===0)return null;const p=new v0({geometries:a,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),f=new og(this,p,a,null,null,Zht,i);return f.alignedSampledElevation=c.sampledElevation,f.needsElevationUpdates=Sd(i.mode),f}_createGeometry(e,i,r,s,n,o,a){const l=n==="polygon",c=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,h=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size,p=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:this._context.layer.uid});return cX(e,{overlayInfo:o===h3.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:l,mapPositions:s,attributeData:{position:r,size:h?null:this._getDrivenSize(i.renderingInfo),color:c?null:this._getDrivenColor(i.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(i.graphic),colorFeature:this._getColorFeatureAttributeData(i.graphic),opacityFeature:this._getOpacityFeatureAttributeData(i.graphic)}},p)}_createAsOverlay(e,i){const r=e.graphic,s=this._getGeometryAsPolygonOrPolyline(r.geometry),n=s.type==="polygon"?s.rings:s.paths,o=s.type==="polygon"?this._ringMaterial:this._lineMaterial;o.renderPriority=this._renderPriority;const a=Ji.LINE_WIREFRAMES?s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,l=this._markerMaterial;v(a)&&(a.renderPriority=this._renderPriority-.001),v(l)&&(l.renderPriority=this._renderPriority-.002);const c=new Array,h=Nn(),p=$r(),f=sgt(s,this._context.overlaySR),m=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(f,n,m,"LineSymbol3DLayer");for(const y of f.lines){if($r(h),Wu(h,y.position),!Pp(h,this._context.clippingExtent))continue;rC(p,h);const _=w=>{const S=this._createGeometry(w,e,y.position,void 0,s.type,h3.DRAPED,r.uid),T=new VC(S,{layerUid:i,graphicUid:r.uid});return c.push(T),T};if(v(l)){const w=_(l),S=this.symbolLayer.marker.placement;S!=="begin"&&S!=="begin-end"||Wu(h,y.position,0,1),S!=="end"&&S!=="begin-end"||Wu(h,y.position,y.position.length-3,1),this._updateBoundingSphere(w,h)}const b=_(o);if(this._updateBoundingSphere(b,h),Ji.LINE_WIREFRAMES){const w=_(a);this._updateBoundingSphere(w,h)}}return new k8(this,c,p,this._context.drapeSourceRenderer)}_updateBoundingSphere(e,i){nr(e.boundingSphere,.5*(i[0]+i[3]),.5*(i[1]+i[4]),0,.5*Math.sqrt((i[3]-i[0])*(i[3]-i[0])+(i[4]-i[1])*(i[4]-i[1])))}get _patternHidesLine(){const e=this.symbolLayer.pattern;return v(e)&&e.type==="style"&&e.style==="none"}_computeMaterialWidth(e){return e=Gt(e,gd(1)),this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?ko(1):1:ko(e)}_prepareMaterialPatch(e,i,r){var a;const s=i.material;if(C(s))return void(r.changed&&r.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterialCached,e));if(s.type==="collection")return;const n=s.type==="complete"?go(s.newValue,l=>l.color):((a=s.diff.color)==null?void 0:a.type)==="complete"?s.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(n);r.useMaterialColor&&this._patchMaterialColor(sI(o),this._markerMaterialCached,e),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._lineMaterialCached,e),delete i.material}_prepareMarkerPatch(e,i){const r=i.marker;if(C(r)||r.type!=="partial"||v(r.diff.style)||v(r.diff.placement)||v(r.diff.color)&&r.diff.color.type!=="complete")return{changed:!1,useMaterialColor:C(this._markerColor)};const s=r.diff.color;if(C(s))return delete i.marker,{changed:!1,useMaterialColor:C(this._markerColor)};const n=s.newValue;return C(n)?(delete i.marker,{changed:!0,useMaterialColor:!0}):(this._patchMaterialColor(this._getCombinedOpacityAndColor(n),this._markerMaterialCached,e),delete i.marker,{changed:!0,useMaterialColor:!1})}_patchMaterialColor(e,i,r){C(i)||r.symbolLayerStatePatches.push(()=>i.setParameters({color:e}))}};var h3;_Re.elevationModeChangeTypes={definedChanged:Ss.RECREATE,staysOnTheGround:Ss.NONE,onTheGroundChanged:Ss.RECREATE},function(t){t[t.DRAPED=0]="DRAPED",t[t.ELEVATED=1]="ELEVATED"}(h3||(h3={}));let vO=null,i6=!0;function bB(t,e,i){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(i6)try{return new ImageData(t,e)}catch{i6=!1}return bRe(t,e,i)}function _gt(t,e,i,r){if(!e||!i)throw new Error("Cannot construct image data without dimensions");if(i6)try{return new ImageData(t,e,i)}catch{i6=!1}const s=bRe(e,i,r);return s.data.set(t,0),s}function vgt(){return vO||(vO=document.createElement("canvas"),vO.width=1,vO.height=1),vO}function bRe(t,e,i){return i||(i=vgt()),i.getContext("2d").createImageData(t,e)}var SS;const wB=new WeakMap;let bgt=0,Xf=SS=class extends Ie{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,i,r){if(t instanceof HTMLImageElement){const s={type:"image-element",src:Ox(t.src,r),crossOrigin:t.crossOrigin};e[i]=s}else if(t instanceof HTMLCanvasElement){const s=t.getContext("2d").getImageData(0,0,t.width,t.height),n={type:"canvas-element",imageData:this._encodeImageData(s)};e[i]=n}else if(t instanceof HTMLVideoElement){const s={type:"video-element",src:Ox(t.src,r),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[i]=s}else if(t instanceof ImageData){const s={type:"image-data",imageData:this._encodeImageData(t)};e[i]=s}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=this._decodeImageData(t.imageData),i=document.createElement("canvas");return i.width=e.width,i.height=e.height,i.getContext("2d").putImageData(e,0,0),i}case"image-data":return this._decodeImageData(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const t=this.data,e=this.url;if(t instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(t.getContext("2d").getImageData(0,0,t.width,t.height));if(t instanceof ImageData)return this._imageDataContainsTransparent(t);if(e){const i=e.substr(e.length-4,4).toLowerCase(),r=e.substr(0,15).toLocaleLowerCase();if(i===".png"||r==="data:image/png;")return!0}return!1}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){const t=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(i="")=>`d:${i},t:${this.transparent},w:${t}`;return this.url!=null?e(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(wB.has(this.data)||wB.set(this.data,++bgt),e(wB.get(this.data))):e()}clone(){const t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new SS(t)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const i=this.clone();return t.set(this,i),i}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(t){let e="";for(let i=0;i<t.data.length;i++)e+=String.fromCharCode(t.data[i]);return{data:btoa(e),width:t.width,height:t.height}}_decodeImageData(t){const e=atob(t.data),i=new Uint8ClampedArray(e.length);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return _gt(i,t.width,t.height)}_imageDataContainsTransparent(t){for(let e=3;e<t.data.length;e+=4)if(t.data[e]!==255)return!0;return!1}static from(t){return typeof t=="string"?new SS({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new SS({data:t}):XE(SS,t)}};u([d({type:String,json:{write:Zv}})],Xf.prototype,"url",null),u([d({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),d()],Xf.prototype,"data",null),u([lt("data")],Xf.prototype,"writeData",null),u([Qe("data")],Xf.prototype,"readData",null),u([d({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],Xf.prototype,"transparent",null),u([d({json:{write:!0}})],Xf.prototype,"wrap",void 0),u([d({readOnly:!0})],Xf.prototype,"contentHash",null),Xf=SS=u([I("esri.geometry.support.MeshTexture")],Xf);const d3=Xf;var uX;let ap=uX=class extends Ie{constructor(t){super(t),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const i=v(t)?t.get(this):null;if(i)return i;const r=new uX(this.clonePropertiesWithDeduplication(e));return v(t)&&t.set(this,r),r}clonePropertiesWithDeduplication(t){return{color:v(this.color)?this.color.clone():null,colorTexture:v(this.colorTexture)?this.colorTexture.cloneWithDeduplication(t):null,normalTexture:v(this.normalTexture)?this.normalTexture.cloneWithDeduplication(t):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:v(this.colorTextureTransform)?this.colorTextureTransform:null,normalTextureTransform:v(this.normalTextureTransform)?this.normalTextureTransform:null}}};u([d({type:ot,json:{write:!0}})],ap.prototype,"color",void 0),u([d({type:d3,json:{write:!0}})],ap.prototype,"colorTexture",void 0),u([d({type:d3,json:{write:!0}})],ap.prototype,"normalTexture",void 0),u([d({nonNullable:!0,json:{write:!0}})],ap.prototype,"alphaMode",void 0),u([d({nonNullable:!0,json:{write:!0}})],ap.prototype,"alphaCutoff",void 0),u([d({nonNullable:!0,json:{write:!0}})],ap.prototype,"doubleSided",void 0),u([d()],ap.prototype,"colorTextureTransform",void 0),u([d()],ap.prototype,"normalTextureTransform",void 0),ap=uX=u([I("esri.geometry.support.MeshMaterial")],ap);const Nee=ap;var hX;let Ih=hX=class extends Nee{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const i=v(t)?t.get(this):null;if(i)return i;const r=new hX(this.clonePropertiesWithDeduplication(e));return v(t)&&t.set(this,r),r}clonePropertiesWithDeduplication(t){return{...super.clonePropertiesWithDeduplication(t),emissiveColor:v(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:v(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(t):null,occlusionTexture:v(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(t):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:v(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(t):null,occlusionTextureTransform:v(this.occlusionTextureTransform)?this.occlusionTextureTransform:null,emissiveTextureTransform:v(this.emissiveTextureTransform)?this.emissiveTextureTransform:null,metallicRoughnessTextureTransform:v(this.metallicRoughnessTextureTransform)?this.metallicRoughnessTextureTransform:null}}};u([d({type:ot,json:{write:!0}})],Ih.prototype,"emissiveColor",void 0),u([d({type:d3,json:{write:!0}})],Ih.prototype,"emissiveTexture",void 0),u([d({type:d3,json:{write:!0}})],Ih.prototype,"occlusionTexture",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Ih.prototype,"metallic",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Ih.prototype,"roughness",void 0),u([d({type:d3,json:{write:!0}})],Ih.prototype,"metallicRoughnessTexture",void 0),u([d()],Ih.prototype,"occlusionTextureTransform",void 0),u([d()],Ih.prototype,"emissiveTextureTransform",void 0),u([d()],Ih.prototype,"metallicRoughnessTextureTransform",void 0),Ih=hX=u([I("esri.geometry.support.MeshMaterialMetallicRoughness")],Ih);const wRe=Ih;var MF;const xRe="esri.geometry.support.MeshVertexAttributes",i2=oe.getLogger(xRe);let dh=MF=class extends Ie{constructor(t){super(t),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(t){return ES(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},i2)}castPosition(t){return t&&t instanceof Float32Array&&i2.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),ES(t,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},i2)}castUv(t){return ES(t,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},i2)}castNormal(t){return ES(t,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},i2)}castTangent(t){return ES(t,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},i2)}clone(){const t={position:ae(this.position),uv:ae(this.uv),normal:ae(this.normal),tangent:ae(this.tangent),color:ae(this.color)};return new MF(t)}clonePositional(){const t={position:ae(this.position),normal:ae(this.normal),tangent:ae(this.tangent),uv:this.uv,color:this.color};return new MF(t)}};function xB(t,e,i,r){const{loggerTag:s,stride:n}=e;return t.length%n!=0?(r.error(s,`Invalid array length, expected a multiple of ${n}`),new i([])):t}function ES(t,e,i,r,s){if(!t)return t;if(t instanceof e)return xB(t,r,e,s);for(const n of i)if(t instanceof n)return xB(new e(t),r,e,s);if(Array.isArray(t))return xB(new e(t),r,e,s);{const n=i.map(o=>`'${o.name}'`);return s.error(`Failed to set property, expected one of ${n}, but got ${t.constructor.name}`),new e([])}}function bO(t,e,i){e[i]=wgt(t)}function wgt(t){const e=new Array(t.length);for(let i=0;i<t.length;i++)e[i]=t[i];return e}u([d({json:{write:bO}})],dh.prototype,"color",void 0),u([wi("color")],dh.prototype,"castColor",null),u([d({nonNullable:!0,json:{write:bO}})],dh.prototype,"position",void 0),u([wi("position")],dh.prototype,"castPosition",null),u([d({json:{write:bO}})],dh.prototype,"uv",void 0),u([wi("uv")],dh.prototype,"castUv",null),u([d({json:{write:bO}})],dh.prototype,"normal",void 0),u([wi("normal")],dh.prototype,"castNormal",null),u([d({json:{write:bO}})],dh.prototype,"tangent",void 0),u([wi("tangent")],dh.prototype,"castTangent",null),dh=MF=u([I(xRe)],dh);var rM;const TRe="esri.geometry.support.MeshComponent",xgt=oe.getLogger(TRe);let Jg=rM=class extends Ie{static from(t){return XE(rM,t)}constructor(t){super(t),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}castFaces(t){return ES(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},xgt)}castMaterial(t){return XE(t&&typeof t=="object"&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?wRe:Nee,t)}clone(){return new rM({faces:ae(this.faces),shading:this.shading,material:ae(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(t,e){const i={faces:ae(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals};return new rM(i)}};u([d({json:{write:!0}})],Jg.prototype,"faces",void 0),u([wi("faces")],Jg.prototype,"castFaces",null),u([d({type:Nee,json:{write:!0}})],Jg.prototype,"material",void 0),u([wi("material")],Jg.prototype,"castMaterial",null),u([d({type:String,json:{write:!0}})],Jg.prototype,"shading",void 0),u([d({type:Boolean})],Jg.prototype,"trustSourceNormals",void 0),Jg=rM=u([I(TRe)],Jg);const Tgt=Jg,z8=oe.getLogger("esri.geometry.support.meshUtils.normalProjection");function Sgt(t,e,i,r,s){return j8(r)?(G8($y.TO_PCPF,Lr.fromTypedArray(t),Da.fromTypedArray(e),Da.fromTypedArray(i),r,Lr.fromTypedArray(s)),s):(z8.error("Cannot convert spatial reference to PCPF"),s)}function B6t(t,e,i,r,s){return j8(r)?(G8($y.FROM_PCPF,Lr.fromTypedArray(t),Da.fromTypedArray(e),Da.fromTypedArray(i),r,Lr.fromTypedArray(s)),s):(z8.error("Cannot convert to spatial reference from PCPF"),s)}function z6t(t,e,i){return Es(t,e,0,i,AU(e),0,t.length/3),i}function G6t(t,e,i){return Es(t,AU(i),0,e,i,0,t.length/3),e}function Egt(t,e,i){if(C(t))return e;const r=Da.fromTypedArray(t),s=Da.fromTypedArray(e);return LI(s,r,i),e}function Cgt(t,e,i){if(C(t))return e;RC(no,i);const r=Lr.fromTypedArray(t),s=Lr.fromTypedArray(e);return h1(s,r,no),tQ(no)||_ee(s,s),e}function Agt(t,e,i){if(C(t))return e;RC(no,i);const r=Lr.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),s=Lr.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT);if(h1(s,r,no),tQ(no)||_ee(s,s),t!==e)for(let n=3;n<t.length;n+=4)e[n]=t[n];return e}function Ogt(t,e,i,r,s){if(!j8(r))return z8.error("Cannot convert spatial reference to PCPF"),s;G8($y.TO_PCPF,Lr.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),Da.fromTypedArray(e),Da.fromTypedArray(i),r,Lr.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT));for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}function j6t(t,e,i,r,s){if(!j8(r))return z8.error("Cannot convert to spatial reference from PCPF"),s;G8($y.FROM_PCPF,Lr.fromTypedArray(t,16),Da.fromTypedArray(e),Da.fromTypedArray(i),r,Lr.fromTypedArray(s,16));for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}function G8(t,e,i,r,s,n){if(!e)return;const o=i.count,a=AU(s);if(SRe(s))for(let l=0;l<o;l++)r.getVec(l,JL),e.getVec(l,Tf),Jp(a,JL,KL,a),bd(no,KL),t===$y.FROM_PCPF&&wd(no,no),qc(Tf,Tf,no),n.setVec(l,Tf);else for(let l=0;l<o;l++){r.getVec(l,JL),e.getVec(l,Tf),Jp(a,JL,KL,a),bd(no,KL);const c=v4(i.get(l,1));let h=Math.cos(c);t===$y.TO_PCPF&&(h=1/h),no[0]*=h,no[1]*=h,no[2]*=h,no[3]*=h,no[4]*=h,no[5]*=h,t===$y.FROM_PCPF&&wd(no,no),qc(Tf,Tf,no),Oe(Tf,Tf),n.setVec(l,Tf)}return n}function j8(t){return SRe(t)||Rgt(t)}function SRe(t){return t.isWGS84||Oge(t)||Zm(t)||Jm(t)}function Rgt(t){return t.isWebMercator}var $y;(function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"})($y||($y={}));const JL=M(),Tf=M(),KL=We(),no=ls();let ERe=class{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=gy.KTX2_ENCODING}};function mx(t){return(t==null?void 0:t.type)==="encoded-mesh-texture"}async function Mgt(t){return new Promise((e,i)=>{const r=new Blob([t]),s=new FileReader;s.onload=()=>{const n=s.result;e(JSON.parse(n))},s.onerror=n=>{i(n)},s.readAsText(r)})}async function Pgt(t,e){return e===gy.KTX2_ENCODING?new ERe(t):new Promise((i,r)=>{const s=new Blob([t],{type:e}),n=URL.createObjectURL(s),o=new Image,a=()=>{URL.revokeObjectURL(n),"decode"in o?o.decode().then(()=>i(o),()=>i(o)).then(c):(i(o),c())},l=h=>{URL.revokeObjectURL(n),r(h),c()},c=()=>{o.removeEventListener("load",a),o.removeEventListener("error",l)};o.addEventListener("load",a),o.addEventListener("error",l),o.src=n})}function gm(t){if(C(t))return null;const e=v(t.offset)?t.offset:qAe,i=v(t.rotation)?t.rotation:0,r=v(t.scale)?t.scale:WAe,s=OF(1,0,0,0,1,0,e[0],e[1],1),n=OF(Math.cos(i),-Math.sin(i),0,Math.sin(i),Math.cos(i),0,0,0,1),o=OF(r[0],0,0,0,r[1],0,0,0,1),a=ac();return OC(a,n,o),OC(a,s,a),a}function Igt(t){const e=new Ui,{vertex:i,fragment:r}=e;return e.include(nc,t),e.include(vT,t),e.include(uOe,t),Kc(i,t),t.stippleEnabled&&(e.attributes.add(A.UV0,"vec2"),e.attributes.add(A.AUXPOS1,"vec3"),i.uniforms.add(new Si("viewport",(s,n)=>n.camera.fullViewport))),e.attributes.add(A.POSITION,"vec3"),e.varyings.add("vpos","vec3"),i.code.add(x`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),t.stippleEnabled&&(i.code.add(x`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),t.draped?i.uniforms.add(new He("worldToScreenRatio",(s,n)=>1/n.screenToPCSRatio)):i.code.add(x`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),i.code.add(x`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),t.draped?i.code.add(x`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):i.code.add(x`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),i.uniforms.add(new He("stipplePatternPixelSize",s=>bee(s))),i.code.add(x`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),i.code.add(x`}`),t.output===k.Highlight&&e.include(g0,t),e.include(en,t),r.uniforms.add(new He("alphaCoverage",(s,n)=>Math.min(1,s.width*n.camera.pixelRatio))),t.hasVertexColors||r.uniforms.add(new Si("constantColor",s=>s.color)),r.code.add(x`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${t.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    ${t.output===k.ObjectAndLayerIdColor?x`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${x.float(la)}) {
      discard;
    }

    ${t.output===k.Color?x`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===k.Highlight?x`outputHighlight();`:""}
  }
  `),e}const $gt=Object.freeze(Object.defineProperty({__proto__:null,build:Igt},Symbol.toStringTag,{value:"Module"}));let CRe=class ARe extends ji{get _stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==k.Highlight}initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Mt.WEBGL2}initializeProgram(e){return new ki(e.rctx,ARe.shader.get().build(this.configuration),Li)}initializePipeline(){const e=this.configuration,i=Yn(Ve.SRC_ALPHA,Ve.ONE,Ve.ONE_MINUS_SRC_ALPHA,Ve.ONE_MINUS_SRC_ALPHA),r=(s,n=null,o=null)=>Qt({blending:n,depthTest:xee,depthWrite:o,colorWrite:ui,stencilWrite:e.hasOccludees?Ym:null,stencilTest:e.hasOccludees?s?d1:S1:null});return e.output===k.Color?(this._occludeePipelineState=r(!0,e.transparent||this._stippleEnabled?i:null,pc),r(!1,e.transparent||this._stippleEnabled?i:null,pc)):r(!1)}get primitiveType(){return jt.LINES}getPipelineState(e,i){return i?this._occludeePipelineState:super.getPipelineState(e,i)}};CRe.shader=new Vi($gt,()=>ee(()=>import("./NativeLine.glsl-f43d91f2.js"),[],import.meta.url));let Su=class extends uo{constructor(){super(...arguments),this.output=k.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}};u([z({count:k.COUNT})],Su.prototype,"output",void 0),u([z()],Su.prototype,"hasSlicePlane",void 0),u([z()],Su.prototype,"hasVertexColors",void 0),u([z()],Su.prototype,"transparent",void 0),u([z()],Su.prototype,"draped",void 0),u([z()],Su.prototype,"stippleEnabled",void 0),u([z()],Su.prototype,"stippleOffColorEnabled",void 0),u([z()],Su.prototype,"stipplePreferContinuous",void 0),u([z()],Su.prototype,"hasOccludees",void 0),u([z({constValue:!1})],Su.prototype,"stippleRequiresClamp",void 0),u([z({constValue:!1})],Su.prototype,"stippleScaleWithLineWidth",void 0),u([z({constValue:!1})],Su.prototype,"stippleRequiresStretchMeasure",void 0);var r6;(function(t){t[t.START=0]="START",t[t.END=1]="END"})(r6||(r6={}));let Rue=class extends x1{constructor(e){super(e,new Ngt),this._configuration=new Su}getConfiguration(e,i){this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.draped=i.slot===Fe.DRAPED_MATERIAL;const r=v(this.parameters.stipplePattern);return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&v(this.parameters.stippleOffColor),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._configuration}intersect(e,i,r,s,n,o){if(!r.options.selectionMode||!e.visible)return;if(!PSe(i))return void oe.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const a=e.vertexAttributes.get(A.POSITION).data,l=r.camera,c=Ugt;Fn(c,r.point);const h=2;fe(wO[0],c[0]-h,c[1]+h,0),fe(wO[1],c[0]+h,c[1]+h,0),fe(wO[2],c[0]+h,c[1]-h,0),fe(wO[3],c[0]-h,c[1]-h,0);for(let _=0;_<4;_++)if(!l.unprojectFromRenderScreen(wO[_],Tg[_]))return;Ta(l.eye,Tg[0],Tg[1],TB),Ta(l.eye,Tg[1],Tg[2],SB),Ta(l.eye,Tg[2],Tg[3],EB),Ta(l.eye,Tg[3],Tg[0],CB);let p=Number.MAX_VALUE,f=0;for(let _=0;_<a.length-5;_+=3){if(Ka[0]=a[_]+i[12],Ka[1]=a[_+1]+i[13],Ka[2]=a[_+2]+i[14],Qa[0]=a[_+3]+i[12],Qa[1]=a[_+4]+i[13],Qa[2]=a[_+5]+i[14],Er(TB,Ka)<0&&Er(TB,Qa)<0||Er(SB,Ka)<0&&Er(SB,Qa)<0||Er(EB,Ka)<0&&Er(EB,Qa)<0||Er(CB,Ka)<0&&Er(CB,Qa)<0)continue;if(l.projectToRenderScreen(Ka,eb),l.projectToRenderScreen(Qa,tb),eb[2]<0&&tb[2]>0){be(Sf,Ka,Qa);const w=l.frustum,S=-Er(w[Sr.NEAR],Ka)/Ae(Sf,w[Sr.NEAR]);ue(Sf,Sf,S),ve(Ka,Ka,Sf),l.projectToRenderScreen(Ka,eb)}else if(eb[2]>0&&tb[2]<0){be(Sf,Qa,Ka);const w=l.frustum,S=-Er(w[Sr.NEAR],Qa)/Ae(Sf,w[Sr.NEAR]);ue(Sf,Sf,S),ve(Qa,Qa,Sf),l.projectToRenderScreen(Qa,tb)}else if(eb[2]<0&&tb[2]<0)continue;eb[2]=0,tb[2]=0;const b=dJ(ax(eb,tb,Iue),c);b<p&&(p=b,he(Mue,Ka),he(Pue,Qa),f=_/3)}const m=r.rayBegin,y=r.rayEnd;if(p<h*h){let _=Number.MAX_VALUE;if(lve(ax(Mue,Pue,Iue),ax(m,y,Fgt),Q1)){be(Q1,Q1,m);const b=je(Q1);ue(Q1,Q1,1/b),_=b/Ar(m,y)}o(_,Q1,f,!1)}}intersectDraped(e,i,r,s,n,o){if(!r.options.selectionMode)return;const a=e.vertexAttributes.get(A.POSITION).data,l=e.vertexAttributes.get(A.SIZE),c=l?l.data[0]:0,h=s[0],p=s[1],f=((c+1)/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,y=0;for(let _=0;_<a.length-5;_+=3){const b=a[_],w=a[_+1],S=h-b,T=p-w,E=a[_+3]-b,O=a[_+4]-w,R=we((E*S+O*T)/(E*E+O*O),0,1),L=E*R-S,P=O*R-T,F=L*L+P*P;F<m&&(m=F,y=_/3)}m<f*f&&n(o.dist,o.normal,y,!1)}requiresSlot(e,i){return!(i!==k.Color&&i!==k.Highlight&&i!==k.ObjectAndLayerIdColor||e!==Fe.OPAQUE_MATERIAL&&e!==Fe.DRAPED_MATERIAL)}createGLMaterial(e){return new Lgt(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?AOe:Wpt;return C(this.parameters.stipplePattern)?new AA(e):new Dgt(e.clone().vec3f(A.AUXPOS1).vec2f(A.UV0))}},Lgt=class extends w1{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===k.Color&&this._updateOccludeeState(e);const i=this._material.parameters.stipplePattern;return this._stipplePattern!==i&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,i)),this._stipplePattern=i),this.ensureTechnique(CRe,e)}},Dgt=class{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(A.POSITION).length}write(e,i,r,s,n){UCe(r,this.vertexBufferLayout,e,i,s,n),this._writeAuxpos1(e,r,s,n),this._writeUV0(e,r,s,n)}_writeAuxpos1(e,i,r,s){const n=r.getField(A.AUXPOS1,Lr),o=i.indices.get(A.POSITION),a=i.vertexAttributes.get(A.POSITION).data,l=e,c=n.typedBufferStride,h=n.typedBuffer;s*=c;for(let p=0;p<o.length-1;p+=2)for(const f of[1,0]){const m=3*o[p+f],y=a[m],_=a[m+1],b=a[m+2],w=l[0]*y+l[4]*_+l[8]*b+l[12],S=l[1]*y+l[5]*_+l[9]*b+l[13],T=l[2]*y+l[6]*_+l[10]*b+l[14];h[s]=w,h[s+1]=S,h[s+2]=T,s+=c}}_writeUV0(e,i,r,s){var T;const n=r.getField(A.UV0,m0),o=i.indices.get(A.POSITION),a=i.vertexAttributes.get(A.POSITION).data,l=(T=i.vertexAttributes.get(A.DISTANCETOSTART))==null?void 0:T.data,c=n.typedBufferStride,h=n.typedBuffer;let p=0;h[s*=c]=r6.START,h[s+1]=p,s+=c;const f=3*o[0],m=fe(Ka,a[f],a[f+1],a[f+2]);e&&ut(m,m,e);const y=Qa,_=o.length-1;let b=1;const w=l?(E,O,R)=>p=l[R]:(E,O,R)=>p+=Ar(E,O);for(let E=1;E<_;E+=2){const O=3*o[E];fe(y,a[O],a[O+1],a[O+2]),e&&ut(y,y,e),w(m,y,b++);for(let R=0;R<2;++R)h[s]=1-R,h[s+1]=p,s+=c;he(m,y)}const S=3*o[_];fe(y,a[S],a[S+1],a[S+2]),e&&ut(y,y,e),w(m,y,b),h[s]=r6.END,h[s+1]=p}},Ngt=class extends TA{constructor(){super(...arguments),this.color=ed,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1,this.stippleTexture=null}};const Ka=M(),Qa=M(),Sf=M(),Q1=M(),eb=na(),tb=na(),Mue=M(),Pue=M(),Iue=nf(),Fgt=nf(),Ugt=M(),wO=[na(),na(),na(),na()],Tg=[M(),M(),M(),M()],TB=qi(),SB=qi(),EB=qi(),CB=qi(),Vgt=["mesh"];class kgt extends ag{constructor(e,i,r,s){super(e,i,r,s),this._materials=new Map,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){Ji.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new Rue({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new Rue({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(Array.from(this._materials.values(),e=>e.material)),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear()}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,Vgt,"fill on mesh-3d"))return null;const r=this.setGraphicElevationContext(i,new cf),s=e.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}layerOpacityChanged(e,i){const r=this._getLayerOpacity();this._materials.forEach(s=>{s.material.setParameters({layerOpacity:r});const n=s.material.parameters;this._setMaterialTransparentParameter(n,s),s.material.setParameters({transparent:n.transparent})}),e.forEach(s=>{const n=i(s);v(n)&&n.layerOpacityChanged(r,this._context.isAsync)})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,c1)}slicePlaneEnabledChanged(e,i){return this._materials.forEach(r=>{r.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),e.forEach(r=>{const s=i(r);v(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._materials.forEach(i=>i.material.setParameters({usePBR:e})),!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(e){return C(e)?"-":e instanceof ot?e.toHex():e.contentHash}_materialPropertiesDefault(e,i){const r=this._requiresSymbolVertexColors(),s=!!e.vertexAttributes.color,n=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:s,hasVertexTangents:n,uid:`vc:${s},vt:${n},vct${i},svc:${r}`}}_materialProperties(e,i,r){const s=this._materialPropertiesDefault(e,r);if(!i.material)return s;const{color:n,colorTexture:o,normalTexture:a,doubleSided:l,alphaCutoff:c,alphaMode:h}=i.material,p=this._colorOrTextureUid(n),f=this._colorOrTextureUid(o),m=this._colorOrTextureUid(a);if(s.color=n,s.colorTexture=o,s.normalTexture=a,s.uid=`${s.uid},cmuid:${p},ctmuid:${f},ntmuid:${m},ds:${l},ac:${c},am:${h}`,i.material instanceof wRe){const{metallic:y,roughness:_,metallicRoughnessTexture:b,emissiveColor:w,emissiveTexture:S,occlusionTexture:T}=i.material,E=this._colorOrTextureUid(b),O=this._colorOrTextureUid(w),R=this._colorOrTextureUid(S),L=this._colorOrTextureUid(T);s.metallic=y,s.roughness=_,s.metallicRoughnessTexture=b,s.emissiveColor=w,s.emissiveTexture=S,s.occlusionTexture=T,s.colorTextureTransform=i.material.colorTextureTransform,s.normalTextureTransform=i.material.normalTextureTransform,s.emissiveTextureTransform=i.material.emissiveTextureTransform,s.occlusionTextureTransform=i.material.occlusionTextureTransform,s.metallicRoughnessTextureTransform=i.material.metallicRoughnessTextureTransform,s.uid=`${s.uid},mrm:${y},mrr:${_},mrt:${E},emuid:${O},etmuid:${R},otmuid:${L}`}return s}_setInternalColorValueParameters(e,i){i.diffuse=ot.toUnitRGB(e),i.opacity=e.a}_getLoadableTextureResource(e){return e.data?e.data:e.url}_getInternalTextureId(e){const i=this._getInternalTexture(e,fr.Opaque);return v(i)?i.id:null}_getInternalTexture(e,i){const r=this._getLoadableTextureResource(e);if(!r)return null;const s=`${e.contentHash}/${i}`;let n=this._textures.get(s);return n||(n=new _T(mx(r)?r.data:r,{mipmap:!0,wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,preMultiplyAlpha:!mx(r)&&i!==fr.Opaque,encoding:mx(r)&&v(r.encoding)?r.encoding:void 0}),this._textures.set(s,n),this._context.stage.add(n),this._context.stage.loadImmediate(n)),n}_castTextureWrap(e="repeat"){if(typeof e=="string"){const i=this._castTextureWrapIndividual(e);return{s:i,t:i}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}_castTextureWrapIndividual(e){switch(e){case"clamp":return kt.CLAMP_TO_EDGE;case"mirror":return kt.MIRRORED_REPEAT;default:return kt.REPEAT}}_setInternalMaterialParameters(e,i){if(v(e.color)&&this._setInternalColorValueParameters(e.color,i),v(e.colorTexture)){const r=this._getInternalTexture(e.colorTexture,i.textureAlphaMode);v(r)?(i.textureId=r.id,i.textureAlphaPremultiplied=!!r.params.preMultiplyAlpha):i.textureId=void 0}v(e.normalTexture)&&(i.normalTextureId=this._getInternalTextureId(e.normalTexture)),v(e.emissiveColor)&&(i.emissiveFactor=ot.toUnitRGB(e.emissiveColor)),v(e.emissiveTexture)&&(i.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),v(e.occlusionTexture)&&(i.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),v(e.metallicRoughnessTexture)&&(i.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),i.colorTextureTransformMatrix=gm(e.colorTextureTransform),i.normalTextureTransformMatrix=gm(e.normalTextureTransform),i.occlusionTextureTransformMatrix=gm(e.occlusionTextureTransform),i.emissiveTextureTransformMatrix=gm(e.emissiveTextureTransform),i.metallicRoughnessTextureTransformMatrix=gm(e.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(e){const i=this._drivenProperties.color;let r=v(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(i)e.externalColor=ed;else{const s=v(this.symbolLayer.material)?this.symbolLayer.material.color:null;v(s)?e.externalColor=ot.toUnitRGBA(s):(r=null,e.externalColor=ed)}r&&(e.colorMixMode=r),e.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(e){const i=e.vertexAttributes.color;if(C(i))return!1;for(let r=3;r<i.length;r+=4)if(i[r]!==255)return!0;return!1}_getOrCreateMaterial(e,i){var y,_,b;const r=(y=i.material)==null?void 0:y.color,s=(_=i.material)==null?void 0:_.colorTexture,n=(b=i.material)==null?void 0:b.alphaMode,o=n==="blend",a=n!=="opaque"&&(this._hasTransparentVertexColors(e)||v(r)&&r.a<1||v(s)&&s.transparent||o),l=this._materialProperties(e,i,a),c=this._materials.get(l.uid);if(c)return c.material;const h={material:null,isComponentTransparent:a,alphaMode:i.material?i.material.alphaMode:"opaque"},p=l.metallicRoughnessTexture==null&&l.metallic==null&&l.roughness==null,f={usePBR:this._usePBR(),isSchematic:p,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:Ma,diffuse:_m,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:Or.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};p||(f.mrrFactors=[l.metallic!=null?l.metallic:1,l.roughness!=null?l.roughness:1,.5]),i.material&&(f.doubleSided=i.material.doubleSided,f.cullFace=i.material.doubleSided?Or.None:Or.Back,f.textureAlphaCutoff=i.material.alphaCutoff),this._setExternalMaterialParameters(f),this._setMaterialTransparentParameter(f,h),this._setInternalMaterialParameters(l,f);const m=new e0(f);return h.material=m,this._materials.set(l.uid,h),this._context.stage.add(m),m}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,i){e.transparent=this.needsDrivenTransparentPass||i.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,i.alphaMode==="auto"?e.textureAlphaMode=e.transparent?fr.MaskBlend:fr.Opaque:e.textureAlphaMode=i.alphaMode==="opaque"?fr.Opaque:i.alphaMode==="mask"?fr.Mask:fr.Blend}_addDebugNormals(e,i){const r=i.length,s=e.spatialReference.isGeographic?20015077/180:1,n=.1*Math.max(e.extent.width*s,e.extent.height*s,e.extent.zmax-e.extent.zmin),o=[],a=[],l=[],c=[];for(let m=0;m<r;m++){const y=i[m],_=y.vertexAttributes.get(A.POSITION),b=y.vertexAttributes.get(A.NORMAL),w=y.indices.get(A.POSITION),S=y.indices.get(A.NORMAL),T=_.data,E=b.data;for(let O=0;O<w.length;O++){const R=3*w[O],L=3*S[O];for(let P=0;P<3;P++)o.push(T[R+P]);for(let P=0;P<3;P++)o.push(T[R+P]+E[L+P]*n);if(a.push(a.length),a.push(a.length),O%3==0){this._calculateFaceNormal(T,w,O,n2),this._getFaceVertices(T,w,O,Jo,r2,s2),ve(Jo,Jo,r2),ve(Jo,Jo,s2),ue(Jo,Jo,1/3);for(let P=0;P<3;P++)l.push(Jo[P]);for(let P=0;P<3;P++)l.push(Jo[P]+n2[P]*n);c.push(c.length),c.push(c.length)}}}const h=i[0].transformation,p=new fn(this._debugVertexNormalMaterial,[[A.POSITION,new ht(o,3,!0)]],[[A.POSITION,a]],null,Vs.Line);i.push(p),p.transformation=h;const f=new fn(this._debugFaceNormalMaterial,[[A.POSITION,new ht(l,3,!0)]],[[A.POSITION,c]],null,Vs.Line);f.transformation=h,i.push(f)}_createAs3DShape(e,i,r,s){const n=e.geometry;if(n.type!=="mesh")return null;const o=this._createGeometryInfo(n,i,s);if(C(o))return null;const{geometries:a,objectTransformation:l}=o;Ji.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(n,a);const c=new v0({geometries:a,metadata:{layerUid:this._context.layer.uid,graphicUid:s}});c.transformation=l;const h=UAe(this.symbolLayer,{opacity:this._getLayerOpacity()}),p=v(h)?new rdt(a[0].material,[h],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,f=new og(this,c,a,null,null,xP,r,p);f.needsElevationUpdates=c1(r.mode),f.useObjectOriginAsAttachmentOrigin=!0,r.centerPointInElevationSR=this._getCenterPointInElevationSR(c);const{elevationProvider:m,renderCoordsHelper:y}=this._context,_=(b,w)=>CA(b,m,r,y,w);return f.alignedSampledElevation=xP(f,r,m.spatialReference,_,y),f}_getCenterPointInElevationSR(e){const i=_0(0,0,0,v(this._context.elevationProvider.spatialReference)?this._context.elevationProvider.spatialReference:null);return C_e([e.transformation[12],e.transformation[13],e.transformation[14]],this._context.renderCoordsHelper.spatialReference,i),i}_createComponentNormals(e,i,r,s){switch(r.shading||"flat"){default:case"source":return this._createComponentNormalsSource(e,i,r,s);case"flat":return this._createComponentNormalsFlat(e,s);case"smooth":return this._createComponentNormalsSmooth(e,s)}}_createComponentNormalsSource(e,i,r,s){if(C(i))return this._createComponentNormalsFlat(e,s);let n=!1;if(!r.trustSourceNormals)for(let o=0;o<s.length;o+=3){this._calculateFaceNormal(e,s,o,n2);for(let a=0;a<3;a++){const l=3*s[o+a];Jo[0]=i[l+0],Jo[1]=i[l+1],Jo[2]=i[l+2],Ae(n2,Jo)<0&&(i[l+0]=-i[l+0],i[l+1]=-i[l+1],i[l+2]=-i[l+2],n=!0)}}return new AB(i,s,n)}_createComponentNormalsFlat(e,i){const r=Qs(i.length),s=new Array(3*i.length);for(let n=0;n<i.length;n+=3){const o=this._calculateFaceNormal(e,i,n,n2);for(let a=0;a<3;a++)r[n+a]=o[a],s[n+a]=n/3}return new AB(r,s,!1)}_createComponentNormalsSmooth(e,i){const r={};for(let o=0;o<i.length;o+=3){const a=this._calculateFaceNormal(e,i,o,n2);for(let l=0;l<3;l++){const c=i[o+l];let h=r[c];h||(h={normal:M(),count:0},r[c]=h),ve(h.normal,h.normal,a),h.count++}}const s=Qs(3*i.length),n=new Array(3*i.length);for(let o=0;o<i.length;o++){const a=r[i[o]];a.count!==1&&(Oe(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)s[3*o+l]=a.normal[l];n[o]=o}return new AB(s,n,!1)}_getFaceVertices(e,i,r,s,n,o){const a=3*i[r+0],l=3*i[r+1],c=3*i[r+2];s[0]=e[a+0],s[1]=e[a+1],s[2]=e[a+2],n[0]=e[l+0],n[1]=e[l+1],n[2]=e[l+2],o[0]=e[c+0],o[1]=e[c+1],o[2]=e[c+2]}_calculateFaceNormal(e,i,r,s){return this._getFaceVertices(e,i,r,Jo,r2,s2),be(r2,r2,Jo),be(s2,s2,Jo),Et(Jo,r2,s2),Oe(s,Jo),s}_getOrCreateComponents(e){return Gt(e.components,Bgt)}_createPositionBuffer(e,i){let r=e.vertexAttributes.position;const s=i.reprojection===Ou.ECEF?i.transformBeforeProject:null;if(v(s)&&(r=Egt(r,new Float64Array(r.length),s)),i.reprojection===Ou.NONE)return i.needsBufferCopy?new Float64Array(r):r;const n=v(s)?r:new Float64Array(r.length);return Es(r,e.spatialReference,0,n,this._context.renderCoordsHelper.spatialReference,0,r.length/3),n}_createNormalBuffer(e,i,r){let s=e.vertexAttributes.normal;if(C(s))return null;const n=r.reprojection===Ou.ECEF?r.transformBeforeProject:null;if(v(n)&&(s=Cgt(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===Ou.NONE)return r.needsBufferCopy&&e.vertexAttributes.normal===s?new Float32Array(s):s;const o=e.vertexAttributes.position,a=v(n)?s:new Float32Array(s.length);return Sgt(s,o,i,e.spatialReference,a)}_createTangentBuffer(e,i,r){let s=e.vertexAttributes.tangent;if(C(s))return null;const n=r.reprojection===Ou.ECEF?r.transformBeforeProject:null;if(v(n)&&(s=Agt(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===Ou.NONE)return r.needsBufferCopy&&e.vertexAttributes.normal===s?new Float32Array(s):s;const o=e.vertexAttributes.position,a=v(n)?s:new Float32Array(s.length);return Ogt(s,o,i,e.spatialReference,a)}_createColorBuffer(e){return e.vertexAttributes.color}_createSymbolColorBuffer(e){if(this._requiresSymbolVertexColors()){const i=this._getVertexOpacityAndColor(e),r=Fft(In(this.symbolLayer,"material","colorMixMode")),s=new Uint8Array(4);return JOe(i,r,s),s}return null}_createBuffers(e,i){const r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const s=e.vertexAttributes.normal,n=e.vertexAttributes.uv,o=e.vertexAttributes.tangent;if(v(s)&&s.length!==r.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(v(o)&&o.length/4!=r.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(v(n)&&n.length/2!=r.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(e),l=this._createPositionBuffer(e,a),c=this._createColorBuffer(e),h=this._createSymbolColorBuffer(i),p=this._createNormalBuffer(e,l,a),f=this._createTangentBuffer(e,l,a);return{positionBuffer:l,normalBuffer:p,tangentBuffer:f,uvBuffer:n,colorBuffer:c,symbolColorBuffer:h,objectTransformation:a.reprojection===Ou.NONE&&v(a.objectTransformation)?a.objectTransformation:this._transformOriginLocal(e,l,p,f),geometryTransformation:a.reprojection===Ou.NONE&&v(a.geometryTransformation)?a.geometryTransformation:We()}}_computeReprojectionInfo(e){const i=v(e.transform),r=i&&e.transform.geographic||this._context.renderCoordsHelper.viewingMode===st.Local?Ou.NONE:Ou.ECEF;if(i){if(r===Ou.NONE){const n=We();return Jp(e.spatialReference,e.transform.origin,n,this._context.renderCoordsHelper.spatialReference),{reprojection:r,objectTransformation:n,geometryTransformation:hC(e.transform.localMatrix),needsBufferCopy:!1}}const s=gU(We(),e.transform.origin);return Ts(s,s,e.transform.localMatrix),{reprojection:r,transformBeforeProject:s,needsBufferCopy:!0}}return{reprojection:r,needsBufferCopy:!0}}_transformOriginLocal(e,i,r,s){const n=this._context.renderCoordsHelper.spatialReference,o=e.anchor;QL[0]=o.x,QL[1]=o.y,QL[2]=o.z;const a=We();Jp(e.spatialReference,QL,a,n);const l=Da.fromTypedArray(i);if(Go($ue,a),LI(l,l,$ue),v(r)||v(s)){if(bd(xO,a),wd(xO,xO),v(r)){const c=Lr.fromTypedArray(r);h1(c,c,xO)}if(v(s)){const c=Lr.fromTypedArray(s,4*s.BYTES_PER_ELEMENT);h1(c,c,xO)}}return a}_validateFaces(e,i){const r=e.vertexAttributes.position.length/3,s=i.faces;if(s){let n=-1;for(let o=0;o<s.length;o++){const a=s[o];a>n&&(n=a)}if(r<=n)return this.logger.warn(`Vertex index ${n} is out of bounds of the mesh position buffer`),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(e,i){return i.faces?i.faces:PC(e.vertexAttributes.position.length/3)}_isOutsideClippingArea(e){if(!this._context.clippingExtent)return!1;const i=e.vertexAttributes&&e.vertexAttributes.position;if(!i)return!1;const r=this._context.elevationProvider.spatialReference;let s;const n=i.length/3;return v(r)&&!e.spatialReference.equals(r)?(s=new Float64Array(i.length),Es(e.vertexAttributes.position,e.spatialReference,0,s,r,0,n)):s=i,$r(OB),Wu(OB,s,0,n),!Pp(OB,this._context.clippingExtent)}_createGeometryInfo(e,i,r){if(!jm(e.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;const s=this._createBuffers(e,i);if(C(s))return null;const{positionBuffer:n,uvBuffer:o,colorBuffer:a,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:h,objectTransformation:p,geometryTransformation:f}=s,m=this._getOrCreateComponents(e),y=new Array;let _=!1;for(const b of m){if(!this._validateFaces(e,b))return null;const w=this._getOrCreateFaces(e,b);if(w.length===0)continue;const S=this._createComponentNormals(n,c,b,w);S.didFlipNormals&&(_=!0);const T=[[A.POSITION,new ht(n,3,!0)],[A.NORMAL,new ht(S.normals,3,!0)]],E=[[A.POSITION,w],[A.NORMAL,S.indices]];v(a)&&(T.push([A.COLOR,new ht(a,4,!0)]),E.push([A.COLOR,w])),v(l)&&(T.push([A.SYMBOLCOLOR,new ht(l,4,!0)]),E.push([A.SYMBOLCOLOR,new Array(w.length).fill(0)])),v(o)&&(T.push([A.UV0,new ht(o,2,!0)]),E.push([A.UV0,w])),v(h)&&(T.push([A.TANGENT,new ht(h,4,!0)]),E.push([A.TANGENT,w]));const O=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:r,layerUid:this._context.layer.uid}),R=this._getOrCreateMaterial(e,b),L=new fn(R,T,E,null,Vs.Mesh,O);L.transformation=f,y.push(L)}return _&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:y,objectTransformation:p}}}let AB=class{constructor(e,i,r){this.normals=e,this.indices=i,this.didFlipNormals=r}};const QL=M(),Jo=M(),r2=M(),s2=M(),n2=M(),$ue=We(),xO=ls(),OB=Nn(),Bgt=[new Tgt];var Ou;(function(t){t[t.NONE=0]="NONE",t[t.ECEF=1]="ECEF"})(Ou||(Ou={}));let zgt=class{constructor(e,i,r,s){this.graphics3DSymbolLayer=e,this.instanceIndex=i,this.elevationAligner=r,this.elevationContext=s,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const i=this._lodRenderer.instanceData;e!==i.getVisible(this.instanceIndex)&&i.setVisible(this.instanceIndex,e)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,i,r){if(this.elevationAligner){dee(this.elevationContext.featureExpressionInfoContext,r);const s=(o,a)=>CA(o,e,this.elevationContext,i,a),n=this.elevationAligner(this,this.elevationContext,e.spatialReference,s,i);v(n)&&(this.alignedSampledElevation=n)}}getCenterObjectSpace(e=M()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Ef),ut(e,this._lodRenderer.baseBoundingSphere.center,Ef)}getBoundingBoxObjectSpace(e=Nn()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Ef);const i=this._lodRenderer.baseBoundingBox;$r(e);for(let r=0;r<8;++r)fe(ph,1&r?i[3]:i[0],2&r?i[4]:i[1],4&r?i[5]:i[2]),ut(ph,ph,Ef),zm(e,ph);return e}computeAttachmentOrigin(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Ef),e.render.origin[0]+=Ef[12],e.render.origin[1]+=Ef[13],e.render.origin[2]+=Ef[14],e.render.num++}async getProjectedBoundingBox(e,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=Ggt,l=$Z(o)?1:a.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Ef);for(let h=0;h<l;h++){const p=a[h];ph[0]=o[p[0]],ph[1]=o[p[1]],ph[2]=o[p[2]],ut(ph,ph,Ef),ib[3*h+0]=ph[0],ib[3*h+1]=ph[1],ib[3*h+2]=ph[2]}if(!e(ib,0,l))return null;$r(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],ib[h+p]),o[p+3]=Math.max(o[p+3],ib[h+p]);c&&r.push({location:ib.slice(h,h+3),screenSpaceBoundingRect:c})}if(i&&(Mp(o,RB),this.elevationContext.mode!=="absolute-height")){let h;const p=cee(o,i.service.spatialReference,i);try{h=await i.service.queryElevation(RB[0],RB[1],s,p,"ground")}catch{}v(h)&&Kye(o,0,0,-this.alignedSampledElevation+h)}return o}addObjectState(e,i){if(e===Zy.Highlight){const r=new E5(e);this._addHighlightId(r),i.addExternal(s=>{this._removeHighlightId(s)},r)}}removeObjectState(e){this._highlights.forEach(i=>e.remove(i))}_addHighlightId(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}};const ib=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ph=M(),RB=M(),Ggt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],Ef=We();function jgt(t){const e=new Array;return t.stageResources.geometries.forEach(i=>{const r=t.stageResources.textures;e.push(new DAe(i,r))}),{components:e,minScreenSpaceRadius:Gt(t.lodThreshold,0),pivotOffset:t.pivotOffset}}function Hgt(t){return{levels:t.map(e=>jgt(e))}}function qgt(t,e,i){if(t.count!==e.count)return void L8.error("source and destination buffers need to have the same number of elements");const r=t.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],p=i[7],f=i[8],m=i[9],y=i[10],_=i[11],b=i[12],w=i[13],S=i[14],T=i[15],E=t.typedBuffer,O=t.typedBufferStride,R=e.typedBuffer,L=e.typedBufferStride;for(let P=0;P<r;P++){const F=P*O,V=P*L,B=R[V],G=R[V+1],te=R[V+2],se=R[V+3];E[F]=s*B+l*G+f*te+b*se,E[F+1]=n*B+c*G+m*te+w*se,E[F+2]=o*B+h*G+y*te+S*se,E[F+3]=a*B+p*G+_*te+T*se}}function ORe(t,e,i){if(t.count!==e.count)return void L8.error("source and destination buffers need to have the same number of elements");const r=t.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],p=i[7],f=i[8],m=t.typedBuffer,y=t.typedBufferStride,_=e.typedBuffer,b=e.typedBufferStride;for(let w=0;w<r;w++){const S=w*y,T=w*b,E=_[T],O=_[T+1],R=_[T+2],L=_[T+3];m[S]=s*E+a*O+h*R,m[S+1]=n*E+l*O+p*R,m[S+2]=o*E+c*O+f*R,m[S+3]=L}}function Wgt(t,e){const i=Math.min(t.count,e.count),r=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<i;a++){const l=a*s,c=a*o,h=n[c],p=n[c+1],f=n[c+2],m=h*h+p*p+f*f;if(m>0){const y=1/Math.sqrt(m);r[l]=y*h,r[l+1]=y*p,r[l+2]=y*f}}}function dX(t,e,i){const r=Math.min(t.count,e.count),s=t.typedBuffer,n=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=i*o[h],s[c+1]=i*o[h+1],s[c+2]=i*o[h+2],s[c+3]=i*o[h+3]}}function Xgt(t,e,i){const r=Math.min(t.count,e.count),s=t.typedBuffer,n=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=o[h]>>i,s[c+1]=o[h+1]>>i,s[c+2]=o[h+2]>>i,s[c+3]=o[h+3]>>i}}Object.freeze(Object.defineProperty({__proto__:null,normalize:Wgt,scale:dX,shiftRight:Xgt,transformMat3:ORe,transformMat4:qgt},Symbol.toStringTag,{value:"Module"}));function Ygt(t,e,i){const r=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride,a=i?i.count:e.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h){for(let p=0;p<9;++p)r[l+p]=n[c+p];l+=s,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:Ygt},Symbol.toStringTag,{value:"Module"}));function Zgt(t,e,i){const r=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride,a=i?i.count:e.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h){for(let p=0;p<16;++p)r[l+p]=n[c+p];l+=s,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:Zgt},Symbol.toStringTag,{value:"Module"}));function Jgt(t,e,i){const r=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride,a=i?i.count:e.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],l+=s,c+=o}function PF(t,e){const i=t.count;e||(e=new t.TypedArrayConstructor(i));for(let r=0;r<i;r++)e[r]=t.get(r);return e}Object.freeze(Object.defineProperty({__proto__:null,copy:Jgt,makeDense:PF},Symbol.toStringTag,{value:"Module"}));function RRe(t,e,i){const r=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride,a=i?i.count:e.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],r[l+1]=n[c+1],l+=s,c+=o}function MRe(t,e,i){const r=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride,a=i?i.count:e.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;if(vrt(e.elementType)){const h=brt(e.elementType);if(_rt(e.elementType))for(let p=0;p<a;++p)r[l]=Math.max(n[c]/h,-1),r[l+1]=Math.max(n[c+1]/h,-1),l+=s,c+=o;else for(let p=0;p<a;++p)r[l]=n[c]/h,r[l+1]=n[c+1]/h,l+=s,c+=o}else RRe(t,e,i);return t}function Kgt(t,e,i,r){const s=t.typedBuffer,n=t.typedBufferStride,o=(r==null?void 0:r.count)??t.count;let a=((r==null?void 0:r.dstIndex)??0)*n;for(let l=0;l<o;++l)s[a]=e,s[a+1]=i,a+=n}Object.freeze(Object.defineProperty({__proto__:null,copy:RRe,fill:Kgt,normalizeIntegerBuffer:MRe},Symbol.toStringTag,{value:"Module"}));function H8(t,e,i){const r=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride,a=i?i.count:e.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],r[l+1]=n[c+1],r[l+2]=n[c+2],l+=s,c+=o}function Qgt(t,e,i,r,s){const n=t.typedBuffer,o=t.typedBufferStride,a=(s==null?void 0:s.count)??t.count;let l=((s==null?void 0:s.dstIndex)??0)*o;for(let c=0;c<a;++c)n[l]=e,n[l+1]=i,n[l+2]=r,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:H8,fill:Qgt},Symbol.toStringTag,{value:"Module"}));function PRe(t,e,i){const r=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride,a=i?i.count:e.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],r[l+1]=n[c+1],r[l+2]=n[c+2],r[l+3]=n[c+3],l+=s,c+=o}function IRe(t,e,i,r,s,n){const o=t.typedBuffer,a=t.typedBufferStride,l=(n==null?void 0:n.count)??t.count;let c=((n==null?void 0:n.dstIndex)??0)*a;for(let h=0;h<l;++h)o[c]=e,o[c+1]=i,o[c+2]=r,o[c+3]=s,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:PRe,fill:IRe},Symbol.toStringTag,{value:"Module"}));function Nw(t,e){return new t(new ArrayBuffer(e*t.ElementCount*OSe(t.ElementType)))}let $Re=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,i){return this._load("json",e,i)}async loadBinary(e,i){return Qm(e)?(gi(i),kZ(e)):this._load("binary",e,i)}async loadImage(e,i){return this._load("image",e,i)}async _load(e,i,r){if(C(this._streamDataRequester))return(await zr(i,{responseType:eyt[e]})).data;const s=await Kp(this._streamDataRequester.request(i,e,r));if(s.ok===!0)return s.value;throw zc(s.error),new W("",`Request for resource failed: ${s.error}`)}};const eyt={image:"image",binary:"array-buffer",json:"json"};function tyt(t={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...t}}function iyt(t,e={}){return{data:t,parameters:{wrap:{s:kt.REPEAT,t:kt.REPEAT,...e.wrap},noUnpackFlip:!0,mipmap:!1,...e}}}let kC=class{constructor(e,i,r=""){this.major=e,this.minor=i,this._context=r}lessThan(e,i){return this.major<e||e===this.major&&this.minor<i}since(e,i){return!this.lessThan(e,i)}validate(e){if(this.major!==e.major){const i=this._context&&this._context+":",r=this._context&&this._context+" ";throw new W(i+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new kC(this.major,this.minor,this._context)}static parse(e,i=""){const[r,s]=e.split("."),n=/^\s*\d+\s*$/;if(!r||!r.match||!r.match(n))throw new W((i&&i+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!s||!s.match||!s.match(n))throw new W((i&&i+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(r,10),a=parseInt(s,10);return new kC(o,a,i)}},Lue=class{constructor(e){this._data=e,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const e=this._offset4;return this._offset4+=1,this._dataUint32[e]}readUint8Array(e){const i=4*this._offset4;return this._offset4+=e/4,new Uint8Array(this._data,i,e)}remainingBytes(){return this._data.byteLength-4*this._offset4}};var p3,Due;(function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"})(p3||(p3={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(Due||(Due={}));const LRe={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},ryt={pbrMetallicRoughness:LRe,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},syt={ESRI_externalColorMixMode:"tint"},Nue=(t={})=>{const e={...LRe,...t.pbrMetallicRoughness},i=nyt({...syt,...t.extras});return{...ryt,...t,pbrMetallicRoughness:e,extras:i}};function nyt(t){switch(t.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:t.ESRI_externalColorMixMode,t.ESRI_externalColorMixMode="tint"}return t}const oyt={magFilter:gt.LINEAR,minFilter:gt.LINEAR_MIPMAP_LINEAR,wrapS:kt.REPEAT,wrapT:kt.REPEAT},ayt=t=>({...oyt,...t});function lyt(t){let e,i;return t.replace(/^(.*\/)?([^/]*)$/,(r,s,n)=>(e=s||"",i=n||"","")),{dirPart:e,filePart:i}}const eD={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};let cyt=class z_{constructor(e,i,r,s){if(this._context=e,this.uri=i,this.json=r,this._glbBuffer=s,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu"],this._baseUri=lyt(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),r.scenes==null)throw new W("gltf-loader-unsupported-feature","Scenes must be defined.");if(r.meshes==null)throw new W("gltf-loader-unsupported-feature","Meshes must be defined");if(r.nodes==null)throw new W("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(e,i,r){if(Qm(i)){const o=tI(i);if(o&&o.mediaType!=="model/gltf-binary")try{const l=JSON.parse(o.isBase64?atob(o.data):o.data);return new z_(e,i,l)}catch{}const a=kZ(i);if(z_._isGLBData(a))return this._fromGLBData(e,i,a)}if(i.endsWith(".gltf")){const o=await e.loadJSON(i,r);return new z_(e,i,o)}const s=await e.loadBinary(i,r);if(z_._isGLBData(s))return this._fromGLBData(e,i,s);const n=await e.loadJSON(i,r);return new z_(e,i,n)}static _isGLBData(e){if(e==null)return!1;const i=new Lue(e);return i.remainingBytes()>=4&&i.readUint32()===eD.MAGIC}static async _fromGLBData(e,i,r){const s=await z_._parseGLBData(r);return new z_(e,i,s.json,s.binaryData)}static async _parseGLBData(e){const i=new Lue(e);if(i.remainingBytes()<12)throw new W("gltf-loader-error","GLB binary data is insufficiently large.");const r=i.readUint32(),s=i.readUint32(),n=i.readUint32();if(r!==eD.MAGIC)throw new W("gltf-loader-error","Magic first 4 bytes do not fit to expected GLB value.");if(e.byteLength<n)throw new W("gltf-loader-error","GLB binary data is smaller than header specifies.");if(s!==2)throw new W("gltf-loader-unsupported-feature","An unsupported GLB container version was detected. Only version 2 is supported.");let o,a,l=0;for(;i.remainingBytes()>=8;){const c=i.readUint32(),h=i.readUint32();if(l===0){if(h!==eD.CHUNK_TYPE_JSON)throw new W("gltf-loader-error","First GLB chunk must be JSON.");if(c<0)throw new W("gltf-loader-error","No JSON data found.");o=await Mgt(i.readUint8Array(c))}else if(l===1){if(h!==eD.CHUNK_TYPE_BIN)throw new W("gltf-loader-unsupported-feature","Second GLB chunk expected to be BIN.");a=i.readUint8Array(c)}else oe.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 GLB chunks detected. Skipping.");l+=1}if(!o)throw new W("gltf-loader-error","No GLB JSON chunk detected.");return{json:o,binaryData:a}}async getBuffer(e,i){const r=this.json.buffers[e];if(r.uri==null){if(this._glbBuffer==null)throw new W("gltf-loader-error","GLB buffer not present");return this._glbBuffer}const s=await this._getBufferLoader(e,i);if(s.byteLength!==r.byteLength)throw new W("gltf-loader-error","Buffer byte lengths should match.");return s}async _getBufferLoader(e,i){const r=this._bufferLoaders.get(e);if(r)return r;const s=this.json.buffers[e].uri,n=this._context.loadBinary(this._resolveUri(s),i).then(o=>new Uint8Array(o));return this._bufferLoaders.set(e,n),n}async getAccessor(e,i){if(!this.json.accessors)throw new W("gltf-loader-unsupported-feature","Accessors missing.");const r=this.json.accessors[e];if((r==null?void 0:r.bufferView)==null)throw new W("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(r.type in[p3.MAT2,p3.MAT3,p3.MAT4])throw new W("gltf-loader-unsupported-feature",`AttributeType ${r.type} is not supported`);const s=this.json.bufferViews[r.bufferView],n=await this.getBuffer(s.buffer,i),o=dyt[r.type],a=pyt[r.componentType],l=o*a,c=s.byteStride||l;return{raw:n.buffer,byteStride:c,byteOffset:n.byteOffset+(s.byteOffset||0)+(r.byteOffset||0),entryCount:r.count,isDenselyPacked:c===l,componentCount:o,componentByteSize:a,componentType:r.componentType,min:r.min,max:r.max,normalized:!!r.normalized}}async getIndexData(e,i){if(e.indices==null)return;const r=await this.getAccessor(e.indices,i);if(r.isDenselyPacked)switch(r.componentType){case wt.UNSIGNED_BYTE:return new Uint8Array(r.raw,r.byteOffset,r.entryCount);case wt.UNSIGNED_SHORT:return new Uint16Array(r.raw,r.byteOffset,r.entryCount);case wt.UNSIGNED_INT:return new Uint32Array(r.raw,r.byteOffset,r.entryCount)}else switch(r.componentType){case wt.UNSIGNED_BYTE:return PF(this._wrapAccessor(MC,r));case wt.UNSIGNED_SHORT:return PF(this._wrapAccessor(l8,r));case wt.UNSIGNED_INT:return PF(this._wrapAccessor(u8,r))}}async getPositionData(e,i){if(e.attributes.POSITION==null)throw new W("gltf-loader-unsupported-feature","No POSITION vertex data found.");const r=await this.getAccessor(e.attributes.POSITION,i);if(r.componentType!==wt.FLOAT)throw new W("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+wt[r.componentType]);if(r.componentCount!==3)throw new W("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+r.componentCount.toFixed());return this._wrapAccessor(Lr,r)}async getNormalData(e,i){if(e.attributes.NORMAL==null)throw new W("gltf-loader-error","No NORMAL vertex data found.");const r=await this.getAccessor(e.attributes.NORMAL,i);if(r.componentType!==wt.FLOAT)throw new W("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+wt[r.componentType]);if(r.componentCount!==3)throw new W("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+r.componentCount.toFixed());return this._wrapAccessor(Lr,r)}async getTangentData(e,i){if(e.attributes.TANGENT==null)throw new W("gltf-loader-error","No TANGENT vertex data found.");const r=await this.getAccessor(e.attributes.TANGENT,i);if(r.componentType!==wt.FLOAT)throw new W("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+wt[r.componentType]);if(r.componentCount!==4)throw new W("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+r.componentCount.toFixed());return new iu(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*r.entryCount)}async getTextureCoordinates(e,i){if(e.attributes.TEXCOORD_0==null)throw new W("gltf-loader-error","No TEXCOORD_0 vertex data found.");const r=await this.getAccessor(e.attributes.TEXCOORD_0,i);if(r.componentCount!==2)throw new W("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+r.componentCount.toFixed());if(r.componentType===wt.FLOAT)return this._wrapAccessor(m0,r);if(!r.normalized)throw new W("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return fyt(r)}async getVertexColors(e,i){if(e.attributes.COLOR_0==null)throw new W("gltf-loader-error","No COLOR_0 vertex data found.");const r=await this.getAccessor(e.attributes.COLOR_0,i);if(r.componentCount!==4&&r.componentCount!==3)throw new W("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+r.componentCount.toFixed());if(r.componentCount===4){if(r.componentType===wt.FLOAT)return this._wrapAccessor(iu,r);if(r.componentType===wt.UNSIGNED_BYTE)return this._wrapAccessor(Na,r);if(r.componentType===wt.UNSIGNED_SHORT)return this._wrapAccessor(SI,r)}else if(r.componentCount===3){if(r.componentType===wt.FLOAT)return this._wrapAccessor(Lr,r);if(r.componentType===wt.UNSIGNED_BYTE)return this._wrapAccessor(hP,r);if(r.componentType===wt.UNSIGNED_SHORT)return this._wrapAccessor(c8,r)}throw new W("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+wt[r.componentType])}hasPositions(e){return e.attributes.POSITION!==void 0}hasNormals(e){return e.attributes.NORMAL!==void 0}hasVertexColors(e){return e.attributes.COLOR_0!==void 0}hasTextureCoordinates(e){return e.attributes.TEXCOORD_0!==void 0}hasTangents(e){return e.attributes.TANGENT!==void 0}async getMaterial(e,i,r){var n,o,a,l,c,h,p,f,m,y;let s=e.material?this._materialCache.get(e.material):void 0;if(!s){const _=e.material!=null?Nue(this.json.materials[e.material]):Nue(),b=_.pbrMetallicRoughness,w=this.hasVertexColors(e),S=this.getTexture(b.baseColorTexture,i),T=this.getTexture(_.normalTexture,i),E=r?this.getTexture(_.occlusionTexture,i):void 0,O=r?this.getTexture(_.emissiveTexture,i):void 0,R=r?this.getTexture(b.metallicRoughnessTexture,i):void 0,L=e.material!=null?e.material:-1;s={alphaMode:_.alphaMode,alphaCutoff:_.alphaCutoff,color:b.baseColorFactor,doubleSided:!!_.doubleSided,colorTexture:await S,normalTexture:await T,name:_.name,id:L,occlusionTexture:await E,emissiveTexture:await O,emissiveFactor:_.emissiveFactor,metallicFactor:b.metallicFactor,roughnessFactor:b.roughnessFactor,metallicRoughnessTexture:await R,hasVertexColors:w,ESRI_externalColorMixMode:_.extras.ESRI_externalColorMixMode,colorTextureTransform:(o=(n=b==null?void 0:b.baseColorTexture)==null?void 0:n.extensions)==null?void 0:o.KHR_texture_transform,normalTextureTransform:(l=(a=_.normalTexture)==null?void 0:a.extensions)==null?void 0:l.KHR_texture_transform,occlusionTextureTransform:(h=(c=_.occlusionTexture)==null?void 0:c.extensions)==null?void 0:h.KHR_texture_transform,emissiveTextureTransform:(f=(p=_.emissiveTexture)==null?void 0:p.extensions)==null?void 0:f.KHR_texture_transform,metallicRoughnessTextureTransform:(y=(m=b==null?void 0:b.metallicRoughnessTexture)==null?void 0:m.extensions)==null?void 0:y.KHR_texture_transform}}return s}async getTexture(e,i){if(!e)return;if((e.texCoord||0)!==0)throw new W("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const r=e.index,s=this.json.textures[r],n=ayt(s.sampler!=null?this.json.samplers[s.sampler]:{}),o=this._getTextureSourceId(s),a=this.json.images[o],l=await this._loadTextureImageData(r,s,i);return VY(this._textureCache,r,()=>{const c=p=>p===33071||p===33648||p===10497,h=p=>{throw new W("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${p}`)};return{data:l,wrapS:c(n.wrapS)?n.wrapS:h(n.wrapS),wrapT:c(n.wrapT)?n.wrapT:h(n.wrapT),minFilter:n.minFilter,name:a.name,id:r}})}getNodeTransform(e){if(e===void 0)return uyt;let i=this._nodeTransformCache.get(e);if(!i){const r=this.getNodeTransform(this._getNodeParent(e)),s=this.json.nodes[e];s.matrix?i=Ts(We(),r,s.matrix):s.translation||s.rotation||s.scale?(i=hC(r),s.translation&&hc(i,i,s.translation),s.rotation&&(tD[3]=_Q(tD,s.rotation),Wc(i,i,tD[3],tD)),s.scale&&fU(i,i,s.scale)):i=hC(r),this._nodeTransformCache.set(e,i)}return i}_wrapAccessor(e,i){return new e(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*(i.entryCount-1)+i.componentByteSize*i.componentCount)}_resolveUri(e){return Gu(e,this._baseUri)}_getNodeParent(e){return this._nodeParentMap.get(e)}_checkVersionSupported(){const e=kC.parse(this.json.asset.version,"glTF");hyt.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json;if(e.extensionsRequired&&!e.extensionsRequired.every(i=>this._supportedExtensions.includes(i)))throw new W("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((e,i)=>{e.children&&e.children.forEach(r=>{this._nodeParentMap.set(r,i)})})}async _loadTextureImageData(e,i,r){const s=this._textureLoaders.get(e);if(s)return s;const n=this._createTextureLoader(i,r);return this._textureLoaders.set(e,n),n}_getTextureSourceId(e){if(e.extensions!==void 0&&e.extensions.KHR_texture_basisu!==null)return e.extensions.KHR_texture_basisu.source;if(e.source!==null)return e.source;throw new W("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}async _createTextureLoader(e,i){const r=this._getTextureSourceId(e),s=this.json.images[r];if(s.uri){if(s.uri.endsWith(".ktx2")){const l=await this._context.loadBinary(this._resolveUri(s.uri),i);return new ERe(new Uint8Array(l))}return this._context.loadImage(this._resolveUri(s.uri),i)}if(s.bufferView==null)throw new W("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(s.mimeType==null)throw new W("gltf-loader-unsupported-feature","Image mimeType must be defined.");const n=this.json.bufferViews[s.bufferView],o=await this.getBuffer(n.buffer,i);if(n.byteStride!=null)throw new W("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const a=o.byteOffset+(n.byteOffset||0);return Pgt(new Uint8Array(o.buffer,a,n.byteLength),s.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const e=await Kz(Array.from(this._bufferLoaders.values())),i=await Kz(Array.from(this._textureLoaders.values()));return e.reduce((r,s)=>r+((s==null?void 0:s.byteLength)??0),0)+i.reduce((r,s)=>r+(s?mx(s)?s.data.byteLength:s.width*s.height*4:0),0)}};const uyt=l_e(We(),Math.PI/2),hyt=new kC(2,0,"glTF"),tD=Cd(),dyt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},pyt={[wt.BYTE]:1,[wt.UNSIGNED_BYTE]:1,[wt.SHORT]:2,[wt.UNSIGNED_SHORT]:2,[wt.FLOAT]:4,[wt.UNSIGNED_INT]:4};function fyt(t){switch(t.componentType){case wt.BYTE:return new h8(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case wt.UNSIGNED_BYTE:return new a8(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case wt.SHORT:return new d8(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case wt.UNSIGNED_SHORT:return new fQ(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case wt.UNSIGNED_INT:return new mQ(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case wt.FLOAT:return new m0(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount)}}let myt=0;async function DRe(t,e,i={},r=!0){const s=await cyt.load(t,e,i),n="gltf_"+myt++,o={lods:[],materials:new Map,textures:new Map,meta:gyt(s)},a=!(!s.json.asset.extras||s.json.asset.extras.ESRI_type!=="symbolResource"),l=new Map;await yyt(s,async(h,p,f,m)=>{const y=l.get(f)??0;l.set(f,y+1);const _=h.mode!==void 0?h.mode:jt.TRIANGLES,b=_===jt.TRIANGLES||_===jt.TRIANGLE_STRIP||_===jt.TRIANGLE_FAN?_:null;if(C(b))return void oe.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+jt[_]+"). Skipping primitive.");if(!s.hasPositions(h))return void oe.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const w=s.getPositionData(h,i),S=s.getMaterial(h,i,r),T=s.hasNormals(h)?s.getNormalData(h,i):null,E=s.hasTangents(h)?s.getTangentData(h,i):null,O=s.hasTextureCoordinates(h)?s.getTextureCoordinates(h,i):null,R=s.hasVertexColors(h)?s.getVertexColors(h,i):null,L=s.getIndexData(h,i),P={transform:hC(p),attributes:{position:await w,normal:T?await T:null,texCoord0:O?await O:null,color:R?await R:null,tangent:E?await E:null},indices:await L,primitiveType:b,material:vyt(o,await S,n)};let F=null;v(o.meta)&&v(o.meta.ESRI_lod)&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(F=o.meta.ESRI_lod.thresholds[f]),o.lods[f]=o.lods[f]||{parts:[],name:m,lodThreshold:F},o.lods[f].parts[y]=P});for(const h of o.lods)h.parts=h.parts.filter(p=>!!p);const c=await s.getLoadedBuffersSize();return{model:o,meta:{isEsriSymbolResource:a,uri:s.uri},customMeta:{},size:c}}function gyt(t){const e=t.json;let i=null;return e.nodes.forEach(r=>{const s=r.extras;v(s)&&(s.ESRI_proxyEllipsoid||s.ESRI_lod)&&(i=s)}),i}async function yyt(t,e){const i=t.json,r=i.scenes[i.scene||0].nodes,s=r.length>1,n=[];for(const a of r){const l=i.nodes[a];n.push(o(a,0)),_yt(l)&&!s&&l.extensions.MSFT_lod.ids.forEach((c,h)=>o(c,h+1))}async function o(a,l){const c=i.nodes[a],h=t.getNodeTransform(a);if(c.weights!=null&&oe.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),c.mesh!=null){const p=i.meshes[c.mesh];for(const f of p.primitives)n.push(e(f,h,l,p.name))}for(const p of c.children||[])n.push(o(p,l))}await Promise.all(n)}function _yt(t){return t.extensions&&t.extensions.MSFT_lod&&Array.isArray(t.extensions.MSFT_lod.ids)}function vyt(t,e,i){const r=n=>{const o=`${i}_tex_${n&&n.id}${n&&n.name?"_"+n.name:""}`;if(n&&!t.textures.has(o)){const a=iyt(n.data,{wrap:{s:n.wrapS,t:n.wrapT},mipmap:byt.includes(n.minFilter),noUnpackFlip:!0});t.textures.set(o,a)}return o},s=`${i}_mat_${e.id}_${e.name}`;if(!t.materials.has(s)){const n=tyt({color:[e.color[0],e.color[1],e.color[2]],opacity:e.color[3],alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,colorMixMode:e.ESRI_externalColorMixMode,textureColor:e.colorTexture?r(e.colorTexture):void 0,textureNormal:e.normalTexture?r(e.normalTexture):void 0,textureOcclusion:e.occlusionTexture?r(e.occlusionTexture):void 0,textureEmissive:e.emissiveTexture?r(e.emissiveTexture):void 0,textureMetallicRoughness:e.metallicRoughnessTexture?r(e.metallicRoughnessTexture):void 0,emissiveFactor:[e.emissiveFactor[0],e.emissiveFactor[1],e.emissiveFactor[2]],colorTextureTransform:e.colorTextureTransform,normalTextureTransform:e.normalTextureTransform,occlusionTextureTransform:e.occlusionTextureTransform,emissiveTextureTransform:e.emissiveTextureTransform,metallicRoughnessTextureTransform:e.metallicRoughnessTextureTransform,metallicFactor:e.metallicFactor,roughnessFactor:e.roughnessFactor});t.materials.set(s,n)}return s}const byt=[gt.LINEAR_MIPMAP_LINEAR,gt.LINEAR_MIPMAP_NEAREST];function wyt(t,e=PC){return typeof t=="number"?e(t):RY(t)||xw(t)?new Uint32Array(t):t}function xyt(t){const e=typeof t=="number"?t:t.length;if(e<3)return[];const i=e-2,r=LSe(i);if(typeof t=="number"){let s=0;for(let n=0;n<i;n+=1)n%2==0?(r[s++]=n,r[s++]=n+1,r[s++]=n+2):(r[s++]=n+1,r[s++]=n,r[s++]=n+2)}else{let s=0;for(let n=0;n<i;n+=1)if(n%2==0){const o=t[n],a=t[n+1],l=t[n+2];r[s++]=o,r[s++]=a,r[s++]=l}else{const o=t[n+1],a=t[n],l=t[n+2];r[s++]=o,r[s++]=a,r[s++]=l}}return r}function Tyt(t){const e=typeof t=="number"?t:t.length;if(e<3)return new Uint16Array(0);const i=e-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if(typeof t=="number"){let s=0;for(let n=0;n<i;++n)r[s++]=0,r[s++]=n+1,r[s++]=n+2;return r}{const s=t[0];let n=t[1],o=0;for(let a=0;a<i;++a){const l=t[a+2];r[o++]=s,r[o++]=n,r[o++]=l,n=l}return r}}let Syt=class{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}},Eyt=class{constructor(e,i,r){this.name=e,this.lodThreshold=i,this.pivotOffset=r,this.stageResources=new Syt,this.numberOfVertices=0}};const Kg=oe.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function NRe(t,e){const i=await Cyt(t,e),r=await Pyt(i.textureDefinitions??{},e);let s=0;for(const n in r)if(r.hasOwnProperty(n)){const o=r[n];s+=o!=null&&o.image?o.image.width*o.image.height*4:0}return{resource:i,textures:r,size:s+z_e(i)}}async function Cyt(t,e){const i=v(e)&&e.streamDataRequester;if(i)return Ayt(t,i,e);const r=await Kp(zr(t,e));if(r.ok===!0)return r.value.data;zc(r.error),FRe(r.error)}async function Ayt(t,e,i){const r=await Kp(e.request(t,"json",i));if(r.ok===!0)return r.value;zc(r.error),FRe(r.error.details.url)}function FRe(t){throw new W("",`Request for object resource failed: ${t}`)}function Oyt(t){const e=t.params,i=e.topology;let r=!0;switch(e.vertexAttributes||(Kg.warn("Geometry must specify vertex attributes"),r=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=e.faces;if(n){if(e.vertexAttributes)for(const o in e.vertexAttributes){const a=n[o];a&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(Kg.warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),r=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(Kg.warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),r=!1)):(Kg.warn(`Indexed geometry does not specify face indices for '${o}' attribute`),r=!1)}}else Kg.warn("Indexed geometries must specify faces"),r=!1;break}default:Kg.warn(`Unsupported topology '${i}'`),r=!1}t.params.material||(Kg.warn("Geometry requires material"),r=!1);const s=t.params.vertexAttributes;for(const n in s)s[n].values||(Kg.warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function Ryt(t,e){const i=new Array,r=new Array,s=new Array,n=new _A,o=t.resource,a=kC.parse(o.version||"1.0","wosr");$yt.validate(a);const l=o.model.name,c=o.model.geometries,h=o.materialDefinitions??{},p=t.textures;let f=0;const m=new Map;for(let y=0;y<c.length;y++){const _=c[y];if(!Oyt(_))continue;const b=Iyt(_),w=_.params.vertexAttributes,S=[];for(const B in w){const G=w[B],te=G.values;S.push([B,new ht(te,G.valuesPerElement,!0)])}const T=[];if(_.params.topology!=="PerAttributeArray"){const B=_.params.faces;for(const G in B)T.push([G,B[G].values])}const E=b.texture,O=p&&p[E];if(O&&!m.has(E)){const{image:B,params:G}=O,te=new _T(B,G);r.push(te),m.set(E,te)}const R=m.get(E),L=R?R.id:void 0,P=b.material;let F=n.get(P,E);if(C(F)){const B=h[P.substring(P.lastIndexOf("/")+1)].params;B.transparency===1&&(B.transparency=0);const G=O&&O.alphaChannelUsage,te=B.transparency>0||G==="transparency"||G==="maskAndTransparency",se=O?URe(O.alphaChannelUsage):void 0,ie={ambient:Kl(B.diffuse),diffuse:Kl(B.diffuse),opacity:1-(B.transparency||0),transparent:te,textureAlphaMode:se,textureAlphaCutoff:.33,textureId:L,initTextureTransparent:!0,doubleSided:!0,cullFace:Or.None,colorMixMode:B.externalColorMixMode||"tint",textureAlphaPremultiplied:!!O&&!!O.params.preMultiplyAlpha};v(e)&&e.materialParamsMixin&&Object.assign(ie,e.materialParamsMixin),F=new e0(ie),n.set(P,E,F)}s.push(F);const V=new fn(F,S,T);f+=T.position?T.position.length:0,i.push(V)}return{engineResources:[{name:l,stageResources:{textures:r,materials:s,geometries:i},pivotOffset:o.model.pivotOffset,numberOfVertices:f,lodThreshold:null}],referenceBoundingBox:Myt(i)}}function Myt(t){const e=$r();return t.forEach(i=>{const r=i.boundingInfo;v(r)&&(zm(e,r.bbMin),zm(e,r.bbMax))}),e}async function Pyt(t,e){const i=[];for(const n in t){const o=t[n],a=o.images[0].data;if(!a){Kg.warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+n,h=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",p={noUnpackFlip:!0,wrap:{s:kt.REPEAT,t:kt.REPEAT},preMultiplyAlpha:URe(h)!==fr.Opaque},f=v(e)&&e.disableTextures?Promise.resolve(null):Ky(l,e);i.push(f.then(m=>({refId:c,image:m,params:p,alphaChannelUsage:h})))}const r=await Promise.all(i),s={};for(const n of r)s[n.refId]=n;return s}function URe(t){switch(t){case"mask":return fr.Mask;case"maskAndTransparency":return fr.MaskBlend;case"none":return fr.Opaque;default:return fr.Blend}}function Iyt(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const $yt=new kC(1,2,"wosr"),o2=2.1;async function VRe(t,e){const i=kRe(WKe(t));if(i.fileType==="wosr"){const p=await(e.cache?e.cache.loadWOSR(i.url,e):NRe(i.url,e)),{engineResources:f,referenceBoundingBox:m}=Ryt(p,e);return{lods:f,referenceBoundingBox:m,isEsriSymbolResource:!1,isWosr:!0}}const r=await(e.cache?e.cache.loadGLTF(i.url,e,!!e.usePBR):DRe(new $Re(e.streamDataRequester),i.url,e,e.usePBR)),s=In(r.model.meta,"ESRI_proxyEllipsoid"),n=r.meta.isEsriSymbolResource&&v(s)&&r.meta.uri.includes("/RealisticTrees/");n&&!r.customMeta.esriTreeRendering&&(r.customMeta.esriTreeRendering=!0,Uyt(r,s));const o=!!e.usePBR,a=r.meta.isEsriSymbolResource?{usePBR:o,isSchematic:!1,treeRendering:n,mrrFactors:[0,1,.2]}:{usePBR:o,isSchematic:!1,treeRendering:!1,mrrFactors:[0,1,.5]},l={...e.materialParamsMixin,treeRendering:n},{engineResources:c,referenceBoundingBox:h}=BRe(r,a,l,e.skipHighLods&&i.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:i.specifiedLodIndex});return{lods:c,referenceBoundingBox:h,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1}}function kRe(t){const e=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return e?{fileType:"gltf",url:e[1],specifiedLodIndex:e[4]!=null?Number(e[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}function BRe(t,e,i,r){const s=t.model,n=new Array,o=new Map,a=new Map,l=s.lods.length,c=$r();return s.lods.forEach((h,p)=>{const f=r.skipHighLods===!0&&(l>1&&p===0||l>3&&p===1)||r.skipHighLods===!1&&r.singleLodIndex!=null&&p!==r.singleLodIndex;if(f&&p!==0)return;const m=new Eyt(h.name,h.lodThreshold,[0,0,0]);h.parts.forEach(y=>{const _=f?new e0({}):Lyt(s,y,m,e,i,o,a),{geometry:b,vertexCount:w}=Dyt(y,v(_)?_:new e0({})),S=b.boundingInfo;v(S)&&p===0&&(zm(c,S.bbMin),zm(c,S.bbMax)),v(_)&&(m.stageResources.geometries.push(b),m.numberOfVertices+=w)}),f||n.push(m)}),{engineResources:n,referenceBoundingBox:c}}function Lyt(t,e,i,r,s,n,o){const a=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),l=t.materials.get(e.material),c=v(e.attributes.texCoord0),h=v(e.attributes.normal);if(C(l))return null;const p=Nyt(l.alphaMode);if(!n.has(a)){if(c){const E=(O,R=!1)=>{if(v(O)&&!o.has(O)){const L=t.textures.get(O);if(v(L)){const P=L.data;o.set(O,new _T(mx(P)?P.data:P,{...L.parameters,preMultiplyAlpha:!mx(P)&&R,encoding:mx(P)&&v(P.encoding)?P.encoding:void 0}))}}};E(l.textureColor,p!==fr.Opaque),E(l.textureNormal),E(l.textureOcclusion),E(l.textureEmissive),E(l.textureMetallicRoughness)}const m=l.color[0]**(1/o2),y=l.color[1]**(1/o2),_=l.color[2]**(1/o2),b=l.emissiveFactor[0]**(1/o2),w=l.emissiveFactor[1]**(1/o2),S=l.emissiveFactor[2]**(1/o2),T=v(l.textureColor)&&c?o.get(l.textureColor):null;n.set(a,new e0({...r,transparent:p===fr.Blend,customDepthTest:Bx.Lequal,textureAlphaMode:p,textureAlphaCutoff:l.alphaCutoff,diffuse:[m,y,_],ambient:[m,y,_],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",cullFace:l.doubleSided?Or.None:Or.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normalType:h?lr.Attribute:lr.ScreenDerivative,castShadows:!0,receiveSSAO:!0,textureId:v(T)?T.id:void 0,colorMixMode:l.colorMixMode,normalTextureId:v(l.textureNormal)&&c?o.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:v(T)&&!!T.params.preMultiplyAlpha,occlusionTextureId:v(l.textureOcclusion)&&c?o.get(l.textureOcclusion).id:void 0,emissiveTextureId:v(l.textureEmissive)&&c?o.get(l.textureEmissive).id:void 0,metallicRoughnessTextureId:v(l.textureMetallicRoughness)&&c?o.get(l.textureMetallicRoughness).id:void 0,emissiveFactor:[b,w,S],mrrFactors:[l.metallicFactor,l.roughnessFactor,r.mrrFactors[2]],isSchematic:!1,colorTextureTransformMatrix:gm(l.colorTextureTransform),normalTextureTransformMatrix:gm(l.normalTextureTransform),occlusionTextureTransformMatrix:gm(l.occlusionTextureTransform),emissiveTextureTransformMatrix:gm(l.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:gm(l.metallicRoughnessTextureTransform),...s}))}const f=n.get(a);if(i.stageResources.materials.push(f),c){const m=y=>{v(y)&&i.stageResources.textures.push(o.get(y))};m(l.textureColor),m(l.textureNormal),m(l.textureOcclusion),m(l.textureEmissive),m(l.textureMetallicRoughness)}return f}function Dyt(t,e){const i=t.attributes.position.count,r=Fyt(t.indices||i,t.primitiveType),s=Nw(Lr,i);LI(s,t.attributes.position,t.transform);const n=[[A.POSITION,new ht(s.typedBuffer,s.elementCount,!0)]],o=[[A.POSITION,r]];if(v(t.attributes.normal)){const a=Nw(Lr,i);RC(iD,t.transform),h1(a,t.attributes.normal,iD),n.push([A.NORMAL,new ht(a.typedBuffer,a.elementCount,!0)]),o.push([A.NORMAL,r])}if(v(t.attributes.tangent)){const a=Nw(iu,i);RC(iD,t.transform),ORe(a,t.attributes.tangent,iD),n.push([A.TANGENT,new ht(a.typedBuffer,a.elementCount,!0)]),o.push([A.TANGENT,r])}if(v(t.attributes.texCoord0)){const a=Nw(m0,i);MRe(a,t.attributes.texCoord0),n.push([A.UV0,new ht(a.typedBuffer,a.elementCount,!0)]),o.push([A.UV0,r])}if(v(t.attributes.color)){const a=Nw(Na,i);if(t.attributes.color.elementCount===4)t.attributes.color instanceof iu?dX(a,t.attributes.color,255):t.attributes.color instanceof Na?PRe(a,t.attributes.color):t.attributes.color instanceof SI&&dX(a,t.attributes.color,1/256);else{IRe(a,255,255,255,255);const l=new hP(a.buffer,0,4);t.attributes.color instanceof Lr?JW(l,t.attributes.color,255):t.attributes.color instanceof hP?H8(l,t.attributes.color):t.attributes.color instanceof c8&&JW(l,t.attributes.color,1/256)}n.push([A.COLOR,new ht(a.typedBuffer,a.elementCount,!0)]),o.push([A.COLOR,r])}return{geometry:new fn(e,n,o),vertexCount:i}}const iD=ls();function Nyt(t){switch(t){case"BLEND":return fr.Blend;case"MASK":return fr.Mask;case"OPAQUE":case null:case void 0:return fr.Opaque}}function Fyt(t,e){switch(e){case jt.TRIANGLES:return wyt(t);case jt.TRIANGLE_STRIP:return xyt(t);case jt.TRIANGLE_FAN:return Tyt(t)}}function Uyt(t,e){for(let i=0;i<t.model.lods.length;++i){const r=t.model.lods[i];for(const s of r.parts){const n=s.attributes.normal;if(C(n))return;const o=s.attributes.position,a=o.count,l=M(),c=M(),h=M(),p=Nw(Na,a),f=Nw(Lr,a),m=Go(We(),s.transform);for(let y=0;y<a;y++){o.getVec(y,c),n.getVec(y,l),ut(c,c,s.transform),be(h,c,e.center),g4(h,h,e.radius);const _=h[2],b=je(h),w=Math.min(.45+.55*b*b,1);g4(h,h,e.radius),m!==null&&ut(h,h,m),Oe(h,h),i+1!==t.model.lods.length&&t.model.lods.length>1&&tn(h,h,l,_>-1?.2:Math.min(-4*_-3.8,1)),f.setVec(y,h),p.set(y,0,255*w),p.set(y,1,255*w),p.set(y,2,255*w),p.set(y,3,255)}s.attributes.normal=f,s.attributes.color=p}}}const sUt=Object.freeze(Object.defineProperty({__proto__:null,fetch:VRe,gltfToEngineResources:BRe,parseUrl:kRe},Symbol.toStringTag,{value:"Module"}));var Hr;function Vyt(t){let e=cs().mat4f64(A.LOCALTRANSFORM).mat4f64(A.GLOBALTRANSFORM).vec4f64(A.BOUNDINGSPHERE).vec3f64(A.MODELORIGIN).mat3f(A.MODEL).mat3f(A.MODELNORMAL).vec2f(A.MODELSCALEFACTORS);return t.includes("color")&&(e=e.vec4f(A.COLOR)),t.includes("featureAttribute")&&(e=e.vec4f(A.FEATUREATTRIBUTE)),e=e.u8(A.STATE).u8(A.LODLEVEL),t.includes(A.OBJECTANDLAYERIDCOLOR)&&(e=e.vec4u8(A.OBJECTANDLAYERIDCOLOR)),e.alignTo(8),e}(function(t){t[t.ALLOCATED=1]="ALLOCATED",t[t.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",t[t.VISIBLE=4]="VISIBLE",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",t[t.REMOVE=32]="REMOVE",t[t.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",t[t.ACTIVE=18]="ACTIVE"})(Hr||(Hr={}));let kyt=class{constructor(e){this.localTransform=e.getField(A.LOCALTRANSFORM,uP),this.globalTransform=e.getField(A.GLOBALTRANSFORM,uP),this.modelOrigin=e.getField(A.MODELORIGIN,Da),this.model=e.getField(A.MODEL,n1),this.modelNormal=e.getField(A.MODELNORMAL,n1),this.modelScaleFactors=e.getField(A.MODELSCALEFACTORS,m0),this.boundingSphere=e.getField(A.BOUNDINGSPHERE,o8),this.color=e.getField(A.COLOR,iu),this.featureAttribute=e.getField(A.FEATUREATTRIBUTE,iu),this.state=e.getField(A.STATE,MC),this.lodLevel=e.getField(A.LODLEVEL,MC),this.objectAndLayerIdColor=e.getField(A.OBJECTANDLAYERIDCOLOR,Na)}},CS=class extends $e{constructor(e,i){super(e),this.events=new As,this._capacity=0,this._size=0,this._next=0,this._buffer=null,this._view=null,this._layout=Vyt(i)}get capacity(){return this._capacity}get size(){return this._size}get buffer(){return this._buffer.buffer}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,Hr.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const i=this._view.state;Ct(e>=0&&e<this._capacity&&(i.get(e)&Hr.ALLOCATED)!=0,"invalid instance handle"),this._getStateFlag(e,Hr.ACTIVE)?this._setStateFlags(e,Hr.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const i=this._view.state;Ct(e>=0&&e<this._capacity&&(i.get(e)&Hr.ALLOCATED)!=0,"invalid instance handle"),i.set(e,0),this._size--}setLocalTransform(e,i,r=!0){this._view.localTransform.setMat(e,i),r&&this.updateModelTransform(e)}getLocalTransform(e,i){this._view.localTransform.getMat(e,i)}setGlobalTransform(e,i,r=!0){this._view.globalTransform.setMat(e,i),r&&this.updateModelTransform(e)}getGlobalTransform(e,i){this._view.globalTransform.getMat(e,i)}updateModelTransform(e){const i=this._view,r=Y0,s=Ud;i.localTransform.getMat(e,Fue),i.globalTransform.getMat(e,MB);const n=Ts(MB,MB,Fue);fe(r,n[12],n[13],n[14]),i.modelOrigin.setVec(e,r),bd(s,n),i.model.setMat(e,s);const o=dke(Y0,n);o.sort(),i.modelScaleFactors.set(e,0,o[1]),i.modelScaleFactors.set(e,1,o[2]),mT(s,s),wd(s,s),i.modelNormal.setMat(e,s),this._setStateFlags(e,Hr.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,i){const r=this._view;r.model.getMat(e,Ud),r.modelOrigin.getVec(e,Y0),i[0]=Ud[0],i[1]=Ud[1],i[2]=Ud[2],i[3]=0,i[4]=Ud[3],i[5]=Ud[4],i[6]=Ud[5],i[7]=0,i[8]=Ud[6],i[9]=Ud[7],i[10]=Ud[8],i[11]=0,i[12]=Y0[0],i[13]=Y0[1],i[14]=Y0[2],i[15]=1}applyShaderTransformation(e,i){v(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,e,i)}getCombinedModelTransform(e,i){return this.getModelTransform(e,i),v(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,e,i),i}getCombinedLocalTransform(e,i){return this._view.localTransform.getMat(e,i),v(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,e,i),i}getCombinedMaxScaleFactor(e){let i=this._view.modelScaleFactors.get(e,1);if(v(this.shaderTransformation)){const r=this.shaderTransformation.scaleFactor(Y0,this,e);i*=Math.max(r[0],r[1],r[2])}return i}getCombinedMedianScaleFactor(e){let i=this._view.modelScaleFactors.get(e,0);if(v(this.shaderTransformation)){const r=this.shaderTransformation.scaleFactor(Y0,this,e);i*=Byt(r[0],r[1],r[2])}return i}getModel(e,i){this._view.model.getMat(e,i)}setFeatureAttribute(e,i){this._view.featureAttribute.setVec(e,i)}getFeatureAttribute(e,i){this._view.featureAttribute.getVec(e,i)}setColor(e,i){this._view.color.setVec(e,i)}setObjectAndLayerIdColor(e,i){this._view.objectAndLayerIdColor.setVec(e,i)}getColor(e,i){this._view.color.getVec(e,i)}setVisible(e,i){i!==this.getVisible(e)&&(this._setStateFlag(e,Hr.VISIBLE,i),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,Hr.VISIBLE)}setHighlight(e,i){i!==this.getHighlight(e)&&(this._setStateFlag(e,Hr.HIGHLIGHT,i),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,Hr.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let i=0;for(let r=0;r<this._capacity;++r)this.getState(r)&e&&++i;return i}_setStateFlags(e,i){const r=this._view.state;i=r.get(e)|i,r.set(e,i)}_clearStateFlags(e,i){const r=this._view.state;i=r.get(e)&~i,r.set(e,i)}_setStateFlag(e,i,r){r?this._setStateFlags(e,i):this._clearStateFlags(e,i)}_getStateFlag(e,i){return!!(this._view.state.get(e)&i)}_grow(){const e=Math.max(zyt,Math.floor(this._capacity*Gyt)),i=this._layout.createBuffer(e);if(this._buffer){const r=new Uint8Array(this._buffer.buffer);new Uint8Array(i.buffer).set(r)}this._capacity=e,this._buffer=i,this._view=new kyt(this._buffer)}_findSlot(){const e=this._view.state;let i=this._next;for(;e.get(i)&Hr.ALLOCATED;)i=i+1===this._capacity?0:i+1;return this._next=i+1===this._capacity?0:i+1,i}};function Byt(t,e,i){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),i))}u([d({constructOnly:!0})],CS.prototype,"shaderTransformation",void 0),u([d()],CS.prototype,"_size",void 0),u([d({readOnly:!0})],CS.prototype,"size",null),CS=u([I("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],CS);const zyt=1024,Gyt=2,Y0=M(),Ud=ls(),Fue=We(),MB=We();let jyt=class extends Np{constructor(e,i){super(r=>this._instanceData.view.boundingSphere.getVec(r,this._tmpSphere),{maximumDepth:25}),this._tmpSphere=gn(),this._tmpMat4=We(),this._instanceData=e,this._boundingSphere=i}addInstance(e){const i=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);ut(this._tmpSphere,this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*Lx(r),i.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}},Hyt=class{constructor(e,i){this._worldSpaceRadius=e,this._minScreenSpaceRadii=i}selectLevel(e,i,r){const s=r.computeScreenPixelSizeAt(e),n=this._worldSpaceRadius*i/s;let o=0;for(let a=1;a<this._minScreenSpaceRadii.length;++a)n>=this._minScreenSpaceRadii[a]&&(o=a);return o}},qyt=class extends p8{constructor(e,i,r,s,n,o){super(e,i),this.layerUid=e,this.graphicUid=i,this.geometryId=r,this.triangleNr=s,this.baseBoundingSphere=n,this.numLodLevels=o}};function Fee(t){return lf(t)&&t.intersector===as.LOD&&!!t.target}let Wyt=class{constructor(e,i){const r=e.renderContext.rctx,s=i.geometry;this._materialRepository=e.materialRepository,s.material.setParameters({instancedDoublePrecision:!0});const n=s.material.createBufferWriter(),o=n.vertexBufferLayout,a=n.elementCount(s),l=n.allocate(a);n.write(null,null,s,l,0),this.geometry=s,this.material=s.material,this.glMaterials=new SOe(s.material,this._materialRepository),this.vertexBufferLayout=o,this.vbo=Yi.createVertex(r,Fi.STATIC_DRAW,l.buffer),this.vao=new af(r,Li,{geometry:au(o)},{geometry:this.vbo}),this.vertexCount=a}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,i,r,s,n,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,r,s,(h,p,f,m,y)=>{if(h>=0){if(i!=null&&!i(e.rayBegin,e.rayEnd,h))return;const _=new qyt(o.layerUid,o.graphicUid(n),c,f,a,l);if((e.results.min.drapedLayerOrder==null||y>=e.results.min.drapedLayerOrder)&&(e.results.min.dist==null||h<e.results.min.dist)&&e.results.min.set(as.LOD,_,h,p,e.transform.transform,y),e.options.store!==Ho.MIN&&(e.results.max.drapedLayerOrder==null||y>=e.results.max.drapedLayerOrder)&&(e.results.max.dist==null||h>e.results.max.dist)&&e.results.max.set(as.LOD,_,h,p,e.transform.transform,y),e.options.store===Ho.ALL){const b=EQ(e.results.min.ray);b.set(as.LOD,_,h,p,e.transform.transform,y),e.results.all.push(b)}}})}},Xyt=class zRe{static async create(e,i,r){const s=await Promise.allSettled(i.components.map(o=>e.controller.schedule(()=>new Wyt(e,o),r))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(v);if(qn(r)||n.length!==s.length){n.forEach(o=>o.destroy()),gi(r);for(const o of s)if(o.status==="rejected")throw o.reason}return new zRe(i.minScreenSpaceRadius,n)}constructor(e,i){this.minScreenSpaceRadius=e,this.components=i}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,i,r,s,n,o,a){this.components.forEach(l=>l.intersect(e,i,r,s,n,o,this.boundingSphere,a))}get boundingBox(){if(C(this._boundingBox)){const e=$r();this.components.forEach(i=>{v(i.boundingInfo)&&(zm(e,i.boundingInfo.bbMin),zm(e,i.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(C(this._boundingSphere)){const e=this.boundingBox,i=M();Mp(e,i),this._boundingSphere={center:i,radius:.5*Jye(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,i)=>e+i.triangleCount,0)}},Yyt=class{constructor(e,i,r){this._elementSize=i,this._buffer=Yi.createVertex(e,Fi.STATIC_DRAW),this.resize(r)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(e,i,r,s=0){const n=new Uint8Array(this.array,e*this.elementSize,(i-e)*this.elementSize);new Uint8Array(r.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(e,i){const r=e*this._elementSize,s=i*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),r,r,s)}resize(e){const i=e*this._elementSize,r=new ArrayBuffer(i);this._array&&(e>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=r,this._buffer.setSize(i),this._capacity=e}},Zyt=class{constructor(e){this.modelOriginHi=e.getField(A.MODELORIGINHI,Lr),this.modelOriginLo=e.getField(A.MODELORIGINLO,Lr),this.model=e.getField(A.MODEL,n1),this.modelNormal=e.getField(A.MODELNORMAL,n1),this.color=e.getField(A.INSTANCECOLOR,iu),this.featureAttribute=e.getField(A.INSTANCEFEATUREATTRIBUTE,iu),this.objectAndLayerIdColor=e.getField(A.OBJECTANDLAYERIDCOLOR_INSTANCED,Na)}},Uue=class{constructor(e,i){this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=e,this._instanceBufferLayout=i,this._elementSize=i.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,i=this._tailIndex;return e>=i?e-i:e+this._capacity-i}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){Ct(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){Ct(this._updating,"not updating"),this.size<Kyt*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){Ct(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),Ct(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){Ct(this._updating,"not updating"),Ct(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(Vue,Math.floor(this._capacity*Jyt));this._resize(e)}_shrink(){const e=Math.max(Vue,Math.floor(this._capacity*Qyt));this._resize(e)}_resize(e){if(Ct(this._updating,"not updating"),e===this._capacity)return;const i=new Yyt(this._rctx,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const r=this.size,s=this._compactInstances(i);Ct(s===r,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=i,this._view=new Zyt(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const i=this._headIndex,r=this._tailIndex;return r<i?(this._buffer.copyRange(r,i,e),i-r):r>i?(this._buffer.copyRange(r,this._capacity,e),i>0&&this._buffer.copyRange(0,i,e,this._capacity-r),i+(this._capacity-r)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,i){e<i?this._buffer.transferRange(e,i):e>i&&(i>0&&this._buffer.transferRange(0,i),this._buffer.transferRange(e,this._capacity))}};const Vue=1024,Jyt=2,Kyt=.3,Qyt=.5,e0t=t=>{const e=t.baseBoundingSphere.radius,i=t.levels.map(r=>r.minScreenSpaceRadius);return new Hyt(e,i)};let $h=class extends $e{constructor(e,i){super(e),this.type=as.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new Ut,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[Fe.OPAQUE_MATERIAL,Fe.TRANSPARENT_MATERIAL],this.canRender=!0,this._instanceData=new CS({shaderTransformation:e.shaderTransformation},e.optionalFields),this._frameTask=i.registerTask(Rt.LOD_RENDERER,this)}initialize(){this._instanceBufferLayout=i0t(this.optionalFields),this._glInstanceBufferLayout=au(this._instanceBufferLayout,1),this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))}destroy(){this._frameTask.remove()}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const e={cpu:0,gpu:0};return this._defaultRenderInstanceData.forEach(i=>{const r=i.memoryUsage;e.cpu+=r.cpu,e.gpu+=r.gpu}),this._highlightRenderInstanceData.forEach(i=>{const r=i.memoryUsage;e.cpu+=r.cpu,e.gpu+=r.gpu}),e}get renderStats(){const e=this._instanceData.size,i=[];return this._levels.forEach((r,s)=>{const n=this._defaultRenderInstanceData[s],o=this._highlightRenderInstanceData[s],a=n.size+o.size,l=r.triangleCount;i.push({renderedInstances:a,renderedTriangles:a*l,trianglesPerInstance:l})}),{totalInstances:e,renderedInstances:i.reduce((r,s)=>r+s.renderedInstances,0),renderedTriangles:i.reduce((r,s)=>r+s.renderedTriangles,0),levels:i}}async initializeRenderContext(e,i){this._context=e;const r=e.renderContext.rctx,s=await Promise.allSettled(this.symbol.levels.map(o=>(this._defaultRenderInstanceData.push(new Uue(r,this._instanceBufferLayout)),this._highlightRenderInstanceData.push(new Uue(r,this._instanceBufferLayout)),Xyt.create(e,o,i)))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(v);if(qn(i)||n.length!==s.length){n.forEach(o=>o.destroy()),gi(i);for(const o of s)if(o.status==="rejected")throw o.reason}this._levels=n,this._levelSelector=e0t(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData.forEach(e=>e.destroy()),this._highlightRenderInstanceData.forEach(e=>e.destroy())}get needsTransparentPass(){return this._levels.some(e=>e.components.some(i=>i.material.requiresSlot(Fe.TRANSPARENT_MATERIAL,k.Color)))}get needsHighlight(){return this._highlightRenderInstanceData.some(e=>e.size>0)}prepareRender(e){if(!Ji.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const i=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),i||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(ll),this._needFullCycle=!1)}}render(e){!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output)||(e.rctx.bindVAO(),e.output!==k.Highlight&&e.output!==k.ShadowHighlight&&this._renderComponents(e,this._defaultRenderInstanceData),e.output!==k.ShadowExcludeHighlight&&this._renderComponents(e,this._highlightRenderInstanceData))}intersect(e,i,r,s){if(!this.baseMaterial.isVisible()||C(this._octree))return;const n=M();be(n,s,r);const o=a=>{this._instanceData.getCombinedModelTransform(a,zue),e.transform.set(zue),ut(Gue,r,e.transform.inverse),ut(jue,s,e.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),h=this._levels.length;Ct((l&Hr.ACTIVE)!=0,"invalid instance state"),Ct(c>=0&&c<h,"invaid lod level"),this._levels[c].intersect(e,i,Gue,jue,a,this.metadata,h)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(r,n,o)}queryDepthRange(e){return this._queryDepthRangeOctree(e)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){var e;if(C(this._octreeCached)){const i=this._instanceData,r=(e=i.view)==null?void 0:e.state;if(!r)return null;this._octreeCached=new jyt(i,this.baseBoundingSphere);for(let s=0;s<i.capacity;++s)r.get(s)&Hr.ACTIVE&&this._octreeCached.addInstance(s)}return this._octreeCached}_invalidateOctree(){this._octreeCached=Je(this._octreeCached)}_queryDepthRangeOctree(e){if(C(this._octree))return{near:1/0,far:-1/0};const i=e.viewForward,r=this._octree.findClosest(i,Np.DepthOrder.FRONT_TO_BACK,e.frustum),s=this._octree.findClosest(i,Np.DepthOrder.BACK_TO_FRONT,e.frustum);if(r==null||s==null)return{near:1/0,far:-1/0};const n=e.eye,o=this._instanceData.view;o.boundingSphere.getVec(r,Cf),be(Cf,Cf,n);const a=Ae(Cf,i)-Cf[3];o.boundingSphere.getVec(s,Cf),be(Cf,Cf,n);const l=Ae(Cf,i)+Cf[3];return{near:Math.max(e.near,a),far:Math.min(e.far,l)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._defaultRenderInstanceData.forEach(e=>e.startUpdateCycle()),this._highlightRenderInstanceData.forEach(e=>e.startUpdateCycle())}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:i,_camera:r,_levelSelector:s}=this;this._defaultRenderInstanceData.forEach(h=>h.beginUpdate()),this._highlightRenderInstanceData.forEach(h=>h.beginUpdate());const n=this._instanceData,o=n.view;let a=n.size;const l=n.capacity;let c=this._instanceIndex;for(let h=0;h<a&&!e.done;++h){c===this._cycleStartIndex&&this._startUpdateCycle();const p=o.state.get(c);let f=0;if(!(p&Hr.ALLOCATED)){c=c+1===l?0:c+1,a++;continue}const m=o.lodLevel.get(c);if(p&Hr.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[m].freeTail(),p&Hr.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[m].freeTail(),p&Hr.REMOVE)n.freeInstance(c);else if(p&Hr.VISIBLE){let y=0;i&&(o.modelOrigin.getVec(c,Bue),y=s.selectLevel(Bue,n.getCombinedMedianScaleFactor(c),r)),f=p&~(Hr.ACTIVE|Hr.TRANSFORM_CHANGED),y>=0&&(p&Hr.HIGHLIGHT?(kue(this._highlightRenderInstanceData[y],o,c),f|=Hr.HIGHLIGHT_ACTIVE):(kue(this._defaultRenderInstanceData[y],o,c),f|=Hr.DEFAULT_ACTIVE)),o.state.set(c,f),o.lodLevel.set(c,y)}else f=p&~(Hr.ACTIVE|Hr.TRANSFORM_CHANGED),o.state.set(c,f);if(v(this._octreeCached)){const y=!!(p&Hr.ACTIVE),_=!!(f&Hr.ACTIVE);!y&&_?this._octreeCached.addInstance(c):y&&!_?this._octreeCached.removeInstance(c):y&&_&&p&Hr.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,e.madeProgress()}this._instanceIndex=c,this._defaultRenderInstanceData.forEach(h=>h.endUpdate()),this._highlightRenderInstanceData.forEach(h=>h.endUpdate()),this._context.requestRender()}_renderComponents(e,i){this.levels.forEach((r,s)=>{const n=r.components.map(o=>this._beginComponent(e,i[s],o));r.components.forEach((o,a)=>this._renderComponent(e,n[a],i[s],o,s))})}_beginComponent(e,i,r){const{bindParameters:s,rctx:n,output:o}=e;if(i.size===0||!r.material.requiresSlot(s.slot,e.output))return null;const a=r.glMaterials.load(n,s.slot,o);return v(a)?a.beginSlot(s):null}_renderComponent(e,i,r,s,n){if(C(i))return;const{bindParameters:o,rctx:a}=e,l=a.bindTechnique(i,s.material.parameters,o);a.bindVAO(s.vao),i.ensureAttributeLocations(s.vao),l.bindDraw(r0t,o,s.material.parameters),Ji.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===k.Color&&(l.setUniform4fv("externalColor",Hue[Math.min(n,Hue.length-1)]),l.setUniform1i("colorMixMode",$Ce.replace));const c=a.capabilities.instancing,h=r.capacity,p=r.headIndex,f=r.tailIndex,m=r.firstIndex,y=this._glInstanceBufferLayout,_=(b,w)=>{zK(a,Li,r.buffer,y,b),c.drawArraysInstanced(i.primitiveType,0,s.vertexCount,w-b),GK(a,Li,r.buffer,y)};s.material.parameters.transparent&&m!=null?p>f?(Ct(m>=f&&m<=p,"invalid firstIndex"),_(m,p),_(f,m)):p<f&&(m<=p?(Ct(m>=0&&m<=p,"invalid firstIndex"),_(m,p),_(f,h),_(0,m)):(Ct(m>=f&&m<=h,"invalid firstIndex"),_(m,h),_(0,p),_(f,m))):p>f?_(f,p):p<f&&(_(0,p),_(f,h)),a.bindVAO(null)}};function kue(t,e,i){const r=t.allocateHead();t0t(e,i,t.view,r)}function t0t(t,e,i,r){Lrt(t.modelOrigin,e,i.modelOriginHi,i.modelOriginLo,r),i.model.copyFrom(r,t.model,e),i.modelNormal.copyFrom(r,t.modelNormal,e),t.color&&i.color&&i.color.copyFrom(r,t.color,e),t.objectAndLayerIdColor&&i.objectAndLayerIdColor&&i.objectAndLayerIdColor.copyFrom(r,t.objectAndLayerIdColor,e),t.featureAttribute&&i.featureAttribute&&i.featureAttribute.copyFrom(r,t.featureAttribute,e)}function i0t(t){let e=cs().vec3f(A.MODELORIGINHI).vec3f(A.MODELORIGINLO).mat3f(A.MODEL).mat3f(A.MODELNORMAL);return v(t)&&t.includes("color")&&(e=e.vec4f(A.INSTANCECOLOR)),v(t)&&t.includes("featureAttribute")&&(e=e.vec4f(A.INSTANCEFEATUREATTRIBUTE)),v(t)&&t.includes("objectAndLayerIdColor")&&(e=e.vec4u8(A.OBJECTANDLAYERIDCOLOR_INSTANCED)),e}u([d({constructOnly:!0})],$h.prototype,"symbol",void 0),u([d({constructOnly:!0})],$h.prototype,"optionalFields",void 0),u([d({constructOnly:!0})],$h.prototype,"metadata",void 0),u([d({constructOnly:!0})],$h.prototype,"shaderTransformation",void 0),u([d()],$h.prototype,"_instanceData",void 0),u([d()],$h.prototype,"_cycleStartIndex",void 0),u([d({readOnly:!0})],$h.prototype,"_enableLevelSelection",null),u([d()],$h.prototype,"_updateCyclesWithStaticCamera",void 0),u([d({readOnly:!0})],$h.prototype,"running",null),$h=u([I("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],$h);const Bue=M(),Cf=fi(),zue=We(),Gue=M(),jue=M(),Hue=[si(1,0,1,1),si(0,0,1,1),si(0,1,0,1),si(1,1,0,1),si(1,0,0,1)],r0t=new Jft;let que=class{constructor(e,i,r,s,n,o,a,l,c,h,p,f){this.lodResources=e,this.lodRenderer=i,this.stageResources=r,this.originalMaterialParameters=s,this.resourceSize=n,this.isEsriSymbolResource=o,this.isWosr=a,this.resourceBoundingBox=l,this.symbolSize=c,this.extentPadding=h,this.physicalBasedRenderingEnabled=p,this.pivotOffset=f}},s0t=class extends ag{getCachedSize(){const[e,i,r]=v(this._resources)?this._resources.symbolSize:[1,1,1];return{width:e,depth:i,height:r}}constructor(e,i,r,s){super(e,i,r,s),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=r.physicalBasedRenderingEnabled}async doLoad(e){if(!this._drivenProperties.size&&$8(this.symbolLayer))throw new Error;const i=this.symbolLayer;if(this._isPrimitive){const r=i.resource?i.resource.primitive:M0e;this._resources=await this._createResourcesForPrimitive(r,e)}else this._resources=await this._createResourcesForUrl(i.resource.href,e);this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return v(this._resources)?this._resources.extentPadding:0}get _isPrimitive(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}get lodRenderer(){return v(this._resources)?this._resources.lodRenderer:null}_setMaterialTransparencyParams(e,i=In(this.symbolLayer,"material","color")){const r=this._getCombinedOpacity(i),s=r<1||this.needsDrivenTransparentPass;return e.transparent=s,e.opacity=r,e.cullFace=s?Or.None:Or.Back,e}async _createResourcesForPrimitive(e,i){if(!ndt(e))throw new Error(`Unknown object symbol primitive: ${e}`);const r=this.symbolLayer,s=Nn(R6e(e)),n=Kl(o$(s)),o=Kl($V(n,r)),a=je(o),l=!1,c=!1,h={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,ambient:_m,diffuse:_m,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},p=!!h.usePBR;this._setMaterialTransparencyParams(h);const f=this.symbol;if(f.type==="point-3d"&&f.verticalOffset){const{screenLength:S,minWorldLength:T,maxWorldLength:E}=f.verticalOffset;h.verticalOffset={screenLength:ko(S),minWorldLength:T||0,maxWorldLength:v(E)?E:1/0},h.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(h.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)h.externalColor=ed;else{const S=v(r.material)?r.material.color:null,T=v(S)?ot.toUnitRGBA(S):ed;h.externalColor=T}this._fastUpdates=RP(this._context.renderer,this._fastVisualVariableConvertOptions(s,o,n,yb)),h.instanced=["transformation"],this._fastUpdates.enabled?(Object.assign(h,this._fastUpdates.materialParameters),h.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(h.instanced.push("color"),this._optionalFields.push("color")),de("enable-feature:objectAndLayerId-rendering")&&(h.instanced.push("objectAndLayerIdColor"),this._optionalFields.push("objectAndLayerIdColor"));const m=new e0(h),y=FAe(e,m);if(!y)throw new Error(`Unknown object symbol primitive: ${e}`);const _=LL(y).map(S=>({opacity:1,transparent:S.parameters.transparent})),b=await this._createStageResources(y,p,i),w=await this._createLodRenderer(y,i);return new que(y,w,b,_,n,l,c,s,o,a,p,yb)}async _createResourcesForUrl(e,i){const r=["transformation"],s={materialParamsMixin:{instanced:r,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=RP(this._context.renderer,this._fastVisualVariableConvertOptions(yb,yb,yb,yb)),this._fastUpdates.enabled?(Object.assign(s.materialParamsMixin,this._fastUpdates.materialParameters),r.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(r.push("color"),this._optionalFields.push("color")),de("enable-feature:objectAndLayerId-rendering")&&(r.push("objectAndLayerIdColor"),this._optionalFields.push("objectAndLayerIdColor"));const n=this.symbol;if(n.type==="point-3d"&&n.verticalOffset){const{screenLength:V,minWorldLength:B,maxWorldLength:G}=n.verticalOffset;s.materialParamsMixin.verticalOffset={screenLength:ko(V),minWorldLength:B||0,maxWorldLength:v(G)?G:1/0},s.materialParamsMixin.castShadows=!1}s.signal=i,s.usePBR=this._context.physicalBasedRenderingEnabled,s.skipHighLods=this._context.skipHighSymbolLods;const o=s.usePBR,a=await VRe(e,s),l=a.isEsriSymbolResource,c=a.isWosr,h=Hgt(a.lods);h.levels.sort((V,B)=>V.minScreenSpaceRadius-B.minScreenSpaceRadius);const p=this._context,f=this.symbolLayer.material,m=this._getExternalColorParameters(f),y=In(this.symbolLayer,"material","color"),_=this._getCombinedOpacity(y,{hasIntrinsicColor:!0}),b=this.needsDrivenTransparentPass,w=LL(h),S=LL(h).map(V=>({opacity:V.parameters.opacity||1,transparent:V.parameters.transparent}));w.forEach(V=>{const B=V.parameters;V.setParameters(m);const G=B.opacity*_,te=G<1||b||B.transparent;V.setParameters({opacity:G,transparent:te}),p.screenSizePerspectiveEnabled&&V.setParameters({screenSizePerspective:p.sharedResources.screenSizePerspectiveSettings})});const T=a.referenceBoundingBox,E=Kl(o$(T)),O=Kl(h.levels[0].pivotOffset),R=Kl($V(E,this.symbolLayer)),L=je(R);MP(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(T,R,E,O))&&w.forEach(V=>V.setParameters(this._fastUpdates.materialParameters));const P=await this._createStageResources(h,o,i),F=await this._createLodRenderer(h,i);return new que(h,F,P,S,E,l,c,T,R,L,o,O)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,i,r){const s=this._context.stage,n=LL(e);i!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),s.addMany(n),this._addDisposeResource(()=>s.removeMany(n));const o=gce(e);s.addMany(o),this._addDisposeResource(()=>s.removeMany(o)),await s.load(o,r),gi(r);const a=yce(e);return s.addMany(a),this._addDisposeResource(()=>s.removeMany(a)),{materials:n,textures:o,geometries:a}}async _createLodRenderer(e,i){const r=this._context.stage,s={layerUid:this._context.layer.uid,graphicUid:a=>this._instanceIndexToGraphicUid.get(a),notifyGraphicGeometryChanged:a=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(a)),notifyGraphicVisibilityChanged:a=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(a))},n=this._fastUpdates.enabled?{applyTransform:(a,l,c)=>{a.getFeatureAttribute(l,rD),Xn(c,oX(this._fastUpdates.materialParameters,rD,c))},scaleFactor:(a,l,c)=>(l.getFeatureAttribute(c,rD),Nmt(a,this._fastUpdates.materialParameters,rD))}:null,o=new $h({symbol:e,optionalFields:this._optionalFields,metadata:s,shaderTransformation:n},this._context.scheduler);return o.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{r.removeRenderPlugin(o),o.destroy()}),await r.addRenderPlugin(o.slots,o,i),o}_getExternalColorParameters(e){const i={};return this._drivenProperties.color?i.externalColor=ed:v(e)&&v(e.color)?i.externalColor=ot.toUnitRGBA(e.color):(i.externalColor=ed,i.colorMixMode="ignore"),i}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(e=>e()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry))return null;const r=SP(i.geometry);if(C(r))return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const s=this.setGraphicElevationContext(i,new cf),n=e.renderingInfo;return this._createAs3DShape(i,r,n,s,i.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(C(this._resources))return;const e=this._drivenProperties.opacity,i=!this._isPrimitive,r=this._resources.stageResources.materials,s=this._resources.originalMaterialParameters;for(let n=0;n<r.length;n++){const o=r[n],a=In(this.symbolLayer,"material","color"),l=s[n],c=this._getCombinedOpacity(a,{hasIntrinsicColor:i})*l.opacity,h=c<1||e||l.transparent;o.setParameters({opacity:c,transparent:h}),this._isPrimitive&&o.setParameters({cullFace:h?Or.None:Or.Back})}}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,c1)}slicePlaneEnabledChanged(){if(C(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(C(this._resources))return!0;const{stageResources:e,isWosr:i}=this._resources;for(const r of e.materials)this._isPrimitive?r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):i||r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!1}applyRendererDiff(e,i){if(C(this._resources))return $n.Recreate_Symbol;const{stageResources:{materials:r},lodRenderer:s,resourceBoundingBox:n,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in e.diff){if(c!=="visualVariables"||!MP(this._fastUpdates,i,this._fastVisualVariableConvertOptions(n,o,a,l)))return $n.Recreate_Symbol;for(const h of r)h.setParameters(this._fastUpdates.materialParameters);s.notifyShaderTransformationChanged()}return $n.Fast_Update}computeComplexity(){if(C(this._resources))return super.computeComplexity();const e=this._resources.lodResources,i=NAe(e.levels[0]).reduce((n,o)=>n+o.indices.get(A.POSITION).length,0)/3,r=n=>Array.from(n.vertexAttributes.values()).reduce((o,a)=>{var l;return o+(((l=a.data.buffer)==null?void 0:l.byteLength)??0)},0)+Array.from(n.indices.values()).reduce((o,a)=>o+(Array.isArray(a)?12*a.length:a.buffer.byteLength),0),s=gce(e).reduce((n,o)=>n+(o.params.encoding&&o.params.encoding==="image/ktx2"?o.estimatedTexMemRequired:o.estimatedTexMemRequired/4),0)+yce(e).reduce((n,o)=>n+r(o),0);return{primitivesPerFeature:i,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:{...kAe(this.symbol,this.symbolLayer),resourceBytes:s}}}_hasLodRenderer(){return v(this._resources)}_createAs3DShape(e,i,r,s,n,o){if(!this._hasLodRenderer()||C(this._resources))return null;const a=this.getFastUpdateAttrValues(e),l=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?o3(r.color,r.opacity):null,c=this._context.clippingExtent;if(da(i,a2,this._context.elevationProvider.spatialReference),v(c)&&!PZ(c,a2))return null;const h=this._requiresTerrainElevation(s),p=this._computeGlobalTransform(i,s,PB,sD),f=this._computeLocalTransform(this._resources,this.symbolLayer,r,Wue),m=this._resources.lodRenderer.instanceData,y=m.addInstance();this._instanceIndexToGraphicUid.set(y,n),m.setLocalTransform(y,f,!1),m.setGlobalTransform(y,p),a&&m.setFeatureAttribute(y,a),l&&m.setColor(y,l),v(this._context.stage.renderView.objectAndLayerIdRenderHelper)&&m.setObjectAndLayerIdColor(y,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:n,layerUid:o}));const _=new zgt(this,y,Yht,s);return h&&(_.alignedSampledElevation=sD.sampledElevation),_.needsElevationUpdates=c1(s.mode),TP(_,i,this._context.elevationProvider),_}_computeGlobalTransform(e,i,r,s){return CA(e,this._context.elevationProvider,i,this._context.renderCoordsHelper,s),a2[0]=e.x,a2[1]=e.y,a2[2]=s.z,Jp(e.spatialReference,a2,r,this._context.renderCoordsHelper.spatialReference),r}_computeLocalTransform(e,i,r,s){return _d(s),this._applyObjectRotation(r,!1,s),this._applyObjectRotation(i,!0,s),this._applyObjectScale(e,r,s),this._applyAnchor(e,i,s),s}_applyObjectScale(e,i,r){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._drivenProperties.size&&i.size?i.size:e.symbolSize,n=fce(s,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);n[0]===1&&n[1]===1&&n[2]===1||fU(r,r,n)}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const i=e.diff.diff;this._preparePatchTransform(e,i),this._preparePatchColor(e,i)}updateGeometry(e,i){if(C(this._resources))return!0;const r=i&&SP(i);if(C(r))return!1;const s=this.getGeometryElevationMode(i);return e.elevationContext.mode===s&&(this._computeGlobalTransform(r,e.elevationContext,PB,sD),this._requiresTerrainElevation(e.elevationContext)&&(e.alignedSampledElevation=sD.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,PB,!0),TP(e,r,this._context.elevationProvider),!0)}_preparePatchTransform(e,i){if(!(i.heading||i.tilt||i.roll||i.width||i.height||i.depth||i.anchor||i.anchorPosition)||C(this._resources))return;const r=(y,_,b)=>Gt(y!=null&&y.type==="complete"?y.newValue:_,b),s=r(i.heading,this.symbolLayer.heading,0),n=r(i.tilt,this.symbolLayer.tilt,0),o=r(i.roll,this.symbolLayer.roll,0),a=r(i.width,this.symbolLayer.width,void 0),l=r(i.height,this.symbolLayer.height,void 0),c=r(i.depth,this.symbolLayer.depth,void 0),h=r(i.anchor,this.symbolLayer.anchor,void 0),p=r(i.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete i.heading,delete i.tilt,delete i.roll,delete i.width,delete i.height,delete i.depth,delete i.anchor,delete i.anchorPosition;const f={heading:s,tilt:n,roll:o,anchor:h,anchorPosition:p},m=this._resources;this.loadStatus===Uu.LOADED&&e.symbolLayerStatePatches.push(()=>{m.symbolSize=Kl($V(m.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push((y,_)=>{const b=this._computeLocalTransform(m,f,_,Wue),w=y.instanceIndex;m.lodRenderer.instanceData.setLocalTransform(w,b,!0)})}_preparePatchColor(e,i){if(!i.material||i.material.type!=="partial")return;const r=i.material.diff;if(!r.color||r.color.type!=="complete"||r.color.newValue==null||r.color.oldValue==null)return;const s=r.color.newValue,n=v(s)?ot.toUnitRGBA(s):ed;delete r.color;const o=this._resources;C(o)||e.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,n),l=this._setMaterialTransparencyParams({},s)):l=this._setMaterialTransparencyParams({externalColor:n},s);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(e){return e.mode!=="absolute-height"}_applyObjectRotation(e,i,r){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&i))return Uht(e.heading,e.tilt,e.roll,r)}_computeAnchor(e,i,r){const s=M();switch(r.anchor){case"center":he(s,Mp(e)),Pa(s,s);break;case"top":{const n=Mp(e);fe(s,-n[0],-n[1],-e[5]);break}case"bottom":{const n=Mp(e);fe(s,-n[0],-n[1],-e[2]);break}case"relative":{const n=Mp(e),o=o$(e),a=r.anchorPosition,l=a?Xe(a.x,a.y,a.z):Ma;B6(s,o,l),ve(s,s,n),Pa(s,s);break}default:v(i)?Pa(s,i):he(s,Ma)}return s}_applyAnchor(e,i,r){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,i);s&&hc(r,r,s)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,i,r,s){const n=v(e)?Kl(o$(e)):_m,o=v(e)?this._computeAnchor(e,s,this.symbolLayer):Ma,a=this._context.renderCoordsHelper.unitInMeters,l=fce(v(i)?i:void 0,i,r,a),c=Xe(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:n,symbolSize:v(i)?i:_m,unitInMeters:a,transformation:{anchor:o,scale:l,rotation:c}}}};const a2=M(),Wue=We(),PB=We(),rD=fi(),sD=new $I;function n0t(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function o0t(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function pX(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}function a0t(t,e){if(t===e){const i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function l0t(t,e){const i=e[0],r=e[1],s=e[2],n=e[3];let o=i*n-s*r;return o?(o=1/o,t[0]=n*o,t[1]=-r*o,t[2]=-s*o,t[3]=i*o,t):null}function c0t(t,e){const i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t}function u0t(t){return t[0]*t[3]-t[2]*t[1]}function GRe(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=i[0],l=i[1],c=i[2],h=i[3];return t[0]=r*a+n*l,t[1]=s*a+o*l,t[2]=r*c+n*h,t[3]=s*c+o*h,t}function h0t(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+n*a,t[1]=s*l+o*a,t[2]=r*-a+n*l,t[3]=s*-a+o*l,t}function d0t(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=i[0],l=i[1];return t[0]=r*a,t[1]=s*a,t[2]=n*l,t[3]=o*l,t}function p0t(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t}function f0t(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function m0t(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function g0t(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2)}function y0t(t,e,i,r){return t[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-t[2]*i[1],[t,e,i]}function _0t(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function jRe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function v0t(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function b0t(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],h=Fa();return Math.abs(i-o)<=h*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=h*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=h*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=h*Math.max(1,Math.abs(n),Math.abs(c))}function w0t(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function x0t(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t}const T0t=GRe,S0t=jRe;Object.freeze(Object.defineProperty({__proto__:null,LDU:y0t,add:_0t,adjoint:c0t,copy:n0t,determinant:u0t,equals:b0t,exactEquals:v0t,frob:g0t,fromRotation:p0t,fromScaling:f0t,identity:o0t,invert:l0t,mul:T0t,multiply:GRe,multiplyScalar:w0t,multiplyScalarAndAdd:x0t,rotate:h0t,scale:d0t,set:pX,str:m0t,sub:S0t,subtract:jRe,transpose:a0t},Symbol.toStringTag,{value:"Module"}));let E0t=class extends fn{constructor(e,i,r,s,n,o,a,l){super(e,i,r,null,Vs.Mesh,l),this.path=s,this.geometrySR=n,this.upVectorAlignment=o,this.stencilWidth=a}};var zv;function HRe(t){return"upVectorAlignment"in t}(function(t){t[t.World=0]="World",t[t.Path=1]="Path"})(zv||(zv={}));function qRe(){return[1,0,0,1]}function C0t(t){return[t[0],t[1],t[2],t[3]]}function A0t(t,e,i,r){return[t,e,i,r]}function O0t(t,e){return new Float64Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:C0t,create:qRe,createView:O0t,fromValues:A0t},Symbol.toStringTag,{value:"Module"}));function WRe(){return{up:M(),right:M()}}function R0t(t,e,i){ut(t.up,e.up,i),ut(t.right,e.right,i)}function M0t(t,e,i){It(t,Ae(i,e.right),Ae(i,e.up))}let P0t=class{constructor(){this.pos=M(),this.posES=M(),this.vLeft=M(),this.vRight=M(),this.vMinSiblingLength=0,this.frame=WRe(),this.rotationFrameUp=M(),this.rotationRight=et(),this.rotationAngle=0,this.miterStretch=qRe(),this.maxStretchDistance=0}setFrameFromUpVector(e){he(this.frame.up,e),ve(AS,this.vLeft,this.vRight),Oe(AS,AS),ue(fX,this.frame.up,Ae(AS,this.frame.up)),be(oD,AS,fX),Oe(oD,oD),Et(this.frame.right,oD,this.frame.up)}},XRe=class{constructor(){this.vertices=[],this.vertexIndices=[],this.vertexNormals=[],this.poles=[],this.poleIndices=[]}addVertex(e,i){return this.vertices.push(mR(e)),this.vertexNormals.push(mR(i)),this.vertices.length-1}addPole(e,i=null){return this.poles.push({position:mR(e),normal:i?mR(i):null}),this.poles.length-1}addSegment(e,i=null){this.vertexIndices.push(e.v0),this.vertexIndices.push(e.v1),i&&(this.poleIndices.push(i.v0),this.poleIndices.push(i.v1))}get numSegments(){return this.vertexIndices.length/2}translate(e,i){for(const r of this.vertices)r[0]+=e,r[1]+=i;for(const r of this.poles)r.position[0]+=e,r.position[1]+=i}};function I0t(t=20){const i=new XRe,r={v0:0,v1:0};i.addPole(Ni(0,0));for(let n=0;n<t;++n){const o=2*n*Math.PI/t,a=Math.cos(o),l=Math.sin(o),c=Ni(a*.5,l*.5),h=Ni(a,l);i.addVertex(c,h)}for(let n=0;n<t-1;++n){const o={v0:n,v1:n+1};i.addSegment(o,r)}const s={v0:t-1,v1:0};return i.addSegment(s,r),i}function $0t(){const i=new XRe,r=Ni(.5*-1,.5*-1),s=Ni(.5*1,.5*-1),n=Ni(.5*1,.5*1),o=Ni(.5*-1,.5*1),a=Ni(0,-1),l=Ni(1,0),c=Ni(0,1),h=Ni(-1,0);return i.addPole(Ni(0,.5*1),c),i.addPole(Ni(0,.5*1)),i.addPole(Ni(0,.5*-1)),i.addPole(Ni(0,.5*-1),a),i.addVertex(r,a),i.addVertex(s,a),i.addSegment({v0:0,v1:1},{v0:3,v1:3}),i.addVertex(s,l),i.addVertex(n,l),i.addSegment({v0:2,v1:3},{v0:2,v1:1}),i.addVertex(n,c),i.addVertex(o,c),i.addSegment({v0:4,v1:5},{v0:0,v1:0}),i.addVertex(o,h),i.addVertex(r,h),i.addSegment({v0:6,v1:7},{v0:1,v1:2}),i}let L0t=class{constructor(e){this.vertices=e,this.offset=M(),this.xform=We();const i=Math.floor((e.length-1)/2);he(this.offset,this.vertices[i].pos);for(const r of this.vertices)be(r.pos,r.pos,this.offset);hc(this.xform,this.xform,this.offset),this.updatePathVertexInformation()}updatePathVertexInformation(){const e=this.vertices.length,i=this.vertices[0];i.index=0,i.vLeft=M(),be(i.vRight,this.vertices[1].pos,i.pos);let r=je(i.vRight);i.vMinSiblingLength=r,Oe(i.vRight,i.vRight);let s=i;for(let n=1;n<e;++n){const o=this.vertices[n];if(o.index=n,o.vLeft=s.vRight,n<e-1){be(o.vRight,this.vertices[n+1].pos,o.pos);const a=je(o.vRight);o.vMinSiblingLength=Math.min(r,a),r=a,Oe(o.vRight,o.vRight)}else he(o.vRight,o.vLeft),o.vMinSiblingLength=r;s=o}}};function D0t(t,e){let i=null;const r=t.vertices.length,s=.99619469809,n=M(),o=M(),a=M(),l=M(),c=M(),h=M(),p=qi();let f=t.vertices[0];he(o,e),fe(n,0,1,0),C5(f.vRight,o,n,n,a,o,s),he(f.frame.up,o),he(f.frame.right,a),i=f;for(let m=1;m<r;++m){f=t.vertices[m],ve(c,f.vLeft,f.vRight);let y=je(c);y>0?(y=1/Math.sqrt(y),c[0]=c[0]*y,c[1]=c[1]*y,c[2]=c[2]*y):(c[0]=f.vRight[0],c[1]=f.vRight[1],c[2]=f.vRight[2]),ve(h,i.pos,i.frame.up),nI(f.pos,c,p),hT(p,ih(h,f.vLeft),l)?(be(l,l,f.pos),Oe(o,l),Et(a,c,o),Oe(a,a)):C5(c,i.frame.up,i.frame.right,n,a,o,s),he(f.frame.up,o),he(f.frame.right,a),i=f}}let N0t=class{numProfilesPerJoin(){return 1}extrude(e,i,r){for(let s=0;s<i.vertices.length;++s)r(e.index,e.frame,i.vertices[s],i.vertexNormals[s],!1)}},IB=class{constructor(e=.8*Math.PI,i=1){this.cutoffAngle=e,this.numBendSubdivisions=i}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,i,r){const s=G0t;if(Math.abs(e.rotationAngle)>=this.cutoffAngle)for(let n=0;n<this.numBendSubdivisions+1;++n){eh(Zue,.5*-e.rotationAngle+n*e.rotationAngle/this.numBendSubdivisions,e.rotationFrameUp),R0t(s,e.frame,Zue);for(let o=0;o<i.vertices.length;++o)dn(i.vertices[o],e.rotationRight)*e.rotationAngle>=0?r(e.index,s,i.vertices[o],i.vertexNormals[o],!1):(Oq(Qw,i.vertices[o],e.miterStretch),r(e.index,e.frame,Qw,i.vertexNormals[o],!0))}else for(let n=0;n<this.numBendSubdivisions+1;++n)for(let o=0;o<i.vertices.length;++o){const a=dn(i.vertices[o],e.rotationRight)*e.rotationAngle>=0;Oq(Qw,i.vertices[o],e.miterStretch),r(e.index,e.frame,Qw,i.vertexNormals[o],!a)}}},Uee=class{rebuildConnectingProfileGeometry(e,i,r){for(let s=0;s<i.vertices.length;++s)r(e.index,e.frame,i.vertices[s],i.vertexNormals[s],0,0)}},Xue=class extends Uee{constructor(){super()}getNumVertices(){return 0}getNumIndices(){return 0}rebuildCapGeometry(){}buildTopology(){}},nD=class extends Uee{constructor(e,i=0,r=!1){super(),this.profile=e,this.profilePlaneOffset=i,this.flip=r}getNumVertices(){return this.profile.vertices.length}getNumIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,i,r){for(let s=0;s<i.vertices.length;++s)r(e.index,e.frame,i.vertices[s],i.vertexNormals[s],this.profilePlaneOffset,0)}rebuildCapGeometry(e,i){const r=Vee;It(r,0,0);const s=this.flip?1:-1;for(let n=0;n<this.profile.vertices.length;++n)i(e.index,e.frame,this.profile.vertices[n],r,this.profilePlaneOffset,s)}buildTopology(e,i){const r=this.vertexBufferStart+this.profile.vertexIndices[0];for(let s=1;s<this.profile.numSegments;++s){const n=this.profile.vertexIndices[2*s+0],o=this.profile.vertexIndices[2*s+1],a=this.vertexBufferStart+n,l=this.vertexBufferStart+o;this.flip?i(l,a,r):i(r,a,l)}}},Yue=class extends Uee{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}getNumVertices(){let e=0;return e=this.profile.vertices.length*(this.numSegments-1),this.breakNormals&&(e+=this.profile.vertices.length),e+=this.profile.poles.length,e}getNumIndices(){let e=0;e+=2*this.profile.numSegments*(this.numSegments-1);for(let i=0;i<this.profile.numSegments;++i){const r=this.profile.vertexIndices[2*i+0],s=this.profile.vertexIndices[2*i+1];this.profile.poleIndices[r]===this.profile.poleIndices[s]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,i){const r=e.frame,s=.5*this.sign,n=Qw,o=Vee;It(o,0,0);for(let a=0;a<this.profile.poles.length;++a){const l=this.profile.poles[a];l.normal?i(e.index,r,l.position,l.normal,s,0):i(e.index,r,l.position,o,s,this.sign)}if(this.breakNormals)for(let a=0;a<this.profile.vertices.length;++a)i(e.index,r,this.profile.vertices[a],this.profile.vertexNormals[a],0,0);for(let a=0;a<this.numSegments-1;++a){const l=(1-(a+1)/this.numSegments)*Math.PI*.5,c=Math.sin(l),h=Math.cos(l);for(let p=0;p<this.profile.vertices.length;++p){const f=this.profile.poles[this.profile.poleIndices[p]];ju(n,this.profile.vertices[p],f.position),Ca(n,n,c),f.normal?(Gh(n,n,f.position),i(e.index,r,n,f.normal,s*h,0)):(kx(o,n),Ca(o,o,c),Gh(n,n,f.position),i(e.index,r,n,o,s*h,this.sign*h))}}}buildTopology(e,i){const r=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex,s=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let n=0;n<this.profile.numSegments;++n){const o=this.profile.vertexIndices[2*n+0],a=this.profile.vertexIndices[2*n+1],l=this.vertexBufferStart+this.profile.poleIndices[o],c=this.vertexBufferStart+this.profile.poleIndices[a];let h=r+o,p=r+a;for(let f=0;f<this.numSegments-1;++f){const m=s+f*this.profile.vertices.length+o,y=s+f*this.profile.vertices.length+a;this.flip?(i(m,p,h),i(p,m,y)):(i(h,p,m),i(y,m,p)),h=m,p=y}this.flip?(i(l,p,h),l!==c&&i(l,c,p)):(i(h,p,l),l!==c&&i(p,c,l))}}},F0t=class{constructor(e,i,r,s,n,o={}){this.options=o,this._extrusionVertexCount=0,this.numExtrusionProfiles=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.profile=i,this.path=e,this.extruder=r,this.startCap=s,this.endCap=n;const a=this.path.vertices.length-2;this.numExtrusionProfiles=r.numProfilesPerJoin()*a+2,this.numVerticesTotal=i.vertices.length*this.numExtrusionProfiles,this.numNormalsTotal=this.numVerticesTotal,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.getNumVertices();this.numVerticesTotal+=l,this.numNormalsTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.getNumVertices();this.numVerticesTotal+=c,this.numNormalsTotal+=c,this.pathVertexData=Qs(1*this.numVerticesTotal),this.profileRightAxisData=Qs(4*this.numVerticesTotal),this.profileUpAxisData=Qs(4*this.numVerticesTotal),this.profileVertexAndNormalData=Qs(4*this.numVerticesTotal),this.originData=Qs(3*this.path.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(e,i,r,s,n){if(this.profileRightAxisData[4*this._extrusionVertexCount+0]=i.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=i.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=i.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=i.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=i.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=i.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,n){const o=this.path.vertices[e];this.profileRightAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[0]*o.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[1]*o.maxStretchDistance}else this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0;++this._extrusionVertexCount}emitCapVertex(e,i,r,s,n,o){this.profileRightAxisData[4*this._extrusionVertexCount+0]=i.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=i.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=i.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=i.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=i.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=i.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,this.profileRightAxisData[4*this._extrusionVertexCount+3]=n,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o,++this._extrusionVertexCount}_rebuildGeometry(){const e=(r,s,n,o,a)=>this.emitVertex(r,s,n,o,a),i=(r,s,n,o,a,l)=>this.emitCapVertex(r,s,n,o,a,l);this._extrusionVertexCount=0;for(const r of this.path.vertices)this.originData[3*r.index+0]=r.pos[0],this.originData[3*r.index+1]=r.pos[1],this.originData[3*r.index+2]=r.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,i);for(let r=1;r<this.path.vertices.length-1;++r)this.extruder.extrude(this.path.vertices[r],this.profile,e);this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,i),this.startCap.rebuildCapGeometry(this.path.vertices[0],i),this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],i)}buildTopology(){const e=this.profile.vertices.length,i=this.profile.numSegments,r=this.numExtrusionProfiles-1;let s=3*(2*(i*r));this.startCap.indexBufferStart=s,this.startCap.firstProfileVertexIndex=0,s+=this.startCap.getNumIndices(),this.endCap.indexBufferStart=s,this.endCap.firstProfileVertexIndex=e*(this.numExtrusionProfiles-1);const n=new Array,o=new Array,a=new Array,l=(c,h,p)=>{n.push(c),n.push(h),n.push(p),o.push(c),o.push(h),o.push(p),a.push(this.pathVertexData[c]),a.push(this.pathVertexData[h]),a.push(this.pathVertexData[p])};for(let c=0;c<i;++c){const h=this.profile.vertexIndices[2*c],p=this.profile.vertexIndices[2*c+1];for(let f=0;f<r;++f){const m=f*e+h,y=(f+1)*e+p,_=f*e+p;l(m,(f+1)*e+h,y),l(m,y,_)}}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=RE(n),this.normalIndices=RE(o),this.pathVertexIndices=RE(a)}onPathChanged(){this._rebuildGeometry()}},YRe=class{constructor(e){this.builder=e}get xform(){return this.builder.path.xform}onPathChanged(){this.builder.onPathChanged()}},ZRe=class extends YRe{constructor(e){super(e),this.vertexAttributePosition=null,this.vertexAttributeNormal=null,this.vertexAttributeColor=null,this.vertexAttributePosition=Qs(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=Qs(3*this.builder.numNormalsTotal),this.vertexAttributeColor=new Uint8Array(4),this.vertexAttributeColor[0]=255,this.vertexAttributeColor[1]=255,this.vertexAttributeColor[2]=255,this.vertexAttributeColor[3]=255}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;for(let i=0;i<this.builder.numVerticesTotal;++i){let r=this.builder.pathVertexData[i];const s=r===0||r===this.builder.path.vertices.length-1;r*=3;const n=V0t;fe(n,this.builder.originData[r++],this.builder.originData[r++],this.builder.originData[r]);const o=4*i,a=fX,l=Qw,c=AS,h=B0t,p=z0t;let f=0,m=0;if(fe(h,this.builder.profileRightAxisData[o],this.builder.profileRightAxisData[o+1],this.builder.profileRightAxisData[o+2]),fe(p,this.builder.profileUpAxisData[o],this.builder.profileUpAxisData[o+1],this.builder.profileUpAxisData[o+2]),It(l,this.builder.profileVertexAndNormalData[o]*e[0],this.builder.profileVertexAndNormalData[o+1]*e[1]),s)Et(c,p,h),f=this.builder.profileRightAxisData[o+3]*e[0],m=this.builder.profileUpAxisData[o+3];else{const _=Vee,b=k0t;It(_,this.builder.profileRightAxisData[o+3],this.builder.profileUpAxisData[o+3]);const w=nP(_);kx(_,_);const S=dn(l,_);if(Math.abs(S)>w){It(b,-_[1],_[0]);const T=dn(l,b);Ca(_,_,w*Math.sign(S)),Ca(b,b,T),Gh(l,_,b)}fe(c,0,0,0)}fe(a,h[0]*l[0]+p[0]*l[1],h[1]*l[0]+p[1]*l[1],h[2]*l[0]+p[2]*l[1]),this.vertexAttributePosition[3*i+0]=n[0]+a[0]+c[0]*f,this.vertexAttributePosition[3*i+1]=n[1]+a[1]+c[1]*f,this.vertexAttributePosition[3*i+2]=n[2]+a[2]+c[2]*f;const y=Qw;It(y,this.builder.profileVertexAndNormalData[o+2],this.builder.profileVertexAndNormalData[o+3]),this.vertexAttributeNormal[3*i+0]=h[0]*y[0]+p[0]*y[1]+c[0]*m,this.vertexAttributeNormal[3*i+1]=h[1]*y[0]+p[1]*y[1]+c[1]*m,this.vertexAttributeNormal[3*i+2]=h[2]*y[0]+p[2]*y[1]+c[2]*m}}createGeometryData(){const e=[[A.POSITION,this.builder.vertexIndices],[A.NORMAL,this.builder.normalIndices]],i=[[A.POSITION,new ht(this.vertexAttributePosition,3,!0)],[A.NORMAL,new ht(this.vertexAttributeNormal,3,!0)]];if(this.vertexAttributeColor){const r=this.builder.vertexIndices.length;e.push([A.COLOR,new Array(r).fill(0)]),i.push([A.COLOR,new ht(this.vertexAttributeColor,4)])}return{vertexAttributes:i,indices:e}}onPathChanged(){super.onPathChanged(),this.bake(this.size)}intersect(e,i,r){const s=this.builder.vertexIndices,n=new ht(this.vertexAttributePosition,3),o=s.length/3;MI(e,i,0,o,s,n,void 0,void 0,r)}},U0t=class extends YRe{constructor(e,i,r,s){super(e),this.sizeAttributeValue=i,this.colorAttributeValue=r,this.opacityAttributeValue=s,this.vvData=null,this.baked=new ZRe(e),this.vvData=Qs(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n+0]=i,this.vvData[4*n+1]=r,this.vvData[4*n+2]=s;const o=n===0||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=o?1:0}}createGeometryData(){return{vertexAttributes:[[A.POSITION,new ht(this.builder.originData,3,!0)],[A.PROFILERIGHT,new ht(this.builder.profileRightAxisData,4,!0)],[A.PROFILEUP,new ht(this.builder.profileUpAxisData,4,!0)],[A.PROFILEVERTEXANDNORMAL,new ht(this.builder.profileVertexAndNormalData,4,!0)],[A.FEATUREVALUE,new ht(this.vvData,4,!0)]],indices:[[A.POSITION,this.builder.pathVertexIndices],[A.PROFILERIGHT,this.builder.vertexIndices],[A.PROFILEUP,this.builder.vertexIndices],[A.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[A.FEATUREVALUE,this.builder.pathVertexIndices]]}}};const V0t=M(),Qw=et(),Vee=et(),k0t=et(),fX=M(),AS=M(),B0t=M(),z0t=M(),oD=M(),G0t=WRe(),Zue=We(),$B=8;function j0t(t,e){const i=A.FEATUREVALUE;t.attributes.add(i,"vec4");const r=t.vertex;r.code.add(x`
  bool isCapVertex() {
    return ${i}.w == 1.0;
  }
  `),r.uniforms.add(new zi("size",s=>s.size)),e.vvSize?(r.uniforms.add(new ni("vvSizeMinSize",s=>s.vvSizeMinSize)),r.uniforms.add(new ni("vvSizeMaxSize",s=>s.vvSizeMaxSize)),r.uniforms.add(new ni("vvSizeOffset",s=>s.vvSizeOffset)),r.uniforms.add(new ni("vvSizeFactor",s=>s.vvSizeFactor)),r.code.add(x`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${i}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):r.code.add(x`vec2 getSize(){
return size;
}`),e.vvOpacity?(r.constants.add("vvOpacityNumber","int",$B),r.uniforms.add([new Aa("vvOpacityValues",s=>s.vvOpacityValues,$B),new Aa("vvOpacityOpacities",s=>s.vvOpacityOpacities,$B)]),r.code.add(x`
    vec4 applyOpacity(vec4 color) {
      float value = ${i}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):r.code.add(x`vec4 applyOpacity(vec4 color){
return color;
}`),e.vvColor?(r.constants.add("vvColorNumber","int",qp),r.uniforms.add([new Aa("vvColorValues",s=>s.vvColorValues,qp),new O8("vvColorColors",s=>s.vvColorColors,qp)]),r.code.add(x`
    vec4 getColor() {
      float value = ${i}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):r.code.add(x`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),t.include(TI),t.attributes.add(A.PROFILERIGHT,"vec4"),t.attributes.add(A.PROFILEUP,"vec4"),t.attributes.add(A.PROFILEVERTEXANDNORMAL,"vec4"),r.code.add(x`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),r.code.add(x`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),r.code.add(x`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),r.code.add(x`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}let H0t=class extends oee{constructor(){super(...arguments),this.size=Ni(1,1)}};function q0t(t){const e=new Ui,{vertex:i,fragment:r}=e;switch(Kc(i,t),e.varyings.add("vpos","vec3"),e.include(j0t,t),t.output!==k.Color&&t.output!==k.Alpha||(e.include(nc,t),e.include(Jx,t),e.include(yA,t),e.varyings.add("vnormal","vec3"),e.varyings.add("vcolor","vec4"),t.hasMultipassTerrain&&e.varyings.add("depth","float"),i.code.add(x`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${t.output===k.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),e.include(sh,t),t.output){case k.Alpha:e.include(en,t),r.uniforms.add(new He("opacity",s=>s.opacity)),r.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `);break;case k.Color:e.include(en,t),e.include(Kx,t),e.include(UI,t),e.include(Jx,t),e.include(XOe,t),rf(r,t),VI(r),OA(r),r.uniforms.add([i.uniforms.get("localOrigin"),new ni("ambient",s=>s.ambient),new ni("diffuse",s=>s.diffuse),new ni("specular",s=>s.specular),new He("opacity",s=>s.opacity)]),r.include(sg),rg(r),r.code.add(x`
        void main() {
          discardBySlice(vpos);
          ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          gl_FragColor = vec4(shadedColor, combinedOpacity);
          gl_FragColor = highlightSlice(gl_FragColor, vpos);
          ${t.transparencyPassType===$t.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
        }
      `);break;case k.Depth:case k.Shadow:case k.ShadowHighlight:case k.ShadowExcludeHighlight:e.include(nc,t),Hx(e),e.varyings.add("depth","float"),i.code.add(x`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),e.include(en,t),e.include(Qy,t),r.code.add(x`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case k.Normal:e.include(nc,t),e.include(AP,t),DC(i),e.varyings.add("vnormal","vec3"),i.code.add(x`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(en,t),r.code.add(x`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case k.Highlight:e.include(nc,t),e.include(AP,t),e.varyings.add("vnormal","vec3"),i.code.add(x`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(en,t),e.include(g0,t),r.code.add(x`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const W0t=Object.freeze(Object.defineProperty({__proto__:null,build:q0t},Symbol.toStringTag,{value:"Module"})),JRe=new Map([[A.POSITION,0],[A.PROFILERIGHT,1],[A.PROFILEUP,2],[A.PROFILEVERTEXANDNORMAL,3],[A.FEATUREVALUE,4]]);let X0t=class extends H0t{constructor(){super(...arguments),this.ambient=Xe(.2,.2,.2),this.diffuse=Xe(.8,.8,.8),this.specular=Xe(0,0,0),this.opacity=1}},KRe=class QRe extends ji{initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Mt.WEBGL2,i.spherical=e.viewingMode===st.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new ki(e.rctx,QRe.shader.get().build(this.configuration),JRe)}initializePipeline(){const e=this.configuration.transparencyPassType,i=this.configuration,r=e===$t.NONE,s=e===$t.FrontFace;return Qt({blending:i.output!==k.Color&&i.output!==k.Alpha||!i.transparent?null:r?Qu:y0(e),culling:i.hasSlicePlane&&!i.transparent&&i.doubleSidedMode!==ys.None?m2e:null,depthTest:{func:T1(e)},depthWrite:r||s?pc:null,colorWrite:ui,stencilWrite:i.hasOccludees?Ym:null,stencilTest:i.hasOccludees?S1:null,polygonOffset:r||s?null:P8})}};KRe.shader=new Vi(W0t,()=>ee(()=>import("./Path.glsl-39132c8b.js"),[],import.meta.url));let io=class extends uo{constructor(){super(...arguments),this.output=k.Color,this.doubleSidedMode=ys.None,this.transparencyPassType=$t.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}};u([z({count:k.COUNT})],io.prototype,"output",void 0),u([z({count:ys.COUNT})],io.prototype,"doubleSidedMode",void 0),u([z({count:$t.COUNT})],io.prototype,"transparencyPassType",void 0),u([z()],io.prototype,"spherical",void 0),u([z()],io.prototype,"receiveShadows",void 0),u([z()],io.prototype,"receiveAmbientOcclusion",void 0),u([z()],io.prototype,"vvSize",void 0),u([z()],io.prototype,"vvColor",void 0),u([z()],io.prototype,"vvOpacity",void 0),u([z()],io.prototype,"hasSlicePlane",void 0),u([z()],io.prototype,"transparent",void 0),u([z()],io.prototype,"hasOccludees",void 0),u([z()],io.prototype,"hasMultipassTerrain",void 0),u([z()],io.prototype,"cullAboveGround",void 0),u([z()],io.prototype,"doublePrecisionRequiresObfuscation",void 0),u([z({constValue:St.Disabled})],io.prototype,"pbrMode",void 0),u([z({constValue:!0})],io.prototype,"hasVvInstancing",void 0),u([z({constValue:!1})],io.prototype,"useCustomDTRExponentForWater",void 0),u([z({constValue:!1})],io.prototype,"useFillLights",void 0);let Y0t=class eMe extends x1{constructor(e){super(e,new J0t),this.supportsEdges=!0,this._vertexAttributeLocations=JRe,this._configuration=new io,this._vertexBufferLayout=eMe.getVertexBufferLayout()}getConfiguration(e,i){return this._configuration.output=e,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e!==k.Color&&e!==k.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?ys.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?ys.WindingOrder:ys.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!i.ssaoHelper.active&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(e){return e!==k.Shadow&&e!==k.ShadowExcludeHighlight&&e!==k.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(e,i,r,s,n,o){const a=e;if(!HRe(a))return;const l=a.path,c=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){const b=this.parameters.vvSizeOffset,w=this.parameters.vvSizeFactor,S=this.parameters.vvSizeMinSize,T=this.parameters.vvSizeMaxSize,E=l.sizeAttributeValue;c[0]*=we(b[0]+E*w[0],S[0],T[0]),c[1]*=we(b[2]+E*w[2],S[2],T[2])}const h=Math.max(c[0],c[1]),p=e.boundingInfo;if(C(p))return void this._intersectTriangles(l,c,s,n,o);const f=Cx(p.bbMin[0]-h,p.bbMin[1]-h,p.bbMin[2]-h,p.bbMax[0]+h,p.bbMax[1]+h,p.bbMax[2]+h),m=[n[0]-s[0],n[1]-s[1],n[2]-s[2]],y=Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2]),_=[y/m[0],y/m[1],y/m[2]];KQ(f,s,_,r.tolerance)&&this._intersectTriangles(l,c,s,n,o)}_intersectTriangles(e,i,r,s,n){e.baked.size&&e.baked.size[0]===i[0]&&e.baked.size[1]===i[1]||e.baked.bake(i),e.baked.intersect(r,s,n)}createBufferWriter(){return new AA(this._vertexBufferLayout)}requiresSlot(e,i){switch(i){case k.Shadow:case k.ShadowHighlight:case k.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;case k.Color:case k.Alpha:case k.Depth:case k.Normal:case k.Highlight:case k.ObjectAndLayerIdColor:return e===(this.parameters.transparent?Fe.TRANSPARENT_MATERIAL:Fe.OPAQUE_MATERIAL)||e===Fe.DRAPED_MATERIAL;default:return!1}}createGLMaterial(e){return new Z0t(e)}static getVertexBufferLayout(){return cs().vec3f(A.POSITION).vec4f(A.PROFILERIGHT).vec4f(A.PROFILEUP).vec4f(A.PROFILEVERTEXANDNORMAL).vec4f(A.FEATUREVALUE)}},Z0t=class extends w1{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){(C(this.technique)||e.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output!==k.Color&&this._output!==k.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(KRe,e)}},J0t=class extends X0t{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}};const K0t=["polyline"];let Q0t=class extends ag{constructor(e,i,r,s){super(e,i,r,s),this._intrinsicSize=Ni(1,1),this._upVectorAlignment=zv.Path,this._stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){const e=v(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height,i=v(this.symbolLayer.height)?this.symbolLayer.height:e;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[e,1,i],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=RP(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1};const r=this.symbolLayer.anchor||"center";this._upVectorAlignment=this.symbolLayer.profileRotation==="heading"?zv.World:zv.Path;const s=this.symbolLayer.profile||"circle";switch(s){default:case"circle":this._profile=I0t(LAe);break;case"quad":this._profile=$0t()}let n=[0,0];switch(r!=="center"&&(n={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[r],this._profile.translate(n[0],n[1])),this.symbolLayer.join){case"round":this._extruder=new IB(0,$Ae);break;case"bevel":this._extruder=new IB(0,1);break;case"miter":this._extruder=new IB(.8*Math.PI,1);break;default:this._extruder=new N0t}const o=this.symbolLayer.cap||"butt";switch(o){case"none":this._startCap=new Xue,this._endCap=new Xue;break;case"butt":default:this._startCap=new nD(this._profile,0),this._endCap=new nD(this._profile,0,!0);break;case"square":this._startCap=new nD(this._profile,-.5),this._endCap=new nD(this._profile,.5,!0);break;case"round":{const m=s==="quad";this._startCap=new Yue({profile:this._profile,flip:!1,breakNormals:m,subdivisions:YW}),this._endCap=new Yue({profile:this._profile,flip:!0,breakNormals:m,subdivisions:YW});break}}const a=In(this.symbolLayer,"material","color"),l=this._getCombinedOpacityAndColor(a),c=Kl(l),h=l[3],p=h<1||this.needsDrivenTransparentPass,f={diffuse:c,ambient:c,opacity:h,transparent:p,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:p||o==="none"?Or.None:Or.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(It(this._intrinsicSize,e,i),!X5(this._intrinsicSize[0])||!X5(this._intrinsicSize[1])))throw new W("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||Ca(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates.enabled){const m={...f,...this._fastUpdates.materialParameters,size:X_e(this._intrinsicSize)};this._material=new Y0t(m)}else f.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new e0(f);this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,K0t,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new cf),s=e.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}layerOpacityChanged(){const e=In(this.symbolLayer,"material","color"),i=this._getCombinedOpacity(e),r=i<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:i,transparent:r})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,c1)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables"||!MP(this._fastUpdates,i,this._vvConvertOptions))return $n.Recreate_Symbol;this._material.setParameters(this._fastUpdates.materialParameters)}return $n.Fast_Update}_getVertexData(e){let i=0;const r=e.paths,s=[],n=e.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const f of r)i+=f.length;const l=ru(3*i),c=ru(3*i);let h=0;for(const f of r){s.push({index:h,numVertices:f.length});for(const m of f)l[h++]=m[0],l[h++]=m[1],l[h++]=e.hasZ?m[2]:0}let p=!0;return v(o)&&!n.equals(o)&&(p=Es(l,n,0,l,o,0,i)),v(o)&&!o.equals(a)?Es(l,o,0,c,a,0,i):this._copyVertices(l,0,c,0,i),{pathVertexDataInfos:s,vertexDataES:l,vertexDataRS:c,projectionSuccess:p,terrainElevation:0}}_copyVertices(e,i,r,s,n){i*=3,s*=3;for(let o=0;o<n;++o)r[s++]=e[i++],r[s++]=e[i++],r[s++]=e[i++]}_createAs3DShape(e,i,r,s){const n=e.geometry,o=new Array,a=n.spatialReference,l=Nn(),c=this._context.renderCoordsHelper;iMe.spatialReference=a;const h=this._getVertexData(n);if(!h.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(h.pathVertexDataInfos.length===0)return n.paths.length!==0&&n.paths.some(y=>y.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;for(const y of h.pathVertexDataInfos){const _=y.index,b=y.numVertices;if(b<2||v(this._context.clippingExtent)&&($r(l),Wu(l,h.vertexDataES,3*_,b),!Pp(l,this._context.clippingExtent)))continue;const w=[];for(let F=_;F<_+3*b;){const V=F++,B=F++,G=F++,te=new P0t;fe(te.posES,h.vertexDataES[V],h.vertexDataES[B],h.vertexDataES[G]);const se=Vht(te.posES,this._context.elevationProvider,r,c);fe(jr,h.vertexDataRS[V],h.vertexDataRS[B],h.vertexDataRS[G]),c.setAltitude(jr,se),he(te.pos,jr),w.push(te)}const S=new L0t(w);tMe(S,this._upVectorAlignment,this._context.renderCoordsHelper);const T=new F0t(S,this._profile,this._extruder,this._startCap,this._endCap);let E=null;if(this._fastUpdates.enabled){const F=this._fastUpdates.visualVariables,V=F.size?Iy(F.size.field,e):0,B=F.color?Iy(F.color.field,e):0,G=F.opacity?Iy(F.opacity.field,e):0;E=new U0t(T,V,B,G)}else{const F=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const G=i.size;F[0]*=Jue(G[0],G[2]==="symbol-value"?this.symbolLayer.height||0:G[2],this.symbolLayer.width||0),F[1]*=Jue(G[2],G[0]==="symbol-value"?this.symbolLayer.width||0:G[0],this.symbolLayer.height||0)}let V;this._drivenProperties.color&&(V=i.color),this._drivenProperties.opacity&&i.opacity!=null&&(V=V?[V[0],V[1],V[2],i.opacity]:[1,1,1,i.opacity]);const B=new ZRe(T);B.bake(F),V&&B.bakeVertexColors(V),E=B}const{vertexAttributes:O,indices:R}=E.createGeometryData(),L=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),P=new E0t(this._material,O,R,E,a,this._upVectorAlignment,this._stencilWidth,L);P.transformation=E.xform,o.push(P)}if(o.length===0)return null;const p={layerUid:this._context.layer.uid,graphicUid:s},f=new v0({geometries:o,metadata:p}),m=new og(this,f,o,null,null,t_t,r);return m.alignedSampledElevation=h.terrainElevation,m.needsElevationUpdates=c1(r.mode),m}};function tMe(t,e,i){switch(e){default:case zv.World:for(const r of t.vertices){ve(jr,r.pos,t.offset),i.worldUpAtPosition(jr,jr),r.setFrameFromUpVector(jr),r.rotationFrameUp=r.frame.up,It(r.rotationRight,1,0),ue(jr,r.frame.up,Ae(r.frame.up,r.vLeft)),be(jr,r.vLeft,jr),Pa(jr,jr),Oe(jr,jr),ue(Z0,r.frame.up,Ae(r.frame.up,r.vRight)),be(Z0,r.vRight,Z0),Oe(Z0,Z0),Et(Kue,r.rotationFrameUp,r.vLeft);const s=Math.sign(Ae(Kue,r.vRight));if(r.rotationAngle=s*(Math.PI-Dn(Ae(jr,Z0))),Math.abs(r.rotationAngle)>0){const o=vV(Math.cos(.5*r.rotationAngle));pX(r.miterStretch,o-1+1,0,0,1)}const n=Math.PI-r.rotationAngle;r.maxStretchDistance=Math.abs(r.vMinSiblingLength/Math.cos(.5*n))}break;case zv.Path:ve(jr,t.vertices[0].pos,t.offset),i.worldUpAtPosition(jr,jr),D0t(t,jr);for(const r of t.vertices){const s=Math.sign(Ae(r.frame.right,r.vRight));Et(r.rotationFrameUp,r.vRight,r.vLeft),ue(r.rotationFrameUp,r.rotationFrameUp,s),Oe(r.rotationFrameUp,r.rotationFrameUp);const n=Ae(r.rotationFrameUp,r.frame.up),o=Ae(r.rotationFrameUp,r.frame.right);if(ue(jr,r.frame.up,-o),ue(Z0,r.frame.right,n),ve(jr,jr,Z0),Oe(jr,jr),M0t(r.rotationRight,r.frame,jr),Pa(jr,r.vLeft),r.rotationAngle=-s*(Math.PI-Dn(Ae(jr,r.vRight))),Math.abs(r.rotationAngle)>0){const l=vV(Math.cos(.5*r.rotationAngle));pX(r.miterStretch,1+(l-1)*r.rotationRight[0]*r.rotationRight[0],(l-1)*r.rotationRight[0]*r.rotationRight[1],(l-1)*r.rotationRight[0]*r.rotationRight[1],1+(l-1)*r.rotationRight[1]*r.rotationRight[1])}const a=Math.PI-r.rotationAngle;r.maxStretchDistance=Math.abs(r.vMinSiblingLength*vV(Math.cos(.5*a)))}}}function Jue(t,e,i){switch(t){case"symbol-value":return i;case"proportional":return e;default:return t}}function e_t(t,e,i,r){let s=0;for(const n of t.vertices)i(n.posES,LB),s+=LB.sampledElevation,ve(jr,n.pos,t.offset),r.setAltitude(jr,LB.z),be(n.pos,jr,t.offset);return t.updatePathVertexInformation(),s/t.vertices.length}function t_t(t,e,i,r,s){const n=t.stageObject,o=n.geometries;let a=0;i_t.spatialReference=s.spatialReference;for(const l of o){if(!HRe(l))continue;const c=l.path,h=c.builder.path,p=l.geometrySR;iMe.spatialReference=p,a+=e_t(h,e,r,s),l.upVectorAlignment!==zv.World&&tMe(h,l.upVectorAlignment,s),c.onPathChanged(),l.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(l)}return a/o.length}const i_t=_0(0,0,0,null),iMe=_0(0,0,0,null),jr=M(),Z0=M(),Kue=M(),LB=new $I;function r_t(t,e,i,r,s=1){if(i.isGeographic&&r===st.Global){const c=ru(e.length),h=e.length,p=tr(i);for(let f=0;f<h;f+=3)iJ(e,f,c,f,p);e=c}It(Cn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<e.length;c+=3)Cn[0]=Math.min(Cn[0],e[c]),Cn[1]=Math.min(Cn[1],e[c+1]);const n=Cn[0]%s,o=Cn[1]%s,a=Cn[0]-n,l=Cn[1]-o;for(let c=0;c<e.length;c+=3){const h=c/3*4;t[h]=(e[c]-a)/s,t[h+1]=(e[c+1]-l)/s,t[h+2]=a/s,t[h+3]=l/s}}function rMe(t,e,i,r,s=1){fe(rb,1,0,0),fe(sb,0,1,0),fe(c2,0,0,1),o_t(DB,i),s_t(i,Que)&&n_t(Que,rb,sb,c2,r,DB),It(Cn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),It(nb,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let h=0;h<i.length;h+=3){fe(l2,i[h],i[h+1],i[h+2]);const p=Ae(rb,l2),f=Ae(sb,l2);Cn[0]=Math.min(Cn[0],p),Cn[1]=Math.min(Cn[1],f),nb[0]=Math.max(nb[0],p),nb[1]=Math.max(nb[1],f)}const n=Ae(c2,DB);FB(J0,Cn[0],Cn[1],n,rb,sb,c2),FB(ob,nb[0],Cn[1],n,rb,sb,c2),FB(ab,Cn[0],nb[1],n,rb,sb,c2),be(ob,ob,J0),ue(ob,ob,.5),be(ab,ab,J0),ue(ab,ab,.5),ve(J0,J0,ob),ve(J0,J0,ab);const o=Cn[0]%s,a=Cn[1]%s,l=Cn[0]-o,c=Cn[1]-a;for(let h=0;h<i.length;h+=3){fe(l2,i[h],i[h+1],i[h+2]);const p=h/3,f=4*p;t[f]=(Ae(rb,l2)-l)/s,t[f+1]=(Ae(sb,l2)-c)/s,t[f+2]=l/s,t[f+3]=c/s;const m=9*p;for(let y=0;y<3;y++)e[m+y]=J0[y],e[m+y+3]=ob[y],e[m+y+6]=ab[y]}}const DB=M(),l2=M(),Que=qi(),rb=M(),sb=M(),c2=M(),Cn=et(),nb=et(),J0=M(),ob=M(),ab=M();function s_t(t,e){const i=t.length/3-1;return wve(t,e,0,Math.floor(i/3),Math.floor(i*(2/3)))}function n_t(t,e,i,r,s,n){v(s)?(s.basisMatrixAtPosition(n,Af),fe(aD,Af[0],Af[1],Af[2]),fe(lD,Af[4],Af[5],Af[6]),fe(NB,Af[8],Af[9],Af[10])):(fe(aD,1,0,0),fe(lD,0,1,0),fe(NB,0,0,1));const o=t;Ae(o,NB)<0&&ue(o,o,-1),he(r,o);const a=Ae(o,lD),l=Ae(o,aD);Math.abs(a)<Math.abs(l)?(zw(e,aD,o,-l),Oe(e,e),Et(i,e,o),Oe(i,i),ue(i,i,-1)):(zw(i,lD,o,-a),Oe(i,i),Et(e,i,o),Oe(e,e))}const Af=We(),aD=M(),lD=M(),NB=M();function o_t(t,e){fe(TO,0,0,0);for(let i=0;i<e.length-3;i+=3)TO[0]+=e[i],TO[1]+=e[i+1],TO[2]+=e[i+2];ue(t,TO,1/(e.length/3-1))}const TO=M();function FB(t,e,i,r,s,n,o){fe(t,e*s[0]+i*n[0]+r*o[0],e*s[1]+i*n[1]+r*o[1],e*s[2]+i*n[2]+r*o[2])}function a_t(t){const e=new Ui,{vertex:i,fragment:r}=e,s=t.output===k.Depth,n=t.hasMultipassTerrain&&(t.output===k.Color||t.output===k.Alpha);return Kc(i,t),e.include(nc,t),e.include(vT,t),e.include(A8,t),e.attributes.add(A.POSITION,"vec3"),e.varyings.add("vpos","vec3"),n&&e.varyings.add("depth","float"),s&&(e.include(Qy,t),Hx(e),s1(e)),i.code.add(x`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();
      ${n?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${s?x`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:x`transformPosition(proj, view, vpos);`}
    }
  `),e.include(en,t),n&&e.include(sh,t),r.include(sg),r.uniforms.add(new Si("eColor",o=>o.color)),t.output===k.Highlight&&e.include(g0,t),r.code.add(x`
  void main() {
    discardBySlice(vpos);
    ${n?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${t.hasVertexColors?"vColor * eColor;":"eColor;"}

    ${t.output===k.ObjectAndLayerIdColor?x`fColor.a = 1.0;`:""}

    if (fColor.a < ${x.float(la)}) {
      discard;
    }

    ${t.output===k.Alpha?x`gl_FragColor = vec4(fColor.a);`:""}

    ${t.output===k.Color?x`gl_FragColor = highlightSlice(fColor, vpos); ${t.transparencyPassType===$t.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${t.output===k.Highlight?x`outputHighlight();`:""};
    ${t.output===k.Depth?x`outputDepth(linearDepth);`:""};
    ${t.output===k.ObjectAndLayerIdColor?x`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const l_t=Object.freeze(Object.defineProperty({__proto__:null,build:a_t},Symbol.toStringTag,{value:"Module"}));let sMe=class nMe extends ji{initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Mt.WEBGL2}initializeProgram(e){return new ki(e.rctx,nMe.shader.get().build(this.configuration),Li)}_createPipeline(e,i){const r=this.configuration,s=e===$t.NONE,n=e===$t.FrontFace;return Qt({blending:r.output!==k.Color&&r.output!==k.Alpha||!r.transparent?null:s?Qu:y0(e),culling:i8(r.cullFace),depthTest:{func:T1(e)},depthWrite:(s||n)&&r.writeDepth?pc:null,colorWrite:ui,stencilWrite:r.hasOccludees?Ym:null,stencilTest:r.hasOccludees?i?d1:S1:null,polygonOffset:s||n?r.polygonOffset?c_t:null:I8(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,i){return i?this._occludeePipelineState:super.getPipelineState(e,i)}};sMe.shader=new Vi(l_t,()=>ee(()=>import("./ColorMaterial.glsl-398d7709.js"),[],import.meta.url));const c_t={factor:1,units:1};let Oc=class extends uo{constructor(){super(...arguments),this.output=k.Color,this.cullFace=Or.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=$t.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1}};u([z({count:k.COUNT})],Oc.prototype,"output",void 0),u([z({count:Or.COUNT})],Oc.prototype,"cullFace",void 0),u([z()],Oc.prototype,"hasSlicePlane",void 0),u([z()],Oc.prototype,"hasVertexColors",void 0),u([z()],Oc.prototype,"transparent",void 0),u([z()],Oc.prototype,"polygonOffset",void 0),u([z()],Oc.prototype,"enableOffset",void 0),u([z()],Oc.prototype,"writeDepth",void 0),u([z()],Oc.prototype,"hasOccludees",void 0),u([z({count:$t.COUNT})],Oc.prototype,"transparencyPassType",void 0),u([z()],Oc.prototype,"hasMultipassTerrain",void 0),u([z()],Oc.prototype,"cullAboveGround",void 0),u([z()],Oc.prototype,"objectAndLayerIdColorInstanced",void 0);let ehe=class extends Eee{constructor(e){super(e,new h_t),this.supportsEdges=!0,this._configuration=new Oc}getConfiguration(e,i){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<M8,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}requiresSlot(e,i){return i===k.Color||i===k.Alpha||i===k.Highlight||i===k.Depth&&this.parameters.writeLinearDepth||i===k.ObjectAndLayerIdColor?e===Fe.DRAPED_MATERIAL?!0:i===k.Highlight?e===Fe.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?Fe.TRANSPARENT_MATERIAL:Fe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Fe.OPAQUE_MATERIAL):!1}createGLMaterial(e){return new u_t(e)}createBufferWriter(){return new AA(de("enable-feature:objectAndLayerId-rendering")?Ypt:AOe)}},u_t=class extends w1{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==k.Color&&this._output!==k.Alpha||this._updateOccludeeState(e),this.ensureTechnique(sMe,e)}},h_t=class extends TA{constructor(){super(...arguments),this.color=Am,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Or.None,this.hasOccludees=!1}};var Uo;(function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Cross=2]="Cross",t[t.ForwardDiagonal=3]="ForwardDiagonal",t[t.BackwardDiagonal=4]="BackwardDiagonal",t[t.DiagonalCross=5]="DiagonalCross",t[t.COUNT=6]="COUNT"})(Uo||(Uo={}));const mX=.70710678118,the=mX,d_t=.08715574274;function p_t(t){const e=new Ui,i=t.hasMultipassTerrain&&(t.output===k.Color||t.output===k.Alpha);t.draped||e.extensions.add("GL_OES_standard_derivatives");const{vertex:r,fragment:s}=e;Kc(r,t),e.include(nc,t),e.include(vT,t),t.draped?r.uniforms.add(new He("worldToScreenRatio",(a,l)=>1/l.screenToPCSRatio)):e.attributes.add(A.BOUNDINGRECT,"mat3"),e.attributes.add(A.POSITION,"vec3"),e.attributes.add(A.UVMAPSPACE,"vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),i&&e.varyings.add("depth","float");const n=t.style===Uo.ForwardDiagonal||t.style===Uo.BackwardDiagonal||t.style===Uo.DiagonalCross;n&&r.code.add(x`
      const mat2 rotate45 = mat2(${x.float(mX)}, ${x.float(-the)},
                                 ${x.float(the)}, ${x.float(mX)});
    `),t.draped||(rf(r,t),r.uniforms.add(new He("worldToScreenPerDistanceRatio",(a,l)=>1/l.camera.perScreenPixelRatio)),r.code.add(x`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),r.code.add(x`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),r.code.add(x`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${x.float(d_t)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),r.code.add(x`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${n?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${n?" * rotate45":""};

      ${t.draped?"":x`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${x.float(t.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);const o=t.output===k.Depth;return o&&(e.include(Qy,t),Hx(e),s1(e)),r.code.add(x`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${i?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${o?x`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:x`transformPosition(proj, view, vpos);`}
    }
  `),e.include(en,t),s.include(sg),t.draped&&s.uniforms.add(new He("texelSize",(a,l)=>1/l.camera.pixelRatio)),t.output===k.Highlight&&e.include(g0,t),i&&e.include(sh,t),t.output!==k.Highlight&&(s.code.add(x`
      const float lineWidth = ${x.float(t.lineWidth)};
      const float spacing = ${x.float(t.patternSpacing)};
      const float spacingINV = ${x.float(1/t.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),t.draped||s.code.add(x`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),s.uniforms.add(new Si("uColor",a=>a.color)),s.code.add(x`
    void main() {
      discardBySlice(vpos);
      ${i?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${t.hasVertexColors?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${t.output!==k.Highlight?x`color.a *= ${f_t(t)};`:""}

      ${t.output===k.ObjectAndLayerIdColor?x`color.a = 1.0;`:""}

      if (color.a < ${x.float(la)}) {
        discard;
      }

      ${t.output===k.Alpha?x`gl_FragColor = vec4(color.a);`:""}

      ${t.output===k.Color?x`gl_FragColor = color; ${t.transparencyPassType===$t.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
      ${t.output===k.Highlight?x`outputHighlight();`:""}
      ${t.output===k.Depth?x`outputDepth(linearDepth);`:""};
    }
  `),e}function f_t(t){function e(i){return t.draped?x`coverage(vuv.${i}, texelSize)`:x`sample(vuv.${i})`}switch(t.style){case Uo.ForwardDiagonal:case Uo.Horizontal:return e("y");case Uo.BackwardDiagonal:case Uo.Vertical:return e("x");case Uo.DiagonalCross:case Uo.Cross:return x`
        1.0 - (1.0 - ${e("x")}) * (1.0 - ${e("y")})
      `;default:return"0.0"}}const m_t=Object.freeze(Object.defineProperty({__proto__:null,build:p_t},Symbol.toStringTag,{value:"Module"}));let oMe=class aMe extends ji{initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Mt.WEBGL2}initializeProgram(e){return new ki(e.rctx,aMe.shader.get().build(this.configuration),lMe)}_setPipelineState(e,i){const r=this.configuration,s=e===$t.NONE,n=e===$t.FrontFace;return Qt({blending:r.output===k.Color||r.output===k.Alpha?s?Qu:y0(e):null,culling:i8(r.cullFace),depthTest:{func:T1(e)},depthWrite:s?r.writeDepth?pc:null:R8(e),colorWrite:ui,stencilWrite:r.hasOccludees?Ym:null,stencilTest:r.hasOccludees?i?d1:S1:null,polygonOffset:s||n?r.polygonOffset?g_t:null:I8(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,i){return i?this._occludeePipelineState:super.getPipelineState(e,i)}};oMe.shader=new Vi(m_t,()=>ee(()=>import("./Pattern.glsl-389b071d.js"),[],import.meta.url));const g_t={factor:1,units:1};let el=class extends uo{constructor(){super(...arguments),this.output=k.Color,this.cullFace=Or.None,this.transparencyPassType=$t.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};u([z({count:k.COUNT})],el.prototype,"output",void 0),u([z({count:Or.COUNT})],el.prototype,"cullFace",void 0),u([z({count:Uo.COUNT})],el.prototype,"style",void 0),u([z({count:$t.COUNT})],el.prototype,"transparencyPassType",void 0),u([z()],el.prototype,"hasSlicePlane",void 0),u([z()],el.prototype,"hasVertexColors",void 0),u([z()],el.prototype,"polygonOffset",void 0),u([z()],el.prototype,"writeDepth",void 0),u([z()],el.prototype,"hasOccludees",void 0),u([z()],el.prototype,"patternSpacing",void 0),u([z()],el.prototype,"lineWidth",void 0),u([z()],el.prototype,"enableOffset",void 0),u([z()],el.prototype,"draped",void 0),u([z()],el.prototype,"hasMultipassTerrain",void 0),u([z()],el.prototype,"cullAboveGround",void 0);const lMe=new Map([[A.POSITION,0],[A.COLOR,3],[A.UVMAPSPACE,4],[A.BOUNDINGRECT,5]]);let kee=class extends Eee{constructor(e){super(e,new v_t),this.supportsEdges=!0,this._vertexAttributeLocations=lMe,this._configuration=new el}getConfiguration(e,i){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<M8,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}requiresSlot(e,i){return i===k.Color||i===k.Alpha||i===k.Highlight||i===k.Depth&&this.parameters.writeLinearDepth?e===Fe.DRAPED_MATERIAL?!0:i===k.Highlight?e===Fe.OPAQUE_MATERIAL:e===(this.parameters.writeDepth?Fe.TRANSPARENT_MATERIAL:Fe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):!1}createGLMaterial(e){return new y_t(e)}createBufferWriter(){const e=cs().vec3f(A.POSITION).vec4u8(A.COLOR).vec4f(A.UVMAPSPACE);return this.parameters.draped||e.mat3f(A.BOUNDINGRECT),new __t(e)}},y_t=class extends w1{_updateParameters(e){return this.ensureTechnique(oMe,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==k.Color&&this._output!==k.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},__t=class extends AA{write(e,i,r,s,n){for(const o of this.vertexBufferLayout.fieldNames){const a=r.vertexAttributes.get(o),l=r.indices.get(o);if(a&&l)switch(o){case A.POSITION:{Ct(a.size===3);const c=s.getField(o,Lr);c&&C8(l,a.data,e,c,n);break}case A.COLOR:{Ct(a.size===3||a.size===4);const c=s.getField(o,Na);c&&tee(l,a.data,a.size,c,n);break}case A.UVMAPSPACE:{Ct(a.size===4);const c=s.getField(o,iu);c&&NC(l,a.data,c,n);break}case A.BOUNDINGRECT:{Ct(a.size===9);const c=s.getField(o,n1);c&&this.writeBoundingRect(l,a.data,e,c,n);break}}}}writeBoundingRect(e,i,r,s,n){const o=r,a=s.typedBuffer,l=s.typedBufferStride,c=e.length;n*=l;for(let h=0;h<c;++h){const p=9*e[h],f=i[p],m=i[p+1],y=i[p+2];a[n]=o[0]*f+o[4]*m+o[8]*y+o[12],a[n+1]=o[1]*f+o[5]*m+o[9]*y+o[13],a[n+2]=o[2]*f+o[6]*m+o[10]*y+o[14];for(let _=3;_<9;++_)a[n+_]=i[p+_];n+=l}}},v_t=class extends TA{constructor(){super(...arguments),this.color=si(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Or.None,this.hasOccludees=!1,this.style=Uo.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}};function b_t(t,e,i){return x_t(w_t(t),e,i)}function w_t(t){return t&&t.pattern||null}function x_t(t,e,i){return v(t)?t.style==="none"||t.style==="solid"?(t.style==="none"&&(e.color=si(0,0,0,0),e.transparent=!0),new ehe(e)):(e.style=T_t(t.style),e.draped=i.isDraped,new kee(e)):new ehe(e)}function T_t(t){switch(t){case"horizontal":return Uo.Horizontal;case"vertical":return Uo.Vertical;case"cross":return Uo.Cross;case"forward-diagonal":return Uo.ForwardDiagonal;case"backward-diagonal":return Uo.BackwardDiagonal;case"diagonal-cross":return Uo.DiagonalCross;default:return}}function S_t(t){return t.material instanceof kee&&!t.material.parameters.draped}function E_t(t,e){if(S_t(t)){const i=t.vertexAttributes.get(A.POSITION).data,r=t.getMutableAttribute(A.UVMAPSPACE).data,s=t.getMutableAttribute(A.BOUNDINGRECT).data;rMe(r,s,i,e)}}function C_t(t,e,i,r,s){const n=EAe(t,e,i,r,s),o=t.stageObject.geometries;for(const a of o)E_t(a,s);return n}const A_t=["polyline","polygon","extent"];let cMe=class uMe extends ag{constructor(e,i,r,s){super(e,i,r,s),this._needsUV=!1,this._hasOutline=!1}async doLoad(){}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){if(v(this._material))return;const e=In(this.symbolLayer,"material","color"),i=this._getCombinedOpacityAndColor(e);this._material=b_t(this.symbolLayer,{color:i,transparent:i[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled},{isDraped:this.draped}),this._needsUV=this._material instanceof kee,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const e=this.symbolLayer.outline;if(v(this._outlineMaterial)||!this._isValidOutline(e))return;this._hasOutline=!0;const i=r=>{const s=yRe(e.pattern);return new rE({width:r,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:s,stippleScaleWithLineWidth:!0,cap:lX(e.patternCap||"butt")})};this._outlineMaterial=i(ko(e.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(e){return v(e)&&e.size!=null&&e.size>0&&v(e.color)&&(C(e.pattern)||e.pattern.type!=="style"||e.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,A_t,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(i,new cf);return this.ensureDrapedStatus(s.mode==="on-the-ground"),this._ensureMaterials(),this.draped?this._createAsOverlay(i,r):this._createAs3DShape(i,r,s)}layerOpacityChanged(){if(v(this._material)){const e=this._material.parameters.color,i=In(this.symbolLayer,"material","color"),r=this._getCombinedOpacity(i);this._material.setParameters({color:[e[0],e[1],e[2],r],transparent:r<1||this.needsDrivenTransparentPass})}if(v(this._outlineMaterial)){const e=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[e[0],e[1],e[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=II(uMe.elevationModeChangeTypes,r,s);if(n!==Ss.UPDATE)return n;const o=Sd(s);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){if(v(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),v(this._outlineMaterial)){const e={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(e)}return!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_createAs3DShape(e,i,r){var h;const s=EP(e.geometry);if(C(s))return null;const n=Iee(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=new O_t(n,i,this._context.layer.uid,e.uid),a=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=Qs(4*a,!0),o.boundingRect=ru(9*a,!0),rMe(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=(h=this._context.stage.renderView)==null?void 0:h.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(o),this._hasOutline&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,s.rings,"rings","FillSymbol3DLayer"),o.outGeometries.length===0)return null;const l=new v0({geometries:o.outGeometries,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:e.uid}}),c=new og(this,l,o.outGeometries,null,null,C_t,r);return c.alignedSampledElevation=o.renderData.sampledElevation,c.needsElevationUpdates=Sd(r.mode),c}_createAs3DShapeFill(e){const i=e.renderData.polygons;for(const{position:r,mapPositions:s,holeIndices:n,index:o,count:a}of i){if(v(this._context.clippingExtent)&&($r(fh),Wu(fh,s),!Pp(fh,this._context.clippingExtent)))continue;const l=u1(s,n,3);if(l.length===0)continue;const c=Ice({material:this._material,indices:l,mapPositions:s,attributeData:{position:r,color:e.color,uvMapSpace:this._needsUV?Oae(e.uvMapSpace,4*o,4*a):null,boundingRect:this._needsUV?ld(e.boundingRect,9*o,9*a):null,objectAndLayerIdColor:e.objectAndLayerIdColor}});e.outGeometries.push(c)}}_createAs3DShapeOutline(e){if(!this._hasOutline)return;const i=e.renderData.outlines;for(let r=0;r<i.length;++r){const{mapPositions:s,position:n}=i[r];if(v(this._context.clippingExtent)&&($r(fh),Wu(fh,s),!Pp(fh,this._context.clippingExtent)))continue;const o=cX(this._outlineMaterial,{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:s,attributeData:{position:n}},e.objectAndLayerIdColor),a=o.vertexAttributes.get(A.POSITION);a.data===n&&(a.data=xrt(n)),e.outGeometries.push(o)}}_createAsOverlay(e,i){var a;const r=EP(e.geometry);if(C(r))return null;this._material.renderPriority=this._renderPriority+this._renderPriorityStep/2,v(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority);const s=jOe(r,this._context.overlaySR),n=new R_t(s,i,this._context.layer.uid,e.uid),o=n.renderData.position.length/3;return this._needsUV&&(n.uvMapSpace=Qs(4*o,!0),r_t(n.uvMapSpace,n.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),n.outBoundingBox=$r(),n.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(n),this._createAsOverlayFill(n),this._hasOutline&&this._createAsOverlayOutline(n),this._logGeometryCreationWarnings(n.renderData,r.rings,"rings","FillSymbol3DLayer"),n.outGeometries.length===0?null:new k8(this,n.outGeometries,n.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(e){const i=e.renderData.polygons;for(const{position:r,holeIndices:s,index:n,count:o}of i){const a=$r(fh);if(Wu(a,r),!Pp(a,this._context.clippingExtent))continue;const l=u1(r,s,3);if(l.length===0)continue;rC(e.outBoundingBox,a);const c=Ice({material:this._material,indices:l,attributeData:{position:r,color:e.color,uvMapSpace:this._needsUV?Oae(e.uvMapSpace,4*n,4*o):null,objectAndLayerIdColor:e.objectAndLayerIdColor}}),h=new VC(c,e);nr(h.boundingSphere,.5*(a[0]+a[3]),.5*(a[1]+a[4]),0,.5*Math.sqrt((a[3]-a[0])*(a[3]-a[0])+(a[4]-a[1])*(a[4]-a[1]))),e.outGeometries.push(h)}}_createAsOverlayOutline(e){if(!this._hasOutline)return;const i=e.renderData.outlines;for(let r=0;r<i.length;++r){const{position:s}=i[r];if($r(fh),Wu(fh,s),!Pp(fh,this._context.clippingExtent))continue;rC(e.outBoundingBox,fh);const n=cX(this._outlineMaterial,{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:s}},e.objectAndLayerIdColor),o=new VC(n,e),a=fh;nr(o.boundingSphere,.5*(a[0]+a[3]),.5*(a[1]+a[4]),0,.5*Math.sqrt((a[3]-a[0])*(a[3]-a[0])+(a[4]-a[1])*(a[4]-a[1]))),e.outGeometries.push(o)}}_getOutlineOpacity(){const e=In(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(v(e)?e.a:0)}_getOutlineColor(){const e=In(this.symbolLayer,"outline","color"),i=this._getOutlineOpacity();return o3(v(e)?ot.toUnitRGB(e):null,i)}test(){return{...super.test(),createAsOverlay:(e,i)=>this._createAsOverlay(e,i),createAs3DShape:(e,i,r)=>this._createAs3DShape(e,i,r)}}};cMe.elevationModeChangeTypes={definedChanged:Ss.RECREATE,staysOnTheGround:Ss.NONE,onTheGroundChanged:Ss.RECREATE};const fh=Nn();let O_t=class extends N8{constructor(e,i,r,s){super(e,r,s),this.color=i}},R_t=class extends N8{constructor(e,i,r,s){super(e,r,s),this.color=i}},hMe=class dMe{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=this._colorToRGBA(e.color),this.haloStyle=this._colorToRGB(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?this._colorToRGBA(e.background.color):null}fontString(e){const i=this.definition.font;return`${i.style} ${i.weight} ${e}px ${i.family}, sans-serif`}_colorToRGB(e){return`rgb(${e.slice(0,3).map(i=>Math.floor(255*i)).toString()})`}_colorToRGBA(e){return`rgba(${e.slice(0,3).map(i=>Math.floor(255*i)).toString()},${e[3]})`}static async fromSymbol(e,i){const r=In(e,"material","color"),s=Vu(r,Am,ot.toUnitRGBA),n=Vu(e.size,12,ko),o=e.lineHeight,a=v(e.background)?ot.toUnitRGBA(e.background.color):Am,l={family:Vu(e.font,"sans-serif",m=>m.family),decoration:Vu(e.font,"none",m=>m.decoration),weight:Vu(e.font,"normal",m=>m.weight),style:Vu(e.font,"normal",m=>m.style)},c=e.halo,h=v(c)&&v(c.color)&&c.size>0?{size:ko(c.size),color:ot.toUnitRGBA(c.color)}:{size:0,color:Am},p=new dMe({color:s,size:n,background:{color:a,padding:v(e.background)?[.65*n,.5*n]:[0,0],borderRadius:v(e.background)?n*(6/16):0},lineSpacingFactor:o,font:l,halo:h,pixelRatio:i}),f=p.fontString(n);try{await document.fonts.load(f)}catch{oe.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${f}'. Some text symbology may be rendered using the default browser font.`)}return p}},M_t=class{constructor(e,i,r){this._renderer=new aRe(e,i,r)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=nX(P_t,this._renderer.renderedWidth,this._renderer.renderedHeight),i=e.getContext("2d");return i.save(),this._renderer.render(i,0,0),i.restore(),new _T(e,{wrap:{s:kt.CLAMP_TO_EDGE,t:kt.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:Fv.PAD})}};const P_t={canvas:null},I_t=[0,0,1];let $_t=class extends ag{constructor(e,i,r,s){super(e,i,r,s),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=$8(this.symbolLayer.size);if(e)throw new W("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await hMe.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const i=e.graphic,r=SP(i.geometry);if(C(r))return this.logger.warn(`unsupported geometry type for text symbol: ${i.geometry.type}`),null;const s=this.symbolLayer.text;if(C(s)||s==="")return null;const n=YZ(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(v(n)&&!N0e(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const o=new xAe(n,this.symbolLayer.horizontalAlignment,Omt(this.symbolLayer.verticalAlignment));return this._createAs3DShape(i,r,s,o)}createLabel(e,i,r,s){const n=e.graphic,o=SP(n.geometry);if(C(o))return this.logger.warn(`unsupported geometry type for label: ${n.geometry.type}`),null;const a=i.text;return!a||/^\s+$/.test(a)?null:this._createAs3DShape(n,o,a,i,r,s)}setGraphicElevationContext(e,i,r=0){const s=super.setGraphicElevationContext(e,i);return s.addOffsetRenderUnits(r),s}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,i){return ihe(e,i,(r,s)=>{this.updateGraphicElevationContext(s,r)}),Ss.UPDATE}slicePlaneEnabledChanged(e,i){return ihe(e,i,r=>{for(const s of r.stageObject.geometries)s.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!1}skipHighSymbolLodsChanged(){return!0}updateGraphicElevationContext(e,i){const r=i.elevationContext;this.setGraphicElevationContext(e,r,v(i.metadata)?i.metadata.elevationOffset:0),i.needsElevationUpdates=Sd(r.mode)||r.mode==="absolute-height"}_defaultElevationInfoNoZ(){return D_t}_createAs3DShape(e,i,r,s,n,o){const a=this.setGraphicElevationContext(e,new cf,s.elevationOffset),l=In(e.geometry,"type")==="polyline",c=e.uid;let h=null,p=null;if(C(o)){const P=cRe(s.horizontalPlacement);h=new M_t(r,P,this._textRenderParameters);let F=null;if(v(this._context.sharedResources.textures)){p=this._context.sharedResources.textures.fromData(h.key,()=>h.create(),()=>{v(F)&&F.release()});const V=this._context.stage.renderView.textureRepository.acquire(p.texture.id);if(C(V)||su(V))return p.release(),null;F=V}}const f=L_t(h,s),m={occlusionTest:!0,screenOffset:s.screenOffset,anchorPosition:f,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:s.centerOffsetUnits,drawInSecondSlot:!0};if(v(o)?m.textureId=o.id:v(p)&&(m.textureId=p.texture.id),v(s.verticalOffset)){const{screenLength:P,minWorldLength:F,maxWorldLength:V}=s.verticalOffset;m.verticalOffset={screenLength:ko(P),minWorldLength:F||0,maxWorldLength:v(V)?V:1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:P,screenSizePerspectiveSettingsLabels:F}=this._context.sharedResources;m.screenSizePerspective=F.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),m.screenSizePerspectiveAlignment=P}let y;if(l&&(m.shaderPolygonOffset=1e-4),m.hasSlicePlane=this._context.slicePlaneEnabled,v(n)){const P=JSON.stringify(m);y=n.get(P),C(y)&&(y=new FC(m),n.add(P,y))}else y=new FC(m);const _=s.translation,b=v(h)?Ni(h.displayWidth,h.displayHeight):dc,w=s.centerOffset,S=EW(y,I_t,_,null,b,w,[0,0],null),T=gee(this._context,i,S,a,c);if(C(T))return null;const E=new og(this,T.object,[S],C(n)?[y]:null,p,xP,a);E.alignedSampledElevation=T.sampledElevation,E.needsElevationUpdates=Sd(a.mode)||a.mode==="absolute-height";const{displayWidth:O,displayHeight:R}=v(h)?h:s;E.getScreenSize=(P=et())=>(P[0]=O,P[1]=R,P);const L=new IAe(s.elevationOffset,r);return E.metadata=L,TP(E,i,this._context.elevationProvider),E}};function ihe(t,e,i){t&&t.forEach(r=>{const s=e(r);v(s)&&i(s,r.graphic)})}function L_t(t,e){if(e.verticalPlacement==="baseline"){const r=Emt[e.horizontalPlacement],s=v(t)?t.baselineAnchorY:0;return Ni(r,s)}const i=Amt(e.horizontalPlacement,e.verticalPlacement);return RF[i]}const D_t={mode:"relative-to-ground",offset:0},N_t={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},F_t=["polyline","polygon","extent"];let gX=class aw extends ag{constructor(e,i,r,s){super(e,i,r,s)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,F_t,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new cf);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(i):this._createAs3DShape(i,r,i.uid)}ensureMaterial(){if(v(this._material))return;const e=new LOe,i=this.symbolLayer.color;v(i)&&(e.color=ot.toUnitRGBA(i));const r=this._getCombinedOpacity(i,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],r],e.transparent=r<1||this.needsDrivenTransparentPass,e.waveDirection=v(this.symbolLayer.waveDirection)?aw.headingVectorFromAngle(this.symbolLayer.waveDirection):Ni(0,0);const s=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=N_t[s];e.waveStrength=n.waveStrength,e.waveTextureRepeat=n.textureRepeat,e.waveVelocity=n.waveVelocity,e.flowStrength=n.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.isDraped=this.draped,this._material=new $Oe(e),this._context.stage.add(this._material)}layerOpacityChanged(){if(C(this._material))return;const e=this._material.parameters.color,i=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),r=i<1||this.needsDrivenTransparentPass;this._material.setParameters({color:[e[0],e[1],e[2],i],transparent:r})}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=II(aw.elevationModeChangeTypes,r,s);if(n!==Ss.UPDATE)return n;const o=Sd(s);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){return v(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_createAs3DShape(e,i,r){const s=EP(e.geometry);if(C(s))return null;const n=Iee(s,this._context.elevationProvider,this._context.renderCoordsHelper,i),o=n.position.length/3,a=ru(2*o);this._createUVCoordsFromVertices(a,n.mapPositions,o,this._context.elevationProvider.spatialReference);const l=new U_t(n,a);if(this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,s.rings,"rings","WaterSymbol3DLayer"),l.outGeometries.length===0)return null;const c=new v0({geometries:l.outGeometries,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),h=new og(this,c,l.outGeometries,null,null,EAe,i);return h.alignedSampledElevation=l.renderData.sampledElevation,h.needsElevationUpdates=Sd(i.mode),h}_createUVCoordsFromVertices(e,i,r,s){const n=_l(s);yd(K0);for(let l=0;l<r;l++)It(rhe,i[3*l],i[3*l+1]),RZ(K0,rhe);XC(K0,K0,n);const o=K0[0]%aw.unitSizeOfTexture,a=K0[1]%aw.unitSizeOfTexture;cD[0]=K0[0]-o,cD[1]=K0[1]-a;for(let l=0;l<r;l++)e[2*l]=(i[3*l]*n-cD[0])/aw.unitSizeOfTexture,e[2*l+1]=(i[3*l+1]*n-cD[1])/aw.unitSizeOfTexture}_create3DShapeGeometries(e){const i=e.renderData.polygons,r=e.uvCoords;for(const{count:s,index:n,position:o,mapPositions:a,holeIndices:l}of i){if(v(this._context.clippingExtent)&&($r(Q0),Wu(Q0,a),!Pp(Q0,this._context.clippingExtent)))continue;const c=u1(a,l,3);if(c.length===0)continue;const h=ld(r,2*n,2*s),p=$ce({material:this._material,indices:c,mapPositions:a,attributeData:{position:o,uv0:h}});e.outGeometries.push(p)}}_createAsOverlay(e){const i=EP(e.geometry);if(C(i))return null;this._material.renderPriority=this._renderPriority;const r=jOe(i,this._context.overlaySR),s=r.position.length/3,n=ru(2*s);this._createUVCoordsFromVertices(n,r.position,s,this._context.overlaySR);const o=new V_t(r,n,this._context.layer.uid,e.uid);return o.outBoundingBox=$r(),this._createAsOverlayWater(o),this._logGeometryCreationWarnings(o.renderData,i.rings,"rings","WaterSymbol3DLayer"),o.outGeometries.length===0?null:new k8(this,o.outGeometries,o.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(e){const i=e.uvCoords,r=e.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of r){if($r(Q0),Wu(Q0,s),!Pp(Q0,this._context.clippingExtent))continue;rC(e.outBoundingBox,Q0);const l=u1(s,n,3);if(l.length===0)continue;const c=ld(i,2*o,2*a),h=$ce({material:this._material,indices:l,attributeData:{position:s,uv0:c}}),p=new VC(h,e),f=Q0;nr(p.boundingSphere,.5*(f[0]+f[3]),.5*(f[1]+f[4]),0,.5*Math.sqrt((f[3]-f[0])*(f[3]-f[0])+(f[4]-f[1])*(f[4]-f[1]))),e.outGeometries.push(p)}}static headingVectorFromAngle(e){const i=et(),r=k6(e);return i[0]=Math.sin(r),i[1]=Math.cos(r),i}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}};gX.unitSizeOfTexture=100,gX.elevationModeChangeTypes={definedChanged:Ss.RECREATE,staysOnTheGround:Ss.NONE,onTheGroundChanged:Ss.RECREATE};const cD=et(),K0=ci(),rhe=et(),Q0=Nn();let U_t=class extends N8{constructor(e,i){super(e,null,null),this.uvCoords=i}},V_t=class extends N8{constructor(e,i,r,s){super(e,r,s),this.uvCoords=i}};function k_t(t,e,i,r){const s=she[t.type]&&she[t.type][e.type]||B_t[e.type];return s?new s(t,e,i,r):(oe.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${e.type}`),null)}const B_t={icon:aX,object:s0t,line:_Re,path:Q0t,fill:cMe,extrude:umt,text:$_t,water:gX},she={"mesh-3d":{fill:kgt}};let z_t=class extends pee{set symbol(e){this._symbol=e,e.symbolLayers.forEach((i,r)=>{const s=this.symbolLayers[r];v(s)&&(s.symbol=e,s.symbolLayer=i)})}get symbol(){return this._symbol}constructor(e,i,r){super(i.schedule),this._symbol=e,this._context=i,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let i=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(i=this._backgroundLayers.concat(i));const r=i.length;for(;this.symbolLayers.length<i.length;)this.symbolLayers.push(null);this.symbolLayers.length=i.length;const s=[];for(let n=0;n<r;n++){const o=i.getItemAt(n);if(o.enabled===!1)continue;uD.renderPriority=1-(1+n)/r,uD.renderPriorityStep=1/r,uD.ignoreDrivers=o._ignoreDrivers;const a=k_t(this.symbol,o,this._context,uD),l=F6(e,()=>{this.symbolLayers[n]=null,a.destroy()});l&&s.push(l),this.symbolLayers[n]=a}if(await DU(this.symbolLayers,async(n,o)=>{if(v(n))try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[o]=null}}),s.forEach(n=>n.remove()),gi(e),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(e){const i=this.symbolLayers[e];return v(i)?i.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>v(e)&&e.queryForSnapping)}createGraphics3DGraphic(e,i){const r=e.graphic,s=new Array(this.symbolLayers.length);for(let o=0;o<this.symbolLayers.length;o++){const a=this.symbolLayers[o];s[o]=v(a)?a.createGraphics3DGraphic(e):null}const n=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new Ndt(r,i||this,s,e.layer,n)}get complexity(){return mee(this.symbolLayers.map(e=>In(e,"complexity")))}globalPropertyChanged(e,i){const r=this.symbolLayers.length;for(let s=0;s<r;s++){const n=this.symbolLayers[s],o=a=>{const l=a.layers[s];return l instanceof og?l:null};if(v(n)&&!n.globalPropertyChanged(e,i,o))return!1}return!0}applyRendererDiff(e,i){return this.loadStatus!==Uu.LOADED?$n.Recreate_Symbol:this.symbolLayers.reduce((r,s)=>r!==$n.Recreate_Symbol&&v(s)?Math.min(r,s.applyRendererDiff(e,i)):r,$n.Fast_Update)}prepareSymbolPatch(e){if(this.loadStatus===Uu.FAILED||e.diff.type!=="partial")return;const i=e.diff.diff;if(!i.symbolLayers||i.symbolLayers.type!=="partial")return;const r=i.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(C(s))return;const o=r[n];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(a),e.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,c)=>{const h=l.layers[n];v(h)&&a.graphics3DGraphicPatches.forEach(p=>p(h,c))})}})}updateGeometry(e,i){for(let r=0;r<this.symbolLayers.length;r++){const s=this.symbolLayers[r];if(C(s))continue;const n=e.layers[r];if(C(n)||!s.updateGeometry(n,i))return!1}return!0}onRemoveGraphic(e){for(let i=0;i<this.symbolLayers.length;i++){const r=this.symbolLayers[i];if(C(r))continue;const s=e.layers[i];v(s)&&r.onRemoveGraphic(s)}}getFastUpdateStatus(){let e=0,i=0,r=0;return this.symbolLayers.forEach(s=>{C(s)||(s.loadStatus===Uu.LOADING?e++:s.isFastUpdatesEnabled()?r++:i++)}),{loading:e,slow:i,fast:r}}async queryForSnapping(e,i,r,s){const n=this.symbolLayers.filter(v).filter(a=>v(a.queryForSnapping)).map(a=>a.queryForSnapping(e,i,r,s)),o=await Promise.all(n);return gi(s),o.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const e of this.symbolLayers)v(e)&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}};const uD={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};let G_t=class extends pee{constructor(e,i,r){super(i),this.symbol=e,this._convert=r,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return v(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return v(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return v(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const i=await this.symbol.fetchSymbol({signal:e});i.id=this.symbol.id,this.graphics3DSymbol=this._convert(i),v(this.graphics3DSymbol)&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return v(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return v(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:fee}globalPropertyChanged(e,i){return!!v(this.graphics3DSymbol)&&this.graphics3DSymbol.globalPropertyChanged(e,i)}applyRendererDiff(e,i){return v(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(e,i):$n.Recreate_Symbol}prepareSymbolPatch(e){v(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,i){return!!v(this.graphics3DSymbol)&&this.graphics3DSymbol.updateGeometry(e,i)}onRemoveGraphic(){}getFastUpdateStatus(){return v(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){v(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}};function Bee(t){return t instanceof G_t?t.graphics3DSymbol:t instanceof z_t?t:null}const PP=oe.getLogger("esri.views.3d.layers.graphics.labelPlacement");function j_t(t){const e=Q_t(t);if(C(e))return null;const i=H_t(t,e);if(C(i))return null;const r=i.anchor,s=!!e.hasLabelVerticalOffset;return W_t({anchor:r,verticalOffset:e.verticalOffset,screenOffset:et(),centerOffset:si(0,0,0,-1),centerOffsetUnits:"world",translation:M(),elevationOffset:0,hasLabelVerticalOffset:s},i,t)}function H_t(t,e){if(e.anchor)return e;const i=t.labelClass.labelPlacement,r=Fp[i],s=r||s6(t);return i&&!r&&PP.warnOncePerTick(`the requested label placement '${i}' is currently unsupported in SceneView.`),q_t(s,t)}function zee(t){const e=t.graphics3DGraphic.graphics3DSymbol,i=Bee(e);return v(i)?i.symbol.symbolLayers.getItemAt(0):null}function q_t(t,e){const i=e.graphics3DGraphic.graphic.geometry;if(C(i))return null;if(v(e.disablePlacement))return e.labelClass.labelPlacement?(PP.warnOncePerTick(nhe(t.placement,e.disablePlacement.logEntityDescription)),s6(e)):t;const r=i.type;switch(r){case"polyline":case"polygon":case"extent":case"multipoint":if(e.labelClass.labelPlacement)return PP.warnOncePerTick(nhe(t.placement,`'${r}' geometries`)),s6(e);break;case"point":case"mesh":return t}return t}function nhe(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function s6(t){const e=t.graphics3DGraphic.graphic.geometry;if(C(e))return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const i=zee(t);return v(i)&&i.type==="extrude"?Fp["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return Fp["above-center"];default:return}}function W_t(t,e,i){const r=i.graphics3DGraphic.graphic.geometry;if(C(r))return null;switch(r.type){case"point":Y_t(t,e,i);break;case"polygon":X_t(t,e,i);break;case"mesh":Gee(t,e,i.graphics3DGraphic.layers[0])}return t}function X_t(t,e,i){const r=zee(i);if(!C(r))switch(r.type){case"extrude":{const s=i.graphics3DGraphic.layers[0];v(s)?(s.getBoundingBoxObjectSpace(f3),Mp(f3,t.translation),t.translation[2]=g1(f3)/2):fe(t.translation,0,0,0),Gee(t,e,s);break}}}function Y_t(t,e,i){const r=zee(i);if(C(r))return;const s=i.graphics3DGraphic.layers[0];switch(v(s)?s.getCenterObjectSpace(t.translation):fe(t.translation,0,0,0),r.type){case"icon":case"text":Z_t(t,e,i,s);break;case"object":Gee(t,e,s)}}function Z_t(t,e,i,r){const{graphics3DGraphic:s}=i,n=v(r)?r.getScreenSize():null;if(!s.isDraped&&v(n)){const o=J_t(i);SO[0]=n[0]/2*(e.normalizedOffset[0]-o[0]),SO[1]=n[1]/2*(e.normalizedOffset[1]-o[1]),t.screenOffset[0]=SO[0],t.hasLabelVerticalOffset?(t.centerOffset[1]=SO[1],t.centerOffsetUnits="screen"):t.screenOffset[1]=SO[1]}else t.hasLabelVerticalOffset||t.anchor==="center"||(Fp[i.labelClass.labelPlacement]&&PP.warnOncePerTick(`the requested placement '${e.placement}' is currently unsupported for draped graphics`),t.anchor="center")}function J_t(t,e=evt){const{graphics3DGraphic:i}=t,r=i.layers[0],s=v(r)?r.stageObject.geometries[0].material:null;if(s&&s instanceof FC){const n=s.parameters.anchorPosition;e[0]=2*(n[0]-.5),e[1]=2*(n[1]-.5)}else e[0]=0,e[1]=0;return e}function Gee(t,e,i){const r=v(i)?i.getBoundingBoxObjectSpace(f3):f3,s=Xe(r[3]-r[0],r[4]-r[1],r[5]-r[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);t.centerOffset[0]=n/2*e.normalizedOffset[0];const o=t.translation[2],a=s[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=o+a;const l=je(s);t.centerOffset[2]=l/2*e.normalizedOffset[2]}function K_t(t){return t==="above-center"}function Q_t(t){const e=t.labelClass.labelPlacement,{labelSymbol:i,graphics3DGraphic:r}=t,s=Bee(r.graphics3DSymbol),n=go(s,a=>a.symbol.type==="point-3d"?a.symbol:null),o=Fp[e]||s6(t);return v(n)&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!r.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:ohe(n.verticalOffset),anchor:null,normalizedOffset:null}:i&&i.hasVisibleVerticalOffset()&&(C(n)||!n.supportsCallout()||!n.verticalOffset||r.isDraped)?K_t(o.placement)?{placement:"above-center",verticalOffset:ohe(i.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(PP.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null):{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function ohe(t){const{screenLength:e,minWorldLength:i,maxWorldLength:r}=t;return{screenLength:e,minWorldLength:i,maxWorldLength:r}}const Fp={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},ahe={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in ahe){const e=ahe[t],i=Fp[t];e.forEach(r=>{Fp[r]=i})}Object.freeze&&(Object.freeze(Fp),Object.keys(Fp).forEach(t=>{Object.freeze(Fp[t]),Object.freeze(Fp[t].normalizedOffset)}));const SO=[0,0],evt=[0,0],f3=Nn();let lhe=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,i){this._materials.set(e,i),this._stage.add(i)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}};const UB=512,VB=4096,tvt=.85,ivt=.95;let rvt=class{constructor(){this.offset={x:0,y:0},this.uvMinMax=fi()}},svt=class{constructor(e,i){this.textId=e,this.textRenderer=i,this.placement=new rvt,this.rendered=!1}},sM=class extends $e{constructor(e){super(e),this.type=Vs.Texture,this.id=Zc(),this.events=new As,this._glTexture=null,this._needsClear=!1,this._elementsToAddOrUpdate=new Map,this._elementsToRemove=new Map,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._stage=this.view._stage,this._canvas=this._create2DCanvas(),this._ctx=this._canvas.getContext("2d"),this._stage.add(this);const e=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(e),this._update2DCanvasSize(),this._resetAtlasCursor()}unload(){this._glTexture=ft(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get width(){return this._atlas.size.width}get height(){return this._atlas.size.height}get requiresFrameUpdates(){return!1}_createDescriptor(e){return{target:Pt.TEXTURE_2D,pixelFormat:it.RGBA,dataType:Ht.UNSIGNED_BYTE,wrapMode:kt.CLAMP_TO_EDGE,flipped:!0,samplingMode:gt.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:e.parameters.maxMaxAnisotropy}}get glTexture(){return this._glTexture}load(e){return v(this._glTexture)||(this._glTexture=new xt(e,this._createDescriptor(e),this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(Rt.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this._elements=null,this._elementsToAddOrUpdate=null,this._elementsToRemove=null,this._elementsToRender=null,this._frameWorker=Rr(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=ft(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_create2DCanvas(){const e=document.createElement("canvas");return e.setAttribute("id","canvas2d"),e.setAttribute("style","display:none"),e.setAttribute("width",UB.toString()),e.setAttribute("height",UB.toString()),e}_update2DCanvasSize(){this._canvas.setAttribute("width",this._atlas.size.width.toString()),this._canvas.setAttribute("height",this._atlas.size.height.toString())}_createAtlasRegion(e=UB){this._atlas={size:{width:e,height:e},cursor:{x:0,y:0},lineHeight:0}}_computeAtlasResolution(e,i){let r=Math.max(e,i);return r+=256,r=YE(r),r=Math.min(r,VB),r}_resizeAtlas(e,i){i=i||e;const r=this._atlas;r.size.width=e,r.size.height=i,v(this._glTexture)&&this._glTexture.resize(e,i),this._update2DCanvasSize()}_resetAtlasCursor(){const e=this._atlas;e.cursor.x=EO,e.cursor.y=EO+che,e.lineHeight=0,this._needsClear=!0}_getAtlasUsage(){const e=this._atlas;return(e.cursor.x+e.cursor.y*e.size.width)/(e.size.width*e.size.height)}_getExpectedAtlasUsage(){const e=this._elementsToRemove.size,i=this._elementsToAddOrUpdate.size,r=this._elements.size;return this._getAtlasUsage()/r*(r+i-e)}_addAtlasElement(e,i,r,s){const n=this._atlas,{renderedWidth:o,renderedHeight:a}=e.textRenderer;e.placement.offset.x=n.cursor.x,e.placement.offset.y=n.cursor.y,nr(e.placement.uvMinMax,e.placement.offset.x/n.size.width,1-(e.placement.offset.y+a)/n.size.height,(e.placement.offset.x+o)/n.size.width,1-e.placement.offset.y/n.size.height),n.cursor.x+=r,n.lineHeight=Math.max(n.lineHeight,s),this._elements.set(i,e)}_removeAtlasElement(e){if(e&&this._elements.has(e.textId)){const i=e.placement.offset;this._ctx.clearRect(i.x,i.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),this._elements.delete(e.textId)}}_ensureStageObjects(e){const i=this._stageObjects.get(e);if(i)return i;const r=new Set;return this._stageObjects.set(e,r),r}_addStageObject(e,i){this._ensureStageObjects(e).add(i)}_removeStageObject(e,i){const r=this._stageObjects.get(e);r&&r.delete(i)&&(i.geometries[0].vertexAttributes.get(A.SIZE).data=[0,0],i.geometryVertexAttrsUpdated(i.geometries[0]))}_processAddition(e,i){const r=this._atlas,s=e.textId,n=e.textRenderer.renderedWidth,o=e.textRenderer.renderedHeight,a=n+EO,l=o+EO+che;if(r.cursor.x+a<r.size.width&&r.cursor.y+l<r.size.height)this._addAtlasElement(e,s,a,l),this._elementsToRender.set(s,e),this._elementsToAddOrUpdate.delete(s);else{if(!(r.cursor.y+l+r.lineHeight<r.size.height)){const c=this._getExpectedAtlasUsage(),h=c>tvt&&r.size.width<VB;return h&&this._resizeAtlas(2*r.size.width,2*r.size.height),!i||!h&&c>ivt&&r.size.width===VB?(this._processRemovals(),sE.OK):(this._repack(),sE.REPACK)}r.cursor.x=EO,r.cursor.y+=r.lineHeight,r.lineHeight=0,this._addAtlasElement(e,s,a,l),this._elementsToRender.set(s,e),this._elementsToAddOrUpdate.delete(s)}return sE.OK}_processRemovals(){this._elementsToRemove.forEach((e,i)=>{const r=this._stageObjects.get(i);r&&r.size!==0||this._removeAtlasElement(e),r&&r.size===0&&this._stageObjects.delete(i)}),this._elementsToRemove.clear()}_repack(){this._processRemovals(),this._elements.forEach((e,i)=>{e.rendered=!1,this._elementsToAddOrUpdate.set(i,e)}),this._elements.clear(),this._resetAtlasCursor(),this._elementsToRender.clear()}_processRenderingRequest(e){this._ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),e.textRenderer.render(this._ctx,e.placement.offset.x,e.placement.offset.y);const i=this._stageObjects.get(e.textId);i&&i.forEach(r=>{r.geometries[0].vertexAttributes.get(A.UV0).data=new Float32Array(e.placement.uvMinMax),r.geometries[0].vertexAttributes.get(A.SIZE).data=[e.textRenderer.displayWidth,e.textRenderer.displayHeight],r.geometryVertexAttrsUpdated(r.geometries[0])}),e.rendered=!0}get running(){return this.updating}runTask(e,i=!0){if(C(this._glTexture))return ua.YIELD;let r=!1;if(Vo(this._elementsToAddOrUpdate,(n,o)=>{const a=this._elements.get(o);if(a&&a.rendered){const l=this._stageObjects.get(o);return l&&l.forEach(c=>{const h=c.geometries[0].vertexAttributes,p=this._elements.get(o);h.get(A.UV0).data=p.placement.uvMinMax,h.get(A.SIZE).data=[p.textRenderer.displayWidth,p.textRenderer.displayHeight],c.geometryVertexAttrsUpdated(c.geometries[0])}),this._elementsToAddOrUpdate.delete(o),e.madeProgress(),!1}return this._processAddition(this._elementsToAddOrUpdate.get(o),i)===sE.REPACK&&(r=!0,!0)}),r)return this.runTask(ll,!1),void e.madeProgress();let s=!1;this._elementsToRender.size>0&&this._needsClear&&(this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._needsClear=!1),Vo(this._elementsToRender,(n,o)=>(this._processRenderingRequest(n),this._elementsToRender.delete(o),s=!0,e.madeProgress(),e.done)),s&&this._glTexture.setData(this._canvas),this.updating=this._elementsToRender.size>0,!this.updating&&rpt.orderedRepackingEnabled&&(this.repackOrdered(),e.madeProgress())}addTextTexture(e,i){const r=e.key;this._elementsToAddOrUpdate.has(r)||this._elementsToAddOrUpdate.set(r,new svt(r,e)),this._addStageObject(r,i),this._elementsToRemove.delete(r),this.setDirty()}removeTextTexture(e,i){const r=e.key;this._elementsToRemove.set(r,this._elements.get(r)),this._removeStageObject(r,i)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(this._elements.size===0)return;const e=[];this._elements.forEach((r,s)=>e.push({element:r,key:s}));let i=!0;for(let r=0;r<e.length-1;r++)if(e[r].key.localeCompare(e[r+1].key)>0){i=!1;break}if(!i||this._elementsToRemove.size){e.sort((r,s)=>r.key.localeCompare(s.key)),this._elements.clear();for(const{element:r,key:s}of e)this._elements.set(s,r);this._repack(),this.setDirty()}}get test(){const{_elements:e,_stageObjects:i,_elementsToRemove:r,_atlas:s}=this,n=this;return{elements:e,stageObjects:i,elementsToRemove:r,atlas:s,resizeAtlas:(o,a)=>n._resizeAtlas(o,a),run:(o,a)=>n.runTask(o,a)}}};u([d({constructOnly:!0})],sM.prototype,"view",void 0),u([d({type:Boolean})],sM.prototype,"updating",void 0),sM=u([I("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],sM);const EO=2,che=2;var sE;(function(t){t[t.OK=0]="OK",t[t.REPACK=1]="REPACK"})(sE||(sE={}));let uhe=class{constructor(e,i){this.labelingContext=e,this.graphics3DGraphic=i,this.hasGraphics3DResources=!1,this.visible=!1,this.rendered=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},nvt=class{constructor(e,i,r,s,n){this.labelClass=e,this.graphics3DSymbol=i,this.graphics3DCalloutSymbolLayer=r,this.textRenderParameters=s,this.labelFunction=n,this.calloutSymbolLayerIndex=0}},ovt=class{constructor(e,i,r,s,n,o,a){this.layer=e,this.graphics3DCore=i,this.scaleVisibility=r,this.emptySymbolLabelSupported=s,this.elevationInfoOverride=n,this.disablePlacement=o,this.active=a,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new sOe({pickable:!0,disableOctree:!0},e.uid)}},lw=class extends $e{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new Ki,this._handles.add([re(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),re(()=>{var e;return(e=this.view.state)==null?void 0:e.rasterPixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(Rt.LABELER,this)]),this._textTextureAtlas=new sM({view:this.view}),this._hudMaterialCollection=new lhe(this.view._stage),this._calloutMaterialCollection=new lhe(this.view._stage)}dispose(){this._handles=Je(this._handles),this._textTextureAtlas=ft(this._textTextureAtlas),this._hudMaterialCollection=ft(this._hudMaterialCollection),this._calloutMaterialCollection=ft(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}_activateLabelingContext(e){e.graphics.forEach((i,r)=>{const s=new uhe(e,i);this._labels.set(r,s),e.labelsToInitialize.set(r,s),i.setVisibilityFlag(jc.USER_SETTING,!0,Fo.LABEL)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((i,r)=>{i.setVisibilityFlag(jc.USER_SETTING,!1,Fo.LABEL),this.setLabelGraphicVisibility(i,!1),this._labels.delete(r)}),e.active=!1}_addLabelTextureToAtlas(e){for(const i of e.graphics3DGraphic.labelLayers){if(!i._labelClass)continue;const r=e.textRenderers[i._labelIndex];v(r)&&this._textTextureAtlas.addTextTexture(r,i.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const i of e.graphics3DGraphic.labelLayers){if(!i._labelClass)continue;const r=e.textRenderers[i._labelIndex];v(r)&&this._textTextureAtlas.removeTextTexture(r,i.stageObject)}e.rendered=!1}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),ua.YIELD}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const i of this._labelingContexts)if(i.active){if(!hhe(i)){if(avt(i)){this._deactivateLabelingContext(i);continue}if(this._createLabelClassContext(i),kB(i)){this._dirty=!0;continue}if(!hhe(i))continue}Vo(i.labelsToInitialize,(r,s)=>(this._ensureGraphics3DResources(r)&&(this._labels.set(s,r),this.deconflictor.setDirty(),e.madeProgress()),(r.visible&&r.textInitialized||!r.visible&&r.hasGraphics3DResources)&&(i.labelsToInitialize.delete(s),e.madeProgress()),e.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(i=>this._removeLabelTextureFromAtlas(i)),this._labelsToAdd.forEach(i=>this._addLabelTextureToAtlas(i)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){var o,a,l;const i=(o=e.labelClassAbortController)==null?void 0:o.signal;await((l=(a=e.layer).when)==null?void 0:l.call(a)),gi(i),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const r=e.graphics3DCore,s=r.layer,n=s.labelingInfo&&s.labelingInfo.filter(c=>!!c.symbol);!n||n.length===0||(await DU(n,async(c,h)=>{const p=c.symbol,f=Bee(r.getOrCreateGraphics3DSymbol(p));if(C(f))return void oe.getLogger(this.declaredClass).error("Failed to create Graphics3DSymbol for label");await f.load(),gi(i);let m=null;YZ(p)&&p.hasVisibleCallout()&&(m=$dt(p,r.symbolCreationContext),await m.load(),gi(i));const y=await Kp(bAe(c,e.layer.fieldsIndex,this.view.spatialReference));if(gi(i),y.ok===!0){const _=await this._createTextRenderParameters(f.symbol);gi(i),e.labelClassContexts[h]=new nvt(c,f,m,_,y.value)}else oe.getLogger(this.declaredClass).error(`Label expression failed to evaluate: ${y.error}`)}),gi(i))}async _createLabelClassContext(e){return C(e.labelClassPromise)&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(i=>{if(ln(i))throw i;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const i=e.symbolLayers.getItemAt(0);return i&&i.type==="text"?hMe.fromSymbol(i,this.view.state.rasterPixelRatio):null}_destroyLabelClassContext(e){for(const r of e.labelClassContexts)--r.graphics3DSymbol.referenced;const i=e.labelClassAbortController;e.labelClassAbortController=new AbortController,hd(i),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,i,r,s,n){const o=new xAe(r.verticalOffset,Tue(r.anchor),Cmt(r.anchor),e.text,r.translation,r.elevationOffset,r.centerOffset,r.screenOffset,r.centerOffsetUnits,e.displayWidth,e.displayHeight);return e_.graphic=i,e_.renderingInfo=null,e_.layer=s,n.createLabel(e_,o,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,i,r,s,n){return e_.graphic=e,e_.layer=n,e_.renderingInfo=new Pdt(null,i,s.translation,s.centerOffset,s.screenOffset,s.centerOffsetUnits,s.elevationOffset,this._calloutMaterialCollection),r.createGraphics3DGraphic(e_)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const i=e.graphics3DGraphic;if(i.destroyed)return!1;this._ensureTextTextureResources(e);const r=e.labelingContext,s=r.labelClassContexts;if(!s||s.length===0||!r.emptySymbolLabelSupported&&i.layers.length===0)return!1;let n=!1;const o=i.graphic,a=r.layer,l=hD(r.layer),c=this.view._stage;for(let h=0;h<s.length;h++){const p=e.textRenderers[h],f=e.textLabelPlacements[h];if(C(p)||C(f))continue;const m=s[h],y=m.graphics3DSymbol,_=y.symbol&&y.symbol.type==="label-3d"?y.symbol:null,b=y.symbolLayers[0];if(!b)continue;b.setElevationInfoOverride(r.elevationInfoOverride);const w=this._createTextSymbolGraphic(p,o,f,a,b);if(C(w))return!1;w._labelClass=m.labelClass,w._labelIndex=h,i.addLabelGraphic(w,c,r.stageLayer),i.setVisibilityFlag(jc.USER_SETTING,l,Fo.LABEL),i.clearVisibilityFlag(jc.SCALE_RANGE,Fo.LABEL),i.setVisibilityFlag(jc.DECONFLICTION,!1,Fo.LABEL),n=!0;const S=m.graphics3DCalloutSymbolLayer;if(S&&f.hasLabelVerticalOffset){S.setElevationInfoOverride(r.elevationInfoOverride);const T=this._createLineCalloutGraphic(o,_,S,f,a);v(T)&&(m.calloutSymbolLayerIndex=i.labelLayers.length,i.addLabelGraphic(T,c,r.stageLayer))}break}return r.scaleVisibility&&n&&r.scaleVisibility.updateGraphicLabelScaleVisibility(i),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const i=e.labelingContext.labelClassContexts;for(const r of e.graphics3DGraphic.labelLayers){if(r._labelClass==null)continue;const s=i[r._labelIndex].graphics3DSymbol.symbolLayers[0];s!=null&&s.onRemoveGraphic(r)}e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){var n;if(e.textInitialized)return;const i=e.labelingContext,r=i.labelClassContexts;if(!r||r.length===0)return;const s=e.graphics3DGraphic.graphic;for(let o=0;o<r.length;o++){const a=r[o];if(e.textRenderers[o]=null,e.textLabelPlacements[o]=null,!a.textRenderParameters)continue;const l=a.labelFunction;let c;if(l.type==="arcade")try{const S=l.needsHydrationToEvaluate()?Mht(s,i.layer):s;c=l.evaluate(S)}catch{c=null}else c=l.evaluate(s);if(C(c)||c===""||/^\s+$/.test(c))continue;const h=a.graphics3DSymbol,p=((n=h.symbol)==null?void 0:n.type)==="label-3d"?h.symbol:null;if(!h.symbolLayers[0])continue;const f=e.graphics3DGraphic,m=a.labelClass,y=i.disablePlacement,_=j_t({graphics3DGraphic:f,labelSymbol:p,labelClass:m,disablePlacement:y});if(C(_))continue;const b=Tue(_.anchor),w=cRe(b);e.textRenderers[o]=new aRe(c,w,a.textRenderParameters),e.textLabelPlacements[o]=_}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,i){const r=i.graphic.uid;if(e.graphics.set(r,i),e.active){const s=new uhe(e,i);this._labels.set(r,s),e.labelsToInitialize.set(r,s)}this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,i){const r=i.graphic.uid,s=this._labels.get(r);e.graphics.delete(r),s&&(this._destroyGraphic(s,r),e.labelsToInitialize.delete(r),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,i){this._labels.has(i)&&(this._labels.delete(i),this._labelsToAdd.delete(i),this._labelsToRemove.delete(i)),e.textInitialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,i){if(!i)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const r of i){const s=e.graphics.get(r);s&&(this._removeGraphic(e,s),this._addGraphic(e,s))}}_globalPropertyChanged(e,i){for(const r of i.labelClassContexts){const s=new Map;i.graphics.forEach(o=>s.set(o.graphic.uid,o));const n=o=>o.labelLayers[0];if(r.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,s,n),r.graphics3DCalloutSymbolLayer){const o=a=>a.labelLayers[r.calloutSymbolLayerIndex];r.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,s,o)}}}_visibilityInfoChange(e){const i=hD(e.layer);i&&!e.active&&this._activateLabelingContext(e),!i&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((i,r)=>{const s=this._labels.get(r);s&&(this._destroyGraphic(s,r),s.visible=!1,s.rendered=!1,e.labelsToInitialize.set(r,s))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const i of this._labelingContexts)if(i.graphics3DCore===e)return i;return null}addGraphicsOwner(e,i,r){const s=r&&r.emptySymbolLabelSupported||!1,n=r&&r.elevationInfoOverride||null,o=r&&r.disablePlacement||null;if(this._findLabelingContext(e))return;const a=e.layer,l=new ovt(a,e,i,s,n,o,hD(a));return this.view._stage.add(l.stageLayer),this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),featureReductionChange:()=>{},layerLabelsEnabled:()=>hD(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),clear:()=>{}}}removeGraphicsOwner(e){const i=this._findLabelingContext(e);if(!i)return;const r=this._labelingContexts.indexOf(i);this._labelingContexts.splice(r,1),i.graphics.forEach(s=>this._removeGraphic(i,s)),this.view._stage.remove(i.stageLayer),this.setDirty()}setLabelGraphicVisibility(e,i){const r=e.graphic.uid,s=this._labels.get(r);s&&s.visible!==i&&(i&&!s.rendered?(this._labelsToAdd.set(r,s),this._labelsToRemove.delete(r),s.textInitialized||s.labelingContext.labelsToInitialize.set(r,s)):!i&&s.rendered&&(this._labelsToRemove.set(r,s),this._labelsToAdd.delete(r)),s.visible=i,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(i=>kB(i))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((i,r)=>i+(kB(r)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function kB(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function hhe(t){return t.labelClassContexts&&t.labelClassContexts.length}function avt(t){return t.labelClassContexts===null}function hD(t){var e;return t.labelsVisible===!0&&!!((e=t.labelingInfo)!=null&&e.some(i=>!!i.symbol))}u([d({constructOnly:!0})],lw.prototype,"view",void 0),u([d({constructOnly:!0})],lw.prototype,"deconflictor",void 0),u([d()],lw.prototype,"_textTextureAtlas",void 0),u([d({type:Boolean,readOnly:!0})],lw.prototype,"updating",null),lw=u([I("esri.views.3d.layers.graphics.Labeler")],lw);const e_=new Idt(null,null,null);let nM=class OS{constructor(e,i,r,s=null){this.lij=[0,0,0],this.extent=ci(),this.resolution=0,this.loadPriority=0,this.measures={visibility:wa.VISIBLE_ON_SURFACE,screenRect:ci(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(e,i,r,s)}acquire(e,i,r,s){this.tilingScheme=s,this.id=OS.id(e,i,r),this.lij[0]=e,this.lij[1]=i,this.lij[2]=r,s.getExtent(e,i,r,this.extent),this.resolution=s.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const i=this.lij[0]+1,r=2*this.lij[1],s=2*this.lij[2];return e?(e[0].acquire(i,r,s,this.tilingScheme),e[1].acquire(i,r+1,s,this.tilingScheme),e[2].acquire(i,r,s+1,this.tilingScheme),e[3].acquire(i,r+1,s+1,this.tilingScheme),e):[new OS(i,r,s,this.tilingScheme),new OS(i,r+1,s,this.tilingScheme),new OS(i,r,s+1,this.tilingScheme),new OS(i,r+1,s+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,jy(e.measures.screenRect,this.measures.screenRect)}static id(e,i,r){return`${e}/${i}/${r}`}};var wa;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",t[t.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(wa||(wa={}));const pMe=.5*Math.PI,lvt=pMe/Math.PI*180;let cvt=class{constructor(e){this._renderCoordsHelper=e.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:M(),direction:M()};for(let i=0;i<4;i++)this._extent[i]={origin:M(),direction:M(),cap:{next:null,direction:M()}},this._planes[i]=qi();this._planes[Sr.NEAR]=qi(),this._planes[Sr.FAR]=qi(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,i,r,s=!0){const n=this._extent;this._toRenderBoundingExtent(e,i,r),ve(this._center.origin,n[0].origin,n[2].origin),ue(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),s||ue(this._center.direction,this._center.direction,-1);for(let o=0;o<4;o++){const a=n[o];this._renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=n[o===3?0:o+1];a.cap.next=l.origin,i0(a.cap.direction,a.origin,l.origin),q3(a.direction,a.cap.direction,a.origin,this._planes[o]),s||ue(a.direction,a.direction,-1)}q3(n[0].cap.direction,n[1].cap.direction,n[0].origin,this._planes[Sr.NEAR]),s?cj(this._planes[Sr.NEAR],this._planes[Sr.FAR]):(TU(this._planes[Sr.FAR],this._planes[Sr.NEAR]),cj(this._planes[Sr.NEAR],this._planes[Sr.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=i,this._minGlobalAltitude=.9*tr(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,i,r=!1){if(e==null)return!1;if(this._renderCoordsHelper.viewingMode===st.Global){const n=this._maxSpanSpatialReference.isGeographic?lvt:pMe*i;if(this._maxSpan>n)return!0;if(e.altitude!=null&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(this._maxSpan===0){const n=this._extent[0];return!(r||!e.intersectsRay(ih(n.origin,n.direction)))}for(let n=0;n<this._extent.length;n++){const o=this._extent[n];if(!r&&e.intersectsRay(ih(o.origin,o.direction))||e.intersectsLineSegment(ax(o.origin,o.cap.next,hvt),o.cap.direction))return!0}const s=r?this._planes:this._planesWithoutFar;for(let n=0;n<e.lines.length;n++){const o=e.lines[n];if(Pnt(s,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,i,r){MZ(e,Vd),Vd[2]=r,Jp(i,Vd,BB,this._renderCoordsHelper.spatialReference),Go(dhe,BB),$r(_c);for(const{x0:n,x1:o,y0:a,y1:l}of uvt)for(let c=0;c<5;c++){const h=c/4;Vd[0]=Yt(e[n],e[o],h),Vd[1]=Yt(e[a],e[l],h),Vd[2]=r,_o(Vd,i,Vd,this._renderCoordsHelper.spatialReference),ut(Vd,Vd,dhe),zm(_c,Vd)}fe(this._extent[0].origin,_c[0],_c[1],_c[2]),fe(this._extent[1].origin,_c[3],_c[1],_c[2]),fe(this._extent[2].origin,_c[3],_c[4],_c[2]),fe(this._extent[3].origin,_c[0],_c[4],_c[2]);for(let n=0;n<4;++n)ut(this._extent[n].origin,this._extent[n].origin,BB)}_toRenderBoundingExtentLocal(e,i,r){vU(e,i,Sg,this._renderCoordsHelper.spatialReference),fe(this._extent[0].origin,Sg[0],Sg[1],r),fe(this._extent[1].origin,Sg[2],Sg[1],r),fe(this._extent[2].origin,Sg[2],Sg[3],r),fe(this._extent[3].origin,Sg[0],Sg[3],r)}_toRenderBoundingExtent(e,i,r){switch(this._renderCoordsHelper.viewingMode){case st.Global:this._toRenderBoundingExtentGlobal(e,i,r);break;case st.Local:this._toRenderBoundingExtentLocal(e,i,r);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(e){if(Er(e.planes[Sr.NEAR],this._center.origin)<0&&Ae(this._center.direction,e.direction)<0)return!0;for(let i=0;i<4;i++){const r=this._extent[i];if(Er(e.planes[Sr.NEAR],r.origin)<0&&Ae(r.direction,e.direction)<0)return!0}return!1}};const uvt=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],Vd=M(),BB=We(),dhe=We(),_c=Nn(),Sg=ci(),hvt=nf();let dvt=class{constructor(e){this._renderCoordsHelper=e,this._surfaceElevation=0,this._cache=new Map,this._frustum=new cv(e),this._extendedFrustum=new cv(e),this._intersector=new cvt({renderCoordsHelper:e}),this._renderCoordsHelper=e}begin(e,i){this._surfaceElevation=i,this._aboveGround=this._renderCoordsHelper.getAltitude(e.eye)>i,this._frustum.update(e),this._shortenFrustumFarPlane(this._frustum),this._updateExtendedFrustum(e)}end(){this._cache.clear()}calculate(e){if(this._allTilesInvisible)return wa.INVISIBLE;const i=this._renderCoordsHelper.viewingMode===st.Global&&e.lij[0]>=pvt&&e.lij[0]<fvt,r=this._getOrCalculateSingleTileVisibility(e,!i);return r!==wa.INVISIBLE&&i?this._calculateAggregatedChildrenVisibility(e):r}_shortenFrustumFarPlane(e){const i=cv.nearFarLineIndices,r=e.mutablePoints;for(const s of i){const[n,o]=s,a=r[n],l=r[o];be(mu,l,a),ue(mu,mu,gvt),ve(r[o],a,mu)}e.updatePoints(r)}_calculateAggregatedChildrenVisibility(e){let i=wa.INVISIBLE;const r=this._cache.get(e.id);if(r!=null)return r;const s=ghe.acquire();e.getChildren(s);for(const n of s){const o=this.calculate(n);if(o!==wa.INVISIBLE&&(i=o,o===wa.VISIBLE_ON_SURFACE))break}return ghe.release(s),this._cache.set(e.id,i),i}_getOrCalculateSingleTileVisibility(e,i){const r=this._cache.get(e.id);if(r!=null)return r;const s=this._calculateSingleTileVisibility(e);return i&&this._cache.set(e.id,s),s}_calculateSingleTileVisibility(e){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===st.Global&&e.lij[0]<mvt?this._calculateSingleTileVisibilitySided(e,!1)===wa.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0:this._calculateSingleTileVisibilitySided(e,this._aboveGround)}_calculateSingleTileVisibilitySided(e,i){this._intersector.update(e.extent,e.tilingScheme.spatialReference,this._surfaceElevation,i);const r=tr(e.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,r)?this._intersector.isVisibleInFrustum(this._frustum,r,!0)?wa.VISIBLE_ON_SURFACE:wa.VISIBLE_WHEN_EXTENDED:wa.INVISIBLE}_updateExtendedFrustum(e){this._extendedFrustum.update(e),this._shortenFrustumFarPlane(this._extendedFrustum);const i=this._renderCoordsHelper.worldUpAtPosition(e.eye,mu);this._aboveGround||Pa(i,i);const r=Dn(-Ae(i,e.viewForward));if(this._allTilesInvisible=r>(Math.PI+e.fovY)/2,this._allTilesInvisible||(this._hasExtendedFrustum=r>e.fovY/2,!this._hasExtendedFrustum))return;const s=this._extendedFrustumParameters(),n=this._extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=s.pointIndices[o],l=n[a],c=this._renderCoordsHelper.getAltitude(l);if(s.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,mu),a){case vt.FAR_BOTTOM_LEFT:case vt.FAR_TOP_LEFT:case vt.NEAR_BOTTOM_LEFT:case vt.NEAR_TOP_LEFT:uj(this._extendedFrustum.planes[Sr.LEFT],mu,mu);break;case vt.FAR_BOTTOM_RIGHT:case vt.FAR_TOP_RIGHT:case vt.NEAR_BOTTOM_RIGHT:case vt.NEAR_TOP_RIGHT:uj(this._extendedFrustum.planes[Sr.RIGHT],mu,mu)}ue(mu,mu,s.direction),this._renderCoordsHelper.intersectInfiniteManifold(ih(l,mu),s.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(n),Ta(n[vt.NEAR_BOTTOM_LEFT],n[vt.NEAR_BOTTOM_RIGHT],n[vt.NEAR_TOP_RIGHT],fhe),Ta(n[vt.NEAR_BOTTOM_RIGHT],n[vt.NEAR_TOP_RIGHT],n[vt.NEAR_TOP_LEFT],mhe),Ae(fhe,mhe)<0){const o=this._extendedFrustum.mutablePoints;this._aboveGround?[o[vt.NEAR_BOTTOM_LEFT],o[vt.NEAR_BOTTOM_RIGHT]]=[o[vt.NEAR_BOTTOM_RIGHT],o[vt.NEAR_BOTTOM_LEFT]]:[o[vt.NEAR_TOP_LEFT],o[vt.NEAR_TOP_RIGHT]]=[o[vt.NEAR_TOP_RIGHT],o[vt.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this._surfaceElevation-phe;return{zWithMargin:e,pointIndices:cv.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:i=>i>e}}_extendedFrustumParametersBelowSurface(){const e=this._surfaceElevation+phe;return{zWithMargin:e,pointIndices:cv.planePointIndices.top,direction:1,needsAltitudeAdjustment:i=>i<e}}};const pvt=2,fvt=6,mvt=12,gvt=.95,phe=1,mu=M(),fhe=qi(),mhe=qi(),ghe=new yo(Array,t=>{t.length!==4&&(t[0]=new nM,t[1]=new nM,t[2]=new nM,t[3]=new nM)},t=>{t[0].release(),t[1].release(),t[2].release(),t[3].release()});let yvt=class{constructor(e){this._camera=new Ut,this._focusOnMap=[0,0],this._screenRect=ci(),this._tileSize=e.tileSize,this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new dvt(e.renderCoordsHelper)}begin(e,i,r){this._camera.copyFrom(e),this._surfaceElevation=r,this._focusOnMap[0]=i.x,this._focusOnMap[1]=i.y,OZ(0,0,e.fullWidth,e.fullHeight,this._screenRect),this._visibility.begin(this._camera,r)}end(){this._visibility.end()}updateTile(e){e.measures.visibility=this._visibility.calculate(e),e.measures.distance=y6e(e.extent,this._focusOnMap),e.measures.visibility!==wa.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const i=_vt,r=1<<i,s=e.measures.screenRect;yd(s);let n=0;const o=e.lij[0]+i,a=e.lij[1]<<i,l=e.lij[2]<<i,c=this._tileSizeWithBias(e),h=c*c;for(let p=0;p<r;p++)for(let f=0;f<r;f++)if(n+=this._computeScreenArea(e,o,a+p,l+f,s),n>h)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===wa.VISIBLE_WHEN_EXTENDED?this._tileSize*vvt:this._tileSize}_computeScreenArea(e,i,r,s,n){const o=e.measures.visibility===wa.VISIBLE_WHEN_EXTENDED;this._projectToScreen(i,r,s,o,t_),yd(zB);for(let a=0;a<4;a++)RZ(zB,t_[a]);return Lv(n,zB,n),Pae(t_[0],t_[1],t_[2])+Pae(t_[0],t_[2],t_[3])}_projectToScreen(e,i,r,s,n){this._tilingScheme.ensureMaxLod(e),this._tilingScheme.getExtent(e,i,r,CO),this._toRenderCoords(CO,0,3,i_[0]),this._toRenderCoords(CO,2,3,i_[1]),this._toRenderCoords(CO,2,1,i_[2]),this._toRenderCoords(CO,0,1,i_[3]),s&&(this._projectToPlane(i_,this._camera.frustum[Sr.NEAR]),this._projectToPlane(i_,this._camera.frustum[Sr.TOP]),this._projectToPlane(i_,this._camera.frustum[Sr.BOTTOM]));for(let o=0;o<4;o++)this._camera.projectToRenderScreen(i_[o],yhe),this._camera.renderToScreen(yhe,n[o])}_projectToPlane(e,i){for(let s=0;s<4;s++)OO[s]=Er(i,e[s]);const r=Math.max(OO[0],OO[1],OO[2],OO[3]);if(r>0){const s=ue(AO,i,-r);for(let n=0;n<4;n++)ve(e[n],e[n],s)}}_toRenderCoords(e,i,r,s){return AO[0]=e[i],AO[1]=e[r],AO[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(AO,this._tilingScheme.spatialReference,s),s}};const zB=ci(),_vt=2,vvt=5,t_=[ms(),ms(),ms(),ms()],CO=ci(),AO=M(),i_=[M(),M(),M(),M()],OO=[0,0,0,0],yhe=na();function h8t(t,e,i){if(C(t)||C(i))return!1;let r=!0;return En[0]=t.xmin!=null?t.xmin:0,En[1]=t.ymin!=null?t.ymin:0,En[2]=t.zmin!=null?t.zmin:0,r=r&&Es(En,t.spatialReference,0,e,i,0,1),En[0]=t.xmax!=null?t.xmax:0,En[1]=t.ymax!=null?t.ymax:0,En[2]=t.zmax!=null?t.zmax:0,r=r&&Es(En,t.spatialReference,0,e,i,3,1),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),r}function fMe(t,e,i){if(C(t)||C(i))return!1;let r=!0;return En[0]=t.xmin!=null?t.xmin:0,En[1]=t.ymin!=null?t.ymin:0,En[2]=t.zmin!=null?t.zmin:0,r=r&&Es(En,t.spatialReference,0,En,i,0,1),e[0]=En[0],e[1]=En[1],En[0]=t.xmax!=null?t.xmax:0,En[1]=t.ymax!=null?t.ymax:0,En[2]=t.zmax!=null?t.zmax:0,r=r&&Es(En,t.spatialReference,0,En,i,0,1),e[2]=En[0],e[3]=En[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),r}const En=M();let Do=class extends $e{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(v(e)&&!e.spatialReference.equals(this.viewState.spatialReference))return void oe.getLogger(this.declaredClass).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const i=this._get("filterExtent");if(i===e||v(i)&&e&&i.equals(e))return;const r=v(e)?e.clone():null;this._set("filterExtent",r),this._setDirty()}get _filterExtentRect(){if(C(this.filterExtent))return null;const e=ci();return fMe(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new Nt,this.tileSize=512,this._idToTile=new Map,this._handles=new Ki,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new li}initialize(){this._handles.add([re(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),Wi),re(()=>{var e,i,r;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(i=this.viewState)==null?void 0:i.contentCamera,(r=this.focus)==null?void 0:r.location]},()=>this._setDirty(),Br)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(Rt.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=Rr(this._frameWorker),this._handles=Je(this._handles)}addClient(){const e=wvt();return this._clients.add(e),this._clients.size===1&&this._setDirty(),{remove:()=>this._removeClient(e)}}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(ll))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),v(this._frameWorker)&&(this._frameWorker.priority=Rt.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),!this._pendingTiles&&v(this._frameWorker)&&(this._frameWorker.priority=Rt.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new yvt({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(i=>new nM(i[0],i[1],i[2],e))}_purgeHorizonTiles(e){e.sort((i,r)=>{const s=i.measures.screenRect,n=r.measures.screenRect;return s[1]+s[3]-(n[1]+n[3])}),yd(dD);for(let i=0;i<e.length;i++)if(Lv(dD,e.data[i].measures.screenRect,dD),Zp(dD)>xvt)return e.data.slice(i,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:i}=this;for(;this._pendingTiles.length>0&&!e.done;){const r=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!iU(this._filterExtentRect,r.extent)||(this._tileMeasurements.updateTile(r),r.measures.visibility!==wa.INVISIBLE&&(r.measures.shouldSplit?(i.ensureMaxLod(r.lij[0]+1),this._pendingTiles.push(...r.getChildren())):this._newTiles.push(r)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const s of this.tiles.items)s.used=!1;const i=e.filter(s=>{const n=this._idToTile.get(s.id);return n?(n.copyMeasurementsFrom(s),n.used=!0):this._idToTile.set(s.id,s),!n}),r=this.tiles.items.filter(s=>!s.used&&(this._idToTile.delete(s.id),!0));this.tiles.removeMany(r),this.tiles.addMany(i),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,i)=>e.measures.visibility!==i.measures.visibility?e.measures.visibility===wa.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-i.measures.distance),this.tiles.forEach((e,i)=>e.loadPriority=i)}};u([d({constructOnly:!0})],Do.prototype,"scheduler",void 0),u([d({constructOnly:!0})],Do.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],Do.prototype,"tilingSchemeOwner",void 0),u([d({constructOnly:!0})],Do.prototype,"cameraOnSurface",void 0),u([d({constructOnly:!0})],Do.prototype,"focus",void 0),u([d({constructOnly:!0})],Do.prototype,"viewState",void 0),u([d({constructOnly:!0})],Do.prototype,"terrain",void 0),u([d()],Do.prototype,"tiles",void 0),u([d()],Do.prototype,"tileSize",void 0),u([d({readOnly:!0})],Do.prototype,"tilingScheme",null),u([d()],Do.prototype,"filterExtent",null),u([d({readOnly:!0})],Do.prototype,"_filterExtentRect",null),u([d({readOnly:!0})],Do.prototype,"_rootTileIds",null),u([d({value:!1})],Do.prototype,"suspended",null),u([d({readOnly:!0})],Do.prototype,"updating",null),Do=u([I("esri.views.3d.layers.support.FeatureTileTree3D")],Do);let bvt=0;function wvt(){return bvt++}const dD=ci(),xvt=10;let wn=class extends $e{constructor(){super(...arguments),this._propertiesPool=new Xy({camera:Ut},this),this._lastSeenCameraProjectionValues=new Ut,this.mode=Mi.ANIMATING,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new As,this.viewingMode=st.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,i){this._set("viewingMode",e),this._set("spatialReference",i),this._set("constraints",new Yg({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new Xy({camera:Ut},this)}createInitialCamera(){if(this.viewingMode===st.Global){const e=tr(this.spatialReference).radius;this.camera=new Ut({eye:Xe(4*e,0,0),center:Xe(e,0,0),up:Xe(0,0,1)})}else this.camera=new Ut({eye:Xe(0,0,100),center:Xe(0,0,0),up:Xe(0,1,0)})}get animation(){return this.cameraController instanceof fP&&v(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}get camera(){return this._get("camera")}set camera(e){e!==mh&&mh.copyFrom(e),mh.computeUp(this.viewingMode),this.events.emit("before-camera-change",mh);const i=this._get("camera");if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,mh)&&(this._lastSeenCameraProjectionValues.copyFrom(mh),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),(!i||!i.equals(mh))&&(this._set("camera",this._propertiesPool.get("camera").copyFrom(mh)),this._cameraChanged=!i||!i.almostEquals(mh),this._cameraChanged)){const r=Vme(()=>{this._cameraChanged=!1,r.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get contentCamera(){return Gt(this._contentCamera,this.camera)}set contentCamera(e){this._contentCamera=v(e)?e.clone():null}get fixedContentCamera(){return v(this._contentCamera)}get isGlobal(){return this.viewingMode===st.Global}get isLocal(){return this.viewingMode===st.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(e&&(this.removeHandles(_he),this.addHandles(qo(()=>e.state===fs.Finished||e.state===fs.Stopped,()=>{this._set("cameraController",null),this.updateCamera(i=>e.onControllerEnd(i))},{sync:!0,once:!0}),_he),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=fs.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==fs.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();mh.copyFrom(this._get("camera")),e(mh),this.camera=mh,this._processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,i){return e.fov!==i.fov||e.fullViewport[0]!==i.fullViewport[0]||e.fullViewport[1]!==i.fullViewport[1]||e.fullViewport[2]!==i.fullViewport[2]||e.fullViewport[3]!==i.fullViewport[3]||e.padding[bi.TOP]!==i.padding[bi.TOP]||e.padding[bi.RIGHT]!==i.padding[bi.RIGHT]||e.padding[bi.BOTTOM]!==i.padding[bi.BOTTOM]||e.padding[bi.LEFT]!==i.padding[bi.LEFT]}};u([d()],wn.prototype,"mode",void 0),u([d({readOnly:!0,type:Yy})],wn.prototype,"animation",null),u([d({type:Ut})],wn.prototype,"camera",null),u([d({readOnly:!0})],wn.prototype,"pixelRatio",null),u([d()],wn.prototype,"rasterPixelRatio",void 0),u([d()],wn.prototype,"contentPixelRatio",void 0),u([d({})],wn.prototype,"_contentCamera",void 0),u([d({type:Ut})],wn.prototype,"contentCamera",null),u([d({readOnly:!0})],wn.prototype,"fixedContentCamera",null),u([d({readOnly:!0})],wn.prototype,"constraints",void 0),u([d({readOnly:!0})],wn.prototype,"events",void 0),u([d({readOnly:!0})],wn.prototype,"isGlobal",null),u([d({readOnly:!0})],wn.prototype,"isLocal",null),u([d({readOnly:!0})],wn.prototype,"viewingMode",void 0),u([d({readOnly:!0})],wn.prototype,"spatialReference",void 0),u([d()],wn.prototype,"navigating",null),u([d()],wn.prototype,"stationary",null),u([d()],wn.prototype,"_cameraChanged",void 0),u([d()],wn.prototype,"cameraController",null),wn=u([I("esri.views.3d.state.ViewState")],wn);const Tvt=wn,mh=new Ut,_he="ViewStateHandles";let Svt=class{constructor(e,i,r){this.viewingMode=e,this._forEachLayer=i,this._view=r,this._externalIntersectionHandlers=new li,this._tolerance=IC,this._tmpRay=fo(),this._tmpRegion=ci(),this._validateHUDIntersector=xd(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,i,r){return this.intersectRay(this._getPickRay(e,this._tmpRay),vhe(this.viewingMode),i,r)}intersectScreenFreePointFallback(e,i,r){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),i,r)}intersectRayFreePointFallback(e,i,r){return this.intersectRay(e,vhe(this.viewingMode),i,r)||this._intersectRayFreePointLocal(e,i)}intersectRay(e,i,r,s){return i.options.selectionMode=!1,i.options.store=Ho.MIN,this.computeIntersection(e,i,s),!!i.results.min&&i.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(e,i,r=.5,s=.5){return e.getRenderCenter(mD,r,s),mD[0]+=.0466,mD[1]-=.0123,DQ(e,mD,i)}intersectIntersectorScreen(e,i,r){this.computeIntersection(this._getPickRay(e,this._tmpRay),i,r)}intersectToolIntersectorScreen(e,i,r){const s=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(s,i,r)}intersectToolIntersectorRay(e,i,r){i.options.selectionMode=!0,this.computeIntersection(e,i,r);const s=i.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||lf(s)&&s.intersector!==as.TERRAIN||(i.options.selectionMode=!1,this.computeIntersection(e,i,r))}setTolerance(e=IC){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((i,r)=>i.type===as.TERRAIN?1:r.type===as.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((i,r)=>i.type===as.TERRAIN?1:r.type===as.TERRAIN?-1:0)}_getPickRay(e,i){const r=this._view.state.camera;return hEe(r,e,i)}_intersectRayFreePointLocal(e,i){return this.viewingMode!==st.Local||C(e)||ve(i,e.origin,Oe(at.get(),e.direction)),!1}intersectElevationFromScreen(e,i,r=0,s=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),i,r,s)}_intersectElevation(e,i,r=0,s=null){if(C(e))return null;const n=v(i)?i.mode:"absolute-height",o=v(i)?Gt(i.offset,0):0,a=n!=="on-the-ground"?o+r:0,l=a/this._view.renderCoordsHelper.unitInMeters;if(n==="absolute-height"){if(this._view.renderCoordsHelper.intersectInfiniteManifold(e,a,fD)){const S=this._view.computeMapPointFromVec3d(fD);return S.z??(S.z=0),S.z-=o,S}return null}const c=this._view.state.camera,h=at.get();c.projectToRenderScreen(e.origin,h);const p=new bhe(null,this._forEachLayer),f=this._view.slicePlane,m=v(f)?hle(f):null,y=xd(this.viewingMode);y.options.store=Ho.MIN,y.options.verticalOffset=l;const _=e.origin,b=ve(at.get(),_,e.direction);y.reset(_,b,c),y.point=h;const w=v(s)?"type"in s&&s.type==="graphics"?S=>{var T;return((T=S.metadata)==null?void 0:T.layerUid)!==s.uid}:S=>{var T;return((T=S.metadata)==null?void 0:T.graphicUid)!==s.uid}:null;switch(n){case"relative-to-scene":{const S=T=>{var E;return(C(w)||w(T))&&!!((E=T.metadata)!=null&&E.isElevationSource)};y.intersect(p.layers,h,this._tolerance,null,S),this._externalIntersectionHandlers.forAll(T=>{if(T.type===as.I3S||T.type===as.TERRAIN){const E=T.slicePlaneEnabled?m:null;T.intersect(y,E,y.rayBegin,y.rayEnd,h)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(S=>{if(S.isGround){const T=S.slicePlaneEnabled?m:null;S.intersect(y,T,y.rayBegin,y.rayEnd,h)}})}if(y.results.min.getIntersectionPoint(fD)){const S=this._view.computeMapPointFromVec3d(fD);return S.z=r,S}return null}computeIntersection(e,i,r){var y;if(C(e))return;const s=this._view.state.camera,n=at.get();s.projectToRenderScreen(e.origin,n);const o=new bhe(r,this._forEachLayer);i.options.selectOpaqueTerrainOnly=!r||!("include"in r||"exclude"in r);const a=e.origin,l=ve(at.get(),e.origin,e.direction);i.reset(a,l,s),i.intersect(o.layers,n,this._tolerance);const c=this._view.slicePlane,h=v(c)?hle(c):null;i.intersect(o.sliceableLayers,n,this._tolerance,h);const p=r&&(r.requiresGroundFeedback||r.enableDraped);this._externalIntersectionHandlers.forAll(_=>{const b=_.layerUid,w=Array.isArray(b),S=w?b:[b];w&&(i.options.filteredLayerUids=[]);let T=!1;for(const E of S)o.filterLayerUid(E)?T=!0:w&&i.options.filteredLayerUids.push(E);if(i.options.isFiltered=!T,_.isGround&&p||!i.options.isFiltered){const E=_.slicePlaneEnabled?h:null;_.intersect(i,E,a,l,n)}});const f=at.get(),m=this._view.basemapTerrain;if(r&&r.enableDraped&&v(m.spatialReference)&&i.results.ground.getIntersectionPoint(f)){const _=m.overlayManager.renderer,b=this._view.renderCoordsHelper.spatialReference,w=at.get();this._view.renderCoordsHelper.fromRenderCoords(f,w,m.spatialReference),w[2]=Gt((y=this._view.elevationProvider)==null?void 0:y.getElevation(f[0],f[1],f[2],b,"ground"),0),_.intersect(i,w,i.results.ground,S=>o.filterRenderGeometry(S))}i.sortResults(),this._processHUDResults(i)}_processHUDResults(e){const i=e.results.hud;jy(this._tmpRegion,lG);const r=this._view.state.camera,s=[],n=this._tmpRegion,o=w=>{const S=new Cvt(w);r.projectToRenderScreen(w.target.center,S.screenPoint),S.screenPoint[0]=Math.floor(S.screenPoint[0]),S.screenPoint[1]=Math.floor(S.screenPoint[1]),s.push(S),RZ(n,S.screenPoint)};e.sortResults(i.all),v(i.min.dist)&&o(i.min);for(const w of i.all)i.min.target.object!==w.target.object&&i.max.target.object!==w.target.object&&o(w);if(v(i.max.dist)&&i.max.target.object!==i.min.target.object&&o(i.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const a=r.fullWidth,l=r.fullHeight,c=Math.max(0,n[0]-oM),h=Math.max(0,n[1]-oM),p=Math.min(zu(n)+2*oM,a-c),f=Math.min(Zp(n)+2*oM,l-h),m=new Uint8Array(p*f*4);this._view._stage.renderer.readHUDVisibility(c,h,p,f,m);let y=!0;const _=C(e.results.max.dist);let b=0;for(const w of s)for(const S of Evt)if(m[4*(Math.min(w.screenPoint[0]+S[0],a)-n[0]+(Math.min(w.screenPoint[1]+S[1],l)-n[1])*p)]){y&&(e.results.min.copy(w.result),y=!1),_&&e.results.max.copy(w.result),e.options.store===Ho.ALL&&e.results.all.splice(b++,0,w.result);break}}};const oM=1,Evt=(()=>{const t=[],e=oM;for(let i=-e;i<=e;i++)for(let r=-e;r<=e;r++)t.push([r+e,i+e]);return t})();let Cvt=class{constructor(e){this.result=e,this.screenPoint=na()}},pD;function vhe(t){return pD&&pD.viewingMode===t||(pD=xd(t)),pD}let bhe=class{constructor(e,i){this.layers=new Array,this.sliceableLayers=new Array,this.include=e==null?void 0:e.include,this.exclude=e==null?void 0:e.exclude,i(r=>{r.pickable&&this.filterLayerUid(r.apiLayerUid)&&(r.sliceable?this.sliceableLayers:this.layers).push(r)})}filterLayerUid(e){const{include:i,exclude:r}=this;return C(e)?i==null&&r==null:(i==null||i.has(e))&&(r==null||!r.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function whe(t){return typeof t=="object"&&"intersect"in t}const fD=M(),mD=na();let y8t=class{constructor(e,i){this.spatialReference=e,this._view=i}getElevation(e,i,r){return this._view.elevationProvider.getElevation(e,i,0,this.spatialReference,r)}async queryElevation(e,i,r,s,n){return this._view.elevationProvider.queryElevation(e,i,0,this.spatialReference,n,r,s)}},Avt=class{constructor(e,i,r,s){this.spatialReference=i,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions={...s,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(Rt.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(e,i,r,s=0){return new Promise((n,o)=>{const a={x:e,y:i,minDemResolution:s,result:{resolve:n,reject:o},signal:r};this._queries.push(a),ca(r,()=>{OY(this._queries,a),o(Bi())})})}get running(){return this._queries.length>0}runTask(e){const i=this._queries;this._queries=[];const r=this._getElevationQueryProvider();if(!r)return i.forEach(h=>h.result.reject()),void e.madeProgress();const s=i.map(h=>[h.x,h.y]),n=i.reduce((h,p)=>Math.min(h,p.minDemResolution),1/0),o=new ZP({points:s,spatialReference:this.spatialReference}),a=i.length>1&&i.some(h=>!!h.signal)?new AbortController:null,l=v(a)?a.signal:i[0].signal;if(v(a)){let h=0;i.forEach(p=>ca(p.signal,()=>{h++,p.result.reject(Bi()),h===i.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:n,signal:l};r.queryElevation(o,c).then(h=>{i.forEach((p,f)=>{v(p.signal)&&p.signal.aborted?p.result.reject(Bi()):p.result.resolve(h.geometry.points[f][2])})}).catch(h=>{i.forEach(p=>p.result.reject(h))}),e.madeProgress()}get test(){const e=this;return{update:()=>e._queries.length>0&&e.runTask(ll)}}},aM=class extends As.EventedMixin($e){get spatialReference(){var e,i;return(i=(e=this.view)==null?void 0:e.basemapTerrain)==null?void 0:i.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this._handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQueryCached=Je(this._elevationQueryCached)}get _elevationQuery(){return C(this._elevationQueryCached)&&(this._elevationQueryCached=new Avt(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQueryCached}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,i,r,s,n){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const a=this.lastElevationQuery;if(e===a.x&&i===a.y&&r===a.z&&rn(s,a.spatialReference)&&n===a.queryContext)return a.result}let o=null;return o=gD(o,this._im,e,i,r,s,n),C(o)&&(o=gD(o,this._ground,e,i,r,s,n)),n==="scene"&&(o=gD(o,this._scene,e,i,r,s,n)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:i,z:r,spatialReference:s,queryContext:n,result:o}),o}queryElevation(e,i,r,s,n,o=null,a=0){const l=qv();return this._elevationQuery.queryElevation(e,i,o,a).then(c=>{n==="scene"&&(c=gD(c,this._scene,e,i,r,s,n)),l.resolve(c)}).catch(c=>{ln(c)?l.reject(c):l.resolve(this.getElevation(e,i,r,s,n))}),l.promise}register(e,i){this._handles.set(i,i.on("elevation-change",r=>this.emit("elevation-change",r))),this._providersFromContext(e).push(i)}unregister(e){var i;this._handles.has(e)&&((i=this._handles.get(e))==null||i.remove(),this._handles.delete(e));for(const r of[this._im,this._ground,this._scene]){const s=r.indexOf(e);s>-1&&r.splice(s,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}};function gD(t,e,i,r,s,n,o){for(const a of e){const l=a.getElevation(i,r,s,n,o);v(l)&&(t=v(t)?Math.max(l,t):l)}return t}u([d({constructOnly:!0})],aM.prototype,"view",void 0),u([d()],aM.prototype,"spatialReference",null),aM=u([I("esri.views.3d.support.CombinedElevationProvider")],aM);let lM=class yX{static isValidProfile(e){return e in yX.profiles}static getDefaultProfile(){return de("esri-iPhone")?"low":"medium"}static apply(e,i){const r=yX.profiles[e];i.graphics3D.maxTotalNumberOfFeatures=r.graphics3D.maxTotalNumberOfFeatures,i.graphics3D.maxTotalNumberOfPrimitives=r.graphics3D.maxTotalNumberOfPrimitives,i.graphics3D.polygonLodFactor=r.graphics3D.polygonLodFactor,i.graphics3D.polylineLodFactor=r.graphics3D.polylineLodFactor,i.graphics3D.snapshotAvailable=r.graphics3D.snapshotAvailable,i.graphics3D.skipHighSymbolLods=r.graphics3D.skipHighSymbolLods;const s=i.sceneService.object,n=r.sceneService.object;s.lodFactor=n.lodFactor,s.lodCrossfadeinDuration=n.lodCrossfadeinDuration,s.lodCrossfadeoutDuration=n.lodCrossfadeoutDuration,s.lodCrossfadeUncoveredDuration=n.lodCrossfadeUncoveredDuration,i.sceneService.point.lodFactor=r.sceneService.point.lodFactor,i.sceneService.integratedMesh.lodFactor=r.sceneService.integratedMesh.lodFactor,i.sceneService.pointCloud.lodFactor=r.sceneService.pointCloud.lodFactor,i.sceneService.uncompressedTextureDownsamplingEnabled=r.sceneService.uncompressedTextureDownsamplingEnabled,i.tiledSurface.lodBias=r.tiledSurface.lodBias,i.tiledSurface.angledSplitBias=r.tiledSurface.angledSplitBias,i.tiledSurface.reduceTileLevelDifferences=r.tiledSurface.reduceTileLevelDifferences,i.tiledSurface.textureFadeDuration=r.tiledSurface.textureFadeDuration,i.heatmap.pixelRatio=r.heatmap.pixelRatio,i.heatmap.maxTotalNumberOfFeatures=r.heatmap.maxTotalNumberOfFeatures,i.fadeDuration=r.fadeDuration,i.antialiasingEnabled=r.antialiasingEnabled,i.physicallyBasedRenderingEnabled=r.physicalBasedRenderingEnabled,i.highQualityTransparency=r.highQualityTransparency,i.memoryLimit=r.memoryLimit,i.additionalCacheMemory=r.additionalCacheMemory,i.frameRate=r.frameRate,i.maximumPixelRatio=r.maximumPixelRatio}};function xhe(){const t=!!de("esri-mobile"),e=!!de("ios"),i=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:i},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:t},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!de("disable-feature:reduce-map-tile-levels"),textureFadeDuration:i},fadeDuration:i,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:t?600:750,additionalCacheMemory:t?0:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:i},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!de("disable-feature:reduce-map-tile-levels"),textureFadeDuration:i},fadeDuration:i,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:t?900:1500,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}lM.test={reset(){const t=xhe();for(const e in t)lM.profiles[e]=t[e]}},function(t){t.profiles=xhe()}(lM||(lM={}));const IF=lM;function mMe(){return new Float32Array(4)}function Ovt(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function sf(t,e,i,r){const s=new Float32Array(4);return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function Rvt(t,e){return new Float32Array(t,e,4)}function gMe(){return mMe()}function yMe(){return sf(1,1,1,1)}function _Me(){return sf(1,0,0,0)}function vMe(){return sf(0,1,0,0)}function bMe(){return sf(0,0,1,0)}function wMe(){return sf(0,0,0,1)}const Mvt=gMe(),Pvt=yMe(),Ivt=_Me(),$vt=vMe(),Lvt=bMe(),Dvt=wMe();Object.freeze(Object.defineProperty({__proto__:null,ONES:Pvt,UNIT_W:Dvt,UNIT_X:Ivt,UNIT_Y:$vt,UNIT_Z:Lvt,ZEROS:Mvt,clone:Ovt,create:mMe,createView:Rvt,fromValues:sf,ones:yMe,unitW:wMe,unitX:_Me,unitY:vMe,unitZ:bMe,zeros:gMe},Symbol.toStringTag,{value:"Module"}));const The=new ot([0,255,255]),She=new ot([0,0,0]),Ehe=1,Che=.25,Ahe=.4,Ohe=.2;let Yf=class extends $e{constructor(){super(...arguments),this.color=The.clone(),this.haloColor=null,this.haloOpacity=Ehe,this.fillOpacity=Che,this.shadowOpacity=Ahe,this.shadowColor=She.clone(),this.shadowDifference=Ohe}static toEngineOptions(e){const i=ot.toUnitRGBA(e.color??The),r=v(e.haloColor)?ot.toUnitRGBA(e.haloColor):i,s=ot.toUnitRGBA(e.shadowColor??She),n=e.haloOpacity??Ehe,o=e.fillOpacity??Che,a=e.shadowOpacity??Ahe,l=e.shadowDifference??Ohe;return{color:sf(i[0],i[1],i[2],i[3]),haloColor:sf(r[0],r[1],r[2],r[3]),haloOpacity:n,haloOpacityOccluded:.25*n,fillOpacity:o,fillOpacityOccluded:.25*o,shadowOpacity:a,shadowColor:si(s[0],s[1],s[2],s[3]),occludedShadowOpacity:a*(1-l)}}};u([d({type:ot})],Yf.prototype,"color",void 0),u([d({type:ot})],Yf.prototype,"haloColor",void 0),u([d()],Yf.prototype,"haloOpacity",void 0),u([d()],Yf.prototype,"fillOpacity",void 0),u([d()],Yf.prototype,"shadowOpacity",void 0),u([d({type:ot})],Yf.prototype,"shadowColor",void 0),u([d()],Yf.prototype,"shadowDifference",void 0),Yf=u([I("esri.views.3d.support.HighlightOptions")],Yf);const _X=Yf;let cw=class extends Ie{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(s=>s.toJSON()),i=this.geometries[0],r={};return r.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),r.inSR=i.spatialReference.wkid||JSON.stringify(i.spatialReference.toJSON()),r.geometries=JSON.stringify({geometryType:YC(i),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(r.transformForward=this.transformForward),r}};u([d()],cw.prototype,"geometries",void 0),u([d({json:{read:{source:"outSR"}}})],cw.prototype,"outSpatialReference",void 0),u([d()],cw.prototype,"transformation",void 0),u([d()],cw.prototype,"transformForward",void 0),cw=u([I("esri.rest.support.ProjectParameters")],cw);const jee=cw,Nvt=mn(jee);async function xMe(t,e,i){e=Nvt(e);const r=WJ(t),s={...r.query,f:"json",...e.toJSON()},n=e.outSpatialReference,o=YC(e.geometries[0]),a=_je(s,i);return zr(r.path+"/project",a).then(({data:{geometries:l}})=>Obe(l,o,n))}async function Hee(t=null,e){var s,n;if(ar.geometryServiceUrl)return ar.geometryServiceUrl;if(!t)throw new W("internal:geometry-service-url-not-configured");let i;i="portal"in t?t.portal||uc.getDefault():t,await i.load({signal:e});const r=(n=(s=i.helperServices)==null?void 0:s.geometry)==null?void 0:n.url;if(!r)throw new W("internal:geometry-service-url-not-configured");return r}async function Fvt(t,e,i=null,r){const s=await Hee(i,r),n=new jee;n.geometries=[t],n.outSpatialReference=e;const o=await xMe(s,n,{signal:r});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new W("internal:geometry-service-projection-failed")}const Uvt=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:Hee,projectGeometry:Fvt},Symbol.toStringTag,{value:"Module"}));let Vvt=class{constructor(e,i){this.spatialReference=i,this.unitInMeters=_l(this.spatialReference,tr(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=Hee(e&&e.get("portalItem")).catch(()=>{throw new W("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(e){const i=await this._geometryServiceURLPromise;let r,s=!0;Array.isArray(e[0])&&typeof e[0]!="number"?r=e:(r=[e],s=!1);const n=r.map(l=>l instanceof pt?l:new pt(l,this.spatialReference)),o=new jee({geometries:n,outSpatialReference:mt.WGS84}),a=(await xMe(i,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0).filter(l=>!!l);return s?a:a[0]}},pp=class extends $e{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1}};u([d()],pp.prototype,"minTotalNumberOfFeatures",void 0),u([d()],pp.prototype,"maxTotalNumberOfFeatures",void 0),u([d()],pp.prototype,"maxTotalNumberOfPrimitives",void 0),u([d()],pp.prototype,"snapshotAvailable",void 0),u([d()],pp.prototype,"polygonLodFactor",void 0),u([d()],pp.prototype,"polylineLodFactor",void 0),u([d()],pp.prototype,"skipHighSymbolLods",void 0),pp=u([I("esri.views.3d.support.QualitySettings.Graphics3DSettings")],pp);let $m=class extends $e{constructor(){super(...arguments),this.lodFactor=1}};u([d()],$m.prototype,"lodFactor",void 0),$m=u([I("esri.views.3d.support.QualitySettings.LoDFactorSettings")],$m);let n6=class extends $m{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};n6=u([I("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],n6);let cy=class extends $e{constructor(){super(...arguments),this.object=new n6,this.point=new $m,this.integratedMesh=new $m,this.pointCloud=new $m,this.uncompressedTextureDownsamplingEnabled=!1}};u([d({type:n6})],cy.prototype,"object",void 0),u([d({type:$m})],cy.prototype,"point",void 0),u([d({type:$m})],cy.prototype,"integratedMesh",void 0),u([d({type:$m})],cy.prototype,"pointCloud",void 0),u([d()],cy.prototype,"uncompressedTextureDownsamplingEnabled",void 0),cy=u([I("esri.views.3d.support.QualitySettings.SceneServiceSettings")],cy);let iv=class extends $e{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=400}};u([d()],iv.prototype,"lodBias",void 0),u([d()],iv.prototype,"angledSplitBias",void 0),u([d()],iv.prototype,"reduceTileLevelDifferences",void 0),u([d()],iv.prototype,"textureFadeDuration",void 0),iv=u([I("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],iv);let nE=class extends $e{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};u([d()],nE.prototype,"pixelRatio",void 0),u([d()],nE.prototype,"maxTotalNumberOfFeatures",void 0),nE=u([I("esri.views.3d.support.QualitySettings.HeatmapSettings")],nE);let zl=class extends $e{constructor(){super(...arguments),this.graphics3D=new pp,this.sceneService=new cy,this.tiledSurface=new iv,this.heatmap=new nE,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.memoryLimit=void 0,this.additionalCacheMemory=void 0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};u([d({type:pp})],zl.prototype,"graphics3D",void 0),u([d({type:cy})],zl.prototype,"sceneService",void 0),u([d({type:iv})],zl.prototype,"tiledSurface",void 0),u([d({type:nE})],zl.prototype,"heatmap",void 0),u([d()],zl.prototype,"fadeDuration",void 0),u([d()],zl.prototype,"antialiasingEnabled",void 0),u([d()],zl.prototype,"physicallyBasedRenderingEnabled",void 0),u([d()],zl.prototype,"highQualityTransparency",void 0),u([d()],zl.prototype,"memoryLimit",void 0),u([d()],zl.prototype,"additionalCacheMemory",void 0),u([d()],zl.prototype,"frameRate",void 0),u([d()],zl.prototype,"maximumPixelRatio",void 0),zl=u([I("esri.views.3d.support.QualitySettings.QualitySettings")],zl);const Rhe=zl;function kvt(t){return PY(t)&&t.length>=3}function Bvt(t){return(IY(t)||Array.isArray(t))&&t.length>=3}function zvt(t){return kvt(t)||Bvt(t)}let Gvt=class vX{constructor(e,i,r,s){this.viewingMode=e,this.spatialReference=i,this.unitInMeters=r,this._coordinateSystem=s,this._tmpCoordinateSystem=kke(s)}set extent(e){e&&Bke(this._coordinateSystem,e,this._coordinateSystem)}getAltitude(e){return Yke(this._coordinateSystem,e)}setAltitude(e,i,r=e){return Nve(this._coordinateSystem,r,i,e)}setAltitudeOfTransformation(e,i){Zke(this._coordinateSystem,i,e,i)}worldUpAtPosition(e,i){return Hke(this._coordinateSystem,e,i)}worldBasisAtPosition(e,i,r){return qke(this._coordinateSystem,e,i,r)}basisMatrixAtPosition(e,i){const r=this.worldBasisAtPosition(e,Xc.X,at.get()),s=this.worldBasisAtPosition(e,Xc.Y,at.get()),n=this.worldBasisAtPosition(e,Xc.Z,at.get());return eg(i,r[0],r[1],r[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),i}headingAtPosition(e,i){const r=this.worldUpAtPosition(e,at.get()),s=this.worldBasisAtPosition(e,Xc.Y,at.get()),n=hve(i,s,r);return yl(n)}intersectManifoldClosestSilhouette(e,i,r){return WV(this._coordinateSystem,i,this._tmpCoordinateSystem),Xke(this._tmpCoordinateSystem,e,r),r}intersectManifold(e,i,r){WV(this._coordinateSystem,i,this._tmpCoordinateSystem);const s=at.get();return Wke(this._tmpCoordinateSystem,e,s)?he(r,s):null}intersectInfiniteManifold(e,i,r){if(this.viewingMode===st.Global)return this.intersectManifold(e,i,r);WV(this._coordinateSystem,i,this._tmpCoordinateSystem);const s=this._tmpCoordinateSystem.value,n=at.get();return hT(s.plane,e,n)?he(r,n):null}toRenderCoords(e,i,r){return F5(e)?da(e,i,this.spatialReference):_o(e,i,r,this.spatialReference)}fromRenderCoords(e,i,r=null){return F5(i)?(v(r)&&(i.spatialReference=r),C_e(e,this.spatialReference,i)):zvt(i)?_o(e,this.spatialReference,i,r)?i:null:Kv(e,this.spatialReference,i)}static create(e,i){switch(e){case st.Local:return new vX(st.Local,i,_l(i),jke());case st.Global:return new vX(st.Global,i,1,Gke(i))}}static renderUnitScaleFactor(e,i){return Mhe(e)/Mhe(i)}};function Mhe(t){if(U5(t,st.Global))return 1;const e=Fve(!1,t);return _l(e)}var ym;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.BASEMAP=1]="BASEMAP",t[t.I3S_INDEX=2]="I3S_INDEX",t[t.I3S_DATA=3]="I3S_DATA",t[t.SYMBOLOGY=4]="SYMBOLOGY"})(ym||(ym={}));const jvt=(()=>{const t=new Array;return t[ym.ELEVATION]=10,t[ym.BASEMAP]=10,t[ym.I3S_INDEX]=10,t[ym.I3S_DATA]=10,t[ym.SYMBOLOGY]=5,t})(),Hvt=30;function TMe(t){return typeof t.getUsedMemory=="function"}function qvt(t){return new Gl({view:t})}const yD=1,GB=1,Wvt=.75,Xvt=.6,Phe=1.3;let Gl=class extends $e{constructor(e){super(e),this._quality=1,this._memoryUsed=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new HJ,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=500,this._additionalCacheMemory=100}destroy(){this._cacheStorage.destroy()}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(yD),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){e!=null&&e>=0&&(this._additionalCacheMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._memoryUsed}newCache(e,i){return new VGe(e,this._cacheStorage,i)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<Xvt&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(yD);else if(e)(this._memoryPredicted>1.1*GB||this._memoryUsed>GB)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/Phe),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._memoryUsed>GB)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/Phe),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._memoryUsed<Wvt&&this._quality<yD){this._stableQuality=this._quality;const i=.05;e=this._updateQuality(this._quality+i)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),yD))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){let e=0,i=0;this.view.basemapTerrain&&this.view.basemapTerrain.getUsedMemory&&(e+=this.view.basemapTerrain.getUsedMemory());const r=this.view._stage&&this.view._stage.renderView&&this.view._stage.renderer.edgeView;v(r)&&(e+=r.usedMemory),this.view.allLayerViews&&this.view.allLayerViews.forEach(a=>{if(TMe(a)){const l=a.ignoresMemoryFactor()?this._quality:1;e+=a.getUsedMemory()*l,i+=a.getUnloadedMemory()*l}});const s=C(this._warnMemoryUsage)||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),n=1048576*this.maxMemory;if(e>n&&s){this._warnMemoryUsage=e;const a=c=>(c/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",l=Math.round(100*this._quality);oe.getLogger(this.declaredClass).warn(`Memory Limit exceeded! Limit: ${a(n)} Current: ${a(e)} Projected: ${a(e+i)} Quality: ${l}%`)}this._memoryUsed=e/n,this._memoryPredicted=(e+i)/n;const o=n-e;this._cacheStorage.maxSize=Math.max(0,o+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const i=e._numQualityChanges;return e._numQualityChanges=0,i}}}};u([d({constructOnly:!0})],Gl.prototype,"view",void 0),u([d()],Gl.prototype,"maxMemory",null),u([d()],Gl.prototype,"additionalCacheMemory",null),u([d()],Gl.prototype,"memoryFactor",null),u([d()],Gl.prototype,"updating",null),u([d()],Gl.prototype,"usedMemory",null),u([d()],Gl.prototype,"_quality",void 0),u([d()],Gl.prototype,"_memoryUsed",void 0),u([d()],Gl.prototype,"_updating",void 0),u([d()],Gl.prototype,"_stableQuality",void 0),u([d()],Gl.prototype,"_maxMemory",void 0),u([d()],Gl.prototype,"_additionalCacheMemory",void 0),Gl=u([I("esri.views.3d.support.MemoryController")],Gl);let Yvt=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},Zvt=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new Jvt}},Jvt=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},Kvt=class{constructor(e,i,r,s){this._workerFunc=e,this._callbackFunc=i,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=s.map(n=>new Zvt(n))}destroy(){this._clients.length=0}hasQuota(e){const i=this._clients[e];return!!i&&(this._totalNumWorkers<this._maxTotalNumWorkers||i.numWorkers+i.tasks.length<i.typeWorkerQuota)}push(e){const i=this._clients[e.client];i&&(this._totalNumWorkers<this._maxTotalNumWorkers?(i.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(r,s)=>this._taskCallback(r,s))):i.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const i=this._clients[e.client];this._totalNumWorkers--,i.numWorkers--,i.statistics.requests++,i.statistics.size+=e.size||0,i.statistics.duration+=e.duration||0,i.statistics.speed=i.statistics.duration>0?i.statistics.size/i.statistics.duration:0,Ct(i.numWorkers>=0),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(i,r)=>this._taskCallback(i,r)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,i){e._cancelled||(this._callbackFunc(e,i),this._taskFinished(e))}getStatsForType(e){const i=this._clients[e];return i?{quota:i.typeWorkerQuota,workers:i.numWorkers,queueSize:i.tasks.length,requestStats:i.statistics}:null}get test(){const e=this;return{set workerFunc(i){e._workerFunc=i}}}},$F=class extends $e{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,i,r){this._loadQueue=new Kvt((s,n)=>this._startLoading(s,n),(s,n)=>this._doneLoadingCB(s,n),e,i),r&&(this._frameTask=r.registerTask(Rt.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=Rr(this._frameTask),this._tasks.forEach(e=>hd(e.abortController)),this._loadQueue=Je(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,i,r,s={}){const n=qv();n.__signal=v(s)?s.signal:null;const o=this._createOrUpdateTask(e,i,r,s,n);return ca(s,()=>this._cancelRequest(o,n)),n.promise}_createTask(e,i,r,s,n,o){const a=new t1t(e,i,r,s,n);return this._updateTask(a,o),this._tasks.set(n,a),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(a),a}_cancelRequest(e,i){var r;A3(e.resolvers,i),i.reject(Bi()),e.resolvers.length===0&&(e.status===Dh.DOWNLOADING&&(e.status=Dh.CANCELLED,this._loadQueue.cancel(e),(r=e.abortController)==null||r.abort(),e.request=null,e.abortController=null),e.status=Dh.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,i){e.resolvers.push(i)}_createOrUpdateTask(e,i,r,s,n){const o=i1t(v(s)&&s.uid||e,i,r),a=this._tasks.get(o);return a?(this._updateTask(a,n),a):this._createTask(e,s,i,r,o,n)}_doneLoadingCB(e,i){this._loadQueue&&(Ct(e.status===Dh.DOWNLOADING),e.status=Dh.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:i}):this._doneLoading(e,i))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const i=this._onLoadQueue.shift();gi(i.task.abortController),i.task.abortController=null,i.callback(i.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const i=this._doneQueue.shift();i.task.status!==Dh.DOWNLOADED&&(i.err=i.err||Bi()),this._doneLoading(i.task,i.err),e.madeProgress()}}_doneLoading(e,i){if(i&&!ln(i)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let r=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const s of e.resolvers)if(i)ln(i)?s.reject(i):s.reject(new W("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${i}`,{url:e.url,error:i}));else{--r;const n=r<=0?e.result:ae(e.result);s.resolve(n)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,i){if(e.status===Dh.CANCELLED)return!1;let r,s;switch(e.startTime=performance.now(),e.status=Dh.DOWNLOADING,e.docType){case"binary":s="array-buffer",r=0;break;case"image":s="image";break;case"image+type":s="array-buffer";break;default:s="json"}e.abortController=new AbortController;const n=e.abortController.signal;e.request=zr(e.url,{...e.options,responseType:s,timeout:r,signal:n});let o=()=>{};const a=c=>{e.duration=performance.now()-e.startTime,e.size=c instanceof ArrayBuffer?c.byteLength:e.size||0,e.result=c,this._frameTask?this._onLoadQueue.push({callback:i,task:e}):(e.abortController=null,i(e))},l=c=>{e.status===Dh.DOWNLOADING&&i(e,c),o()};return e.docType!=="image+type"?(e.request.then(c=>a(c.data),l),!0):(e.request.then(c=>{const h=c.data,p=e1t(h);if(s="image",e.size=h.byteLength,p==="unknown")return e.request=zr(e.url,{responseType:s,timeout:r,signal:n}),void e.request.then(y=>a(y.data),l);const f=new Blob([h],{type:p}),m=window.URL.createObjectURL(f);o=()=>window.URL.revokeObjectURL(m),e.request=zr(m,{responseType:s,timeout:r,signal:n}),e.request.then(y=>a(new q8(y.data,p,o)),l)},l),!0)}get test(){return{loadQueue:this._loadQueue}}};u([d({readOnly:!0})],$F.prototype,"updating",void 0),$F=u([I("esri.views.3d.support.StreamDataLoader")],$F);const Qvt={numRetries:0};function e1t(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let q8=class{constructor(e,i,r){this.image=e,this.type=i,this.release=r}get isOpaque(){return this.type==="image/jpeg"}},t1t=class extends Yvt{constructor(e,i,r,s,n){super(s),this.url=e,this.options=i,this.docType=r,this.key=n,this.result=null,this.status=Dh.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=Qvt.numRetries}};function i1t(t,e,i){return`${t}:${e}:${i}`}var Dh;(function(t){t[t.QUEUED=1]="QUEUED",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.DOWNLOADED=3]="DOWNLOADED",t[t.CANCELLED=4]="CANCELLED"})(Dh||(Dh={}));let LF=class extends $e{constructor(){super(...arguments),this.updating=!1}};function r1t(t){return new Zf({view:t})}u([d({readOnly:!0})],LF.prototype,"updating",void 0),LF=u([I("esri.views.3d.support.ResourceControllerMain")],LF);let Zf=class extends LF{constructor(){super(...arguments),this._immediateTask=SC,this._normalTask=SC,this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=iet(),this._memoryController=qvt(this.view),this._streamDataLoader=new $F,this._streamDataLoader.setup(Hvt,jvt,this._scheduler),this.addHandles([re(()=>{var e;return(e=this.view.state)==null?void 0:e.mode},e=>{e!=null&&(this._scheduler.state=e)},Wi),re(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=By({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(Rt.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(Rt.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=Rr(this._frameTask),this._streamDataLoader=Je(this._streamDataLoader),this._memoryController=Je(this._memoryController),this._scheduler=Je(this._scheduler)}get updating(){var e,i,r;return!!((e=this._memoryController)!=null&&e.updating||(i=this._streamDataLoader)!=null&&i.updating||(r=this._immediateTask)!=null&&r.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const i=this._streamDataLoader;return{request:(r,s,n)=>i.request(r,s,e,n),get busy(){return!i.hasDownloadSlots(e)}}}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(UY(e.deltaTime)),!this._scheduler)||(this._scheduler.updateBudget(e)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e)}}};u([d({constructOnly:!0})],Zf.prototype,"view",void 0),u([d()],Zf.prototype,"_scheduler",void 0),u([d()],Zf.prototype,"_memoryController",void 0),u([d()],Zf.prototype,"_streamDataLoader",void 0),u([d()],Zf.prototype,"_immediateTask",void 0),u([d()],Zf.prototype,"_normalTask",void 0),u([d({readOnly:!0})],Zf.prototype,"updating",null),Zf=u([I("esri.views.3d.support.ResourceControllerImpl")],Zf);function s1t(t){return"performanceInfo"in t}const u2=M(),n1t=M(),Eg=M(),Cg=M();function o1t(t,e,i=0){const r=t.extent;if(C(r))return!1;if(i===0)return Zye(r,e);const s=Math.min(r[2]-r[0],r[3]-r[1]);return g6e(r,e,i*s)}function _D(t,e,i,r){he(u2,i),u2[r]=e[r];const s=be(u2,u2,e),n=be(n1t,t,e),o=Ae(n,s),a=Ae(s,s);let l;l=o<=0?e:a<=o?i:ve(u2,e,ue(s,s,o/a));const c=be(u2,t,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function a1t(t,e,i){const r=t.extent;if(C(r))return 0;Eg[0]=r[0],Eg[1]=r[1],Eg[2]=i,Cg[0]=r[2],Cg[1]=r[3],Cg[2]=i;let s=1/0,n=1/0;return e[0]<Eg[0]?s=_D(e,Eg,Cg,0):e[0]>Cg[0]&&(s=_D(e,Cg,Eg,0)),e[1]<Eg[1]?n=_D(e,Eg,Cg,1):e[1]>Cg[1]&&(n=_D(e,Cg,Eg,1)),Math.min(s,n)}function l1t(t,e,i){if(C(t))return LK();if(t.spatialReference.isGeographic&&!$x(t.spatialReference))return new W("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const r=Gc.checkUnsupported(t);if(v(r))return r;if(C(i))return new W("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const s=c1t(t,i);if(s)return s;const n=t.spatialReference;return v(e)&&!(n.equals(e)||e.isWGS84&&n.isWebMercator)?new W("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}function c1t(t,e){const i=t.lods,r=i[0].resolution*2**i[0].level,s=[r*t.size[0],r*t.size[1]],n=[t.origin.x,t.origin.y],o=Xye(e),a=ci();Gc.computeRowColExtent(o,s,n,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>XS){const c=i[0].scale*2**i[0].level;let h=Math.max((o[3]-o[1])/t.size[1],(o[2]-o[0])/t.size[0])*c/r;const p=Math.floor(Math.log(h)/Math.log(10));return h=Math.ceil(h/10**p)*10**p,new W("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:h,requiredNumRootTiles:l,allowedNumRootTiles:XS})}return null}const u1t=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:l1t,isInsideExtent:o1t,tiltToExtentEdge:a1t},Symbol.toStringTag,{value:"Module"}));function h1t(){return!0}function d1t(){return 0}function p1t(t,e){if(C(t))return LK();const i=t.lods.length-1,r=t.spatialReference,s=$x(r)||Zm(r)||Jm(r);if(r.isWebMercator){if(!Gc.makeWebMercatorAuxiliarySphere(i).compatibleWith(t))return new W("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!s)return new W("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!Gc.makeGCSWithTileSize(t.spatialReference,t.size[0],i).compatibleWith(t))return t.spatialReference.isWGS84?new W("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new W("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return v(e)&&!t.spatialReference.equals(e)?new W("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene"):void 0}const f1t=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:p1t,isInsideExtent:h1t,tiltToExtentEdge:d1t},Symbol.toStringTag,{value:"Module"})),m1t={[st.Global]:f1t,[st.Local]:u1t};function cm(t,e){t||console.warn("Terrain: "+e)}let Ln=!1,o6=!1;function g1t(t){o6=t,Ln=Ln||t}function y1t(t){Ln=t}function Be(t,e){var i;if(Ln&&!t){const r=(i=new Error().stack)==null?void 0:i.slice(5);throw console.warn("Terrain internal: "+(e||"")+" at "+r),new Error("Assertion failed"+(e?": "+e:""))}}function bX(t){return W8(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale,tilemapCache:null}:t.layer}function a6(t){return(t==null?void 0:t.type)==="imagery-tile"||(t==null?void 0:t.type)==="wcs"}function W8(t){return(t==null?void 0:t.type)==="imagery-tile-3d"}function qee(t){return(t==null?void 0:t.type)==="tile-3d"}function IP(t){return(t==null?void 0:t.type)==="vector-tile-3d"}function SMe(t){return(t==null?void 0:t.type)==="wmts-3d"}function wX(t){return(t==null?void 0:t.type)==="elevation-3d"}function RO(t){return(t==null?void 0:t.type)==="group"}function l6(t){return t&&(qee(t)||SMe(t)||W8(t)||IP(t))}function xX(t){return t&&(qee(t)||W8(t)||IP(t)||SMe(t))}function $P(t){return xX(t)||wX(t)}function _1t(t){var i;const e=(i=t==null?void 0:t.sourceLayerInfo)==null?void 0:i.data;return v(e)&&"type"in e&&e.type==="raster-tile"}function v1t(t){var i;const e=(i=t==null?void 0:t.sourceLayerInfo)==null?void 0:i.data;return v(e)&&"type"in e&&e.type==="vector-tile"}function b1t(t){var i;const e=(i=t==null?void 0:t.sourceLayerInfo)==null?void 0:i.data;return v(e)&&"type"in e&&e.type==="tile-texture"}function w1t(t){var i;const e=(i=t==null?void 0:t.sourceLayerInfo)==null?void 0:i.data;return e instanceof HTMLImageElement||e instanceof q8||e instanceof HTMLCanvasElement||e instanceof ImageData}function UE(t){return v(t)&&"release"in t&&t.release(),null}function Ihe(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function Wee(t,e,i,r){return m1t[r].checkIfTileInfoSupportedForViewSR(t,i,e)}function X8(t,e,i){let r=null,s=null;if((t==null?void 0:t.type)==="wmts"){const n=x1t(t,e,i);r=n.tileInfo,s=n.fullExtent}else{s=a6(t)?t.getCompatibleFullExtent(e):t.fullExtent;const n=i===st.Local;if(a6(t))r=t.getCompatibleTileInfo(e,s,n);else if((t==null?void 0:t.type)==="vector-tile"){const o=n&&!T1t(e)||S1t.force512VTL,a=t.tileInfo.spatialReference.isGeographic;r=o?t.tileInfo:t.tileInfo.getOrCreateCompatible(256,a?1:2)}else r=t.tileInfo}return v(r)&&v(s)&&Wee(r,s,e,i)==null?{tileInfo:r,fullExtent:s}:null}function x1t(t,e,i){const r=Qke(t);if(v(r)){if(!Nt.isCollection(r))return{tileInfo:r.tileInfo,fullExtent:r.fullExtent};{const s=r.find(n=>Wee(n.tileInfo,n.fullExtent,e,i)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function T1t(t){return t.isWGS84||t.isWebMercator||Oge(t)||!P3(t)}const S1t={force512VTL:!1};function $he(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function Ag(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function Zh(t,e,i=A1t){return Math.abs(t-e)<i}function TX(t){return t===Vt.NORTH_EAST?Vt.SOUTH_WEST:t===Vt.NORTH_WEST?Vt.SOUTH_EAST:t===Vt.SOUTH_WEST?Vt.NORTH_EAST:Vt.NORTH_WEST}function c6(t){return t===Vt.NORTH?Vt.SOUTH:t===Vt.EAST?Vt.WEST:t===Vt.SOUTH?Vt.NORTH:Vt.EAST}function E1t(t){return t===Vt.NORTH_WEST||t===Vt.SOUTH_WEST}function C1t(t){return t===Vt.NORTH_WEST||t===Vt.NORTH_EAST}function Lhe(t){return t===Vt.NORTH_WEST||t===Vt.WEST||t===Vt.SOUTH_WEST}function Dhe(t){return t===Vt.NORTH_EAST||t===Vt.EAST||t===Vt.SOUTH_EAST}function Nhe(t){return t===Vt.SOUTH_EAST||t===Vt.SOUTH||t===Vt.SOUTH_WEST}function Fhe(t){return t===Vt.NORTH_EAST||t===Vt.NORTH||t===Vt.NORTH_WEST}const Tm=[Vt.NORTH,Vt.EAST,Vt.SOUTH,Vt.WEST],u6=[Vt.NORTH_EAST,Vt.SOUTH_EAST,Vt.SOUTH_WEST,Vt.NORTH_WEST],A1t=1e-5;let O1t=class{constructor(e,i){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer,this.memory=$P(e)?i.basemapTerrain.getUsedMemoryForLayerView(e):e.getUsedMemory(),s1t(e)){const r=e.performanceInfo;this.displayedNumberOfFeatures=r.displayedNumberOfFeatures,this.maximumNumberOfFeatures=r.maximumNumberOfFeatures,this.totalNumberOfFeatures=r.totalNumberOfFeatures}}},R1t=class{constructor(e){var r;if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,v(e.resourceController)){const s=e.resourceController.memoryController;this.totalMemory=(s.maxMemory??0)*dC.MEGABYTES,this.usedMemory=Math.round(s.usedMemory*this.totalMemory),this.quality=s.memoryFactor,this.load=e.resourceController.scheduler.load}this.terrainMemory=((r=e.basemapTerrain)==null?void 0:r.getUsedMemory())??0;const i=e._stage&&e._stage.renderView&&e._stage.renderer.edgeView;this.edgesMemory=v(i)?i.usedMemory:0,e.allLayerViews.items.forEach(s=>{(TMe(s)||$P(s))&&this.layerPerformanceInfos.push(new O1t(s,e))}),this.layerPerformanceInfos.sort((s,n)=>n.memory-s.memory)}},M1t=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,i,r){const s=r?`gltfPBR:${e}`:`gltf:${e}`,n=this._gltfMemCache.get(s);return v(n)?Promise.resolve(n):this._loadOnce(this._gltfLoading,this._gltfMemCache,s,o=>DRe(new $Re(o.streamDataRequester),e,o,r),i)}loadWOSR(e,i){const r=`wosr:${e}:${i.disableTextures}`,s=this._wosrMemCache.get(r);return v(s)?Promise.resolve(s):this._loadOnce(this._wosrLoading,this._wosrMemCache,r,n=>NRe(e,n),i)}async _loadOnce(e,i,r,s,n){gi(n);const o=ca(n,()=>this._abortLoad(e,r));let a=e.get(r);if(a)a.refCount++;else{const l=new AbortController;a={refCount:1,abortController:l,promise:s({...n,signal:l.signal})},e.set(r,a)}try{const l=await a.promise;return i.put(r,l,l.size),e.delete(r),gi(n),l}finally{Rr(o)}}_abortLoad(e,i){const r=e.get(i);v(r)&&--r.refCount>0||(e.delete(i),v(r)&&r.abortController.abort())}},P1t=class extends YS{constructor(e,i,r,s){super(i,s),this._streamDataRequester=e,this._parameters=r}async fromUrl(e,i,r){gi(r);const s=v(r)?r.signal:null,n=this.makeUid(e,i);let o=this._textureRequests.get(n);if(!o){const a=new AbortController,l=this._streamDataRequester.request(e,"image",{uid:n,signal:a.signal});o={referenceCount:0,texture:null,textureAsync:null,abortController:a};const c=o;this._textureRequests.set(n,o),o.textureAsync=l.then(async h=>{const p=this._createTexture(e,h,i);return c.texture=p,c.abortController=null,this._stage.add(p),await this._stage.load(p),{uid:n,texture:p,release:()=>this._release(n)}},h=>{throw c.abortController=null,h})}o.referenceCount++;try{return await FY(o.textureAsync,s)}catch(a){throw this._release(n),a}}_createTexture(e,i,r){var n;const s={...this._parameters,powerOfTwoResizeMode:Fv.PAD};if(f0e(e)){if(r||i.width===0&&i.height===0){const o=i.width?i.height/i.width:1;r=r||64,o>1?(i.width=Math.round(r/o),i.height=r):(i.width=r,i.height=Math.round(r*o))}(n=this._stage.renderView)!=null&&n.renderingContext.driverTest.svgPremultipliesAlpha.result&&(s.preMultiplyAlpha=!1)}return s.width=i.width,s.height=i.height,new _T(i,s)}},I1t=class{constructor(e){this.textures=null,this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(ym.SYMBOLOGY),this.objectResourceCache=new M1t((r,s)=>e.resourceController.memoryController.newCache(r,s)),this.textures=new P1t(this.streamDataRequester,e.view._stage,{preMultiplyAlpha:!0,wrap:{s:kt.CLAMP_TO_EDGE,t:kt.CLAMP_TO_EDGE}},e.resourceController.scheduler);const i=tr(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=fCe(e.viewingMode,i),this.screenSizePerspectiveSettingsLabels=Oct(e.viewingMode,i)}destroy(){Je(this.textures),this.textures=null,this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return Wp();this._graphicsOwners.push(e);const i=re(()=>{var r;return(r=e.layer)==null?void 0:r.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),Wp(()=>{i.remove(),A3(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(i=>{var r;return((r=i.layer)==null?void 0:r.screenSizePerspectiveEnabled)===!0});if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new Ki;const i=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([re(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,i,Wi),this._viewState.events.on("camera-projection-changed",i)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=Je(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;vD.distance=e.centerOnSurfaceInfrequent.distance,vD.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(vD),this.screenSizePerspectiveSettingsLabels.update(vD),this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}};const vD={distance:0,fovY:0};let RS=class{constructor(e,i,r=""){this.graphics=e,this._symbol=new yv({symbolLayers:[new gv({material:{color:i},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new lT({text:r,halo:{color:"white",size:1/.75},material:{color:i},size:12})]})}show(e,i){if(C(i))return;this.hide();const r=new pt({x:e[0],y:e[1],z:e[2],spatialReference:i});this._graphic=new ha({geometry:r,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){v(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)}},hv=class extends $e{constructor(e){super(e),this.handles=new Ki}destroy(){this.handles.destroy()}};u([d({constructOnly:!0})],hv.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],hv.prototype,"surface",void 0),u([d({constructOnly:!0})],hv.prototype,"state",void 0),hv=u([I("esri.views.3d.support.PointOfInterest")],hv);const $1t=Array;let lp=class extends hv{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new Xy({location:pt,renderLocation:$1t},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=M(),this._tmpPoint=new pt}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add(pn(()=>{var i,r;return(r=(i=this.map)==null?void 0:i.ground)==null?void 0:r.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=Je(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,i=Ar(e.eye,this.renderLocation),r={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return Xx(r,i,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return this._updateSurfaceAltitude(0),ua.YIELD;const e=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,e);const i=(this._tmpPoint.z??0)>L1t&&this.renderCoordsHelper.viewingMode===st.Global&&(e.isWGS84||e.isWebMercator);let r=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:r.signal,cache:this.cache,minDemResolution:i?D1t:0}).then(s=>this._updateSurfaceAltitude(s.geometry.z??0)).catch(s=>{ln(s)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===r&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),r=null}),this._pendingElevationQueryController=r,ua.YIELD}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(jB,this._estimatedSurfaceAltitude,this._camera.eye),cl(this._get("renderLocation"),jB)||(this._set("renderLocation",he(this._propertiesPool.get("renderLocation"),jB)),this.notifyChange("renderLocation"))}};u([d({constructOnly:!0})],lp.prototype,"scheduler",void 0),u([d({constructOnly:!0})],lp.prototype,"cache",void 0),u([d({constructOnly:!0})],lp.prototype,"task",void 0),u([d({readOnly:!0})],lp.prototype,"location",null),u([d({constructOnly:!0})],lp.prototype,"map",void 0),u([d({readOnly:!0})],lp.prototype,"renderLocation",void 0),u([d({readOnly:!0})],lp.prototype,"scale",null),u([d({readOnly:!0})],lp.prototype,"updating",null),lp=u([I("esri.views.3d.support.CameraOnSurface")],lp);const jB=M(),L1t=1e5,D1t=1e6,N1t=Array;let Nh=class extends hv{constructor(e){super(e),this._propertiesPool=new Xy({location:pt,renderLocation:N1t},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=M(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=Rr(this._frameWorker),this._propertiesPool=Je(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,ua.YIELD}_updateRenderLocation(){const e=U1t;let i=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const r=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!i&&r&&(i=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),i&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const s=V1t;i&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,s)&&(he(e,s),this._currentSurfaceAltitude=this._latestSurfaceAltitude),i?this.distance=Ar(this._camera.eye,e):(ue(e,this._camera.viewForward,this._get("distance")),ve(e,e,this._camera.eye)),cl(this._get("renderLocation"),e)||this._set("renderLocation",he(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,i){var s,n;const r=this._camera;if(!this.renderCoordsHelper.intersectManifold(r.ray,e,i))return!1;if(this.state.isGlobal){const o=tr(this.renderCoordsHelper.spatialReference).radius,a=o+e,l=Ea(r.eye),c=l<a*a,h=Ar(r.eye,i);if(c&&h>o/4){const p=a-Math.sqrt(l);return ue(i,r.viewForward,p),ve(i,i,r.eye),!0}}else{const o=(s=this.surface)!=null&&s.ready?this.surface.extent:null;v(o)&&vU(o,(n=this.surface)==null?void 0:n.spatialReference,MO,this.renderCoordsHelper.spatialReference)&&(i[0]=we(i[0],MO[0],MO[2]),i[1]=we(i[1],MO[1],MO[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,i){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,i)){if(Ji.TESTS_DISABLE_OPTIMIZATIONS)return!0;const r=this._camera.eye,s=Ar(r,e),n=Ar(r,i);if(Math.abs(n-s)/s>F1t)return!0}return!1}};u([d({constructOnly:!0})],Nh.prototype,"scheduler",void 0),u([d({constructOnly:!0})],Nh.prototype,"task",void 0),u([d()],Nh.prototype,"distance",void 0),u([d({constructOnly:!0})],Nh.prototype,"estimateSurfaceAltitudeAtCenter",void 0),u([d({readOnly:!0})],Nh.prototype,"location",null),u([d({readOnly:!0})],Nh.prototype,"renderLocation",void 0),u([d()],Nh.prototype,"updating",void 0),Nh=u([I("esri.views.3d.support.CenterOnSurface")],Nh);const F1t=.05,U1t=M(),V1t=M(),MO=ci();let k1t=class{constructor(e){this._handles=new Ki,this.events=new As,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",i=>this._layerViewsChanged(i))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=Je(this._handles)}_layerViewsChanged(e){e.added.forEach(i=>{i.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(i.on("visible-geometry-changed",()=>this._contentChanged()),i.uid)}),e.removed.forEach(i=>this._handles.remove(i.uid))}_contentChanged(){this.events.emit("request-update",B1t)}};const B1t={},z1t=Array;let Jf=class extends hv{constructor(e){super(e),this._propertiesPool=new Xy({location:pt,renderLocation:z1t},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([re(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),re(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(Rt.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=Je(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),i=this.centerOnSurface.renderLocation,r=this.renderCoordsHelper,s=this.state.contentCamera;this._dirty=!1,r.worldUpAtPosition(i,Uhe);const n=Math.max(0,(Math.acos(Ae(Uhe,s.viewForward))-.5*Math.PI)*(s.aboveGround?1:-1));if(Number.isNaN(n)){if(!e||!Wv(e,i)){const c=this._propertiesPool.get("renderLocation");he(c,i),this._set("renderLocation",c)}return ua.YIELD}const o=1-we(n/(.5*Math.PI),0,1),a=o*o*o;this._calculateScreenHorizontalEdgeOnSurface(Vhe);const l=this._propertiesPool.get("renderLocation");return tn(l,i,Vhe,a),e&&Wv(e,l)||this._set("renderLocation",l),ua.YIELD}_calculateScreenHorizontalEdgeOnSurface(e){const i=this.state.contentCamera,r=i.getRenderCenter(na());if(r[1]=i.aboveGround?i.padding[bi.BOTTOM]:i.fullHeight-i.padding[bi.TOP],this.estimateSurfaceIntersectionAtRenderPoint(r,e))return e;const s=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(i.unprojectFromRenderScreen(r,PO)){be(PO,PO,i.eye);const n=Oe(PO,PO);if(this.renderCoordsHelper.intersectManifold(ih(i.eye,n),s,e))return e}return this.renderCoordsHelper.setAltitude(e,s,i.eye)}updateRenderLocation(){this._dirty=!0}};u([d()],Jf.prototype,"_dirty",void 0),u([d({constructOnly:!0})],Jf.prototype,"scheduler",void 0),u([d({constructOnly:!0})],Jf.prototype,"centerOnSurface",void 0),u([d({constructOnly:!0})],Jf.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),u([d({readOnly:!0})],Jf.prototype,"updating",null),u([d({readOnly:!0})],Jf.prototype,"location",null),u([d({readOnly:!0})],Jf.prototype,"renderLocation",void 0),Jf=u([I("esri.views.3d.support.pointsOfInterest.Focus")],Jf);const Uhe=M(),PO=M(),Vhe=M();let Qg=class extends $e{get surface(){var e;return(e=this.view.map)==null?void 0:e.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=M();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new Ki}initialize(){this.view.state.isLocal&&(this._handles.add([re(()=>{var e,i;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(i=this.surfaceView)==null?void 0:i.extent]},()=>this._update()),pn(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||C(this.surfaceView.extent)||C(this.surfaceView.spatialReference))return void this._set("location",null);const e=MZ(this.surfaceView.extent),i=new pt({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(i,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(r=>{this._updateController=null,this._set("location",r.geometry)}).catch(r=>{ln(r)||r&&r.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",r)})):this._set("location",i)}};u([d({constructOnly:!0})],Qg.prototype,"view",void 0),u([d({constructOnly:!0})],Qg.prototype,"cache",void 0),u([d()],Qg.prototype,"surface",null),u([d()],Qg.prototype,"surfaceView",null),u([d({readOnly:!0})],Qg.prototype,"location",void 0),u([d({readOnly:!0})],Qg.prototype,"renderLocation",null),Qg=u([I("esri.views.3d.terrain.StableSurfaceCenter")],Qg);let ey=class extends $e{constructor(e){super(e),this._tileGeometryUpdateExtent=yd(),this._tileGeometryUpdateSpatialReference=null,this.events=new As,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(Rt.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",G1t),yd(this._tileGeometryUpdateExtent),this._set("updating",!1)),ua.YIELD}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,Lv(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let i=1;i<this.centerOnSurfaces.length;i++){const r=this.centerOnSurfaces[i];r.distance>e.distance&&(e=r)}return e}_centerIntersectsExtent(e,i){const r=this.state.contentCamera.eye,s=j1t,n=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(r,lb,i),this.renderCoordsHelper.fromRenderCoords(n.renderLocation,cb,i),lb[0]<cb[0]?(s[0]=lb[0],s[2]=cb[0]):(s[0]=cb[0],s[2]=lb[0]),lb[1]<cb[1]?(s[1]=lb[1],s[3]=cb[1]):(s[1]=cb[1],s[3]=lb[1]),iU(s,e)}};u([d({constructOnly:!0})],ey.prototype,"state",void 0),u([d({constructOnly:!0})],ey.prototype,"centerOnSurfaces",void 0),u([d({constructOnly:!0})],ey.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],ey.prototype,"scheduler",void 0),u([d({constructOnly:!0})],ey.prototype,"surface",void 0),u([d({readOnly:!0})],ey.prototype,"updating",void 0),ey=u([I("esri.views.3d.support.SurfaceGeometryUpdates")],ey);const G1t={},lb=M(),cb=M(),j1t=yd();let Wl=class extends $e{constructor(e){super(e),this._handles=new Ki,this._tmpRay=fo(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new Xy({renderPointOfView:H1t},this),this.renderPointOfView=M(),this._pois=new Array,this._debugCenters=new Map}initialize(){var h;const{state:e,basemapTerrain:i,renderCoordsHelper:r,map:s}=this.view;this._surfaceIntersector=xd(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=Ho.MIN,this._contentIntersector=xd(e.viewingMode);const n=()=>this._estimateSurfaceAltitudeAtCenter(),o=this.view.resourceController.scheduler,a=(h=this.view.basemapTerrain)==null?void 0:h.elevationQueryCache,l={state:e,scheduler:o,surface:i,renderCoordsHelper:r};this._set("centerOnSurfaceInfrequent",new Nh({...l,task:Rt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnSurfaceFrequent",new Nh({...l,task:Rt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnContent",new Nh({...l,task:Rt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new lp({...l,cache:a,task:Rt.POINT_OF_INTEREST_INFREQUENT,map:s})),this._set("surfaceGeometryUpdates",new ey({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new k1t({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:r})),this._set("surfaceOrigin",new Qg({cache:a,view:this.view})),this._set("focus",new Jf({state:e,scheduler:o,surface:i,renderCoordsHelper:r,centerOnSurface:this.centerOnSurfaceInfrequent,estimateSurfaceIntersectionAtRenderPoint:(p,f)=>this._estimateSurfaceIntersectionAtRenderPoint(p,this.view.state.contentCamera,f)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const c=this.view.graphics;this._debugCenters.set(this.centerOnContent,new RS(c,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new RS(c,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new RS(c,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new RS(c,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new RS(c,"green","Focus")),this._handles.add([re(()=>e.contentCamera,p=>this._cameraChanged(p),Wi),re(()=>i.extent,()=>this._updateCenterPointsOfInterest()),qo(()=>!i.updating,()=>this._updateCenterPointsOfInterest(),Wi),pn(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),pn(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),qo(()=>Ji.SHOW_POI,p=>this._setDebug(p),Zt)]),this._cameraChanged(this.view.state.contentCamera);for(const p of this._pois)p.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)!=null&&e.updating)&&!this._pois.some(i=>i.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return C(e)||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,h2,W1t)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(h2):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(C(e))return this._surfaceAltitudeAtCenter;const i=e.origin,r=ve(h2,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,i,r),this._surfaceIntersector.results.min.getIntersectionPoint(h2)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(h2)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,i,r){const s=DQ(i,e,q1t);if(C(s))return null;const n=s.origin,o=ve(h2,s.origin,s.direction);return this._surfaceIntersector.resetWithRay(s,i),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,n,o),this._surfaceIntersector.results.min.getIntersectionPoint(r)?r:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const i=e.eye;cl(this.renderPointOfView,i)||this._set("renderPointOfView",he(this._propertiesPool.get("renderPointOfView"),i))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(i=>i.hide()),void this._handles.remove("debug");for(const i of this._pois)this._handles.add(re(()=>i.renderLocation,r=>{var s;return(s=this._debugCenters.get(i))==null?void 0:s.show(r,i.renderCoordsHelper.spatialReference)},Zt),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};u([d({readOnly:!0})],Wl.prototype,"centerOnContent",void 0),u([d({readOnly:!0})],Wl.prototype,"centerOnSurfaceFrequent",void 0),u([d({readOnly:!0})],Wl.prototype,"centerOnSurfaceInfrequent",void 0),u([d({readOnly:!0})],Wl.prototype,"cameraOnSurface",void 0),u([d({readOnly:!0})],Wl.prototype,"focus",void 0),u([d({readOnly:!0})],Wl.prototype,"renderPointOfView",void 0),u([d({readOnly:!0})],Wl.prototype,"surfaceOrigin",void 0),u([d({readOnly:!0})],Wl.prototype,"contentGeometryUpdates",void 0),u([d({readOnly:!0})],Wl.prototype,"surfaceGeometryUpdates",void 0),u([d({constructOnly:!0})],Wl.prototype,"view",void 0),u([d({readOnly:!0})],Wl.prototype,"updating",null),Wl=u([I("esri.views.3d.support.PointsOfInterest")],Wl);const H1t=Array,h2=M(),q1t=fo(),W1t={exclude:new Set([av])};let X1t=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,i){this._store.put(e,i,i.values.byteLength+256)}},Y1t=class{constructor(e,i,r,s){this._hasNoDataValues=null,this._minValue=null,this._maxValue=null,"pixelData"in e?(this.values=e.pixelData,this.width=e.width,this.height=e.height,this.noDataValue=e.noDataValue):(this.values=e,this.width=i,this.height=r,this.noDataValue=s)}get hasNoDataValues(){if(C(this._hasNoDataValues)){const e=this.noDataValue;this._hasNoDataValues=this.values.includes(e)}return this._hasNoDataValues}get minValue(){return this._ensureBounds(),this._minValue}get maxValue(){return this._ensureBounds(),this._maxValue}_ensureBounds(){if(v(this._minValue))return;const{noDataValue:e,values:i}=this;let r=1/0,s=-1/0,n=!0;for(const o of i)o===e?this._hasNoDataValues=!0:(r=o<r?o:r,s=o>s?o:s,n=!1);n?(this._minValue=0,this._maxValue=0):(this._minValue=r,this._maxValue=s>-3e38?s:0)}},EMe=class{constructor(e,i,r,s,n={}){this._mainMethod=i,this._transferLists=r,this._listeners=[],this._promise=n_e(e,{...n,schedule:s}).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,n.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>oe.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${o}`))}on(e,i){const r={removed:!1,eventName:e,callback:i,threadHandle:null};return this._listeners.push(r),this._connectListener(r),Wp(()=>{r.removed=!0,OY(this._listeners,r),this._thread&&v(r.threadHandle)&&r.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null}invoke(e,i){return this.invokeMethod(this._mainMethod,e,i)}invokeMethod(e,i,r){if(this._thread){const s=this._transferLists[e],n=s?s(i):[];return this._thread.invoke(e,i,{transferList:n,signal:r})}return this._promise?this._promise.then(()=>(gi(r),this.invokeMethod(e,i,r))):Promise.reject(null)}broadcast(e,i){return this._thread?Promise.all(this._thread.broadcast(i,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,i)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(i=>{e.removed||(e.threadHandle=i)})}},khe=class extends EMe{constructor(e=null){super("LercWorker","_decode",{_decode:i=>[i.buffer]},e,{strategy:"dedicated"}),this.schedule=e,this.ref=0}decode(e,i,r){return e&&e.byteLength!==0?this.invoke({buffer:e,options:i},r):Promise.resolve(null)}release(){--this.ref<=0&&(m3.forEach((e,i)=>{e===this&&m3.delete(i)}),this.destroy())}};const m3=new Map;function Z1t(t=null){let e=m3.get(t);return e||(v(t)?(e=new khe(i=>t.immediate.schedule(i)),m3.set(t,e)):(e=new khe,m3.set(null,e))),++e.ref,e}var Bc,Bhe,zhe;(function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(Bc||(Bc={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}(Bhe||(Bhe={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(zhe||(zhe={}));let J1t=class{constructor(e){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}},oVt=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};function lVt(t,e,i,r,s,n){const o=i-s;if(o>=0)return(e>>o)+(r-(n<<o))*(t>>o);const a=-o;return e-(n-(r<<a))*(t>>a)<<a}let cVt=class{constructor(e,i,r){this._rows=Math.ceil(i/r),this._columns=Math.ceil(e/r),this._cellSize=r,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(e,i){const r=Math.min(Math.max(Math.floor(i/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][s]||null}getCellSpan(e,i,r,s){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function K1t(t,e,i,r,s,n){const o=e[r++];for(let a=0;a<o;a++){const l=new J1t(n);l.xTile=e[r++],l.yTile=e[r++],l.hash=e[r++],l.priority=e[r++];const c=e[r++];for(let f=0;f<c;f++){const m=e[r++],y=e[r++],_=e[r++],b=e[r++],w=!!e[r++],S=e[r++],T=i[r++],E=i[r++],O=e[r++],R=e[r++];l.colliders.push({xTile:m,yTile:y,dxPixels:_,dyPixels:b,hard:w,partIndex:S,width:O,height:R,minLod:T,maxLod:E})}const h=t[r++];for(let f=0;f<h;f++)l.textVertexRanges.push([t[r++],t[r++]]);const p=t[r++];for(let f=0;f<p;f++)l.iconVertexRanges.push([t[r++],t[r++]]);s.push(l)}return r}function hVt(t,e,i){for(const[r,s]of t.symbols)Q1t(t,e,i,s,r)}function Q1t(t,e,i,r,s){const n=t.layerData.get(s);if(n.type===Bc.SYMBOL){for(const o of r){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],h=c.startOpacity,p=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&p===0;const f=i?Math.floor(127*h)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.iconVertexRanges)for(let p=c;p<c+h;p+=4)n.iconOpacity[p/4]=l;if(o.selectedForRendering){const c=a.parts[1],h=c.startOpacity,p=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&p===0;const f=i?Math.floor(127*h)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.textVertexRanges)for(let p=c;p<c+h;p+=4)n.textOpacity[p/4]=l}n.lastOpacityUpdate=e,n.opacityChanged=!0}}let Y8=class{constructor(e,i){this.layerUIDs=[],this.isDestroyed=!1,this._data=e,this.memoryUsed=e.byteLength;let r=1;const s=new Uint32Array(e);this.layerUIDs=[];const n=s[r++];for(let o=0;o<n;o++)this.layerUIDs[o]=s[r++];this.bufferDataOffset=r,i&&(this.layer=i.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return C(this._data)}get offset(){return this.bufferDataOffset}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(e){C(this._data)||(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}},ebt=class extends Y8{constructor(e,i){super(e,i),this.type=Bc.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const r=new Uint32Array(e);let s=this.bufferDataOffset;this.lineIndexStart=r[s++],this.lineIndexCount=r[s++];const n=r[s++];if(n>0){const o=new Map;for(let a=0;a<n;a++){const l=r[s++],c=r[s++],h=r[s++];o.set(l,[c,h])}this.patternMap=o}this.bufferDataOffset=s}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){v(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),v(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),v(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.lineVertexBuffer=Yi.createVertex(e,Fi.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.lineIndexBuffer=Yi.createIndex(e,Fi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=this.layer.lineMaterial;this.lineVertexArrayObject=new vd(e,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}},tbt=class extends Y8{constructor(e,i){super(e,i),this.type=Bc.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const r=new Uint32Array(e);let s=this.bufferDataOffset;this.fillIndexStart=r[s++],this.fillIndexCount=r[s++],this.outlineIndexStart=r[s++],this.outlineIndexCount=r[s++];const n=r[s++];if(n>0){const o=new Map;for(let a=0;a<n;a++){const l=r[s++],c=r[s++],h=r[s++];o.set(l,[c,h])}this.patternMap=o}this.bufferDataOffset=s}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){v(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),v(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),v(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,v(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),v(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),v(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.fillVertexBuffer=Yi.createVertex(e,Fi.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.fillIndexBuffer=Yi.createIndex(e,Fi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=s[r++];this.outlineVertexBuffer=Yi.createVertex(e,Fi.STATIC_DRAW,new Int32Array(n.buffer,4*r,l)),r+=l;const c=s[r++];this.outlineIndexBuffer=Yi.createIndex(e,Fi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,c)),r+=c;const h=this.layer,p=h.fillMaterial,f=h.outlineMaterial;this.fillVertexArrayObject=new vd(e,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new vd(e,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}},ibt=class extends Y8{constructor(e,i,r){super(e,i),this.type=Bc.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(e),n=new Int32Array(e),o=new Float32Array(e);let a=this.bufferDataOffset;this.isIconSDF=!!s[a++];const l=s[a++];for(let f=0;f<l;f++){const m=s[a++],y=s[a++],_=s[a++];this.iconPerPageElementsMap.set(m,[y,_])}const c=s[a++];for(let f=0;f<c;f++){const m=s[a++],y=s[a++],_=s[a++];this.glyphPerPageElementsMap.set(m,[y,_])}const h=s[a++],p=s[a++];this.iconOpacity=new Int32Array(h),this.textOpacity=new Int32Array(p),a=K1t(s,n,o,a,this.symbols,r),this.bufferDataOffset=a}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[i,r]of this.iconPerPageElementsMap)e+=r[1];for(const[i,r]of this.glyphPerPageElementsMap)e+=r[1];return e/3}doDestroy(){v(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),v(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),v(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),v(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,v(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),v(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),v(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),v(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,i=this.iconOpacityBuffer;e.length>0&&e.byteLength===i.size&&i.setSubData(e,0,0,e.length);const r=this.textOpacity,s=this.textOpacityBuffer;r.length>0&&r.byteLength===s.size&&s.setSubData(r,0,0,r.length)}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.iconVertexBuffer=Yi.createVertex(e,Fi.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.iconIndexBuffer=Yi.createIndex(e,Fi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=s[r++];this.textVertexBuffer=Yi.createVertex(e,Fi.STATIC_DRAW,new Int32Array(n.buffer,4*r,l)),r+=l;const c=s[r++];this.textIndexBuffer=Yi.createIndex(e,Fi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,c)),r+=c,this.iconOpacityBuffer=Yi.createVertex(e,Fi.STATIC_DRAW,this.iconOpacity.buffer),this.textOpacityBuffer=Yi.createVertex(e,Fi.STATIC_DRAW,this.textOpacity.buffer);const h=this.layer,p=h.iconMaterial,f=h.textMaterial;this.iconVertexArrayObject=new vd(e,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new vd(e,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}},rbt=class extends Y8{constructor(e,i){super(e,i),this.type=Bc.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const r=new Uint32Array(e);let s=this.bufferDataOffset;this.circleIndexStart=r[s++],this.circleIndexCount=r[s++],this.bufferDataOffset=s}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){v(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),v(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),v(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.circleVertexBuffer=Yi.createVertex(e,Fi.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.circleIndexBuffer=Yi.createIndex(e,Fi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=this.layer.circleMaterial;this.circleVertexArrayObject=new vd(e,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}};const yVt=!0,_Vt=32,vVt=1.5,Ghe=200,sbt=1/de("mapview-transitions-duration");let nbt=class extends As{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){var r;if(this._stage===e)return;const i=this._stage;this._stage=e,e?(r=this._stage)!=null&&r.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):i==null||i.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return C(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=qv(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=qv(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){var e,i;(e=this._fadeInResolver)==null||e.call(this),this._fadeInResolver=null,(i=this._fadeOutResolver)==null||i.call(this),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,i){if(this.fadeTransitionEnabled){const r=this._fadeOutResolver||!this.visible?0:this.opacity,s=this.computedOpacity;if(s===r)this.computedVisible=this.visible;else{const n=e*sbt;this.computedOpacity=s>r?Math.max(r,s-n):Math.min(r,s+n),this.computedVisible=this.computedOpacity>0;const o=r===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},p1=class uw{static getId(e,i,r,s){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${i}/${r}/${s}`}constructor(e,i,r,s){this.set(e,i,r,s)}get key(){return this}get id(){return this.toString()}set id(e){this.set(e)}get hash(){const e=4095&this.row,i=4095&this.col,r=63&this.level;return(3&this.world)<<30|i<<22|e<<8|r}acquire(e,i,r,s){this.set(e,i,r,s)}contains(e){const i=e.level-this.level;return i>=0&&this.row===e.row>>i&&this.col===e.col>>i&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new uw(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,i,r,s){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[n,o,a,l]=e.split("/");this.level=parseFloat(n),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+e,this.row=+i,this.col=+r,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new uw(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const e=this.level+1,i=this.row<<1,r=this.col<<1,s=this.world;return[new uw(e,i,r,s),new uw(e,i,r+1,s),new uw(e,i+1,r,s),new uw(e,i+1,r+1,s)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}};p1.pool=new yo(p1,null,null,25,50);let obt=class extends nbt{constructor(e,i,r,s,n,o,a=n,l=o){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new p1(e),this.resolution=i,this.x=r,this.y=s,this.width=n,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(e){const i=this.resolution/(e.resolution*e.pixelRatio),r=this.transforms.tileMat3,[s,n]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*i,a=this.height/this.rangeY*i;ZK(r,o,0,0,0,a,0,s,n,1),OC(this.transforms.dvs,e.displayViewMat3,r)}},HB=class CMe extends obt{constructor(e,i,r,s,n,o,a,l=null){super(e,i,r,s,n,o,4096,4096),this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.styleRepository=a,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<Ghe}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<Ghe)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(e){let i=!1;for(const r of e)if(this.layerData.has(r)){const s=this.layerData.get(r);this._memoryUsedByLayerData-=s.memoryUsed,s.type===Bc.SYMBOL&&this.symbols.has(r)&&(this.symbols.delete(r),i=!0),s.destroy(),this.layerData.delete(r),this.layerCount--}v(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),i&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){this.status!=="unloaded"&&(AMe.delete(this),CMe._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsage(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}changeDataImpl(e){let i=!1;if(e){const{bucketsWithData:r,emptyBuckets:s}=e,n=this._createRenderBuckets(r);if(s&&s.byteLength>0){const o=new Uint32Array(s);for(const a of o)this._deleteLayerData(a)}for(const[o,a]of n)this._deleteLayerData(o),a.type===Bc.SYMBOL&&(this.symbols.set(o,a.symbols),i=!0),this._memoryUsedByLayerData+=a.memoryUsed,this.layerData.set(o,a),this.layerCount++;v(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const[r,s]of this.layerData)s.type===Bc.SYMBOL&&(this._hasSymbolBuckets=!0);i&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(i){i.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const i=this.resolution/(e.resolution*e.pixelRatio),r=this.width/this.rangeX*i,s=this.height/this.rangeY*i,n=[0,0];e.toScreen(n,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;JK(o),b5(o,o,n),KK(o,o,Math.PI*e.rotation/180),QK(o,o,[r,s,1])}_createTransforms(){return{dvs:ac(),tileMat3:ac(),tileUnitsToPixels:ac()}}static _destroyRenderBuckets(e){if(!e)return;const i=new Set;e.forEach(r=>{i.has(r)||(r.destroy(),i.add(r))}),e.clear()}_createRenderBuckets(e){const i=new Map,r=new Map;for(const s of e){const n=this._deserializeBucket(s,r);for(const o of n.layerUIDs)i.set(o,n)}return i}_deserializeBucket(e,i){let r=i.get(e);if(r)return r;switch(new Uint32Array(e)[0]){case Bc.FILL:r=new tbt(e,this.styleRepository);break;case Bc.LINE:r=new ebt(e,this.styleRepository);break;case Bc.SYMBOL:r=new ibt(e,this.styleRepository,this);break;case Bc.CIRCLE:r=new rbt(e,this.styleRepository)}return i.set(e,r),r}_deleteLayerData(e){if(!this.layerData.has(e))return;const i=this.layerData.get(e);this._memoryUsedByLayerData-=i.memoryUsed,i.destroy(),this.layerData.delete(e),this.layerCount--}};const AMe=new Map;function abt(){AMe.forEach((t,e)=>{console.log(`
${e.key}:`),t[0].forEach(i=>console.log(i)),console.log("========"),t[1].forEach(i=>console.log(i))})}const xVt={value:.5,readOnly:!0},lbt={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let oE=class{constructor(e=0,i=0){this.min=e,this.max=i,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},cbt=class{constructor(e,i){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(i[2]-i[0]),this.dy=(e.width-1)/(i[3]-i[1]),this.x0=i[0],this.y1=i[3]}},ubt=class{constructor(e,i,r){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=i,this.samplerData=new cbt(r,i)}computeMinMaxValue(e,i,r,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=e-this.level;if(n<=0)return s;const o=2**n;if(!(Math.floor(i/o)===this.i&&Math.floor(r/o)===this.j))return s;let a=1/0,l=-1/0;const c=this.samplerData.data.width,h=this.samplerData.data.values,p=.5*iP;let f=(c-1)/o,m=(r-this.j*o)*f,y=(i-this.i*o)*f;if(f<1){const _=Math.floor(m),b=Math.floor(y),w=_+b*c,S=h[w],T=h[w+1],E=h[w+c],O=h[w+c+1];if(S+T+E+O<p){const R=m-_,L=y-b,P=y$(S,T,E,O,R,L),F=y$(S,T,E,O,R+f,L),V=y$(S,T,E,O,R,L+f),B=y$(S,T,E,O,R+f,L+f);return s.min=Math.min(P,F,V,B),s.max=Math.max(P,F,V,B),s}m=_,y=b,f=1}else m=Math.floor(m),y=Math.floor(y),f=Math.ceil(f);for(let _=m;_<=m+f;_++)for(let b=y;b<=y+f;b++){const w=h[_+b*c];w<p?(a=Math.min(a,w),l=Math.max(l,w)):s.hasNoDataValues=!0}return s.min=a,s.max=l,s}};const hbt=.5*iP;function Xr(t,e,i){if(C(i))return null;for(const r of i){if(!r)continue;const s=r.safeWidth;let n=we(r.dy*(r.y1-e),0,s),o=we(r.dx*(t-r.x0),0,s);const a=Math.floor(n),l=Math.floor(o),c=r.data.width,h=a*c+l,p=r.data.values,f=p[h],m=p[h+1],y=h+c,_=p[y],b=p[y+1];if(f+_+m+b<hbt){n-=a,o-=l;const w=f+(m-f)*o;return w+(_+(b-_)*o-w)*n}}return null}let Lh=class extends $e{constructor(e){super(e),this._handles=new Ki}initialize(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){this._handles=Je(this._handles)}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(i=>{const r=i.layer;if(r.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const s=OMe(r.fullExtent,this.viewSpatialReference);v(s)&&e.push(Xye(s))}}),e}};function dbt(t,e){return t===st.Global?new SX(e):new EX(e)}u([d({readOnly:!0})],Lh.prototype,"layerViewsExtent",null),u([d({readOnly:!0})],Lh.prototype,"tiledLayersExtent",null),u([d({readOnly:!0})],Lh.prototype,"stencilEnabledExtents",null),u([d()],Lh.prototype,"viewSpatialReference",void 0),u([d()],Lh.prototype,"tilingScheme",void 0),u([d()],Lh.prototype,"defaultTiledLayersExtent",void 0),u([d({constructOnly:!0})],Lh.prototype,"layers",void 0),u([d({constructOnly:!0})],Lh.prototype,"layerViews",void 0),Lh=u([I("esri.views.3d.terrain.ExtentHelper")],Lh);let SX=class extends Lh{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?LTe:TQe}};SX=u([I("esri.views.3d.terrain.ExtentHelperGlobal")],SX);let EX=class extends Lh{_computeLayerViewsExtent(){const e=yd(),i=this.viewSpatialReference;this.layerViews.forEach(n=>{const o=n.layer;if(n.isResolved()&&(o.type!=="graphics"||!o.internal)){const a=OMe("fullExtentInLocalViewSpatialReference"in n&&n.fullExtentInLocalViewSpatialReference||n.layer.fullExtent,i);Lv(e,a,e)}});const r=sG(e)?e:null,s=this._get("layerViewsExtent");return sx(r,s)?s:r}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const i=this.viewSpatialReference,r=yd();this.layers.forEach(o=>{if(o.loaded&&FM(o)){const a=X8(o,i,st.Local);if(C(a))return;const{tileInfo:l,fullExtent:c}=a;v(l)&&v(c)&&(a6(o)||e.compatibleWith(l)&&c.spatialReference.equals(e.spatialReference))&&Lv(r,c,r)}}),Lv(r,this.defaultTiledLayersExtent,r);const s=sG(r)?r:null,n=this._get("tiledLayersExtent");return sx(s,n)?n:s}};function OMe(t,e){return v(t)&&!t.spatialReference.equals(e)?T_e(t,t.spatialReference,e):t}EX=u([I("esri.views.3d.terrain.ExtentHelperLocal")],EX);var Ti;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.MAP=1]="MAP"})(Ti||(Ti={}));const hw=[Ti.ELEVATION,Ti.MAP];function RMe(){var e;const t=(e=globalThis.require)==null?void 0:e.modules;if(t){const i=Object.keys(t);for(const r of i)r.search(".glsl")!==-1&&delete t[r]}}const pbt=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let r_,jl=class extends $e{get running(){return this._placementDirty&&(this._drapeSources.size>0||this._view.graphics.length>0||Ji.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this._view.state.isGlobal}get _worldToPCSRatio(){return v(this._spatialReference)&&this._spatialReference.isGeographic&&!this._view.state.isLocal?tr(this._spatialReference).metersPerDegree:1}get _view(){return this.surface.view}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}constructor(e){super(e),this._handles=new Ki,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=de("esri-mobile")?2048:4096,this._animationTimeLast=0}initialize(){var i;const e=this._view;this.renderer=new op({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),this._groundIntersector=xd(this._view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{this.setDrawTexturesDirty(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",r=>{var s;return(s=e._stage)==null?void 0:s.renderer.setParameters({hasOverlayWater:r})}),this.renderer.events.on("renders-occluded",()=>{this.setDrawTexturesDirty(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",()=>this.setDrawTexturesDirty()),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),re(()=>{var r,s,n;return[(r=e.pointsOfInterest)==null?void 0:r.renderPointOfView,(n=(s=e.pointsOfInterest)==null?void 0:s.centerOnSurfaceFrequent)==null?void 0:n.location]},()=>this.setPlacementDirty()),re(()=>{var r,s;return[(r=e.state)==null?void 0:r.pixelRatio,(s=e.state)==null?void 0:s.contentPixelRatio]},()=>this.setPlacementDirty(),Wi),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(Rt.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",r=>{this._updateOverlays(ll,r,Fs.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,Fs.BACKGROUND,r.pixelRatio)})]),(i=e._stage)==null||i.renderer.setParameters({renderOverlay:r=>{this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays&&(this._dispatchAnimationUpdate(r),this._drawOverlayTextures(this.renderer.overlays,Fs.UPDATE)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}})}destroy(){this._handles=Je(this._handles),v(r_)&&(r_.hide(),r_=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const i=this._view.renderSpatialReference;v(e)&&v(i)?(this._renderSR=i,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new Xv(-20037508342787e-6,20037508342787e-6):new Xv(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(e,i,r){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this.renderer.createDrapeSourceRenderer(e,i,r);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),s}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,Au)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&v(e.setDrapingExtent)&&v(this._spatialReference)&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateOverlayResult(){var e;(e=this._view._stage)==null||e.renderer.setParameters({overlays:this.renderer.overlays})}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this._view.state.contentCamera,Fs.UPDATE)}_updateOverlays(e,i,r){if(!this._spatialReference)return ua.YIELD;const s=this._computeOverlayResolution(i);this._computeOverlayExtents(i,s,Og);const n=zu(Og.inner)/zu(Og.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const o=this._updateOverlay(os.INNER,Og.inner,s,1*Og.pixelRatioAdjustment,Og.mapUnitsPerPixel),a=this._updateOverlay(os.OUTER,Og.outer,s,n*Og.pixelRatioAdjustment,Og.mapUnitsPerPixel);o!==om.EXTENT&&a!==om.EXTENT||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.surface.updateTileOverlayParams(r)),o===om.NONE&&a===om.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const i=this._view.state.contentPixelRatio,r=e.fullWidth/e.pixelRatio*i,s=e.fullHeight/e.pixelRatio*i;return Math.min(YE(Math.max(r,s)+256),this._maxResolution)}_updateOverlay(e,i,r,s,n){if(this.renderer.overlays.length===0)return om.NONE;const o=this.renderer.overlays[e],a=o.mapUnitsPerPixel;if(o.mapUnitsPerPixel=n,o.pixelRatio=s,fbt(i,o.extent)&&r===o.resolution)return a===n?om.NONE:om.RERENDER_ONLY;jy(o.extent,i),o.resolution=r;const l=MZ(o.extent);return o.renderLocalOrigin=c3(l[0],l[1],0,"OV_"+this._latestOriginId++),om.EXTENT}setTileParameters(e){const i=e.renderData.overlay;if(this.renderer.overlays.length>0){const r=this.renderer.overlays[os.INNER],s=this.renderer.overlays[os.OUTER],n=e.extent;this._rectInsideRect(r.extent,n)||this._rectanglesOverlap(n,r.extent)||this._rectanglesOverlap(n,s.extent)?(this._setTileOverlayData(n,os.INNER,i),this._setTileOverlayData(n,os.OUTER,i)):(this._clearTileOverlayData(os.INNER,i),this._clearTileOverlayData(os.OUTER,i))}else this._clearTileOverlayData(os.INNER,i),this._clearTileOverlayData(os.OUTER,i)}overlayPixelSizeInMapUnits(e){if(this.renderer.overlays.length===0)return 0;const i=this.renderer.overlays[os.INNER],r=this.renderer.overlays[os.OUTER],s=this._pointIsInExtent(e,i.extent)?i:r;return(s.extent[2]-s.extent[0])/s.resolution}_setTileOverlayData(e,i,r){if(this.renderer.overlays.length===0)return;const s=this.renderer.overlays[i].extent,n=zu(s),o=Zp(s);let a=e[0];if(this._longitudeCyclical){a=this._longitudeCyclical.minimalMonotonic(s[0],a);const l=this._longitudeCyclical.minimalMonotonic(s[0],e[2]);a>l&&(a=l-(e[2]-e[0]))}r.setScale(i,zu(e)/n,Zp(e)/o),r.setOffset(i,(a-s[0])/n,(e[1]-s[1])/o)}_clearTileOverlayData(e,i){i.setScale(e,-1,-1),i.setOffset(e,-1,-1)}async reloadShaders(){RMe(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(ll)}_dispatchAnimationUpdate(e){const i=e-this._animationTimeLast;if(i>=this.surface.view._stage.renderer.animationTimestep||v(this._view.state.forcedAnimationTime)||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const r=i/this.surface.view._stage.renderer.animationTimeDilation,s=new LCe(this._view.state.camera,r,this._view.state.forcedAnimationTime);this.renderer.updateAnimation(s)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this._view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,i,r,s){const n=this._view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,ybt,i,r);if(C(n))return!1;const o=n.origin,a=ve(bD,n.origin,n.direction);return this._groundIntersector.reset(o,a,e),this._groundIntersector.intersect([]),this._view.basemapTerrain.intersect(this._groundIntersector,null,o,a),this._groundIntersector.results.min.getIntersectionPoint(s)}_findHorizonBasedPointOfInterest(e,i){let r=.5;const s=.55,n=this._view.renderCoordsHelper.getAltitude(e.eye),o=this._view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,l=we(o.estimatedSurfaceAltitude,e.aboveGround?-1/0:n+a,e.aboveGround?n-a:1/0),c=e.aboveGround;if(this._view.viewingMode==="global"){const h=bD;nA(wU(xU,tr(this._view.spatialReference).radius+l),ih(e.eye,e.viewForward),h),be(h,h,e.eye);const p=Yv.normalize(hve(e.viewForward,h,e.viewRight))/e.fovY+.5,f=p<=0||p>=1?.5:s;r=c?f*p:p+f*(1-p)}else{const h=.5*Math.PI-Math.acos(-e.viewForward[2]),p=Math.tan(h),f=si(0,p,1,0),m=qu(f,f,e.projectionMatrix)[1],y=we(.5+.5*m,0,1);r=y===1||y===0?.5:c?y*s:1-(1-y)*s}return!!this._intersectGroundFromView(e,.5,r,i)&&WY(i,e.eye)<o.distance*o.distance}_computeOverlayExtents(e,i,r){const s=this._view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n=M();this._findHorizonBasedPointOfInterest(e,n)||he(n,s);const o=Math.max(.1,Ar(e.eye,n)),a=a1(this._view.renderCoordsHelper,s,e.eye),l=Math.PI/2-Math.abs(a-Math.PI/2);Ji.OVERLAY_SHOW_CENTER?(C(r_)&&(r_=new RS(this._view.graphics,"red")),r_.show(n,this._renderSR)):v(r_)&&r_.hide(),this._overlaySREqualsRenderSR||_o(n,this._renderSR,n,this._spatialReference);const c=this.surface.extent,h=!this._isSpherical&&v(this._spatialReference)&&this._spatialReference.isGeographic,p=h&&v(this._spatialReference)?1/tr(this._spatialReference).metersPerDegree:1,f=this._view.state.contentPixelRatio,m=e.perScreenPixelRatio/f*o*p;r.mapUnitsPerPixel=m/this._worldToPCSRatio;let y=i*m/2,_=!1,b=h?90:1/0;this._isSpherical&&v(c)&&v(this._spatialReference)&&(this._spatialReference.isWebMercator?(y/=Math.cos(v4(n[1])),b=c[3]):(_=!0,y/=tr(this._spatialReference).metersPerDegree,b=90),y>=b&&(y=b,n[1]=0,this._spatialReference.isWebMercator&&(n[0]=0)));let w=1;_&&(w=1/Math.max(.2,Math.cos(Math.abs(ii(n[1])))),y*w>180&&(w=180/y),r.mapUnitsPerPixel*=w);const S=Math.log(2)/12;y=Math.exp(Math.round(Math.log(y)/S)*S);const T=y*w,E=32,O=.5*i/(E*T),R=.5*i/(E*y);n[0]=Math.round(n[0]*O)/O,n[1]=Math.round(n[1]*R)/R;const L=r.inner;L[0]=n[0]-T,L[1]=n[1]-y,L[2]=n[0]+T,L[3]=n[1]+y,this._isSpherical&&this._shiftExtentToFitBounds(L,1/0,b);const P=r.outer;if(6*T>zu(c))jy(P,c);else if(l<=.25*Math.PI)P[0]=L[0]-T,P[1]=L[1]-y,P[2]=L[2]+T,P[3]=L[3]+y;else{_o(e.eye,this._renderSR,bD,this._spatialReference),ju(ub,n,bD);let V=-Math.atan2(ub[1],ub[0])+.125*Math.PI;V<0&&(V+=2*Math.PI);const B=Math.floor(V/(.25*Math.PI));XC(ub,pbt[B],2*y),ub[0]*=w,ub[2]*=w,XY(P,L,ub)}if(this._isSpherical)P[0]=this._longitudeCyclical.clamp(P[0]),P[2]=this._longitudeCyclical.clamp(P[2]),P[1]=Math.max(P[1],-b),P[3]=Math.min(P[3],b);else{const V=oG(L,c,mbt),B=oG(P,c,gbt);nG(V,B)&&(P[2]=P[0],P[3]=P[1])}const F=Math.abs(L[2]-L[0])/i;r.mapUnitsPerPixel=Math.max(r.mapUnitsPerPixel,F),r.pixelRatioAdjustment=r.mapUnitsPerPixel/F}_drawOverlayTextures(e,i,r=this._view.state.contentPixelRatio){if(e.length===0||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const s=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const n=this._drawOverlay(e[os.INNER],r),o=this._drawOverlay(e[os.OUTER],r);n!==AC.CHANGED&&o!==AC.CHANGED||this.surface.updateTileOverlayParams(Fs.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),s?(this.surface.requestRender(i),i===Fs.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(Fs.BACKGROUND)}_drawOverlay(e,i){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,i)}_collectUnusedRenderTargetMemory(){if(this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays){const e=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(e)}}_rectanglesOverlap(e,i){return!C(e)&&(this._longitudeCyclical?(this._longitudeCyclical.contains(i[0],i[2],e[0])||this._longitudeCyclical.contains(i[0],i[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],i[0]))&&!(e[1]>i[3]||e[3]<i[1]):iU(e,i))}_rectInsideRect(e,i){return!C(i)&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],i[0])&&this._longitudeCyclical.contains(e[0],e[2],i[2])&&i[1]>e[1]&&i[3]<e[3]:nG(e,i))}_pointIsInExtent(e,i){if(this._longitudeCyclical)return this._longitudeCyclical.contains(i[0],i[2],e.x)&&e.y>=i[1]&&e.y<=i[3];const r=e.x,s=e.y;return r>i[0]&&r<i[2]&&s>i[1]&&s<i[3]}_shiftExtentToFitBounds(e,i,r){let s=0,n=0;e[0]<-i?s=e[0]+i:e[2]>i&&(s=i-e[2]),e[1]<-r?n=e[1]+r:e[3]>r&&(n=r-e[3]),E4(e,s,n)}get test(){return{renderer:this.renderer,update:()=>this.runTask(ll)}}};function fbt(t,e){const r=Ji.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r&&Math.abs(e[2]-t[2])<=r&&Math.abs(e[3]-t[3])<=r}u([d()],jl.prototype,"_spatialReference",void 0),u([d({readOnly:!0})],jl.prototype,"running",null),u([d()],jl.prototype,"_placementDirty",void 0),u([d()],jl.prototype,"_contentUpdated",void 0),u([d()],jl.prototype,"_isSpherical",null),u([d()],jl.prototype,"_worldToPCSRatio",null),u([d({autoDestroy:!0})],jl.prototype,"renderer",void 0),u([d({constructOnly:!0})],jl.prototype,"surface",void 0),u([d()],jl.prototype,"suspended",null),u([d()],jl.prototype,"updating",null),u([d({type:Boolean})],jl.prototype,"hasHighlights",null),u([d({type:Boolean})],jl.prototype,"rendersOccluded",null),jl=u([I("esri.views.3d.terrain.OverlayManager")],jl);const ub=fi(),bD=M(),Og={inner:ci(),outer:ci(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},mbt=ci(),gbt=ci(),ybt=fo();var om;(function(t){t[t.NONE=0]="NONE",t[t.EXTENT=1]="EXTENT",t[t.RERENDER_ONLY=2]="RERENDER_ONLY"})(om||(om={}));let MMe=class CX{constructor(e,i){this._factoryCallback=e,this._lengthCallback=i,this._pool=new Map}acquire(e){if(!CX.test.disabled){const i=this._pool.get(e);if(i&&i.length!==0)return i.pop()}try{return this._factoryCallback(e)}catch(i){const r=window.performance&&window.performance.memory;let s="";throw r&&(s=`
  totalJSHeapSize: ${r.totalJSHeapSize}, usedJSHeapSize: ${r.usedJSHeapSize}, jsHeapSizeLimit: ${r.jsHeapSizeLimit}`),console.log("Array allocation of size "+e+" failed: "+i+s),i}}release(e){if(CX.test.disabled)return;const i=this._lengthCallback(e);let r=this._pool.get(i);r||(r=new li({shrink:!0}),this._pool.set(i,r)),r.push(e)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}};MMe.test={disabled:!1};let _bt=class{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=$r(),this.indexCount=0,this.numVerticesPerSide=0,this.uvRange=[0,0,1,1],this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}},jhe=class{constructor(e,i,r,s,n){this.attributes=e,this.localOrigin=i,this.index0=r,this.stride=s,this.count=n}getVertexIndex(e){return this.getAttributeIndex(e)}getAttributeIndex(e){return Be(0<=e&&e<this.count),this.index0+this.stride*e}_getVertexRaw(e,i){this.attributes.position.getVec(e,i)}_getNormalRaw(e,i){this.attributes.normalCompressed.getVec(e,i)}getVertexPos(e,i){this._getVertexRaw(this.getAttributeIndex(i),e),ve(e,e,this.localOrigin)}getNormal(e,i){const r=et();this._getNormalRaw(this.getAttributeIndex(i),r),xbt(e,r)}_setNormal(e,i,r,s){LP(this.attributes.normalCompressed,e,i,r,s)}_setUV(e,i,r){Qc(this.attributes.uv0,e,i,r)}setNormalFromValues(e,i,r,s){this._setNormal(this.getAttributeIndex(e),i,r,s)}setVertexFromValuesRawPositionUV(e,i,r,s,n,o){const a=this.getAttributeIndex(e);this.attributes.position.setValues(a,i,r,s),this._setUV(a,n,o)}setVertexFromValuesRawPositionUVNormal(e,i,r,s,n,o,a,l,c){const h=this.getAttributeIndex(e);this.attributes.position.setValues(h,i,r,s),this._setUV(h,n,o),this._setNormal(h,a,l,c)}};const vbt=cs().vec3f(A.POSITION).vec2i16(A.UV0).vec2i16(A.NORMALCOMPRESSED,{glNormalized:!0}),Xee=new MMe(t=>vbt.createBuffer(t),t=>t.count);function bbt(){Xee.clear()}function PMe(t){return Xee.acquire(t)}function wbt(t){Xee.release(t.vertexAttributes),t.vertexAttributes=null,t.indices=null}function LP(t,e,i,r,s){const n=1/(Math.abs(i)+Math.abs(r)+Math.abs(s)),o=i*n,a=r*n,l=s<=0?(o>=0?1:-1)*(1-Math.abs(a)):o,c=s<=0?(a>=0?1:-1)*(1-Math.abs(o)):a;t.setValues(e,qhe(l),qhe(c))}function xbt(t,e){const i=Whe(e[0]),r=Whe(e[1]),s=1-Math.abs(i)-Math.abs(r);t[2]=s,s<0?(t[0]=(i>=0?1:-1)*(1-Math.abs(r)),t[1]=(r>=0?1:-1)*(1-Math.abs(i))):(t[0]=i,t[1]=r),Oe(t,t)}const Hhe=16384;function Qc(t,e,i,r){t.setValues(e,i*Hhe,r*Hhe)}function qhe(t){return we(Math.round(32767*t),-32767,32767)}function Whe(t){return we(t/32767,-1,1)}function pl(t,e,i,r){t<r[0]?r[0]=t:t>r[3]&&(r[3]=t),e<r[1]?r[1]=e:e>r[4]&&(r[4]=e),i<r[2]?r[2]=i:i>r[5]&&(r[5]=i)}let Tbt=class{constructor(){this.sinLonLUT=new Array(FR+1),this.cosLonLUT=new Array(FR+1),this.sinLatLUT=new Array(FR+1),this.cosLatLUT=new Array(FR+1)}update(e,i,r){const s=i[0],n=i[2];for(let o=0;o<=e;o++){const a=o/e,l=s*(1-a)+n*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=r(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}},wD=class{constructor(){this.cornerTiles=[null,null,null,null],this.cornerTileSamplerVersions=[-1,-1,-1,-1]}},Sbt=class{constructor(){this.cornerNeighborData=[new wD,new wD,new wD,new wD],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1],this.cornerPeerNeighbors=[null,null,null,null]}},Ebt=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.shading=!1,this.samplerDataVersion=0,this.neighborData=new Sbt}},IMe=class DF{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=Je(this._current),this._next=Je(this._next),this._waiting=Je(this._waiting),this._delayed=Je(this._delayed)}get current(){if(C(this._current))return null;if(!this._isFadingEnabled){const i=this._delayed||this._waiting||this._next||this._current;i!==this._current&&(this._current=null,this.clear(),this._current=i)}let e=DF.test.fadeMoment;if(v(this._delayed)&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,Ly.Immediate),this._delayed=null)),v(this._next)){e=e||performance.now();const i=this._fadeDuration,r=v(this._current)&&this._next.texture===this._current.texture,s=this._next.type!==On.FADING,n=e-this._fadeStart>=i;(r||s||n)&&(Je(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(C(this._next))return 1;const e=DF.test.fadeMoment||performance.now(),i=Math.max(0,e-this._fadeStart),r=this._fadeDuration;return i>r?0:1-i/r}get isFading(){return v(this._next)||v(this._delayed)}push(e,i=Ly.Immediate){this._delayed=Je(this._delayed),this._push(e,i)}_push(e,i){if(this._isFadingEnabled||this.clear(),C(this._current))return void(this._current=e);const r=DF.test.fadeMoment||performance.now();return i!==Ly.Immediate?(this._delayed=e,void(this._delayedTime=r+i)):C(this._next)?(this._next=e,void(this._fadeStart=this._alignFadeStart(r))):void(C(e)||(Je(this._waiting),this._waiting=e))}get _fadeDuration(){return C(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const i=this._getFadeDuration();return e+i-e%i}get _isFadingEnabled(){return this._getFadeDuration()>0}};var Ly;IMe.test={fadeMoment:0},function(t){t[t.Immediate=0]="Immediate",t[t.Delayed=5e3]="Delayed"}(Ly||(Ly={}));var BC;(function(t){t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT",t[t.NONE=0]="NONE",t[t.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(BC||(BC={}));let $Me=class{constructor(){this._queue=new li,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),v(e)&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){var i;const e=(i=this._last)==null?void 0:i.children;return e&&e[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},Cbt=class{constructor(){this._q=new li}get done(){return this._q.length===0}reset(e){if(this._q.clear(),!C(e)){this._q.pushArray(e);for(let i=0;i<this._q.length;++i){const r=this._q.data[i];r.isLeaf||this._q.pushArray(r.children)}}}next(){return this._q.pop()}};function g3(t,e,i){if(C(e)||C(e.fullExtent))return!1;const r=e.fullExtent,s=t.extent;if(i){if(s[0]<r.xmin||s[1]<r.ymin||s[2]>r.xmax||s[3]>r.ymax)return!1}else if(r.xmin>s[2]||r.ymin>s[3]||r.xmax<s[0]||r.ymax<s[1])return!1;const n=t.surface.tilingScheme.levels[t.level].scale,o=e.minScale;if(o>0&&n>1.00000001*o)return!1;const a=e.maxScale;return!(a>0&&n<.99999999*a)}function Dy(t,e){const i=t.lij,r=e.lij;return i[0]-r[0]||i[1]-r[1]||i[2]-r[2]}function LMe(t,e,i=null){C(i)||i.length===0?t===BC.BACK_TO_FRONT?e.sort(Abt):e.sort(Obt):e.sort((r,s)=>Rbt(r,s,t,i))}function Abt(t,e){const i=e.screenDepth-t.screenDepth;if(i!==0)return i;const r=t.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function Obt(t,e){const i=t.screenDepth-e.screenDepth;if(i!==0)return i;const r=t.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function DMe(t,e,i){const r=t.screenDepth,s=e.screenDepth;return r<s?-i:r>s?i:Dy(t,e)}function Rbt(t,e,i,r){return Xhe(t,r)===Xhe(e,r)?DMe(t,e,i):t?i:-i}function Xhe(t,e){for(const i of e)if(t.intersectsExtent(i))return!0;return!1}function Mbt(t,e){const i=t.distanceToPOI-e.distanceToPOI;if(i!==0)return i;const r=t.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function Pbt(t,e){const i=t.length;for(let r=0;r<i;++r)t.getItemAt(r).updateDistanceToPOI(e);t.sort(Mbt)}function Ibt(t,e,i){let r=1,s=0,n=0;for(;t!==e;)if(r*=.5,s*=.5,n*=.5,1&t.lij[2]&&(s+=.5),!(1&t.lij[1])&&(n+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");i.init(e,s,n,r)}function $bt(t){for(let e=0;e<t.length;e++){const i=t[e],r=i.parent;if(r)for(let s=0;s<4;s++){const n=r.children[s];if(n&&n!==i)return!0}}return!1}function UVt(t,e){if(!t||!e||t[0]===e[0])return!1;const i=t[0]<e[0],r=i?t:e,s=i?e:t,n=1<<s[0]-r[0];return Math.floor(s[1]/n)===r[1]&&Math.floor(s[2]/n)===r[2]}let Yee=class{get updating(){return!!this._tileRequested}init(e,i,r,s){this.tile=e,this._layerIdx=i,this._layerClass=r,this._suspended=s,this._tileLayerInfo=e.getLayerInfo(i,r),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e){this._setUpsampleTile(e),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,On.FADING):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return v(e)?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,i=this._layerClass,r=this.tile.surface.layerViewByIndex(e,i),s=bX(r),{minLevel:n,maxLevel:o}=r.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?g3:()=>!0;let h=this.tile;const p=h.level;let f;const m=this._tileLayerInfo.upsampleInfo,y=v(m)?m.tile.level:-1,_=!!v(m)&&y-p>=a,b=In(s,"tilemapCache");for(;h&&c(h,s,!1)&&h.level>=n;){const w=h.level,S=p-w,T=h.layerInfo[i][e];if(T.data&&S>=a){(!_||w>y)&&this._setUpsampleTile(h),T.dataInvalidated&&(f=h);break}if((C(b)||b.getAvailability(h.lij[0],h.lij[1],h.lij[2])!=="unavailable")&&w<=o&&!T.data&&!T.dataMissing&&((C(f)||h.level===n||w%$Te==0||p-f.level<a)&&(f=h),S>=l))break;h=h.parent}return v(f)&&p-f.level<a&&this._tileLayerInfo.upsampleInfo&&(f=null),f}_findAncestorWithData(){const e=this.tile.vlevel,i=this._desiredMinLevelDelta;let r;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(e-s.level>=i)return s;r=s}return r}_setUpsampleTile(e){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,On.FADING)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}},Lbt=class extends Yee{get _desiredMinLevelDelta(){throw Yhe}get _progressiveLevelModulo(){throw Yhe}dispose(){}};const Yhe=new Error("Abstract method called on TileAgent"),vc=new Lbt;let NMe=class extends Yee{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return lq(this.tile.level)-(this.tile.vlevel-this.tile.level)}get _progressiveLevelModulo(){return 0}},FMe=class extends Yee{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return $Te}};var gx,Qx;(function(t){t[t.Stretch=0]="Stretch",t[t.Lut=1]="Lut",t[t.Hillshade=2]="Hillshade",t[t.COUNT=3]="COUNT"})(gx||(gx={})),function(t){t[t.Noop=0]="Noop",t[t.PerBand=1]="PerBand",t[t.COUNT=2]="COUNT"}(Qx||(Qx={}));function Dbt(t,e){t.fragment.uniforms.add([new zt("u_colormap",i=>i.u_colormap),new He("u_colormapOffset",i=>i.colormap.u_colormapOffset),new He("u_colormapMaxIndex",i=>i.colormap.u_colormapMaxIndex),new He("u_opacity",i=>i.common.u_opacity)]),t.fragment.code.add(x`
    vec4 colormap(vec4 currentPixel, bool isFloat) {
      float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
      vec4 result;
      // handle no data and out of range pixels
      if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
        result = vec4(0.0, 0.0, 0.0, 0.0);
      } else {
        // colormap lookup
        vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
        result = ${hl(e,"u_colormap","texelCoordinates","(1.0 / vec2(u_colormapMaxIndex + 1.0, 1.0))")};
      }
      return result;
    }
  `)}function Nbt(t,e){t.fragment.uniforms.add(jp("u_transformGrid",i=>i.u_transformGrid,e.hasWebGL2Context?sr.None:sr.InvSize)),t.fragment.uniforms.add(new zi("u_transformSpacing",i=>i.common.u_transformSpacing)),t.fragment.uniforms.add(new zi("u_targetImageSize",i=>i.common.u_targetImageSize)),t.fragment.code.add(x`
    vec2 projectPixelLocation(vec2 coords) {
      // Pixel index in row/column, corresponds to upperleft corner, e.g. [100, 20]
      vec2 index_image = floor(coords * u_targetImageSize);

      // Pixel's corresponding cell index in transform grid
      // Each transform cell corresponds to 4 pixels: 6 coefficients from lowerleft triangle followed by 6 coefficients from upperright triangle
      vec2 oneTransformPixel = vec2(4.0, 1.0);
      vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;

      // Correspoding position in transform grid cell, cell center coordinates
      vec2 pos = fract((index_image + 0.5) / u_transformSpacing);

      // Pixel's corresponding transform cell location, cell center coordinates
      vec2 transform_location = index_transform + 0.5;

      vec2 srcLocation;

      // Use lower triangle or upper triangle
      if (pos.s <= pos.t) {
        vec3 ll_abc = ${hl(e,"u_transformGrid","transform_location")}.rgb;
        vec3 ll_def = ${hl(e,"u_transformGrid","vec2(transform_location.s + 1.0, transform_location.t)")}.rgb;
        srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
        srcLocation.t = dot(ll_def, vec3(pos, 1.0));
      } else {
        vec3 ur_abc = ${hl(e,"u_transformGrid","vec2(transform_location.s + 2.0, transform_location.t)")}.rgb;
        vec3 ur_def = ${hl(e,"u_transformGrid","vec2(transform_location.s + 3.0, transform_location.t)")}.rgb;
        srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
        srcLocation.t = dot(ur_def, vec3(pos, 1.0));
      }

      return srcLocation;
    }
  `)}let UMe=class extends yr{constructor(){super(...arguments),this.scale=1,this.offset=dc}};function VMe(t){t.attributes.add(A.POSITION,"vec2"),t.attributes.add(A.UV0,"vec2"),t.vertex.uniforms.add(new He("scale",e=>e.scale)),t.vertex.uniforms.add(new zi("offset",e=>e.offset)),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.code.add(x`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}let Fbt=class extends UMe{constructor(e,i,r){super(),this.common=e,this.u_image=i,this.u_transformGrid=r}};function Ubt(t,e){t.include(Nbt,e),t.fragment.uniforms.add([new zt("u_image",i=>i.u_image),new My("u_flipY",i=>i.common.u_flipY),new My("u_applyTransform",i=>i.common.u_applyTransform)]),t.fragment.code.add(x`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)}var Ke;(function(t){t[t.Normal=0]="Normal",t[t.Average=1]="Average",t[t.Lighten=2]="Lighten",t[t.Lighter=3]="Lighter",t[t.Plus=4]="Plus",t[t.Screen=5]="Screen",t[t.ColorDodge=6]="ColorDodge",t[t.Darken=7]="Darken",t[t.Multiply=8]="Multiply",t[t.ColorBurn=9]="ColorBurn",t[t.Overlay=10]="Overlay",t[t.SoftLight=11]="SoftLight",t[t.HardLight=12]="HardLight",t[t.VividLight=13]="VividLight",t[t.Hue=14]="Hue",t[t.Saturation=15]="Saturation",t[t.Luminosity=16]="Luminosity",t[t.Color=17]="Color",t[t.DestinationOver=18]="DestinationOver",t[t.DestinationAtop=19]="DestinationAtop",t[t.DestinationIn=20]="DestinationIn",t[t.DestinationOut=21]="DestinationOut",t[t.SourceAtop=22]="SourceAtop",t[t.SourceIn=23]="SourceIn",t[t.SourceOut=24]="SourceOut",t[t.Xor=25]="Xor",t[t.Difference=26]="Difference",t[t.Exclusion=27]="Exclusion",t[t.Minus=28]="Minus",t[t.Invert=29]="Invert",t[t.Reflect=30]="Reflect",t[t.COUNT=31]="COUNT"})(Ke||(Ke={}));const AX={normal:Ke.Normal,average:Ke.Average,lighten:Ke.Lighten,lighter:Ke.Lighter,screen:Ke.Screen,plus:Ke.Plus,"color-dodge":Ke.ColorDodge,darken:Ke.Darken,multiply:Ke.Multiply,"color-burn":Ke.ColorBurn,overlay:Ke.Overlay,"soft-light":Ke.SoftLight,"hard-light":Ke.HardLight,"vivid-light":Ke.VividLight,hue:Ke.Hue,saturation:Ke.Saturation,luminosity:Ke.Luminosity,color:Ke.Color,difference:Ke.Difference,exclusion:Ke.Exclusion,minus:Ke.Minus,invert:Ke.Invert,reflect:Ke.Reflect,"destination-over":Ke.DestinationOver,"destination-atop":Ke.DestinationAtop,"destination-in":Ke.DestinationIn,"destination-out":Ke.DestinationOut,"source-atop":Ke.SourceAtop,"source-in":Ke.SourceIn,"source-out":Ke.SourceOut,xor:Ke.Xor};function Vbt(t){return t===Ke.DestinationOver||t===Ke.DestinationAtop||t===Ke.DestinationIn||t===Ke.DestinationOut||t===Ke.SourceAtop||t===Ke.SourceIn||t===Ke.SourceOut||t===Ke.Xor}function Zee(t){t.code.add(x`
    float lineFactorAtPosition(float value) {
      float pos = value * ${x.float(257)};
      if(pos < 0.5 || pos > ${x.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}function kbt(t,e){const i=e.blendMode;i!==Ke.Normal&&(i===Ke.Reflect&&t.code.add(x`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),i!==Ke.ColorDodge&&i!==Ke.VividLight||t.code.add(x`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),i!==Ke.ColorBurn&&i!==Ke.VividLight||t.code.add(x`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),i===Ke.Overlay&&t.code.add(x`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),i===Ke.HardLight&&t.code.add(x`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),i===Ke.SoftLight&&t.code.add(x`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),i===Ke.VividLight&&t.code.add(x`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),i!==Ke.Hue&&i!==Ke.Saturation&&i!==Ke.Color&&i!==Ke.Luminosity||(t.code.add(x`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),i!==Ke.Hue&&i!==Ke.Saturation||t.code.add(x`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(x`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${i===Ke.Multiply?x`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ke.Average?x`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ke.Lighten?x`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ke.Darken?x`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ke.Lighter?x`return vec4(cl * ol + cb * ob, ol + ob);`:i===Ke.Plus?x`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:i===Ke.Minus?x`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:i===Ke.Screen?x`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ke.Difference?x`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ke.Invert?x`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Ke.DestinationOver?x`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:i===Ke.DestinationAtop?x`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:i===Ke.DestinationOut?x`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:i===Ke.SourceAtop?x`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Ke.SourceOut?x`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:i===Ke.Xor?x`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:i===Ke.DestinationIn?x`return vec4(cb * ob * ol, ol * ob);`:i===Ke.SourceIn?x`return vec4(cl * ol * ob, ol * ob);`:i===Ke.Hue?x`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ke.Saturation?x`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ke.Color?x`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ke.Luminosity?x`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ke.Exclusion?x`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ke.Reflect?x`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ke.ColorDodge?x`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ke.ColorBurn?x`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ke.Overlay?x`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ke.SoftLight?x`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ke.HardLight?x`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ke.VividLight?x`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:x``}
    }
  `))}var jn,Up,vp;(function(t){t[t.Composite=0]="Composite",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.GroupBackgroundComposite=3]="GroupBackgroundComposite",t[t.COUNT=4]="COUNT"})(jn||(jn={})),function(t){t[t.NotRequired=0]="NotRequired",t[t.Required=1]="Required",t[t.COUNT=2]="COUNT"}(Up||(Up={})),function(t){t[t.Off=0]="Off",t[t.On=1]="On",t[t.COUNT=2]="COUNT"}(vp||(vp={}));function kMe(t,e){const i=e.output===jn.GridComposite,r=e.output===jn.ColorComposite,s=e.output===jn.GroupBackgroundComposite,n=e.output===jn.Composite;i&&(t.extensions.add("GL_OES_standard_derivatives"),t.fragment.include(Zee)),r&&t.fragment.uniforms.add(new ni("backgroundColor",c=>c.backgroundColor));const o=e.baseOpacityMode===Up.Required;if(o&&t.fragment.uniforms.add(new He("baseOpacity",c=>c.baseOpacity)),n){const c=e.hasWebGL2Context?sr.None:sr.InvSize;t.fragment.uniforms.add(jp("fboColor",h=>h.fboTexture,c))}const a=e.blendMode!==Ke.Normal,l=e.premultipliedSource===vp.On;t.fragment.include(kbt,e),t.fragment.code.add(x`
    vec4 getBackground(vec2 uv) {
      return ${o?x`baseOpacity *`:""} ${s?x`vec4(0.0, 0.0, 0.0, 0.0)`:r?x`vec4(backgroundColor, 1.0)`:i?x`vec4(gridColor(uv), 1.0)`:x`${hl(e,"fboColor","gl_FragCoord.xy")}`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${a?x`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:x`
          float composeAlpha = colorLayer.a * opacity;
          return ${!l&&(n&&!o||s)?x`colorLayer * opacity;`:x`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}let Z8=class extends Fbt{constructor(e,i,r,s,n,o){super(e,s,n),this.colormap=i,this.symbolizer=r,this.u_colormap=o,this.backgroundColor=Ma,this.fboTexture=null,this.baseOpacity=1}},Bbt=class extends Z8{},zbt=class extends Z8{};function Gbt(t){const e=new Ui;return e.include(VMe),e.include(Ubt,t),e.include(Dbt,t),e.include(kMe,t),e.fragment.code.add(x`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`),t.colorizerType===gx.Stretch?Hbt(e,t):t.colorizerType===gx.Lut?jbt(e):t.colorizerType===gx.Hillshade&&qbt(e,t),e}function jbt(t){t.fragment.code.add(x`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function Hbt(t,e){t.fragment.uniforms.add([new FI("u_bandCount",r=>r.symbolizer.u_bandCount),new Aa("u_minCutOff",r=>r.symbolizer.u_minCutOff,3),new Aa("u_maxCutOff",r=>r.symbolizer.u_maxCutOff,3),new Aa("u_factor",r=>r.symbolizer.u_factor,3),new He("u_minOutput",r=>r.symbolizer.u_minOutput),new He("u_maxOutput",r=>r.symbolizer.u_maxOutput),new My("u_useGamma",r=>r.symbolizer.u_useGamma),new Aa("u_gamma",r=>r.symbolizer.u_gamma,3),new Aa("u_gammaCorrection",r=>r.symbolizer.u_gammaCorrection,3),new He("u_opacity",r=>r.common.u_opacity)]),t.fragment.code.add(x`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const i=e.applyColormap?x`gl_FragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:x`gl_FragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.code.add(x`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${e.stretchType===Qx.Noop?x`
        gl_FragColor = applyBackgroundBlend(currentPixel);`:x`
        if (currentPixel.a == 0.0) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${i}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function qbt(t,e){const i=t.fragment;i.uniforms.add([new zt("u_image",s=>s.u_image),new FI("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new Aa("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new Aa("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new Aa("u_cosZs",s=>s.symbolizer.u_cosZs,6),new Aa("u_weights",s=>s.symbolizer.u_weights,6),new zi("u_factor",s=>s.symbolizer.u_factor),new He("u_minValue",s=>s.symbolizer.u_minValue),new He("u_maxValue",s=>s.symbolizer.u_maxValue),new zi("u_srcImageSize",s=>s.common.u_srcImageSize)]),i.include(sg),i.code.add(x`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),i.code.add(x`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const r=e.applyColormap?x`gl_FragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:x`hillshade *= alpha;
gl_FragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;i.code.add(x`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${r}
    }
  `)}const Wbt=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:zbt,ColorizerStretchUniforms:Bbt,ColorizerUniforms:Z8,build:Gbt},Symbol.toStringTag,{value:"Module"}));function Xbt(t,e,i="nearest",r=!1){var c;const s=!(r&&e.pixelType==="u8"),n=s?Ht.FLOAT:Ht.UNSIGNED_BYTE,o=e.pixels==null||e.pixels.length===0?null:s?e.getAsRGBAFloat():e.getAsRGBA(),a=(c=t.capabilities.textureFloat)==null?void 0:c.textureFloatLinear,l={width:e.width,height:e.height,target:Pt.TEXTURE_2D,pixelFormat:it.RGBA,internalFormat:t.type===Mt.WEBGL2&&s?Lt.RGBA32F:it.RGBA,samplingMode:!a||i!=="bilinear"&&i!=="cubic"?gt.NEAREST:gt.LINEAR,dataType:n,wrapMode:kt.CLAMP_TO_EDGE,flipped:!1};return new xt(t,l,o)}function Ybt(t,e){const{spacing:i,offsets:r,coefficients:s,size:[n,o]}=e,a=i[0]>1,l={width:a?4*n:n,height:o,target:Pt.TEXTURE_2D,pixelFormat:it.RGBA,internalFormat:t.type===Mt.WEBGL2?Lt.RGBA32F:it.RGBA,dataType:Ht.FLOAT,samplingMode:gt.NEAREST,wrapMode:kt.CLAMP_TO_EDGE,flipped:!1},c=new Float32Array(a?n*o*16:2*r.length);if(a&&s!=null)for(let h=0,p=0;h<s.length;h++)c[p++]=s[h],h%3==2&&(c[p++]=1);else for(let h=0;h<o;h++)for(let p=0;p<n;p++){const f=4*(h*n+p),m=2*(p*o+h);c[f]=r[m],c[f+1]=r[m+1],c[f+3]=r[m]===-1?0:1}return new xt(t,l,c)}function Zhe(t,e){const i={width:e.length/4,height:1,target:Pt.TEXTURE_2D,pixelFormat:it.RGBA,internalFormat:it.RGBA,dataType:Ht.UNSIGNED_BYTE,samplingMode:gt.NEAREST,wrapMode:kt.CLAMP_TO_EDGE,flipped:!1};return new xt(t,i,e)}function Zbt(t,e,i,r=1,s=!0){return{u_flipY:s,u_applyTransform:!!t,u_opacity:r,u_transformSpacing:t?t.spacing:dc,u_transformGridSize:t?t.size:dc,u_targetImageSize:e,u_srcImageSize:i}}function Jbt(t,e){return{u_colormapOffset:e||0,u_colormapMaxIndex:t?t.length/4-1:0}}function XVt(t,e){return{u_scale:t,u_offset:e}}function Kbt(t){return{u_bandCount:t.bandCount,u_minOutput:t.outMin,u_maxOutput:t.outMax,u_minCutOff:t.minCutOff,u_maxCutOff:t.maxCutOff,u_factor:t.factor,u_useGamma:t.useGamma,u_gamma:t.gamma,u_gammaCorrection:t.gammaCorrection}}function Qbt(t){return{u_hillshadeType:t.hillshadeType,u_sinZcosAs:t.sinZcosAs,u_sinZsinAs:t.sinZsinAs,u_cosZs:t.cosZs,u_weights:t.weights,u_factor:t.factor,u_minValue:t.minValue,u_maxValue:t.maxValue}}function YVt(t,e){const i=t.gl,r=e.glName,s=new Map;if(C(r))return s;const n=i.getProgramParameter(r,i.ACTIVE_UNIFORMS);let o;for(let a=0;a<n;a++)o=i.getActiveUniform(r,a),o&&s.set(o.name,{location:i.getUniformLocation(r,o.name),info:o});return s}function ZVt(t,e,i){Object.keys(i).forEach(r=>{const s=e.get(r)||e.get(r+"[0]");s&&ewt(t,r,i[r],s)})}function JVt(t,e,i,r){i.length===r.length&&(r.some(s=>s==null)||i.some(s=>s==null)||i.forEach((s,n)=>{e.setUniform1i(s,n),t.bindTexture(r[n],n)}))}function ewt(t,e,i,r){if(r===null||i==null)return!1;const{info:s}=r;switch(s.type){case tl.FLOAT:s.size>1?t.setUniform1fv(e,i):t.setUniform1f(e,i);break;case tl.FLOAT_VEC2:t.setUniform2fv(e,i);break;case tl.FLOAT_VEC3:t.setUniform3fv(e,i);break;case tl.FLOAT_VEC4:t.setUniform4fv(e,i);break;case tl.FLOAT_MAT3:t.setUniformMatrix3fv(e,i);break;case tl.FLOAT_MAT4:t.setUniformMatrix4fv(e,i);break;case tl.INT:s.size>1?t.setUniform1iv(e,i):t.setUniform1i(e,i);break;case tl.BOOL:t.setUniform1i(e,i?1:0);break;case tl.INT_VEC2:case tl.BOOL_VEC2:t.setUniform2iv(e,i);break;case tl.INT_VEC3:case tl.BOOL_VEC3:t.setUniform3iv(e,i);break;case tl.INT_VEC4:case tl.BOOL_VEC4:t.setUniform4iv(e,i);break;default:return!1}return!0}const Jhe={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};let twt=class{constructor(e,i,r=null,s=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=e,this.source=i,this.width=r||i.width,this.height=s||i.height}get source(){return this._source}set source(e){this._source=e,this._rasterTexture=ft(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...Jhe,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||Jhe}set symbolizerParameters(e){this._symbolizerParameters=e}get bandIds(){return this._bandIds}set bandIds(e){v(e)&&e.length>0?this._bandIds&&e.every((i,r)=>{var s;return!!((s=this._bandIds)!=null&&s[r])&&i===this._bandIds[r]})||(this._bandIds=e,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){if(this._interpolation=e,v(this._rasterTexture)){const i=this._getRasterTextureInterpolation(e);this._rasterTexture.setSamplingMode(i==="bilinear"?gt.LINEAR:gt.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture=ft(this._transformGridTexture),this._memoryUsed=null}bind(e){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((C(this._rasterTexture)||this._dirty)&&this._updateRasterTexture(e,this.bandIds),v(this._rasterTexture)&&(this._updateColormapTexture(e),this.transformGrid&&C(this._transformGridTexture)&&(this._transformGridTexture=Ybt(e,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:e,transformGrid:i,width:r,height:s,opacity:n}=this,o=Zbt(i,[r,s],[this.source.width,this.source.height],n),a=Jbt(e.colormap,e.colormapOffset),l=this.symbolizerParameters.type==="stretch"?Kbt(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?Qbt(this.symbolizerParameters):null;return new Z8(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get memoryUsage(){if(C(this._memoryUsed)){const e=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=e.map(i=>v(i)?i.descriptor.width*i.descriptor.height*4:0).reduce((i,r)=>i+r,0)}return this._memoryUsed}release(){return this._rasterTexture=ft(this._rasterTexture),this._transformGridTexture=ft(this._transformGridTexture),this._colormapTexture=ft(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(e,i){const r=this.source?this.source.extractBands(i):null;if(!(r&&r.pixels&&r.pixels.length>0))return void(this._rasterTexture=ft(this._rasterTexture));const s=C(i)&&C(this.bandIds)||v(i)&&v(this.bandIds)&&i.join("")===this.bandIds.join("");if(v(this._rasterTexture)&&s)return;this._rasterTexture=ft(this._rasterTexture);const n=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=Xbt(e,r,n,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(e){return this.symbolizerParameters.type==="lut"||e==="nearest"||e==="majority"?"nearest":"bilinear"}_updateColormapTexture(e){const i=this._colormap,r=this.symbolizerParameters.colormap;return r?i?r.length!==i.length||r.some((s,n)=>s!==i[n])?(this._colormapTexture=ft(this._colormapTexture),this._colormapTexture=Zhe(e,r),void(this._colormap=r)):void 0:(this._colormapTexture=Zhe(e,r),void(this._colormap=r)):(this._colormapTexture=ft(this._colormapTexture),void(this._colormap=null))}},NF=class{constructor(){this.waitingAgents=new li,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const i=qB.acquire();return i._init(e),i}release(){this.dispose(),FF.delete(this),qB.release(this)}dispose(){this.loadingAgent=ft(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=UE(this._data)}static prune(){qB.prune(0)}_init(e){this.waitingAgents.clear(),this._data=UE(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=hd(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){v(this._upsampleInfo)&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,i){if(e===i||C(i))this._unsetUpsampleInfo();else{if(C(this._upsampleInfo))this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===i)return;this._upsampleInfo.tile.unrefMapData()}i.refMapData(),Ibt(e,i,this._upsampleInfo)}}get data(){return this._data}set data(e){UE(this._data),this._data=e}};const qB=new yo(NF,null,()=>{}),FF=new Map;function iwt(){FF.size>0&&(console.log(`${FF.size} live TilePerLayerInfo allocations:`),FF.forEach(t=>console.log(t,`
`)))}let MS=class{constructor(e){this._texture=e,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}};var Dt;(function(t){t[t.NONE=0]="NONE",t[t.NONE_HIT_MAXLOD=1]="NONE_HIT_MAXLOD",t[t.SPLIT=2]="SPLIT",t[t.VSPLITMERGE=4]="VSPLITMERGE",t[t.MERGE=8]="MERGE",t[t.RENDERDATA=16]="RENDERDATA",t[t.GEOMETRY=32]="GEOMETRY",t[t.TEXTURE_NOFADING=64]="TEXTURE_NOFADING",t[t.TEXTURE_FADING=128]="TEXTURE_FADING"})(Dt||(Dt={}));const WB=M(),d2=M(),To=M(),rwt=.1;let Jee=class{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=ci(),this._elevationBounds=et(),this.layerInfo=[[],[]],this.extentInRadians=ci(),this.centerAtSeaLevel=M(),this._center=[M(),gn(),M()],this.up=HY(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=M()}static prune(){Kee.prune(0),Qee.prune(0),NF.prune()}get _isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[on.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){var r;this._dirty=!1;const e=((r=this.parent)==null?void 0:r.frustumVisibility)??xa.INTERSECTS;this._frustumVisibility=e===xa.INSIDE?xa.INSIDE:e===xa.OUTSIDE?xa.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const i=this._frustumVisibility!==xa.OUTSIDE&&this._intersectsClippingArea;i!==this._visible&&(this._visible=i,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}get shouldLoad(){const e=this._surface.snapLevel;if(v(e)){const i=this.level-e;if(i===0)return!0;if(i===1)return!1}return this.isLeaf}init(e,i,r){this.lij[0]=e[0],this.lij[1]=e[1],this.lij[2]=e[2],this.ellipsoid=tr(r.tilingScheme.spatialReference),r.tilingScheme.getExtent(e[0],e[1],e[2],this.extent),r.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,r.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[on.MIDDLE][3]=0,this.vlevel=e?e[0]:0,i&&i.elevationBounds?Fn(this._elevationBounds,i.elevationBounds):It(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=i,this.unsetChildren(),this._surface=r,this.updateVisibility();for(const s of hw){const n=r.numLayers(s),o=this.layerInfo[s];for(const a of o)a.release();o.length=n;for(let a=0;a<n;a++)o[a]=NF.acquire(this._surface.upsampleInfoPool),s===Ti.ELEVATION&&this.findElevationBoundsForLayer(a,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(r.tilingScheme.pixelSize,FR)}release(){cm(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of hw){for(const i of this.layerInfo[e])i.release();this.layerInfo[e].length=0}this._parent=null;for(let e=0;e<4;++e)this._children[e]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const e=this._cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[Ti.MAP].reduce((e,i)=>e+(i instanceof HB?i.memoryUsage:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const i=this._surface.tilingScheme.pixelSize;return i*i*4}_ensureUsedMemory(){if(v(this._usedMemory))return this._usedMemory;this._usedMemory=0,this._mapTileMemoryInternal=0;let e=0;for(const{data:r}of this.layerInfo[Ti.MAP])r instanceof HB?e+=this._getTerrainDataMemory(r):this._mapTileMemoryInternal+=this._getTerrainDataMemory(r);const i=this._cpuImageMemorySize;for(const r of this.layerInfo[Ti.ELEVATION])this._usedMemory+=r.data?i:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=Gx(this.renderData.textureDescriptor)),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+e),this._usedMemory}getUsedMemoryForLayer(e,i){const r=this.layerInfo[e][i];return r!=null&&r.data?e===Ti.MAP?this._isCached?0:this._getTerrainDataMemory(r.data):e===Ti.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return e instanceof MS?Gx(e.texture):e instanceof HTMLImageElement||e instanceof q8?this._cpuImageMemorySize:e instanceof HB||e instanceof twt?e.memoryUsage:0}updateScreenDepth(e){const i=this._center[on.MIDDLE],r=e,s=i[0],n=i[1],o=i[2],a=r[2]*s+r[6]*n+r[10]*o+r[14];this.screenDepth=a<0?0:a/(r[3]*s+r[7]*n+r[11]*o+r[15])}shouldSplit(e,i,r){if(!this.visible||v(e.frustum)&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(e.frustum)===xa.OUTSIDE))return Dt.NONE;const s=this.level;be(WB,this._center[on.MIDDLE],i);let n=Ea(WB),o=on.MIDDLE;be(d2,this._center[on.TOP],i);const a=Ea(d2);a<n&&(n=a,o=on.TOP),be(d2,this._center[on.BOTTOM],i);const l=Ea(d2);if(l<n&&(n=l,o=on.BOTTOM),this._edgeLen2>n&&s<e.maxLod)return Dt.SPLIT;const c=Math.sqrt(n),h=e.fovX*c*2,p=this._edgeLen/h,f=()=>{const b=s+Math.ceil(-Math.log2(e.relativeWidthLimit/p));return b!==this.vlevel?(this.vlevel=b,Dt.VSPLITMERGE):Dt.NONE_HIT_MAXLOD};if(v(r)&&r-s===1)return s>=e.maxLod?f():Dt.SPLIT;const m=Ae(this.up,WB),y=this._elevationBounds[1]-this._elevationBounds[0],_=y/this.edgeLen;if(e.aboveGround&&m>0&&_<.001&&m/c-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-_>0)return Dt.NONE;if(p<e.relativeWidthLimit)return this.vlevel!==this.level?(this.vlevel=this.level,Dt.VSPLITMERGE):Dt.NONE;if(s>=e.maxLod)return f();if(s>6){be(d2,this._center[o],i),ue(To,this.up,m),be(To,To,d2);const b=Ea(To);if(b>this.radius*this.radius){ue(To,To,this.radius/Math.sqrt(b)),ve(To,To,this._center[o]),be(To,i,To);const w=Math.min(1,(Math.abs(Ae(To,this.up))+.5*y+this._curvatureHeight)/je(To)),S=rwt/e.angledSplitBias,T=e.fovY*c*2;if(w*(this._edgeLen/T)<S*e.relativeHeightLimit)return Dt.NONE}}return Dt.SPLIT}setChildren(e,i,r,s){cm(!!(e&&i&&r&&s),"Null child passed"),this._children[0]=e,this._children[1]=i,this._children[2]=r,this._children[3]=s}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var e;return((e=this.renderData)==null?void 0:e.hasGeometry)??!1}load(){this.refMapData();for(const e of hw)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(e){e.unloadTile(this);for(const i of hw){const r=this.layerInfo[i];for(const s of r)s.loadingAgent&&s.loadingAgent!==vc&&(xD(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(Dt.GEOMETRY),this.resetPendingUpdate(Dt.TEXTURE_NOFADING),this.resetPendingUpdate(Dt.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[Ti.MAP];for(const i of e)i.loadingAgent&&i.loadingAgent!==vc&&(xD(i.loadingAgent),i.loadingAgent=null),i.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(sx(e,this._clippingArea))return!1;const i=this._intersectsClippingArea,r=this._isWithinClippingArea;v(e)?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const s=r&&this._isWithinClippingArea,n=!(r||i||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(Dt.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,i){return this.layerInfo[i][e]}hasLayerData(e,i){const r=this.layerInfo[i][e];return!(!r||!r.data||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of hw){const i=this.layerInfo[e];for(const r of i)if(r.loadingAgent&&r.loadingAgent!==vc&&r.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(Dt.SPLIT)||e!==Ti.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){this._pendingUpdates|=e,e===Dt.SPLIT||e===Dt.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,i,r){const s=this.layerInfo[i][e];if(s.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,e),!0;if(s.waitingAgents.push(r),s.data&&!s.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,e),r.dataArrived(this),!0;if(s.requestPromise)return!0;hd(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,e,i,s.requestAbort);if(!n)return s.requestAbort=null,!1;const o=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(e){return this.lij[0]===e[0]&&this.lij[1]===e[1]&&this.lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const i=this._children;return i[0]?i[0].findByLij(e)||i[1].findByLij(e)||i[2].findByLij(e)||i[3].findByLij(e):null}distanceToSquared(e){return Ea(be(To,this._center[on.MIDDLE],e))}containsPoint(e){const i=this.extent;return e[0]>=i[0]&&e[1]>=i[1]&&e[0]<=i[2]&&e[1]<=i[3]}containsPointXY(e,i){const r=this.extent;return e>=r[0]&&i>=r[1]&&e<=r[2]&&i<=r[3]}unrequestLayerData(e,i,r){const s=this.layerInfo[i][e],n=s.waitingAgents,o=n.removeUnordered(r)!=null;cm(o,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(e,i,r){const s=this.layerInfo[i][e];s.data=r,s.dataInvalidated=!1,s.waitingAgents.forAll(n=>n.dataArrived(this)),s.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,i,r){r.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${i}/${e} error ${r}`);const s=this.layerInfo[i][e];s.dataMissing=!0,s.waitingAgents.forAll(n=>n.dataMissing()),s.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,i){switch(e){case Ti.MAP:return this._updateTexture(i);case Ti.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===On.FADING?Dt.TEXTURE_NOFADING:Dt.TEXTURE_FADING),this.setPendingUpdate(e===On.FADING?Dt.TEXTURE_FADING:Dt.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(Dt.GEOMETRY);for(const e of this.layerInfo[Ti.ELEVATION])e.pendingUpdates|=Dt.GEOMETRY}invalidateLayerData(e,i){this.layerInfo[i][e].invalidateSourceData(),this.restartAgents(i)}computeElevationBounds(){const e=this._elevationBounds,i=e[0],r=e[1];It(e,1/0,-1/0);const s=this.layerInfo[Ti.ELEVATION];let n=!0;for(const o of s)v(o.elevationBounds)&&(e[0]=Math.min(e[0],o.elevationBounds.min),e[1]=Math.max(e[1],o.elevationBounds.max),o.elevationBounds.hasNoDataValues||(n=!1));n&&(e[0]=Math.min(e[0],0),e[1]=Math.max(e[1],0)),i===e[0]&&r===e[1]||(this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBounds,i=.5*(e[0]+e[1]),r=this._center;ue(To,this.up,i),ve(r[on.MIDDLE],this.centerAtSeaLevel,To),ue(To,this.up,e[0]),ve(r[on.TOP],this.centerAtSeaLevel,To),ue(To,this.up,e[1]),ve(r[on.BOTTOM],this.centerAtSeaLevel,To)}findElevationBoundsForLayer(e,i){const r=this.layerInfo[Ti.ELEVATION][e],s=lq(this.level),n=Math.max(this.vlevel-s,0),o=r.elevationBounds;if(v(o)&&o.level>=i&&o.level<=n)return;const a=this._surface.layerViewByIndex(e,Ti.ELEVATION),l=bX(a);if(!g3(this,l,!1))return;const c=nwt;let h=!1;const p=r.data;if(p&&p.level<=n){const f=r.data;c.min=f.samplerData.data.minValue,c.max=f.samplerData.data.maxValue,c.hasNoDataValues=f.samplerData.data.hasNoDataValues,c.level=this.level,h=!0}else{let f,m,y=0;for(let _=this._parent;_&&(!m||y<s)&&(y=this.vlevel-_.level,f=m||f,m=_.layerInfo[Ti.ELEVATION][e].data,!(!m&&f&&_.level<=n));_=_.parent);m=m||f,m&&(m.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],c),c.min!==1/0&&(c.level=m.level,h=!0))}h&&(C(r.elevationBounds)&&(r.elevationBounds=new oE),r.elevationBounds.copyFrom(c))}modifyLayers(e,i,r){const s=this.layerInfo[r];for(const a of s)a.loadingAgent&&a.loadingAgent!==vc&&(xD(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)e[a]===void 0&&s[a].release();const n=new Array(...s),o=i.length;s.length=o;for(let a=0;a<o;a++){const l=i[a];s[a]=l>-1?n[l]:NF.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,On.FADING))}updateAgents(e){if(this.renderData){const i=this.layerInfo[e];for(const r of i)r.loadingAgent===vc&&(r.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of hw){const i=this._isSuspended(e);for(const r of this.layerInfo[e])r.loadingAgent&&r.loadingAgent!==vc&&(r.loadingAgent.setSuspension(i),r.loadingAgent===vc&&this.updateRenderData(e,On.FADING))}}removeLayerAgent(e,i){const r=this.layerInfo[i][e];r.loadingAgent&&r.loadingAgent!==vc&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(e,i){const r=this.layerInfo[i][e];r.loadingAgent=vc,!r.data&&C(r.upsampleInfo)&&this._createOrUpdateAgents(e+1,i)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||fC(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,i,r){var s,n,o;for(let a=e;a<i;++a){const l=this._surface.layerViewByIndex(a,r);if(l6(l)&&((s=l==null?void 0:l.layer)==null?void 0:s.blendMode)!=="normal"||fC((n=l==null?void 0:l.layer)==null?void 0:n.parent)&&this._hasBlendableAncestor((o=l==null?void 0:l.layer)==null?void 0:o.parent))return!0}return!1}_createOrUpdateAgents(e,i){const r=this.layerInfo[i];if(r.length===0)return;const s=this._isSuspended(i);for(let n=e;n<r.length;++n){const o=r[n];let a=!1;const l=this._surface.layerViewByIndex(n,i),c=bX(l);if(o.loadingAgent?g3(this,c,!1)?(o.loadingAgent!==vc&&o.loadingAgent.setSuspension(s),o.loadingAgent!==vc&&(a=o.loadingAgent.update())):o.dispose():g3(this,c,!1)&&(o.loadingAgent=swt(this,n,i,s),a=o.loadingAgent.startLoading(),a?o.loadingAgent===vc&&this.setPendingUpdate(Dt.GEOMETRY):(xD(o.loadingAgent),o.loadingAgent=vc)),o.loadingAgent===vc&&this.updateRenderData(i,On.FADING),!this._hasBlendModes(e,r.length,i)&&a&&l.isOpaque)return}}_isWithinExtent(e){const i=this.extent;return i[0]>=e[0]&&e[2]>=i[2]&&i[1]>=e[1]&&e[3]>=i[3]}intersectsExtent(e){const i=this.extent;return i[2]>=e[0]&&e[2]>=i[0]&&i[3]>=e[1]&&e[3]>=i[1]}getElevationVerticesPerSide(e){const i=this.vlevel-this.level,r=Math.max(this.level-e,lq(this.level)-i),s=we(1+(this.maxTesselation>>r),2,this.maxTesselation+1),n=this.getDefaultVerticesPerSide();return Math.max(s,n)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(e,i){if(!e)return null;const r=this.surface.rootTiles;if(v(r)){for(const s of r)if(owt(s,e)){let n=s,o=e[0]-n.level-1;for(;o>=0&&!n.isLeaf&&!i(n);){const a=e[1]>>o&1,l=e[2]>>o&1;n=n.children[2*a+l],o--}return i(n)?n:null}}return null}findNeighborTile(e,i){const r=this.lij,s=this.getNeighborLIJ(r,e);return s?awt(r,s)?i(this)?this:null:this._findLIJ(s,i):null}findCorner(e,i){const r=e===Vt.NORTH_EAST?1:e===Vt.NORTH_WEST?0:e===Vt.SOUTH_WEST?2:3;let s=this;for(;s.children[0]&&(!i||!i(s));)s=s.children[r];return s}findNeighborCornerTileExact(e,i){var r;return((r=this.findNeighborTile(e,s=>i(s)||s.level===this.level))==null?void 0:r.findCorner(TX(e),i))||null}forAllSubtreeOnSide(e,i){const r=e===Vt.NORTH?[0,1]:e===Vt.NORTH_EAST?[1]:e===Vt.EAST?[1,3]:e===Vt.SOUTH_EAST?[3]:e===Vt.SOUTH?[2,3]:e===Vt.SOUTH_WEST?[2]:e===Vt.WEST?[0,2]:[0],s=n=>{const o=n.children;!i(n)&&o[0]&&r.forEach(a=>s(o[a]))};s(this)}forallNeighbors(e){u6.forEach(i=>this.findNeighborCornerTileExact(i,e)),Tm.forEach(i=>{var r;return(r=this.findNeighborTile(i,s=>s.level===this.level||e(s)))==null?void 0:r.forAllSubtreeOnSide(c6(i),e)})}getNeighborEdgeStartVertexIndex(e,i){if(!i)return 0;const r=this.level-i.level;if(Be(!Ln||r>=0),r===0)return 0;const s=2**r,n=(1&e)==1,o=n?0:1,a=i.lij[o+1]*s,l=this.lij[o+1],c=l-a,h=n?s-1-c:c;return Ln&&(Be(a<=l&&l<a+s),Be(0<=h&&h<s)),h}forEachLoadedNeighbor(e){const i=this.level,r=s=>s.level===i||s.isLoaded;Tm.forEach(s=>{const n=this.findNeighborTile(s,r);n!=null&&n!==this&&n.forAllSubtreeOnSide(c6(s),o=>!!o.isLoaded&&(e(o,s),!0))}),u6.forEach(s=>{var o;const n=(o=this.findNeighborTile(s,r))==null?void 0:o.findCorner(TX(s),a=>a.isLoaded);Be(!n||OX(this,n,s)),n!=null&&n.isLoaded&&e(n,s)})}getNeighborLIJ(e,i){const r=Fhe(i)?-1:Nhe(i)?1:0,s=Lhe(i)?-1:Dhe(i)?1:0,n=[e[0],e[1]+r,e[2]+s];return n[1]<0?null:this.surface.isGlobal?this.wrapLIJ(n):n[2]<0?null:n}wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){return this.extent[1]+Fa()>=this.surface.extent[1]}checkGeometryWaterproofness(){var e;o6&&(Be(this.isLoaded),(e=this.renderData)==null||e.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const i=this.extent,r=this.surface.rootTilesExtent,s=.25*(i[2]-i[0]);if(Fhe(e)&&i[3]+s>=r[3]||Nhe(e)&&i[1]-s<=r[1])return!1;const n=this.surface.isGlobal;return!(!n&&Lhe(e)&&i[0]-s<=r[0])&&!(!n&&Dhe(e)&&i[2]+s>=r[2])}updateDistanceToPOI(e){const i=this._lastPOI;if(this.distanceToPOI>=0&&i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2])return;he(this._lastPOI,e);const r=this._center[on.MIDDLE],s=e[0]-r[0],n=e[1]-r[1],o=e[2]-r[2];this.distanceToPOI=s*s+n*n+o*o}};function swt(t,e,i,r){const s=i===Ti.ELEVATION?Qee.acquire():Kee.acquire();return s.init(t,e,i,r),s}function xD(t){t.dispose(),t instanceof NMe?Qee.release(t):t instanceof FMe&&Kee.release(t)}const Kee=new yo(FMe),Qee=new yo(NMe),nwt=new oE;var on;function owt(t,e){const i=t.level,r=e[0];if(i>r)return!1;const s=r-i,n=Math.floor(e[1]/2**s),o=Math.floor(e[2]/2**s);return n===t.lij[1]&&o===t.lij[2]}function awt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function lwt(t,e,i){if(C(t)||C(e))return!1;if(t.level===0&&e.level===0&&(t.isEastEnd&&e.isWestEnd&&i===Vt.EAST||t.isWestEnd&&e.isEastEnd&&i===Vt.WEST))return!0;const r=Math.max(1e-6*(t.extent[2]-t.extent[0]),1);switch(i){case Vt.NORTH:return Zh(t.extent[3],e.extent[1],r);case Vt.SOUTH:return Zh(t.extent[1],e.extent[3],r);case Vt.EAST:return Zh(t.extent[2],e.extent[0],r)||Zh(t.extent[2],-e.extent[0],r);case Vt.WEST:return Zh(t.extent[0],e.extent[2],r)||Zh(t.extent[0],-e.extent[2],r)}}function OX(t,e,i){return!C(t)&&!C(e)&&e!==t&&(t.level>=e.level?Khe(t,e,i):Khe(e,t,TX(i)))}function Khe(t,e,i){Be(t.level>=e.level);const r=E1t(i),s=C1t(i),n=t.extent,o=e.extent,a=[r?n[0]:n[2],s?n[3]:n[1]],l=[r?o[2]:o[0],s?o[1]:o[3]],c=1e-5*(n[2]-n[0]),h=Zh(a[0],l[0],c)||t.surface.isGlobal&&Zh(a[0],-l[0],c),p=Zh(a[1],l[1],c);if(h&&p)return!0;if(t.level===e.level||!h&&!p)return Be(!1),!1;const f=h?Qhe(o[1],o[3],n[1],n[3],c):Qhe(o[0],o[2],n[0],n[2],c);return Be(f),f}function Qhe(t,e,i,r,s=Fa()){return t-s<=i&&i<=r&&r<=e+s}(function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"})(on||(on={}));let cwt=class{constructor(){this._scales=si(-1,-1,-1,-1),this._offsets=si(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,i,r){this._scales[2*e]=i,this._scales[2*e+1]=r}setOffset(e,i,r){this._offsets[2*e]=i,this._offsets[2*e+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}};function uwt(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(x`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(x`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(x`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}let ete=class extends EOe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=M(),this.origin=this.slicePlaneLocalOrigin}};var Hc;(function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight"})(Hc||(Hc={}));let hwt=class extends ete{constructor(){super(...arguments),this.identifier=Hc.Material,this.output=k.Color,this.transparent=!1,this.integratedMesh=!1}},dwt=class extends ete{constructor(){super(...arguments),this.identifier=Hc.ShadowMap}},pwt=class extends ete{constructor(){super(...arguments),this.identifier=Hc.Highlight}},h6=class extends Os{constructor(e,i){super(e,"vec4",gr.Draw,(r,s,n)=>r.setUniform4fv(e,i(s,n)))}};var Ny;function fwt(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add([new h6("overlayTexOffset",(s,n)=>mwt(s,n)),new h6("overlayTexScale",(s,n)=>gwt(s,n))]),r.constants.add("overlayOpacity","float",1),r.uniforms.add(new zt("ovColorTex",(s,n)=>RX(s,n))),BMe(t,e)}function BMe(t,e){t.extensions.add("GL_OES_standard_derivatives"),e.pbrMode!==St.Water&&e.pbrMode!==St.WaterOnIntegratedMesh&&e.pbrMode!==St.TerrainWithWater||t.include(MOe,e);const{vertex:i,fragment:r}=t;t.varyings.add("vtcOverlay","vec4"),i.code.add(x`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),r.code.add(x`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),r.code.add(x`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),r.code.add(x`
    vec4 getOverlayColorTexel(vec4 texCoords) {
          vec2 texDim =  ${ad(e,"ovColorTex")};

          vec4 color0 = ${hl(e,"ovColorTex","vec2(texCoords.x * 0.5, texCoords.y)*texDim")};
          vec4 color1 = ${hl(e,"ovColorTex","vec2(texCoords.z * 0.5 + 0.5, texCoords.w)*texDim")};

          bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
          bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));

          return mix(color1 * float(isValid1), color0, float(isValid0));
    }
  `),e.pbrMode!==St.Water&&e.pbrMode!==St.WaterOnIntegratedMesh&&e.pbrMode!==St.TerrainWithWater||(l0(r),rg(r),r.code.add(x`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function RX(t,e){return e.overlays.length===0?null:t.identifier===Hc.Material&&t.output===k.Color?e.overlays[os.INNER].getColorTextureNoRasterImage():t.identifier===Hc.Material&&t.output===k.ObjectAndLayerIdColor?e.overlays[os.INNER].getColorTexture(Zl.ObjectAndLayerIdColor):t.identifier===Hc.Highlight?e.overlays[os.INNER].getValidTexture(ws.Highlight):null}function mwt(t,e){for(const i of e.overlays){const{index:r,extent:s}=i;Yye(s)>0&&(VE[2*r]=t.toMapSpace[0]/zu(s)-s[0]/zu(s),VE[2*r+1]=t.toMapSpace[1]/Zp(s)-s[1]/Zp(s))}return VE}function gwt(t,e){for(const i of e.overlays){const{index:r,extent:s}=i;Yye(s)>0&&(VE[2*r]=t.toMapSpace[2]/zu(s),VE[2*r+1]=t.toMapSpace[3]/Zp(s))}return VE}(function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.EnabledWithWater=2]="EnabledWithWater",t[t.COUNT=3]="COUNT"})(Ny||(Ny={}));const VE=fi();var Sm;(function(t){t[t.LayerOnly=0]="LayerOnly",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.COUNT=3]="COUNT"})(Sm||(Sm={}));let ywt=class extends yr{constructor(){super(...arguments),this.overlayOpacity=1}};function IO(t,e){t.vertex.uniforms.add([new d6("overlayTexOffset"),new d6("overlayTexScale")]),t.fragment.uniforms.add([new He("overlayOpacity",i=>i.overlayOpacity),new zt("ovColorTex",(i,r)=>r.overlays.length===0?null:r.overlays[os.INNER].getColorTexture(i.overlaySource))]),BMe(t,e)}function _wt(t,e){const{vertex:i,fragment:r,varyings:s}=t;s.add("vtc","vec2"),i.uniforms.add(new d6("texOffsetAndScale")),r.uniforms.add(new ede("tex")),r.uniforms.add(new XB("textureOpacities"));const n=e.textureFadingEnabled&&!e.renderOccluded;n&&(i.uniforms.add(new d6("nextTexOffsetAndScale")),s.add("nvtc","vec2"),r.uniforms.add(new ede("texNext")),r.uniforms.add(new XB("nextTexOpacities")),r.uniforms.add(new vwt("fadeFactor")));const o=e.tileBlendInput===Sm.ColorComposite,a=e.tileBlendInput===Sm.GridComposite;a&&r.include(Zee),o&&r.uniforms.add(new XB("backgroundColor")),i.code.add(x`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${n?x`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:x``}
  }`),r.code.add(x`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${a||o?x`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${o?x`backgroundColor`:x`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:x`return color;`}
    }`),n?r.code.add(x`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):r.code.add(x`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`)}let vwt=class extends Os{constructor(e){super(e,"float")}},XB=class extends Os{constructor(e){super(e,"vec3")}},d6=class extends Os{constructor(e){super(e,"vec4")}},ede=class extends Os{constructor(e){super(e,"sampler2D")}},zMe=class extends ywt{};function bwt(t){const e=new Ui,{vertex:i,fragment:r,varyings:s}=e;e.include(TI),e.include(NI,t),e.include(Im,t);const n=()=>{e.include(AP,t),i.code.add(x`
      vec3 decodeNormalTerrain(vec2 e) {
        float z = 1.0 - abs(e.x) - abs(e.y);
        vec3 n = vec3(e + vec2(e.x >= 0.0 ? 1.0 : -1.0, e.y >= 0.0 ? 1.0 : -1.0) * min(z,0.0),z);
        return normalize(n);
      }

      vec3 getNormal() {
        return  ${t.shading?x`decodeNormalTerrain(normalCompressed)`:x`getLocalUp(position, localOrigin)`};
      }
  `)};Kc(i,t),e.include(nc,t);const o=t.overlayMode!==Ny.Disabled;switch(t.output){case k.Color:{e.include(_wt,t),e.include(Kx,t),o&&e.include(IO,{...t,pbrMode:t.pbrMode===St.Terrain?St.TerrainWithWater:St.Water});const a=t.overlayMode===Ny.EnabledWithWater;a&&e.include(uwt,t),s.add("vnormal","vec3"),s.add("vpos","vec3"),s.add("vup","vec3"),n(),(t.atmosphere||t.screenSizePerspective)&&DC(i);const l=t.receiveShadows&&!t.renderOccluded;l&&e.include(yA,t),t.atmosphere&&s.add("wnormal","vec3"),t.screenSizePerspective&&(s.add("screenSizeDistanceToCamera","float"),s.add("screenSizeCosAngle","float")),i.code.add(x`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${a?x`forwardVertexTangent(vnormal);`:x``}

          ${t.atmosphere?x`wnormal = normalize((viewNormal * vec4(normalize(positionWorld), 1.0)).xyz);`:""}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${o?x`setOverlayVTC(uv);`:""}
          ${t.tileBorders?x`forwardTextureCoordinates();`:""}

          ${t.screenSizePerspective?x`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${l?x`forwardLinearDepth();`:""}

        }
      `),e.extensions.add("GL_OES_standard_derivatives"),e.extensions.add("GL_EXT_shader_texture_lod"),e.include(en,t),e.include(Kx,t),e.include(UI,t),e.include(Jx,t),rf(r,t),VI(r),OA(r),r.uniforms.add([i.uniforms.get("localOrigin"),new ni("viewDirection",(c,h)=>Oe(tde,fe(tde,h.camera.viewMatrix[12],h.camera.viewMatrix[13],h.camera.viewMatrix[14])))]),a&&r.uniforms.add([new zt("ovWaterTex",(c,h)=>h.overlays.length===0?null:h.overlays[os.INNER].getNormalTexture(c.overlaySource)),new xCe("view",(c,h)=>hc(wwt,h.camera.viewMatrix,c.origin))]),r.code.add(x`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),l0(r),rg(r),r.code.add(x`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${t.receiveShadows&&!t.renderOccluded?"readShadowMap(vpos, linearDepth)":t.spherical&&t.shading?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${o?x`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${t.invisible?x`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }
          ${t.atmosphere?x`
              float ndotl = clamp(vndl, 0.0, 1.0);
              vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
              atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); // avoid atmosphere on bright base maps
              atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
              atm *= tileColor.a; // premultiply with tile alpha`:""}

          vec3 albedo = ${t.atmosphere?x`atm + tileColor.rgb;`:x`tileColor.rgb;`}

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${t.pbrMode===St.Terrain||t.pbrMode===St.TerrainWithWater?x`gl_FragColor = vec4(evaluateTerrainLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:x`gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${a?x`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${t.screenSizePerspective?x`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${t.visualizeNormals?t.spherical?x`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  gl_FragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:x`
                  vec3 tNormal = normalize(normal);
                  gl_FragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${t.tileBorders?x`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          gl_FragColor = highlightSlice(gl_FragColor, vpos);
        }
      `)}break;case k.Depth:o&&e.include(IO,t),e.include(Qy,t),s1(e),Hx(e),i.code.add(x`
              void main(void) {
                ${o?x`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `),r.code.add(x`
              void main() {
                ${o&&t.invisible?x`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case k.Shadow:case k.ShadowHighlight:case k.ShadowExcludeHighlight:e.include(Qy,t),s1(e),Hx(e),i.code.add(x`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),r.code.add(x`void main() {
outputDepth(linearDepth);
}`);break;case k.Normal:o&&e.include(IO,t),s.add("vnormal","vec3"),DC(i),n(),i.code.add(x`
            void main(void) {
              ${o?x`setOverlayVTC(getUV0());`:""}
              gl_Position = transformPosition(proj, view, position);
              vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
            }
        `),r.code.add(x`
            void main() {
              ${o&&t.invisible?x`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              vec3 normal = normalize(vnormal);
              if (gl_FrontFacing == false) {
                normal = -normal;
              }
              gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
            }
        `);break;case k.Highlight:o&&e.include(IO,t),i.code.add(x`
          void main() {
            ${o?x`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),e.include(g0,t),r.code.add(x`
          void main() {
            ${o?x`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return t.output===k.ObjectAndLayerIdColor&&(e.include(IO,{...t,pbrMode:St.Disabled}),i.code.add(x`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),r.code.add(x`void main() {
gl_FragColor = getOverlayColorTexel(vtcOverlay);
}`)),e}const wwt=We(),tde=M(),xwt=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:zMe,build:bwt},Symbol.toStringTag,{value:"Module"}));let GMe=class jMe extends ji{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Mt.WEBGL2,i.spherical=e.viewingMode===st.Global}initializeProgram(e){return new ki(e.rctx,jMe.shader.get().build(this.configuration),HMe)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const i=this.configuration,r=i.backfaceCullingEnabled&&!i.renderOccluded;return Qt({blending:i.renderOccluded?of(Ve.ONE,Ve.ONE_MINUS_SRC_ALPHA):null,culling:r?kK:null,depthTest:i.renderOccluded?null:{func:Dr.LESS},depthWrite:i.renderOccluded?null:pc,colorWrite:ui,stencilTest:e?Spt(oc.IntegratedMeshMaskExcluded):null})}getPipelineState(e,i){return this.useStencil?this._stencilPipelineState:super.getPipelineState(e,i)}};GMe.shader=new Vi(xwt,()=>ee(()=>import("./Terrain.glsl-42bdf920.js"),[],import.meta.url));const HMe=new Map([[A.POSITION,0],[A.UV0,1],[A.NORMALCOMPRESSED,2]]);let Twt=class{constructor(){this.geometryInfo=new _bt,this.intersectionData=null,this.geometryState=null,this._textureRef=new IMe(()=>this.tile.surface.textureFadeDuration),this.overlay=new cwt,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._shadingChanged=!1,this._dirtyEdgeResolutions=15,this._dirtyEdges=15,this._dirtyCorners=15}get tile(){return this._tile}init(e){this.clear(),this._tile=e;const i=this.geometryInfo;i.indices=null,i.vertexAttributes=null,$r(i.boundingBox),i.indexCount=0,i.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new Ebt,this.localOrigin=null,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this._wireframeChanged||this._shadingChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),Ln&&this.tile.intersectsClippingArea)for(let i=0;i<4;++i)Be(this.geometryInfo.outerEdges[i].count===this.geometryState.neighborData.edgeResolutions[i]+1)}_calculateEdgeResolution(e,i){var l;const r=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!r.surface.isGlobal){const c=r.surface.extent;if(v(c)&&(e===0&&r.extent[3]>c[3]||e===1&&r.extent[2]>c[2]||e===2&&r.extent[1]<c[1]||e===3&&r.extent[0]<c[0]))return s}const n=r.level,o=Tm[e];if(!i)return Be(C((l=r.surface)==null?void 0:l.rootTiles)||r.surface.updatingRootTiles||!r.shouldHaveNeighbor(o)),s;if(i.isLoaded){const c=i,h=c.renderData.geometryState,p=n-c.level;if(Be(p>=0),p===0){const y=h.numVerticesPerSide-1;return Math.max(y,s)}const f=2**p,m=h.neighborData.edgeResolutions[(e+2)%4]/f;return Math.max(1,m)}Be(!i.isLeaf);let a=s;return i.forAllSubtreeOnSide(c6(o),c=>c===r||(c.isLoaded?(a=Math.max(a,2**(c.level-n)),!0):(Be(!c.isLeaf),!1))),a}updateNeighborData(){var a;const e=this.tile;if(!e.intersectsClippingArea)return;const i=e.renderData.geometryState.neighborData,r=l=>(l.isLoaded||l.level===e.level)&&(l==null?void 0:l.intersectsClippingArea),s=i.edgePeerNeighbors,n=i.edgePeerNeighborSamplerVersions;for(let l=0;l<4;++l){const c=e.findNeighborTile(Tm[l],r),h=Fw(e,c),p=((a=h==null?void 0:h.renderData)==null?void 0:a.geometryState.samplerDataVersion)??-1,f=s[l],m=h!==Fw(e,f),y=n[l]!==p;s[l]=c,(m||y)&&(n[l]=p,this._markEdgeDirty(l));const _=i.edgeResolutions[l],b=this._calculateEdgeResolution(l,c);Be(Yp(b)),Be(b>=1),i.edgeResolutions[l]=b,_!==b&&this._markEdgeResolutionDirty(l)}const o=i.cornerPeerNeighbors;for(let l=0;l<4;++l){const c=e.findNeighborTile(u6[l],r);o[l]=c;const h=Fw(e,s[l]),p=Fw(e,s[(l+1)%4]),f=Fw(e,c);kd[l]=f,kd[(l+1)%4]=p,kd[(l+2)%4]=e,kd[(l+3)%4]=h,Be(kd.some(b=>(b==null?void 0:b.isLoaded)||b===e));const m=kd.reduce((b,w)=>Math.min(b,(w==null?void 0:w.level)??1/0),1/0);kd.forEach((b,w)=>{b&&(b==null?void 0:b.level)>m&&(kd[w]=null)}),Be(kd.some(b=>(b==null?void 0:b.isLoaded)||b===e));const y=i.cornerNeighborData[l].cornerTiles,_=i.cornerNeighborData[l].cornerTileSamplerVersions;for(let b=0;b<4;++b){const w=kd[b],S=(w==null?void 0:w.renderData.geometryState.samplerDataVersion)??-1,T=y[b]!==w,E=!T&&_[b]!==S;(T||E)&&(y[b]=w,_[b]=S,this._markCornerDirty(l))}Be(y.some(b=>(b==null?void 0:b.isLoaded)||b===e))}Ln&&Be(this.geometryState.neighborData.edgeResolutions.every(l=>l>0));for(let l=0;l<4;++l)kd[l]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;Ln&&Be(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(l=>l>0)),this.intersectionData=null;const i=this.tile,r=this._vao,s=this.geometryInfo.vertexAttributes,n=!r||!s||this._wireframeChanged||this._shadingChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._dirtyEdgeResolutions,o=!n&&(this._dirtyEdges!==0||this._dirtyEdgeResolutions!==0),a=!o&&this._dirtyCorners!==0;n?(this.releaseGeometry(),this._createGeometry(e)):o||a?i.updateEdgeElevations():a?i.updateCornerElevations():console.warn("Update for no reason?"),this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._dirtyEdgeResolutions=0,this._dirtyEdges=0,this._dirtyCorners=0,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._shadingChanged=!1}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao.dispose(),this._vao=null,wbt(this.geometryInfo),!0)}ensureTexture(e,i){return v(this._texture)&&this._texture.descriptor.width!==e&&this.releaseTexture(),C(this._texture)&&(this._texture=i(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){v(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}_markCornerDirty(e){const i=1<<e;this._dirtyCorners|=i}_markEdgeDirty(e){const i=1<<e;this._dirtyEdges|=i}_markEdgeResolutionDirty(e){const i=1<<e;this._dirtyEdgeResolutions|=i,this._dirtyEdges|=i}_markAllEdgesAndCornersDirty(){this._dirtyCorners=15,this._dirtyEdges=15,this._dirtyEdgeResolutions=15}updateGeometryState(){const e=this._getElevationInfo(),i=this.tile,r=e.samplerData?i.getElevationVerticesPerSide(e.maxTileLevel):i.getDefaultVerticesPerSide(),s=Math.max(r,5);let n=i.clippingArea;i.intersectsClippingArea&&!i.isWithinClippingArea||(n=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==s&&(this._numVerticesPerSideChanged=!0,o.numVerticesPerSide=s,o.samplerDataVersion++,a=!0),e.changed&&(this._samplerDataChanged=!0,o.samplerData=e.samplerData,o.samplerDataVersion++,a=!0),Uy(o.clippingArea,n)||(this._clippingAreaChanged=!0,o.clippingArea=n,a=!0);const l=i.surface,c=l.wireframe;o.wireframe!==c&&(this._wireframeChanged=!0,o.wireframe=c,a=!0);const h=l.shading;return o.shading!==h&&(this._shadingChanged=h,o.shading=h,a=h),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const i=this.geometryInfo.vertexAttributes,r=this.geometryInfo.indices,s=e.gl;this._vao=new af(e,HMe,{geometry:au(i.layout)},{geometry:Yi.createVertex(e,s.STATIC_DRAW,i.buffer)},Yi.createIndex(e,s.STATIC_DRAW,r)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,i=Ly.Immediate){v(e)&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,i)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,i=this.tile.layerInfo[Ti.ELEVATION],r=i.length,s=new Array(r);let n=0,o=0,a=!1;for(let h=0;h<r;h++){const p=i[h];if(v(p.upsampleInfo)){const f=p.upsampleInfo.tile,m=f.layerInfo[Ti.ELEVATION][h].data,y=m&&m.samplerData;e&&e[n]===y||(a=!0),s[n++]=y,o=Math.max(o,f.lij[0])}else if(p.data){const f=this.tile.surface.layerViewByIndex(h,Ti.ELEVATION);if(g3(this.tile,f.layer,!1)){const m=p.data;e&&e[n]===m.samplerData||(a=!0),s[n++]=m.samplerData,o=this.tile.level}}}v(e)&&e.length!==n&&(a=!0);const l=n>0,c=l?s:null;return l&&(s.length=n),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){var i,r;const e=Vu(this.intersectionData,0,s=>s.estimatedMemoryUsage);return(((i=this.geometryInfo.indices)==null?void 0:i.byteLength)??0)+(((r=this.geometryInfo.vertexAttributes)==null?void 0:r.byteLength)??0)+e}get textureDescriptor(){return v(this._texture)?this._texture.descriptor:null}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){if(!Ln)return;const e=this.tile;if(Be(e==null?void 0:e.isLoaded),!e.isLoaded||!e.intersectsClippingArea)return;const i=e.renderData;if(e.level===0)return;const r=e.surface.extent;if(v(r)&&!e.intersectsExtent(r))return;const s=Tm.map((l,c)=>!!v(r)&&(c<2?-1:1)*(e.extent[3-c]-r[3-c])<0),n=e.level;Be(this._dirtyCorners===0),Be(this._dirtyEdges===0),Be(this._dirtyEdgeResolutions===0),Be(!this._numVerticesPerSideChanged),Be(!this._samplerDataChanged),Be(!this._clippingAreaChanged),Be(!this._wireframeChanged);const o=u6.map(l=>e.findNeighborCornerTileExact(l,c=>!c.intersectsClippingArea||c.isLoaded||c.level===e.level)??null).map(l=>l!=null&&l.intersectsClippingArea?l:null),a=this.geometryState.neighborData;for(let l=0;l<4;++l){const c=a.cornerPeerNeighbors[l],h=o[l];Be(h===c,`Tile[${e.lij}].corner[${l}] out of date: cur=[${c==null?void 0:c.lij}] exp=[${h==null?void 0:h.lij}]`)}Tm.forEach((l,c)=>{if(s[c])return;const h=e.findNeighborTile(l,N=>(N.level===n||(N==null?void 0:N.isLoaded))&&(N==null?void 0:N.intersectsClippingArea));if(!h){const N=!e.surface.updatingRootTiles&&v(e.surface.rootTiles)&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(l);return void Be(!N)}Be(h.isLoaded||h.level===e.level),Be(h===this.geometryState.neighborData.edgePeerNeighbors[c]);const p=n-h.level;if(!h.isLoaded)return Be(!h.isLeaf),void Be(p===0);const f=h.renderData;Be(lwt(e,h,l)),Be(p>=0);const m=2**p;if(p<0)return void Be(!1);const y=i.geometryInfo,_=y.outerEdges[c],b=y.numVerticesPerSide-1,w=f.geometryInfo;if(!w)return void Be(!1);{const N=this.geometryState.neighborData.edgePeerNeighbors[c];if(N!=null&&N.isLoaded){const U=N.renderData;Be(N==N),Be(i.geometryState.neighborData.edgePeerNeighborSamplerVersions[c]===U.geometryState.samplerDataVersion),Be(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[c]===U.geometryState.samplerDataVersion)}}const S=(c+2)%4,T=w.outerEdges[S],E=_.count-1,O=T.count-1;Be(E*m===O,`Tile[${e.lij}]:e${c},res=${E} edgeRes mismatch with Neighbor[${h.lij}]:e${S},res=${O} (expected:${E*m})`);const R=e.extent,L=l===Vt.NORTH||l===Vt.SOUTH,P=T.count-1,F=P/2**p,V=_.count-1;if(F<1)return void Be(V===1);Be(F===V),Be(Yp(F));const B=w.numVerticesPerSide-1;Be(p>0||F===Math.max(B,b));const G=e.getNeighborEdgeStartVertexIndex(c,h);Be(0<=G&&G<m);const te=G*F;Be(0<=te&&te<=P-F);let se=0,ie=te;_.getVertexPos(Of,0),_.getVertexPos(Rf,_.count-1);const H=Ar(Of,Rf),$=Math.max(Swt,1e-4*H);for(let N=0;N<=F;++N){_.getVertexPos(Of,se),T.getVertexPos(Rf,ie);const U=N/F,q=L?R[0]+U*(R[2]-R[0]):l===Vt.WEST?R[0]:R[2],Y=L?l===Vt.SOUTH?R[1]:R[3]:R[1]+U*(R[3]-R[1]),Q=e.surface.extent;if(C(Q)||tU(Q,q,Y)){const X=XP(Of,Rf),pe=Nc(Of)-Oi.radius,ye=Nc(Rf)-Oi.radius,xe=X<$;if(!xe){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${c}[${se}/${_.count}] and [${h.lij}].edge${S}[${ie}/${T.count}]`),v(Q)&&console.warn("  surface extent= ",Q," x,y=",q,",",Y);const De=M();be(De,i.localOrigin,f.localOrigin),Nc(De)>0&&console.warn(`   localOrigins: ${i.localOrigin} vs ${f.localOrigin} d=${Nc(De)} [${De}]`),(()=>{const rt=xs(Of),qe=xs(Rf);e.updateEdgeElevations(),h.updateEdgeElevations(),_.getVertexPos(Of,se),T.getVertexPos(Rf,ie);const Pe=M();po(Pe,Of,rt),Nc(Pe)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${rt} vs ${Of} d=${Nc(Pe)} [${Pe}]`),po(Pe,Rf,qe),Nc(Pe)>0&&console.warn(`  XXX Neighbor[${h.lij}] edge out of date: ${qe} vs ${Rf} d=${Nc(Pe)} [${Pe}]`)})(),Be(xe,`Mismatch in tile [${e.lij}].edge[${c}][${se}/${_.count}] vs neighbor [${h.lij}].edge[${S}][${ie}/${T.count}] ${Ag(Of)} vs ${Ag(Rf)}  dist=${X} h(t|n|d)=${pe}|${ye}|${ye-pe}`)}if(e.surface.shading){_.getNormal(p2,se),T.getNormal(f2,ie),Oe(ide,p2),Oe(rde,f2);const De=Ae(ide,rde),rt=1-De<.01||!1||e===h;if(!rt){const qe=M();po(qe,p2,f2);const Pe=()=>`Mismatch in tile edge normal ${$he(e.lij)} (${se}/${_.count-1}) edge ${c} vs neighbor ${$he(h.lij)}  (${ie}/${T.count-1}) nedge ${S} :${Ag(p2)} vs ${Ag(f2)}  dot = ${De} : ${Ag(qe)}`;console.warn("Mismatch in tile edge normal: ",Pe());{e.updateEdgeElevations(),h.updateEdgeElevations();const Ye=M(),j=M();_.getNormal(Ye,se),T.getNormal(j,ie),Wv(p2,Ye)||console.warn("Missing update in tile normal: ",Ag(p2)," => ",Ag(Ye)),Wv(f2,j)||console.warn("Missing update in neighbor normal: ",Ag(f2)," => ",Ag(j))}Be(rt,Pe())}}}se+=1,ie+=1}})}};const Of=M(),Rf=M(),p2=M(),f2=M(),ide=M(),rde=M(),Swt=1,kd=[null,null,null,null];function Fw(t,e){return e!=null&&e.isLoaded||e===t?e:null}const Ewt=65536;function Cwt(t,e){const i=t.tile,{extent:r,extentInRadians:s,surface:n}=i,o=t.localOrigin,a=t.geometryState,l=n.isWebMercator,c=n.shading||eT,h=a.numVerticesPerSide,p=h-1,f=(h-2)**2,m=l&&(e===Yh.HAS_SOUTH_POLE||e===Yh.HAS_BOTH_POLES),y=l&&(e===Yh.HAS_NORTH_POLE||e===Yh.HAS_BOTH_POLES),_=6,b=((m?1:0)+(y?1:0))*_*(p+1),w=a.neighborData,S=w.edgeResolutions.reduce((P,F)=>P+F+1,0),T=PMe(f+b+S),E=t.geometryInfo;E.numVerticesPerSide=a.numVerticesPerSide,E.vertexAttributes=T;const O=E.boundingBox;$r(O);const R=tte(t);hn.update(p,s,R),Awt(t),e3e(t,f),qMe(t);const L=[];if((()=>{let P=f+S;const F=o[0],V=o[1],B=o[2],G=i.ellipsoid.radius,te=r[1],se=r[3],ie=(H,$)=>{const N=$*h;pl(-F,-V,H*G-B,O),L.push({connectedRowOffset:N,connectedOuterEdgeOffset:H===1?0:2,rowOffset:P,latitudeResolution:_});const U=YMe(H===-1?te:se,G),q=H*Math.PI/2-U,Y=.99*(H===1?1:-1),Q=G+0,X=T.position,pe=T.uv0,ye=T.normalCompressed;for(let xe=1;xe<=_;++xe){const De=U+q*(xe/_),rt=Math.cos(De),qe=Math.sin(De);for(let Pe=0;Pe<=p;Pe++){const Ye=Pe/p,j=hn.sinLonLUT[Pe],J=hn.cosLonLUT[Pe]*rt,ne=j*rt,ge=qe,_e=J*Q-F,Ce=ne*Q-V,Le=ge*Q-B;pl(_e,Ce,Le,O),X.setValues(P,_e,Ce,Le),Qc(pe,P,Ye,Y),c&&LP(ye,P,J,ne,ge),++P}}};m&&ie(-1,0),y&&ie(1,p)})(),QMe(E,a.numVerticesPerSide,L,[0,h-1],[0,h-1],a.wireframe),t.intersectionData=null,Ln)for(let P=0;P<4;++P)Be(E.outerEdges[P].count===w.edgeResolutions[P]+1)}function Awt(t){const e=t.tile;e.intersectsClippingArea&&(e.surface.shading||eT?Rwt(t):Owt(t))}function Owt(t){const e=t.geometryState,i=e.numVerticesPerSide,r=i-2,s=i-1,n=t.geometryInfo,o=n.vertexAttributes,a=o.position,l=o.uv0,c=t.tile,h=c.extent,p=h[0],f=h[2],m=h[1],y=h[3],_=c.ellipsoid.radius,b=e.samplerData,w=t.localOrigin,S=w[0],T=w[1],E=w[2],O=n.boundingBox,R=a.typedBuffer,L=a.typedBufferStride;let P=0;for(let F=1;F<=r;F++){const V=F/s,B=m*(1-V)+y*V,G=hn.sinLatLUT[F],te=hn.cosLatLUT[F];for(let se=1;se<=r;se++){const ie=se/s,H=p*(1-ie)+f*ie,$=hn.sinLonLUT[se],N=hn.cosLonLUT[se],U=_+Xr(H,B,b),q=N*te*U-S,Y=$*te*U-T,Q=G*U-E;pl(q,Y,Q,O);const X=P*L;R[X]=q,R[X+1]=Y,R[X+2]=Q,Qc(l,P,ie,V),++P}}}function Rwt(t){const e=t.geometryState,i=e.numVerticesPerSide,r=i-2,s=i-1,n=t.geometryInfo,o=n.vertexAttributes,a=o.position,l=o.uv0,c=o.normalCompressed,h=t.tile,p=h.extent,f=p[0],m=p[2],y=p[1],_=p[3],b=h.ellipsoid.radius,w=e.samplerData,S=t.localOrigin,T=S[0],E=S[1],O=S[2],R=a.typedBuffer,L=a.typedBufferStride,P=1/s,F=n.boundingBox;let V=0;if(1<=r){const B=P,G=y*(1-B)+_*B,te=hn.sinLatLUT[1],se=hn.cosLatLUT[1];for(let ie=1;ie<=r;ie++){const H=ie*P,$=f*(1-H)+m*H,N=hn.sinLonLUT[ie],U=hn.cosLonLUT[ie],q=b+Xr($,G,w),Y=q*U*se-T,Q=q*N*se-E,X=q*te-O;pl(Y,Q,X,F);const pe=(ie-1)*L;R[pe]=Y,R[pe+1]=Q,R[pe+2]=X,Qc(l,ie-1,H,B)}}for(let B=1;B<=r;B++){const G=B*P,te=y*(1-G)+_*G,se=hn.sinLatLUT[B],ie=hn.cosLatLUT[B],H=B+1,$=H*P,N=y*(1-$)+_*$,U=hn.sinLatLUT[H],q=hn.cosLatLUT[H],Y=hn.sinLonLUT[0],Q=hn.cosLonLUT[0],X=b+Xr(f,te,w);let pe=Q*ie*X-T,ye=Y*ie*X-E,xe=se*X-O;const De=V*L;let rt=R[De],qe=R[De+1],Pe=R[De+2];for(let Ye=1;Ye<=r;Ye++){const j=Ye*P,J=f*(1-j)+m*j,ne=hn.sinLonLUT[Ye],ge=hn.cosLonLUT[Ye];let _e=ge*ie,Ce=ne*ie,Le=se,Re=0,Ue=0,Te=0;{let Se=0,Ee=0,Ne=0;if(Ye<r){const Ft=(V+1)*L;Se=R[Ft],Ee=R[Ft+1],Ne=R[Ft+2]}else{const Ft=hn.sinLonLUT[s],ti=hn.cosLonLUT[s],yi=b+Xr(m,te,w);Se=ti*ie*yi-T,Ee=Ft*ie*yi-E,Ne=se*yi-O}const Ge=pe,tt=ye,dt=xe;pe=rt,ye=qe,xe=Pe,rt=Se,qe=Ee,Pe=Ne,Re=Se-Ge,Ue=Ee-tt,Te=Ne-dt}{let Se=0,Ee=0,Ne=0;if(B>1){const Ge=(V-r)*L;Se=R[Ge],Ee=R[Ge+1],Ne=R[Ge+2]}else{const Ge=hn.sinLatLUT[0],tt=hn.cosLatLUT[0],dt=b+Xr(J,y,w);Se=ge*tt*dt-T,Ee=ne*tt*dt-E,Ne=Ge*dt-O}{const Ge=b+Xr(J,N,w),tt=ge*q*Ge-T,dt=ne*q*Ge-E,Ft=U*Ge-O;if(B<r){const Qi=V+r,ri=Qi*L;R[ri]=tt,R[ri+1]=dt,R[ri+2]=Ft,pl(tt,dt,Ft,F),Qc(l,Qi,j,$)}const ti=Se-tt,yi=Ee-dt,Ri=Ne-Ft;Le*Le<.999&&(_e=Te*yi-Ue*Ri,Ce=Re*Ri-Te*ti,Le=Ue*ti-Re*yi)}}const Ze=1/Math.sqrt(_e*_e+Ce*Ce+Le*Le);LP(c,V,_e*Ze,Ce*Ze,Le*Ze),++V}}}function Mwt(t){t.tile.intersectsClippingArea&&(qMe(t),J8(t))}function Pwt(t){t.tile.intersectsClippingArea&&(XMe(t),WMe(t,!0),J8(t))}function qMe(t){t.tile.intersectsClippingArea&&(XMe(t),WMe(t))}function WMe(t,e=!1){const i=t.geometryState,r=t.geometryInfo,s=i.neighborData,n=t.tile,o=n.level,a=n.extent,l=n.ellipsoid.radius,c=n.extentInRadians,h=c[0],p=c[2],f=c[1],m=c[3],y=i.samplerData,_=a[0],b=a[2],w=a[1],S=a[3],T=tte(t),E=r.boundingBox,O=t.localOrigin,R=O[0],L=O[1],P=O[2],F=n.surface.shading||eT,V=r.vertexAttributes,B=V.position,G=B.typedBuffer,te=B.typedBufferStride,se=V.uv0;for(let ie=0;ie<4;++ie){const H=ie===1||ie===3,$=s.edgeResolutions[ie];Be(Yp($));const N=$+1,U=Fw(n,s.edgePeerNeighbors[ie]);if(r3e(n,U,ie)){t3e(t,ie,U);continue}const q=v(U);Be(!q||U.level===n.level),Be(!q||Dy(n,U)<=0);const Y=U==null?void 0:U.renderData,Q=Y==null?void 0:Y.geometryState;if(Ln){const Ee=n.surface;if(!U&&Ee&&!Ee.updatingRootTiles){const Ne=Tm[ie],Ge=n.findNeighborTile(Ne,tt=>tt.isLoaded||tt.isLeaf||tt.level===n.level);Ge?Ge.intersectsClippingArea&&(Be(!Ge.isLoaded),Be(!Ge.isLeaf),Be(Ge.level===o)):Be(C(Ee==null?void 0:Ee.rootTiles)||!n.shouldHaveNeighbor(Ne))}}const X=ie===1?a[2]:a[0],pe=U==null?void 0:U.extent,ye=pe&&H?ie===1?pe[0]:pe[2]:X,xe=ie===0?a[3]:a[1],De=ie===1?1:0,rt=ie===0?1:0,qe=ie===1?p:h,Pe=ie===0?m:f,Ye=Math.sin(qe),j=Math.cos(qe),J=Math.sin(Pe),ne=Math.cos(Pe),ge=Q==null?void 0:Q.samplerData,_e=q?(Ee,Ne,Ge)=>.5*(Xr(Ee,Ne,y)+Xr(Ge,Ne,ge)):(Ee,Ne,Ge)=>Xr(Ee,Ne,y),Ce=r.outerEdges[ie],Le=e&&N>3?N-3:1,Re=v(y)&&y.some(Ee=>Ee!=null),Ue=v(ge)&&ge.some(Ee=>Ee!=null),Te=Re||Ue,Ze=1/$,Se=Ce.index0;F?(Be(!pe||Zh(pe[2]-pe[0],a[2]-a[0])),(()=>{const Ee=ie===1?-1:ie===3?1:0,Ne=ie===0?-1:ie===2?1:0,Ge=(a[2]-a[0])*Ze,tt=Ee*Ge,dt=Ne*Ge,Ft=H?Ee*((p-h)*Ze):0,ti=H?0:Ne*Ze,yi=rt,Ri=H?qe+Ft:qe,Qi=H?Math.sin(Ri):Ye,ri=H?Math.cos(Ri):j,qt=H?qe-Ft:qe,Jt=H?Math.sin(qt):Ye,Qr=H?Math.cos(qt):j,cr=H?Pe:T(yi+ti),es=H?J:Math.sin(cr),Mr=H?ne:Math.cos(cr),Gr=H?Pe:T(yi-ti),_s=H?J:Math.sin(Gr),zs=H?ne:Math.cos(Gr);let wo=0,Zn=0,Rs=0;{const ur=0*Ze,Wo=H?X:_*(1-ur)+b*ur,wl=H?ye:Wo,me=H?w*(1-ur)+S*ur:xe,br=H?qe:h*(1-ur)+p*ur,Md=H?Ye:Math.sin(br),pa=H?j:Math.cos(br),lu=H?T(ur):Pe,Tt=H?Math.sin(lu):J,fc=H?Math.cos(lu):ne,us=l+_e(Wo,me,wl);wo=pa*fc*us,Zn=Md*fc*us,Rs=Tt*us}let ts=0,is=0,Ms=0;{const ur=1*Ze,Wo=H?X:_*(1-ur)+b*ur,wl=H?ye:Wo,me=H?w*(1-ur)+S*ur:xe,br=H?qe:h*(1-ur)+p*ur,Md=H?Ye:Math.sin(br),pa=H?j:Math.cos(br),lu=H?T(ur):Pe,Tt=H?Math.sin(lu):J,fc=H?Math.cos(lu):ne,us=l+_e(Wo,me,wl);ts=pa*fc*us,is=Md*fc*us,Ms=Tt*us}for(let ur=1;ur<N-1;ur+=Le){let Wo=0,wl=0,me=0;{const Xo=(ur+1)*Ze,nh=H?X:_*(1-Xo)+b*Xo,oh=H?ye:nh,hr=H?w*(1-Xo)+S*Xo:xe,hf=H?qe:h*(1-Xo)+p*Xo,hg=H?Ye:Math.sin(hf),bT=H?j:Math.cos(hf),C1=H?T(Xo):Pe,wT=H?Math.sin(C1):J,A1=H?Math.cos(C1):ne,T0=l+_e(nh,hr,oh);Wo=bT*A1*T0,wl=hg*A1*T0,me=wT*T0}const br=Wo,Md=wl,pa=me,lu=ts,Tt=is,fc=Ms;ts=br,is=Md,Ms=pa;{const Xo=Se+ur,nh=Xo*te,oh=lu-R,hr=Tt-L,hf=fc-P;G[nh]=oh,G[nh+1]=hr,G[nh+2]=hf,pl(oh,hr,hf,E);const hg=ur*Ze;Qc(se,Xo,H?De:hg,H?hg:rt)}const us=wo,E1=Zn,sV=Rs;wo=lu,Zn=Tt,Rs=fc;const xl=lu,b0=Tt,cg=fc,hi=1/Math.sqrt(xl*xl+b0*b0+cg*cg),zI=cg*hi;let ug=0,w0=0,x0=0;if(Te&&zI*zI<.999){let Xo=0,nh=0,oh=0;{const hr=ie===0?-1:1;Xo=hr*(br-us),nh=hr*(Md-E1),oh=hr*(pa-sV)}{const hr=ur*Ze,hf=H?X:_*(1-hr)+b*hr,hg=H?ye:hf,bT=H?w*(1-hr)+S*hr:xe,C1=H?qe:h*(1-hr)+p*hr,wT=H?Ye:Math.sin(C1),A1=H?j:Math.cos(C1),T0=H?T(hr):Pe,Tl=H?Math.sin(T0):J,GI=H?Math.cos(T0):ne;let MA=xl,Z=b0,Me=cg;if(q){const ze=l+Xr(hg-tt,bT-dt,ge),xi=H?GI:zs;MA=(H?Qr:A1)*xi*ze,Z=(H?Jt:wT)*xi*ze,Me=(H?Tl:_s)*ze}{const ze=l+Xr(hf+tt,bT+dt,y),xi=H?GI:Mr,Jn=(H?ri:A1)*xi*ze,Ps=(H?Qi:wT)*xi*ze,Sl=(H?Tl:es)*ze;q||(MA=2*xl-Jn,Z=2*b0-Ps,Me=2*cg-Sl);const S0=ie===3?-1:1,fte=S0*(MA-Jn),mte=S0*(Z-Ps),gte=S0*(Me-Sl);ug=oh*mte-nh*gte,w0=Xo*gte-oh*fte,x0=nh*fte-Xo*mte;const nV=1/Math.sqrt(ug*ug+w0*w0+x0*x0);ug*=nV,w0*=nV,x0*=nV}}}else ug=xl*hi,w0=b0*hi,x0=cg*hi;Ce.setNormalFromValues(ur,ug,w0,x0)}})()):(()=>{for(let Ee=1;Ee<N-1;Ee+=Le){const Ne=Ee*Ze,Ge=H?De:Ne,tt=H?Ne:rt,dt=H?X:_*(1-Ne)+b*Ne,Ft=H?w*(1-Ne)+S*Ne:xe,ti=H?ye:dt,yi=H?qe:h*(1-Ne)+p*Ne,Ri=H?Ye:Math.sin(yi),Qi=H?j:Math.cos(yi),ri=H?T(Ne):Pe,qt=H?Math.sin(ri):J,Jt=H?Math.cos(ri):ne,Qr=_e(dt,Ft,ti),cr=l+Qr,es=Qi*Jt*cr-R,Mr=Ri*Jt*cr-L,Gr=qt*cr-P;pl(es,Mr,Gr,E);const _s=Se+Ee,zs=_s*te;G[zs]=es,G[zs+1]=Mr,G[zs+2]=Gr,Qc(se,_s,Ge,tt)}})()}}function XMe(t){i3e(t)}function YMe(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function Iwt(t,e,i,r){return YMe(t*(1-r)+e*r,i)}function $wt(t,e,i){return t*(1-i)+e*i}function tte(t){const e=t.tile;if(e.surface.isWebMercator){const r=e.extent,s=e.ellipsoid.radius;return n=>Iwt(r[1],r[3],s,n)}const i=e.extentInRadians;return r=>$wt(i[1],i[3],r)}function Lwt(t,e){const i=t.tile.extent,r=t.geometryState,s=i[0],n=i[1],o=i[2]-s,a=i[3]-n,l=r.clippingArea,c=v(l)?Math.max(0,(l[0]-s)/o):0,h=v(l)?Math.max(0,(l[1]-n)/a):0,p=v(l)?Math.min(1,(l[2]-s)/o):1,f=v(l)?Math.min(1,(l[3]-n)/a):1,m=r.numVerticesPerSide,y=(m-2)**2,_=r.neighborData.edgeResolutions.reduce((T,E)=>T+E+1,0),b=PMe(y+_),w=t.geometryInfo,S=w.boundingBox;$r(S),w.numVerticesPerSide=r.numVerticesPerSide,w.vertexAttributes=b,nr(w.uvRange,c,h,p,f),Dwt(t),e3e(t,y),ZMe(t),QMe(w,r.numVerticesPerSide,[],[0,m-1],[0,m-1],r.wireframe),t.intersectionData=null}function Dwt(t){const e=t.tile;e.intersectsClippingArea&&(e.surface.shading?Fwt(t):Nwt(t))}function Nwt(t){const e=t.geometryState,i=e.samplerData,r=t.tile,s=r.surface,n=t.localOrigin,o=s.isWebMercatorOnPlateeCarree,a=e.clippingArea,l=v(a)?a:K8,c=r.extent,h=c[0],p=c[1],f=c[2],m=c[3],y=Math.max(h,l[0]),_=Math.min(f,l[2]),b=Math.max(p,l[1]),w=Math.min(m,l[3]),S=n[0],T=n[1],E=n[2],O=r.ellipsoid.radius,R=r.horizontalScale,L=ite(o,O,R),P=e.numVerticesPerSide,F=P-1,V=P-2,B=t.geometryInfo,G=B.uvRange,te=G[0],se=G[1],ie=G[2],H=G[3],$=B.boundingBox,N=B.vertexAttributes,U=N.position,q=N.uv0;let Y=0;for(let Q=1;Q<=V;Q++){const X=Q/F,pe=we(p*(1-X)+m*X,b,w),ye=we(X,se,H),xe=L(pe)-T;for(let De=1;De<=V;De++){const rt=De/F,qe=we(h*(1-rt)+f*rt,y,_),Pe=we(rt,te,ie),Ye=qe*R-S,j=Xr(qe,pe,i)-E;pl(Ye,xe,j,$),U.setValues(Y,Ye,xe,j),Qc(q,Y,Pe,ye),++Y}}}function Fwt(t){const e=t.tile,i=e.surface;if(!(i.shading||eT))return;const r=t.geometryState,s=r.samplerData,n=t.localOrigin,o=i.isWebMercatorOnPlateeCarree,a=r.clippingArea,l=v(a)?a:K8,c=e.extent,h=c[0],p=c[1],f=c[2],m=c[3],y=Math.max(h,l[0]),_=Math.min(f,l[2]),b=Math.max(p,l[1]),w=Math.min(m,l[3]),S=e.ellipsoid.radius,T=e.horizontalScale,E=r.numVerticesPerSide,O=E-1,R=E-2,L=t.geometryInfo,P=L.vertexAttributes,F=P.position,V=P.uv0,B=P.normalCompressed,G=L.uvRange,te=G[0],se=G[1],ie=G[2],H=G[3],$=L.boundingBox,N=n[0],U=n[1],q=n[2],Y=F.typedBuffer,Q=F.typedBufferStride;let X=0;const pe=we(p,b,w),ye=o?(Math.PI/2-2*Math.atan(Math.exp(-pe/S)))*S:pe*T,xe=1/O,De=we(p*(1-xe)+m*xe,b,w);let rt=ye,qe=o?(Math.PI/2-2*Math.atan(Math.exp(-De/S)))*S:De*T;for(let Pe=1;Pe<=R;Pe++){const Ye=Pe/O,j=we(p*(1-Ye)+m*Ye,b,w),J=we(Ye,se,H),ne=qe,ge=(Pe-1)/O,_e=we(p*(1-ge)+m*ge,b,w),Ce=rt,Le=(Pe+1)/O,Re=we(p*(1-Le)+m*Le,b,w),Ue=o?(Math.PI/2-2*Math.atan(Math.exp(-Re/S)))*S:Re*T,Te=we(Le,se,H);rt=qe,qe=Ue;const Ze=we(h,y,_);let Se=Ze*T,Ee=Xr(Ze,j,s);const Ne=1/O,Ge=we(Ne,te,ie),tt=we(h*(1-Ge)+f*Ge,y,_);let dt=Ge,Ft=tt,ti=tt*T,yi=Xr(tt,j,s);if(Pe===1){const Ri=ti-N,Qi=rt-U,ri=yi-q,qt=0*Q;Y[qt]=Ri,Y[qt+1]=Qi,Y[qt+2]=ri,pl(Ri,Qi,ri,$);const Jt=we(Ne,te,ie);Qc(V,X,Jt,J)}for(let Ri=1;Ri<=R;Ri++){const Qi=ti,ri=yi,qt=(Ri+1)/O,Jt=we(qt,te,ie),Qr=we(h*(1-qt)+f*qt,y,_),cr=Ft;Ft=Qr;{const Rs=X+1,ts=Rs*Q;if(Pe===1||Ri===R){const is=Qr*T,Ms=Xr(Qr,j,s);if(Pe===1&&Ri<R){const ur=is-N,Wo=ne-U,wl=Ms-q;Y[ts]=ur,Y[ts+1]=Wo,Y[ts+2]=wl,pl(ur,Wo,wl,$),Qc(V,Rs,Jt,J)}ti=is,yi=Ms}else ti=Y[ts]+N,yi=Y[ts+2]+q}const es=ti,Mr=yi,Gr=Se,_s=Ee;Se=Qi,Ee=ri;const zs=(X-R)*Q,wo=Pe===1?Xr(cr,_e,s):Y[zs+2]+q,Zn=Xr(cr,Re,s);if(Pe<R){const Rs=X+R,ts=Rs*Q,is=Qi-N,Ms=Ue-U,ur=Zn-q;Y[ts]=is,Y[ts+1]=Ms,Y[ts+2]=ur,pl(is,Ms,ur,$);const Wo=dt;dt=Jt,Qc(V,Rs,Wo,Te)}{const Rs=es-Gr,ts=Ce-Ue,is=ts*(Mr-_s),Ms=Rs*(wo-Zn),ur=-ts*Rs,Wo=is*is+Ms*Ms+ur*ur;if(Wo===0)LP(B,X,0,0,1);else{const wl=1/Math.sqrt(Wo);LP(B,X,is*wl,Ms*wl,ur*wl)}}++X}}}function Uwt(t,e){t.tile.intersectsClippingArea&&(KMe(t),JMe(t,!0),J8(t))}function Vwt(t,e){t.tile.intersectsClippingArea&&(ZMe(t),J8(t))}function ZMe(t,e){t.tile.intersectsClippingArea&&(KMe(t),JMe(t,!1))}function JMe(t,e){const i=t.geometryState,r=i.neighborData,s=t.tile,n=s.surface,o=n.shading||eT,a=s.extent,l=i.clippingArea,c=v(l)?l:K8,h=a[0],p=a[2],f=a[1],m=a[3],y=[m>c[3],p>c[2],f<c[1],h<c[0]],_=t.geometryInfo,b=s.horizontalScale,w=ite(n.isWebMercatorOnPlateeCarree,s.ellipsoid.radius,b),S=_.boundingBox,T=_.uvRange[0],E=_.uvRange[1],O=_.uvRange[2],R=_.uvRange[3],L=Math.max(h,c[0]),P=Math.min(p,c[2]),F=Math.max(f,c[1]),V=Math.min(m,c[3]),B=t.localOrigin,G=B[0],te=B[1],se=B[2],ie=i.samplerData;for(let H=0;H<4;++H){const $=H===1||H===3,N=r.edgeResolutions[H];Be(Yp(N));const U=N+1,q=y[H],Y=Fw(s,r.edgePeerNeighbors[H]);if(!q&&r3e(s,Y,H)){t3e(t,H,Y);continue}const Q=v(Y)&&!q,X=Y==null?void 0:Y.renderData,pe=X==null?void 0:X.geometryState;if(Ln&&(Be(!Q||Y.level===s.level),Be(!Q||Dy(s,Y)<=0),s&&!Y&&!n.updatingRootTiles)){const J=Tm[H],ne=s.findNeighborTile(J,ge=>ge.isLoaded||ge.isLeaf||ge.level===s.level);n.updatingRootTiles||(ne?ne.intersectsClippingArea&&(Be(!ne.isLoaded),Be(!ne.isLeaf),Be(ne.level===s.level)):Be(C(n==null?void 0:n.rootTiles)||!s.shouldHaveNeighbor(J)))}const ye=we(H===1?p:h,L,P),xe=we(H===0?m:f,F,V),De=pe==null?void 0:pe.samplerData,rt=_.outerEdges[H],qe=e&&U>3?U-3:1,Pe=we(H===1?1:0,T,O),Ye=we(H===0?1:0,E,R),j=Q?(J,ne)=>.5*(Xr(J,ne,De)+Xr(J,ne,ie)):(J,ne)=>Xr(J,ne,ie);if(o){const J=(p-h)/N,ne=$?H===1?J:-J:0,ge=$?0:H===0?J:-J,_e=-ne,Ce=-ge;let Le=0,Re=0,Ue=0;{const Ee=0/N,Ne=$?ye:we(h*(1-Ee)+p*Ee,L,P),Ge=$?we(f*(1-Ee)+m*Ee,F,V):xe,tt=j(Ne,Ge);Le=Ne*b,Re=w(Ge),Ue=tt}let Te=0,Ze=0,Se=0;{const Ee=1/N,Ne=$?ye:we(h*(1-Ee)+p*Ee,L,P),Ge=$?we(f*(1-Ee)+m*Ee,F,V):xe,tt=j(Ne,Ge);Te=Ne*b,Ze=w(Ge),Se=tt}for(let Ee=1;Ee<U-1;Ee+=qe){const Ne=Ee/N,Ge=Te,tt=Ze,dt=Se;{const cr=$?Pe:we(Ne,T,O),es=$?we(Ne,E,R):Ye,Mr=Ge-G,Gr=tt-te,_s=dt-se;pl(Ge,Gr,_s,S),rt.setVertexFromValuesRawPositionUV(Ee,Mr,Gr,_s,cr,es)}{const cr=(Ee+1)/N,es=$?ye:we(h*(1-cr)+p*cr,L,P),Mr=$?we(f*(1-cr)+m*cr,F,V):xe,Gr=j(es,Mr);Te=es*b,Ze=w(Mr),Se=Gr}const Ft=Te,ti=Se,yi=Le,Ri=Re,Qi=Ue;Le=Ge,Re=tt,Ue=dt;let ri=0,qt=0,Jt=0;if($){const cr=Ze-tt,es=ti-dt,Mr=Ri-tt,Gr=Qi-dt,_s=we(f*(1-Ne)+m*Ne,F,V),zs=ye+_e,wo=zs*b-Ge,Zn=Xr(zs,_s,ie)-dt,Rs=H===3?-1:1;if(ri=Rs*(-Mr+cr)*Zn,qt=Rs*wo*(-Gr+es),Jt=-Rs*wo*(-Mr+cr),Q){const ts=ye+ne,is=ts*b-Ge;ri=(-Mr+cr)*(Zn-(Xr(ts,_s,De)-dt)),qt=(wo-is)*(-Gr+es),Jt=-(wo-is)*(-Mr+cr)}}else{const cr=Ft-Ge,es=ti-dt,Mr=yi-Ge,Gr=Qi-dt,_s=we(h*(1-Ne)+p*Ne,L,P),zs=xe+Ce,wo=Xr(_s,zs,ie)-dt,Zn=w(zs)-tt,Rs=H===2?-1:1;if(ri=Rs*Zn*(-Gr+es),qt=Rs*(-Mr+cr)*wo,Jt=-Rs*Zn*(-Mr+cr),Q){const ts=_s,is=xe+ge,Ms=w(is)-tt;ri=(-Zn+Ms)*(-Gr+es),qt=(-Mr+cr)*(-wo+(Xr(ts,is,De)-dt)),Jt=-(-Zn+Ms)*(-Mr+cr)}}const Qr=1/Math.sqrt(ri*ri+qt*qt+Jt*Jt);rt.setNormalFromValues(Ee,ri*Qr,qt*Qr,Jt*Qr)}}else for(let J=1;J<U-1;J+=qe){const ne=J/N,ge=$?ye:we(h*(1-ne)+p*ne,L,P),_e=$?we(f*(1-ne)+m*ne,F,V):xe,Ce=$?Pe:we(ne,T,O),Le=$?we(ne,E,R):Ye,Re=j(ge,_e),Ue=ge*b-G,Te=w(_e)-te,Ze=Re-se;pl(Ue,Te,Ze,S),rt.setVertexFromValuesRawPositionUV(J,Ue,Te,Ze,Ce,Le)}}}function KMe(t,e){i3e(t)}function kwt(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function Bwt(t,e){return t*e}function ite(t,e,i){return t?r=>kwt(r,e):r=>Bwt(r,i)}function QMe(t,e,i,r,s,n){const o=e-1,a=t.vertexAttributes.count,l=2*(Math.min(e-2,r[1])-Math.max(1,r[0]))*(Math.min(e-2,s[1])-Math.max(1,s[0])),c=Tm.map((T,E)=>E===0&&s[1]<e-2||E===1&&r[1]<e-2||E===2&&s[0]>1||E===3&&r[0]>1),h=t.outerEdges.reduce((T,E,O)=>T+(c[O]?0:o-2+E.count-1),0),p=i.reduce((T,E)=>T+o*(2*(E.latitudeResolution-1)+1),0),f=n?2:1,m=3*(l+h+p)*f,y=a>=Ewt?new Uint32Array(m):new Uint16Array(m);let _=0;const b=e-2,w=o-2;Be(w>=0);const S=(T,E,O,R,L,P)=>{const F=T*L,V=P[F],B=P[F+1],G=P[F+2],te=E*L,se=P[te],ie=P[te+1],H=P[te+2],$=O*L,N=P[$],U=P[$+1],q=P[$+2],Y=R*L,Q=P[Y],X=P[Y+1],pe=P[Y+2];return(se-Q)*(se-Q)+(ie-X)*(ie-X)+(H-pe)*(H-pe)>(V-N)*(V-N)+(B-U)*(B-U)+(G-q)*(G-q)};if(n){const T=(O,R,L)=>{y[_++]=O,y[_++]=R,y[_++]=R,y[_++]=L,y[_++]=L,y[_++]=O,Ln&&(Be(O<a),Be(R<a),Be(L<a),Be(_<=m))};(()=>{for(let O=Math.max(s[0],1)-1;O<Math.min(s[1],e-2)-1;++O){const R=O*b;for(let L=Math.max(r[0],1)-1;L<Math.min(r[1],e-2)-1;++L){const P=O*b+L,F=P+1,V=F+b,B=V-1,G=R+L,te=G+1,se=te+b,ie=se-1,H=t.vertexAttributes.position.typedBuffer,$=t.vertexAttributes.position.typedBufferStride;S(G,te,se,ie,$,H)?(T(P,F,V),T(V,B,P)):(T(P,F,B),T(B,V,F))}}})(),Be(_===3*l*f),(()=>{for(let O=0;O<4;++O){const R=_;if(c[O])continue;const L=t.outerEdges[O],P=t.innerEdges[O];let F=0,V=0;const B=L.count,G=P.count;Be(G===o-1);let te=0;const se=O===1||O===2?(ie,H,$)=>T(ie,H,$):(ie,H,$)=>T(ie,$,H);for(;F<B-1||V<G-1;){const ie=P.getVertexIndex(V),H=L.getVertexIndex(F),$=F<B-1,N=V<G-1;$&&(!N||($?0+o*(F+.5)/(B-1):0)<=(N?1+w*(V+.5)/(G-1):0))?(++F,Ln&&Be(F<B),se(ie,H,L.getVertexIndex(F)),te++):(++V,Ln&&Be(V<G),se(ie,H,P.getVertexIndex(V)),te++)}Ln&&(Be(F===B-1),Be(V===G-1),Be(te===B+G-2),Be(te===o-2+L.count-1),Be(_===R+3*te*f))}})(),Be(_===3*(l+h)*f);const E=O=>{const R=t.outerEdges[O.connectedOuterEdgeOffset];let L=R.getVertexIndex(0),P=R.stride;for(let F=0;F<O.latitudeResolution;++F){const V=F===0?O.rowOffset:L+e;for(let B=0;B<o;B++)T(L,L+1,V+B),F<O.latitudeResolution-1&&T(L+1,V+B+1,V+B),L+=P;L=V,P=1}};i.forEach(E)}else{(()=>{const E=Math.max(s[0],1)-1,O=Math.min(s[1],e-2)-1,R=Math.max(r[0],1)-1,L=Math.min(r[1],e-2)-1;for(let P=E;P<O;++P){const F=P*b;for(let V=R;V<L;++V){const B=F+V,G=B+1,te=G+b,se=te-1,ie=t.vertexAttributes.position.typedBuffer,H=t.vertexAttributes.position.typedBufferStride;S(B,G,te,se,H,ie)?(y[_]=B,y[_+1]=G,y[_+2]=te,y[_+3]=te,y[_+4]=se,y[_+5]=B):(y[_]=B,y[_+1]=G,y[_+2]=se,y[_+3]=se,y[_+4]=G,y[_+5]=te),_+=6}}})(),Be(_===3*l*f),(()=>{for(let E=0;E<4;++E){if(c[E])continue;const O=t.outerEdges[E],R=t.innerEdges[E];let L=0,P=0;const F=O.count,V=R.count;Be(V===o-1);const B=E===1||E===2,G=B?1:2,te=B?2:1,se=O.index0,ie=O.stride,H=R.index0,$=R.stride;for(;L<F-1||P<V-1;){const N=H+P*$,U=se+L*ie,q=L<F-1,Y=P<V-1,Q=q&&(!Y||(q?0+o*(L+.5)/(F-1):0)<=(Y?1+w*(P+.5)/(V-1):0));Q?++L:++P;const X=Q?U+ie:N+$;y[_]=N,y[_+G]=U,y[_+te]=X,_+=3}}})(),Be(_===3*(l+h)*f);const T=E=>{const O=t.outerEdges[E.connectedOuterEdgeOffset];let R=O.getVertexIndex(0),L=O.stride;for(let P=0;P<E.latitudeResolution;++P){const F=P===0?E.rowOffset:R+e;for(let V=0;V<o;V++){const B=F+V;y[_]=R,y[_+1]=R+1,y[_+2]=B,P<E.latitudeResolution-1?(y[_+3]=R+1,y[_+4]=B+1,y[_+5]=B,_+=6):_+=3,R+=L}R=F,L=1}};i.forEach(T)}Be(_===m),t.indices=y,t.indexCount=m}function e3e(t,e){const i=t.localOrigin,r=t.geometryInfo,s=t.geometryState.neighborData.edgeResolutions,n=r.numVerticesPerSide-2,o=r.vertexAttributes;let a=e;for(let l=0;l<4;++l){{const c=l===0||l===2,h=(l===0?n-1:0)*n+(l===1?n-1:0),p=(c?0:1)*n+(c?1:0);r.innerEdges[l]=new jhe(o,i,h,p,n)}{const c=a,h=s[l]+1;r.outerEdges[l]=new jhe(o,i,c,1,h),a+=h}}}function t3e(t,e,i){const r=(e+2)%4,s=t.geometryState,n=t.tile,o=s.neighborData,a=n.level-i.level,l=e===1||e===3,c=o.edgeResolutions[e];Be(Yp(c));const h=c+1,p=t.geometryInfo,f=p.boundingBox,m=p.outerEdges[e],y=p.uvRange[0],_=p.uvRange[1],b=p.uvRange[2],w=p.uvRange[3],S=we(e===1?1:0,y,b),T=we(e===0?1:0,_,w),E=i.renderData,O=E.geometryState,R=E.geometryInfo.outerEdges[r],L=n.getNeighborEdgeStartVertexIndex(e,i)*c,P=c*2**a;Be(O.neighborData.edgeResolutions[r]===P),Be(R.count-1===P);const F=E.localOrigin[0]-t.localOrigin[0],V=E.localOrigin[1]-t.localOrigin[1],B=E.localOrigin[2]-t.localOrigin[2],G=m.attributes,te=m.index0,se=m.stride,ie=G.position.typedBuffer,H=G.position.typedBufferStride,$=G.normalCompressed.typedBuffer,N=G.normalCompressed.typedBufferStride,U=G.uv0,q=R.attributes,Y=R.index0,Q=R.stride,X=q.position.typedBuffer,pe=q.position.typedBufferStride,ye=q.normalCompressed.typedBuffer,xe=q.normalCompressed.typedBufferStride;for(let De=1;De<h-1;++De){const rt=te+se*De,qe=Y+Q*(L+De),Pe=rt*H,Ye=qe*pe,j=X[Ye]+F,J=X[Ye+1]+V,ne=X[Ye+2]+B;ie[Pe]=j,ie[Pe+1]=J,ie[Pe+2]=ne,pl(j,J,ne,f);const ge=rt*N,_e=qe*xe;$[ge]=ye[_e],$[ge+1]=ye[_e+1];const Ce=De/c,Le=l?S:we(Ce,y,b),Re=l?we(Ce,_,w):T;Qc(U,rt,Le,Re)}}function i3e(t){var Ye;const e=t.geometryState,i=e.neighborData,r=t.localOrigin,s=i.cornerNeighborData,n=t.geometryInfo,o=n.outerEdges,a=n.boundingBox,l=t.tile,c=((Ye=t.tile.surface.view)==null?void 0:Ye.viewingMode)==="local",h=l.ellipsoid.radius,p=l.extentInRadians,f=l.horizontalScale;let m=0,y=0,_=0;const b=(j,J,ne)=>{const ge=p[J===0?1:3],_e=p[j===0?0:2],Ce=Math.cos(ge),Le=Math.sin(ge),Re=Math.sin(_e),Ue=Math.cos(_e),Te=h+ne;m=Ue*Ce*Te,y=Re*Ce*Te,_=Le*Te},w=c?(()=>{const j=t.geometryState.clippingArea,J=l.extent,ne=v(j)&&(J[3]>j[3]||J[2]>j[2]||J[1]<j[1]||J[0]<j[0]),ge=ite(l.surface.isWebMercatorOnPlateeCarree,l.ellipsoid.radius,f);return(_e,Ce,Le)=>{const Re=_e===0?te[0]:te[2],Ue=Ce===0?te[1]:te[3],Te=ne?we(Re,j[0],j[2]):Re,Ze=ne?we(Ue,j[1],j[3]):Ue,Se=Le;m=Te*f,y=ge(Ze),_=Se}})():b;let S=0,T=0,E=0,O=0,R=0,L=0,P=0,F=0,V=0;const B=c&&t.tile.surface.isWebMercatorOnPlateeCarree,G=(j,J,ne,ge,_e)=>{let Ce=0,Le=0,Re=0;if(c){const Ue=J*f,Te=B?(Math.PI/2-2*Math.atan(Math.exp(-ne/h)))*h:ne*f;Ce=Ue-m,Le=Te-y,Re=ge-_}else{const Ue=tte(j),Te=j.tile,Ze=Te.extent,Se=Te.extentInRadians,Ee=(J-Ze[0])/(Ze[2]-Ze[0]),Ne=(ne-Ze[1])/(Ze[3]-Ze[1]),Ge=Se[0]*(1-Ee)+Se[2]*Ee,tt=Ue(Ne),dt=Math.cos(tt),Ft=Math.sin(tt),ti=Math.sin(Ge),yi=Math.cos(Ge),Ri=h+ge;Ce=yi*dt*Ri-m,Le=ti*dt*Ri-y,Re=Ft*Ri-_}switch(_e){case 0:P+=Ce,F+=Le,V+=Re;break;case 1:O-=Ce,R-=Le,L-=Re;break;case 2:P-=Ce,F-=Le,V-=Re;break;case 3:O+=Ce,R+=Le,L+=Re}},te=l.extent,se=e.clippingArea,ie=v(se)?se:K8,H=te[0],$=te[2],N=te[1],U=te[3],q=[U>ie[3],$>ie[2],N<ie[1],H<ie[0]],Y=Math.max(H,ie[0]),Q=Math.min($,ie[2]),X=Math.max(N,ie[1]),pe=Math.min(U,ie[3]),ye=n.uvRange[0],xe=n.uvRange[1],De=n.uvRange[2],rt=n.uvRange[3],qe=l.surface.shading||eT,Pe=j=>{var Ze;const J=s[j].cornerTiles;S=0,T=0,E=1;let ne=1/0;for(let Se=0;Se<4;++Se)ne=Math.min(ne,((Ze=J[Se])==null?void 0:Ze.level)??1/0);for(let Se=0;Se<4;++Se){const Ee=J[Se];$O[Se]=(Ee==null?void 0:Ee.level)===ne?Ee:null}let ge=1,_e=0;for(let Se=0;Se<4;++Se){const Ee=$O[Se];Ee&&(ge=Math.max(ge,Ee==null?void 0:Ee.renderData.geometryState.numVerticesPerSide),_e=Ee.extent[2]-Ee.extent[0])}const Ce=_e,Le=ge;Be(Le>1);const Re=Ce/Le;for(let Se=0;Se<4;++Se){const Ee=$O[(Se+3)%4],Ne=$O[Se%4];if(!Ee&&!Ne)continue;const Ge=Se===0?1:Se===1?2:Se===2?3:0,tt=Se===0?2:Se===1?3:Se===2?0:1;if(Ee&&Ne){const dt=YB[Se][0]*Re,Ft=YB[Se][1]*Re,ti=Ee.extent,yi=ti[Ge===0||Ge===1?2:0]+dt,Ri=ti[Ge===0||Ge===3?3:1]+Ft,Qi=Ne.extent,ri=Qi[tt===0||tt===1?2:0]+dt,qt=Qi[tt===0||tt===3?3:1]+Ft,Jt=Ee.renderData,Qr=Ne.renderData,cr=Xr(yi,Ri,Jt.geometryState.samplerData),es=Xr(ri,qt,Qr.geometryState.samplerData);G(Jt,yi,Ri,.5*(cr+es),Se)}else{const dt=Ee??Ne,Ft=Ee?Ge:tt,ti=dt.extent,yi=YB[Se],Ri=ti[Ft===0||Ft===1?2:0]+yi[0]*Re,Qi=ti[Ft===0||Ft===3?3:1]+yi[1]*Re,ri=dt.renderData,qt=Xr(Ri,Qi,ri.geometryState.samplerData);G(ri,Ri,Qi,qt,Se)}}if(!c){const Se=Math.sqrt(m*m+y*y+_*_);S=m/Se,T=y/Se,E=_/Se}const Ue=Math.sqrt(O*O+R*R+L*L);O/=Ue,R/=Ue,L/=Ue;const Te=Math.sqrt(P*P+F*F+V*V);if(P/=Te,F/=Te,V/=Te,c||E*E<.999){S=L*F-R*V,T=O*V-L*P,E=R*P-O*F;const Se=1/Math.sqrt(S*S+T*T+E*E);S*=Se,T*=Se,E*=Se}};for(let j=0;j<4;++j){const J=j,ne=(j+1)%4,ge=j===0||j===1?1:0,_e=j===0||j===3?1:0,Ce=we(ge,ye,De),Le=we(_e,xe,rt),Re=o[J],Ue=j===0||j===3?Re.count-1:0,Te=o[ne],Ze=j===0||j===1?Te.count-1:0,Se=s[j].cornerTiles;let Ee=-1;for(let tt=0;tt<4;++tt){const dt=Se[tt];dt&&(Ee===-1||Dy(Se[Ee],dt)>0)&&(Ee=tt)}const Ne=Ee,Ge=Se[Ne];if(S=0,T=0,E=1,Ge!==l){const tt=l.level-Ge.level,dt=2**tt,Ft=[Ge.lij[0]+tt,Ge.lij[1]*dt,Ge.lij[2]*dt],ti=[Ft[1]+dt===l.lij[1],j===0&&(Ne===1||Ne===0&&Ge!==Se[3])||j===1&&(Ne===0||Ne===1&&Ge!==Se[2]),Ft[1]===l.lij[1]+1,j===2&&(Ne===3||Ne===2&&Ge!==Se[1])||j===3&&(Ne===2||Ne===3&&Ge!==Se[0])],yi=ti.reduce((Jt,Qr)=>Jt+(Qr?1:0),0);Be(yi===1||yi===2);let Ri=-1,Qi=-1;const ri=Ge.renderData;if(yi===1){const Jt=ti.findIndex(cr=>cr);Be(0<=Jt&&Jt<=3),Ri=(Jt+2)%4;const Qr=t.geometryState.neighborData.edgeResolutions[Jt];Qi=l.getNeighborEdgeStartVertexIndex(Jt,Ge)*Qr+Qr*(Jt===0&&j===0||Jt===1&&j===0||Jt===2&&j===1||Jt===3&&j===3?1:0)}else{Be(ti[1]||ti[3]),Ri=ti[1]?3:1;const Jt=ri.geometryState.neighborData.edgeResolutions[Ri];Qi=j===0||j===3?0:Jt}const qt=ri.geometryInfo.outerEdges[Ri];{const Jt=Re.index0+Ue*Re.stride,Qr=Te.index0+Ze*Te.stride,cr=qt.index0+Qi*qt.stride;{const es=qt.attributes.position,Mr=es.typedBuffer,Gr=cr*es.typedBufferStride,_s=t.localOrigin,zs=qt.localOrigin,wo=Mr[Gr]+zs[0]-_s[0],Zn=Mr[Gr+1]+zs[1]-_s[1],Rs=Mr[Gr+2]+zs[2]-_s[2];pl(wo,Zn,Rs,a);{const ts=Re.attributes.position,is=ts.typedBuffer,Ms=Jt*ts.typedBufferStride;is[Ms]=wo,is[Ms+1]=Zn,is[Ms+2]=Rs}{const ts=Te.attributes.position,is=ts.typedBuffer,Ms=Qr*ts.typedBufferStride;is[Ms]=wo,is[Ms+1]=Zn,is[Ms+2]=Rs}}Qc(Re.attributes.uv0,Jt,Ce,Le),Qc(Te.attributes.uv0,Qr,Ce,Le);{const es=qt.attributes.normalCompressed.typedBuffer,Mr=cr*qt.attributes.normalCompressed.typedBufferStride;{const Gr=Re.attributes.normalCompressed,_s=Gr.typedBuffer,zs=Jt*Gr.typedBufferStride;_s[zs]=es[Mr],_s[zs+1]=es[Mr+1]}{const Gr=Te.attributes.normalCompressed,_s=Gr.typedBuffer,zs=Qr*Gr.typedBufferStride;_s[zs]=es[Mr],_s[zs+1]=es[Mr+1]}}}}else{const tt=q[J],dt=q[ne];let Ft;if(tt||dt){const Qi=we(H*(1-ge)+$*ge,Y,Q),ri=we(N*(1-_e)+U*_e,X,pe),qt=e.samplerData;Ft=Xr(Qi,ri,qt)}else Ft=zwt(Se);w(ge,_e,Ft),(qe||eT)&&Pe(j);const ti=m-r[0],yi=y-r[1],Ri=_-r[2];pl(ti,yi,Ri,a),Re.setVertexFromValuesRawPositionUVNormal(Ue,ti,yi,Ri,Ce,Le,S,T,E),Te.setVertexFromValuesRawPositionUVNormal(Ze,ti,yi,Ri,Ce,Le,S,T,E)}}for(let j=0;j<4;++j)$O[j]=null}function zwt(t){var n,o;const e=t.reduce((a,l)=>Math.min(a,(l==null?void 0:l.level)??1/0),1/0);Ln&&(Be(!t[0]||!t[2]||OX(t[0],t[2],Vt.SOUTH_WEST)),Be(!t[1]||!t[3]||OX(t[1],t[3],Vt.NORTH_WEST)));let i=0,r=0;for(let a=0;a<4;++a){const l=t[a];if(l&&l.level===e){const c=a===0||a===1,h=a===0||a===3,p=l.extent,f=p[c?0:2],m=p[h?1:3],y=(o=(n=l.renderData)==null?void 0:n.geometryState)==null?void 0:o.samplerData;r+=Xr(f,m,y),i++}}const s=i?r/i:0;return Be(s!=null),s}function J8(t){const e=t.vao,i=t.geometryInfo.vertexAttributes.position.typedBuffer;e.vertexBuffers.geometry.setSubData(i,0,0,i.length)}const YB=[[0,1],[1,0],[0,-1],[-1,0]],hn=new Tbt,K8=OZ(-1/0,-1/0,1/0,1/0),$O=[null,null,null,null];function r3e(t,e,i){if(!e)return!1;const r=Dy(t,e);return r>0||r===0&&i>=2}const eT=!0;let Gwt=class extends Jee{get horizontalScale(){return this._horizontalScaleFactor}constructor(e,i,r){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=ci(),e!==void 0&&this.init(e,i,r)}init(e,i,r){super.init(e,i,r);const s=r.view.renderSpatialReference,n=r.spatialReference,o=v(s)&&tZ(s)&&v(n)&&n.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=o;const a=this.surface.isWebMercatorOnPlateeCarree,l=this._extentInRenderSR,c=this.extent;if(a){const h=Xe(c[0],c[1],0);_o(h,mt.WebMercator,h,mt.PlateCarree);const p=Xe(c[2],c[3],0);_o(p,mt.WebMercator,p,mt.PlateCarree),l[0]=h[0],l[1]=h[1],l[2]=p[0],l[3]=p[1]}else for(let h=0;h<4;++h)l[h]=c[h]*o;this.centerAtSeaLevel[0]=.5*(l[0]+l[2]),this.centerAtSeaLevel[1]=.5*(l[1]+l[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(l[2]-l[0],l[3]-l[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,i=.5*(e[2]-e[0]),r=.5*(e[3]-e[1]),s=Math.sqrt(i*i+r*r),n=.5*(this.elevationBounds[0]-this.elevationBounds[1]),o=Math.max(s,n);this._center[on.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(e){const i=this._aabb(),r=i[0],s=i[1],n=i[2],o=i[3],a=i[4],l=i[5];let c=!0;for(let h=0;h<6;h++){const p=e[h],f=p[0],m=p[1],y=p[2],_=p[3];if(f*(f>0?r:o)+m*(m>0?s:a)+y*(y>0?n:l)+_>=0)return xa.OUTSIDE;c=c&&f*(f<0?r:o)+m*(m<0?s:a)+y*(y<0?n:l)+_<=0}return c?xa.INSIDE:xa.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return S6e(e[0],e[1],this.elevationBounds[0],e[2],e[3],this.elevationBounds[1])}intersectsRay(e,i,r,s){return TD[0]=1/i[0],TD[1]=1/i[1],TD[2]=1/i[2],QQ(this._aabb(),e,TD,r,s)}createGeometry(){Lwt(this.renderData,this._horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){Uwt(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){Vwt(this.renderData,this._horizontalScaleFactor)}};const TD=M();let jwt=class{constructor(){this.extent=fi(),this.minLevel=0,this.maxLevel=0,this.callback=null}},UF=class extends $e{constructor(){super(...arguments),this._queries=new li({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new li({initialSize:30}),this._queryPool=new yo(jwt)}queryVisibleLevelRange(e,i,r,s){const n=this._queryPool.acquire();Op(n.extent,e),n.minLevel=i??-Number.MAX_VALUE,n.maxLevel=r??Number.MAX_VALUE,n.callback=s,this._queryQueue.push(n),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const i=this._queries.data[e];this._queryPool.release(i),i.callback(e>=this._queriesInvPtr),i.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const i=e.level;let r=0;for(;r<this._queriesInvPtr;){const s=this._queries.data[r],n=s.extent;i>=s.minLevel&&i<=s.maxLevel&&n[0]<=e.extent[2]&&n[2]>=e.extent[0]&&n[1]<=e.extent[3]&&n[3]>=e.extent[1]?(this._queries.swapElements(r,this._queriesInvPtr-1),this._queriesInvPtr--):r++}}};u([d()],UF.prototype,"updating",null),UF=u([I("esri.views.3d.terrain.ScaleRangeQueries")],UF);let Hwt=class extends Jee{get convexHull(){return this._convexHull}constructor(e,i,r){super(),this._convexHull=new Array(24),this._boundingSphere=gn(),e!==void 0&&this.init(e,i,r)}init(e,i,r){super.init(e,i,r);const s=this.ellipsoid.radius,n=this.extentInRadians[0],o=this.extentInRadians[1],a=this.extentInRadians[2],l=this.extentInRadians[3],c=e[0],h=Yt(o,l,.5),p=Yt(n,a,.5),f=c===0?0:Math.min(Math.abs(o),Math.abs(l));this._edgeLen=(a-n)*Math.cos(f)*s,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=s-Math.sqrt(s*s-this._edgeLen2/4),LVe(this.centerAtSeaLevel,p,h,this.ellipsoid.radius);const m=Kl(this.centerAtSeaLevel);Oe(m,m),this.up=m,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)fe(e[on.MIDDLE],0,0,0),fe(e[on.TOP],0,0,0),fe(e[on.BOTTOM],0,0,0),e[on.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const i=e[on.MIDDLE],r=this.convexHull;let s=0;for(let n=0;n<8;++n)s=Math.max(s,qwt(i,r,3*n));e[on.MIDDLE][3]=Math.sqrt(s)}}_calculateFrustumVisibilityStatus(e){if(!Cv(e,this._boundingSphere))return xa.OUTSIDE;if(this.lij[0]<10)return xa.INTERSECTS;const i=this.convexHull,r=this.surface.view.state.camera.near;let s=!0;for(let n=0;n<r1.NUM;n++){const o=n===Sr.NEAR,a=e[n],l=a[0],c=a[1],h=a[2],p=a[3]-(o?r:0);let f=!1;for(let m=0;m<8;++m){const y=3*m;if(l*i[y+0]+c*i[y+1]+h*i[y+2]+p<0){if(f=!0,!s)break}else s=!1}if(!f)return xa.OUTSIDE}return s?xa.INSIDE:xa.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){Cwt(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),Ln&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,i=e,r=this.elevationBounds,s=this.ellipsoid.radius,n=r[1];if(this.level===0)fe(i,0,0,0),e[3]=s+n;else{const o=this.extentInRadians,a=.5*(o[0]+o[2]),l=o[1],c=o[3];hb(ode,a,l,s),hb(ade,a,c,s),ve(i,ode,ade);const h=.5*(r[0]+r[1]);ue(i,i,(s+h)/Nc(i));const p=this.convexHull;let f=0;const m=(_,b)=>{const w=_[0]-p[3*b+0],S=_[1]-p[3*b+1],T=_[2]-p[3*b+2];return Math.sqrt(w*w+S*S+T*T)};for(let _=0;_<8;++_){const b=m(i,_);f=Math.max(f,b)}const y=f;e[3]=y+2}}_updateConvexHull(){const e=this.extentInRadians,i=this.ellipsoid.radius;if(this.level===0)return;const r=this.elevationBounds,s=this._getPatchType(),n=this.surface.isWebMercator,o=n&&s===Yh.HAS_NORTH_POLE,a=n&&s===Yh.HAS_SOUTH_POLE,l=a||o,c=Math.PI/2,h=e[0],p=e[2],f=a?-c:e[1],m=o?c:e[3],y=.5*(h+p),_=r[0],b=i+(l?Math.min(0,_-1):_),w=(H,$,N)=>hb(H,$,N,b),S=M(),T=M(),E=M(),O=M();w(S,h,f),w(T,h,m),w(E,p,m),w(O,p,f);const R=(H,$)=>{for(let N=0;N<3;++N)this._convexHull[3*$+N]=H[N]};R(S,0),R(T,1),R(E,2),R(O,3);const L=r[1],P=i+(l?Math.max(0,L+1):L),F=M(),V=M(),B=M();hb(V,y,m,b),hb(B,y,f,b),ve(F,V,B),Oe(F,F);const G=M(),te=M(),se=(H,$)=>{po(te,H,$),Oe(te,te);const N=-Ae(H,G)/Ae(te,G);Be(N>=0),ue(te,te,N),ve(H,H,te)};if(2**this.lij[0]>2*this.lij[1]){const H=B,$=M();Et($,nde,H),Oe($,$),Et(G,H,$),Oe(G,G),Be(Zh(Ae(G,H)/Nc(H),0)),se(S,T),se(O,E),R(S,0),R(O,3)}else if(2**this.lij[0]!==2*this.lij[1]){const H=V,$=M();Et($,nde,H),Oe($,$),Et(G,$,H),Oe(G,G),se(T,S),se(E,O),R(T,1),R(E,2)}const ie=(H,$)=>{const N=P/Ae($,F);for(let U=0;U<3;++U)this._convexHull[3*H+U]=$[U]*N};ie(4,S),ie(5,T),ie(6,E),ie(7,O)}_getPatchType(){const e=this.lij[1],i=e===0,r=e===(1<<this.level)-1;return i?r?Yh.HAS_BOTH_POLES:Yh.HAS_NORTH_POLE:r?Yh.HAS_SOUTH_POLE:Yh.REGULAR}intersectsRay(e,i,r,s){const n=this._boundingSphere,o=n[3]+r,a=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],l=n[0]-e[0],c=n[1]-e[1],h=n[2]-e[2],p=(l*i[0]+c*i[1]+h*i[2])/a,f=i[0]*p-l,m=i[1]*p-c,y=i[2]*p-h;return f*f+m*m+y*y<o*o}getDefaultVerticesPerSide(){return this.level<sde.length?sde[this.level]+1:2}updateCornerElevations(){Pwt(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){Mwt(this.renderData),this._updateBoundingVolumes()}_checkBVs(){var pe;if(!Ln||this.level<=2)return;const e=this._boundingSphere,i=e[3],r=e,s=M(),n=this.ellipsoid.radius,o=this.elevationBounds;o[1],o[0];const a=n+o[0],l=1,c=0,h=this._center[on.MIDDLE][3],p=this.convexHull,f=(ye,xe)=>{for(let De=0;De<3;++De)ye[De]=p[3*xe+De]};{const ye=M(),xe=M(),De=M(),rt=M(),qe=M(),Pe=(Ye,j,J,ne)=>{f(xe,Ye),f(De,j),f(rt,J),po(xe,xe,De),po(rt,rt,De),Et(ye,xe,rt),Oe(ye,ye);const ge=Ae(ye,De);f(qe,ne);const _e=Ae(ye,qe),Ce=Math.abs(_e-ge);Be(Zh(Ce,0),`Non coplanar ${Ye},${j},${J},${ne} diff = ${Ce}`)};Pe(0,1,2,3),Pe(4,5,6,7),Pe(0,1,4,5),Pe(1,2,5,6),Pe(2,3,6,7),Pe(3,0,7,4)}const m=ru(24),y=(ye,xe,De)=>{const rt=4*ye;for(let qe=0;qe<3;++qe)m[rt+qe]=xe[qe];m[rt+3]=De},_=M(),b=M(),w=M(),S=M(),T=(ye,xe,De,rt)=>{f(_,xe),f(b,De),f(w,rt),po(_,_,b),Oe(_,_),po(w,w,b),Oe(w,w),Et(S,_,w),Oe(S,S);const qe=Ae(S,b);y(ye,S,qe)};T(0,0,1,2),T(1,1,0,4),T(2,1,5,2),T(3,3,2,6),T(4,4,0,3),T(5,4,6,5);const E=1,O=(ye,xe,De,rt)=>{const qe=4*ye;return m[qe+0]*xe+m[qe+1]*De+m[qe+2]*rt-m[qe+3]},R=(ye,xe,De,rt)=>O(ye,xe,De,rt)>=-E,L=(ye,xe)=>R(ye,xe[0],xe[1],xe[2]),P=2**this.lij[0]>2*this.lij[1],F=(ye,xe,De)=>Math.sqrt(s3e(ye,xe,De,r[0],r[1],r[2]))<i,V=ye=>F(ye[0],ye[1],ye[2]),B=(ye,xe)=>F(ye[xe+0],ye[xe+1],ye[xe+2]),G=this.extentInRadians,te=.5*(G[0]+G[2]),se=G[1],ie=G[3],H=M(),$=M();hb(H,te,ie,a),hb($,te,se,a);const N=P?"Upper":"Lower";let U=!0;for(let ye=0;ye<6;++ye){for(let xe=0;xe<8;++xe){const De=3*xe,rt=R(ye,p[De+0],p[De+1],p[De+2]);U&&(U=rt),Be(rt,`Tile[${this.lij}] Convex hull point ${xe} outside of plane ${ye}`)}Be(L(ye,$),`Tile[${this.lij}] (${N}) bottom mid outside of plane ${ye}`),Be(L(ye,H),`Tile[${this.lij}] (${N}) top mid outside of plane ${ye}`)}Be(U,"Not all convex hull points are inside  convex hull polyhedron"),Be(V($),`Tile[${this.lij}] (${N}) bottom mid outside of bounding sphere`),Be(V(H),`Tile[${this.lij}] (${N}) top mid outside of bounding sphere`);for(let ye=0;ye<8;++ye){const xe=B(p,3*ye);Be(xe,`Tile[${this.lij}] Convex hull point ${ye} outside of bounding sphere`)}for(let ye=0;ye<6;++ye)for(let xe=0;xe<8;++xe){const De=3*xe;R(ye,p[De+0],p[De+1],p[De+2])||console.error(`Tile[${this.lij}] Convex hull point ${xe} outside of plane ${ye}`)}const q=this.extentInRadians,Y=Math.max(q[2]-q[0],q[3]-q[1]),Q=Math.round(Y*n),X=this.renderData;if(X){const ye=X.geometryInfo,xe=X.localOrigin,De=(pe=ye.vertexAttributes)==null?void 0:pe.position;if(!De)return;const rt=De.count,qe=M(),Pe=ye.numVerticesPerSide-2,Ye=Pe*Pe,j=X.geometryState.neighborData,J=j.edgeResolutions.reduce((ne,ge)=>ne+ge+1,0);for(let ne=0;ne<rt;++ne){const ge=ne<Ye,_e=!ge&&ne<Ye+J;let Ce=!1,Le=-1;if(_e){let ri=Ye;for(let qt=0;qt<4;++qt){const Jt=j.edgeResolutions[qt];if(ne===ri||ne===ri+Jt-1){Ce=!0;break}if(ri+=Jt,ne<ri){Le=qt;break}}}const Re=Le,Ue=Ce,Te=_e&&!Ue,Ze=_e?j.edgePeerNeighbors[Re]:null,Se=_e&&Ze&&Dy(this,Ze)>0,Ee=ge?"internal":Te?"edge":Ue?"corner":"pole";De.getVec(ne,s),ve(qe,s,xe);const Ne=Nc(qe)-n;let Ge=0,tt=!1;const dt=o[0]-Ne,Ft=Ne-o[1],ti=dt>l,yi=Ft>l,Ri=ti||yi,Qi=`Tile[${this.lij}].vertex[${ne}]:${Ee}`+(ti?"(below)":yi?"(above)":"")+(Se?"(Neighbor)":"");{const ri=XP(qe,r);if(ri>=i+c){const qt=ri-i;Ri||(console.error(`${Qi} is out of the bounding sphere by ${qt.toFixed(0)} / ${i.toFixed(0)}[tol=${c}] h=${Ne.toFixed(0)} / [${o[0].toFixed(0)}..${o[1].toFixed(0)}] (${(qt/i).toFixed(0)})`),tt=!0)}}for(let ri=0;ri<6;++ri)if(!R(ri,qe[0],qe[1],qe[2])){const qt=O(ri,qe[0],qe[1],qe[2]),Jt=ne%Pe,Qr=(ne-Jt)/Pe;ri===0&&dt||ri===5&&Ft||(console.error(`${Qi} (${Jt},${Qr})|${Pe}] is out of the bounding trapezoid plane ${ri} h=${Math.round(Ne)} / [${Math.round(o[0])}..${Math.round(o[1])}] dist=${Math.round(qt)} radii = ${Math.round(i)}/${Math.round(h)}} : maxL = ${Q}`),++Ge)}if(tt||Ge>0)break}}}};const sde=[128,64,64,32,16,8,8,4];function qwt(t,e,i){return s3e(t[0],t[1],t[2],e[i+0],e[i+1],e[i+2])}function s3e(t,e,i,r,s,n){const o=r-t,a=s-e,l=n-i;return o*o+a*a+l*l}const hb=(t,e,i,r)=>{const s=Math.cos(e),n=Math.sin(e),o=Math.cos(i),a=Math.sin(i);t[0]=r*o*s,t[1]=r*o*n,t[2]=r*a},nde=[0,0,1],ode=M(),ade=M();let Wwt=class{constructor(){this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}},n3e=class extends Va{constructor(){super(...arguments),this.blendMode=Ke.Normal}};u([z({count:Ke.COUNT})],n3e.prototype,"blendMode",void 0);let aE=class extends n3e{constructor(){super(...arguments),this.output=jn.Composite,this.baseOpacityMode=Up.NotRequired,this.premultipliedSource=vp.Off,this.hasWebGL2Context=!1}};u([z({count:jn.COUNT})],aE.prototype,"output",void 0),u([z({count:Up.COUNT})],aE.prototype,"baseOpacityMode",void 0),u([z()],aE.prototype,"premultipliedSource",void 0),u([z()],aE.prototype,"hasWebGL2Context",void 0);var tT;function Xwt(t){const e=new Ui;if(e.include(VMe),t.background===tT.Only){const i=t.output===jn.ColorComposite;return i?e.fragment.uniforms.add(new ni("backgroundColor",r=>r.backgroundColor)):(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.include(Zee)),e.fragment.code.add(x`
    void main() {
      gl_FragColor = vec4(${i?x`backgroundColor`:x`gridColor(uv)`}, 1.0);
    }
  `),e}return e.include(kMe,t),e.fragment.uniforms.add(new zt("tex",i=>i.texture)),e.fragment.uniforms.add(new He("opacity",i=>i.opacity)),e.fragment.code.add(x`void main() {
vec4 bgColor = getBackground(uv);
gl_FragColor = blendLayers(bgColor, texture2D(tex, uv), opacity);
}`),e}(function(t){t[t.BelowLayer=0]="BelowLayer",t[t.Only=1]="Only",t[t.COUNT=2]="COUNT"})(tT||(tT={}));const Ywt=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return tT},build:Xwt},Symbol.toStringTag,{value:"Module"}));let Zwt=class extends UMe{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=Ma}},o3e=class a3e extends ji{initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Mt.WEBGL2}initializeProgram(e){return new ki(e.rctx,a3e.shader.get().build(this.configuration),Li)}initializePipeline(){return Qt({blending:of(Ve.ONE,Ve.ONE_MINUS_SRC_ALPHA),colorWrite:ui})}};o3e.shader=new Vi(Ywt,()=>ee(()=>import("./BlendLayers.glsl-d8110a96.js"),[],import.meta.url));let l3e=class extends aE{constructor(){super(...arguments),this.background=tT.BelowLayer}};u([z()],l3e.prototype,"background",void 0);let ZB=class{constructor(e,i,r,s,n,o){this.texture=e,this.type=i,e.retain(),this.offsetAndScale=si(r.offset[0],r.offset[1],r.scale,r.scale),this.opacities=Xe(s,n,o)}destroy(){this.texture.release()}};function Gv(){return[1,0,0,1,0,0]}function Jwt(t){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function Kwt(t,e,i,r,s,n){return[t,e,i,r,s,n]}function Qwt(t,e){return new Float64Array(t,e,6)}Object.freeze(Object.defineProperty({__proto__:null,clone:Jwt,create:Gv,createView:Qwt,fromValues:Kwt},Symbol.toStringTag,{value:"Module"}));function ext(t){return t instanceof Float32Array&&t.length>=2}function txt(t){return Array.isArray(t)&&t.length>=2}function JB(t){return ext(t)||txt(t)}const c3e=96,u3e=39.37,ixt=180/Math.PI;function h3e(t){return t.wkid?t:t.spatialReference||mt.WGS84}function rte(t,e){return e.type?It(t,e.x,e.y):Fn(t,e)}function d3e(t){return _l(t)}function y3(t,e){const i=Math.max(1,e[0]),r=Math.max(1,e[1]);return Math.max(t.width/i,t.height/r)*hxt(t.spatialReference)}async function cM(t,e,i,r){let s,n;if(!t||Array.isArray(t)&&!t.length)return null;if(Nt.isCollection(t)&&(t=t.toArray()),Array.isArray(t)&&t.length&&typeof t[0]=="object"){const a=t.every(h=>"attributes"in h),l=t.some(h=>!h.geometry);let c=t;if(a&&l&&e&&e.allLayerViews){const h=new Map;for(const y of t){const _=y.layer,b=h.get(_)||[],w=y.attributes[_.objectIdField];w!=null&&b.push(w),h.set(_,b)}const p=[];h.forEach((y,_)=>{const b=e.allLayerViews.find(w=>w.layer.id===_.id);if(b&&"queryFeatures"in b){const w=_.createQuery();w.objectIds=y,w.returnGeometry=!0,p.push(b.queryFeatures(w))}});const f=await Promise.all(p),m=[];for(const y of f)if(y&&y.features&&y.features.length)for(const _ of y.features)v(_.geometry)&&m.push(_.geometry);c=m}for(const h of c)r=await cM(h,e,i,r);return r}if(Array.isArray(t)&&t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number")s=new pt(t);else if(t instanceof r0)s=t;else if("geometry"in t){if(t.geometry)s=t.geometry;else if(t.layer){const a=t.layer,l=e.allLayerViews.find(c=>c.layer.id===a.id);if(l&&"queryFeatures"in l){const c=a.createQuery();c.objectIds=[t.attributes[a.objectIdField]],c.returnGeometry=!0;const h=await l.queryFeatures(c);s=In(h,"features",0,"geometry")}}}if(C(s)||(n=s.type==="point"?new Pi({xmin:s.x,ymin:s.y,xmax:s.x,ymax:s.y,spatialReference:s.spatialReference}):s.extent,!n))return null;Mx()||jm(n.spatialReference,i)||await Px();const o=tg(n,i);return o?r=r?r.union(o):o:null}function rxt(t){if(t&&(!Array.isArray(t)||typeof t[0]!="number")&&(typeof t=="object"||Array.isArray(t)&&typeof t[0]=="object")){if("layer"in t&&t.layer&&t.layer.minScale&&t.layer.maxScale){const e=t.layer;return{min:e.minScale,max:e.maxScale}}if(Array.isArray(t)&&t.length&&t.every(e=>"layer"in e)){let e=0,i=0;for(const r of t){const s=r.layer;s&&s.minScale&&s.maxScale&&(e=s.minScale<e?s.minScale:e,i=s.maxScale>i?s.maxScale:i)}return e&&i?{min:e,max:i}:null}}}function KB(t,e){return rn(h3e(t),e)?t:tg(t,e)}async function sxt(t,e){if(!t||!e)return new zo({targetGeometry:new pt,scale:0,rotation:0});let i=e.spatialReference;const{constraints:r,padding:s,viewpoint:n,size:o}=e,a=[s?o[0]-s.left-s.right:o[0],s?o[1]-s.top-s.bottom:o[1]];let l=null;t instanceof zo?l=t:t.viewpoint?l=t.viewpoint:t.target&&t.target.declaredClass==="esri.Viewpoint"&&(l=t.target);let c=null;l&&l.targetGeometry?c=l.targetGeometry:t instanceof Pi?c=t:(t||t&&("center"in t||"extent"in t||"target"in t))&&(c=await cM(t.center,e,i)||await cM(t.extent,e,i)||await cM(t.target,e,i)||await cM(t,e,i)),!c&&n&&n.targetGeometry?c=n.targetGeometry:!c&&e.extent&&(c=e.extent),i||(i=h3e(e.spatialReference||e.extent||c)),Mx()||rn(c.spatialReference,i)||jm(c,i)||await Px();const h=KB(c.center?c.center:c,i);let p=0;if(l&&v(l.targetGeometry)&&l.targetGeometry.type==="point")p=l.scale;else if("scale"in t&&t.scale)p=t.scale;else if("zoom"in t&&t.zoom!==-1&&r&&r.effectiveLODs)p=r.zoomToScale(t.zoom);else if(Array.isArray(c)||c.type==="point"||c.type==="extent"&&c.width===0&&c.height===0){const _=KB(e.extent,i);p=v(_)?y3(_,a):e.extent?y3(e.extent,a):n.scale}else p=y3(KB(c.extent,i),a);const f=rxt(t);f&&(f.min&&f.min>p?p=f.min:f.max&&f.max<p&&(p=f.max));let m=0;l?m=l.rotation:t.hasOwnProperty("rotation")?m=t.rotation:n&&(m=n.rotation);let y=new zo({targetGeometry:h,scale:p,rotation:m});return r&&(y=r.fit(y),r.constrainByGeometry(y),r.rotationEnabled||(y.rotation=m)),y}function uf(t,e){const i=t.targetGeometry,r=e.targetGeometry;return i.x=r.x,i.y=r.y,i.spatialReference=r.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}function nxt(t,e,i){return i?It(t,.5*(e[0]-i.right+i.left),.5*(e[1]-i.bottom+i.top)):Ca(t,e,.5)}const oxt=function(){const t=et();return function(e,i,r){const s=i.targetGeometry;rte(t,s);const n=.5*RA(i);return e.xmin=t[0]-n*r[0],e.ymin=t[1]-n*r[1],e.xmax=t[0]+n*r[0],e.ymax=t[1]+n*r[1],e.spatialReference=s.spatialReference,e}}();function axt(t,e,i,r,s){return MX(t,e,i.center),t.scale=y3(i,r),s&&s.constraints&&s.constraints.constrain(t),t}function lxt(t,e,i,r){return ote(t,e,i,r),MK(t,t)}const p3e=function(){const t=et();return function(e,i,r){return FK(e,dxt(e,i),nxt(t,i,r))}}(),cxt=function(){const t=Gv(),e=et();return function(i,r,s,n){const o=RA(r),a=ste(r);return It(e,o,o),bTe(t,e),JU(t,t,a),tP(t,t,p3e(e,s,n)),tP(t,t,[0,n.top-n.bottom]),It(i,t[4],t[5])}}();function RA(t){return t.scale*uxt(t.targetGeometry)}function uxt(t){return v(t)&&sa(t.spatialReference)?1/(d3e(t.spatialReference)*u3e*c3e):1}function ste(t){return k6(t.rotation)||0}function hxt(t){return sa(t)?d3e(t)*u3e*c3e:1}function dxt(t,e){return Ca(t,e,.5)}const nte=function(){const t=et(),e=et(),i=et();return function(r,s,n,o,a,l){return NK(t,s),Ca(e,n,.5*l),It(i,1/o*l,-1/o*l),IK(r,e),a&&JU(r,r,a),PK(r,r,i),tP(r,r,t),r}}(),ote=function(){const t=et();return function(e,i,r,s){const n=RA(i),o=ste(i);return rte(t,i.targetGeometry),nte(e,t,r,n,o,s)}}(),pxt=function(){const t=et();return function(e,i,r,s){const n=RA(i);return rte(t,i.targetGeometry),nte(e,t,r,n,0,s)}}();function fxt(t){const e=Bp(t);return e?e.valid[1]-e.valid[0]:0}function mxt(t,e){return Math.round(fxt(t)/e)}const gxt=function(){const t=et(),e=et(),i=[0,0,0];return function(r,s,n){ju(t,r,s),kx(t,t),ju(e,r,n),kx(e,e),a2e(i,t,e);let o=Math.acos(dn(t,e)/(nP(t)*nP(e)))*ixt;return i[2]<0&&(o=-o),isNaN(o)&&(o=0),o}}(),yxt=function(){const t=et();return function(e,i,r,s){const n=e.targetGeometry;return uf(e,i),cxt(t,i,r,s),n.x+=t[0],n.y+=t[1],e}}(),MX=function(t,e,i){uf(t,e);const r=t.targetGeometry;return r.x=i.x,r.y=i.y,r.spatialReference=i.spatialReference,t},_xt=function(){const t=et();return function(e,i,r,s,n){n||(n="center"),FK(t,r,s),Ca(t,t,.5);const o=t[0],a=t[1];switch(n){case"center":It(t,0,0);break;case"left":It(t,-o,0);break;case"top":It(t,0,a);break;case"right":It(t,o,0);break;case"bottom":It(t,0,-a);break;case"top-left":It(t,-o,a);break;case"bottom-left":It(t,-o,-a);break;case"top-right":It(t,o,a);break;case"bottom-right":It(t,o,-a)}return Q8(e,i,t),e}}();function Ekt(t,e,i){return uf(t,e),t.rotation+=i,t}function vxt(t,e,i){return uf(t,e),t.rotation=i,t}const bxt=function(){const t=et();return function(e,i,r,s,n){return uf(e,i),isNaN(r)||r===0||(m3e(t,s,i,n),e.scale=i.scale*r,g3e(t,t,e,n),Q8(e,e,It(t,t[0]-s[0],s[1]-t[1]))),e}}();function lde(t,e,i){return uf(t,e),t.scale=i,t}const f3e=function(){const t=et();return function(e,i,r,s,n,o){return uf(e,i),isNaN(r)||r===0||(m3e(t,n,i,o),e.scale=i.scale*r,e.rotation+=s,g3e(t,t,e,o),Q8(e,e,It(t,t[0]-n[0],n[1]-t[1]))),e}}(),Ckt=function(){const t=et(),e=et();return function(i,r,s,n,o,a,l){return p3e(e,a,l),Gh(t,o,e),n?f3e(i,r,s,n,t,a):bxt(i,r,s,t,a)}}(),m3e=function(){const t=Gv();return function(e,i,r,s){return hm(e,i,lxt(t,r,s,1))}}(),g3e=function(){const t=Gv();return function(e,i,r,s){return hm(e,i,ote(t,r,s,1))}}(),Q8=function(){const t=et(),e=Gv();return function(i,r,s){uf(i,r);const n=RA(r),o=i.targetGeometry;return vTe(e,ste(r)),PK(e,e,Ni(n,n)),hm(t,s,e),o.x+=t[0],o.y+=t[1],i}}();var PX;const Rg=[0,0];let G_=PX=class extends Ie{constructor(t){super(t),this._viewpoint2D={center:et(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new Pi,this.id=0,this.inverseTransform=Gv(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=Gv(),this.transformNoRotation=Gv(),this.displayMat3=ac(),this.displayViewMat3=ac(),this.viewMat3=ac(),this.viewMat2d=gTe(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(t){this._set("pixelRatio",t),this._update()}set size(t){this._set("size",t),this._update()}set viewpoint(t){if(t){const e=this._viewpoint2D,i=t.targetGeometry;e.center[0]=i.x,e.center[1]=i.y,e.rotation=t.rotation,e.scale=t.scale,e.spatialReference=i.spatialReference}this._update()}copy(t){const e=this.size,i=this.viewpoint;return i&&e?(this.viewpoint=uf(i,t.viewpoint),this._set("size",Fn(e,t.size))):(this.viewpoint=t.viewpoint.clone(),this._set("size",[t.size[0],t.size[1]])),this._set("pixelRatio",t.pixelRatio),this}clone(){return new PX({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(t,e,i){return JB(e)?hm(t,e,this.inverseTransform):(Rg[0]=e,Rg[1]=i,hm(t,Rg,this.inverseTransform))}toScreen(t,e,i){return JB(e)?hm(t,e,this.transform):(Rg[0]=e,Rg[1]=i,hm(t,Rg,this.transform))}toScreenNoRotation(t,e,i){return JB(e)?hm(t,e,this.transformNoRotation):(Rg[0]=e,Rg[1]=i,hm(t,Rg,this.transformNoRotation))}getScreenTransform(t,e){const{center:i}=this._viewpoint2D,r=this._get("pixelRatio")||1,s=this._get("size");return nte(t,i,s,e,0,r),t}_update(){const{center:t,spatialReference:e,scale:i,rotation:r}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size"),o=new zo({targetGeometry:new pt(t[0],t[1],e),scale:i,rotation:r});if(this._set("viewpoint",o),!n||!e||!i)return;this.resolution=RA(o),this.rotation=r,this.scale=i,this.spatialReference=e,Fn(this.center,t);const a=n[0]!==0?2/n[0]:0,l=n[1]!==0?-2/n[1]:0;ZK(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=JK(this.viewMat3),h=Xh(n[0]/2,n[1]/2),p=Xh(-n[0]/2,-n[1]/2),f=k6(r);b5(c,c,h),KK(c,c,f),b5(c,c,p),OC(this.displayViewMat3,this.displayMat3,c);const m=IK(this.viewMat2d,h);return JU(m,m,f),tP(m,m,p),oxt(this.extent,o,n),ote(this.transform,o,n,s),MK(this.inverseTransform,this.transform),pxt(this.transformNoRotation,o,n,s),this.worldScreenWidth=mxt(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};u([d({readOnly:!0})],G_.prototype,"id",void 0),u([d({value:1,json:{write:!0}})],G_.prototype,"pixelRatio",null),u([d({json:{write:!0}})],G_.prototype,"size",null),u([d()],G_.prototype,"spatialReference",void 0),u([d({type:zo,json:{write:!0}})],G_.prototype,"viewpoint",null),G_=PX=u([I("esri.views.2d.ViewState")],G_);const IX=G_,wxt=.125;let xxt=class{constructor(){this._renderParams={context:null,drawPhase:1,state:new IX({viewpoint:new zo({targetGeometry:new pt(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null}}dispose(){this._renderParams=null}render(e,i,r,s,n,o,a,l,c,h){const p=o.adjustLevel(i[0]),f=this._renderParams;f.context=e,f.painter=s,f.glyphMosaic=s.glyphMosaic,f.spriteMosaic=s.spriteMosaic,f.pixelRatio=h,f.displayLevel=p,f.requiredLevel=p;const m=o.getScale(i[0]),[y,_]=o.getShift(i,a*m),b=wxt*a*m/c,w=r.transforms.dvs;w[0]=b,w[4]=-b,w[6]=-1-y-l[0]*a*2,w[7]=1+_+(1-l[1])*a*2-2,f.state.size[0]=c,f.state.size[1]=c,r.stage||r.attachWithContext(e),r.triangleCount=0,s.drawTile(f,r,n)}},y3e=class _3e extends ji{initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Mt.WEBGL2}initializeProgram(e){return new ki(e.rctx,_3e.shader.get().build(this.configuration),Li)}initializePipeline(){return Qt({blending:of(Ve.ONE,Ve.ONE_MINUS_SRC_ALPHA),colorWrite:ui})}};y3e.shader=new Vi(Wbt,()=>ee(()=>import("./RasterColorizer.glsl-733bd4f3.js"),[],import.meta.url));let VF=class extends aE{constructor(){super(...arguments),this.colorizerType=gx.Stretch,this.stretchType=Qx.Noop,this.applyColormap=!0}};u([z({count:gx.COUNT})],VF.prototype,"colorizerType",void 0),u([z({count:Qx.COUNT})],VF.prototype,"stretchType",void 0),u([z()],VF.prototype,"applyColormap",void 0);let cde=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const i=this._fbos.get(e);if(i)return i;const r=new Bs(this._rctx,{colorTarget:gs.TEXTURE,depthStencilTarget:Di.DEPTH_RENDER_BUFFER,width:e,height:e});return this._fbos.set(e,r),r}};const Txt=oe.getLogger("esri.views.3d.terrain");let Sxt=class{constructor(e,i){this._rctx=e,this._techniqueRepository=i,this._fbos=[],this._vectorTileHelper=new xxt,this._bindParameters=new s8(null,null,null),this._blendLayersTechniqueConfig=new l3e,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=ka(this._rctx,gA)}dispose(){this._fbos.forEach(ft),this._fbos=null,this._vtFBO=ft(this._vtFBO),this._vaoQuad=ft(this._vaoQuad),this._vectorTileHelper=ft(this._vectorTileHelper),this._backgroundTechnique=Wr(this._backgroundTechnique),this._applyOpacityTechnique=Wr(this._applyOpacityTechnique),this._blendLayersTechnique=Wr(this._blendLayersTechnique)}_getBlendLayersTechnique(e,i,r,s=vp.Off,n=tT.BelowLayer){return this._blendLayersTechniqueConfig.output=i,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=r,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechniqueConfig.background=n,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(o3e,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,i){const r=this._getBlendLayersTechnique(Ke.Normal,i?jn.ColorComposite:jn.GridComposite,Up.NotRequired,vp.Off,tT.Only),s=this._rctx.bindTechnique(r,e,this._bindParameters);this._render(s)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(jt.TRIANGLE_STRIP,0,oa(this._vaoQuad,"geometry"))}drawGroup(e,i,r,s,n,o=vp.On){i===jn.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(r).colorTexture),e.texture=this.currentFBO(r).colorTexture,this.closeGroup(r);const a=this._getBlendLayersTechnique(s,i,n,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawRasterData(e,i,r,s,n,o=vp.Off){if(C(e.texture))return;e.fboTexture=i===jn.GroupBackgroundComposite||s===Ke.Normal&&n===Up.NotRequired&&o===vp.Off?null:this.switch(r).colorTexture;const a=this._getBlendLayersTechnique(s,i,n,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawImageryTileData(e,i,r,s,n,o){const a=o.sourceLayerInfo.data;if(!a.source||(o.tile.surface.layerViewByIndex(o.layerIndex,Ti.MAP).ensureSymbolizerParameters(a),!a.bind(this._rctx)))return;e.fboTexture=s===Ke.Normal&&n===Up.NotRequired?null:this.switch(r).colorTexture;const l=this._getRasterColorizerTechnique(a,i,s,n);a.opacity=e.opacity;const c=a.getUniforms();c.scale=o.scale,c.offset=o.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const h=this._rctx.bindTechnique(l,c,null);this._render(h)}_getRasterColorizerTechnique(e,i,r,s){const n=e.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(n.type);return C(this._rasterColorizerConfig)&&(this._rasterColorizerConfig=new VF,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=i,this._rasterColorizerConfig.blendMode=r,this._rasterColorizerConfig.baseOpacityMode=s,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?Qx.Noop:Qx.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(y3e,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,i,r,s,n,o,a,l,c){const h=this._rctx,p=o.sourceLayerInfo.data,f=o.tile.surface.layerViewByIndex(o.layerIndex,Ti.MAP),m=n===Up.Required||e.opacity<1||s!==Ke.Normal||i!==jn.Composite,y=m?vp.On:vp.Off;this._getBlendLayersTechnique(s,i,n,y).bindPipelineState(h);let _=null,b=null;m?(b=this.currentFBO(r),C(this._vtFBO)&&(this._vtFBO=new cde(this._rctx)),_=this._vtFBO.get(r),h.bindFramebuffer(_),this._clearCurrentFBO()):c&&h.clearSafe(Vr.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(h,o.sourceLod,p,f.painter,f.layer.styleRepository,f.schemaHelper,Math.round(1/o.scale),o.offset,l,a)}catch(w){Txt.warnOnce("A render call containing vector tiles did not resolve correctly.",w)}return!v(_)||(h.bindFramebuffer(b),e.texture=_.colorTexture,e.offset=dc,e.scale=1,this.drawRasterData(e,i,r,s,n,y),c)}copyFBOToTexture(e){const i=this._rctx,r=i.bindTexture(e.texture,xt.TEXTURE_UNIT_FOR_UPDATES),s=e.descriptor;i.gl.copyTexImage2D(Pt.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),e.generateMipmap(),i.bindTexture(r,xt.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(Vr.COLOR_BUFFER_BIT|Vr.DEPTH_BUFFER_BIT)}_initFBO(e,i,r){this._rctx.bindFramebuffer(e),r&&(this._rctx.setViewport(0,0,i,i),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,i=0,r=!0){if(this._current=i,i>=this._fbos.length)for(let s=this._fbos.length;s<=i;s++)this._fbos.push(new cde(this._rctx));this._initFBO(this._fbos[i].get(e),e,r)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const i=this.currentFBO(e),r=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),i}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const i=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},Ext=class{constructor(e,i,r,s){this.start=e,this.end=i,this.blendMode=r,this.opacity=s}},Cxt=class{constructor(e,i,r){this._rctx=e,this.tileSize=i,this._techniqueRepository=r,this._passParameters=new Zwt,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new Sxt(this._rctx,this._techniqueRepository),this._blackTex=new MS(Ytt(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=ft(this._composition),this._backgroundTexture=Wr(this._backgroundTexture),this._blackTex=Wr(this._blackTex)}get backgroundIsGrid(){return C(this._backgroundColor)}get backgroundColor(){return this._backgroundColor}updateTileTexture(e,i){if(!e.renderData)return;const r=e.surface,s=r.baseOpacity;let n=0,o=0,a=this.tileSize,l=!1;const c=r.view.state.contentPixelRatio;let h=!1;p6.clear(),m2.length=0;const p=e.layerInfo[Ti.MAP];let f=p.length,m=0;for(;m<p.length;m++){const b=r.layerViewByIndex(m,Ti.MAP),w=b.layer.opacity;ude[m]=w;const S=b.fullOpacity;if(hde[m]=S,kve(b.layer)&&f>=p.length&&(f=m),l6(b)){dde[m]=b.layer.blendMode;let E=b.layer.blendMode!=="normal";if(fC(b.layer.parent)){const O=$X(b.layer.parent);v(O)&&O!==""&&(E=v3e(b.layer.parent)||E)}E&&(h=E,l=!1)}if(w===0&&!h){p[m].pendingUpdates&=~(Dt.TEXTURE_NOFADING&Dt.TEXTURE_FADING);continue}++o;const T=QB(e,m);if(T){if(p[m].pendingUpdates&=~(Dt.TEXTURE_NOFADING&Dt.TEXTURE_FADING),fC(b.layer.parent)){const E=$X(b.layer.parent);v(E)&&E!==""&&b3e(b.layer.parent,m)}IP(b)?a=Math.max(a,this.tileSize*c):s===1&&S===1&&(b.isOpaque||this._dataToTexture(T)&&T.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++n}}this._rctx.type===Mt.WEBGL1&&(a=Axt(a));const y=a/this.tileSize,_=m-1;this._ensureBackgroundTexture(this.tileSize),n!==0?n===1&&!h&&this._useLayerTexture(e,_,f,hde[_])||this._composeMapLayers(e,i,_,f,ude,dde,a,y,!l||h,p6,h):this._useBackgroundTexture(e,o)}_ensureBackgroundTexture(e){C(this._backgroundTexture)&&(this._backgroundTexture=this._buildTexture(e),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bind(e),this._passParameters.offset=dc,this._passParameters.scale=1,this._passParameters.opacity=1,v(this.backgroundColor)&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,v(this.backgroundColor)),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1)}_useBackgroundTexture(e,i){let r=Ly.Immediate;(e.surface.view.layerViewManager.updating||i>0)&&(r=Ly.Delayed);const s=e.renderData;this._backgroundTexture&&C(s.textureReference)&&(r=Ly.Immediate),s.setTextureReference(v(this._backgroundTexture)?new ZB(this._backgroundTexture,On.FADING,pde,e.surface.baseOpacity,0,1):null,r)}_useLayerTexture(e,i,r,s){const n=i<r,o=n?1:e.surface.baseOpacity,a=n?e.surface.baseOpacity:1,l=QB(e,i);return!!this._dataToTexture(l)&&(e.renderData.setTextureReference(new ZB(l.sourceLayerInfo.data,On.FADING,l,o,a,s)),!0)}_composeMapLayers(e,i,r,s,n,o,a,l,c,h,p){this._composition.ensureBuffer(a);const f=e.surface.baseOpacity;let m=!1,y=gt.LINEAR_MIPMAP_LINEAR,_=!1,b=0;for(let T=r;T>=0;T--){const E=QB(e,T);if(!E||n[T]===0&&!p)continue;const O=T<s&&f<1&&!m;this._passParameters.baseOpacity=O?f:1;const R=this._passParameters.baseOpacity<1?Up.Required:Up.NotRequired;O&&(m=!0);let L=!1;h.forEach(B=>{B.start===T&&(m2.push(B),this._composition.openGroup(a),L=!0)});const P=b===0,F=L?jn.GroupBackgroundComposite:c&&P?this.backgroundIsGrid?jn.GridComposite:jn.ColorComposite:jn.Composite,V=AX[o[T]];for(v1t(E)?(this._passParameters.opacity=n[T],_=this._composition.drawVectorData(this._passParameters,F,a,V,R,E,l,this.tileSize,_)):_1t(E)?(this._passParameters.opacity=n[T],this._composition.drawImageryTileData(this._passParameters,F,a,V,R,E),this._hasNearestInterpolation(E)&&(y=gt.NEAREST)):this._dataToTexture(E)&&(this._passParameters.texture=E.sourceLayerInfo.data.texture,this._passParameters.offset=E.offset,this._passParameters.scale=E.scale,this._passParameters.opacity=n[T],this._composition.drawRasterData(this._passParameters,F,a,V,R));m2.length>0&&m2[m2.length-1].end===T;){const B=m2.pop();this._passParameters.opacity=B.opacity,this._passParameters.offset=dc,this._passParameters.scale=1;const G=c&&P?this.backgroundIsGrid?jn.GridComposite:jn.ColorComposite:jn.Composite;this._composition.drawGroup(this._passParameters,G,a,AX[B.blendMode],R)}b++}const w=e.renderData,S=w.ensureTexture(a,()=>this._buildTexture(a,y));this._composition.copyFBOToTexture(S),this._composition.unbind(),w.setTextureReference(new ZB(S,i,pde,m?1:f,0,1))}_hasNearestInterpolation(e){const i=e.sourceLayerInfo.data;return!!i.source&&i.interpolation==="nearest"}_dataToTexture(e){if(w1t(e)){const i=e.sourceLayerInfo;i.data=this._buildTexture(i.data),e.tile.setMemoryDirty()}return b1t(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,i=gt.LINEAR_MIPMAP_LINEAR){if(C(e))return null;const r={target:Pt.TEXTURE_2D,pixelFormat:it.RGBA,dataType:Ht.UNSIGNED_BYTE,wrapMode:kt.CLAMP_TO_EDGE,samplingMode:i,maxAnisotropy:this._maxAnisotropy,preMultiplyAlpha:!0,flipped:!0,hasMipmap:!0},s=this._rctx;let n;if(typeof e=="number")r.width=r.height=e,n=new MS(new xt(s,r));else if(e instanceof q8)r.isOpaque=e.isOpaque,n=new MS(new xt(s,r,e.image)),e.release();else try{r.width=e.width,r.height=e.height,n=new MS(new xt(s,r,e))}catch{n=new MS(R2e(s)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const o=s.bindTexture(n.texture,xt.TEXTURE_UNIT_FOR_UPDATES);return n.generateMipmap(),s.bindTexture(o,xt.TEXTURE_UNIT_FOR_UPDATES),n}get test(){return{backgroundTexture:this._backgroundTexture}}};function Axt(t){const e=YE(t),i=e*e,r=t*t;if(i===r)return t;const s=e/2;return i-r<r-s*s?e:s}function QB(t,e){gu.layerIndex=e;const i=t.layerInfo[Ti.MAP][e];if(v(i.data))return It(gu.offset,0,0),gu.tile=t,gu.scale=1,gu.sourceLod=t.lij,gu.sourceLayerInfo=i,gu;const r=i.upsampleInfo;if(v(r)){const s=r.tile.layerInfo[Ti.MAP][e];return gu.tile=r.tile,Fn(gu.offset,r.offset),gu.scale=r.scale,gu.sourceLod=r.tile.lij,gu.sourceLayerInfo=s,gu}return null}function $X(t){return t.get("uid")}function v3e(t){let e=t.blendMode!=="normal";return fC(t.parent)&&(e=v3e(t.parent)||e),e}function b3e(t,e){fC(t.parent)&&b3e(t.parent,e);const i=$X(t);if(v(i)&&i!==""){const r=p6.get(i);r?r.start=e:p6.set(i,new Ext(e,e,t.blendMode,t.opacity))}}const ude=new Array,hde=new Array,dde=new Array,p6=new Map,m2=new Array,gu={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},pde={offset:[0,0],scale:1},w3e=200,ez=40,Oxt=.8,Rxt=10,uM=1e-6;function Mxt(t,e,i){const r=e,s=i;let n=0,o=1/0;for(let a=0;a<3;++a){{const l=t[a];if(r[a]<l){if(s[a]<=uM)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]<=-uM){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}{const l=t[a+3];if(r[a]>l){if(s[a]>=-uM)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]>=uM){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}}return!0}let fde=class{constructor(e,i,r,s,n){this.aabb=e,this.axis=i,this.d=r,this.midStartIndex=s,this.rightStartIndex=n}},ate=class LX{constructor(e,i,r,s){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=i,this.positionAttribute=s,this._rayDirection=M(),this.bspNodeTree=new Array;const n=r-i,o=n<=x3e?new Uint16Array(n):new Uint32Array(n);this.indices=o;for(let a=0;a<n;++a)o[a]=a;{const a=Dxt(e,i,r,s.data,s.stride),l=we(Math.log2(n/ez),2,Rxt),c=(h,p,f)=>{const m=$xt(o,a,h,p),y=p-h;if(y<=ez){const E=new fde(m,void 0,0,h,p);return this.bspNodeTree.push(E),E}const{axis:_,midValue:b}=Lxt(m),w=Ixt(o,a,h,p,_,b),S=(E,O)=>{if(f>l)return;const R=O-E;return R<ez||R>=Oxt*y?void 0:c(E,O,f+1)},T=new fde(m,_,b,w.next,w.mid);return this.bspNodeTree.push(T),T.leftNode=S(h,w.next),T.rightNode=S(w.mid,p),T};c(0,n,0),this.triangleVertexIndices=Nxt(o,e,i,r)}}intersectRayTriangleRange(e,i){{if(e>=i)return;const r=this.triangleVertexIndices,s=this.positionAttribute.data,n=this.positionAttribute.stride,o=this._rayOrigin,a=o[0],l=o[1],c=o[2],h=this._rayDirection,p=h[0],f=h[1],m=h[2];for(let y=e,_=3*e;y<i;++y){let b=r[_++]*n;const w=s[b++],S=s[b++],T=s[b];b=r[_++]*n;const E=s[b++],O=s[b++],R=s[b];b=r[_++]*n;const L=E-w,P=O-S,F=R-T,V=s[b++]-w,B=s[b++]-S,G=s[b]-T,te=f*G-B*m,se=m*V-G*p,ie=p*B-V*f,H=L*te+P*se+F*ie;if(Math.abs(H)<=Number.EPSILON)continue;const $=a-w,N=l-S,U=c-T,q=$*te+N*se+U*ie;if(H>0){if(q<0||q>H)continue}else if(q>0||q<H)continue;const Y=N*F-P*U,Q=U*L-F*$,X=$*P-L*N,pe=p*Y+f*Q+m*X;if(H>0){if(pe<0||q+pe>H)continue}else if(pe>0||q+pe<H)continue;const ye=(V*Y+B*Q+G*X)/H;if(ye>=0){const xe=this.indices[y]+this.firstTriangleIndex,De=JQ(L,P,F,V,B,G,Pxt);this._callback(ye,De,xe,!1)}}}LX.numFacesTested+=i-e}intersectRay(e,i){LX.numFacesTested=0;const r=Xe(e.r0[0],e.r0[1],e.r0[2]),s=Xe(e.r1[0],e.r1[1],e.r1[2]),n=s[0]-r[0],o=s[1]-r[1],a=s[2]-r[2];if(n*n+o*o+a*a<uM)return;this._rayOrigin=r;const l=this._rayDirection;l[0]=n,l[1]=o,l[2]=a;const c=this.triangleVertexIndices.length/3;this._callback=i;const h=this.bspNodeTree[0];this.intersectRayBSP(h,0,c)}intersectRayBSP(e,i,r){const s=this._rayOrigin,n=this._rayDirection;if(!Mxt(e.aabb,s,n))return;const o=e.axis,a=e.d;if(s[o]<a||n[o]<0){const l=i,c=e.midStartIndex;if(l<c){const h=e.leftNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),s[o]>a||n[o]>0){const l=e.rightStartIndex,c=r;if(l<c){const h=e.rightNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}};ate.numFacesTested=0;const Pxt=M(),g2=[1/0,1/0,1/0],y2=[-1/0,-1/0,-1/0];function Ixt(t,e,i,r,s,n){let o=i,a=r;for(;o<a;){const c=t[o];e[6*c+s+3]<=n?++o:(--a,t[o]=t[a],t[a]=c)}let l=o;for(a=r;l<a;){const c=t[a-1];e[6*c+s]>=n?--a:(t[a-1]=t[l],t[l]=c,++l)}return{next:o,mid:l}}function $xt(t,e,i,r){if(r<=i)return Cx(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*t[i];for(let n=0;n<3;++n)g2[n]=e[s+0+n],y2[n]=e[s+3+n]}for(let s=i+1;s<r;++s){const n=6*t[s];for(let o=0;o<3;++o)g2[o]=Math.min(g2[o],e[n+0+o]),y2[o]=Math.max(y2[o],e[n+3+o])}return Cx(g2[0],g2[1],g2[2],y2[0],y2[1],y2[2])}function Lxt(t){const e=t[3]-t[0],i=t[4]-t[1],r=t[5]-t[2],s=e>i?e>r?0:i>r?1:2:i>r?1:r>e?2:0;return{axis:s,midValue:(t[s]+t[s+3])/2}}function Dxt(t,e,i,r,s){const n=i-e,o=new Float32Array(6*n);for(let a=0;a<n;++a){const l=3*(a+e),c=t[l+0]*s,h=t[l+1]*s,p=t[l+2]*s;for(let f=0;f<3;++f){const m=r[c+f],y=r[h+f],_=r[p+f];o[6*a+f]=Math.min(m,y,_),o[6*a+3+f]=Math.max(m,y,_)}}return o}function Nxt(t,e,i,r){const s=r-i;let n=0;for(let a=i;a<r;++a)for(let l=0;l<3;++l)n=Math.max(e[3*a+l],n);const o=n<=x3e?new Uint16Array(3*s):new Uint32Array(3*s);for(let a=0;a<s;++a){const l=3*(t[a]+i);for(let c=0;c<3;++c){const h=e[l+c];o[3*a+c]=h}}return o}const x3e=65535;let hs=class extends uo{constructor(){super(...arguments),this.output=k.Color,this.overlayMode=Ny.Disabled,this.tileBlendInput=Sm.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.atmosphere=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.stencilEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.shading=!Ji.TERRAIN_USE_LEGACY_SHADING,this.useLegacyTerrainShading=Ji.TERRAIN_USE_LEGACY_SHADING,this.invisible=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=St.Terrain}};u([z({count:k.COUNT})],hs.prototype,"output",void 0),u([z({count:Ny.COUNT})],hs.prototype,"overlayMode",void 0),u([z({count:Sm.COUNT})],hs.prototype,"tileBlendInput",void 0),u([z()],hs.prototype,"spherical",void 0),u([z()],hs.prototype,"doublePrecisionRequiresObfuscation",void 0),u([z()],hs.prototype,"atmosphere",void 0),u([z()],hs.prototype,"receiveShadows",void 0),u([z()],hs.prototype,"hasSlicePlane",void 0),u([z()],hs.prototype,"backfaceCullingEnabled",void 0),u([z()],hs.prototype,"stencilEnabled",void 0),u([z()],hs.prototype,"textureFadingEnabled",void 0),u([z()],hs.prototype,"renderOccluded",void 0),u([z()],hs.prototype,"hasScreenSpaceReflections",void 0),u([z()],hs.prototype,"hasCloudsReflections",void 0),u([z()],hs.prototype,"shading",void 0),u([z()],hs.prototype,"useLegacyTerrainShading",void 0),u([z()],hs.prototype,"invisible",void 0),u([z()],hs.prototype,"tileBorders",void 0),u([z()],hs.prototype,"visualizeNormals",void 0),u([z()],hs.prototype,"screenSizePerspective",void 0),u([z()],hs.prototype,"receiveAmbientOcclusion",void 0),u([z({count:St.COUNT})],hs.prototype,"pbrMode",void 0),u([z({constValue:lr.CompressedAttribute})],hs.prototype,"normalType",void 0),u([z({constValue:Ks.Compressed})],hs.prototype,"textureCoordinateType",void 0),u([z({constValue:!1})],hs.prototype,"highStepCount",void 0),u([z({constValue:!1})],hs.prototype,"useCustomDTRExponentForWater",void 0),u([z({constValue:!1})],hs.prototype,"useFillLights",void 0);const tz=7,Fxt=10,iz=Nn();var Bn;(function(t){t[t.Opaque=0]="Opaque",t[t.Semitransparent=1]="Semitransparent",t[t.TransparentWithDraped=2]="TransparentWithDraped",t[t.Empty=3]="Empty"})(Bn||(Bn={}));let Rc=class extends $e{get _isGlobal(){return this._stage.viewingMode===st.Global}get shading(){return this._techniqueConfiguration.shading}set shading(e){this._techniqueConfiguration.shading=e}constructor(e){super(e),this.type=as.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new hs,this._passParameters=new zMe,this._rctx=null,this._renderDataPool=new yo(Twt),this._patchGroups=new Map,this._patchGroupsDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new $Me,this._highestVisibleLODTile=null,this._visible=!0,this._transparencyState=Bn.Opaque,this._velvetOverground=!0,this._castShadows=!0,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=ps.Occlude}initialize(){const e=[Fe.OPAQUE_TERRAIN,Fe.TRANSPARENT_TERRAIN,Fe.OCCLUDED_TERRAIN];this._stage.addRenderPlugin(e,this)}destroy(){this._stage.removeRenderPlugin(this),bbt()}get canRender(){return this._visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.invisible=e===Bn.TransparentWithDraped||e===Bn.Empty,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get needsLinearDepth(){return this._overlayRenderer.hasWater}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}set velvetOverground(e){this._velvetOverground!==e&&(this._velvetOverground=e,this.setNeedsRender())}get layerUid(){return av}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._techniqueConfiguration.pbrMode!==e&&(this._techniqueConfiguration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?e6:ps.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,v(this._tileRenderer)&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,Dt.TEXTURE_FADING)}updateTileTexture(e,i){v(this._tileRenderer)&&(this._tileRenderer.updateTileTexture(e,i===Dt.TEXTURE_FADING?On.FADING:On.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(i))}updateTileGeometryState(e){for(const r of e.layerInfo[Ti.ELEVATION])r.pendingUpdates&=~Dt.GEOMETRY;e.resetPendingUpdate(Dt.GEOMETRY);const i=e.renderData.updateGeometryState();return i&&this.setDirty(),i}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const i=e.renderData;i&&(i.releaseGeometry(),this._renderDataPool.release(i),i.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const i=Fxt-tz,r=Math.max(0,Math.floor((e.level-i)/tz)*tz);if(this._isGlobal&&r===0)return Ma;for(;e.parent&&e.level>r;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this._visible=e,this.setDirty()}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=Fs.UPDATE){this._patchGroupsDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=Fs.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=Fs.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._rctx=e.renderContext.rctx,this._techniqueRepository=e.techniqueRepository,this._tileRenderer=new Cxt(this._rctx,this._tileSize,this._techniqueRepository),this.updateTileBackground(),this._emptyTex=R2e(this._rctx)}uninitializeRenderContext(){this._emptyTex=ft(this._emptyTex),this._tileRenderer=ft(this._tileRenderer)}intersect(e,i,r,s){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==Bn.Opaque)return;const n=Uxt,o=Vxt;be(n,s,r),fe(o,1/n[0],1/n[1],1/n[2]);const a=e.results.min,l=e.results.max,c=e.results.ground,h=e.options.store===Ho.MIN,p=!!e.results.ground.target,f=aot(e.verticalOffset),m=e.tolerance;let y,_=h&&v(a.dist)?a.dist:1/0;const b=S=>{const T=S.renderData;if(!(T!=null&&T.vao))return;const E=T.geometryInfo;rU(iz,E.boundingBox);const O=T.localOrigin;v(f)&&(f.localOrigin=O,f.applyToAabb(iz));const R=iz;if(_2[0]=r[0]-O[0],_2[1]=r[1]-O[1],_2[2]=r[2]-O[2],!QQ(R,_2,o,m,_))return;const L=(ie,H,$)=>{ie.set(this.type,S,H,$,th),_=h&&v(a.dist)?a.dist:1/0},P=(ie,H)=>{if(v(H)&&ie>=0&&(e.options.backfacesTerrain||Ae(H,n)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||i==null||i(r,s,ie))){if((c.dist==null||ie<c.dist)&&L(c,ie,H),e.options.isFiltered)return;e.options.store===Ho.ALL&&(C(y)?(y=EQ(e.ray),L(y,ie,H),e.results.all.push(y)):ie<y.dist&&L(y,ie,H)),(a.dist==null||ie<a.dist)&&L(a,ie,H),e.options.store!==Ho.MIN&&(l.dist==null||ie>l.dist)&&L(l,ie,H)}},F=kxt;be(F,s,O);const V=E.indices,B=E.vertexAttributes,G=B.getField(A.POSITION,Lr),te=new ht(G.typedBuffer,3,!1,B.stride/4),se=E.indexCount/3;if(C(f)&&se>w3e){const ie=S.renderData;C(ie.intersectionData)&&(ie.intersectionData=new ate(V,0,se,te)),ie.intersectionData.intersectRay({r0:_2,r1:F},P)}else MI(_2,F,0,se,V,te,null,f,P)},w=this._rootTiles;v(w)&&(()=>{const S=this._tileIterator;S.reset(w);const T=e.options.invisibleTerrain;for(let E=S.next();E;E=S.next())!(E.visible||T&&E.intersectsClippingArea)||!v(f)&&!E.intersectsRay(r,n,m,_)||p&&this._useStencilForTile(E)?S.skipSubtree():b(E)})()}processScaleRangeQueries(e,i){var r;if(!i.done)for(this._updatePatchGroups();e.updating&&!i.done;){e.prepare();for(const s of this._patchGroups.values())for(const n of s)v((r=n.renderData)==null?void 0:r.textureReference)&&e.queriesForTile(n);e.process(),i.madeProgress()}}prepareTechnique(e){if(e.bindParameters.slot===Fe.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&e6))return null}else{const i=this.transparency===Bn.Opaque?Fe.OPAQUE_TERRAIN:Fe.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==i)return null}switch(e.output){case k.Color:return this.transparency===Bn.Empty?null:(this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=v(e.bindParameters.cloudsFade.data),this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssaoHelper.active,this._techniqueConfiguration.overlayMode=this._overlayRenderer.isEmpty?Ny.Disabled:this._overlayRenderer.hasWater?Ny.EnabledWithWater:Ny.Enabled,this._updateTechnique(k.Color,e.bindParameters.slot===Fe.OCCLUDED_TERRAIN));case k.Shadow:case k.ShadowExcludeHighlight:return this._castShadows&&e.bindParameters.lighting.globalFactor===1?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(k.Shadow,!1)):null;case k.Depth:return this.transparency===Bn.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(k.Depth,!1));case k.Normal:return this.transparency===Bn.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(k.Normal,!1));case k.ObjectAndLayerIdColor:return this.transparency===Bn.Empty?null:this._updateTechnique(k.ObjectAndLayerIdColor,!1);case k.Highlight:return this.transparency!==Bn.Empty&&this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(k.Highlight,!1)):null}return null}render(e,i){const r=e.bindParameters.lighting.globalFactor===1;switch(this._updatePatchGroups(),i.useStencil=!1,e.output){case k.Color:{const s=e.bindParameters.slot===Fe.OCCLUDED_TERRAIN?Zl.Occluded:Zl.ColorAndWater;this.transparency===Bn.Opaque?this._renderMaterialPass(e,i,s):e.offscreenRenderingHelper.renderToTargets(()=>this._renderMaterialPass(e,i,s),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]);break}case k.Depth:case k.Normal:this._renderAuxiliaryPass(e,i,Zl.None);break;case k.Highlight:this.needsHighlight&&this._renderAuxiliaryPass(e,i,Zl.Highlight);break;case k.Shadow:case k.ShadowExcludeHighlight:this._castShadows&&r&&this._renderAuxiliaryPass(e,i,Zl.None);break;case k.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,i,Zl.ObjectAndLayerIdColor)}}_renderMaterialPass(e,i,r){const{rctx:s}=e;this._passParameters.overlaySource=r,s.bindTechnique(i,this._passParameters,e.bindParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this._renderPatchGroups(e,i,r)}_renderAuxiliaryPass(e,i,r){const s=e.rctx;this._passParameters.overlaySource=r,s.bindTechnique(i,this._passParameters,e.bindParameters),this._renderPatchGroupsAuxiliary(e,i,r)}updateTileBackground(e=null){if(C(this._tileRenderer))return;const i=this._tileRenderer;let r=null;if(v(e)){const s=ot.toUnitRGBA(e);r=Xe(s[0]||0,s[1]||0,s[2]||0)}i.setBackground(r),this._allTiles.forAll(s=>i.updateTileTexture(s,On.FADING)),this._techniqueConfiguration.tileBlendInput=i.backgroundIsGrid?Sm.GridComposite:v(i.backgroundColor)?Sm.ColorComposite:Sm.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchGroupsDirty&&(this._highestVisibleLODTile=null,this._rebuildPatchGroups(),this._patchGroupsDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==BC.NONE){const e=Array.from(this._patchGroups.values()),i=this._stencilEnabledLayerExtents;for(const r of e)LMe(this.renderOrder,r,i);e.sort((r,s)=>DMe(r[0],s[0],this.renderOrder)),this._patchGroups=new Map(e.map(r=>[r[0].renderData.localOrigin,r])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){var i;const e=this._rootTiles;if(!C(e)){(i=e[0])==null||i.surface.checkAllTilesWaterproofness(),this._patchGroups.clear();for(const r of e)this._rebuildPatchGroupsForRootTile(r)}}_rebuildPatchGroupsForRootTile(e){const i=this._tileIterator;for(i.resetOne(e);!i.done;){const r=i.next(),s=r.renderData;if(!s){this._numTilesCulled++;continue}if(!r.visible){this._numTilesCulled++,i.skipSubtree();continue}const n=s.localOrigin;let o=this._patchGroups.get(n);o||(o=new Array,this._patchGroups.set(n,o)),o.push(r),(!this._highestVisibleLODTile||r.vlevel>this._highestVisibleLODTile.vlevel)&&(this._highestVisibleLODTile=r),i.skipSubtree()}}_useStencilForTile(e){for(const i of this._stencilEnabledLayerExtents)if(e.intersectsExtent(i))return!0;return!1}_renderPatchGroupsAuxiliary(e,i,r){const s=this._stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(n=>{const o=n[0].renderData.localOrigin;i.program.bindDraw(new sX(o),e.bindParameters,this._passParameters);for(let a=0;a<n.length;a++)this._renderPatch(e,i,n[a],jt.TRIANGLES,s,r)}),e.rctx.bindVAO(null)}_renderPatchGroups(e,i,r){const s=e.bindParameters.camera,n=i.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const p=fCe(this._stage.viewingMode,this._ellipsoidRadius),f=this.pointsOfInterest.centerOnSurfaceFrequent.distance;p.update({distance:f,fovY:s.fovY})}const o=this._stencilEnabledLayerExtents.length>0,a=r===Zl.Occluded;a&&(n.bindTexture("tex",this._emptyTex),n.setUniform3fv("textureOpacities",Ma),n.setUniform4fv("texOffsetAndScale",Am));const l=v(this._tileRenderer)&&v(this._tileRenderer.backgroundColor)?this._tileRenderer.backgroundColor:Ma;this._techniqueConfiguration.tileBlendInput===Sm.ColorComposite&&n.setUniform3fv("backgroundColor",l);const c=this.wireframe?jt.LINES:jt.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&n.bindTexture("texNext",this._emptyTex);const h=this._patchGroups;for(const p of h.values()){const f=p[0].renderData.localOrigin;i.program.bindDraw(new sX(f),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(const m of p){const y=m.renderData,_=y.textureReference;if(!C(_)){if(!a){n.setUniform4fv("texOffsetAndScale",_.offsetAndScale),n.bindTexture("tex",_.texture.texture);const b=y.textureFadeFactor,w=b<1?y.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&v(w)&&b<1?(n.setUniform1f("fadeFactor",b),n.setUniform4fv("nextTexOffsetAndScale",w.offsetAndScale),n.setUniform3fv("nextTexOpacities",w.opacities),n.bindTexture("texNext",w.texture.texture)):n.setUniform1f("fadeFactor",1),y.textureIsFading&&this.setNeedsRender(),n.setUniform3fv("textureOpacities",_.opacities)}this._renderPatch(e,i,m,c,o,r),m.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,i,r,s,n,o){const a=r.renderData,l=a.vao,c=l.indexBuffer;if(C(c))return void(Ln&&console.error("Rendered tile with no indices: ",r.lij," : ",a));const h=i.program;o===Zl.None||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(h,a.overlay),n&&(i.useStencil=this._useStencilForTile(r),i.bindPipelineState(e.rctx,e.bindParameters.slot));const p=a.geometryInfo.indexCount;e.rctx.bindVAO(l),h.assertCompatibleVertexAttributeLocations(l),e.rctx.drawElements(s,p,c.indexType,0)}_bindOverlayPatchData(e,i){e.setUniform4fv("overlayTexOffset",i.offsets),e.setUniform4fv("overlayTexScale",i.scales)}_updateTechnique(e,i){return this._techniqueConfiguration.output=e,e===k.Color&&(this._techniqueConfiguration.atmosphere=this._isGlobal&&this._velvetOverground),this._techniqueConfiguration.renderOccluded=i,this._techniqueConfiguration.stencilEnabled=!1,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(GMe,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this._tileRenderer}}};u([d({constructOnly:!0})],Rc.prototype,"_overlayRenderer",void 0),u([d({constructOnly:!0})],Rc.prototype,"_stage",void 0),u([d({readOnly:!0})],Rc.prototype,"_isGlobal",null),u([d({constructOnly:!0})],Rc.prototype,"_allTiles",void 0),u([d({constructOnly:!0})],Rc.prototype,"_ellipsoidRadius",void 0),u([d({value:!1})],Rc.prototype,"renderingDisabled",null),u([d()],Rc.prototype,"renderPatchBorders",null),u([d()],Rc.prototype,"visualizeNormals",null),u([d()],Rc.prototype,"cullBackFaces",null),u([d({value:BC.FRONT_TO_BACK})],Rc.prototype,"renderOrder",null),u([d()],Rc.prototype,"wireframe",null),Rc=u([I("esri.views.3d.terrain.TerrainRenderer")],Rc);const Uxt=M(),Vxt=M(),_2=M(),kxt=M();let Bxt=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},Kf=class extends $e{constructor(e){super(e),this._handles=new Ki}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add(re(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=Je(this._handles),this._waitTask=null}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(i=>!(!FM(i)||i.isRejected())&&!(i.isFulfilled()&&!zxt(i,this.viewSpatialReference,this.viewingMode))&&(e=i,!((i==null?void 0:i.type)==="vector-tile"||a6(i)))),e)if(e.isResolved()){const i=X8(e,this.viewSpatialReference,this.viewingMode);if(v(i)){const r=new Gc(i.tileInfo);this._lockTilingScheme(r)}}else this._updateWhen(e)}_updateWhen(e){const i=e.when().catch(()=>{}).then(()=>{i!==this._waitTask||this.destroyed||this._update()});this._waitTask=i}_lockTilingScheme(e){if(this.viewingMode===st.Global){const i=e.levels.length-1;e.spatialReference.isWebMercator?e=Gc.makeWebMercatorAuxiliarySphere(i):$x(e.spatialReference)&&(e=Gc.makeGCSWithTileSize(e.spatialReference,e.pixelSize,i))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(re(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===st.Global){const e=this.extentHelper.viewSpatialReference,i=$x(e)||Zm(e)||Jm(e);e.isWebMercator?this.tilingScheme=Gc.WebMercatorAuxiliarySphere:i&&(this.tilingScheme=Gc.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;v(e)&&!sx(e,this.extent)&&(this.tilingScheme=Gc.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function zxt(t,e,i){return v(X8(t,e,i))}u([d()],Kf.prototype,"tilingScheme",void 0),u([d({readOnly:!0})],Kf.prototype,"extent",void 0),u([d({value:!1})],Kf.prototype,"tilingSchemeLocked",void 0),u([d({constructOnly:!0})],Kf.prototype,"viewSpatialReference",void 0),u([d({constructOnly:!0})],Kf.prototype,"layers",void 0),u([d({constructOnly:!0})],Kf.prototype,"extentHelper",void 0),u([d({constructOnly:!0})],Kf.prototype,"viewingMode",void 0),Kf=u([I("esri.views.3d.terrain.TilingSchemeLogic")],Kf);let Gxt=class{constructor(){this.offset=et(),this.scale=0,this.tile=null}init(e,i,r,s){this.tile=e,this.offset[0]=i,this.offset[1]=r,this.scale=s}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}},di=class extends As.EventedMixin($e){constructor(e){var i,r;super(e),this._scaleRangeQueries=new UF,this._iteratorPool=new yo($Me,s=>s.remove=()=>this._iteratorPool.release(s)),this._postorderIterator=new Cbt,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visibleCached=!1,this._usedMemory=null,this._performanceInfo=new Bxt,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=M(),this._eyePosSurfaceSR=M(),this._splitLimits=new Wwt,this._frustum=cP(),this._viewProjectionMatrix=We(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new Ki,this._watchUpdatingTracking=new Cm,this._frameTask=SC,this._allTiles=new li,this._upsampleInfoPool=new yo(Gxt),this._rootTilesExtent=ci(),this.updatingProgress=0,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=mt.WebMercator,this.visibleElevationBounds=new oE(1/0,-1/0),this.rootTileElevationBounds=new oE(1/0,-1/0),this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this.oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this._shading=!0,this._isWebMercator=!1,this._isWebMercatorOnPlateeCarree=!1,this._isGlobal=!((r=(i=e.view)==null?void 0:i.state)!=null&&r.isLocal)}initialize(){this._lercDecoder=Z1t(this.view.resourceController),this._tilePool=this.view.state.isLocal?new yo(Gwt):new yo(Hwt);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("esri.views.3d.terrain.upsample",o=>o.unloadMapData()),this._elevationQueryCache=new X1t(e.newCache("elevation-query")),this._set("overlayManager",new jl({surface:this})),this._handles.add([re(()=>this.overlayManager.hasHighlights,o=>this._renderer.setNeedsHighlight(o)),re(()=>this.overlayManager.rendersOccluded,o=>this._renderer.setRenderOccludedOverlay(o)),re(()=>this.overlayManager.renderer.isEmpty,()=>this._evaluateTransparency())],"overlayManager"),this._renderer=new Rc({_overlayRenderer:this.overlayManager.renderer,_ellipsoidRadius:tr(this.view.spatialReference).radius,_stage:this.view._stage,_allTiles:this._allTiles}),this._handles.add([re(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?On.UNFADED:On.IMMEDIATE)},Br),re(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?On.UNFADED:On.IMMEDIATE),Br),re(()=>this.renderingDisabled,()=>{var o,a;return(a=(o=this.view)==null?void 0:o._stage)==null?void 0:a.renderer.setParameters({terrainRenderingEnabled:!this.renderingDisabled})},Wi),re(()=>this.backgroundColor,o=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(o)},Br),re(()=>this.snapLevel,()=>this._viewChanged=!0,Wi),re(()=>this.view.pointsOfInterest,o=>{this._renderer.pointsOfInterest=o,this._watchUpdatingTracking.removeAll(),o&&this._watchUpdatingTracking.add(()=>o.focus.renderLocation,()=>this._allTilesSorted=!1)}),re(()=>Ji.TERRAIN_TILE_TREE_SHOW_TILES,o=>{o&&!this._treeDebugger?ee(()=>import("./TerrainTileTree3DDebugger-50c9f1fb.js"),["./TerrainTileTree3DDebugger-50c9f1fb.js","./TileTreeDebugger-44eb22f0.js"],import.meta.url).then(({TerrainTileTree3DDebugger:a})=>{!this._treeDebugger&&Ji.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new a({view:this.view}))}):o||(this._treeDebugger=Je(this._treeDebugger))},Zt)]);const{spatialReference:i}=this.view;this._extentHelper=dbt(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:i});const r=new TC({getCollections:()=>{var o,a,l;return(l=(a=(o=this.view)==null?void 0:o.defaultsFromMap)==null?void 0:a.mapCollections)==null?void 0:l.map(({layers:c})=>c)},getChildrenFunction:o=>o&&"layers"in o?o.layers:null}),s=new Kf({layers:r,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:i});this._set("tilingSchemeLogic",s),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(ym.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(ym.BASEMAP);const n=this.view.resourceController.scheduler;this._frameTask=n.registerTask(Rt.TERRAIN_SURFACE,this),this._handles.add([re(()=>this._extentHelper.stencilEnabledExtents,o=>this._renderer.setStencilEnabledLayerExtents(o),Zt),re(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),Wi),re(()=>this.extent,()=>this._updateRootTiles(),Zt),this.view.on("resize",()=>this._viewChangeUpdate()),re(()=>{var l,c;const o=this.view,a=o.state;return[this._lodBias,this.lodSnapping,(c=(l=o.resourceController)==null?void 0:l.memoryController)==null?void 0:c.memoryFactor,a.camera,a.contentCamera,a.fixedContentCamera]},()=>this._viewChangeUpdate(),Br),re(()=>{var o,a;return(a=(o=this.view.qualitySettings)==null?void 0:o.tiledSurface)==null?void 0:a.textureFadeDuration},o=>this._renderer.textureFadingEnabled=o>0,Zt),re(()=>{var o;return(o=this.view.qualitySettings)==null?void 0:o.physicallyBasedRenderingEnabled},o=>this._renderer.pbrMode=o?St.Terrain:St.Disabled,Zt),re(()=>this._userClippingExtent,()=>this._updateClippingExtent(),Wi)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._handles.add([re(()=>{var o;return(o=this.view)==null?void 0:o.map.ground.shading},()=>{this._updateShadingIfChanged()})]),this._updateShading(),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=Wr(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=Je(this._upsampleMapCache),this._elevationQueryCache=Je(this._elevationQueryCache);const e=this.tilingSchemeLogic.layers;this._set("tilingSchemeLogic",Je(this.tilingSchemeLogic)),e.destroy(),this._basemapLayerViewHandles.forEach((i,r)=>this._unregisterTiledLayerView(r)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",Je(this.overlayManager)),this._tilePool=Je(this._tilePool),Jee.prune(),this._treeDebugger=Je(this._treeDebugger),this._renderer=Je(this._renderer),this._iteratorPool=Je(this._iteratorPool),this._set("view",null),this._upsampleInfoPool=Je(this._upsampleInfoPool),abt(),iwt()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var e,i;if(this.lodSnapping===l3.ON){const r=this.view,s=this.tilingScheme,n=(i=(e=r.pointsOfInterest)==null?void 0:e.cameraOnSurface)==null?void 0:i.scale;if(n&&s){const o=r.state.contentCamera;let a=x8(r,o.eye,o.viewForward,o.up).tilt;a>90&&(a=180-a);const l=2*(a/90)**2,c=s.levelAtScale(n)-l;return Math.round(c)}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?l3.ON:l3.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:i}=this.view;if(C(i)||C(e))return null;const r=ci(),s=fMe(i,r,e)?r:null,n=this._get("extent");return sx(s,n)?n:s}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=oG(this.groundExtent,this._userClippingExtent,ci()),i=this._get("extent");return sx(e,i)?i:e}get groundExtent(){return v(this._tilingSchemeExtent)?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var e;return(e=this.tilingSchemeLogic)==null?void 0:e.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||this._watchUpdatingTracking.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||this.overlayManager.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view.map.ground.opacity}set baseOpacity(e){this.view.map.ground.opacity=e}get viewingMode(){return this.view.state.viewingMode}get ready(){return v(this._rootTiles)}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get rootTiles(){return this._rootTiles}get spatialReference(){var e;return((e=this.tilingScheme)==null?void 0:e.spatialReference)??null}get backgroundColor(){return this.view.map.ground.surfaceColor}set backgroundColor(e){this.view.map.ground.surfaceColor=e}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._evaluateTransparency()}get tilingSchemeLocked(){var e;return((e=this.tilingSchemeLogic)==null?void 0:e.tilingSchemeLocked)??!1}set velvetOverground(e){this._renderer.velvetOverground=e,this._set("velvetOverground",e)}get wireframe(){return this._renderer.wireframe}set wireframe(e){e!==this._renderer.wireframe&&(this._renderer.wireframe=e,this._updateAllTileGeometries())}set _visible(e){e!==this._visibleCached&&(this._visibleCached=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.transparency===Bn.Opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}get textureFadeDuration(){return this.view.qualitySettings.tiledSurface.textureFadeDuration??0}intersect(e,i,r,s){this._renderer.intersect(e,i,r,s)}getElevation(e,i,r,s){const n=this._rootTiles;if(C(n)||!n.length||n[0].layerInfo[Ti.ELEVATION].length===0)return null;const o=$l;return o[0]=e,o[1]=i,o[2]=r,_o(o,s,o,this._spatialReference)?gde(n,o[0],o[1]):(oe.getLogger(this.declaredClass).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null)}getElevations(e,i,r){const s=this._rootTiles,n=s?s[0].layerInfo[Ti.ELEVATION].length:0;if(!C(s)&&s.length&&n!==0)for(let o=0;o<i;++o){const a=3*o;r(o,gde(s,e[a+0],e[a+1]))}else for(let o=0;o<i;++o)r(o,null)}getScale(e){if(!this.tilingScheme)return null;if(!da(e,$l,this.spatialReference))return oe.getLogger(this.declaredClass).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const i=this._rootTiles;if(v(i)){for(const r of i)if(r!=null&&r.containsPoint($l)){let s=r;for(;s.children[0]&&!s.rendered;){const n=s.children[0].extent;let o=0;$l[0]>n[2]&&(o+=1),$l[1]<n[1]&&(o+=2),s=s.children[o]}return this._getLodBiasCorrectedScale(s.level)}}return 1/0}getSphereElevationBounds(e,i,r,s,n){var h;if($l[0]=e,$l[1]=i,$l[2]=r,$l[3]=s,!_o($l,n,$l,(h=this.tilingScheme)==null?void 0:h.spatialReference))return oe.getLogger(this.declaredClass).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let o=1/0,a=-1/0;const l=p=>{if(p&&Die(p.extent,$l))if(p.isLeaf||p.rendered)o=Math.min(o,p.elevationBounds[0]),a=Math.max(a,p.elevationBounds[1]);else for(const f of p.children)l(f)},c=this._rootTiles;if(v(c))for(const p of c)l(p);return{min:o,max:a}}getSphereScale(e,i){if(!this.tilingScheme)return null;if(!da(e,$l,this.spatialReference))return oe.getLogger(this.declaredClass).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;$l[3]=i;let r=null;const s=o=>{if(o&&Die(o.extent,$l)){const a=o.children;if(a[0]&&!o.rendered)for(const l of a)s(l);else{const l=this._getLodBiasCorrectedScale(o.level);r=r==null?l:Math.min(r,l)}}},n=this._rootTiles;if(v(n))for(const o of n)s(o);return r}queryVisibleScaleRange(e,i,r,s){const n=i?this.tilingScheme.levelAtScale(i):0,o=r?this.tilingScheme.levelAtScale(r):1/0,a=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(e,n+a,o+a,s)}_evaluateTransparency(){var o,a;const e=this.baseOpacity,i=this.overlayManager.renderer.isEmpty,r=this._renderer.transparency,s=this._allSurfaceLayersTransparent()?i?Bn.Empty:Bn.TransparentWithDraped:e>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?Bn.Opaque:Bn.Semitransparent,n=r!==s;return n&&(this._renderer.transparency=s,(a=(o=this.view)==null?void 0:o._stage)==null||a.renderer.setParameters({terrainTransparency:this._renderer.transparency})),n}_updateTilingScheme(){var r,s,n;const e=this.tilingSchemeLogic.tilingScheme;if(e===this.tilingScheme)return;cm(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((s=(r=this.view)==null?void 0:r.state)!=null&&s.isLocal),this.tilingScheme&&this._removeAllTiles();const i=(e==null?void 0:e.spatialReference)??mt.WebMercator;this._spatialReference=i,this._isWebMercator=!!(i!=null&&i.isWebMercator),this._isWebMercatorOnPlateeCarree=this._isWebMercator&&tZ((n=this.view)==null?void 0:n.renderSpatialReference),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles())}_acquireTile(e,i,r,s){const n=this._tilePool.acquire();return SD[0]=e,SD[1]=i,SD[2]=r,n.init(SD,s,this),n}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:i}=this;if(!i)return;const r=qxt;let s=i.rootTilesInExtent(e,r,5*XS);if(v(this._rootTiles)){if(s.length>XS)return void oe.getLogger(this.declaredClass).warn(SQe);const n=this._rootTiles.map(a=>a.lij),o=KLe(n,s,mde);if(this._updatingRootTiles=!0,o.removed.length>0||o.added.length>0){const a=this._rootTiles.filter(l=>!(o.removed.findIndex(c=>mde(c,l.lij))>-1)||(this._purgeTile(l),!1));o.added.forEach(l=>a.push(this._newRootTile(l))),this._setRootTiles(a)}}else this._updatingRootTiles=!0,s.length>XS&&(oe.getLogger(this.declaredClass).warn(EQe),s=i.rootTilesInExtent(e,r,XS)),this._setRootTiles(s.map(n=>this._newRootTile(n)));sx(r,this._rootTilesExtent)||(this._rootTilesExtent=ci(r)),this._visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const e=this._allTiles.filter(i=>i.isLoaded&&i.intersectsClippingArea);e.forEach(i=>this._renderer.updateTileGeometryState(i)),e.forEach(i=>i.renderData.updateNeighborData()),this._updateTilesGeometries(e),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(e){if(e.length===0)return;e.sort(Dy);const i=this.renderer;e.forEach(r=>i.updateGeometryIfNeeded(r)),e.forEach(r=>this._pendingTilesForElevationUpdateEvent.add(r))}_shouldSplit(e){return e.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===Dt.SPLIT}_newRootTile(e){const i=this._acquireTile(0,e[1],e[2],null);return this._shouldSplit(i)&&i.setPendingUpdate(Dt.SPLIT),this._loadTile(i),this._markTileToUpdate(i),this._updateRootTileElevationBounds(),i}_setRootTiles(e){if(this._rootTiles=e,this._allTiles.clear(),v(e)){const i=this._iteratorPool.acquire();for(i.reset(e);!i.done;)this._allTiles.push(i.next());i.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visibleCached&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(Dt.GEOMETRY)&&this._updateTileGeometryState(e)}_updateTilesVisibility(e){if(C(e))return;const i=$bt(e),r=this.visibleElevationBounds;let s=i?r.min:1/0,n=i?r.max:-1/0;const o=this.extent,a=this._viewProjectionMatrix;this.setTileTreeDirty();const l=this._iteratorPool.acquire();for(l.reset(e);!l.done;){const c=l.next();c.updateClippingStatus(o)&&c.resetPendingUpdate(Dt.GEOMETRY)&&this._updateTileGeometryState(c),c.setPendingUpdate(Dt.RENDERDATA),c.computeVisibility(),c.updateScreenDepth(a),c.renderData&&(s=Math.min(c.elevationBounds[0],s),n=Math.max(c.elevationBounds[1],n))}l.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._batchUpdatePendingTileGeometries(),isFinite(s)&&isFinite(n)&&(r.min!==s||r.max!==n)&&(this.visibleElevationBounds=new oE(s,n))}_updateRootTileElevationBounds(){let e=1/0,i=-1/0;const r=this._rootTiles;v(r)&&r.forEach(({elevationBounds:n})=>{e=Math.min(e,n[0]),i=Math.max(i,n[1])});const s=this.rootTileElevationBounds;s.min===e&&s.max===i||(this.rootTileElevationBounds=new oE(e,i))}_updateViewDependentParameters(){const{camera:e,contentCamera:i}=this.view.state,r=Math.tan(.5*i.fovX),s=Math.tan(.5*i.fovY),n=this.tilingScheme.pixelSize,o=2**-this._lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=r,this._splitLimits.fovY=s,this._splitLimits.relativeWidthLimit=n/e.width*this.maxTextureScale*o,this._splitLimits.relativeHeightLimit=n/e.height*this.maxTextureScale*o,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(C(this._splitLimits.frustum)&&(this._splitLimits.frustum=cP()),w5(this._splitLimits.frustum,i.frustum)):this._splitLimits.frustum=null,w5(this._frustum,e.frustum),Ts(this._viewProjectionMatrix,i.projectionMatrix,i.viewMatrix),he(this._eyePosRenderSR,i.eye),_o(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(T3e(e)?this._loadChildren(e):Hxt(e)&&this._loadParent(e))}_updateTileGeometryState(e){e.updateVisibility(),this._renderer.updateTileGeometryState(e)&&this._markTileToUpdate(e),this._usedMemory=null}_markAllTileNeighborsForGeometryUpdate(e){const i=this._pendingTilesToUpdate;e.forEachLoadedNeighbor(r=>{i.add(r)})}_updateTileTexture(e,i){const r=e.resetPendingUpdate(Dt.TEXTURE_FADING)?Dt.TEXTURE_FADING:!!e.resetPendingUpdate(Dt.TEXTURE_NOFADING)&&Dt.TEXTURE_NOFADING;r&&(this._renderer.updateTileTexture(e,r),this._usedMemory=null,i.madeProgress())}_emitElevationUpdateEventForTiles(){const e=sz.extent;yd(e),this._pendingTilesForElevationUpdateEvent.forEach(i=>Lv(e,i.extent,e)),this._pendingTilesForElevationUpdateEvent.clear(),sz.spatialReference=this.spatialReference,this.emit("elevation-change",sz)}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(e),this._sortTiles(e);const i=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,i),this._updateElevation(e),this._updateTextures(e),i||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._batchUpdatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),e.done&&e.hasProgressed?this.requestUpdate():this.getUsedMemory(),this.notifyChange("updatingProgressValue")}_updateAllTilesStatus(e){if(!this._viewChanged||!this._rootTiles||e.done)return;this._viewChanged=!1;const i=this._iteratorPool.acquire();i.reset(this._rootTiles);const r=this.snapLevel,s=this._splitLimits,n=this._eyePosRenderSR;for(;!i.done;){const o=i.next(),a=o.shouldSplit(s,n,r);if(a!==Dt.SPLIT){if(o.resetPendingUpdate(Dt.SPLIT)&&o.updateAgentSuspension(),a===Dt.VSPLITMERGE&&o.updateAgents(Ti.ELEVATION),i.skipSubtree(),!o.isLeaf){o.setPendingUpdate(Dt.MERGE),o.resetPendingUpdate(Dt.SPLIT);const l=this._iteratorPool.acquire();l.resetOne(o);const c=this._viewProjectionMatrix;for(let h=l.next();!l.done;h=l.next())this._updateClippingStatus(h),h.updateVisibility(),h.updateScreenDepth(c);l.remove()}}else o.resetPendingUpdate(Dt.MERGE),o.isLeaf&&(o.setPendingUpdate(Dt.SPLIT),i.skipSubtree()),o.rendered&&o.setPendingUpdate(Dt.RENDERDATA)}i.remove(),this.requestUpdate(),(this.shortBatches||!this.oneBatchPerFrameTask)&&this._batchUpdatePendingTileGeometries(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(Pbt(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_markTileToUpdate(e){Be(e.isLoaded),e.intersectsClippingArea&&(this._pendingTilesToUpdate.add(e),this._markAllTileNeighborsForGeometryUpdate(e))}_batchUpdatePendingTileGeometries(){const e=this._pendingTilesToUpdate;if(e.size===0)return;const i=Array.from(this._pendingTilesToUpdate.keys()).filter(n=>n.isLoaded&&n.intersectsClippingArea),r=(n,o)=>{!(o!=null&&o.isLoaded)||!o.intersectsClippingArea||o.level<n.level||e.has(o)||(e.add(o),i.push(o),o.renderData.updateNeighborData())};i.sort(Dy);const s=i.length;for(let n=0;n<s;++n){const o=i[n];Be(o.isLoaded),Be(o.intersectsClippingArea);const a=o.renderData;a.updateNeighborData();const l=a._dirtyEdgeResolutions,c=a.geometryState.neighborData;for(let h=0;h<4;++h)if(l&1<<h){const p=a.geometryState.neighborData.edgePeerNeighbors[h];p&&(p==null?void 0:p.level)>=o.level&&p.forAllSubtreeOnSide(c6(Tm[h]),f=>!(!f.isLoaded||!f.intersectsClippingArea)&&(Be(e.has(f)||Dy(o,f)<0),r(o,f),!0)),r(o,c.cornerPeerNeighbors[h]),r(o,c.cornerPeerNeighbors[(h+1)%4])}}e.clear(),this._updateTilesGeometries(i),Ln&&o6&&this.checkAllTilesWaterproofness()}_mergeAndSplit(e,i){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let r=!1;const s=this.view.state.fixedContentCamera;let n=!1;for(;!e.done;){n=!0;let o=!1;const a=!this._allTiles.some(l=>{var h;if(!r&&!s&&!l.visible)return e.done;let c=l;if(l.resetPendingUpdate(Dt.MERGE)){if(!i)return l.setPendingUpdate(Dt.MERGE),e.done;for(;(h=c.parent)!=null&&h.resetPendingUpdate(Dt.MERGE);)c=c.parent;this._mergeTile(c),o=!0,e.madeProgress()}else l.resetPendingUpdate(Dt.SPLIT)&&(this._splitTile(l),o=!0,e.madeProgress());return!e.done&&c===l&&l.resetPendingUpdate(Dt.RENDERDATA)&&(this._updateRenderData(l),e.madeProgress()),e.done});if(o&&(this._allTilesSorted=!1,this._allTilesDirty=!0),a){if(!r){r=!0;continue}if(!o)break}else this._allTilesDirty=!0}n?e.madeProgress():this._allTilesDirty=!0,!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries(),this._sortTiles(e)}_updateElevation(e){e.done||(this._allTiles.some(i=>(i.resetPendingUpdate(Dt.GEOMETRY)&&(this._updateTileGeometryState(i),this._updateTileTexture(i,e),this.shortBatches&&this._batchUpdatePendingTileGeometries(),e.madeProgress()),e.done)),!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries())}_updateTextures(e){e.done||this._allTiles.some(i=>(this._updateTileTexture(i,e),e.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(Fs.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*xQe}_getLodBiasCorrectedScale(e){const i=this.tilingScheme.levels,r=we(e-this._lodBias,0,i.length-1),s=r-Math.floor(r);return i[Math.floor(r)].scale*(1-s)+i[Math.ceil(r)].scale*s}_removeAllTiles(){v(this._rootTiles)&&(this._rootTiles.forEach(e=>this._purgeTile(e)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this._visible=!1}_purgeDescendantTiles(e){if(!e.children[0])return!1;let i=!1;for(let r=0;r<4;++r)i=this._purgeTile(e.children[r])||i;return e.unsetChildren(),i}_purgeTile(e){const i=this._purgeDescendantTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),this._unloadTile(e),this._tilePool.release(e),i}_unloadTile(e){this._pendingTilesToUpdate.delete(e),this._pendingTilesForElevationUpdateEvent.delete(e),e.unload(this._renderer)}_splitTile(e){cm(e.isLeaf,"tile that is already split should not be split again!");const i=e.level+1,r=2*e.lij[1],s=2*e.lij[2];e.setChildren(this._createTile(i,r,s,e),this._createTile(i,r,s+1,e),this._createTile(i,r+1,s,e),this._createTile(i,r+1,s+1,e)),e.setPendingUpdate(Dt.RENDERDATA),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,++this._performanceInfo.numSplit}_emitTileScaleChange(e,i=e.level){ED.spatialReference=this.spatialReference,ED.extent=e.extent,ED.scale=this._getLodBiasCorrectedScale(i),this.emit("scale-change",ED)}_createTile(e,i,r,s){cm(!!s,"_createTile sanity check");const n=this._acquireTile(e,i,r,s);return n.updateClippingStatus(this.extent),n.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(n)&&n.setPendingUpdate(Dt.SPLIT),n}get shortBatches(){return this.view.state.mode!==Mi.IDLE}_mergeTile(e){cm(!e.hasPendingUpdate(Dt.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(e)&&(cm(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),this._markTileToUpdate(e),this._emitTileScaleChange(e),this.shortBatches&&this._batchUpdatePendingTileGeometries()),this._allTilesDirty=!0,++this._performanceInfo.numMerged}_loadChildren(e){cm(e.rendered,"parent should be rendered"),this._unloadTile(e);const i=e.children;i.forEach(r=>this._loadTile(r)),i.forEach(r=>this._pendingTilesToUpdate.add(r)),this._markAllTileNeighborsForGeometryUpdate(e),this._emitTileScaleChange(e,e.level+1),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_loadParent(e){const i=e.parent;this._unloadChildren(i),this._loadTile(i),this._markTileToUpdate(i),this._emitTileScaleChange(i,i.level),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_unloadChildren(e){const i=e.children;if(i[0])for(let r=0;r<4;++r){const s=i[r];this._unloadChildren(s),this._unloadTile(s)}}_loadTile(e){e.load(),e.setPendingUpdate(Dt.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e)}_elevationDataArrived(e,i,r){const s=new ubt(e.lij,e.extent,r);e.dataArrived(i,Ti.ELEVATION,s);const n=[e],o=e.level,a=this._iteratorPool.acquire();for(a.reset(n);!a.done;){const l=a.next();l.findElevationBoundsForLayer(i,o),l.computeElevationBounds()}o===0&&this._updateRootTileElevationBounds(),a.remove(),this._updateTilesVisibility(n)}_handleLayerViewChanges(e=ll){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let i=!1;const r=new Set;let s=-1;for(const n of this.view.allLayerViews.items)if(r.add(n.uid),$P(n)||RO(n))if(this._basemapLayerViewHandles.has(n.uid)&&!RO(n)){const o=this._layerClassFromLayerView(n),a=this._getLayerIdxByUID(o,n.uid);v(a)&&((a<s||C(s))&&(i=!0),s=a)}else this._registerTiledLayerView(n),n.layer.loaded&&(i=!0);this._basemapLayerViewHandles.forEach((n,o)=>{r.has(o)||(this._unregisterTiledLayerView(o),i=!0)}),i&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),e.madeProgress()}_allSurfaceLayersTransparent(){var i,r;let e=((r=(i=this.view.map)==null?void 0:i.ground)==null?void 0:r.opacity)===0;for(const s of this.view.allLayerViews.items)if(xX(s)&&!kve(s.layer)&&s.fullOpacity!==0)return e=!1,e;return e}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if((l6(e)||RO(e))&&Vbt(AX[e.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(e){return wX(e)?Ti.ELEVATION:Ti.MAP}_registerTiledLayerView(e){const i=[];if((l6(e)||RO(e))&&i.push(re(()=>e.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(On.UNFADED)})),RO(e))return;const r=this._layerClassFromLayerView(e);i.push(re(()=>e.suspended,()=>this._updateTiledLayers())),i.push(re(()=>e.fullOpacity,()=>this._updateTileTextures(On.UNFADED))),i.push(re(()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null,()=>this._restartAllAgents(r))),e.on("data-changed",()=>{const s=this._getLayerIdxByUID(r,e.uid);v(s)&&this._invalidateLayerData(s,r)}),this._basemapLayerViewHandles.set(e.uid,i)}_unregisterTiledLayerView(e){const i=this._basemapLayerViewHandles.get(e);if(i){for(let r=0;r<i.length;r++)i[r].remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,i=[[],[]];let r=null;e.forEach(s=>{if(!s.layer||s.suspended||!$P(s)||!s.fullExtent)return;const n=this._layerClassFromLayerView(s);if(n===Ti.MAP){const o=s.displayLevelRange.maxLevel;o!==1/0&&(r===null||o>r)&&(r=o)}i[n].push(s)});for(const s of hw){const n=this._layerViews[s],o=i[s];o.reverse();const a=o.length;let l=n.length!==a;const c=new Array(a),h=new Array(n.length);this._layerIndexByUid[s].clear();for(let p=0;p<a;p++){const f=o[p].uid;this._layerIndexByUid[s].set(f,p);const m=n.indexOf(o[p]);c[p]=m,p!==m&&(l=!0),m>-1&&(h[m]=p)}if(l){const p=this._postorderIterator;for(p.reset(this._rootTiles);!p.done;)p.next().modifyLayers(h,c,s);this._layerViews[s]=o,this._restartAllAgents(s),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(r)&&this._viewChangeUpdate()}_restartAllAgents(e){const i=this._postorderIterator;for(i.reset(this._rootTiles);!i.done;){const r=i.next();r.restartAgents(e),e===Ti.ELEVATION&&r.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(e,i){return this._layerViews[i][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(i=>{i.updateAgents(Ti.MAP),e===On.IMMEDIATE?this.renderer.updateTileTexture(i,Dt.TEXTURE_NOFADING):i.updateRenderData(Ti.MAP,e)}),this._evaluateTransparency()}_invalidateLayerData(e,i){this._allTiles.forAll(r=>r.removeLayerAgent(e,i)),this._allTiles.forAll(r=>r.invalidateLayerData(e,i))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=Fs.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(e,i,r,s){const n=this.layerViewByIndex(i,r),o=n.layer;return!o.tilemapCache||IP(n)?this._requestTileData(e,r,n,s):(++this._asyncWorkItems,o.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],{...s,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(a=>{throw--this._asyncWorkItems,gi(s),ln(a)||this._dataMissing(e,r,n,{notInTilemap:!0}),a}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,r,n,s),s.signal)))}_requestTileData(e,i,r,s){return i===Ti.ELEVATION?wX(r)?this._requestElevationTileData(e,r,s):Promise.reject():xX(r)?this._requestMapTileData(e,r,s):Promise.reject()}_requestElevationTileData(e,i,r){++this._asyncWorkItems;const s=a=>{if(qn(r))return;const l=this._layerIndexByUid[Ti.ELEVATION].get(i.uid);l!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(e,l,a)):oe.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer %d %s",Ti.ELEVATION,e.lij.toString())},n=a=>{ln(a)||(this._dataMissing(e,Ti.ELEVATION,i,a),this.requestUpdate())};if(Ihe(i.layer))return i.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:iP,signal:r.signal}).then(a=>{if(!qn(r))return this._frameTask.schedule(()=>s(a),r.signal,n);oe.getLogger(this.declaredClass).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},n).finally(()=>{--this._asyncWorkItems});const o=i.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(o,"binary",r).then(a=>this._lercDecoder.decode(a,{noDataValue:iP},r.signal)).then(a=>{a?s(new Y1t(a)):n(new Error("LERC decoding failed"))},n).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(e,i,r){++this._asyncWorkItems;const s=(h,p)=>{--this._asyncWorkItems,UE(p),qn(r)||(this._dataMissing(e,Ti.MAP,i,h),this.requestUpdate())},n=h=>p=>s(p,h),o=h=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),qn(r)?UE(h):this._mapTileDataArrived(e,i,h)},r.signal,n(h)).catch(n(h)),a=(h,p=null)=>this._frameTask.schedule(()=>s(h,p));if(IP(i)){const h=i.schemaHelper.getLevelRowColumn(e.lij);return i.fetchTile(h[0],h[1],h[2],r).then(o,a)}if(W8(i))return i.fetchTile(e.lij[0],e.lij[1],e.lij[2],r).then(o,a);if(qee(i)&&Ihe(i.layer))return i.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],r).then(h=>{if(qn(r))return oe.getLogger(this.declaredClass).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void a(Bi());o(h)},a);let l=i.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);PJe(i.layer)&&i.layer.refreshTimestamp&&(l+=`${l.includes("?")?"&":"?"}_ts=${i.layer.refreshTimestamp}`);const c=i.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(l,c,r).then(o,a)}_mapTileDataArrived(e,i,r){const s=this._getLayerIdxByUID(Ti.MAP,i.uid);v(s)?e.dataArrived(s,Ti.MAP,r):(UE(r),oe.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(e,i){return this._layerIndexByUid[e].get(i)}_dataMissing(e,i,r,s){const n=this._getLayerIdxByUID(i,r.uid);v(n)?e.dataMissing(n,i,s):oe.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(i=>{i.renderData&&this.overlayManager.setTileParameters(i)}),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(i=>{i.isLeaf&&e.numLeaves++;const r=i.level;i.renderData&&(e.numLoadedPerLevel[r]=(e.numLoadedPerLevel[r]||0)+1),i.visible&&(e.numVisible++,i.rendered&&(e.numRenderedPerLevel[r]=(e.numRenderedPerLevel[r]||0)+1,e.numRendered++))}),e}getUsedMemory(){return this.tilingScheme?(C(this._usedMemory)&&(this._usedMemory=this._recalculateUsedMemory()),v(this._usedMemory)?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce((e,i)=>e+i.usedMemory,0):null}getUsedMemoryForLayerView(e){let i=0;const r=this._layerClassFromLayerView(e),s=this._getLayerIdxByUID(r,e.uid);return v(s)&&this._allTiles.forAll(n=>i+=n.getUsedMemoryForLayer(r,s)),i}getTile(e){if(C(e)||C(this._rootTiles))return null;const i=e.split("/").map(a=>+a);if(i[0]===0)return this._rootTiles.find(a=>a.lij[1]===i[1]&&a.lij[2]===i[2]);const r=2**i[0],s=Math.floor(i[1]/r),n=Math.floor(i[2]/r);let o;if(this._rootTiles.some(a=>a.lij[1]===s&&a.lij[2]===n&&(o=a,!0)),o){let a=1<<i[0]-1;for(;o.lij[0]<i[0];){let l=i[1]&a?2:0;if((i[2]&a)>0&&l++,!o.children[l])return null;o=o.children[l],a>>=1}return cm(o.lij[0]===i[0]&&o.lij[1]===i[1]&&o.lij[2]===i[2],"not the right tile?"),o}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(e){this._renderer.renderPatchBorders=e}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(e){this._renderer.visualizeNormals=e}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(e){this._renderer.renderingDisabled=e}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{v(e._rootTiles)&&e._rootTiles.length>0&&(e._mergeTile(e._rootTiles[0]),e._viewChangeUpdate())},getTiles:()=>e._allTiles.toArray(),getRenderedTiles(){rz.clear(),e._allTiles.forAll(r=>{r.visible&&r.rendered&&rz.push(r)});const i=rz.toArray();return LMe(e.renderOrder,i),i},lockTilingScheme(i,r){e._extentHelper.defaultTiledLayersExtent=r,e.tilingSchemeLogic.test.lockTilingScheme(i)}}}checkAllTilesWaterproofness(){if(!o6)return;const e=this._rootTiles;if(C(e))return;const i=o=>{var a,l,c;return((c=(l=(a=o==null?void 0:o.renderData)==null?void 0:a.geometryInfo)==null?void 0:l.indices)==null?void 0:c.length)>0},r=(o,a)=>{i(o)&&console.error("Tile[",o.lij,"] has geometry although parent[",a.lij,"] has geom")},s=o=>{var a,l;if(o.intersectsClippingArea)if(o.renderData&&!o.renderData.geometryState&&console.error("Tile[",o.lij,"] has renderData but not geometryState"),o.renderData&&!o.renderData.geometryInfo&&console.error("Tile[",o.lij,"] has renderData but not geometryInfo"),!((a=o.renderData)!=null&&a.geometryInfo)||(((l=o.renderData.geometryInfo.indices)==null?void 0:l.length)??0)>0||console.error("Tile[",o.lij,"] has renderData but no indices - geometryInfo: ",o.renderData.geometryInfo),i(o)){o.checkGeometryWaterproofness();for(const c of o.children)r(c,o)}else if(o.isLeaf)console.error("Tile[",o.lij,"] has no geometry and no children, from root to leaf");else for(const c of o.children)s(c)},n=o=>{var h;const a=((h=o.parent)==null?void 0:h.visible)??!0,l=o.visible;o.computeVisibility();const c=o.visible;if(l!==c&&a&&console.error(" Tile[",o.lij,"] has out of date visibility: ",l," instead of ",c),!o.isLeaf)for(const p of o.children)n(p)};for(const o of e)s(o),n(o)}get isGlobal(){return this._isGlobal}get shading(){return this._shading}_updateShadingIfChanged(){var i,r,s;((s=(r=(i=this.view)==null?void 0:i.map)==null?void 0:r.ground)==null?void 0:s.shading)!==this._shading&&this._updateShading()}_updateShading(){var i,r,s;const e=(s=(r=(i=this.view)==null?void 0:i.map)==null?void 0:r.ground)==null?void 0:s.shading;this._shading=e,this.renderer&&(this.renderer.shading=e,this.renderer.setNeedsRender()),this._updateAllTileGeometries()}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateeCarree(){return this._isWebMercatorOnPlateeCarree}isEastEndWrap(e){return this.isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this.isGlobal&&e[2]===0}lijEastEnd(e){return 2**(e+(v(this.spatialReference)&&this.spatialReference.isGeographic?1:0))}wrapEastWest(e){const i=this.lijEastEnd(e[0]),r=e[2];if(0<=r&&r<i)return e;if(!this.isGlobal)return null;const s=(r+(r<0?i:0))%i;return[e[0],e[1],s]}enableInternalChecks(e){y1t(e)}enableWaterproofnessChecks(e){g1t(e)}};u([d()],di.prototype,"_renderer",void 0),u([d({constructOnly:!0})],di.prototype,"_scaleRangeQueries",void 0),u([d()],di.prototype,"_hasPendingUpdates",void 0),u([d()],di.prototype,"_asyncWorkItems",void 0),u([d()],di.prototype,"_allTilesDirty",void 0),u([d()],di.prototype,"_allTilesSorted",void 0),u([d()],di.prototype,"_viewChanged",void 0),u([d({readOnly:!0})],di.prototype,"_watchUpdatingTracking",void 0),u([d()],di.prototype,"_frameTask",void 0),u([d({readOnly:!0})],di.prototype,"snapLevel",null),u([d({readOnly:!0})],di.prototype,"lodSnapping",null),u([d({constructOnly:!0})],di.prototype,"view",void 0),u([d()],di.prototype,"_userClippingExtent",null),u([d()],di.prototype,"_rootTilesExtent",void 0),u([d({readOnly:!0})],di.prototype,"extent",null),u([d({readOnly:!0})],di.prototype,"groundExtent",null),u([d({readOnly:!0})],di.prototype,"_tilingSchemeExtent",null),u([d({readOnly:!0})],di.prototype,"updating",null),u([d({readOnly:!0})],di.prototype,"running",null),u([d(lbt)],di.prototype,"updatingProgress",void 0),u([d({readOnly:!0})],di.prototype,"updatingProgressValue",null),u([d()],di.prototype,"_maxNumUpdating",void 0),u([d()],di.prototype,"baseOpacity",null),u([d()],di.prototype,"hasCompositeBlendMode",void 0),u([d({readOnly:!0})],di.prototype,"overlayManager",void 0),u([d({readOnly:!0})],di.prototype,"viewingMode",null),u([d()],di.prototype,"maxTextureScale",void 0),u([d({readOnly:!0})],di.prototype,"ready",null),u([d({value:BC.FRONT_TO_BACK})],di.prototype,"renderOrder",null),u([d({readOnly:!0})],di.prototype,"rootTiles",null),u([d()],di.prototype,"_rootTiles",void 0),u([d({readOnly:!0})],di.prototype,"spatialReference",null),u([d({type:ot})],di.prototype,"backgroundColor",null),u([d({value:!1})],di.prototype,"slicePlaneEnabled",null),u([d({readOnly:!0})],di.prototype,"tilingScheme",void 0),u([d({readOnly:!0})],di.prototype,"tilingSchemeLocked",null),u([d({readOnly:!0})],di.prototype,"tilingSchemeLogic",void 0),u([d({value:!0})],di.prototype,"velvetOverground",null),u([d()],di.prototype,"wireframe",null),u([d({value:!1})],di.prototype,"suspended",null),u([d()],di.prototype,"textureFadeDuration",null),u([d()],di.prototype,"visibleElevationBounds",void 0),u([d()],di.prototype,"rootTileElevationBounds",void 0),u([d()],di.prototype,"_layerViewsDirty",void 0),u([d()],di.prototype,"renderPatchBorders",null),u([d()],di.prototype,"visualizeNormals",null),u([d()],di.prototype,"renderingDisabled",null),di=u([I("esri.views.3d.terrain.TerrainSurface")],di);const jxt=di;function mde(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function T3e(t){const e=t.children;if(!e[0])return!1;for(const i of e)if(i.shouldLoad)return!0;for(const i of e)if(T3e(i))return!0;return!1}function Hxt(t){var e;return t.isLeaf&&(((e=t.parent)==null?void 0:e.shouldLoad)??!1)}const $l=fi(),qxt=ci(),SD=[0,0,0],rz=new li,sz={spatialReference:null,extent:ci(),context:"ground"},ED={spatialReference:null,extent:null,scale:0};function gde(t,e,i){var r;for(const s of t){if(!s.containsPointXY(e,i))continue;let n=s;for(;n&&!n.renderData;){const a=(e>n.extentMidX?1:0)+(i<n.extentMidY?2:0);n=n.children[a]}const o=((r=n==null?void 0:n.renderData)==null?void 0:r.geometryState.samplerData)??null;return Xr(e,i,o)}return null}let Wxt=class{constructor(e,i,r){this.operation=e,this.geometry=i,this.states=r}},hM=class extends $e{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,i){const r=this._dirtyGeomRecords.get(e);r&&(r.forEach((s,n)=>{const o=this._ensureGeomRecord(e,n);s.forEach(({geometry:a,operation:l,states:c},h)=>{let p=!1;if(l===ds.UPDATE){const f=o.get(h);if(f){if(c&Gn.TRANSFORMATION){const m=this.model.getObject(n);this.model.updateRenderGeometryTransformation(m,a,f)&&(p=!0)}p||i.updates.push({renderGeometry:f,updateType:c})}else Ct(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(l===ds.REMOVE||p){const f=o.get(h);f?(i.removes.push(f),o.delete(h)):l===ds.REMOVE&&Ct(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(l===ds.ADD||p){const f=this.model.getObject(n);if(v(f)){const m=this.model.getRenderGeometry(f,a);i.adds.push(m),o.set(h,m)}}}),o.size===0&&this._residentGeomRecords.get(e).delete(n)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}getResidentRenderGeometries(e,i){const r=this._residentGeomRecords.get(e);r&&r.forEach(s=>s.forEach(n=>i.push(n)))}_objectStateChanged(e,i){for(const r of i.geometries)this._updateOrCreateDirtyRecord(i,r,null,ds.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(Gn.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(Gn.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(Gn.OCCLUDEE,e)}objectGeometryUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.geometry,null,ds.UPDATE,Gn.GEOMETRY)}layerAdded(e){e.objects.forAll(i=>this._layerObjectAdded(e,i))}layerRemoved(e){e.objects.forAll(i=>this._layerObjectRemoved(e,i))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,i){const r=e.id;for(const s of i.geometries)this._objectGeometryAdded(i,s,r)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const i of e.objects)this._layerObjectAdded(e.layer,i)}layerObjectsRemoved(e){for(const i of e.objects)this._layerObjectRemoved(e.layer,i)}_layerObjectRemoved(e,i){const r=e.id;for(const s of i.geometries)this._objectGeometryRemoved(i,s,r)}shaderTransformationChanged(e){const i=this._residentGeomRecords.get(e.id);i&&i.forEach((r,s)=>{const n=this.model.getObject(s);n&&n.hasVolativeTransformation()&&r.forEach(o=>o.shaderTransformationChanged())})}objectTransformation(e){const i=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(i,r).forEach(s=>{this._updateOrCreateDirtyRecord(e,s.geometry,i,ds.UPDATE,Gn.TRANSFORMATION)})}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.geometry)}_objectGeometryAdded(e,i,r=null){this._updateOrCreateDirtyRecord(e,i,r,ds.ADD)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.geometry)}_objectGeometryRemoved(e,i,r=null){this._updateOrCreateDirtyRecord(e,i,r,ds.REMOVE)}_updateOrCreateDirtyRecord(e,i,r,s,n=Gn.NONE){r=Gt(r,this._getParentLayerId(e));const o=e.id,a=i.id,l=this._ensureDirtyRecord(r,o),c=l.get(a);if(c){const h=c.operation;h===ds.REMOVE&&s===ds.ADD&&c.states!==Gn.NONE?c.operation=ds.UPDATE:h===ds.REMOVE&&s===ds.ADD||h===ds.ADD&&s===ds.REMOVE?l.delete(a):h!==ds.UPDATE||s!==ds.REMOVE&&s!==ds.UPDATE?(Ct((h===ds.REMOVE||h===ds.ADD)&&s===ds.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),c.states|=n):(c.operation=s,c.states|=n)}else l.set(a,new Wxt(s,i,n));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,i){let r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));let s=r.get(i);return s||(s=new Map,r.set(i,s)),s}get _hasDirtyGeometryRecords(){return Vo(this._dirtyGeomRecords,e=>Vo(e,i=>i&&i.size>0))}_ensureDirtyRecord(e,i){let r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));let s=r.get(i);return s||(s=new Map,r.set(i,s)),s}_getParentLayerId(e){return v(e.parentLayer)?e.parentLayer.id:JDe}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let i="";return this._dirtyGeomRecords.forEach((r,s)=>{r.forEach((n,o)=>{i.length>0&&(i+=`
`),i+=s+"."+o;const a=[];n.forEach(l=>{const c=l.operation;a[c]||(a[c]=[]),a[c].push(l.geometry.id)});for(let l=0;l<a.length;l++)if(a[l]){i+=" "+e[l-1]+": ";for(let c=0;c<a[l].length;c++)i+=a[l][c]+", "}})}),i}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((i,r)=>i+r.size,0)},commit:i=>e._dirtyGeomRecords.forEach((r,s)=>e.commitLayer(s,i))}}};u([d({constructOnly:!0})],hM.prototype,"model",void 0),u([d()],hM.prototype,"dirty",void 0),hM=u([I("esri.views.3d.webgl-engine.lib.ModelDirtySet")],hM);const Xxt=hM;let kF=class extends $e{constructor(){super(...arguments),this.dirtySet=new Xxt({model:this}),this._content=new Map,this._originFactory=new Tee(null)}getObject(e){return this._content.get(e)}add(e){const i=e.id;Ct(!this._content.has(i),"Model/Stage already contains object to be added"),this._content.set(i,e),Z5(e)&&this.dirtySet.layerAdded(e)}remove(e){Ct(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),Z5(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const i of e)v(i)&&(Ct(!this._content.has(i.id),"Model/Stage already contains object to be added"),this._content.set(i.id,i))}removeMany(e){for(const i of e)Ct(this._content.has(i.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(i.id),i.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,i){this._content.forEach(r=>{r.type===e&&i(r)})}getRenderGeometry(e,i){const{shaderTransformer:r,localOrigin:s}=i,n=new VC(i,{boundingInfo:i.boundingInfo,shaderTransformer:r,castShadow:e.castShadow});return n.updateTransformation(o=>e.getCombinedStaticTransformation(i,o)),n.localOrigin=v(s)?s:this._originFactory.getOrigin(n.boundingSphere),n}updateRenderGeometryTransformation(e,i,r){if(C(e))return!1;r.updateTransformation(n=>e.getCombinedStaticTransformation(i,n));const s=this._originFactory.getOrigin(r.boundingSphere);return r.localOrigin!==s}getStats(){const e={},i=Array.from(this._content.values());for(let r=0;r<Vs.COUNT;++r)e[r]=i.filter(s=>s.type===r).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};u([d({constructOnly:!0})],kF.prototype,"dirtySet",void 0),kF=u([I("esri.views.3d.webgl-engine.parts.Model")],kF);function Yxt(){const t=new Float32Array(4);return t[3]=1,t}function S3e(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Zxt(t,e,i,r){const s=new Float32Array(4);return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function E3e(t,e){return new Float32Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:S3e,create:Yxt,createView:E3e,fromValues:Zxt},Symbol.toStringTag,{value:"Module"}));const zC=1e-6,LO=[0,0,0],CD=[0,0,0];function Jxt(t,e){const{data:i,size:r}=t,s=i.length/r;if(s<=0)return;const n=new oTt(t);BF(LO,n.minProj,n.maxProj),Uw(LO,LO,.5),Jh(CD,n.maxProj,n.minProj);const o=DX(CD),a=new aTt;a.quality=o,s<14&&(t=new ht(new Float64Array(n.buffer,112,42),3));const l=[0,0,0],c=[0,0,0],h=[0,0,0],p=[0,0,0],f=[0,0,0],m=[0,0,0],y=[0,0,0];switch(Kxt(n,t,y,l,c,h,p,f,m,a)){case 1:return void bde(LO,CD,e);case 2:return void nTt(t,p,e)}Qxt(t,y,l,c,h,p,f,m,a),C3e(t,a.b0,a.b1,a.b2,BE,zE);const _=[0,0,0];Jh(_,zE,BE),a.quality=DX(_),a.quality<o?A3e(a.b0,a.b1,a.b2,BE,zE,_,e):bde(LO,CD,e)}function Kxt(t,e,i,r,s,n,o,a,l,c){return eTt(t,r,s),NX(r,s)<zC?1:(Jh(o,r,s),ea(o,o),tTt(e,r,o,n)<zC?2:(Jh(a,s,n),ea(a,a),Jh(l,n,r),ea(l,l),Kh(i,a,o),ea(i,i),dw(e,i,o,a,l,c),0))}const DO=[0,0,0],NO=[0,0,0],gh=[0,0,0],yh=[0,0,0],_h=[0,0,0],s_=[0,0,0],n_=[0,0,0],o_=[0,0,0];function Qxt(t,e,i,r,s,n,o,a,l){iTt(t,e,i,DO,NO),DO[0]!==void 0&&(Jh(gh,DO,i),ea(gh,gh),Jh(yh,DO,r),ea(yh,yh),Jh(_h,DO,s),ea(_h,_h),Kh(s_,yh,n),ea(s_,s_),Kh(n_,_h,o),ea(n_,n_),Kh(o_,gh,a),ea(o_,o_),dw(t,s_,n,yh,gh,l),dw(t,n_,o,_h,yh,l),dw(t,o_,a,gh,_h,l)),NO[0]!==void 0&&(Jh(gh,NO,i),ea(gh,gh),Jh(yh,NO,r),ea(yh,yh),Jh(_h,NO,s),ea(_h,_h),Kh(s_,yh,n),ea(s_,s_),Kh(n_,_h,o),ea(n_,n_),Kh(o_,gh,a),ea(o_,o_),dw(t,s_,n,yh,gh,l),dw(t,n_,o,_h,yh,l),dw(t,o_,a,gh,_h,l))}function eTt(t,e,i){let r=NX(t.maxVert[0],t.minVert[0]),s=0;for(let n=1;n<7;++n){const o=NX(t.maxVert[n],t.minVert[n]);o>r&&(r=o,s=n)}Yc(e,t.minVert[s]),Yc(i,t.maxVert[s])}const vh=[0,0,0];function tTt(t,e,i,r){const{data:s,size:n}=t;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<s.length;l+=n){vh[0]=s[l]-e[0],vh[1]=s[l+1]-e[1],vh[2]=s[l+2]-e[2];const c=i[0]*vh[0]+i[1]*vh[1]+i[2]*vh[2],h=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],p=vh[0]*vh[0]+vh[1]*vh[1]+vh[2]*vh[2]-c*c/h;p>o&&(o=p,a=l)}return Yc(r,s,a),o}const zn=[0,0];function iTt(t,e,i,r,s){sTt(t,e,zn,s,r);const n=R3e(i,e);zn[1]-zC<=n&&(r[0]=void 0),zn[0]+zC>=n&&(s[0]=void 0)}const yde=[0,0,0],_de=[0,0,0],vde=[0,0,0],v2=[0,0,0],b2=[0,0,0],AD=[0,0,0];function dw(t,e,i,r,s,n){if(O3e(e)<zC)return;Kh(yde,i,e),Kh(_de,r,e),Kh(vde,s,e),kE(t,e,zn),b2[1]=zn[0],v2[1]=zn[1],AD[1]=v2[1]-b2[1];const o=[i,r,s],a=[yde,_de,vde];for(let l=0;l<3;++l){kE(t,o[l],zn),b2[0]=zn[0],v2[0]=zn[1],kE(t,a[l],zn),b2[2]=zn[0],v2[2]=zn[1],AD[0]=v2[0]-b2[0],AD[2]=v2[2]-b2[2];const c=DX(AD);c<n.quality&&(Yc(n.b0,o[l]),Yc(n.b1,e),Yc(n.b2,a[l]),n.quality=c)}}const rTt=[0,0,0];function kE(t,e,i){const{data:r,size:s}=t;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<r.length;n+=s){const o=r[n]*e[0]+r[n+1]*e[1]+r[n+2]*e[2];i[0]=Math.min(i[0],o),i[1]=Math.max(i[1],o)}}function sTt(t,e,i,r,s){const{data:n,size:o}=t;Yc(r,n),Yc(s,r),i[0]=R3e(rTt,e),i[1]=i[0];for(let a=o;a<n.length;a+=o){const l=n[a]*e[0]+n[a+1]*e[1]+n[a+2]*e[2];l<i[0]&&(i[0]=l,Yc(r,n,a)),l>i[1]&&(i[1]=l,Yc(s,n,a))}}function bde(t,e,i){Yc(i.center,t),Uw(i.halfSize,e,.5),i.quaternion[0]=0,i.quaternion[1]=0,i.quaternion[2]=0,i.quaternion[3]=1}const Mg=[0,0,0],w2=[0,0,0],FO=[0,0,0],BE=[0,0,0],zE=[0,0,0],wde=[0,0,0];function nTt(t,e,i){Yc(Mg,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?Mg[0]=0:Math.abs(e[1])>Math.abs(e[2])?Mg[1]=0:Mg[2]=0,O3e(Mg)<zC&&(Mg[0]=Mg[1]=Mg[2]=1),Kh(w2,e,Mg),ea(w2,w2),Kh(FO,e,w2),ea(FO,FO),C3e(t,e,w2,FO,BE,zE),Jh(wde,zE,BE),A3e(e,w2,FO,BE,zE,wde,i)}function C3e(t,e,i,r,s,n){kE(t,e,zn),s[0]=zn[0],n[0]=zn[1],kE(t,i,zn),s[1]=zn[0],n[1]=zn[1],kE(t,r,zn),s[2]=zn[0],n[2]=zn[1]}const OD=[0,0,0],Mf=[1,0,0,0,1,0,0,0,1],x2=[0,0,0];function A3e(t,e,i,r,s,n,o){Mf[0]=t[0],Mf[1]=t[1],Mf[2]=t[2],Mf[3]=e[0],Mf[4]=e[1],Mf[5]=e[2],Mf[6]=i[0],Mf[7]=i[1],Mf[8]=i[2],lTt(o.quaternion,Mf),BF(x2,r,s),Uw(x2,x2,.5),Uw(o.center,t,x2[0]),Uw(OD,e,x2[1]),BF(o.center,o.center,OD),Uw(OD,i,x2[2]),BF(o.center,o.center,OD),Uw(o.halfSize,n,.5)}const yu=7;let oTt=class{constructor(e){this.minVert=new Array(yu),this.maxVert=new Array(yu);const i=64*yu;this.buffer=new ArrayBuffer(i);let r=0;this.minProj=new Float64Array(this.buffer,r,yu),r+=8*yu,this.maxProj=new Float64Array(this.buffer,r,yu),r+=8*yu;for(let l=0;l<yu;++l)this.minVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<yu;++l)this.maxVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<yu;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(yu),n=new Array(yu),{data:o,size:a}=e;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,s[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,n[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,s[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,n[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,s[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,n[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,s[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,n[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,s[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,n[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,s[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,n[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,s[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,n[6]=l)}for(let l=0;l<yu;++l){let c=s[l];Yc(this.minVert[l],o,c),c=n[l],Yc(this.maxVert[l],o,c)}}},aTt=class{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}};function DX(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function BF(t,e,i){t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2]}function Jh(t,e,i){t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2]}function Uw(t,e,i){t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}function Yc(t,e,i=0){t[0]=e[i+0],t[1]=e[i+1],t[2]=e[i+2]}function Kh(t,e,i){const r=e[0],s=e[1],n=e[2],o=i[0],a=i[1],l=i[2];t[0]=s*l-n*a,t[1]=n*o-r*l,t[2]=r*a-s*o}function ea(t,e){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(i>0){const r=1/Math.sqrt(i);t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}}function O3e(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function NX(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return i*i+r*r+s*s}function R3e(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function lTt(t,e){const i=e[0]+e[4]+e[8];if(i>0){let r=Math.sqrt(i+1);t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r}else{let r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);const s=(r+1)%3,n=(r+2)%3;let o=Math.sqrt(e[3*r+r]-e[3*s+s]-e[3*n+n]+1);t[r]=.5*o,o=.5/o,t[3]=(e[3*s+n]-e[3*n+s])*o,t[s]=(e[3*s+r]+e[3*r+s])*o,t[n]=(e[3*n+r]+e[3*r+n])*o}}const _3=Cd(),ex=M(),cTt=M(),uTt=ls();let Hkt=class{constructor(e){const o=e*56;this.buffer=new ArrayBuffer(o),this.obbs=new Array(e);for(let a=0;a<e;a++)this.obbs[a]={center:jY(this.buffer,56*a+0),halfSize:P2e(this.buffer,56*a+24),quaternion:E3e(this.buffer,56*a+36)}}};function M3e(t=[0,0,0],e=[-1,-1,-1],i=Cd()){return{center:xs(t),halfSize:v5(e),quaternion:S3e(i)}}function xde(t){return M3e(t.center,t.halfSize,t.quaternion)}function Wkt(t,e){he(e.center,t.center),he(e.halfSize,t.halfSize),bQ(e.quaternion,t.quaternion)}function Xkt(t,e){return e=e||M3e(),Jxt(t,e),e}function pw(t,e){const i=Er(e,t.center),r=eV(t,e);return i>r?1:i<-r?-1:0}function Ykt(t,e){e||(e=Nn());const i=eQ(uTt,t.quaternion),r=t.halfSize[0]*Math.abs(i[0])+t.halfSize[1]*Math.abs(i[3])+t.halfSize[2]*Math.abs(i[6]),s=t.halfSize[0]*Math.abs(i[1])+t.halfSize[1]*Math.abs(i[4])+t.halfSize[2]*Math.abs(i[7]),n=t.halfSize[0]*Math.abs(i[2])+t.halfSize[1]*Math.abs(i[5])+t.halfSize[2]*Math.abs(i[8]);return e[0]=t.center[0]-r,e[1]=t.center[1]-s,e[2]=t.center[2]-n,e[3]=t.center[0]+r,e[4]=t.center[1]+s,e[5]=t.center[2]+n,e}function Zkt(t,e){return Er(e,t.center)-eV(t,e)}function Jkt(t,e){return Er(e,t.center)+eV(t,e)}function Kkt(t,e){return pw(t,e[0])<=0&&pw(t,e[1])<=0&&pw(t,e[2])<=0&&pw(t,e[3])<=0&&pw(t,e[4])<=0&&pw(t,e[5])<=0}function Qkt(t,e,i,r=0){qx(_3,t.quaternion),be(ex,e,t.center);const s=kp(ex,ex,_3),n=kp(cTt,i,_3);let o=-1/0,a=1/0;for(let l=0;l<3;l++)if(Math.abs(n[l])>1e-6){const c=(r+t.halfSize[l]-s[l])/n[l],h=(-r-t.halfSize[l]-s[l])/n[l];o=Math.max(o,Math.min(c,h)),a=Math.min(a,Math.max(c,h))}else if(s[l]>t.halfSize[l]+r||s[l]<-t.halfSize[l]-r)return!1;return o<=a}(()=>{const t=new Int8Array(162);let e=0;const i=r=>{for(let s=0;s<r.length;s++)t[e+s]=r[s];e+=6};return i([6,2,3,1,5,4]),i([0,2,3,1,5,4]),i([0,2,3,7,5,4]),i([0,1,3,2,6,4]),i([0,1,3,2,0,0]),i([0,1,5,7,3,2]),i([0,1,3,7,6,4]),i([0,1,3,7,6,2]),i([0,1,5,7,6,2]),i([0,1,5,4,6,2]),i([0,1,5,4,0,0]),i([0,1,3,7,5,4]),i([0,2,6,4,0,0]),i([0,0,0,0,0,0]),i([1,3,7,5,0,0]),i([2,3,7,6,4,0]),i([2,3,7,6,0,0]),i([2,3,1,5,7,6]),i([0,1,5,7,6,2]),i([0,1,5,7,6,4]),i([0,1,3,7,6,4]),i([4,5,7,6,2,0]),i([4,5,7,6,0,0]),i([4,5,1,3,7,6]),i([0,2,3,7,5,4]),i([6,2,3,7,5,4]),i([6,2,3,1,5,4]),t})();function eV(t,e){qx(_3,t.quaternion),kp(ex,e,_3);const i=t.halfSize;return Math.abs(ex[0]*i[0])+Math.abs(ex[1]*i[1])+Math.abs(ex[2]*i[2])}function e9t(t,e){for(let i=0;i<8;++i){const r=e[i];r[0]=1&i?-t.halfSize[0]:t.halfSize[0],r[1]=2&i?-t.halfSize[1]:t.halfSize[1],r[2]=4&i?-t.halfSize[2]:t.halfSize[2],kp(r,r,t.quaternion),ve(r,r,t.center)}}function hTt(t){return Nc(t.halfSize)}function dTt(t,e,i,r,s){if(bQ(s.quaternion,t.quaternion),r===st.Global){qx(RD,t.quaternion),kp(a_,t.center,RD),f7(T2,a_),uge(S2,T2,t.halfSize),po(S2,T2,S2);const n=je(S2);ve(S2,T2,t.halfSize);const o=je(S2);if(n<i)he(s.center,t.center),fe(a_,i,i,i),ve(s.halfSize,t.halfSize,a_);else{const a=o>0?1+e/o:1,l=n>0?1+i/n:1,c=(l+a)/2,h=(l-a)/2;ue(s.halfSize,T2,h),zw(s.halfSize,s.halfSize,t.halfSize,c),ue(s.center,T2,c),zw(s.center,s.center,t.halfSize,h),cge(a_,a_),B6(s.center,s.center,a_),kp(s.center,s.center,s.quaternion)}}else{const n=fe(a_,0,0,1);zw(s.center,t.center,n,(i+e)/2),qx(RD,t.quaternion),kp(n,n,RD),f7(n,n),zw(s.halfSize,t.halfSize,n,(i-e)/2)}return s}const a_=M(),T2=M(),S2=M(),RD=Cd();let pTt=class{constructor(e){this._totalCount=e,this._indexRanges=[0,e]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const e=this._indexRanges;let i=0;for(let r=0;r<e.length;r+=2)i+=e[r+1];return i}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=fTt(e)}forEachComponent(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r],n=s+i[r+1];for(let o=s;o<n;o++)if(!e(o))return!1}return!0}forEachComponentRange(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r];if(!e(s,s+i[r+1]))return!1}return!0}computeOffsetRanges(e){const i=new Array(this._indexRanges.length),r=this._indexRanges;for(let s=0;s<r.length;s+=2){const n=r[s],o=n+r[s+1],a=e[n],l=e[o];i[s]=a,i[s+1]=l-a}return i}};function fTt(t){const e=new Array;if(t.length===0)return e;let i=t[0],r=1;for(let s=1;s<t.length;s++){const n=t[s];i+r===n?r+=1:(e.push(i),e.push(r),i=n,r=1)}return e.push(i),e.push(r),e}let mTt=class{constructor(e,i){this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null,this.offsets=i.slice();const r=this.count;this.visibility=new pTt(r),this.materialDataBuffer=e.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let s=0;s<r;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return C(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return C(this.highlightCounts)?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return C(this.highlightCounts)?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((C(this.cachedHighlightRanges)||C(this.cachedDefaultRanges))&&v(this.highlightCounts)){const{highlightRanges:e,defaultRanges:i}=gTt(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=i}}};function gTt(t,e,i){const r=[],s=[];let n=i.length,o=i.length;return e.forEachComponent(a=>(t[a]>0?(n!==a-1&&(r.length&&r.push(i[n+1]-r[r.length-1]),r.push(i[a])),n=a):(o!==a-1&&(s.length&&s.push(i[o+1]-s[s.length-1]),s.push(i[a])),o=a),!0)),r.length&&r.push(i[n+1]-r[r.length-1]),s.length&&s.push(i[o+1]-s[s.length-1]),{highlightRanges:r,defaultRanges:s}}let dM=class extends $e{constructor(){super(...arguments),this.visible=GE.Hidden}};var GE;u([d({autoDestroy:!0})],dM.prototype,"renderable",void 0),u([d({autoDestroy:!0})],dM.prototype,"components",void 0),dM=u([I("esri.views.3d.webgl-engine.collections.Component.ComponentObject")],dM),function(t){t[t.Hidden=0]="Hidden",t[t.Visible=1]="Visible"}(GE||(GE={}));function yTt(t,e,i,r){if(i>=e)return t;t==null&&(t=_Tt());const s=t.isVisibleBit;let n=t.data;const o=I3e(n),a=i/o|0,l=i-o*a,c=(e-1)/o|0,h=n,p=r===s;if(!(i<h.length*o)&&p){const m=a+1,y=Math.ceil(h.length*1.5),_=c+1;let b=Math.max(m,y);b=Math.min(b,_),n=new Uint32Array(b),n.set(h)}return a<n.length&&(n[a]=bTt(n[a],l,p)),t.data=n,t}function P3e(t,e){if(t==null)return!0;const{isVisibleBit:i,data:r}=t,s=I3e(r);return e<r.length*s?vTt(i,r,e,s):!t.isVisibleBit}function _Tt(t=!0){return{isVisibleBit:!t,data:new Uint32Array(0)}}function vTt(t,e,i,r){const s=i/r|0,n=i-s*r;return wTt(e[s],n)===t}function I3e(t){return t.BYTES_PER_ELEMENT*8}function bTt(t,e,i){return t&~(1<<e)|(i?1:0)<<e}function wTt(t,e){return(t&1<<e)!=0}let xTt=class{constructor(e,i){this._indices=v(e.indices)?e.indices:PC(e.positions.length/3),this._positions=new Lr(e.positions),this._components=i,this._componentIntersectionData=new Array(i.count)}getComponentAabb(e,i){if(v(this._perComponentAabbs)){for(let r=0;r<6;r++)i[r]=this._perComponentAabbs[6*e+r];return i}return this._computePerComponentAabbs(),this.getComponentAabb(e,i)}getComponentPositions(e,i){i.indices=this._indices,i.data=this._positions.typedBuffer,i.stride=this._positions.typedBufferStride,i.startIndex=this._components.offsets[e],i.endIndex=this._components.offsets[e+1]}intersect(e,i,r,s,n,o,a){const l=new ht(this._positions.typedBuffer,3,!1,this._positions.typedBufferStride),c=this._indices,h=this._components.offsets,p=MCe(e,i,TTt),f=e[2],m=i[2];this._components.visibility.forEachComponent(y=>{if(!P3e(this._components.pickability,y))return!0;const _=this.getComponentAabb(y,STt);if(v(o)){const E=o[y];v(n)?n.componentOffset=E:(e[2]=f-E,i[2]=m-E)}if(v(n)&&n.applyToAabb(_),!KQ(_,e,p,r))return!0;const b=h[y]/3,w=h[y+1]/3,S=w-b,T=(E,O,R)=>a(y,E,qc(O,O,s),R);return C(n)&&S>w3e?(this._componentIntersectionData[y]==null&&(this._componentIntersectionData[y]=new ate(this._indices,b,w,l)),this._componentIntersectionData[y].intersectRay({r0:e,r1:i},T)):MI(e,i,b,w,c,l,void 0,n,T),!0})}_computePerComponentAabbs(){const e=this._components.count;this._perComponentAabbs=new Float32Array(6*e);const i=this._indices,r=this._positions.typedBuffer,s=this._positions.typedBufferStride,n=this._components.offsets;let o=0;for(let a=0;a<e;a++){const l=n[a],c=n[a+1];let h=1/0,p=1/0,f=1/0,m=-1/0,y=-1/0,_=-1/0;for(let b=l;b<c;b++){const w=i[b]*s,S=r[w],T=r[w+1],E=r[w+2];h=Math.min(h,S),p=Math.min(p,T),f=Math.min(f,E),m=Math.max(m,S),y=Math.max(y,T),_=Math.max(_,E)}this._perComponentAabbs[o++]=h,this._perComponentAabbs[o++]=p,this._perComponentAabbs[o++]=f,this._perComponentAabbs[o++]=m,this._perComponentAabbs[o++]=y,this._perComponentAabbs[o++]=_}}get positions(){return this._positions}get indices(){return this._indices}};const TTt=M(),STt=Nn();let ETt=class{constructor(e,i,r){this.material=e,this.geometry=i,this.meta=r}destroy(){this.material.dispose(),this.geometry.dispose()}},CTt=class{constructor(e,i,r,s){this.vao=e,this.primitiveType=i,this.parameters=r,this.indexed=s}dispose(){this.vao.dispose()}},ATt=class{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function OTt(t,e){return{near:t,far:e}}function kI(t){return t?DP(t,1/0,-1/0):OTt(1/0,-1/0)}function DP(t,e,i){return t.near=e,t.far=i,t}function GC(t,e,i=t){return e!=null&&(i.near=Math.min(t.near,e.near),i.far=Math.max(t.far,e.far)),i}function MD(t,e){return t.near<=e&&e<=t.far}const FX={near:0,far:0};function RTt(t,e){const i=kI(),{eye:r,frustum:s,viewForward:n}=t;e.forAll(o=>{const a=v(o.offsetObb)?o.offsetObb:o.obb,l=Ae(po(Eu,a.center,r),n),c=eV(a,n);if(MD(i,l-c)&&MD(i,l+c))return;const h=LTt(a,s);if(h===-1)return;if(h===0)return Pg.far=l+c,Pg.near=l-c,void GC(i,Pg);const p=PD.pushNew();p.near=l-c,p.far=l+c,p.mask=h,p.object=o});for(let o=0;o<PD.length;o++){const a=PD.data[o];if(MD(i,a.near)&&MD(i,a.far))continue;Pg.far=a.far,Pg.near=1/0,$Tt(v(a.object.offsetObb)?a.object.offsetObb:a.object.obb,r,MTt,c=>{let h=PTt;for(let p=0;p<$3e&&c.length>0;p++){if(!(a.mask&1<<p))continue;ITt(s[p],c,h);const f=c;c=h,h=f}for(let p=0;p<c.length;p+=3){fe(Xl,c.data[p+0],c.data[p+1],c.data[p+2]);const f=Ae(po(Xl,Xl,r),n);Pg.near=Math.min(Pg.near,f)}})===0&&(Pg.near=0),GC(i,Pg)}return PD.length=0,i}const PD=new li({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=yx(t.object),t)}),Pg=kI(),Xl=M(),db=M(),MTt=new li({deallocator:null}),PTt=new li({deallocator:null});function ITt(t,e,i){i.length=0;const r=e.length-3;nz(Xl,e,r);const s=Er(t,Xl);s<=0&&(i.push(Xl[0]),i.push(Xl[1]),i.push(Xl[2]));let n=0,o=s;for(;n<r;n+=3){nz(db,e,n);const a=Er(t,db);o*a<0&&(tn(Xl,db,Xl,a/(a-o)),Yl(i,Xl)),a<=0&&Yl(i,db),o=a,he(Xl,db)}o*s<0&&(nz(db,e,r),tn(Xl,db,Xl,s/(s-o)),Yl(i,Xl))}function nz(t,e,i){return fe(t,e.data[i+0],e.data[i+1],e.data[i+2])}function Yl(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function $Tt(t,e,i,r){qx(Sde,t.quaternion),po(Eu,e,t.center),kp(Eu,Eu,Sde);const s=8*((Eu[0]<-t.halfSize[0]?-1:Eu[0]>t.halfSize[0]?1:0)+3*(Eu[1]<-t.halfSize[1]?-1:Eu[1]>t.halfSize[1]?1:0)+9*(Eu[2]<-t.halfSize[2]?-1:Eu[2]>t.halfSize[2]?1:0)+13),n=Tde[s];if(n===0)return n;eQ(ID,t.quaternion),QK(ID,ID,t.halfSize);const o=(a,l)=>{const c=Tde[s+l+1];return fe(a,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),qc(a,a,ID),ve(a,t.center,a)};return i.length=0,Yl(i,o(oz,0)),Yl(i,o(Ede,1)),Yl(i,o(Eu,2)),Yl(i,o(Cde,3)),r(i),n===1||(i.length=0,Yl(i,oz),Yl(i,Cde),Yl(i,o(Eu,4)),Yl(i,o(Ade,5)),r(i),n===2||(i.length=0,Yl(i,oz),Yl(i,Ade),Yl(i,o(Eu,6)),Yl(i,Ede),r(i))),n}const Tde=(()=>{const t=new Int8Array(216);let e=0;const i=r=>{for(let s=0;s<r.length;s++)t[e+s]=r[s];e+=8};return i([3,0,6,2,3,1,5,4]),i([2,0,2,3,1,5,4,0]),i([3,1,0,2,3,7,5,4]),i([2,0,1,3,2,6,4,0]),i([1,0,1,3,2,0,0,0]),i([2,1,5,7,3,2,0,0]),i([3,2,0,1,3,7,6,4]),i([2,2,0,1,3,7,6,0]),i([3,3,0,1,5,7,6,2]),i([2,0,1,5,4,6,2,0]),i([1,0,1,5,4,0,0,0]),i([2,1,3,7,5,4,0,0]),i([1,0,2,6,4,0,0,0]),i([0,0,0,0,0,0,0,0]),i([1,1,3,7,5,0,0,0]),i([2,2,3,7,6,4,0,0]),i([1,2,3,7,6,0,0,0]),i([2,3,1,5,7,6,2,0]),i([3,4,0,1,5,7,6,2]),i([2,5,7,6,4,0,1,0]),i([3,5,0,1,3,7,6,4]),i([2,4,5,7,6,2,0,0]),i([1,4,5,7,6,0,0,0]),i([2,5,1,3,7,6,4,0]),i([3,6,0,2,3,7,5,4]),i([2,6,2,3,7,5,4,0]),i([3,7,6,2,3,1,5,4]),t})(),$3e=4;function LTt(t,e){let i=0;for(let r=0;r<$3e;r++){const s=pw(t,e[r]);if(s>0)return-1;s===0&&(i|=1<<r)}return i}const ID=ls(),Sde=Cd(),Eu=M(),oz=M(),Ede=M(),Cde=M(),Ade=M();let DTt=class{constructor(e){this._objects=e}submit(e,i){this._objects.preSubmit(i),this._objects.visibleObjects.forAll(r=>r.renderable.material.submit(e,i,r))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?RTt(e,this._objects.visibleObjects):null}};function NTt(t){const e=cs().vec3f(A.POSITION);return t.normals&&e.vec2i16(A.NORMALCOMPRESSED,{glNormalized:!0}),t.textureCoordinates===Ks.Default?e.vec2f(A.UV0):t.textureCoordinates===Ks.Atlas&&(e.vec2f(A.UV0),e.vec4u16(A.UVREGION,{glNormalized:!0})),t.colors&&e.vec4u8(A.COLOR,{glNormalized:!0}),e.alignTo(4)}let FTt=class{constructor(){this.externalColor=fi(),this.externalColorMixMode=Rn.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}},UTt=class extends Os{constructor(e,i){super(e,"int",gr.Draw,(r,s,n)=>r.setUniform1i(e,i(s,n)))}};var Lm;(function(t){t[t.Uniform=0]="Uniform",t[t.Varying=1]="Varying",t[t.COUNT=2]="COUNT"})(Lm||(Lm={}));const lte=429496.7296;function L3e(t,e){_P(t/lte*.5+.5,e)}function VTt(t,e){switch(e.componentData){case Lm.Varying:return kTt(t,e);case Lm.Uniform:return BTt(t);case Lm.COUNT:return;default:e.componentData}}function kTt(t,e){const{vertex:i,fragment:r}=t;i.include(ou),i.uniforms.add(Uv("componentColorTex",n=>n.componentParameters.texture.texture,e.hasWebGL2Context?sr.None:sr.Size)),t.attributes.add(A.COMPONENTINDEX,"float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const s=e.output===k.ObjectAndLayerIdColor;s&&t.varyings.add("vObjectAndLayerIdColor","vec4"),t.include(KOe),i.constants.add("elevationScale","float",2*lte),i.constants.add("stride","float",de("enable-feature:objectAndLayerId-rendering")?3:2),i.code.add(x`
  vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
    vec2 textureSize = ${ad(e,"componentColorTex")};

    float index = componentIndex * stride + typeOffset;
    float coordX = mod(index, textureSize.x);
    float coordY = floor(index / textureSize.x);

    return vec2(coordX, coordY) + 0.5;
  }
  `),i.code.add(x`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return ${hl(e,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = ${hl(e,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${s?x`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = ${hl(e,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
          }`:x`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),r.code.add(x`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${s?x`gl_FragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function BTt(t){const{vertex:e,fragment:i}=t;e.uniforms.add(new h6("externalColor",r=>r.componentParameters.externalColor)),i.uniforms.add(new UTt("externalColorMixMode",r=>r.componentParameters.externalColorMixMode)),t.varyings.add("vExternalColor","vec4"),e.code.add(x`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),i.code.add(x`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}
void outputObjectAndLayerIdColor() {
gl_FragColor = vec4(1.0,0.0,0.0,0.0);
}`)}var td;function zTt(t,e){const i=t.vertex;switch(i.code.add(x`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),e.vertexDiscardMode){case td.None:i.code.add(x`#define vertexDiscardByOpacity(_opacity_) {}`);break;case td.Opaque:i.code.add(x`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case td.Transparent:i.code.add(x`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(function(t){t[t.None=0]="None",t[t.Transparent=1]="Transparent",t[t.Opaque=2]="Opaque",t[t.COUNT=3]="COUNT"})(td||(td={}));var Dm;function h9t(t){return t&&Zm(t)?Dm.Mars:t&&Jm(t)?Dm.Moon:Dm.Earth}(function(t){t[t.Earth=1]="Earth",t[t.Mars=2]="Mars",t[t.Moon=3]="Moon",t[t.COUNT=4]="COUNT"})(Dm||(Dm={}));var Bu;(function(t){t[t.None=0]="None",t[t.NoOverlay=1]="NoOverlay",t[t.ColorOverlay=2]="ColorOverlay",t[t.ColorOverlayWithWater=3]="ColorOverlayWithWater",t[t.COUNT=4]="COUNT"})(Bu||(Bu={}));let Ci=class extends Va{constructor(){super(...arguments),this.output=k.Color,this.textureCoordinateType=Ks.None,this.componentData=Lm.Uniform,this.cullFace=Or.Back,this.vertexDiscardMode=td.None,this.doubleSidedMode=ys.WindingOrder,this.alphaDiscardMode=fr.Opaque,this.integratedMeshMode=Bu.None,this.transparencyPassType=$t.NONE,this.ellipsoidMode=Dm.Earth,this.pbrMode=St.Disabled,this.normalType=lr.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.useLegacyTerrainShading=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1,this.hasWebGL2Context=!1}};u([z({count:k.COUNT})],Ci.prototype,"output",void 0),u([z({count:Ks.COUNT})],Ci.prototype,"textureCoordinateType",void 0),u([z({count:Lm.COUNT})],Ci.prototype,"componentData",void 0),u([z({count:Or.COUNT})],Ci.prototype,"cullFace",void 0),u([z({count:td.COUNT})],Ci.prototype,"vertexDiscardMode",void 0),u([z({count:ys.COUNT})],Ci.prototype,"doubleSidedMode",void 0),u([z({count:fr.COUNT})],Ci.prototype,"alphaDiscardMode",void 0),u([z({count:Bu.COUNT})],Ci.prototype,"integratedMeshMode",void 0),u([z({count:$t.COUNT})],Ci.prototype,"transparencyPassType",void 0),u([z({count:Dm.COUNT})],Ci.prototype,"ellipsoidMode",void 0),u([z({count:St.COUNT})],Ci.prototype,"pbrMode",void 0),u([z({count:lr.COUNT})],Ci.prototype,"normalType",void 0),u([z()],Ci.prototype,"spherical",void 0),u([z()],Ci.prototype,"doublePrecisionRequiresObfuscation",void 0),u([z()],Ci.prototype,"hasVertexColors",void 0),u([z()],Ci.prototype,"hasNormals",void 0),u([z()],Ci.prototype,"hasSlicePlane",void 0),u([z()],Ci.prototype,"hasBaseColorTexture",void 0),u([z()],Ci.prototype,"receiveAmbientOcclusion",void 0),u([z()],Ci.prototype,"receiveShadows",void 0),u([z()],Ci.prototype,"blendingEnabled",void 0),u([z()],Ci.prototype,"hasScreenSpaceReflections",void 0),u([z()],Ci.prototype,"hasPolygonOffset",void 0),u([z()],Ci.prototype,"hasMetallicRoughnessTexture",void 0),u([z()],Ci.prototype,"hasEmissionTexture",void 0),u([z()],Ci.prototype,"hasOcclusionTexture",void 0),u([z()],Ci.prototype,"hasNormalTexture",void 0),u([z()],Ci.prototype,"hasOccludees",void 0),u([z()],Ci.prototype,"hasMultipassTerrain",void 0),u([z()],Ci.prototype,"cullAboveGround",void 0),u([z()],Ci.prototype,"useLegacyTerrainShading",void 0),u([z()],Ci.prototype,"hasCloudsReflections",void 0),u([z()],Ci.prototype,"snowCover",void 0),u([z()],Ci.prototype,"objectAndLayerIdColor",void 0),u([z()],Ci.prototype,"hasWebGL2Context",void 0),u([z({constValue:gr.Draw})],Ci.prototype,"pbrTextureBindType",void 0),u([z({constValue:!0})],Ci.prototype,"hasSliceHighlight",void 0),u([z({constValue:!1})],Ci.prototype,"hasSliceInVertexProgram",void 0),u([z({constValue:!1})],Ci.prototype,"useCustomDTRExponentForWater",void 0),u([z({constValue:!1})],Ci.prototype,"hasVertexTangents",void 0),u([z({constValue:!0})],Ci.prototype,"supportsTextureAtlas",void 0),u([z({constValue:!1})],Ci.prototype,"highStepCount",void 0),u([z({constValue:!1})],Ci.prototype,"instancedDoublePrecision",void 0),u([z({constValue:!0})],Ci.prototype,"useFillLights",void 0),u([z({constValue:!1})],Ci.prototype,"objectAndLayerIdColorInstanced",void 0);function Ode(t,e){t.include(vT,e),t.fragment.include(OP);const i=t.fragment;i.uniforms.add(new h6("baseColor",r=>r.baseColor)),i.uniforms.add(new px("objectOpacity",r=>r.objectOpacity)),e.hasVertexColors?i.code.add(x`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):i.code.add(x`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),i.code.add(x`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function Rde(t,e){const i=t.fragment;switch(e.doubleSidedMode){case ys.None:i.code.add(x`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case ys.View:t.include(OE,e),i.code.add(x`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case ys.WindingOrder:i.code.add(x`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case ys.COUNT:}switch(e.normalType){case lr.Attribute:case lr.CompressedAttribute:t.include(F8,e),i.code.add(x`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case lr.ScreenDerivative:t.extensions.add("GL_OES_standard_derivatives"),t.include(OE,e),i.code.add(x`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case lr.Ground:e.spherical?(t.include(OE,e),i.code.add(x`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):i.code.add(x`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),t.extensions.add("GL_OES_standard_derivatives"),i.code.add(x`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:e.normalType;case lr.COUNT:}}function GTt(t,e){const i=t.fragment;if(e.hasBaseColorTexture&&(e.output===k.Color||e.alphaDiscardMode!==fr.Opaque)){t.include(HK,e);const r=e.textureCoordinateType===Ks.Atlas;i.uniforms.add(Uv("baseColorTexture",s=>s.texture,r?e.hasWebGL2Context?sr.None:sr.Size:sr.None)),r?(t.include(N2e),i.code.add(x`
        vec4 readBaseColorTexture() {
          vec2 textureSize = ${ad(e,"baseColorTexture")};
          return textureAtlasLookup(baseColorTexture, textureSize, vuv0, vuvRegion);
        }
      `)):i.code.add(x`vec4 readBaseColorTexture() {
return texture2D(baseColorTexture, vuv0);
}`)}else i.code.add(x`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function jTt(t){const e=new Ui;e.include(OE,t),e.include(F8,t),e.include(vT,t),e.include(Im,t),e.include(yA,t),e.include(VTt,t),e.include(Bft,t),e.include(Rut,t),e.include(GTt,t),e.include(zTt,t);const{vertex:i,fragment:r}=e;t.pbrMode!==St.Normal&&t.pbrMode!==St.Schematic||(e.include(WK,t),t.hasNormalTexture&&e.include(iRe,t));const s=t.output===k.Shadow||t.output===k.ShadowHighlight||t.output===k.ShadowExcludeHighlight;s&&t.componentData===Lm.Varying?i.code.add(x`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):i.code.add(x`#define discardShadows(castShadows) {}`);const n=t.integratedMeshMode===Bu.ColorOverlay||t.integratedMeshMode===Bu.ColorOverlayWithWater,o=n&&t.output===k.Color&&t.pbrMode===St.WaterOnIntegratedMesh;return n&&(e.include(Kx,t),e.include(fwt,t),t.spherical?i.code.add(x`
      const float invEllipsoidRadius = ${x.float(1/(t.ellipsoidMode===Dm.Earth?Oi.radius:t.ellipsoidMode===Dm.Mars?Em.radius:zy.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):i.code.add(x`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),o&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3")),i.code.add(x`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${t.output===k.ObjectAndLayerIdColor?x`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${x.float(la)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${t.output===k.ObjectAndLayerIdColor?x`forwardObjectAndLayerIdColor();`:""}
      ${o?t.spherical?x`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:x`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${n?x`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),t.output===k.Alpha&&(r.include(rh),e.include(sh,t),e.include(Ode,t),n&&r.uniforms.add(new zt("ovColorTex",(a,l)=>RX(a,l))),r.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.hasMultipassTerrain?x`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?x`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `)),t.output===k.Color&&(r.include(rh),e.include(sh,t),e.include(Ode,t),e.include(Rde,t),e.include(Kx,t),t.receiveShadows?(e.include(U8,t),r.code.add(x`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):r.code.add(x`float evaluateShadow() { return 0.0; }`),n&&r.uniforms.add(new zt("ovColorTex",(a,l)=>RX(a,l))),r.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.hasMultipassTerrain?x`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?x`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),t.pbrMode===St.Normal||t.pbrMode===St.Schematic?(rg(r),r.code.add(x`
        ${t.pbrMode===St.Normal?x`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),t.hasNormalTexture?r.code.add(x`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):r.code.add(x`vec3 shadingNormal = normalVertex;`),r.code.add(x`${t.spherical?x`vec3 normalGround = normalize(positionWorld());`:x`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),r.code.add(x`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${t.snowCover?x`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${n?x` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(t.receiveShadows?r.code.add(x`float shadow = evaluateShadow();`):t.spherical?(OA(r),r.code.add(x`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):r.code.add(x`float shadow = 0.0;`),o&&r.uniforms.add(new zt("ovNormalTex",(a,l)=>cte(l))),t.snowCover&&(e.extensions.add("GL_OES_standard_derivatives"),r.code.add(x`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)),r.code.add(x`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${n?x` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${o?x`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),r.code.add(x`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${t.transparencyPassType===$t.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),(t.output===k.Depth||s)&&(e.include(Qy,t),r.code.add(x`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),t.output===k.Normal&&(e.include(Rde,t),r.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${t.normalType===lr.Ground?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),t.output===k.ObjectAndLayerIdColor&&e.fragment.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?x`gl_FragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),t.output===k.Highlight&&(e.include(g0,t),r.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?x`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  gl_FragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),e}function cte(t){return t.overlays.length===0?null:t.overlays[os.INNER].getValidTexture(ws.Water)}const HTt=Object.freeze(Object.defineProperty({__proto__:null,build:jTt,getOverlayNormalTexture:cte},Symbol.toStringTag,{value:"Module"}));let D3e=class N3e extends ji{initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Mt.WEBGL2,i.spherical=e.viewingMode===st.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new ki(e.rctx,N3e.shader.get().build(this.configuration),F3e)}_setPipelineState(e){const i=this.configuration,r=i.integratedMeshMode!==Bu.None,s=e===$t.NONE,n=e===$t.FrontFace;return Qt({blending:i.output!==k.Color&&i.output!==k.Alpha||!i.blendingEnabled?null:s?Qu:y0(e),culling:i8(i.cullFace),depthTest:{func:T1(e)},depthWrite:s||n?pc:null,colorWrite:ui,stencilWrite:r||i.hasOccludees?Ym:null,stencilTest:r?Ept(oc.IntegratedMeshMaskExcluded):i.hasOccludees?S1:null,polygonOffset:s||n?i.hasPolygonOffset?{factor:2,units:2}:null:P8})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};D3e.shader=new Vi(HTt,()=>ee(()=>import("./ComponentShader.glsl-5bb04f00.js"),[],import.meta.url));const F3e=new Map([[A.POSITION,0],[A.NORMAL,1],[A.NORMALCOMPRESSED,1],[A.COLOR,2],[A.UV0,3],[A.UVREGION,4],[A.COMPONENTINDEX,5]]);let qTt=class extends yr{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},ute=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function vs(t={}){return(e,i)=>{const r=e._parameterCount??0;if(e._parameterCount=r+1,t.vectorOps){const s=t.vectorOps;Object.defineProperty(e,i,{get(){return this[r]},set(n){const o=this[r];if(o==null)this[r]=n;else{if(s.equals(o,n))return;s.copy(o,n)}this._setDirty()}})}else Object.defineProperty(e,i,{get(){return this[r]},set(s){this[r]!==s&&(t.dispose&&this[r]&&this[r].dispose(),this[r]=s,this._setDirty())}})}}function Mde(){return(t,e)=>{const i=t._parameterCount??0;t._parameterCount=i+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(i),Object.defineProperty(t,e,{get(){return this[i]},set(r){this[i]!==r&&(this[i]=r,this._setDirty())}})}}let tV=class{constructor(e){this._low=qr(),this._high=qr(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){const i=this._low,r=this._high;he(i,e),po(r,e,i)}setElements(e,i,r){fe(Pde,e,i,r),this.set(Pde)}get(e){return ve(e,this._low,this._high)}getLowScaled(e){return ue(e,this._low,1)}};const Pde=M();let ro=class extends qTt{constructor(e,i){super(),this.toMapSpace=i,this.baseColor=sf(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=er(1,1,.5),this.emissiveFactor=er(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new zF,this.componentParameters=new v3,this.textureAlphaCutoff=q5,this.alphaDiscardMode=fr.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=Dm.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new Ci;const r=new tV(e.position),s=rRe(e.rotationScale);mT(s,s),this.transformNormalGlobalFromModel=wd(s,s),this.transformWorldFromModelTL=r.low,this.transformWorldFromModelTH=r.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this._technique=Wr(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return v(this.baseColorTexture)?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return v(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return v(this.emissionTexture)?this.emissionTexture.glTexture:null}get textureOcclusion(){return v(this.occlusionTexture)?this.occlusionTexture.glTexture:null}get textureNormal(){return v(this.normalTexture)?this.normalTexture.glTexture:null}prepareTechnique(e,i,r,s){const n=this._techniqueConfiguration;n.hasVertexColors=s.colors,n.hasNormals=s.normals,n.textureCoordinateType=s.textureCoordinates,n.hasMetallicRoughnessTexture=v(this.metallicRoughnessTexture),n.hasEmissionTexture=v(this.emissionTexture),n.hasOcclusionTexture=v(this.occlusionTexture),n.hasNormalTexture=v(this.normalTexture),n.transparencyPassType=i.identifier===Hc.Material&&r.transparencyPassType!=null?r.transparencyPassType:$t.NONE,n.hasMultipassTerrain=i.identifier===Hc.Material&&r.multipassTerrain!=null&&r.multipassTerrain.enabled,n.cullAboveGround=i.identifier===Hc.Material&&r.multipassTerrain!=null&&r.multipassTerrain.cullAboveGround,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?ys.View:ys.None,n.hasBaseColorTexture=v(this.baseColorTexture);const o=this._computeWhichMaterialPass();n.blendingEnabled=o===il.Transparent||o===il.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?XTt(r)?cte(r)?Bu.ColorOverlayWithWater:Bu.ColorOverlay:Bu.NoOverlay:Bu.None,n.useLegacyTerrainShading=this.isIntegratedMesh&&Ji.TERRAIN_USE_LEGACY_SHADING,n.hasPolygonOffset=this.polygonOffsetEnabled;const a=this.hasParametersFromSource&&C(this.baseColorTexture);if(n.pbrMode=n.integratedMeshMode===Bu.ColorOverlayWithWater?St.WaterOnIntegratedMesh:this.usePBR?a?St.Schematic:St.Normal:St.Disabled,n.normalType=n.integratedMeshMode===Bu.None?n.hasNormals?lr.CompressedAttribute:lr.ScreenDerivative:lr.Ground,n.hasSlicePlane=v(r.slicePlane)&&this.commonMaterialParameters.hasSlicePlane,i.identifier===Hc.ShadowMap)n.output=k.Shadow,n.vertexDiscardMode=td.None;else if(i.identifier===Hc.Highlight)n.output=k.Highlight,n.vertexDiscardMode=td.None;else{switch(this._computeWhichMaterialPass()===il.OpaqueAndTransparent?n.vertexDiscardMode=i.transparent?td.Opaque:td.Transparent:n.vertexDiscardMode=td.None,n.output=i.output,n.receiveAmbientOcclusion=!1,n.receiveShadows=!1,i.output){case k.Color:n.receiveAmbientOcclusion=r.ssaoHelper.active,n.hasOccludees=r.hasOccludees,n.receiveShadows=r.shadowMap.ready,n.hasScreenSpaceReflections=r.ssr.enabled,n.hasCloudsReflections=v(r.cloudsFade.data);break;case k.Alpha:n.hasOccludees=r.hasOccludees;break;case k.ObjectAndLayerIdColor:n.objectAndLayerIdColor=!0}n.snowCover=this.hasSnowCover(r)}return this._technique=e.releaseAndAcquire(D3e,n,this._technique),this._setClean(),this._technique}hasSnowCover(e){return v(e.weather)&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,i,r){if(this.objectOpacity===0)return;const s=r.renderable.geometry,n=r.components,o=r.renderable.meta.cameraDepthSquared,a=n.geometryRanges,l=n.highlightRanges,c=n.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case il.Opaque:e.materialOpaque.submitDraw(this,s,a,o);break;case il.Transparent:e.materialTransparent.submitDraw(this,s,a,o);break;case il.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,s,a,o),e.materialTransparent.submitDraw(this,s,a,o);break;case il.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,s,a,o),WTt(i)&&e.highlightIntegratedMesh.submitDraw(this,s,a,o)}const h=this.componentParameters.castShadows!==Hn.None;h&&e.shadowMap.submitDraw(this,s,a,o),v(l)&&(e.highlight.submitDraw(this,s,l,o),h&&e.highlightShadowMap.submitDraw(this,s,l,o)),h&&v(c)&&e.defaultShadowMap.submitDraw(this,s,c,o)}_computeWhichMaterialPass(){return this.isIntegratedMesh?il.IntegratedMesh:this.objectOpacity<1?il.Transparent:this.componentParameters.opaqueOverride===Hn.All?il.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===fr.Blend||this.alphaDiscardMode===fr.MaskBlend?il.Transparent:this.componentParameters.transparent===Hn.None?il.Opaque:this.componentParameters.transparent===Hn.All?il.Transparent:il.OpaqueAndTransparent}};var il,Hn;u([vs({vectorOps:_ge})],ro.prototype,"baseColor",void 0),u([vs()],ro.prototype,"usePBR",void 0),u([vs()],ro.prototype,"hasParametersFromSource",void 0),u([vs({vectorOps:gie})],ro.prototype,"mrrFactors",void 0),u([vs({vectorOps:gie})],ro.prototype,"emissiveFactor",void 0),u([vs({dispose:!0})],ro.prototype,"baseColorTexture",void 0),u([vs({dispose:!0})],ro.prototype,"metallicRoughnessTexture",void 0),u([vs({dispose:!0})],ro.prototype,"emissionTexture",void 0),u([vs({dispose:!0})],ro.prototype,"occlusionTexture",void 0),u([vs({dispose:!0})],ro.prototype,"normalTexture",void 0),u([vs()],ro.prototype,"objectOpacity",void 0),u([Mde()],ro.prototype,"commonMaterialParameters",void 0),u([Mde()],ro.prototype,"componentParameters",void 0),u([vs()],ro.prototype,"textureAlphaCutoff",void 0),u([vs()],ro.prototype,"alphaDiscardMode",void 0),u([vs()],ro.prototype,"isIntegratedMesh",void 0),u([vs()],ro.prototype,"polygonOffsetEnabled",void 0),u([vs()],ro.prototype,"ellipsoidMode",void 0),u([vs()],ro.prototype,"hasOccludees",void 0),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.OpaqueAndTransparent=2]="OpaqueAndTransparent",t[t.IntegratedMesh=3]="IntegratedMesh"}(il||(il={}));let zF=class extends ute{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=Or.Back,this.hasSlicePlane=!0}};u([vs()],zF.prototype,"doubleSided",void 0),u([vs()],zF.prototype,"cullFace",void 0),u([vs()],zF.prototype,"hasSlicePlane",void 0);let v3=class extends ute{constructor(){super(...arguments),this.externalColor=si(1,1,1,1),this.externalColorMixMode=Rn.Multiply,this.castShadows=Hn.All}get transparent(){return this.externalColor[3]<1?Hn.All:Hn.None}get opaqueOverride(){return this.externalColorMixMode===Rn.Replace&&this.externalColor[3]===1?Hn.All:Hn.None}get visible(){return this.externalColor[3]>0?Hn.All:Hn.None}get type(){return Lm.Uniform}};u([vs({vectorOps:_ge})],v3.prototype,"externalColor",void 0),u([vs()],v3.prototype,"externalColorMixMode",void 0),u([vs()],v3.prototype,"castShadows",void 0),function(t){t[t.All=0]="All",t[t.Some=1]="Some",t[t.None=2]="None"}(Hn||(Hn={}));let pM=class extends ute{constructor(){super(...arguments),this.texture=null,this.transparent=Hn.None,this.opaqueOverride=Hn.None,this.castShadows=Hn.None}get type(){return Lm.Varying}};function WTt(t){return t.overlays.length!==0&&v(t.overlays[os.INNER].getValidTexture(ws.Highlight))}function XTt(t){return t.overlays.length!==0&&v(t.overlays[os.INNER].getColorTextureNoRasterImage())}u([vs()],pM.prototype,"texture",void 0),u([vs()],pM.prototype,"transparent",void 0),u([vs()],pM.prototype,"opaqueOverride",void 0),u([vs()],pM.prototype,"castShadows",void 0);const f6=cs().vec3f(A.POSITION).u16(A.COMPONENTINDEX).u16(A.U16PADDING),U3e=cs().vec2u8(A.SIDENESS),YTt=au(U3e),V3e=cs().vec3f(A.POSITION0).vec3f(A.POSITION1).u16(A.COMPONENTINDEX).u8(A.VARIANTOFFSET,{glNormalized:!0}).u8(A.VARIANTSTROKE).u8(A.VARIANTEXTENSION,{glNormalized:!0}).u8(A.U8PADDING,{glPadding:!0}).u16(A.U16PADDING,{glPadding:!0}),UX=V3e.clone().vec3f(A.NORMAL),VX=V3e.clone().vec3f(A.NORMALA).vec3f(A.NORMALB),k3e=new Map([[A.POSITION0,0],[A.POSITION1,1],[A.COMPONENTINDEX,2],[A.VARIANTOFFSET,3],[A.VARIANTSTROKE,4],[A.VARIANTEXTENSION,5],[A.NORMAL,6],[A.NORMALA,6],[A.NORMALB,7],[A.SIDENESS,8]]);function Ide(t,e,i){const r=e/3,s=new Uint32Array(i+1),n=new Uint32Array(i+1),o=(w,S)=>{w<S?s[w+1]++:n[S+1]++};for(let w=0;w<r;w++){const S=t[3*w],T=t[3*w+1],E=t[3*w+2];o(S,T),o(T,E),o(E,S)}let a=0,l=0;for(let w=0;w<i;w++){const S=s[w+1],T=n[w+1];s[w+1]=a,n[w+1]=l,a+=S,l+=T}const c=new Uint32Array(6*r),h=s[i],p=(w,S,T)=>{if(w<S){const E=s[w+1]++;c[2*E]=S,c[2*E+1]=T}else{const E=n[S+1]++;c[2*h+2*E]=w,c[2*h+2*E+1]=T}};for(let w=0;w<r;w++){const S=t[3*w],T=t[3*w+1],E=t[3*w+2];p(S,T,w),p(T,E,w),p(E,S,w)}const f=(w,S)=>{const T=2*w,E=S-w;for(let O=1;O<E;O++){const R=c[T+2*O],L=c[T+2*O+1];let P=O-1;for(;P>=0&&c[T+2*P]>R;P--)c[T+2*P+2]=c[T+2*P],c[T+2*P+3]=c[T+2*P+1];c[T+2*P+2]=R,c[T+2*P+3]=L}};for(let w=0;w<i;w++)f(s[w],s[w+1]),f(h+n[w],h+n[w+1]);const m=new Int32Array(3*r),y=(w,S)=>w===t[3*S]?0:w===t[3*S+1]?1:w===t[3*S+2]?2:-1,_=(w,S)=>{const T=y(w,S);m[3*S+T]=-1},b=(w,S,T,E)=>{const O=y(w,S);m[3*S+O]=E;const R=y(T,E);m[3*E+R]=S};for(let w=0;w<i;w++){let S=s[w];const T=s[w+1];let E=n[w];const O=n[w+1];for(;S<T&&E<O;){const R=c[2*S],L=c[2*h+2*E];R===L?(b(w,c[2*S+1],L,c[2*h+2*E+1]),S++,E++):R<L?(_(w,c[2*S+1]),S++):(_(L,c[2*h+2*E+1]),E++)}for(;S<T;)_(w,c[2*S+1]),S++;for(;E<O;)_(c[2*h+2*E],c[2*h+2*E+1]),E++}return m}let B3e=class{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?JTt:ZTt}write(e,i,r){const s=this._edgeHashFunction(r);LD.seed=s;const n=LD.getIntRange(0,255),o=LD.getIntRange(0,this.settings.variants-1),a=.7,l=LD.getFloat(),c=255*(.5*KTt(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);e.position0.setVec(i,r.position0),e.position1.setVec(i,r.position1),e.componentIndex.set(i,r.componentIndex),e.variantOffset.set(i,n),e.variantStroke.set(i,o),e.variantExtension.set(i,c)}trim(e,i){return e.slice(0,i)}};const hte=new Float32Array(6),m6=new Uint32Array(hte.buffer),Ov=new Uint32Array(1);function ZTt(t){const e=hte;e[0]=t.position0[0],e[1]=t.position0[1],e[2]=t.position0[2],e[3]=t.position1[0],e[4]=t.position1[1],e[5]=t.position1[2],Ov[0]=5381;for(let i=0;i<m6.length;i++)Ov[0]=31*Ov[0]+m6[i];return Ov[0]}function JTt(t){const e=hte;e[0]=E2(t.position0[0]),e[1]=E2(t.position0[1]),e[2]=E2(t.position0[2]),e[3]=E2(t.position1[0]),e[4]=E2(t.position1[1]),e[5]=E2(t.position1[2]),Ov[0]=5381;for(let i=0;i<m6.length;i++)Ov[0]=31*Ov[0]+m6[i];return Ov[0]}const $de=1e4;function E2(t){return Math.round(t*$de)/$de}function KTt(t,e){const i=t<0?-1:1;return Math.abs(t)**e*i}let g6=class{constructor(){this._commonWriter=new B3e}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return UX.createBuffer(e)}write(e,i,r){this._commonWriter.write(e,i,r),ve($D,r.faceNormal0,r.faceNormal1),Oe($D,$D),e.normal.setVec(i,$D)}trim(e,i){return this._commonWriter.trim(e,i)}};g6.Layout=UX,g6.glLayout=au(UX,1);let y6=class{constructor(){this._commonWriter=new B3e}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return VX.createBuffer(e)}write(e,i,r){this._commonWriter.write(e,i,r),e.normalA.setVec(i,r.faceNormal0),e.normalB.setVec(i,r.faceNormal1)}trim(e,i){return this._commonWriter.trim(e,i)}};y6.Layout=VX,y6.glLayout=au(VX,1);const $D=M(),LD=new TM,fw=-1;var _6;function QTt(t,e,i,r=n2t){const s=t.vertices.position,n=t.vertices.componentIndex,o=ii(r.anglePlanar),a=ii(r.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),h=kX.edge,p=h.position0,f=h.position1,m=h.faceNormal0,y=h.faceNormal1,_=s2t(t),b=r2t(t),w=b.length/4,S=e.allocate(w);let T=0;const E=w,O=i.allocate(E);let R=0,L=0,P=0;const F=tDe(0,w),V=new Float32Array(w);V.forEach((ie,H,$)=>{s.getVec(b[4*H+0],p),s.getVec(b[4*H+1],f),$[H]=Ar(p,f)}),F.sort((ie,H)=>V[H]-V[ie]);const B=new Array,G=new Array;for(let ie=0;ie<w;ie++){const H=F[ie],$=V[H],N=b[4*H+0],U=b[4*H+1],q=b[4*H+2],Y=b[4*H+3],Q=Y===fw;if(s.getVec(N,p),s.getVec(U,f),Q)fe(m,_[3*q+0],_[3*q+1],_[3*q+2]),he(y,m),h.componentIndex=n.get(N),h.cosAngle=Ae(m,y);else{if(fe(m,_[3*q+0],_[3*q+1],_[3*q+2]),fe(y,_[3*Y+0],_[3*Y+1],_[3*Y+2]),h.componentIndex=n.get(N),h.cosAngle=Ae(m,y),t2t(h,c))continue;h.cosAngle<-.9999&&he(y,m)}L+=$,P++,Q||e2t(h,l)?(e.write(S,T++,h),B.push($)):i2t(h,o)&&(i.write(O,R++,h),G.push($))}const te=new Float32Array(B.reverse()),se=new Float32Array(G.reverse());return{regular:{instancesData:e.trim(S,T),lodInfo:{lengths:te}},silhouette:{instancesData:i.trim(O,R),lodInfo:{lengths:se}},averageEdgeLength:L/P}}function e2t(t,e){return t.cosAngle<e}function t2t(t,e){return t.cosAngle>e}function i2t(t,e){const i=Dn(t.cosAngle),r=kX.fwd,s=kX.ortho;return i0(r,t.position1,t.position0),i*(Ae(Et(s,t.faceNormal0,t.faceNormal1),r)>0?-1:1)>e}function r2t(t){const e=t.faces.length/3,i=t.faces,r=t.neighbors;let s=0;for(let a=0;a<e;a++){const l=r[3*a+0],c=r[3*a+1],h=r[3*a+2],p=i[3*a+0],f=i[3*a+1],m=i[3*a+2];s+=l===fw||p<f?1:0,s+=c===fw||f<m?1:0,s+=h===fw||m<p?1:0}const n=new Int32Array(4*s);let o=0;for(let a=0;a<e;a++){const l=r[3*a+0],c=r[3*a+1],h=r[3*a+2],p=i[3*a+0],f=i[3*a+1],m=i[3*a+2];(l===fw||p<f)&&(n[o++]=p,n[o++]=f,n[o++]=a,n[o++]=l),(c===fw||f<m)&&(n[o++]=f,n[o++]=m,n[o++]=a,n[o++]=c),(h===fw||m<p)&&(n[o++]=m,n[o++]=p,n[o++]=a,n[o++]=h)}return n}function s2t(t){const e=t.faces.length/3,i=t.vertices.position,r=t.faces,s=az.v0,n=az.v1,o=az.v2,a=new Float32Array(3*e);for(let l=0;l<e;l++){const c=r[3*l+0],h=r[3*l+1],p=r[3*l+2];i.getVec(c,s),i.getVec(h,n),i.getVec(p,o),be(n,n,s),be(o,o,s),Et(s,n,o),Oe(s,s),a[3*l+0]=s[0],a[3*l+1]=s[1],a[3*l+2]=s[2]}return a}(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH"})(_6||(_6={}));const kX={edge:{position0:M(),position1:M(),faceNormal0:M(),faceNormal1:M(),componentIndex:0,cosAngle:0},ortho:M(),fwd:M()},az={v0:M(),v1:M(),v2:M()},n2t={anglePlanar:4,angleSignificantEdge:35};function o2t(t){const e=a2t(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return Lde.updateSettings(t.writerSettings),Dde.updateSettings(t.writerSettings),QTt(e,Lde,Dde)}function a2t(t,e,i,r){if(e){const o=Ide(i,r,t.count);return new l2t(i,r,o,t)}const s=KW(t.buffer,t.stride/4,{originalIndices:i,originalIndicesLength:r}),n=Ide(s.indices,r,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:n,vertices:f6.createView(s.buffer)}}let l2t=class{constructor(e,i,r,s){this.faces=e,this.facesLength=i,this.neighbors=r,this.vertices=s}};const Lde=new g6,Dde=new y6,S9t=cs().vec3f(A.POSITION0).vec3f(A.POSITION1),c2t=cs().vec3f(A.POSITION0).vec3f(A.POSITION1).u16(A.COMPONENTINDEX).u16(A.U16PADDING,{glPadding:!0});let u2t=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},h2t=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this.textureWidth=4096,this._dirty=!0,this._texture=new xt(this._rctx,{target:Pt.TEXTURE_2D,pixelFormat:it.RGBA,dataType:Ht.UNSIGNED_BYTE,samplingMode:gt.NEAREST,wrapMode:kt.CLAMP_TO_EDGE,width:this.textureWidth,height:1,flipped:!1}),this._data=new Na(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,i,r,s,n,o){const a=e*this._fieldCount+i;this._dirty=!0,this._data.set(a,0,r),this._data.set(a,1,s),this._data.set(a,2,n),this._data.set(a,3,o)}setDataElement(e,i,r,s){const n=e*this._fieldCount+i;this._dirty=!0,this._data.set(n,r,s)}resizeToFit(e){const i=e*this._fieldCount;if(i>=this._data.count){const r=Math.ceil((i+1)/this.textureWidth)*this.textureWidth,s=new Na(new ArrayBuffer(4*r));s.typedBuffer.set(this._data.typedBuffer),this._data=s}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,i=this._texture.descriptor.height;this._data.count>e*i&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const z3e=65536;let d2t=class{constructor(e,i=1){this.textureBuffer=new h2t(e,i),this._indexManager=new u2t(z3e)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},G3e=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const r of this._buffers)if(r.availableCount>=e)return r;if(e>z3e)return null;const i=new d2t(this._rctx,this._fieldCount);return this._buffers.push(i),i}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const Nde=oe.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class p2t{constructor(e,i){this._renderManager=e,this._viewingMode=i,this._objects=[new li,new li],this._renderSubmit=new DTt(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=de("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new G3e(e.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){Ct(this._objects[GE.Hidden].length===0&&this._objects[GE.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy()}createObject(e){const i=new dM;return i.toMapSpace=e.toMapSpace,i.transform=e.transform,i.obb=xde(e.obb),i.components=new mTt(this._componentBufferManager,e.geometry.componentOffsets),i.renderable=this._createRenderable(e,i.components),i.intersectionGeometry=new xTt(e.geometry.positionData,i.components),this._objects[i.visible].push(i),i}destroyObject(e){const i=e;this._objects[i.visible].removeUnordered(i),i.destroy(),this._notifyDirty()}setObjectVisibility(e,i){const r=e;i!==r.visible&&(this._objects[r.visible].removeUnordered(r),this._objects[i].push(r),r.visible=i,this._notifyDirty())}preSubmit(e){const i=e.camera.eye;this.visibleObjects.forAll(r=>r.renderable.meta.cameraDepthSquared=Bo(i,r.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,i){const r=e.renderable.material;i(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,i){const r=e;r.components.visibility.reset(i),r.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,i){return e.components.visibility.forEachComponent(i)}getComponentCount(e){const i=e,r=i.components.visibility.componentCount();return{visible:r,invisible:i.components.count-r}}setComponentData(e,i){const r=e,s=r.renderable.material,n=r.components,o=n.materialDataBuffer,a=n.materialDataIndices,l=new FTt,c=o.textureBuffer,h=new Uint8Array(4),p=new Uint32Array(h.buffer);let f=0,m=0,y=0,_=n.verticalOffsets,b=1/0,w=-1/0,S=!1,T=!1,E=0;for(let O=0;O<n.count;O++){i(O,l),f+=+(l.externalColor[3]<1),m+=+(l.externalColorMixMode===Rn.Replace&&l.externalColor[3]===1),y+=+l.castShadows,JOe(l.externalColor,l.externalColorMixMode,h),h[2]=254&h[2]|+l.castShadows,c.setData(a[O],0,h[0],h[1],h[2],h[3]),S||(S=O>0&&E!==p[0]),E=p[0],T||(T=l.elevationOffset!==0),T&&C(_)&&(_=new Array(O).fill(0)),v(_)&&(_[O]=l.elevationOffset),b=Math.min(b,l.elevationOffset),w=Math.max(w,l.elevationOffset),L3e(l.elevationOffset,h),c.setData(a[O],1,h[0],h[1],h[2],h[3]);const R=l.objectAndLayerIdColor;v(R)&&c.setData(a[O],2,R[0],R[1],R[2],R[3]),l.pickable!==P3e(n.pickability,O)&&(n.pickability=yTt(n.pickability,n.count,O,l.pickable))}n.verticalOffsets=T?_:null,r.offsetObb=T?dTt(r.obb,b,w,this._viewingMode,v(r.offsetObb)?r.offsetObb:xde(r.obb)):null,S||T||this._hasObjectAndLayerId?(s.componentParameters=new pM,s.componentParameters.castShadows=lz(y,n.count),s.componentParameters.transparent=lz(f,n.count),s.componentParameters.opaqueOverride=lz(m,n.count),s.componentParameters.texture=c,c.updateTexture()):(s.componentParameters=new v3,s.componentParameters.castShadows=l.castShadows?Hn.All:Hn.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(e,i,r,s=!1){e.intersectionGeometry.getComponentAabb(i,r);const n=e,o=n.components.verticalOffsets;if(s||C(o))return r;const a=o[i];if(this._viewingMode===st.Local||a===0)return r[2]+=a,r[5]+=a,r;const l=oot(a);return l.localOrigin=n.transform.position,l.applyToAabb(r)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,i,r){return e.intersectionGeometry.getComponentPositions(i,r)}intersect(e,i,r,s,n,o){const a=e;v(n)&&(n.localOrigin=a.transform.position);const l=mT(Fde,a.transform.rotationScale);po(DD,i,a.transform.position),po(ND,r,a.transform.position),qc(DD,DD,l),qc(ND,ND,l);const c=wd(Fde,l);return a.intersectionGeometry.intersect(DD,ND,s,c,n,a.components.verticalOffsets,o)}addEdges(e,i,r,s){const n=e,{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets;return i.addComponentObject(e,n.transform,{center:n.obb.center,radius:hTt(n.obb)},a,o,l,r,s)}async extractEdgeInformation(e,i,r){const s=e,n=s.components.visibility;if(n.allInvisible())return{buffer:c2t.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets,c=f6.createBuffer(a.count);H8(c.position,a),h1(c.position,c.position,s.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const h=c.count,p=this._computeVisibilityIndices(o,n,l,h);return{origin:xs(s.transform.position),buffer:await i.extractComponentsEdgeLocations({indices:p,indicesLength:p.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},r)}}_setComponentIndices(e,i,r){let s=0;for(let n=0;n<r.length-1;n++){const o=r[n],a=r[n+1];for(let l=o;l<a;l++){const c=i?i[l]:l;e.set(c,s)}s++}}_computeVisibilityIndices(e,i,r,s){if(e&&i.allVisible())return e;let n=0;i.forEachComponentRange((l,c)=>(n+=r[c]-r[l],!0));const o=Array.isArray(e)?new Array(n):(e==null?void 0:e.BYTES_PER_ELEMENT)===2||s<=65536?new Uint16Array(n):new Uint32Array(n);let a=0;return i.forEachComponentRange((l,c)=>{const h=r[l],p=r[c];for(let f=h;f<p;f++)o[a++]=e?e[f]:f;return!0}),o}addComponentHighlight(e,i){const r=e.components;C(r.highlightCounts)&&(r.highlightCounts=new Uint32Array(r.count+1)),r.highlightCounts[i]++===0&&(r.highlightsDirty(),this._notifyDirty()),r.highlightCounts[r.count]++}removeComponentHighlight(e,i){const r=e.components;if(C(r.highlightCounts))return void Nde.warn("Removing non-existing highlight.");const s=r.highlightCounts[i],n=r.highlightCounts[r.count];if(s!==0){if(s>1)return r.highlightCounts[i]=s-1,void(r.highlightCounts[r.count]=n-1);r.highlightCounts[i]=0,r.highlightsDirty(),this._notifyDirty(),n===1?r.highlightCounts=null:r.highlightCounts[r.count]=n-1}else Nde.warn("Removing non-existing highlight.")}clearHighlights(e){const i=e.components;v(i.highlightCounts)&&(i.highlightCounts=null,i.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[GE.Visible]}_createRenderable(e,i){const r=this._renderManager.rctx,s=e.geometry,n=s.vertices.layoutParameters,o=Yi.createVertex(r,Fi.STATIC_DRAW,s.vertices.data),a=go(s.indices,_=>Yi.createIndex(r,Fi.STATIC_DRAW,_)),l=au(NTt(n)),c=new Uint16Array(s.vertices.count);for(let _=0;_<i.count;_++){const b=i.offsets[_],w=i.offsets[_+1],S=i.materialDataIndices[_];if(v(s.indices))for(let T=b;T<w;T++)c[s.indices[T]]=S;else for(let T=b;T<w;T++)c[T]=S}const h=Yi.createVertex(r,Fi.STATIC_DRAW,c.buffer),p=new ro(e.transform,e.toMapSpace),f=new vd(r,F3e,{data:l,componentIndices:f2t},{data:o,componentIndices:h},a),m=new CTt(f,jt.TRIANGLES,n,v(a)),y={cameraDepthSquared:.5,gpuMemoryEstimate:o.byteSize+h.byteSize+(v(a)?a.byteSize:0)};return new ETt(p,m,y)}_notifyDirty(){this._renderManager.notifyDirty()}}const f2t=au(cs().u16(A.COMPONENTINDEX));function lz(t,e){return t===e?Hn.All:t===0?Hn.None:Hn.Some}const Fde=ac(),DD=M(),ND=M();let j3e=class extends yr{constructor(){super(...arguments),this.opacity=1}};function m2t(t){const e=new Ui;return e.include(Ad),e.fragment.uniforms.add(new zt("tex",i=>i.texture)),t.hasOpacityFactor&&e.fragment.uniforms.add(new He("opacity",i=>i.opacity)),e.fragment.code.add(x`
    void main() {
      gl_FragColor = texture2D(tex, uv) ${t.hasOpacityFactor?"* opacity":""};
    }`),e}const g2t=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:j3e,build:m2t},Symbol.toStringTag,{value:"Module"}));var Oa;(function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.PremultipliedAlpha=2]="PremultipliedAlpha",t[t.COUNT=3]="COUNT"})(Oa||(Oa={}));let BX=class extends Va{constructor(){super(...arguments),this.alphaMode=Oa.None,this.hasOpacityFactor=!1}};u([z({count:Oa.COUNT})],BX.prototype,"alphaMode",void 0),u([z()],BX.prototype,"hasOpacityFactor",void 0);let H3e=class q3e extends ji{initializeProgram(e){return new ki(e.rctx,q3e.shader.get().build(this.configuration),Li)}initializePipeline(){switch(this.configuration.alphaMode){case Oa.None:return Qt({colorWrite:ui});case Oa.Alpha:return Qt({blending:Yn(Ve.SRC_ALPHA,Ve.ONE,Ve.ONE_MINUS_SRC_ALPHA,Ve.ONE_MINUS_SRC_ALPHA),colorWrite:ui});case Oa.PremultipliedAlpha:case Oa.COUNT:return Qt({blending:of(Ve.ONE,Ve.ONE_MINUS_SRC_ALPHA),colorWrite:ui})}}};H3e.shader=new Vi(g2t,()=>ee(()=>import("./Compositing.glsl-3891f1a6.js"),[],import.meta.url));let W3e=class extends yr{};function y2t(){const t=new Ui;return t.include(Ad),t.fragment.uniforms.add(new zt("tex",e=>e.texture)),t.fragment.code.add(x`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`),t}const _2t=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:W3e,build:y2t},Symbol.toStringTag,{value:"Module"}));let X3e=class Y3e extends ji{initializeProgram(e){return new ki(e.rctx,Y3e.shader.get().build(),Li)}initializePipeline(){return Qt({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};X3e.shader=new Vi(_2t,()=>ee(()=>import("./HUDCompositing.glsl-1b8b126e.js"),[],import.meta.url));let Z3e=class extends yr{};function v2t(){const t=new Ui;return t.include(Ad),t.fragment.uniforms.add([new zt("colorTexture",e=>e.colorTexture),new zt("alphaTexture",e=>e.alphaTexture),new zt("frontFaceTexture",e=>e.frontFaceTexture)]),t.fragment.code.add(x`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`),t}const b2t=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:Z3e,build:v2t},Symbol.toStringTag,{value:"Module"}));let J3e=class K3e extends ji{initializeProgram(e){return new ki(e.rctx,K3e.shader.get().build(),Li)}initializePipeline(){return Qt({blending:Yn(Ve.SRC_ALPHA,Ve.ONE,Ve.ONE_MINUS_SRC_ALPHA,Ve.ONE_MINUS_SRC_ALPHA),colorWrite:ui})}};J3e.shader=new Vi(b2t,()=>ee(()=>import("./OITCompositing.glsl-3fb02a98.js"),[],import.meta.url));let Q3e=class extends yr{constructor(){super(...arguments),this.overlayIndex=os.INNER,this.opacity=1}};function w2t(){const t=new Ui;return t.include(Ad),t.fragment.uniforms.add(new zt("tex",e=>e.texture)),t.fragment.uniforms.add(new FI("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new He("opacity",e=>e.opacity)),t.fragment.code.add(x`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
gl_FragColor = texture2D(tex, overlayUV) * opacity;
}`),t}const x2t=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:Q3e,build:w2t},Symbol.toStringTag,{value:"Module"}));let ePe=class tPe extends ji{initializeProgram(e){return new ki(e.rctx,tPe.shader.get().build(),Li)}initializePipeline(){return Qt({blending:of(Ve.ONE,Ve.ONE_MINUS_SRC_ALPHA),colorWrite:ui})}};ePe.shader=new Vi(x2t,()=>ee(()=>import("./OverlayCompositing.glsl-e723ac21.js"),[],import.meta.url));let T2t=class{constructor(e,i){this._rctx=e,this._techniqueRepository=i,this._configuration=new BX,this._passParameters=new j3e,this._oitParameters=new Z3e,this._hudParameters=new W3e,this._overlayParameters=new Q3e}destroy(){this._vao=ft(this._vao)}compositeOIT(e,i,r,s){this._oitParameters.colorTexture=i,this._oitParameters.alphaTexture=r,this._oitParameters.frontFaceTexture=s;const n=this._rctx,o=this._techniqueRepository.acquire(J3e);n.bindTechnique(o,this._oitParameters,e);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(jt.TRIANGLE_STRIP,0,oa(a,"geometry")),o.release()}compositeHUD(e,i){this._hudParameters.texture=i;const r=this._rctx,s=this._techniqueRepository.acquire(X3e);r.bindTechnique(s,this._hudParameters,e);const n=this._ensureVAO();r.bindVAO(n),r.drawArrays(jt.TRIANGLE_STRIP,0,oa(n,"geometry")),s.release()}compositeOverlay(e,i,r,s){this._overlayParameters.texture=i,this._overlayParameters.opacity=r,this._overlayParameters.overlayIndex=s;const n=this._rctx,o=this._techniqueRepository.acquire(ePe);n.bindTechnique(o,this._overlayParameters,e);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(jt.TRIANGLE_STRIP,0,oa(a,"geometry")),o.release()}composite(e,i,r=Oa.None,s=1){const n=this._rctx;this._configuration.alphaMode=r,this._configuration.hasOpacityFactor=s!==1,this._passParameters.texture=i,this._passParameters.opacity=s;const o=this._techniqueRepository.acquire(H3e,this._configuration);n.bindTechnique(o,this._passParameters,e);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(jt.TRIANGLE_STRIP,0,oa(a,"geometry")),o.release()}_ensureVAO(){return C(this._vao)&&(this._vao=ka(this._rctx)),this._vao}};const S2t=1e4,zX=100,E2t=500,C2t=500,A2t=.1;function O2t(t,e,i){return iee(e,t)*(i[1]-i[0])+i[0]}function R2t(t,e,i){let r=0;if(!e.some(n=>(r+=n.numGeometries,r>=S2t)))return F2t.compute(t,e);const s=kI();return i.forAll(n=>{n.visible&&GC(s,M2t(t,n))}),s}function M2t(t,e){if(!e.visible)return;const i=kI(),r=e.getSpatialQueryAccelerator();return v(r)?P2t(i,t,r):I2t(i,t,e.objects),i}function P2t(t,e,i){const r=e.eye,s=e.viewForward,n=e.frustum,o=l=>l.visible,a=i.objectCount;if(a<E2t)DP(kh,e.near,Math.min(t.near,e.far)),i.forEachInDepthRange(r,s,Np.DepthOrder.FRONT_TO_BACK,kh,(l,c)=>{GX(t,e,l),kh.far=t.near,c.setRange(kh)},n,o),DP(kh,Math.max(t.far,e.near),e.far),i.forEachInDepthRange(r,s,Np.DepthOrder.BACK_TO_FRONT,kh,(l,c)=>{GX(t,e,l),kh.near=t.far,c.setRange(kh)},n,o);else{const l=Math.max(Math.min(a,C2t),Math.ceil(a*A2t)),c=i.findClosest(s,Np.DepthOrder.FRONT_TO_BACK,n,o,l),h=i.findClosest(s,Np.DepthOrder.BACK_TO_FRONT,n,o,l);c&&h&&(Ude(t,e,c.boundingVolumeWorldSpace.bounds),Ude(t,e,h.boundingVolumeWorldSpace.bounds))}}function I2t(t,e,i){C2.clear(),i.forAll(r=>{r.visible&&r.geometries.length!==0&&C2.add(r)}),C2.empty||(C2.sort(e),DP(kh,e.near,Math.min(t.near,e.far)),C2.forEachInDepthRange(kh,Np.DepthOrder.FRONT_TO_BACK,(r,s)=>{s<t.near&&GX(t,e,r)}),DP(kh,Math.max(t.far,e.near),e.far),C2.forEachInDepthRange(kh,Np.DepthOrder.BACK_TO_FRONT,(r,s,n)=>{t.far=Math.max(t.far,n)}))}function GX(t,e,i){if(!i.visible||!Cv(e.frustum,i.boundingVolumeWorldSpace.bounds))return;const r=i.transformation,s=N2t;i.geometries.forEach(n=>{Ts(s,r,n.shaderTransformation);const o=Lx(s);iPe(t,e,n.boundingInfo,s,o)})}function iPe(t,e,i,r,s){if(C(i))return;ut(ta,i.center,r);const{eye:n,viewForward:o}=e,a=o[0]*(ta[0]-n[0])+o[1]*(ta[1]-n[1])+o[2]*(ta[2]-n[2]);if(ta[3]=i.radius*s,!(a-ta[3]>t.near&&a+ta[3]<t.far)&&Cv(e.frustum,ta))if(i.radius>zX&&i.getChildren())for(const l of i.getChildren())iPe(t,e,l,r,s);else jX.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,r,i.bbMin,i.bbMax)}function Ude(t,e,i){const r=e.eye,s=e.viewForward,n=(i[0]-r[0])*s[0]+(i[1]-r[1])*s[1]+(i[2]-r[2])*s[2];t.near=Math.min(t.near,n-i[3]),t.far=Math.max(t.far,n+i[3])}let $2t=class{constructor(){this._items=new li({allocator:e=>e||{obj:null,distance:0,near:0,far:0},deallocator:e=>(e.obj=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().obj=e}sort(e){const i=e.eye,r=e.viewForward;this._items.forAll(s=>{const n=s.obj.boundingVolumeWorldSpace.bounds,o=(n[0]-i[0])*r[0]+(n[1]-i[1])*r[1]+(n[2]-i[2])*r[2];s.distance=o,s.near=o-n[3],s.far=o+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(e,i,r){if(i===Np.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<e.near||n.near>e.far||r(n.obj,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<e.near||n.near>e.far||r(n.obj,n.near,n.far)}}},L2t=class{constructor(){this._view=We(),this._viewProj=We(),this._frustum=cP(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(e,i){this._reset(),Xn(this._view,e.viewMatrix),Ts(this._viewProj,e.projectionMatrix,this._view),w5(this._frustum,e.frustum);const r=this._view,s=r[2],n=r[6],o=r[10],a=r[14];i.forAll(f=>f.forEachGeometry(m=>{if(!m.visible||!m.castShadow)return;let y;m.hasShaderTransformation?(m.computeBoundingSphere(m.shaderTransformation,ta,1),y=ta):y=m.boundingSphere;const _=s*y[0]+n*y[1]+o*y[2]+a,b=_-y[3],w=_+y[3];this._geometries.push(m),this._near.push(-w),this._far.push(-b)}));const l=new ATt;if(this._geometries.length===0)return l;for(let f=0;f<this._geometries.length;++f)this._near[f]>l.far&&(l.far=this._near[f]),this._near[f]>2&&this._far[f]<l.near&&(l.near=this._far[f]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let h=0,p=0;for(let f=0;f<this._geometries.length;++f)this._near[f]<l.near&&(this._near[f]>=c.near?l.near=this._near[f]:this._nearCandidates[h++]=f),this._far[f]>l.far&&(this._far[f]<=c.far?l.far=this._far[f]:this._farCandidates[p++]=f);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((f,m)=>this._near[f]<this._near[m]?-1:this._near[f]>this._near[m]?1:0),this._farCandidates.sort((f,m)=>this._far[f]<this._far[m]?1:this._far[f]>this._far[m]?-1:0);for(let f=0;f<this._nearCandidates.length;++f){const m=this._nearCandidates[f];if(this._near[m]<l.near){const y=this._geometries[m],_=y.boundingInfo;this._includeNearBoundingInfoRec(_,y.shaderTransformation,l)}}for(let f=0;f<this._farCandidates.length;++f){const m=this._farCandidates[f];if(this._far[m]>l.far){const y=this._geometries[m],_=y.boundingInfo;this._includeFarBoundingInfoRec(_,y.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(e,i,r){if(C(e))return;const s=e.center;ut(ta,s,i);const n=Lx(i),o=ta[0],a=ta[1],l=ta[2],c=e.radius*n,h=this._frustum;if(h[0][0]*o+h[0][1]*a+h[0][2]*l+h[0][3]>c||h[1][0]*o+h[1][1]*a+h[1][2]*l+h[1][3]>c||h[2][0]*o+h[2][1]*a+h[2][2]*l+h[2][3]>c||h[3][0]*o+h[3][1]*a+h[3][2]*l+h[3][3]>c)return;const p=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14],f=p+c;if(!(-(p-c)<2||-f>=r.near))if(-f>this._looseRange.near)r.near=-f;else{if(c>zX){const m=e.getChildren();if(m!==void 0){for(const y of m)this._includeNearBoundingInfoRec(y,i,r);return}}jX.unionDepthRangeWithAABB(r,this._viewProj,i,e.bbMin,e.bbMax)}}_includeFarBoundingInfoRec(e,i,r){if(C(e))return;let s=e.radius;const n=e.center;ut(ta,n,i);const o=Lx(i),a=ta[0],l=ta[1],c=ta[2];s*=o;const h=this._frustum;if(h[0][0]*a+h[0][1]*l+h[0][2]*c+h[0][3]>s||h[1][0]*a+h[1][1]*l+h[1][2]*c+h[1][3]>s||h[2][0]*a+h[2][1]*l+h[2][2]*c+h[2][3]>s||h[3][0]*a+h[3][1]*l+h[3][2]*c+h[3][3]>s)return;const p=this._view[2]*a+this._view[6]*l+this._view[10]*c+this._view[14]-s;if(!(-p<=r.far))if(-p<this._looseRange.far)r.far=-p;else{if(s>zX){const f=e.getChildren();if(f!==void 0){for(const m of f)this._includeFarBoundingInfoRec(m,i,r);return}}jX.unionDepthRangeWithAABB(r,this._viewProj,i,e.bbMin,e.bbMax)}}},D2t=class{constructor(){this._modelViewProj=We(),this._clipPosition=[fi(),fi(),fi(),fi(),fi(),fi(),fi(),fi()]}unionDepthRangeWithAABB(e,i,r,s,n){const o=this._modelViewProj;Ts(o,i,r);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],h=l===0||l===3||l===4||l===7?s[0]:n[0],p=l===0||l===1||l===4||l===5?s[1]:n[1],f=l<4?s[2]:n[2];c[0]=o[0]*h+o[4]*p+o[8]*f+o[12],c[1]=o[1]*h+o[5]*p+o[9]*f+o[13],c[2]=o[2]*h+o[6]*p+o[10]*f+o[14],c[3]=o[3]*h+o[7]*p+o[11]*f+o[15]}for(let l=0;l<12;++l){const c=this._clipPosition[cz[l][0]],h=this._clipPosition[cz[l][1]],p=this._clipPosition[cz[l][2]],f=this._clipTriangle(c,h,p);let m=!0;for(let y=0;y<f.length;++y)if(f[y][3]>=2){m=!1;break}if(!m){a=!0;for(let y=0;y<f.length;++y){const _=f[y][3];Number.isFinite(_)&&(e.near=Math.min(_,e.near),e.far=Math.max(_,e.far))}}}return a}_inside(e,i){return i===0?e[0]>=-e[3]:i===1?e[1]>=-e[3]:i===2?e[0]<=e[3]:i===3?e[1]<=e[3]:void Ct(!1)}_intersect(e,i,r){let s=0;return r===0?s=(-e[3]-e[0])/(i[0]-e[0]+i[3]-e[3]):r===1?s=(-e[3]-e[1])/(i[1]-e[1]+i[3]-e[3]):r===2?s=(e[3]-e[0])/(i[0]-e[0]-i[3]+e[3]):r===3&&(s=(e[3]-e[1])/(i[1]-e[1]-i[3]+e[3])),z6(fi(),e,i,s)}_clipTriangle(e,i,r){let s=[e,i,r];for(let n=0;n<4;++n){const o=s;s=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,n)?(this._inside(l,n)||s.push(this._intersect(l,c,n)),s.push(c)):this._inside(l,n)&&s.push(this._intersect(l,c,n))}}return s}};const cz=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],ta=gn(),N2t=We(),kh=kI(),C2=new $2t,F2t=new L2t,jX=new D2t;let U2t=class{},V2t=class extends yr{constructor(){super(...arguments),this.textures=new U2t}};function k2t(){const t=new Ui;return t.attributes.add(A.POSITION,"vec2"),t.vertex.uniforms.add(new Si("drawPosition",(e,i)=>B2t(e,i))),t.varyings.add("vUV","vec2"),t.vertex.code.add(x`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),t.fragment.uniforms.add(new zt("textureInput",e=>e.textures.input)),t.fragment.uniforms.add(new zt("textureMask",e=>e.textures.mask)),t.fragment.uniforms.add(new zt("textureOverlay",e=>e.textures.overlay)),t.fragment.uniforms.add(new My("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new My("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(x`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),t}function B2t(t,e){const i=e.camera.pixelRatio,r=t.magnifier.offset.x*i,s=t.magnifier.offset.y*i;pm(t.magnifier.position,Vde);const n=e.camera.screenToRender(Vde,z2t),o=Math.ceil(i*t.magnifier.size),a=e.camera.fullWidth,l=e.camera.fullHeight;return nr(G2t,(n[0]+r)/a*2-1,(n[1]-s)/l*2-1,o/a*2,o/l*2)}const Vde=ms(),z2t=Vye(),G2t=fi();async function j2t(t){const e=ee(()=>import("./mask-svg-023bbc42.js"),[],import.meta.url),i=ee(()=>import("./overlay-svg-d62383f3.js"),[],import.meta.url),r=Ky((await e).default,{signal:t}),s=Ky((await i).default,{signal:t}),n={mask:await r,overlay:await s};return gi(t),n}let PS=class extends $e{constructor(){super(...arguments),this._handles=new Ki,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new V2t,this.events=new As,this.attributeLocations=new Map([[A.POSITION,0]]),this._tmpScreenPoint=ms(),this._tmpRenderPoint=Vye()}get updating(){return C(this._imageSources)&&v(this._imageLoadTask)&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const i=()=>{this._updateResourceLoading(),this.events.emit("request-render")};v(this._magnifier)&&this._handles.add(re(()=>go(this._magnifier,r=>r.version),i)),i()}get enabled(){return v(this._validMagnifier)}get _validMagnifier(){return v(this._magnifier)&&this._magnifier.visible&&v(this._magnifier.position)&&this._magnifier.size>0?this._magnifier:null}get _factor(){return v(this._magnifier)&&this._magnifier.factor||1}destroy(){this._magnifier=null,this._handles.destroy(),v(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,i){const r=this._validMagnifier;if(C(r))return;const s=i.camera.pixelRatio,n=Math.ceil(s*r.size);if(this._updateResources(e,n),C(this._resources))return;const o=this._passParameters.textures,a=Math.ceil(1/this._factor*n);o.input.resize(a,a),pm(r.position,this._tmpScreenPoint);const l=i.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),c=i.camera.fullWidth,h=i.camera.fullHeight,p=.5*a,f=.5*a;l[0]=we(l[0],p,c-p-1),l[1]=we(l[1],f,h-f-1);const m=Math.floor(l[0]-p),y=Math.floor(l[1]-f),_=this._resources.program;_.bindTexture("textureInput",o.input),e.gl.copyTexImage2D(o.input.descriptor.target,0,o.input.descriptor.pixelFormat,m,y,a,a,0),this._passParameters.magnifier=r,e.useProgram(_),_.bindPass(this._passParameters,i),e.bindVAO(this._resources.vao),e.setPipelineState(this._resources.pipelineState),e.drawArrays(jt.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(C(e))return;const i=e.maskUrl,r=e.overlayUrl;!v(this._imageLoadTask)||this._imageLoadTask.maskUrl===i&&this._imageLoadTask.overlayUrl===r||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),v(this._imageSources)||v(this._imageLoadTask)||(this._imageLoadTask={maskUrl:i,overlayUrl:r,task:uI(async s=>{const n=C(i)||C(r)?j2t(s):null,o=v(i)?Ky(i,{signal:s}):n.then(l=>l.mask),a=v(r)?Ky(r,{signal:s}):n.then(l=>l.overlay);this._imageSources={mask:await o,overlay:await a},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,i){if(!this.enabled)return void this._disposeResources();if(v(this._resources)){if(this._passParameters.textures.size!==i){const s=this._createTextureResources(e,i);if(C(s))return void this._disposeResources();this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=s}return}const r=this._createTextureResources(e,i);C(r)||(this._resources={program:this._createProgram(e),vao:ka(e,BK,this.attributeLocations,0,1),pipelineState:Qt({blending:of(Ve.ONE,Ve.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:ui})},this._passParameters.textures=r)}_disposeResources(){C(this._resources)||(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,i){if(C(this._imageSources))return null;this._imageSources.overlay.width=i,this._imageSources.overlay.height=i,this._imageSources.mask.width=i,this._imageSources.mask.height=i;const r=new xt(e,{target:Pt.TEXTURE_2D,pixelFormat:it.RGBA,internalFormat:it.RGBA,dataType:Ht.UNSIGNED_BYTE,wrapMode:kt.CLAMP_TO_EDGE,samplingMode:gt.LINEAR,flipped:!0,preMultiplyAlpha:!f0e(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result},this._imageSources.overlay),s=new xt(e,{target:Pt.TEXTURE_2D,pixelFormat:it.ALPHA,internalFormat:it.ALPHA,dataType:Ht.UNSIGNED_BYTE,wrapMode:kt.CLAMP_TO_EDGE,samplingMode:gt.LINEAR,flipped:!0},this._imageSources.mask);return{input:new xt(e,{target:Pt.TEXTURE_2D,pixelFormat:it.RGBA,internalFormat:it.RGBA,dataType:Ht.UNSIGNED_BYTE,wrapMode:kt.CLAMP_TO_EDGE,samplingMode:gt.LINEAR,flipped:!1}),mask:s,overlay:r,size:i}}_createProgram(e){return new ki(e,k2t(),this.attributeLocations)}};u([d()],PS.prototype,"_imageSources",void 0),u([d()],PS.prototype,"_imageLoadTask",void 0),u([d({readOnly:!0})],PS.prototype,"updating",null),PS=u([I("esri/views/3d/webgl-engine/lib/MagnifierHelper")],PS);let H2t=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new Na(new ArrayBuffer(4)),this._uidToRenderColor=new Map,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Map,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,i,r,s,n,o=null,a=null,l=null){if(!(e&&i&&r&&s)||(this._layerUidToId.set(s,r),this._layerUidToPopupEnabled.set(s,n),!n))return;let c=this._layerUidToGraphicsUidToObjectId.get(s);c||(c=new Map,this._layerUidToGraphicsUidToObjectId.set(s,c)),c.set(i,{objectId:e,attributeNodeId:o,attributeIndex:a,subLayerId:l})}getObjectAndLayerIdColor(e){const i=this.getObjectAndLayerIdColorArray(e);return si(i.get(0,1),i.get(0,2),i.get(0,3),255)}getObjectAndLayerIdColorArray(e){if(!e.layerUid||!e.graphicUid)return this.colorZero;const i=this._layerUidToPopupEnabled.get(e.layerUid);if(i===void 0)return oe.getLogger(this.declaredClass).warn("popupEnabled is undefined for layerUid "+e.layerUid),this.colorZero;if(i===!1)return this.colorZero;let r=this._uidToRenderColor.get(e.layerUid);r||(r=new Map,this._uidToRenderColor.set(e.layerUid,r));let s=r.get(e.graphicUid);if(!s){for(;!s;){const o=Math.floor(16777214*Math.random())+1;this._colorToUID.has(o)||(s=o)}if(s>16777215)throw new Error("Object ID Overflow");r.set(e.graphicUid,s),this._colorToUID.set(s,e)}const n=new ArrayBuffer(4);return new DataView(n).setUint32(0,s,!1),new Na(n)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[i,r]of this._colorToUID.entries()){const s=this._layerUidToGraphicsUidToObjectId.get(r.layerUid);let n=null;s?(n=s.get(r.graphicUid),n||oe.getLogger(this.declaredClass).warn("getColorMapping: no entry found for graphicsId "+r.graphicUid)):oe.getLogger(this.declaredClass).warn("getColorMapping: no entry found for layerUid "+r.layerUid);const o=this._layerUidToId.get(r.layerUid);o||oe.getLogger(this.declaredClass).warn("no layerId found for uid "+r.layerUid),n&&o&&e.set(i,n.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:n.objectId,lid:o,attrId:n.attributeNodeId,attrIdx:n.attributeIndex,subLayerId:n.subLayerId}:{type:"object-and-layer-id",oid:n.objectId,lid:o})}return e}};var NP;(function(t){t[t.FrontToBack=0]="FrontToBack",t[t.BackToFront=1]="BackToFront"})(NP||(NP={}));let l_=class{constructor(e,i,r=NP.FrontToBack){this._rctx=e,this._techniqueRepository=i,this._sorting=r,this._draws=new li({initialSize:32,allocator:s=>s||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,i,r,s){const n=this._draws.pushNew();n.geometry=i,n.geometryRanges=r,n.material=e,n.depthSquaredHint=s,n.indexType=(i.indexed?i.vao.indexBuffer.indexType:null)??0}dispatch(e,i){const r=this._rctx;this._previouslyBoundDraw.clear();let s=null;const n=this._draws.map(a=>a.material.prepareTechnique(this._techniqueRepository,e,i,a.geometry.parameters)),o=this._draws.length;for(let a=0;a<o;a++){const l=n[a];l===s&&l.configuration.transparencyPassType===$t.NONE||(r.bindTechnique(l,e,i),s=l);const c=this._draws.data[a],h=c.geometry;r.bindVAO(h.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,i,e),this._previouslyBoundDraw.set(l,c.material));const p=c.geometryRanges,f=p.length;if(c.indexType!==0){const m=GF.get(c.indexType);for(let y=0;y<f;y+=2){const _=p[y],b=p[y+1];r.drawElements(h.primitiveType,b,c.indexType,_*m)}}else for(let m=0;m<f;m+=2){const y=p[m],_=p[m+1];r.drawArrays(h.primitiveType,y,_)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===NP.FrontToBack?1:-1;this._draws.sort((i,r)=>{const s=e*(i.depthSquaredHint-r.depthSquaredHint);return s!==0?s:i.geometry.vao.size-r.geometry.vao.size})}get count(){return this._draws.length}};const GF=new Map;GF.set(wt.UNSIGNED_BYTE,1),GF.set(wt.UNSIGNED_SHORT,2),GF.set(wt.UNSIGNED_INT,4);let q2t=class{constructor(e,i){this.rctx=e,this.shaderTechniqueRepository=i,this.canRender=!0,this._materialPassParameters=new hwt,this._shadowPassParameters=new dwt,this._highlightPassParameters=new pwt,this._systems=new Set,this._passes={materialOpaque:new l_(e,i),materialTransparent:new l_(e,i,NP.BackToFront),materialIntegratedMesh:new l_(e,i),shadowMap:new l_(e,i),highlight:new l_(e,i),highlightIntegratedMesh:new l_(e,i),highlightShadowMap:new l_(e,i),defaultShadowMap:new l_(e,i)}}register(e){this._systems.add(e)}prepareRender(e){if(this._systems.size!==0){for(const i of Object.values(this._passes))i.prepareSubmit();this._systems.forEach(i=>i.submit(this._passes,e.bindParameters));for(const i of Object.values(this._passes))i.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}render(e){if(this._systems.size!==0)switch(this._configure(e),this._materialPassParameters.output=e.output,e.bindParameters.slot){case Fe.OPAQUE_MATERIAL:switch(e.output){case k.Color:case k.Depth:case k.Normal:return this._passes.materialOpaque.dispatch(this._materialPassParameters,e.bindParameters);case k.Highlight:return this._passes.highlight.dispatch(this._highlightPassParameters,e.bindParameters);case k.Shadow:return this._passes.shadowMap.dispatch(this._shadowPassParameters,e.bindParameters);case k.ShadowHighlight:return this._passes.highlightShadowMap.dispatch(this._shadowPassParameters,e.bindParameters);case k.ShadowExcludeHighlight:return this._passes.defaultShadowMap.dispatch(this._shadowPassParameters,e.bindParameters);case k.ObjectAndLayerIdColor:return this._passes.materialOpaque.dispatch(this._materialPassParameters,e.bindParameters)}return;case Fe.TRANSPARENT_MATERIAL:switch(e.output){case k.Color:case k.Alpha:case k.Depth:case k.Normal:case k.ObjectAndLayerIdColor:return this._passes.materialTransparent.dispatch(this._materialPassParameters,e.bindParameters)}return;case Fe.INTEGRATED_MESH:switch(e.output){case k.Color:case k.Depth:case k.Normal:return this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,e.bindParameters);case k.Highlight:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParameters,e.bindParameters);case k.ObjectAndLayerIdColor:return this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,e.bindParameters)}return}}notifyDirty(){this._context.requestRender()}slots(){return[Fe.OPAQUE_MATERIAL,Fe.TRANSPARENT_MATERIAL,Fe.INTEGRATED_MESH]}initializeRenderContext(e){this._context=e}uninitializeRenderContext(){}queryDepthRange(e){const i={near:1/0,far:-1/0};return this._systems.forEach(r=>{const s=r.queryShadowCasterDepthRange(e);v(s)&&GC(i,s,i)}),i}_configure(e){const i=e.output===k.Shadow||e.output===k.ShadowHighlight||e.output===k.ShadowExcludeHighlight?this._shadowPassParameters:e.output===k.Highlight?this._highlightPassParameters:this._materialPassParameters;this._updateParameters(e,i)}_updateParameters(e,i){const r=e.bindParameters.camera,s=r.viewInverseTransposeMatrix;fe(uz,s[3],s[7],s[11]),hz.set(uz),he(i.transformWorldFromViewTH,hz.high),he(i.transformWorldFromViewTL,hz.low),he(i.slicePlaneLocalOrigin,uz),bd(i.transformViewFromCameraRelativeRS,r.viewMatrix),Xn(i.transformProjFromView,r.projectionMatrix),i.identifier===Hc.Material&&(this._materialPassParameters.transparent=e.bindParameters.slot===Fe.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=e.bindParameters.slot===Fe.INTEGRATED_MESH,wd(kde,i.transformViewFromCameraRelativeRS),mT(i.transformNormalViewFromGlobal,kde))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}};const uz=M(),kde=ls(),hz=new tV;let W2t=class{constructor(){this._step=Gde,this._dilation=1,this._firstIdleTime=0}frame(e,i){if(i?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,de("enable-feature:high-quality-idle")){const s=i?performance.now()-this._firstIdleTime:0;if(s>=Bde+Y2t)return this._step=1/0,void(this._dilation=1);this._dilation=s>=Bde?Z2t:1}else this._dilation=1;const r=we(e/X2t,Gde,K2t);this._step===1/0?this._step=r:this._step=this._step*zde+r*(1-zde)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const X2t=.5,Bde=6e4,Y2t=5e3,Z2t=10,zde=.9,J2t=30,Gde=1e3/1,K2t=1e3/J2t,Q2t=8.6,eSt=.4;function tSt(){const t=new Ui,{vertex:e,fragment:i}=t,r=e.code,s=i.code;return t.attributes.add(A.POSITION,"vec2"),t.varyings.add("uv","vec2"),t.attributes.add(A.UV0,"vec2"),e.uniforms.add(new zt("coverageTex",n=>n.coverageTexture)),r.add(x`void main() {
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),i.uniforms.add(new zt("tex",n=>n.blurColorTexture)),i.uniforms.add(new zt("origin",n=>n.highlightColorTexture)),i.uniforms.add(new Si("uColor",n=>n.color)),i.uniforms.add(new Si("haloColor",n=>n.haloColor)),i.uniforms.add(new Si("opacities",n=>nr(iSt,n.haloOpacity,n.haloOpacityOccluded,n.fillOpacity,n.fillOpacityOccluded))),i.constants.add("outlineSize","float",Q2t),i.constants.add("blurSize","float",eSt),s.add(x`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),t}const iSt=fi(),rSt=Object.freeze(Object.defineProperty({__proto__:null,build:tSt},Symbol.toStringTag,{value:"Module"}));let rPe=class sPe extends ji{initializeProgram(e){return new ki(e.rctx,sPe.shader.get().build(),Li)}initializePipeline(){return Qt({blending:Yn(Ve.SRC_ALPHA,Ve.ONE,Ve.ONE_MINUS_SRC_ALPHA,Ve.ONE_MINUS_SRC_ALPHA),colorWrite:ui})}};rPe.shader=new Vi(rSt,()=>ee(()=>import("./HighlightApply.glsl-3bfee939.js"),[],import.meta.url));let nPe=class extends yr{constructor(){super(...arguments),this.blurSize=et()}};function sSt(){const t=new Ui,{vertex:e,fragment:i}=t,r=e.code,s=i.code;return t.attributes.add(A.POSITION,"vec2"),t.attributes.add(A.UV0,"vec2"),t.varyings.add("blurCoordinate","vec3"),e.uniforms.add(new zt("coverageTex",n=>n.coverageTexture)),i.uniforms.add(new aP("blurSize",n=>n.blurSize)),r.add(x`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),i.uniforms.add(new wI("tex",n=>n.blurInputTexture)),s.add(x`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture2D(tex, uv);
if (blurCoordinate.z == 1.0) {
gl_FragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
gl_FragColor = sum;
}
}`),t}const nSt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:nPe,build:sSt},Symbol.toStringTag,{value:"Module"}));let oPe=class aPe extends ji{initializeProgram(e){return new ki(e.rctx,aPe.shader.get().build(),Li)}initializePipeline(){return Qt({colorWrite:ui})}};oPe.shader=new Vi(nSt,()=>ee(()=>import("./HighlightBlur.glsl-f40678ed.js"),[],import.meta.url));let lPe=class extends yr{constructor(){super(...arguments),this.invFramebufferDim=et()}};function oSt(){const t=new Ui,{vertex:e,fragment:i}=t,r=e.code,s=i.code;return t.attributes.add(A.POSITION,"vec2"),r.add(x`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),i.uniforms.add(new wI("tex",n=>n.inputTexture)),i.uniforms.add(new aP("invFramebufferDim",n=>n.invFramebufferDim)),s.add(x`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),t}const aSt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:lPe,build:oSt},Symbol.toStringTag,{value:"Module"}));let cPe=class uPe extends ji{initializeProgram(e){return new ki(e.rctx,uPe.shader.get().build(),Li)}initializePipeline(){return Qt({colorWrite:ui})}};cPe.shader=new Vi(aSt,()=>ee(()=>import("./HighlightDownsample.glsl-e9ac0022.js"),[],import.meta.url));let jde=class extends yr{constructor(){super(...arguments),this.color=sf(1,0,1,1),this.haloColor=sf(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=si(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}};const lSt=32;let cSt=class{constructor(e,i){this._techniqueRep=e,this._rctx=i,this._viewportToRestore=fi(),this._passParameters=new jde,this._downsampleDrawParameters=new lPe,this._blurDrawParameters=new nPe,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this._quadVAO)return;this._quadVAO=ka(this._rctx);const e={colorTarget:gs.TEXTURE,depthStencilTarget:Di.NONE,width:0,height:0},i={target:Pt.TEXTURE_2D,pixelFormat:it.RGBA,dataType:Ht.UNSIGNED_BYTE,samplingMode:gt.LINEAR,wrapMode:kt.CLAMP_TO_EDGE,width:0,height:0};this._blur0Fbo=new Bs(this._rctx,e,i),this._blur1Fbo=new Bs(this._rctx,e,i),this._blurTechnique=this._techniqueRep.acquire(oPe),this._downsampleTechnique=this._techniqueRep.acquire(cPe),this._applyTechnique=this._techniqueRep.acquire(rPe)}dispose(){if(this._blurTechnique=Wr(this._blurTechnique),this._downsampleTechnique=Wr(this._downsampleTechnique),this._applyTechnique=Wr(this._applyTechnique),this._grid.coverageMipmap)for(let e=1;e<this._grid.coverageMipmap.length;e++)this._grid.coverageMipmap[e].dispose();this._grid.vao&&this._grid.vao.dispose(!0),this._quadVAO&&(this._quadVAO.dispose(!0),this._quadVAO=null),this._blur0Fbo=ft(this._blur0Fbo),this._blur1Fbo=ft(this._blur1Fbo)}setDefaultOptions(e){this._passParameters={...new jde,...e}}render(e,i,r){this._passParameters.highlightColorTexture=i.colorTexture,this._assertResources();const s=e.camera;Op(this._viewportToRestore,s.fullViewport);const n=s.fullWidth,o=s.fullHeight,a=s.pixelRatio,l=Math.ceil(n/a),c=Math.ceil(o/a);this._blur0Fbo.resize(l,c),this._blur1Fbo.resize(l,c);const h=this._rctx;h.bindVAO(this._quadVAO);let p=null;this._gridUpdateResources(i,lSt),this._gridComputeMipmap(e),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,p=this._grid.vao;const f=h.bindTechnique(this._blurTechnique,this._passParameters,e);h.bindVAO(p),h.bindFramebuffer(this._blur0Fbo),h.setViewport(0,0,l,c),h.setClearColor(0,0,0,0),h.clear(Vr.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=i.colorTexture,It(this._blurDrawParameters.blurSize,1/l,0),f.bindDraw(this._blurDrawParameters,e,this._passParameters),h.drawArrays(this._blurTechnique.primitiveType,0,oa(p,"geometry")),h.bindFramebuffer(this._blur1Fbo),h.clear(Vr.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this._blur0Fbo.colorTexture,It(this._blurDrawParameters.blurSize,0,1/c),f.bindDraw(this._blurDrawParameters,e,this._passParameters),h.drawArrays(this._blurTechnique.primitiveType,0,oa(p,"geometry")),h.bindFramebuffer(r),h.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3]),this._passParameters.blurColorTexture=this._blur1Fbo.colorTexture,h.bindTechnique(this._applyTechnique,this._passParameters,e),h.drawArrays(this._applyTechnique.primitiveType,0,oa(p,"geometry")),h.bindVAO(null)}_gridUpdateResources(e,i){const r=this._rctx,s=this._grid;let n=!1;if(s.coverageMipmap===null&&(s.coverageMipmap=[e],n=!0),s.viewportWidth===e.width&&s.viewportHeight===e.height||(n=!0,s.viewportWidth=e.width,s.viewportHeight=e.height),s.coverageMipmap[0]=e,s.cellPixelSize!==i&&(s.cellPixelSize=i,n=!0),n){for(let l=1;l<s.coverageMipmap.length;l++)s.coverageMipmap[l].dispose();s.mipmapLevels=Math.ceil(Math.log(s.cellPixelSize)*Math.LOG2E),s.coverageMipmap.length=s.mipmapLevels+1;for(let l=0;l<s.mipmapLevels;l++){const c=s.coverageMipmap[l],h={target:Pt.TEXTURE_2D,pixelFormat:it.RGB,dataType:Ht.UNSIGNED_SHORT_5_6_5,samplingMode:gt.LINEAR,wrapMode:kt.CLAMP_TO_EDGE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)},p={colorTarget:gs.TEXTURE,depthStencilTarget:Di.NONE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)};s.coverageMipmap[l+1]=new Bs(r,p,h)}}const o=Math.ceil(e.height/s.cellPixelSize),a=Math.ceil(e.width/s.cellPixelSize);if(!s.vao||s.verticalCellCount!==o||s.horizontalCellCount!==a){s.verticalCellCount=o,s.horizontalCellCount=a;const l=o+1,c=a+1,h=1/o,p=1/a,f=6,m=4,y=new Float32Array(f*m*l*c);let _=0;for(let b=0;b<l;b++)for(let w=0;w<c;w++)y[_+0]=(w-.5)*p*2-1,y[_+1]=(b-.5)*h*2-1,y[_+2]=w*p,y[_+3]=b*h,y[_+4]=(w+.5)*p*2-1,y[_+5]=(b-.5)*h*2-1,y[_+6]=w*p,y[_+7]=b*h,y[_+8]=(w-.5)*p*2-1,y[_+9]=(b+.5)*h*2-1,y[_+10]=w*p,y[_+11]=b*h,y[_+12]=(w-.5)*p*2-1,y[_+13]=(b+.5)*h*2-1,y[_+14]=w*p,y[_+15]=b*h,y[_+16]=(w+.5)*p*2-1,y[_+17]=(b-.5)*h*2-1,y[_+18]=w*p,y[_+19]=b*h,y[_+20]=(w+.5)*p*2-1,y[_+21]=(b+.5)*h*2-1,y[_+22]=w*p,y[_+23]=b*h,_+=f*m;s.vao&&s.vao.dispose(!0),s.vao=new af(r,Li,{geometry:gA},{geometry:Yi.createVertex(r,Fi.STATIC_DRAW,y)})}}_gridComputeMipmap(e){const i=this._rctx,r=this._grid,s=i.bindTechnique(this._downsampleTechnique,this._passParameters,e);i.bindVAO(this._quadVAO);for(let n=0;n<r.mipmapLevels;n++){i.bindFramebuffer(r.coverageMipmap[n+1]);const o=r.coverageMipmap[n+1].width,a=r.coverageMipmap[n+1].height;this._downsampleDrawParameters.inputTexture=r.coverageMipmap[n].colorTexture,It(this._downsampleDrawParameters.invFramebufferDim,1/o,1/a),s.bindDraw(this._downsampleDrawParameters,e,this._passParameters),i.setViewport(0,0,o,a),i.drawArrays(jt.TRIANGLE_STRIP,0,oa(this._quadVAO,"geometry"))}}get gpuMemoryUsage(){let e=(v(this._blur0Fbo)?this._blur0Fbo.gpuMemoryUsage:0)+(v(this._blur1Fbo)?this._blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const i of this._grid.coverageMipmap)e+=i.gpuMemoryUsage;return e}get test(){return{coverage:this._grid.coverageMipmap,blur:[this._blur0Fbo,this._blur1Fbo]}}};const uSt={dataType:Ht.UNSIGNED_BYTE,internalFormat:it.RGBA},hSt={};let dSt=class{constructor(e){this._rctx=e,this._activeTargets=new Set,this._depthTextures=new Map,this._depthBuffers=new Map,this._colorTextures=new Map,this._framebuffers=new Map,this.depthTextureSupported=e.capabilities.depthTexture}dispose(){this._depthBuffers.forEach(e=>e.dispose()),this._depthBuffers.clear(),this._depthTextures.forEach(e=>e.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(e=>e.dispose()),this._colorTextures.clear(),this._framebuffers.forEach(e=>e.dispose()),this._framebuffers.clear(),this._activeTargets.clear()}disposeTargetResource(e){const i=e.id;this._activeTargets.has(i)&&(this._activeTargets.delete(i),this._disposeWithFramebuffers(this._depthTextures,i),this._disposeWithFramebuffers(this._depthBuffers,i),this._disposeWithFramebuffers(this._colorTextures,i))}_disposeWithFramebuffers(e,i){const r=e.get(i);r&&(this._framebuffers.forEach((s,n)=>{s.colorAttachment!==r&&s.depthStencilAttachment!==r||(s.detachAll(),s.dispose(),this._framebuffers.delete(n))}),r.dispose(),e.delete(i))}getDepthTexture(e,i){if(!this.depthTextureSupported)return null;let r=this._depthTextures.get(e.id);return!r||r.descriptor.width===i.width&&r.descriptor.height===i.height||(r.dispose(),r=yx()),r||(r=new xt(this._rctx,{target:Pt.TEXTURE_2D,pixelFormat:it.DEPTH_STENCIL,dataType:Ht.UNSIGNED_INT_24_8,samplingMode:gt.NEAREST,wrapMode:kt.CLAMP_TO_EDGE,width:i.width,height:i.height}),this._depthTextures.set(e.id,r),this._activeTargets.add(e.id)),r}getAllocatedDepthTexture(e){return this._depthTextures.get(e.id)}getDepthBuffer(e,i){if(this.depthTextureSupported)return null;let r=this._depthBuffers.get(e.id);return r?r.descriptor.width===i.width&&r.descriptor.height===i.height||r.resize(i.width,i.height):(r=new wS(this._rctx,{internalFormat:sl.DEPTH_STENCIL,...i}),this._depthBuffers.set(e.id,r),this._activeTargets.add(e.id)),r}getColorTexture(e,i){let r=this._colorTextures.get(e.id);return r&&(r.descriptor.width===i.width&&r.descriptor.height===i.height||(r.dispose(),r=yx())),r||(r=new xt(this._rctx,{target:Pt.TEXTURE_2D,pixelFormat:it.RGBA,internalFormat:e.internalFormat,dataType:e.dataType,samplingMode:e.samplingMode!=null?e.samplingMode:gt.LINEAR,wrapMode:kt.CLAMP_TO_EDGE,width:i.width,height:i.height}),this._colorTextures.set(e.id,r),this._activeTargets.add(e.id)),r}getAllocatedColorTexture(e){return this._colorTextures.get(e.id)}registerDepthTarget(e={}){return{id:Zc(),...hSt,...e}}registerColorTarget(e={}){return{id:Zc(),...uSt,...e}}getFramebuffer(e,i,r){const s=this._getKey(i,r);let n=this._framebuffers.get(s);const o=this.getColorTexture(i,e);if(this.depthTextureSupported){const l=r?this.getDepthTexture(r,e):void 0;return n?((n.width!==e.width||n.height!==e.height||n.colorTexture!==o||n.depthStencilTexture!==l)&&(n.detachAll(),n.resize(e.width,e.height),n.attachColorTexture(o),n.attachDepthStencilTexture(l)),n):(n=v(r)?new Bs(this._rctx,{colorTarget:gs.TEXTURE,depthStencilTarget:Di.DEPTH_STENCIL_TEXTURE},o,l):new Bs(this._rctx,{colorTarget:gs.TEXTURE,depthStencilTarget:Di.NONE},o),this._framebuffers.set(s,n),n)}const a=r?this.getDepthBuffer(r,e):void 0;return n?((n.width!==e.width||n.height!==e.height||n.colorTexture!==o)&&(n.detachAll(),n.resize(e.width,e.height),n.attachColorTexture(o),n.attachDepthStencilBuffer(a)),n):(n=new Bs(this._rctx,{colorTarget:gs.TEXTURE,depthStencilTarget:r?Di.DEPTH_STENCIL_RENDER_BUFFER:Di.NONE},o,a),this._framebuffers.set(s,n),n)}_getKey(e,i){return`${e.id}_${i?i.id:"X"}_${e.name}${i?"_"+i.name:""}`}get gpuMemoryUsage(){let e=0;const i=new Set,r=s=>{i.has(s)||(i.add(s),e+=Gx(s))};return this._depthTextures.forEach(r),this._colorTextures.forEach(r),this._depthBuffers.forEach(r),e}},pSt=class{constructor(e,i){this._rctx=e,this._compositingHelper=i,this._mainColorTarget=0,this._dimensions={width:4,height:4},this._background={type:"color",color:[0,0,0,1]};const r=e.type===Mt.WEBGL2;this._renderTargetHelper=new dSt(e);const s=this._renderTargetHelper;this._mainColorTargets=[s.registerColorTarget({name:"mainColorTarget0"}),s.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=s.registerColorTarget({name:"frontFaceTarget"});const n=o=>s.registerColorTarget({name:o,dataType:Ht.FLOAT,internalFormat:r?Lt.RGBA32F:it.RGBA,samplingMode:gt.NEAREST});this.colorFloatTarget=n("colorFloatTarget"),this.alphaFloatTarget=n("alphaFloatTarget"),this.mainDepth=s.registerDepthTarget({name:"mainDepth"}),this.linearDepth=s.registerColorTarget({name:"linearDepth",samplingMode:gt.NEAREST}),this.terrainLinearDepth=s.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=s.registerColorTarget({name:"geometryLinearDepth"}),this.normal=s.registerColorTarget({name:"normal"}),this.highlight=s.registerColorTarget({name:"highlight",internalFormat:r?Lt.RGBA4:it.RGBA,dataType:Ht.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=s.registerColorTarget({name:"hudVisibility",internalFormat:r?Lt.RGBA4:it.RGBA,dataType:Ht.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=s.registerColorTarget({name:"tmpColor"}),this.tmpDepth=s.registerDepthTarget({name:"tmpDepth"}),this.hudColor=s.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}get width(){return this._dimensions.width}get height(){return this._dimensions.height}set background(e){this._background=e}get background(){return this._background}get currentColorTarget(){return this._mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this._mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(e,i){return this._renderTargetHelper.getFramebuffer(this._dimensions,e,i)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}setupRenderTarget(e){e||(this._mainColorTarget=0,this.disposeTarget(this._mainColorTargets[1])),this._mainColorTarget=this._mainColorTarget===0&&e?1:0}initializeFrame(e){const i=this._rctx;this._dimensions.width=e.fullWidth,this._dimensions.height=e.fullHeight,this.bindTarget(this.currentColorTarget,this.mainDepth),i.setClearStencil(0);const r=this._background.color;i.setClearColor(r[0]*r[3],r[1]*r[3],r[2]*r[3],r[3]),i.clearSafe(Vr.COLOR_BUFFER_BIT|Vr.DEPTH_BUFFER_BIT|Vr.STENCIL_BUFFER_BIT)}composite(e){v(this.colorTexture)&&this._compositingHelper.composite(e,this.colorTexture,Oa.None)}renderTmpAndCompositeToMain(e,i,r,s=!1){this.renderToTargets(e,this.tmpColor,s?this.tmpDepth:this.mainDepth,fSt),this._compositingHelper.composite(i,this._getColorTexture(this.tmpColor),r)}renderHUDVisibility(e,i=!1){this.renderToTargets(e,this.hudVisibility,i?this.tmpDepth:this.mainDepth,mSt)}compositeTransparentTerrainOntoHUDVisibility(e){this.renderToTargets(()=>this._compositingHelper.compositeHUD(e,this._getColorTexture(this.tmpColor)),this.hudVisibility,this.tmpDepth)}renderOITPass(e,i,r){let s,n;switch(i){case $t.Color:s=this.colorFloatTarget,n=[0,0,0,0];break;case $t.Alpha:s=this.alphaFloatTarget,n=[1,1,1,1];break;case $t.FrontFace:s=this.frontFaceTarget,n=[0,0,0,0]}r?this.renderToTargets(e,s,this.tmpDepth,n,!0,!0):this.renderToTargets(e,s,this.mainDepth,n,!1)}compositeTransparentTerrainOntoMain(e){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),Oa.PremultipliedAlpha)}compositeOccludedOntoMain(e,i){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),Oa.PremultipliedAlpha,i)}compositeTransparentOntoOpaque(e,i){i?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(Vr.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeOIT(e,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(e){this.bindTarget(this.currentColorTarget),e(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(e){this._renderTargetHelper.disposeTargetResource(e)}renderToFBO(e,i,r=!1,s=!1){const n=this._rctx;let o=0;if(i){const l=Math.max(1e-13,i[3]);n.setClearColor(i[0],i[1],i[2],l),o|=Vr.COLOR_BUFFER_BIT}r&&(o|=Vr.DEPTH_BUFFER_BIT),s===!1?s=0:(s===!0&&(s=255),o|=Vr.STENCIL_BUFFER_BIT),o&&n.clearSafe(o,s),e(),n.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth)}renderToTargets(e,i,r,s,n=!1,o=!1){const a=this.bindTarget(i,r);return this.renderToFBO(e,s,n,o),a}bindTarget(e,i){const r=this._renderTargetHelper.getFramebuffer(this._dimensions,e,i);return this._rctx.bindFramebuffer(r),r}_getColorTexture(e){return this._renderTargetHelper.getColorTexture(e,this._dimensions)}get gpuMemoryUsage(){let e=0;return this._renderTargetHelper&&(e+=this._renderTargetHelper.gpuMemoryUsage),e}};const fSt=[0,0,0,0],mSt=[0,1,0,1];let gSt=class{constructor(e){this._context=e,this._renderPlugins=new li,this._slots=[];for(let i=0;i<Fe.MAX_SLOTS;++i)this._slots[i]=[]}add(e,i,r){const s=()=>{if(r!=null&&r.aborted)throw i.uninitializeRenderContext(),Bi();this._renderPlugins.push(i);for(const o of e)this._slots[o].push(i);this._context.requestRender()},n=i.initializeRenderContext(this._context,r);if(su(n))return n.then(s);s()}remove(e){if(this._renderPlugins.removeUnordered(e)!=null){for(let i=0;i<this._slots.length;++i)this._slots[i]=this._slots[i].filter(r=>r!==e);e.uninitializeRenderContext(),this._context.requestRender()}}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)})}updateAnimation(e){let i=!1;return this._renderPlugins.forAll(r=>{r.updateAnimation&&(i=r.updateAnimation(e)||i)}),i}render(){const e=this._slots[this._context.renderContext.bindParameters.slot],i=new Array;e.filter(r=>{if(!r.canRender)return!1;if(ySt(r)){const s=r.prepareTechnique(this._context.renderContext);return!!s&&(i.push(s),!0)}return i.push(null),!0}).forEach((r,s)=>r.render(this._context.renderContext,i[s]))}queryDepthRange(e){const i=_St;return i.near=1/0,i.far=-1/0,this._renderPlugins.forAll(r=>{if(r.queryDepthRange){const s=r.queryDepthRange(e);s&&GC(i,s,i)}}),i}get needsTransparentPass(){return this._renderPlugins.some(e=>!!e.needsTransparentPass)}get needsHighlight(){return this._renderPlugins.some(e=>!!e.needsHighlight)}get needsLinearDepth(){return this._renderPlugins.some(e=>!!e.needsLinearDepth)}get needsLaserlineWithContrastControl(){const e=this._slots[Fe.LASERLINES_CONTRAST_CONTROL];return!!e&&e.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce((e,i)=>e|i.renderOccludedFlags,0)}};function ySt(t){return"prepareTechnique"in t}const _St={near:0,far:0};let hPe=class extends OOe{};const iV=255,vSt=1/iV;function bSt(t){const e=new Ui,i=e.fragment;return i.include(ou),i.include(rh),e.include(V8),e.include(Ad),e.include(U8,t),i.uniforms.add([new zt("depthMap",r=>r.linearDepthTexture),new Jr("inverseViewMatrix",(r,s)=>Go(Hde,hc(Hde,s.camera.viewMatrix,s.camera.center))),new zi("nearFar",(r,s)=>s.camera.nearFar)]),i.constants.add("sampleValue","float",vSt),i.code.add(x`void main(void) {
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
gl_FragColor = vec4(sampleValue);
}`),e}const Hde=We(),wSt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:hPe,ShadowCastMaxSamples:iV,build:bSt},Symbol.toStringTag,{value:"Module"}));var iT;(function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"})(iT||(iT={}));let HX=class extends Va{constructor(){super(...arguments),this.visualization=iT.Gradient,this.bandsEnabled=!1}};u([z({count:iT.COUNT})],HX.prototype,"visualization",void 0),u([z()],HX.prototype,"bandsEnabled",void 0);let dPe=class extends yr{constructor(e){super(),this.shadowCastMap=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=sI(xSt),this.bandSize=.1,this.threshold=.5}};const xSt=si(.01,0,.25,1);function TSt(t){const e=new Ui,i=e.fragment;i.include(ou),i.include(rh),e.include(V8),e.include(Ad);const{visualization:r,bandsEnabled:s}=t;i.constants.add("inverseSampleValue","float",iV),i.uniforms.add([new zt("shadowCastMap",a=>a.shadowCastMap),new He("sampleScale",a=>a.sampleScale),new He("opacityFromElevation",a=>a.opacityFromElevation),new Si("uColor",a=>a.color)]);const n=r===iT.Gradient,o=r===iT.Threshold;return n&&s?i.uniforms.add(new He("bandSize",a=>a.bandSize)):o&&i.uniforms.add(new He("threshold",a=>a.threshold)),i.code.add(x`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${o?x`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${n&&s?x`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?x`* strength`:""});
      }
    `),e}const SSt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:dPe,build:TSt},Symbol.toStringTag,{value:"Module"}));let pPe=class fPe extends ji{constructor(e,i){super(e,i,()=>this.destroy())}initializeProgram(e){return new ki(e.rctx,fPe.shader.get().build(this.configuration),Li)}initializePipeline(){return Qt({blending:Qu,colorWrite:ui,depthTest:null,depthWrite:null})}get primitiveType(){return jt.TRIANGLE_STRIP}};pPe.shader=new Vi(SSt,()=>ee(()=>import("./ShadowCastVisualize.glsl-9b6aea96.js"),[],import.meta.url));const ESt=4e4,CSt=5e4,mPe=1/512;let jF=class extends $e{constructor(e,i,r,s){super({}),this._techniqueRepository=e,this._rctx=i,this._data=r,this._requestRender=s,this._passParameters=new dPe(this._data.shadowCastTexture),this._techniqueConfig=new HX,this._enabled=!1,this._vao=ka(i),this._techniqueConfig.visualization=iT.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=ft(this._vao),this._techniqueRepository.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(pPe,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const i=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(i,this._passParameters,e),this._rctx.drawArrays(i.primitiveType,0,oa(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>mPe}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const i=this._passParameters.color;mE(e,i)||(Op(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};u([d()],jF.prototype,"opacityFromElevation",null),jF=u([I("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],jF);let v6=class extends Va{constructor(){super(...arguments),this.receiveShadows=!0,this.hasWebGL2Context=!1}};u([z()],v6.prototype,"receiveShadows",void 0),u([z()],v6.prototype,"hasWebGL2Context",void 0);let gPe=class yPe extends ji{constructor(e){super(e,new v6,()=>this.destroy())}initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Mt.WEBGL2}initializeProgram(e){return new ki(e.rctx,yPe.shader.get().build(this.configuration),Li)}initializePipeline(){return Qt({blending:Yn(Ve.ONE,Ve.ONE,Ve.ONE,Ve.ONE),colorWrite:ui,depthTest:null,depthWrite:null})}get primitiveType(){return jt.TRIANGLE_STRIP}};gPe.shader=new Vi(wSt,()=>ee(()=>import("./ShadowCastAccumulate.glsl-17e78988.js"),[],import.meta.url));let Hl=class extends $e{constructor(e,i,r,s,n,o){super({}),this._rctx=e,this._stage=r,this._prepareForShadowMapPass=s,this._renderToShadowMap=n,this._requestRender=o,this._progress=0,this._sampleCount=0,this._passParameters=new hPe,this._enabledInternal=!1,this._cachedLightDirections=[],this._depthRange=FX,this._previewing=!1,this._handles=new Ki,this._cameraForcedForScreenshot=!1,this._bindParameters=new s8(new See(e,r.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._vao=ka(e);const a={colorTarget:gs.TEXTURE,depthStencilTarget:Di.NONE,width:0,height:0},l={target:Pt.TEXTURE_2D,pixelFormat:it.RGBA,dataType:Ht.UNSIGNED_BYTE,samplingMode:gt.LINEAR,wrapMode:kt.CLAMP_TO_EDGE,width:0,height:0};this._fbo=new Bs(e,a,l),this._accumulationRenderer=new jF(i,e,this,o);const c=this._stage.view.resourceController.scheduler;this._handles.add([c.registerTask(Rt.SHADOW_ACCUMULATOR,this),re(()=>r.renderView,h=>{this._handles.remove(qde),v(h)&&this._handles.add(h.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),qde)},Br),re(()=>this._previewing,()=>this._requestRenderIfEnabled(),Wi)])}normalizeCtorArgs(){return{}}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(C(this._accumulationTechniqueCached)){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new gPe(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._enabledInternal&&this._sampleCount>0}get canAccumulate(){return this._passParameters.linearDepthTexture!==null&&this._depthRange!==FX&&this._opacityFromElevation>mPe}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const i=this._cachedLightDirections;if(Uy(i,e,Wv))return;const r=Math.min(iV,e.length);i.length=r,this._sampleCount=r;for(let s=0;s<r;++s)i[s]=he(i[s]??M(),e[s]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,i,r,s){if(this._depthRange=i,this._updateCamera(r),this._bindParameters.contentCamera=s,this._passParameters.linearDepthTexture=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const n=this._cameraForcedForScreenshot?this._sampleCount:Math.min(ASt,this._sampleCount-this._progress);for(let o=0;o<n;++o)this._accumulateShadow();this._cameraForcedForScreenshot=!1,this._requestRender()}render(e){this._accumulationRenderer.render(e)}dispose(){this._stop(),this._handles.destroy(),this._accumulationRenderer=ft(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=ft(this._fbo),this._vao=ft(this._vao),this._accumulationTechniqueCached=Wr(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}setOptions(e){e.enabled!==void 0&&(this._enabled=e.enabled),e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,i){return!this._isActive||this._progress<1||e<0||e>this._fbo.width||i<0||i>this._fbo.height?0:(this._fbo.readPixels(e,i,1,1,it.RGBA,Ht.UNSIGNED_BYTE,Wde),Wde[0]/this._progress)}_start(){this._progress=0,this._enabledInternal=!0}_stop(){this._enabledInternal=!1}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(Vr.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._sampleLightDirection(),this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,oa(this._vao,"geometry"))}_sampleLightDirection(){return this._progress++,this._lightDirections[this._progress*OSt%this._lightDirections.length]}_updateCamera(e){e.equals(this._bindParameters.camera)||(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-ZE(ESt,CSt,e.relativeElevation))}set _enabled(e){e!==this._enabledInternal&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabledInternal&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};u([d()],Hl.prototype,"_progress",void 0),u([d()],Hl.prototype,"_sampleCount",void 0),u([d()],Hl.prototype,"_enabledInternal",void 0),u([d()],Hl.prototype,"_depthRange",void 0),u([d()],Hl.prototype,"_previewing",void 0),u([d()],Hl.prototype,"_accumulationRenderer",void 0),u([d()],Hl.prototype,"_isRefining",null),u([d()],Hl.prototype,"_isActive",null),u([d()],Hl.prototype,"canAccumulate",null),u([d()],Hl.prototype,"_isDoneAccumulating",null),u([d()],Hl.prototype,"_opacityFromElevation",null),u([d()],Hl.prototype,"running",null),Hl=u([I("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],Hl);const ASt=6,qde="renderView",OSt=104729,Wde=new Uint8Array(4),Xde={highlightedThreshold:.99999,selfShadowThreshold:.025};function RSt(t){const e=new Ui;e.include(Jx,t);const i=e.fragment;return i.include(ou),i.include(rh),e.include(V8),e.include(Ad),i.uniforms.add([new zt("defaultDepthTex",(r,s)=>s.shadowMap.getSnapshot(UC.Default)),new zt("highlightDepthTex",(r,s)=>s.shadowMap.getSnapshot(UC.Highlight)),new zt("depthMap",(r,s)=>s.linearDepthTexture),new zt("highlightMap",(r,s)=>s.highlightColorTexture),new Si("uColor",r=>r.shadowColor),new zi("nearFar",(r,s)=>s.camera.nearFar),new He("opacity",r=>r.shadowOpacity),new He("occludedOpacity",r=>r.occludedShadowOpacity),new He("terminationFactor",r=>r.opacityElevation*r.dayNightTerminator),new ni("lightingMainDirectionView",(r,s)=>Oe(Zde,ut(Zde,s.lighting.mainLight.direction,s.camera.viewInverseTransposeMatrix))),new zi("texelSize",(r,s)=>v(s.linearDepthTexture)?It(MSt,1/s.linearDepthTexture.descriptor.width,1/s.linearDepthTexture.descriptor.height):dc),new Jr("inverseViewMatrix",(r,s)=>Go(Yde,hc(Yde,s.camera.viewMatrix,s.camera.center)))]),i.constants.add("unoccludedHighlightFlag","vec4",eAe).add("highlightedThreshold","float",Xde.highlightedThreshold).add("selfShadowThreshold","float",Xde.selfShadowThreshold),i.code.add(x`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),i.code.add(x`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
gl_FragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),e}const Yde=We(),Zde=M(),MSt=et(),PSt=Object.freeze(Object.defineProperty({__proto__:null,build:RSt},Symbol.toStringTag,{value:"Module"}));let ISt=class extends yr{constructor(){super(...arguments),this.shadowColor=si(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},_Pe=class vPe extends ji{constructor(e){super(e,new v6,()=>this.destroy())}initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Mt.WEBGL2}initializeProgram(e){return new ki(e.rctx,vPe.shader.get().build(this.configuration),Li)}initializePipeline(){return Qt({blending:Yn(Ve.SRC_ALPHA,Ve.ONE,Ve.ONE_MINUS_SRC_ALPHA,Ve.ONE_MINUS_SRC_ALPHA),colorWrite:ui,depthTest:null,depthWrite:null})}get primitiveType(){return jt.TRIANGLE_STRIP}};_Pe.shader=new Vi(PSt,()=>ee(()=>import("./ShadowHighlight.glsl-b15e1ddf.js"),[],import.meta.url));const $St=.001953125,LSt=4e4,DSt=5e4;let NSt=class{constructor(e,i){this._rctx=e,this._viewingMode=i,this._maxOpacity=1,this._passParameters=new ISt,this._drawParameters=new OOe,this._vao=ka(this._rctx)}get _technique(){return C(this._techniqueCached)&&(this._techniqueCached=new _Pe({rctx:this._rctx,viewingMode:this._viewingMode})),this._techniqueCached}render(e,i){if(!e.shadowMap.enabled||!e.linearDepthTexture||!this.isVisible)return;const r=this._technique;this._drawParameters.origin=e.camera.center,this._rctx.bindFramebuffer(i),this._rctx.bindTechnique(r,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(r.primitiveType,0,oa(this._vao,"geometry"))}get gpuMemoryUsage(){var e;return((e=this._vao)==null?void 0:e.size)??0}setDefaultOptions(e){this._passParameters={...this._passParameters,...e},this._updateMaxOpacity()}updateParameters(e,i){this._passParameters.opacityElevation=1-ZE(LSt,DSt,e.relativeElevation);const r=this._viewingMode===st.Global?Oe(Jde,e.center):fe(Jde,0,0,1),s=Ae(r,i);this._passParameters.dayNightTerminator=ZE(0,1,we(30*s,0,1))}dispose(){this._vao=ft(this._vao),this._techniqueCached=Wr(this._techniqueCached)}get isVisible(){const{opacityElevation:e,dayNightTerminator:i}=this._passParameters;return this._maxOpacity*e*i>=$St}_updateMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]}};const Jde=M(),Kde=o0();let FSt=class{constructor(){this._plane=o0()}get isEnabled(){return!Mve(this.plane,Kde)}get plane(){return this._plane}set plane(e){dT(e||Kde,this._plane)}},USt=class extends yr{};function FP(t){t.uniforms.add(new Si("resolution",e=>{const{descriptor:i}=e.colorTexture,r=i.width,s=i.height;return nr(VSt,1/r,1/s,r,s)}))}const VSt=fi(),A2={maxSearchSteps:8,maxDistanceAreaTex:16};function kSt(){const t=new Ui,{attributes:e,varyings:i,vertex:r,fragment:s}=t;return e.add(A.POSITION,"vec2"),i.add("uv","vec2"),i.add("offsets[2]","vec4"),i.add("maxOffset","vec4"),i.add("pixelCoord","vec2"),FP(r),r.code.add(x`
      void main() {
        uv = position * 0.5 + vec2(0.5);
        gl_Position = vec4(position, 0, 1);

        pixelCoord = uv * resolution.zw;
        offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${x.int(A2.maxSearchSteps)} );
      }
    `),s.uniforms.add(new zt("edgesTexture",n=>n.edges.colorTexture)),s.uniforms.add(new zt("areaTexture",n=>n.areaTexture)),s.uniforms.add(new zt("searchTexture",n=>n.searchTexture)),FP(s),s.code.add(x`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 sampleLevelZeroOffset(sampler2D texture, vec2 coord, vec2 offset) {
        return texture2D(texture, coord + offset.x * resolution.xy, 0.0);
      }

      vec2 round( vec2 x ) {
        return sign(x) * floor(abs(x) + 0.5);
      }

      float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float searchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${x.int(A2.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float searchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${x.int(A2.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float searchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${x.int(A2.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${x.int(A2.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${x.int(A2.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      void main() {
        ivec4 subsampleIndices = ivec4(0.0);
        vec4 weights = vec4(0.0);
        vec2 e = texture2D( edgesTexture, uv ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = searchXLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x );
          coords.y = offsets[1].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTexture, coords, 0.0 ).r;
          coords.x = searchXRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y );
          d.y = coords.x;
          d = d * resolution.z - pixelCoord.x;
          vec2 sqrt_d = sqrt( abs(d) );
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = searchYUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z );
          coords.x = offsets[0].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTexture, coords, 0.0 ).g;
          coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w );
          d.y = coords.y;
          d = d * resolution.w - pixelCoord.y;
          vec2 sqrt_d = sqrt(abs(d));
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0)).g;
          weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
        }
        gl_FragColor = weights;
      }
    `),t}const BSt=Object.freeze(Object.defineProperty({__proto__:null,build:kSt},Symbol.toStringTag,{value:"Module"}));let bPe=class wPe extends ji{initializeProgram(e){return new ki(e.rctx,wPe.shader.get().build(),Li)}initializePipeline(){return Qt({colorWrite:ui})}};bPe.shader=new Vi(BSt,()=>ee(()=>import("./BlendWeights.glsl-934a8c3b.js"),[],import.meta.url));function zSt(){const t=new Ui,{attributes:e,varyings:i,vertex:r,fragment:s}=t;return e.add(A.POSITION,"vec2"),i.add("uv","vec2"),i.add("offsets[2]","vec4"),FP(r),r.code.add(x`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}`),s.uniforms.add(new zt("blendWeightsTexture",n=>n.blend.colorTexture)),s.uniforms.add(new zt("colorTexture",n=>n.colorTexture)),FP(s),s.code.add(x`void main() {
vec4 a;
a.rb = texture2D(blendWeightsTexture, uv).rb;
a.g = texture2D(blendWeightsTexture, offsets[1].zw).g;
a.a = texture2D(blendWeightsTexture, offsets[1].xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
gl_FragColor = texture2D( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTexture, uv, 0.0 );
vec4 Cop = texture2D( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
gl_FragColor = mix(C, Cop, s);
}
}`),t}const GSt=Object.freeze(Object.defineProperty({__proto__:null,build:zSt},Symbol.toStringTag,{value:"Module"}));let xPe=class TPe extends ji{initializeProgram(e){return new ki(e.rctx,TPe.shader.get().build(),Li)}initializePipeline(){return Qt({colorWrite:ui})}};xPe.shader=new Vi(GSt,()=>ee(()=>import("./Blur.glsl-4ae2f763.js"),[],import.meta.url));const Qde={threshold:.05,localConstrastAdaption:2};function jSt(){const t=new Ui,{attributes:e,varyings:i,vertex:r,fragment:s}=t;return e.add(A.POSITION,"vec2"),FP(r),i.add("uv","vec2"),i.add("offsets[3]","vec4"),r.code.add(x`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
offsets[2] = uv.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}`),s.uniforms.add(new zt("colorTexture",n=>n.colorTexture)),s.code.add(x`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture2D(colorTexture, uv).rgb;

      vec3 Cleft = texture2D(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture2D(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${x.float(Qde.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture2D(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture2D(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture2D(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture2D(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges.xy *= step(maxDelta, float(${x.float(Qde.localConstrastAdaption)}) * delta.xy);

      gl_FragColor = vec4(edges, 0.0, 0.0);
    }
  `),t}const HSt=Object.freeze(Object.defineProperty({__proto__:null,build:jSt},Symbol.toStringTag,{value:"Module"}));let SPe=class EPe extends ji{initializeProgram(e){return new ki(e.rctx,EPe.shader.get().build(),Li)}initializePipeline(){return Qt({colorWrite:ui})}};SPe.shader=new Vi(HSt,()=>ee(()=>import("./EdgeDetect.glsl-165e3597.js"),[],import.meta.url));let fM=class extends $e{constructor(e,i){super({}),this._rctx=e,this._techniqueRep=i,this._passParameters=new USt,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=hd(this._abortController),this.disable()}_loadResources(e){if(v(this._abortController))return!1;if(v(this._passParameters.searchTexture))return!0;this._abortController=new AbortController;const i=this._abortController.signal;return ee(()=>import("./SmaaRenderPassData-660b7d34.js"),[],import.meta.url).then(r=>this._loadTextures(r,i)).then(()=>e()).finally(()=>this._abortController=null),!1}_loadTextures(e,i){return gi(i),Promise.all([this._loadTextureFromBase64(e.areaTexture,gt.LINEAR,it.RGB),this._loadTextureFromBase64(e.searchTexure,gt.NEAREST,it.LUMINANCE)]).then(([r,s])=>{qn(i)?(r.dispose(),s.dispose(),gi(i)):(this._passParameters.areaTexture=r,this._passParameters.searchTexture=s)})}get updating(){return v(this._abortController)}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const i=new Va;this._edgeDetectTechnique=this._techniqueRep.releaseAndAcquire(SPe,i,this._edgeDetectTechnique),this._blendWeightsTechnique=this._techniqueRep.releaseAndAcquire(bPe,i,this._blendWeightsTechnique),this._blurTechnique=this._techniqueRep.releaseAndAcquire(xPe,i,this._blurTechnique)}return!!this._loadResources(e)&&(this._vao=Xtt(this._rctx),this._passParameters.edges=new Bs(this._rctx,{colorTarget:gs.TEXTURE,depthStencilTarget:Di.NONE},{target:Pt.TEXTURE_2D,pixelFormat:it.RGB,dataType:Ht.UNSIGNED_BYTE,samplingMode:gt.LINEAR,wrapMode:kt.CLAMP_TO_EDGE,width:4,height:4}),this._passParameters.blend=new Bs(this._rctx,{colorTarget:gs.TEXTURE,depthStencilTarget:Di.NONE},{target:Pt.TEXTURE_2D,pixelFormat:it.RGBA,dataType:Ht.UNSIGNED_BYTE,samplingMode:gt.LINEAR,wrapMode:kt.CLAMP_TO_EDGE,width:4,height:4}),this._isEnabled=!0,!0)}disable(){this._isEnabled&&(this._vao=ft(this._vao),this._passParameters.areaTexture=ft(this._passParameters.areaTexture),this._passParameters.searchTexture=ft(this._passParameters.searchTexture),this._passParameters.blend=ft(this._passParameters.blend),this._passParameters.edges=ft(this._passParameters.edges),this._isEnabled=!1)}get _validPassParameters(){return this._isEnabled?this._passParameters:null}render(e){const i=this._validPassParameters;if(C(i))return;i.colorTexture=e;const r=this._rctx,s=r.getBoundFramebufferObject(),n=e.descriptor.width,o=e.descriptor.height;r.bindVAO(this._vao),r.setViewport(0,0,n,o),i.edges.resize(n,o),r.bindFramebuffer(i.edges),r.setClearColor(0,0,0,1),r.clear(Vr.COLOR_BUFFER_BIT),r.bindTechnique(this._edgeDetectTechnique,i,null),r.drawArrays(jt.TRIANGLES,0,3),i.blend.resize(n,o),r.bindFramebuffer(i.blend),r.setClearColor(0,0,1,1),r.clear(Vr.COLOR_BUFFER_BIT),r.bindTechnique(this._blendWeightsTechnique,i,null),r.drawArrays(jt.TRIANGLES,0,3),r.bindFramebuffer(s),r.setClearColor(0,1,0,1),r.clear(Vr.COLOR_BUFFER_BIT),r.bindTechnique(this._blurTechnique,i,null),r.drawArrays(jt.TRIANGLES,0,3)}_loadTextureFromBase64(e,i,r){return Ky(e).then(s=>new xt(this._rctx,{pixelFormat:r,dataType:Ht.UNSIGNED_BYTE,wrapMode:kt.CLAMP_TO_EDGE,width:s.width,height:s.height,samplingMode:i},s))}};u([d()],fM.prototype,"_abortController",void 0),u([d({readOnly:!0})],fM.prototype,"updating",null),fM=u([I("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],fM);function qSt(t,e){const i=-t[0],r=-t[1],s=-t[2],n=e[3],o=e[7],a=e[11],l=e[15];e[0]+=n*i,e[1]+=n*r,e[2]+=n*s,e[4]+=o*i,e[5]+=o*r,e[6]+=o*s,e[8]+=a*i,e[9]+=a*r,e[10]+=a*s,e[12]+=l*i,e[13]+=l*r,e[14]+=l*s}function WSt(t,e){const i=t[0],r=t[1],s=t[2];e[12]+=i*e[0]+r*e[4]+s*e[8],e[13]+=i*e[1]+r*e[5]+s*e[9],e[14]+=i*e[2]+r*e[6]+s*e[10],e[14]+=i*e[3]+r*e[7]+s*e[11]}let XSt=class{constructor(e){this._factory=e,this._originData=new Map}acquire(e){return this.register(this._factory.getOrigin(e))}register(e){const i=this._originData.get(e.id)||new YSt(e);return i.refCount++,this._originData.has(i.origin.id)||this._originData.set(i.origin.id,i),i}release(e){e.refCount--,e.refCount===0&&this._originData.delete(e.origin.id)}updateViewMatrices(e){this._originData.forEach(i=>{Xn(i.viewMatrix,e),WSt(i.origin.vec3,i.viewMatrix)})}},YSt=class{constructor(e){this.origin=e,this.refCount=0,this.viewMatrix=We()}},ZSt=class extends hSe{constructor(e,i){super(),this.distanceFalloffFactor=e,this.transparency=i,this.transformNormalViewFromGlobal=ls()}},JSt=class extends dSe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=ls(),this.slicePlaneLocalOrigin=M(),this.transformNormalGlobalFromModel=ls()}};function KSt(t){const e=x`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;t.code.add(e)}const QSt=Ni(.5,-4e-4);function eEt(t,e){const i=t.vertex;i.include(KSt),i.constants.add("depthBias","vec2",QSt),i.uniforms.add(new zi("inverseViewport",(r,s)=>s.inverseViewport)),e.legacy?(i.uniforms.add(new Jr("proj",(r,s)=>s.camera.projectionMatrix)),i.code.add(x`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(i.uniforms.add(new ng("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal)),i.uniforms.add(new Jr("transformProjFromView",r=>r.transformProjFromView)),i.code.add(x`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),i.code.add(x`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function tEt(t,e){const i=t.fragment;i.constants.add("coverageTestThreshold","float",.01),e.antialiasing?i.code.add(x`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):i.code.add(x`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function iEt(t,e){const i=t.vertex;e.silhouette?(i.code.add(x`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),e.legacy?i.code.add(x`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):i.code.add(x`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):i.code.add(x`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function rEt(t,e){const i=t.vertex;i.include(ou),i.uniforms.add(new He("distanceFalloffFactor",r=>r.distanceFalloffFactor)),i.code.add(x`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),i.uniforms.add(Uv("componentDataTex",r=>r.componentDataTexture,e.hasWebGL2Context?sr.None:sr.InvSize)),t.attributes.add(A.COMPONENTINDEX,"float"),i.constants.add("componentColorFieldOffset","float",0),i.constants.add("componentOtherFieldOffset","float",1),i.constants.add("componentVerticalOffsetFieldOffset","float",2),i.constants.add("componentFieldCount","float",3),i.constants.add("lineWidthFractionFactor","float",8),i.constants.add("extensionLengthOffset","float",128),i.constants.add("verticalOffsetScale","float",2*lte),i.code.add(x`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = componentFieldCount * componentIndex + fieldOffset;

      vec2 textureSizeInverse = ${ad(e,"componentDataTex",!0)};

      float colIndex = mod(fieldIndex, 1.0 / textureSizeInverse.x);
      float rowIndex = floor(fieldIndex * textureSizeInverse.x);

      return vec2(colIndex, rowIndex) + 0.5;
    }

    struct ComponentData {
      vec4 color;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
      vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
      vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);

      vec4 colorValue = ${hl(e,"componentDataTex","colorIndex")};
      vec4 otherValue = ${hl(e,"componentDataTex","otherIndex")};
      float verticalOffset = (rgba2float(${hl(e,"componentDataTex","verticalOffsetIndex")}) - 0.5) * verticalOffsetScale;

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        otherValue.x * (255.0 / lineWidthFractionFactor),
        otherValue.y * 255.0 - extensionLengthOffset,
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `),e.legacy?i.code.add(x`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(i.uniforms.add(new lP("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel)),i.code.add(x`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),e.silhouette?(t.attributes.add(A.NORMALA,"vec3"),t.attributes.add(A.NORMALB,"vec3"),i.code.add(x`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(t.attributes.add(A.NORMAL,"vec3"),i.code.add(x`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),e.legacy?i.code.add(x`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(i.include(T5,e),i.include(T5,e),i.uniforms.add([new ng("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new lP("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new Ku("transformWorldFromModelTL",r=>r.transformWorldFromModelTL),new Ku("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new ni("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new ni("transformWorldFromViewTH",r=>r.transformWorldFromViewTH)]),i.code.add(x`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${e.spherical?x`normalize(transformWorldFromModelTL + rotatedModelPosition);`:x`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),i.uniforms.add(new Jr("transformProjFromView",(r,s)=>s.camera.projectionMatrix)),i.code.add(x`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),i.code.add(x`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function sEt(t){return t.mode===Pn.SKETCH||t.mode===Pn.MIXED}var Pn,Vw;(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH",t[t.MIXED=2]="MIXED",t[t.COUNT=3]="COUNT"})(Pn||(Pn={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.SILHOUETTE=1]="SILHOUETTE"}(Vw||(Vw={}));function dte(t,e){const i=t.vertex;switch(t.attributes.add(A.SIDENESS,"vec2"),e.mode===Pn.MIXED?i.code.add(x`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):i.code.add(x`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),e.mode){case Pn.MIXED:i.code.add(x`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case Pn.SKETCH:i.code.add(x`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Pn.SOLID:i.code.add(x`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Pn.COUNT:break;default:e.mode}}function nEt(t,e){const i=t.vertex;switch(t.include(dte,e),e.mode){case Pn.SOLID:i.code.add(x`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case Pn.SKETCH:i.uniforms.add(new px("strokesAmplitude",r=>r.strokesTexture.amplitude)),i.code.add(x`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case Pn.MIXED:i.uniforms.add(new px("strokesAmplitude",r=>r.strokesTexture.amplitude)),i.code.add(x`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function oEt(t,e){t.include(dte,e);const{vertex:i,fragment:r}=t;switch(sEt(e)&&(i.uniforms.add(Uv("strokesTexture",s=>s.strokesTexture.texture,e.hasWebGL2Context?sr.None:sr.InvSize)),i.uniforms.add([new px("strokesLog2Resolution",s=>Math.log2(s.strokesTexture.resolution)),new px("strokeVariants",s=>s.strokesTexture.variants)]),t.varyings.add("vStrokeUV","vec2"),r.uniforms.add([new wI("strokesTexture",s=>s.strokesTexture.texture),new px("strokesNormalizationScale",s=>s.strokesTexture.normalizationScale)]),i.code.add(x`
      void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
        vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

        float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);

        vec2 textureSizeInverse = ${ad(e,"strokesTexture",!0)};
        vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) * textureSizeInverse;
        vStrokeUV.x += variantOffset;
      }
    `),t.fragment.include(ou),r.code.add(x`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),e.mode){case Pn.SOLID:i.code.add(x`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),r.code.add(x`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case Pn.SKETCH:i.code.add(x`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),r.code.add(x`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case Pn.MIXED:t.varyings.add("vType","float"),i.code.add(x`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),r.code.add(x`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function aEt(t){const e=new Ui,{vertex:i,fragment:r}=e;return t.legacy&&i.uniforms.add([new epe("model"),new epe("localView")]),e.include(eEt,t),e.include(rEt,t),e.include(nEt,t),e.include(dte,t),e.include(oEt,t),e.include(en,t),e.include(iEt,t),e.include(tEt,t),e.include(sh,t),e.varyings.add("vColor","vec4"),e.varyings.add("vRadius","float"),e.varyings.add("vPosition","vec3"),e.varyings.add("vWorldPosition","vec3"),e.varyings.add("vViewPos","vec3"),e.varyings.add("vLineLengthPixels","float"),e.varyings.add("vSizeFalloffFactor","float"),i.uniforms.add([new zi("pixelToNDC",(s,n)=>It(lEt,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new Si("viewport",(s,n)=>n.camera.fullViewport),new He("pixelRatio",(s,n)=>n.camera.pixelRatio)]),e.attributes.add(A.POSITION0,"vec3"),e.attributes.add(A.POSITION1,"vec3"),e.attributes.add(A.VARIANTOFFSET,"float"),e.attributes.add(A.VARIANTSTROKE,"float"),e.attributes.add(A.VARIANTEXTENSION,"float"),i.code.add(x`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      vViewPos = viewPos;

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      ${t.antialiasing?x`
        const float aaPaddingPixels = 1.0;

        // Line size with padding
        float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
        float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;`:x`
        float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
        float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;`}

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${t.mode===Pn.SKETCH?x`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:t.mode===Pn.MIXED?x`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `),r.code.add(x`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      gl_FragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `),e}const lEt=et();let epe=class extends Os{constructor(e){super(e,"mat4")}};const cEt=Object.freeze(Object.defineProperty({__proto__:null,build:aEt},Symbol.toStringTag,{value:"Module"}));let CPe=class APe extends ji{initializeConfiguration(e,i){i.hasWebGL2Context=e.rctx.type===Mt.WEBGL2}initializeProgram(e){return new ki(e.rctx,APe.shader.get().build(this.configuration),k3e)}initializePipeline(e){return e.blendMinMax?Qt({blending:Yn(Ve.ONE,Ve.ONE,Ve.ZERO,Ve.ONE,qm.ADD,e.blendMinMax.MAX),depthTest:{func:Dr.LEQUAL},colorWrite:ui}):Qt({depthTest:{func:Dr.LEQUAL},depthWrite:pc,colorWrite:ui})}};CPe.shader=new Vi(cEt,()=>ee(()=>import("./EdgeShader.glsl-90be84f3.js"),[],import.meta.url));let Qf=class extends uo{constructor(){super(...arguments),this.mode=Pn.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1}};u([z({count:Pn.COUNT})],Qf.prototype,"mode",void 0),u([z()],Qf.prototype,"hasSlicePlane",void 0),u([z()],Qf.prototype,"silhouette",void 0),u([z()],Qf.prototype,"legacy",void 0),u([z()],Qf.prototype,"antialiasing",void 0),u([z()],Qf.prototype,"doublePrecisionRequiresObfuscation",void 0),u([z()],Qf.prototype,"hasMultipassTerrain",void 0),u([z()],Qf.prototype,"cullAboveGround",void 0),u([z()],Qf.prototype,"spherical",void 0);const uEt=8,dz=128,hEt={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},dEt={solid:Pn.SOLID,sketch:Pn.SKETCH,uber:Pn.MIXED};let pz=class OPe{constructor(e,i,r){this._rctx=e,this._shaderTechniqueRepository=i,this._configuration=new Qf,this.refCount=0,this._renderables=new Set,this._sortedRenderables={[pi.TRANSPARENT]:{[pi.TRANSPARENT]:new li,[pi.OPAQUE]:new li},[pi.OPAQUE]:{[pi.TRANSPARENT]:new li,[pi.OPAQUE]:new li}},this._renderablesDirty=!1,this._drawParameters=new JSt,this._settings={...hEt,...r},this.key=OPe.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const s=this._settings.strokesTexture.variants;this.writerSettings={variants:s,reducedPrecision:Ji.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=dEt[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=e.driverTest.doublePrecisionRequiresObfuscation.result,this._configuration.spherical=r.spherical}dispose(){this._technique=Wr(this._technique)}addRenderable(e){this._renderables.add(e),this._renderablesDirty=!0}removeRenderable(e){this._renderables.delete(e),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(e,i){this._renderablesDirty&&this._sortRenderables(),this._sortedRenderables[i][pi.TRANSPARENT].forAll(e),this._sortedRenderables[i][pi.OPAQUE].forAll(e)}updateTechnique(e,i){return this._configuration.hasMultipassTerrain=!!e.multipassTerrain.enabled,this._configuration.cullAboveGround=!!e.multipassTerrain.cullAboveGround,this._configuration.silhouette=i,this._technique=this._shaderTechniqueRepository.releaseAndAcquire(CPe,this._configuration,this._technique),this._technique}bindRegularEdges(e,i){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(i,!1),e,i)}bindSilhouetteEdges(e,i){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(i,!0),e,i)}renderRegularEdges(e,i,r,s,n){this._render(e,i,i.regular.vao,r,s,n)}renderSilhouetteEdges(e,i,r,s,n){this._render(e,i,i.silhouette.vao,r,s,n)}_render(e,i,r,s,n,o){o>0&&(this._bindDraw(e,i,s,n),this._rctx.bindVAO(r),this._rctx.capabilities.instancing.drawArraysInstanced(jt.TRIANGLE_FAN,0,4,o))}_bindDraw(e,i,r,s){if(this._drawParameters.componentDataTexture=i.components.buffer.textureBuffer.texture,this._drawParameters.strokesTexture=this._settings.strokesTexture,"origin"in i.transform)this._lastOriginId!==i.transform.origin.origin.id&&(e.setUniformMatrix4fv("localView",i.transform.origin.viewMatrix),this._lastOriginId=i.transform.origin.origin.id),e.setUniformMatrix4fv("model",i.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=i.transform.origin.origin.vec3;else{const n=new tV(i.transform.position),o=wd(tpe,mT(tpe,i.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=n.low,this._drawParameters.transformWorldFromModelTH=n.high,this._drawParameters.transformWorldFromModelRS=i.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=s.camera.viewInverseTransposeMatrix;fe(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}e.bindDraw(this._drawParameters,s,r)}_sortRenderables(){this._renderablesDirty=!1,this._sortedRenderables[pi.TRANSPARENT][pi.TRANSPARENT].clear(),this._sortedRenderables[pi.TRANSPARENT][pi.OPAQUE].clear(),this._sortedRenderables[pi.OPAQUE][pi.TRANSPARENT].clear(),this._sortedRenderables[pi.OPAQUE][pi.OPAQUE].clear(),this._renderables.forEach(i=>{i.objectTransparency!==pi.INVISIBLE&&i.edgeTransparency!==pi.INVISIBLE&&this._sortedRenderables[i.objectTransparency][i.edgeTransparency].push(i)});const e=(i,r)=>"origin"in i.transform?"origin"in r.transform?i.transform.origin.origin.id<r.transform.origin.origin.id?-1:i.transform.origin.origin.id>r.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[pi.TRANSPARENT][pi.TRANSPARENT].sort(e),this._sortedRenderables[pi.TRANSPARENT][pi.OPAQUE].sort(e),this._sortedRenderables[pi.OPAQUE][pi.TRANSPARENT].sort(e),this._sortedRenderables[pi.OPAQUE][pi.OPAQUE].sort(e)}static getKey(e,i,r){return`edges-t:${e}:${i}:${r}`}};const tpe=ac();function mBt(t,e){return e.push(t.buffer),{buffer:t.buffer,layout:pEt(t.layout)}}function FD(t){return fEt(t.layout).createView(t.buffer)}function pEt(t){const e=new Array;return t.fields.forEach((i,r)=>{const s={...i,constructor:RPe(i.constructor)};e.push([r,s])}),{stride:t.stride,fields:e,fieldNames:t.fieldNames}}function fEt(t){const e=cs();return e.stride=t.stride,e.fieldNames=t.fieldNames,t.fields.forEach(i=>e.fields.set(i[0],{...i[1],constructor:gEt(i[1].constructor)})),e}const mEt=[cQ,m0,Lr,iu,n1,hQ,dQ,pQ,Da,o8,uQ,uP,MC,a8,hP,Na,l8,fQ,c8,SI,u8,mQ,ySe,_Se,gQ,h8,vSe,bSe,wSe,d8,xSe,TSe,SSe,ESe,CSe,ASe];function RPe(t){return`${t.ElementType}_${t.ElementCount}`}function gEt(t){return MPe.get(t)}const MPe=new Map;mEt.forEach(t=>MPe.set(RPe(t),t));let yEt=class extends EMe{constructor(e){super("EdgeProcessingWorker","extract",{extract:i=>[i.dataBuffer],extractComponentsEdgeLocations:i=>[i.dataBuffer],extractEdgeLocations:i=>[i.dataBuffer]},e)}async process(e,i,r){if(r)return o2t(e);const s=await this.invoke(new fz(e),i);return this._unpackOutput(s)}async extractEdgeLocations(e,i){const r=await this.invokeMethod("extractEdgeLocations",new fz(e),i);return FD(r)}async extractComponentsEdgeLocations(e,i){const r=await this.invokeMethod("extractComponentsEdgeLocations",new fz(e),i);return FD(r)}_unpackOutput(e){return{regular:{instancesData:FD(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:FD(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}}},fz=class{constructor(e){this.dataBuffer=e.data.buffer,this.writerSettings=e.writerSettings,this.skipDeduplicate=e.skipDeduplicate,this.indices=Array.isArray(e.indices)?e.indices:e.indices.buffer,this.indicesType=Array.isArray(e.indices)?"Array":MY(e.indices)?"Uint32Array":"Uint16Array",this.indicesLength=e.indicesLength}};function _Et(t){const i=UO.resolution,r=i/2,s=new Uint8Array(4*i*i),n=4*i*r,o=UO.amplitude,a=2*o,l=4*i,c=Math.log2(i)+1,h=UO.strokes.length;let p=(c-1)*h*l;for(const{distance:m,pressure:y}of UO.strokes){let _=m,b=y,w=p;for(let S=0;S<c;S++){S!==0&&(_=ipe(_,UP.DISTANCE),b=ipe(b,UP.PRESSURE));for(let T=0;T<UO.resolution;T++){const E=.5+(_?_[T%_.length]/a:0),O=b?b[T%b.length]:1;_P(E,s,w),_P(O,s,w+n),w+=4}w-=l*(h+1)}p+=l}const f=new xt(t,{pixelFormat:it.RGBA,dataType:Ht.UNSIGNED_BYTE,hasMipmap:!1,samplingMode:gt.LINEAR,width:i,height:i,wrapMode:kt.REPEAT},s);return new bEt(i,a,o,h,f)}function ipe(t,e){if(!t)return null;const i=t.length/2,r=vEt*i,s=new Array(i);let n=0;const o=e===UP.PRESSURE;for(let a=0;a<t.length;a+=2){const l=(t[a]+t[a+1])/2;s[n++]=o?Math.min(r,1-(1-l)*rpe):Math.min(r,l*rpe)}return s}var UP;(function(t){t[t.DISTANCE=0]="DISTANCE",t[t.PRESSURE=1]="PRESSURE"})(UP||(UP={}));const vEt=.1,rpe=.5;let bEt=class{constructor(e,i,r,s,n){this.resolution=e,this.normalizationScale=i,this.amplitude=r,this.variants=s,this.texture=n}dispose(){this.texture=ft(this.texture)}};const UO={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function spe(t){let e=null;for(const i of t){const r=i.type;if(wEt(i)){if(C(e))e=r;else if(e!==r)return"uber"}}return v(e)?e:"uber"}function npe(t){let e=pi.INVISIBLE;for(const{material:i}of t)if(PPe(i)){if(i.color[3]*i.opacity<1)return pi.TRANSPARENT;e=pi.OPAQUE}return e}function ope(t){let e=pi.INVISIBLE;for(const{material:i}of t)if(PPe(i)){switch(i.objectTransparency){case pi.TRANSPARENT:case pi.INVISIBLE:return pi.TRANSPARENT;case pi.OPAQUE:if(i.opacity<1)return pi.TRANSPARENT}e=pi.OPAQUE}return e}function PPe(t){return t.size*t.color[3]*t.opacity>0}function wEt(t){return t.size*t.color[3]>0}function ape(t,e,i,r){for(let s=0;s<t.length;s++){const n=t[s].index,o=e[s],a=e[s+1];if(r)for(let l=o;l<a;l++){const c=r[l];i.set(c,n)}else for(let l=o;l<a;l++)i.set(l,n)}}let cp=class extends $e{constructor(t){super(t),this._updatingHandles=new Cm,this._perObjectData=new Map,this._perObjectDataEvictionCache=new Set,this._renderers=new Map,this._gpuMemoryUsage=0,this._workerAbort=new AbortController,this._tmpModelPosition=M(),this._localOrigins=new XSt(new Tee(t.renderSR))}initialize(){this._worker=new yEt(this.schedule),this._componentColorManager=new G3e(this.rctx,3);const t=U3e.createBuffer(4);for(let e=0;e<4;e++)t.sideness.set(e,0,e===0||e===3?0:1),t.sideness.set(e,1,e===0||e===1?0:1);this._verticesBufferObject=Yi.createVertex(this.rctx,Fi.STATIC_DRAW,t.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(t=>this._discardObjectEntry(t)),this._perObjectData.clear(),this._strokesTexture=ft(this._strokesTexture),this._componentColorManager=Je(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=ft(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy())}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return this._renderers.size>0}async addComponentObject(t,e,i,r,s,n,o,a){if(this.hasObject(t))return this.getObjectMemoryUsage(t);let l;const c=new cpe(new Promise(p=>l=p),i.center,i.radius);this._perObjectData.set(t,c);const h=await this._updatingHandles.addPromise(this._addComponentGeometry(e,c,r,s,n,o,a));return this.setNeedsRender(),l(),h}async addOrUpdateObject3D(t,e,i,r){if(this.destroyed)return void oe.getLogger(this.declaredClass).warn("Attempt to add an object to a destroyed instance");const s=this._perObjectData.get(t);let n;(s==null?void 0:s.renderables.length)>0&&this._perObjectDataEvictionCache.add(s);const o=t.boundingVolumeWorldSpace.bounds,a=new cpe(new Promise(c=>n=c),o,Cy(o));this._perObjectData.set(t,a);const l=new Array;if(i.mergeGeometries&&t.geometries.length>1&&xEt(t))l.push(this._addObjectMergedGeometries(t,a,e,i,r));else for(let c=0;c<t.geometries.length;c++){const h=t.geometries[c];h.material.supportsEdges&&l.push(this._addGeometry(t,a,h,e[0],i,r))}await this._updatingHandles.addPromise(Promise.all(l)),this._perObjectDataEvictionCache.delete(a),this._discardObjectEntry(s),this.setNeedsRender(),n()}_discardObjectEntry(t){t&&(t.renderables.length&&(t.renderables.forEach(e=>this._removeRenderable(e)),this.setNeedsRender()),t.loaded=null)}hasObject(t){return this._perObjectData.has(t)}async updateAllComponentOpacities(t,e){const i=await this._updatingHandles.addPromise(this._getObjectEntry(t));if(C(i))return;const r=e instanceof Array?s=>e[s]:()=>e;i.renderables.forEach(s=>{const n=s.components.meta.length;for(let o=0;o<n;o++){const a=r(o),l=s.components.meta[o],c=l.index;l.material.opacity=a,s.components.buffer.textureBuffer.setDataElement(c,1,3,255*a)}this._updateTransparency(s)}),this.setNeedsRender()}async getObjectMemoryUsage(t){const e=await this._getObjectEntry(t);return v(e)?e.renderables.reduce((i,r)=>i+r.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(t,e,i,r){const s=t instanceof v0,n=!!i.hasSlicePlane,o=spe(e),a=pz.getKey(o,n,s),l=await this._updatingHandles.addPromise(this._getObjectEntry(t));C(l)||(l.renderables.forEach(c=>{if(a!==c.rendererKey){const h=this._renderers.get(c.rendererKey),p=this._acquireRenderer(o,n,s);h.removeRenderable(c),--h.refCount,c.rendererKey=a,p.addRenderable(c)}for(let h=0;h<e.length;h++)c.components.meta[h].material=e[h];r&&this._updateComponentBuffer(c.components),this._updateTransparency(c)}),this.setNeedsRender())}async updateAllVerticalOffsets(t,e){const i=await this._updatingHandles.addPromise(this._getObjectEntry(t));C(i)||(i.renderables.forEach(r=>{const s=r.components.meta;for(let n=0;n<s.length;n++)r.components.meta[n].verticalOffset=(e==null?void 0:e[n])??0;this._updateComponentBuffer(r.components)}),this.setNeedsRender())}async updateObjectVisibility(t,e){const i=await this._updatingHandles.addPromise(this._getObjectEntry(t));v(i)&&(i.renderables.forEach(r=>r.visible=e),this.setNeedsRender())}removeObject(t){const e=this._perObjectData.get(t);e&&(this._perObjectData.delete(t),this._discardObjectEntry(e))}async _getObjectEntry(t){const e=this._perObjectData.get(t);if(!e)throw new Error("no object");return await e.loaded,e.loaded==null?null:e}render(t,e){if(C(this._componentColorManager))return;this._localOrigins.updateViewMatrices(t.camera.viewMatrix);const i=t.camera.viewInverseTransposeMatrix,r=M(),s=new tV;let n=0,o=0;if(this._renderers.forEach(l=>{if(l.refCount===0)this._renderers.delete(l.key),l.dispose();else{let c=!0,h=!0;l.forEachRenderable(p=>{p.visible&&(n+=p.statistics.averageEdgeLength,o++,c&&p.regular&&(l.updateTechnique(t,!1),c=!1),h&&p.silhouette&&(l.updateTechnique(t,!0),h=!1))},e)}}),this._componentColorManager.garbageCollect(),this._componentColorManager.updateTextures(),o===0)return;const a=new ZSt(40*n/o,e);fe(r,i[3],i[7],i[11]),s.set(r),he(a.transformWorldFromViewTH,s.high),he(a.transformWorldFromViewTL,s.low),bd(a.transformViewFromCameraRelativeRS,t.camera.viewMatrix),wd(ppe,a.transformViewFromCameraRelativeRS),mT(a.transformNormalViewFromGlobal,ppe),a.transformProjFromView=t.camera.projectionMatrix,this._updateObjectCameraDistances(t),this._renderers.forEach(l=>{this._renderRegularEdges(l,t,a),this._renderSilhouetteEdges(l,t,a)})}_updateTransparency(t){const e=npe(t.components.meta),i=ope(t.components.meta);e===t.edgeTransparency&&i===t.objectTransparency||(t.edgeTransparency=e,t.objectTransparency=i,this._renderers.get(t.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(t,e,i){t.getCombinedStaticTransformation(e,i);const r=v(e.localOrigin)?this._localOrigins.register(e.localOrigin):this._localOrigins.acquire(fe(this._tmpModelPosition,i[12],i[13],i[14]));return e.localOrigin=r.origin,qSt(r.origin.vec3,i),r}_updateComponentBuffer(t){const{meta:e,buffer:i}=t,r=new Uint8Array(4);for(let s=0;s<e.length;s++){const n=e[s].material,o=e[s].index,a=we(Math.round(n.size*uEt),0,255),l=we(n.extensionLength,-dz,255-dz)+dz,c=n.type==="solid"?_6.SOLID:_6.SKETCH,h=255*n.opacity,p=n.color,f=255*p[0],m=255*p[1],y=255*p[2],_=255*p[3];i.textureBuffer.setData(o,0,f,m,y,_),i.textureBuffer.setData(o,1,a,l,c,h),L3e(e[s].verticalOffset,r),i.textureBuffer.setData(o,2,r[0],r[1],r[2],r[3])}}_createComponentBuffers(t){if(C(this._componentColorManager))return null;const e=new Array,i=this._componentColorManager.getBuffer(t.length);for(let s=0;s<t.length;s++){const n=t[s],o=i.acquireIndex();e.push({index:o,verticalOffset:0,material:n})}const r=new TEt(i,e);return this._updateComponentBuffer(r),r}_extractEdges(t,e,i,r,s,n=s.length){return this._worker.process({data:e,indices:s,indicesLength:n,writerSettings:t,skipDeduplicate:i},this._workerAbort.signal,r)}_createRenderable(t,e,i,r,s){const n=c=>v(this._verticesBufferObject)?new SEt(new af(this.rctx,k3e,{vertices:YTt,instances:c===Vw.REGULAR?g6.glLayout:y6.glLayout},{vertices:this._verticesBufferObject,instances:Yi.createVertex(this.rctx,Fi.STATIC_DRAW,c===Vw.REGULAR?t.regular.instancesData.buffer:t.silhouette.instancesData.buffer)}),c===Vw.REGULAR?t.regular.lodInfo:t.silhouette.lodInfo):null,o=t.regular.lodInfo.lengths.length>0?n(Vw.REGULAR):null,a=t.silhouette.lodInfo.lengths.length>0?n(Vw.SILHOUETTE):null,l=(v(o)?o.vao.size:0)+(v(a)?a.vao.size:0);return new CEt(o,a,{gpuMemoryUsage:l,externalMemoryUsage:s,averageEdgeLength:t.averageEdgeLength},i,npe(e.meta),ope(e.meta),e,r)}async _addGeometry(t,e,i,r,s,n){const o=i.vertexAttributes.get(A.POSITION),a=i.indices.get(A.POSITION),l=We(),c=this._computeModelTransformWithLocalOrigin(t,i,l),h=new dpe(o,a,l,c);return this._addPositionData(e,h,i.edgeIndicesLength,r,s,n)}async _addPositionData(t,e,i,r,s,n=!1){if(t.loaded==null)return;const o=this._createComponentBuffers([r]);if(C(o)||i<=0)return;const a=this._acquireRenderer(r.type,!!s.hasSlicePlane,!0),{modelTransform:l,origin:c}=e,h=e.indices,p=e.position,f=p.data.length/p.size,m=f6.createBuffer(f);for(let b=0;b<f;b++)m.position.set(b,0,p.data[b*p.size+0]),m.position.set(b,1,p.data[b*p.size+1]),m.position.set(b,2,p.data[b*p.size+2]);ape(o.meta,[0,m.componentIndex.count],m.componentIndex);const y=await this._updatingHandles.addPromise(this._extractEdges(a.writerSettings,m,!1,n,h,i));if(t.loaded==null)return;const _=this._createRenderable(y,o,new EEt(l,c),a.key,!1);t.renderables.push(_),a.addRenderable(_),this._gpuMemoryUsage+=_.statistics.gpuMemoryUsage}async _addComponentGeometry(t,e,i,r,s,n,o){if(e.loaded==null)return 0;const a=this._createComponentBuffers(n);if(C(a))return 0;const l=spe(n),c=this._acquireRenderer(l,o.hasSlicePlane||!1,!1),h=f6.createBuffer(i.count);H8(h.position,i),ape(a.meta,s,h.componentIndex,r);const p=!0,f=c.writerSettings,m=await this._updatingHandles.addPromise(this._extractEdges(f,h,p,!1,r));if(e.loaded==null)return 0;const y=this._createRenderable(m,a,t,c.key,!0);return e.renderables.push(y),c.addRenderable(y),y.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(t,e,i,r,s){const n=new Map;let o=0,a=null,l=0;for(let w=0;w<t.geometries.length;w++){const S=t.geometries[w];if(!S.material.supportsEdges)continue;!a&&S.localOrigin&&(a=S);const T=S.vertexAttributes.get(A.POSITION);l+=T.data.length/T.size,o+=S.edgeIndicesLength}const c=l>=65536?Uint32Array:Uint16Array,h=o?new c(o):null,p=[];let f=0;for(let w=0;w<t.geometries.length;w++){const S=t.geometries[w];if(!S.material.supportsEdges)continue;const T=S.vertexAttributes.get(A.POSITION),E=S.indices.get(A.POSITION);let O=n.get(T.data);if(O==null){O=p.length/3;for(let R=0;R<T.data.length;R+=T.size)p.push(T.data[R+0]),p.push(T.data[R+1]),p.push(T.data[R+2]);n.set(T.data,O)}if(E)for(let R=0;R<S.edgeIndicesLength;R++)h[f++]=O+E[R]}const m=a||t.geometries[0],y=We(),_=this._computeModelTransformWithLocalOrigin(t,m,y);for(let w=0;w<t.geometries.length;w++)t.geometries[w].localOrigin=_.origin;const b=new dpe({data:p,size:3},h,y,_);await this._updatingHandles.addPromise(this._addPositionData(e,b,h.length,i[0],r,s))}_acquireRenderer(t,e,i){const r=pz.getKey(t,e,i);let s=this._renderers.get(r);return C(this._strokesTexture)&&(this._strokesTexture=_Et(this.rctx)),s||(s=new pz(this.rctx,this.techniqueRepository,{type:t,hasSlicePlane:e,strokesTexture:this._strokesTexture,legacy:i,spherical:this.viewingMode===st.Global}),this._renderers.set(r,s)),++s.refCount,s}_removeRenderable(t){lpe(t.regular),lpe(t.silhouette);const e=this._renderers.get(t.rendererKey);if(e){e.removeRenderable(t),--e.refCount,"origin"in t.transform&&this._localOrigins.release(t.transform.origin),this._gpuMemoryUsage-=t.statistics.externalMemoryUsage?0:t.statistics.gpuMemoryUsage;for(const i of t.components.meta)t.components.buffer.releaseIndex(i.index)}}_updateObjectCameraDistances(t){const e=t.camera.eye,i=t.camera.viewForward,r=M(),s=n=>{po(r,n.center,e);const o=Ae(r,i),a=n.radius,l=o<-a?1/0:o<a?0:o-a;n.renderables.forEach(c=>c.distanceToCamera=l)};this._perObjectData.forEach(s),this._perObjectDataEvictionCache.forEach(s)}_renderRegularEdges(t,e,i){const r=t.bindRegularEdges(i,e),s=i.transparency,n=e.camera.perScreenPixelRatio;t.forEachRenderable(o=>{if(!upe(o)||!o.visible)return;const a=UD(o.regular.lod.lengths,o.distanceToCamera,n);t.renderRegularEdges(r,o,i,e,a)},s)}_renderSilhouetteEdges(t,e,i){const r=t.bindSilhouetteEdges(i,e),s=i.transparency,n=e.camera.perScreenPixelRatio;t.forEachRenderable(o=>{if(!hpe(o)||!o.visible)return;const a=UD(o.silhouette.lod.lengths,o.distanceToCamera,n);t.renderSilhouetteEdges(r,o,i,e,a)},s)}get test(){return{hasRenderedPrimitives:t=>{let e=!1;const i=t.perScreenPixelRatio,r=(s,n)=>s.forEachRenderable(o=>{o.visible&&!e&&(upe(o)&&(e=UD(o.regular.lod.lengths,o.distanceToCamera,i)>0),!e&&hpe(o)&&(e=UD(o.silhouette.lod.lengths,o.distanceToCamera,i)>0))},n);return this._renderers.forEach(s=>{e||(r(s,pi.OPAQUE),r(s,pi.TRANSPARENT))}),e}}}};function lpe(t){v(t)&&(t.vao.vertexBuffers.instances.dispose(),t.vao.dispose(!1),t.vao=null)}function xEt(t){let e=null,i=null;for(let r=0;r<t.geometries.length;r++){const s=t.geometries[r];if(s.material.supportsEdges){if(e){if(!Uy(e,s.transformation))return!1}else e=s.transformation;if(!i&&v(s.localOrigin))i=s;else if(i&&v(i.localOrigin)&&v(s.localOrigin)&&i.localOrigin.id!==s.localOrigin.id)return!1}}return!0}u([d({constructOnly:!0})],cp.prototype,"rctx",void 0),u([d({constructOnly:!0})],cp.prototype,"renderSR",void 0),u([d({constructOnly:!0})],cp.prototype,"viewingMode",void 0),u([d({constructOnly:!0})],cp.prototype,"techniqueRepository",void 0),u([d({constructOnly:!0})],cp.prototype,"setNeedsRender",void 0),u([d({constructOnly:!0})],cp.prototype,"schedule",void 0),u([d({readOnly:!0})],cp.prototype,"_updatingHandles",void 0),u([d({readOnly:!0})],cp.prototype,"updating",null),cp=u([I("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],cp);class cpe{constructor(e,i,r){this.center=i,this.radius=r,this.renderables=new Array,this.loaded=e,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}}class TEt{constructor(e,i){this.buffer=e,this.meta=i}}let SEt=class{constructor(e,i){this.vao=e,this.lod=i}},EEt=class{constructor(e,i){this.modelMatrix=e,this.origin=i}};class CEt{constructor(e,i,r,s,n,o,a,l){this.regular=e,this.silhouette=i,this.statistics=r,this.transform=s,this.edgeTransparency=n,this.objectTransparency=o,this.components=a,this.rendererKey=l,this.distanceToCamera=0,this.visible=!0}}function upe(t){return v(t.regular)}function hpe(t){return v(t.silhouette)}function UD(t,e,i){const r=e*i,s=iDe(t,r,!0);return s===-1?r<t[0]?t.length:0:t.length-s}let dpe=class{constructor(e,i,r,s){this.position=e,this.indices=i,this.modelTransform=r,this.origin=s}};const ppe=ls();function lg(t){return window.WebGL2RenderingContext&&t instanceof window.WebGL2RenderingContext}let fpe=class{constructor(e,i,r,s,n,o,a,l,c){this.createQuery=e,this.deleteQuery=i,this.resultAvailable=r,this.getResult=s,this.disjoint=n,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}},ty=!1;function AEt(t,e){if(e.disjointTimerQuery)return null;let i=t.getExtension("EXT_disjoint_timer_query_webgl2");return i&&lg(t)?new fpe(()=>t.createQuery(),r=>{t.deleteQuery(r),ty=!1},r=>t.getQueryParameter(r,t.QUERY_RESULT_AVAILABLE),r=>t.getQueryParameter(r,t.QUERY_RESULT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{ty||(ty=!0,t.beginQuery(i.TIME_ELAPSED_EXT,r))},()=>{t.endQuery(i.TIME_ELAPSED_EXT),ty=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>t.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):(i=t.getExtension("EXT_disjoint_timer_query"),i?new fpe(()=>i.createQueryEXT(),r=>{i.deleteQueryEXT(r),ty=!1},r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_AVAILABLE_EXT),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_EXT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{ty||(ty=!0,i.beginQueryEXT(i.TIME_ELAPSED_EXT,r))},()=>{i.endQueryEXT(i.TIME_ELAPSED_EXT),ty=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):null)}function OEt(t,e){const i=t.capabilities.disjointTimerQuery;return C(i)?null:new REt(i,e)}let REt=class{constructor(e,i){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,i.forEach(r=>{const s=this._timer.createQuery(),n=this._timer.createQuery();this._queryPool.push(s,n),this._queryResults.set(r,null)})}start(){ty||(this._currentQuery=this._queryPool.pop(),C(this._currentQuery)||(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||C(this._currentQuery)||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const i=this._queryResults.get(e);if(C(i))return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(i))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const r=this._timer.getResult(i)/1e6;return this._queryPool.unshift(i),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,r}abort(){v(this._currentQuery)&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){v(this._currentQuery)&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{C(e)||this._timer.deleteQuery(e)})}};var Ir;(function(t){t.OVERLAY="overlay",t.PREPARE="prepare",t.SHADOW_MAP="shadow map",t.LINEAR_DEPTH="linear depth",t.ACCUMULATED_SHADOWS="accumulated shadows",t.NORMALS="normals",t.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",t.SSAO="SSAO",t.OPAQUE="opaque",t.OPAQUE_EDGES="opaque edges",t.VOXEL="voxel",t.TRANSPARENT="transparent",t.TRANSPARENT_EDGES="transparent edges",t.HUD_VISIBILITY="HUD visibility",t.TRANSPARENT_TERRAIN="transparent terrain",t.ENVIRONMENT="environment",t.LASER_LINE="laser line",t.OCCLUDED="occluded",t.ANTIALIASING="antialiasing",t.HIGHLIGHTS="highlights",t.HUD="HUD",t.HUD_OCCLUDED="HUD occluded",t.FINISH="finish"})(Ir||(Ir={}));const mpe="Total";let MEt=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new vy(mpe),this._cpuTimeSamplers=new Map(Object.values(Ir).map(i=>[i,new vy(i)])),this._enableGPUTimer=0,this._totalGPUTime=new vy("GPU"),this._gpuTimeSamplers=new Map(Object.values(Ir).map(i=>[i,new vy(i)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return v(this._gpuTimerPool)}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(C(this._gpuTimerPool)){const e=[...Object.values(Ir),mpe];this._gpuTimerPool=OEt(this._rctx,e)}return C(this._gpuTimerPool)?{hasGPUTimerSupport:!1,remove:()=>{}}:(++this._enableGPUTimer,{hasGPUTimerSupport:!0,remove:LY(()=>{--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=ft(this._gpuTimerPool))})})}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),v(this._gpuTimerPool)&&this._gpuTimerPool.start()}advance(e){const i=performance.now();if(this._cpuTimeSamplers.get(e).record(i-this._lastTimeStampCPU),this._lastTimeStampCPU=i,v(this._gpuTimerPool)){const r=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(r),this._gpuTimerPool.start()}}finishFrame(){if(v(this._gpuTimerPool)){const i=this._gpuTimerPool.stop(Ir.FINISH);this._gpuTimeSamplers.get(Ir.FINISH).record(i)}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.record(e),v(this._gpuTimerPool)&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((i,r)=>i+(r.last||0),0)),++this._totalFrameCount}},Cu=class extends $e{get _bindParameters(){return this._renderContext.bindParameters}isFeatureEnabled(t,e=this._state){return Gt(this._renderStateFeatures.get(e,t),!1)}setFeatureEnabled(t,e,i){this._renderStateFeatures.set(e,t,i),this.notifyChange("_renderStateFeatures"),this._requestRender()}get _antialiasing(){return this._antialiasingEnabled||this.isFeatureEnabled(Xs.Antialiasing)}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(Xs.HighQualityTransparency)}get hasWaterReflection(){return this.hasWater&&(this._waterReflectionEnabled||this.isFeatureEnabled(Xs.WaterReflection))}get hasWater(){return this._hasWater||this._hasOverlayWater}constructor(t,e,i,r,s,n,o,a){super({}),this._stage=t,this._materialRepository=e,this._shaderTechniqueRepository=r,this._rctx=s,this._compositingHelper=n,this._magnifierHelper=o,this._requestRender=a,this._materialRenderers=new li,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._renderOverlay=l=>{},this._isRendering=!1,this._fallbackDepthStencilTexture=null,this._sliceHelper=new FSt,this._state=Mi.IDLE,this._renderStateFeatures=ele(),this._antialiasingEnabled=!0,this._highQualityTransparencyEnabled=!0,this._terrainRenderingEnabled=!0,this._terrainTransparency=Bn.Opaque,this._waterReflectionEnabled=!1,this._ssaoEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new W2t,this._handles=new Ki,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this._smaaPass=new fM(this._rctx,r),a(),this._offscreen=new pSt(this._rctx,this._compositingHelper),this.performanceInfo=new MEt(this._rctx),this._shadowMap=new See(this._rctx,t.viewingMode),this._ssaoHelper=new zOe(t.view,r,this._rctx,a),this._highlight=new cSt(r,this._rctx),this._shadowHighlight=new NSt(this._rctx,t.viewingMode),this._shadowAccumulator=new Hl(this._rctx,r,t,l=>{const c=this.shadowsEnabled;this._shadowMap.enabled=!0,this._prepare(l.camera,l.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=c},(l,c,h)=>{l.shadowMap.start(l.camera,c,h),this._renderShadowCascades(k.Shadow,l.shadowMap),l.camera.setGLViewport(this._rctx),this._prepare(l.camera,l.contentCamera)},a),this._renderContext=new Dpt(this._rctx,this._offscreen,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new gSt({renderContext:this._renderContext,techniqueRepository:r,textureRepository:i,materialRepository:this._materialRepository,requestRender:a,controller:t}),this.renderPassManager=new q2t(this._rctx,this._shaderTechniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([re(()=>this._stage.view.state.camera,()=>a(),Br),re(()=>Ji.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,l=>{this._renderHiddenTransparentEdges=l?()=>this._renderEdges(pi.TRANSPARENT):()=>{},a()},Zt),re(()=>this._ssaoEnabled||this.isFeatureEnabled(Xs.SSAO),l=>this._ssaoHelper.enabled=l,Br)])}normalizeCtorArgs(){return{}}destroy(){this._handles.destroy(),this._smaaPass.dispose(),this._gpuTimerHandle=Rr(this._gpuTimerHandle),this._materialRenderers.forAll(t=>t.dispose()),this._materialRenderers.clear(),this._offscreen.dispose(),this._fallbackDepthStencilTexture=ft(this._fallbackDepthStencilTexture),this._shadowMap.dispose(),this._ssaoHelper.dispose(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),ISe.prune()}disposeOffscreenBuffers(){this._offscreen.dispose(),this._shadowMap.disposeOffscreenBuffers(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing&&this._smaaPass.updating||v(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}ensureEdgeView(){return C(this._edgeView)&&(this._edgeView=new cp({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:t=>this._stage.view.resourceController.immediate.schedule(t)}),this._handles.add(re(()=>go(this._edgeView,t=>t.updating),()=>this._requestRender(),Wi)),this._requestRender()),this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return QZ(this._bindParameters.ssr.reprojectionMatrix,th)}set _reprojectionMatrix(t){AY(this._bindParameters.ssr.reprojectionMatrix,t)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){var t;return!!((t=this._shadowMap)!=null&&t.enabled)}setParameters(t){const{_shadowMap:e,_bindParameters:i}=this;if(t.screenSpaceReflectionsEnabled!==void 0&&i.ssr.enabled!==t.screenSpaceReflectionsEnabled&&(i.ssr.enabled=t.screenSpaceReflectionsEnabled,this._requestRender()),t.shadowMap!==void 0&&this._shadowMap.enabled!==t.shadowMap&&(this._shadowMap.enabled=t.shadowMap,this._requestRender()),t.shadowMapMaxCascades!==void 0&&e.maxCascades!==t.shadowMapMaxCascades&&(e.maxCascades=t.shadowMapMaxCascades,this._requestRender()),v(t.environment)){v(t.environment.weather)&&(this._bindParameters.weather=t.environment.weather,this._bindParameters.weatherVisible=!!t.weatherVisible),t.environment.lighting.ambientOcclusionEnabled!==void 0&&this._ssaoEnabled!==t.environment.lighting.ambientOcclusionEnabled&&(this._ssaoEnabled=t.environment.lighting.ambientOcclusionEnabled,this._requestRender()),t.environment.lighting.waterReflectionEnabled!==void 0&&this._waterReflectionEnabled!==t.environment.lighting.waterReflectionEnabled&&(this._waterReflectionEnabled=t.environment.lighting.waterReflectionEnabled,this._requestRender());const r=t.environment.lighting.type!=="virtual";i.enableFillLights!==r&&(i.enableFillLights=r,this._requestRender())}t.background&&this._offscreen.background!==t.background&&(this._offscreen.background=t.background,this._requestRender()),t.antialiasingEnabled!==void 0&&this._antialiasingEnabled!==t.antialiasingEnabled&&(this._antialiasingEnabled=t.antialiasingEnabled,this._requestRender()),t.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==t.highQualityTransparency&&(this._highQualityTransparencyEnabled=t.highQualityTransparency,this._requestRender()),t.defaultHighlightOptions!==void 0&&(this._highlight.setDefaultOptions(t.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(t.defaultHighlightOptions),this._requestRender()),t.overlays!==void 0&&this._bindParameters.overlays!==t.overlays&&(this._bindParameters.overlays=t.overlays,this._requestRender()),t.hasOverlayWater!==void 0&&this._hasOverlayWater!==t.hasOverlayWater&&(this._hasOverlayWater=t.hasOverlayWater,this._requestRender()),t.renderOverlay!==void 0&&this._renderOverlay!==t.renderOverlay&&(this._renderOverlay=t.renderOverlay,this._requestRender()),t.slicePlane!==void 0&&this._sliceHelper.plane!==t.slicePlane&&(this._sliceHelper.plane=t.slicePlane,this._requestRender()),t.terrainRenderingEnabled!==void 0&&this._terrainRenderingEnabled!==t.terrainRenderingEnabled&&(this._terrainRenderingEnabled=t.terrainRenderingEnabled,this._requestRender()),t.terrainTransparency!==void 0&&this._terrainTransparency!==t.terrainTransparency&&(this._terrainTransparency=t.terrainTransparency,this._requestRender()),t.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(t.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(t,e){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:i,removes:r,updates:s}=t;if(i.length===0&&r.length===0&&s.length===0)return;const n=TOe(t);let o=!1;n.forEach((a,l)=>{if(e.done)return;let c=this._materialRenderers.find(h=>h.material===l);C(c)&&a.adds.length>0&&(c=new DOe(this._rctx,this._materialRepository,l),this._materialRenderers.push(c)),c&&(c.modify(a),c.isEmpty&&(o=!0)),a.removes.forEach(h=>t.removes.removeUnordered(h)),a.adds.forEach(h=>t.adds.removeUnordered(h)),a.updates.forEach(h=>t.updates.removeUnordered(h)),e.madeProgress()}),o&&this._materialRenderers.filterInPlace(a=>!a.isEmpty||(a.dispose(),!1)),this._hasHighlights=this._materialRenderers.some(a=>a.hasHighlights),this._bindParameters.hasOccludees=this._materialRenderers.some(a=>a.hasOccludees),this._hasWater=this._materialRenderers.some(a=>a.hasWater),this._hasHUDElements=this._materialRenderers.some(a=>a.requiresSlot(Fe.LINE_CALLOUTS_HUD_DEPTH,k.Color)||a.requiresSlot(Fe.HUD_MATERIAL,k.Color)||a.requiresSlot(Fe.LABEL_MATERIAL,k.Color)),this._requestRender()}updateAnimation(t){const e=this._hasAnimations;return this._hasAnimations=!1,this._materialRenderers.forAll(i=>this._hasAnimations=i.updateAnimation(t)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(t)||this._hasAnimations,this._hasAnimations!==e&&(this._gpuTimerHandle=e?Rr(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}render(t,e,i,r,s){this._isRendering=!0,this.performanceInfo.startFrame();const{camera:n,contentCamera:o,mode:a}=i;this._state=a,this._renderOverlay(s),this.performanceInfo.advance(Ir.OVERLAY),this._renderContext.time=s,this._bindParameters.transparencyPassType=$t.NONE;const l=this._offscreen;l.setupRenderTarget(this.hasWaterReflection);const c=o0(this._sliceHelper.plane);r===zx.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(t),n.setGLViewport(this._rctx),this._prepare(n,o),this._renderPlugins.prepareRender(),this.performanceInfo.advance(Ir.PREPARE);const h=this._computeDepthRange(n);this._renderShadowMap(t,n,this._bindParameters.lighting.mainLight.direction,h),this.performanceInfo.advance(Ir.SHADOW_MAP),l.initializeFrame(n),this._ensureBindParameters(n,o),this._renderLinearDepth(),this.performanceInfo.advance(Ir.LINEAR_DEPTH),this._accumulateShadows(h,n,o),this.performanceInfo.advance(Ir.ACCUMULATED_SHADOWS),this._renderNormal(),this.performanceInfo.advance(Ir.NORMALS),this._ensureBindParametersSSR(s),this._renderSSAO(s),this.performanceInfo.advance(Ir.SSAO),this._renderContext.output=k.Color,l.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(Ir.OPAQUE);const p=this._terrainRenderingEnabled&&(this._terrainTransparency===Bn.Semitransparent||this._terrainTransparency===Bn.TransparentWithDraped),f=this._highQualityTransparency&&p;this._renderTerrainLinearDepth(f),this._setMultipassEnabled(f),this._setTerrainCulling(f),this._renderEdges(pi.OPAQUE),this.performanceInfo.advance(Ir.OPAQUE_EDGES),this._offscreen.bindTarget(this._offscreen.currentColorTarget,this._offscreen.mainDepth),this._renderSlot(Fe.VOXEL),this.performanceInfo.advance(Ir.VOXEL),this._renderHiddenTransparentEdges();const m=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;m&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(Ir.TRANSPARENT),this._renderGeometryLinearDepth(f);const y=this._renderHUDVisibility(f);f||this._renderInternalSlot(Fe.LINE_CALLOUTS),this.performanceInfo.advance(Ir.HUD_VISIBILITY),this._renderObjectAndLayerIdColor(e),this.performanceInfo.advance(Ir.OBJECT_AND_LAYER_ID_COLOR),this._renderEdges(pi.TRANSPARENT,f),this.performanceInfo.advance(Ir.TRANSPARENT_EDGES),this._renderTransparentTerrain(),p&&y&&(f?this._renderLineCallouts(Pu.Occluded):l.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(Pu.Occluded,l.framebuffer),this.performanceInfo.advance(Ir.HUD_OCCLUDED)),this.performanceInfo.advance(Ir.TRANSPARENT_TERRAIN),this._setTerrainCulling(!1),p&&(l.compositeTransparentTerrainOntoMain(this._bindParameters),f&&(this._renderEdges(pi.OPAQUE),this.performanceInfo.advance(Ir.OPAQUE_EDGES),m&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(Ir.TRANSPARENT),this._renderEdges(pi.TRANSPARENT),this.performanceInfo.advance(Ir.TRANSPARENT_EDGES))),f&&this._renderLineCallouts(Pu.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),l.renderToTargets(()=>{this._renderInternalSlot(Fe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(Fe.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(Fe.LASERLINES)},l.currentColorTarget,l.mainDepth),this.performanceInfo.advance(Ir.ENVIRONMENT),this._renderPlugins.needsLaserlineWithContrastControl&&l.renderTmpAndCompositeToMain(()=>this._renderSlot(Fe.LASERLINES_CONTRAST_CONTROL),this._bindParameters,Oa.PremultipliedAlpha),this.performanceInfo.advance(Ir.LASER_LINE),this._renderOccluded(),this.performanceInfo.advance(Ir.OCCLUDED);const _=r===zx.ON&&this._magnifierHelper.enabled,b=_&&C(t)?this._offscreen.getFramebuffer(this._offscreen.tmpColor,this._offscreen.tmpDepth):t;this._rctx.bindFramebuffer(b);const w=this._offscreen.colorTexture;!this._renderAntiAliasing(w)&&v(w)&&this._compositingHelper.composite(this._bindParameters,w,Oa.None),this.performanceInfo.advance(Ir.ANTIALIASING),this._renderHUD(Pu.NotOccluded,b),this.performanceInfo.advance(Ir.HUD),this._renderHighlights(b,this._bindParameters),this.performanceInfo.advance(Ir.HIGHLIGHTS),_&&this._magnifierHelper.render(this._rctx,this._bindParameters),b!==t&&(this._rctx.bindFramebuffer(t),this._compositingHelper.composite(this._bindParameters,this._offscreen.tmpColorTexture,Oa.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=c,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.finishFrame()}_renderObjectAndLayerIdColor(t){if(v(t)&&de("enable-feature:objectAndLayerId-rendering")){const e=this._renderContext.output;this._rctx.bindFramebuffer(t),this._offscreen.renderToFBO(()=>this._renderGeometryAndTransparentTerrainPass(k.ObjectAndLayerIdColor),[0,0,0,0],!0,!0),this._rctx.bindFramebuffer(t),this._offscreen.renderToFBO(()=>{this._bindParameters.renderTransparentlyOccludedHUD=Pu.NotOccluded,this._renderInternalSlot(Fe.HUD_MATERIAL)},void 0,!0,!0),this._renderContext.output=e}}finish(t){this._hasAnimations||this._animationTimestep.clear();const e=this.performanceInfo.gpuSamplingEnabled,i=t===Fs.BACKGROUND;if(i||e){const r=i?this.performanceInfo.elapsedTime:0,s=e?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),n=Math.max(r,s);this._animationTimestep.frame(n,i)}}readDepthPixels(t,e,i){const r=this._offscreen.bindTarget(this._offscreen.linearDepth,this._offscreen.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(t,t),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const s=Vr.COLOR_BUFFER_BIT|Vr.DEPTH_BUFFER_BIT|Vr.STENCIL_BUFFER_BIT;this._rctx.clearSafe(s),this._renderGeometryAndTransparentTerrainPass(k.Depth)}r.readPixels(e[0],e[1],e[2],e[3],it.RGBA,Ht.UNSIGNED_BYTE,i)}readHUDVisibility(t,e,i,r,s){this._offscreen.bindTarget(this._offscreen.hudVisibility).readPixels(t,e,i,r,it.RGBA,Ht.UNSIGNED_BYTE,s)}readAccumulatedShadow(t){return this._shadowAccumulator.readAccumulatedShadow(t[0],t[1])}_setMultipassEnabled(t){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=t}_setTerrainCulling(t){this._bindParameters.multipassTerrain.cullAboveGround=t}_renderSlot(t){this._bindParameters.slot=t,this._renderPlugins.render()}_renderEdges(t,e=!1){const i=this._edgeView;v(i)&&i.shouldRender()&&this._offscreen.renderTmpAndCompositeToMain(()=>i.render(this._bindParameters,t),this._bindParameters,Oa.Alpha,e)}_renderShadowMap(t,e,i,r){const s=this._shadowMap;s.enabled&&this.isFeatureEnabled(Xs.ShadowMapUpdate)&&(s.start(e,i,r),this._shadowHighlight.updateParameters(e,i),this._needsShadowHighlight?(this._renderShadowCascades(k.ShadowHighlight,this._shadowMap,n=>s.takeCascadeSnapshotTo(n,UC.Highlight)),s.clear(),this._renderShadowCascades(k.ShadowExcludeHighlight,this._shadowMap,n=>{s.takeCascadeSnapshotTo(n,UC.Default),this._renderGeometryAndTransparentTerrainPass(k.ShadowHighlight)})):this._renderShadowCascades(k.Shadow),s.finish(t),e.setGLViewport(this._rctx))}_renderShadowCascades(t,e=this._shadowMap,i=r=>{}){for(const r of e.cascades)r.camera.setGLViewport(this._rctx),this._prepare(r.camera,r.camera),this._renderGeometryAndTransparentTerrainPass(t),i(r)}get _needsLinearDepth(){return this._ssaoHelper.active||this._renderPlugins.needsLinearDepth||this.hasWaterReflection||this._needsShadowHighlight||this._needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreen.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(k.Depth),this._offscreen.linearDepth,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.linearDepth),this._bindParameters.linearDepthTexture=this._offscreen.linearDepthTexture}_renderTerrainLinearDepth(t){if(t){const e=this._renderContext.output;this._renderContext.output=k.Depth,this._offscreen.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreen.terrainLinearDepth,this._offscreen.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.output=e}else this._offscreen.disposeTarget(this._offscreen.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreen.terrainLinearDepthTexture}_renderGeometryLinearDepth(t){if(t){const e=this._renderContext.output;this._offscreen.renderToTargets(()=>this._renderGeometryPass(k.Depth),this._offscreen.geometryLinearDepth,this._offscreen.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.output=e}else this._offscreen.disposeTarget(this._offscreen.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreen.geometryLinearDepthTexture}get _needsNormal(){return this._ssaoHelper.active}_renderNormal(){this._needsNormal?this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(k.Normal)},this._offscreen.normal,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.normal)}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(t){if(!this._needsDepthRange)return FX;const e=R2t(t,this._materialRenderers,this._stage.layers);return GC(e,this.renderPlugins.queryDepthRange(t)),e.near=Math.max(t.near,e.near),e.far=Math.min(t.far,e.far),e}_renderGeometryAndTransparentTerrainPass(t){this._renderContext.output=t,this._renderGeometryPass(t),this._renderTransparentTerrain()}_renderGeometryPass(t){this._renderContext.output=t,this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderSSAO(t){this._ssaoHelper.render(this._bindParameters,t,this._offscreen.linearDepthTexture,this._offscreen.normalTexture)}_renderOpaqueGeometry(){this._renderSlot(Fe.INTEGRATED_MESH),this._renderSlot(Fe.OPAQUE_TERRAIN),this._renderInternalSlot(Fe.OPAQUE_MATERIAL),this._renderSlot(Fe.OPAQUE_MATERIAL),this._renderSlot(Fe.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(Fe.TRANSPARENT_MATERIAL),this._renderSlot(Fe.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot(Fe.TRANSPARENT_TERRAIN)}_renderHUDVisibility(t){let e=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,e=this._renderInternalSlot(Fe.OCCLUSION_PIXELS)},t),e}_renderLineCallouts(t){this._bindParameters.renderTransparentlyOccludedHUD=t,t===Pu.Occluded?this._offscreen.renderToTargets(()=>this._renderInternalSlot(Fe.LINE_CALLOUTS),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderInternalSlot(Fe.LINE_CALLOUTS)}_renderHUD(t,e){this._hasHUDElements&&(this._oitEnabled?(this._renderOrderIndependentTransparency(()=>this._renderHUDElements(t),!0),this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._bindParameters,this._offscreen.hudColorTexture,Oa.PremultipliedAlpha)):t===Pu.Occluded?this._offscreen.renderToTargets(()=>this._renderHUDElements(Pu.Occluded),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderHUDElements(t))}_renderHUDElements(t){this._bindParameters.renderTransparentlyOccludedHUD=t,this._renderInternalSlot(Fe.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(Fe.HUD_MATERIAL),this._renderInternalSlot(Fe.LABEL_MATERIAL)}get _needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this._needsHighlight}_renderHighlights(t,e){if(!this._needsHighlight)return void this._offscreen.disposeTarget(this._offscreen.highlight);const i=this._highlight,r=this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(k.Highlight),this._rctx.clearSafe(Vr.DEPTH_BUFFER_BIT),this._renderHUDElements(Pu.Both)},this._offscreen.highlight,this._offscreen.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=r.colorTexture,this._needsShadowHighlight&&this._shadowHighlight.render(e,t),i.render(this._bindParameters,r,t)}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(t,e,i){this._needsShadowCast&&v(this._offscreen.linearDepthTexture)&&this._shadowAccumulator.renderAccumulation(this._offscreen.linearDepthTexture,t,e,i)}_renderOrderIndependentTransparency(t,e){const i=s=>{this._bindParameters.transparencyPassType=s,this._offscreen.renderOITPass(()=>t(),s,e)},r=this._renderContext.output;this._renderContext.output=k.Alpha,i($t.Alpha),this._renderContext.output=k.Color,i($t.Color),i($t.FrontFace),this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,e),this._bindParameters.transparencyPassType=$t.NONE,this._renderContext.output=r,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreen.disposeTarget(this._offscreen.alphaFloatTarget),this._offscreen.disposeTarget(this._offscreen.colorFloatTarget),this._offscreen.disposeTarget(this._offscreen.frontFaceTarget)),this._oitUsed=!1}_renderOccluded(){let t=0;Bd.clear(),this._materialRenderers.forAll(n=>{n.material&&n.material.isVisible()&&n.material.renderOccluded===ps.OccludeAndTransparentStencil&&(t|=n.material.renderOccluded,Bd.push(n))});const e=this._offscreen,i=(n,o,a,l,c)=>{t&o&&(e.renderToTargets(a,e.tmpColor,e.mainDepth,[0,0,0,0],l,c),e.compositeOccludedOntoMain(this._bindParameters,n))};Bd.length!==0&&(this._renderInternalSlot(Fe.OCCLUDER_MATERIAL,Bd),i(.5,ps.OccludeAndTransparentStencil,()=>this._renderInternalSlot(Fe.TRANSPARENT_OCCLUDER_MATERIAL,Bd),!1,!1)),Bd.clear(),this._materialRenderers.forAll(n=>{n.material&&n.material.isVisible()&&(n.material.renderOccluded===ps.OccludeAndTransparent||n.material.renderOccluded===ps.Transparent||n.material.renderOccluded===ps.Opaque)&&(t|=n.material.renderOccluded,Bd.push(n))});const r=this._renderPlugins.renderOccludedFlags;if(t|=r,!t)return;const s=n=>{this._renderContext.renderOccludedMask=n,r>ps.Occlude&&this._renderSlot(Fe.OCCLUDED_TERRAIN),this._renderInternalSlot(Fe.OPAQUE_MATERIAL,Bd),this._renderInternalSlot(Fe.TRANSPARENT_MATERIAL,Bd),this._renderInternalSlot(Fe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,Bd),this._renderContext.resetRenderOccludedMask()};this._renderContext.output=k.Color,i(.5,ps.OccludeAndTransparent,()=>s(ps.OccludeAndTransparent),!0,oc.OutlineVisualElementMask),i(.5,ps.Transparent,()=>s(ps.Transparent),!0,oc.OutlineVisualElementMask),i(1,ps.Opaque,()=>s(ps.Opaque),!0,oc.OutlineVisualElementMask),Bd.clear()}_renderAntiAliasing(t){if(this._antialiasing){if(this._smaaPass.enable(()=>this._requestRender())&&v(t))return this._smaaPass.render(t),!0}else this._smaaPass.disable();return!1}_prepare(t,e){this._needsTransparentPass=this._materialRenderers.some(i=>i.requiresSlot(Fe.TRANSPARENT_MATERIAL,k.Color)),this._bindParameters.camera=t,this._bindParameters.contentCamera=e}_ensureBindParameters(t,e){this._bindParameters.camera=t,this._bindParameters.contentCamera=e;const i=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=i.hudVisibilityTexture,this._bindParameters.mainColorTexture=i.mainColorTexture,this._bindParameters.highlightDepthTexture=i.depthTexture??this._getFallbackDepthTexture()}_ensureBindParametersSSR(t){if(this._bindParameters.ssr.enabled=this.hasWaterReflection,this._bindParameters.ssr.enabled){C(this._waterReflectionEnableTime)&&(this._waterReflectionEnableTime=t),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=th:(Go(ype,this._bindParameters.camera.viewMatrix),Go(gpe,this._bindParameters.camera.projectionMatrix),Ts(O2,ype,gpe),Ts(O2,this._renderContext.lastFrameCamera.viewMatrix,O2),Ts(O2,this._renderContext.lastFrameCamera.projectionMatrix,O2),this._reprojectionMatrix=O2),this._bindParameters.ssr.lastFrameColorTexture=this._offscreen.lastFrameColorTexture;const e=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=e>0?Math.min(e,t-this._waterReflectionEnableTime)/e:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._bindParameters.ssr.lastFrameColorTexture=null,this._waterReflectionEnableTime=null}_renderInternalSlot(t,e=this._materialRenderers){let i=!1;return this._bindParameters.slot=t,e.forAll(r=>{r.material.shouldRender(this._renderContext)&&r.render(this._renderContext.output,this._bindParameters)&&(i=!0)}),i}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=M2e(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){var t,e,i,r,s;return{offscreen:((t=this._offscreen)==null?void 0:t.gpuMemoryUsage)??0,highlights:(((e=this._highlight)==null?void 0:e.gpuMemoryUsage)??0)+(((i=this._shadowHighlight)==null?void 0:i.gpuMemoryUsage)??0),shadows:((r=this._shadowMap)==null?void 0:r.gpuMemoryUsage)??0,ssao:((s=this._ssaoHelper)==null?void 0:s.gpuMemoryUsage)??0}}get test(){const t=this;return{offscreen:this._offscreen,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{t._renderStateFeatures=ele()},getFramebufferTexture:e=>{switch(e){case rv.Color:return t._offscreen.colorTexture;case rv.LinearDepth:return t._offscreen.linearDepthTexture;case rv.Normals:return t._offscreen.normalTexture;case rv.ShadowMap:return t._shadowMap.depthTexture;case rv.HudVisibility:return t._offscreen.hudVisibilityTexture;case rv.Highlight:return t._offscreen.highlightTexture}}}}};var rv;u([d()],Cu.prototype,"_shadowAccumulator",void 0),u([d()],Cu.prototype,"_state",void 0),u([d()],Cu.prototype,"_renderStateFeatures",void 0),u([d()],Cu.prototype,"_antialiasingEnabled",void 0),u([d({readOnly:!0})],Cu.prototype,"_antialiasing",null),u([d()],Cu.prototype,"_ssaoEnabled",void 0),u([d()],Cu.prototype,"_smaaPass",void 0),u([d({autoDestroy:!0})],Cu.prototype,"_edgeView",void 0),u([d()],Cu.prototype,"updating",null),u([d()],Cu.prototype,"isCameraFinal",null),Cu=u([I("esri.views.3d.webgl-engine.lib.Renderer")],Cu),function(t){t[t.Color=0]="Color",t[t.LinearDepth=1]="LinearDepth",t[t.Normals=2]="Normals",t[t.ShadowMap=3]="ShadowMap",t[t.HudVisibility=4]="HudVisibility",t[t.Highlight=5]="Highlight"}(rv||(rv={}));const Bd=new li,gpe=We(),ype=We(),O2=We();let _pe=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:Ve.ONE,dstRGB:Ve.ZERO,srcAlpha:Ve.ONE,dstAlpha:Ve.ZERO},this.blendEquation={mode:qm.ADD,modeAlpha:qm.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=Dp.BACK,this.frontFace=CC.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=Dr.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:Dp.FRONT_AND_BACK,func:Dr.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:Dp.FRONT_AND_BACK,fail:ks.KEEP,zFail:ks.KEEP,zPass:ks.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},PEt=class{constructor(e){this._allocations=new Map,e?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(e){this._allocations.set(e,new Error().stack)}remove(e){this._allocations.delete(e)}get information(){let e="";if(this._allocations.size>0){e+=`${this._allocations.size} live object allocations:
`;const i=new Map;this._allocations.forEach(r=>{i.set(r,(i.get(r)??0)+1)}),i.forEach((r,s)=>{const n=s.split(`
`);n.shift(),n.shift(),e+=`${r}: ${n.shift()}
`,n.forEach(o=>e+=`   ${o}
`)})}return e}};const IEt={RECORD_ALLOCATIONS:!1};let $Et=class{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new PEt(IEt.RECORD_ALLOCATIONS);this._current.length<Wn.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(e,i){const r=++this._current[e];this._max[e]=Math.max(r,this._max[e]),this._allocations.add(i)}decrement(e,i){--this._current[e],this._allocations.remove(i)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((e,i)=>e+i,0)}get resourceInformation(){let e="";if(this.total>0){e+=`Live objects:
`;for(let i=0;i<Wn.COUNT;++i){const r=this._current[i];r>0&&(e+=`${Wn[i]}: ${r}
`)}}return e+=this._allocations.information,e}};const LEt=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var vpe,qX={},DEt={get exports(){return qX},set exports(t){qX=t}};(vpe=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(DEt.exports=vpe);const NEt=qX;var bpe,WX={},FEt={get exports(){return WX},set exports(t){WX=t}};bpe=FEt,function(t){var e=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];e!==void 0&&(bpe.exports=e)}();const wpe=WX;var XX={},UEt={get exports(){return XX},set exports(t){XX=t}};(function(t){(function(e){var i=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();i!==void 0&&(t.exports=i)})()})(UEt);const VEt=XX;var zd=999,xpe=9999,mz=0,gz=1,Tpe=2,Spe=3,Epe=4,VD=5,kEt=6,BEt=7,zEt=8,Cpe=9,GEt=10,Ape=11,jEt=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function HEt(){var t,e,i,r=0,s=0,n=zd,o=[],a=[],l=1,c=0,h=0,p=!1,f=!1,m="";return function(G){return a=[],G!==null?_(G.replace?G.replace(/\r\n/g,`
`):G):b()};function y(G){G.length&&a.push({type:jEt[n],data:G,position:h,line:l,column:c})}function _(G){var te;for(r=0,i=(m+=G).length;t=m[r],r<i;){switch(te=r,n){case mz:r=O();break;case gz:r=E();break;case Tpe:r=T();break;case Spe:r=R();break;case Epe:r=F();break;case Ape:r=P();break;case VD:r=V();break;case xpe:r=B();break;case Cpe:r=S();break;case zd:r=w()}te!==r&&(m[te]===`
`?(c=0,++l):++c)}return s+=r,m=m.slice(r),a}function b(G){return o.length&&y(o.join("")),n=GEt,y("(eof)"),a}function w(){return o=o.length?[]:o,e==="/"&&t==="*"?(h=s+r-1,n=mz,e=t,r+1):e==="/"&&t==="/"?(h=s+r-1,n=gz,e=t,r+1):t==="#"?(n=Tpe,h=s+r,r):/\s/.test(t)?(n=Cpe,h=s+r,r):(p=/\d/.test(t),f=/[^\w_]/.test(t),h=s+r,n=p?Epe:f?Spe:xpe,r)}function S(){return/[^\s]/g.test(t)?(y(o.join("")),n=zd,r):(o.push(t),e=t,r+1)}function T(){return t!=="\r"&&t!==`
`||e==="\\"?(o.push(t),e=t,r+1):(y(o.join("")),n=zd,r)}function E(){return T()}function O(){return t==="/"&&e==="*"?(o.push(t),y(o.join("")),n=zd,r+1):(o.push(t),e=t,r+1)}function R(){if(e==="."&&/\d/.test(t))return n=VD,r;if(e==="/"&&t==="*")return n=mz,r;if(e==="/"&&t==="/")return n=gz,r;if(t==="."&&o.length){for(;L(o););return n=VD,r}if(t===";"||t===")"||t==="("){if(o.length)for(;L(o););return y(t),n=zd,r+1}var G=o.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||G){for(;L(o););return n=zd,r}return o.push(t),e=t,r+1}function L(G){for(var te,se,ie=0;;){if(te=wpe.indexOf(G.slice(0,G.length+ie).join("")),se=wpe[te],te===-1){if(ie--+G.length>0)continue;se=G.slice(0,1).join("")}return y(se),h+=se.length,(o=o.slice(se.length)).length}}function P(){return/[^a-fA-F0-9]/.test(t)?(y(o.join("")),n=zd,r):(o.push(t),e=t,r+1)}function F(){return t==="."||/[eE]/.test(t)?(o.push(t),n=VD,e=t,r+1):t==="x"&&o.length===1&&o[0]==="0"?(n=Ape,o.push(t),e=t,r+1):/[^\d]/.test(t)?(y(o.join("")),n=zd,r):(o.push(t),e=t,r+1)}function V(){return t==="f"&&(o.push(t),e=t,r+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(o.push(t),e=t,r+1):/[^\d]/.test(t)?(y(o.join("")),n=zd,r):(o.push(t),e=t,r+1)}function B(){if(/[^\d\w_]/.test(t)){var G=o.join("");return n=NEt.indexOf(G)>-1?zEt:VEt.indexOf(G)>-1?BEt:kEt,y(o.join("")),n=zd,r}return o.push(t),e=t,r+1}}function qEt(t){var e=HEt(),i=[];return i=(i=i.concat(e(t))).concat(e(null))}function WEt(t){return qEt(t)}function XEt(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const yz=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function YEt(t,e="100",i="300 es"){const r=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of t)if(s.type==="preprocessor"){const n=r.exec(s.data);if(n){const o=n[1].replace(/\s\s+/g," ");if(o===i)return o;if(o===e)return s.data="#version "+i,e;throw new Error("unknown glsl version: "+o)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:`
`}),null}function ZEt(t,e){for(let i=e-1;i>=0;i--){const r=t[i];if(r.type!=="whitespace"&&r.type!=="block-comment"){if(r.type!=="keyword")break;if(r.data==="attribute"||r.data==="in")return!0}}return!1}function mM(t,e,i,r){r=r||i;for(const s of t)if(s.type==="ident"&&s.data===i)return r in e?e[r]++:e[r]=0,mM(t,e,r+"_"+e[r],r);return i}function IPe(t,e,i="afterVersion"){function r(l,c){for(let h=c;h<l.length;h++){const p=l[h];if(p.type==="operator"&&p.data===";")return h}return null}function s(l){let c=-1,h=0,p=-1;for(let f=0;f<l.length;f++){const m=l[f];if(m.type==="preprocessor"&&(m.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++h:m.data.match(/\#endif\s*.*/)&&--h),i!=="afterVersion"&&i!=="afterPrecision"||m.type==="preprocessor"&&/^#version/.test(m.data)&&(p=Math.max(p,f)),i==="afterPrecision"&&m.type==="keyword"&&m.data==="precision"){const y=r(l,f);if(y===null)throw new Error("precision statement not followed by any semicolons!");p=Math.max(p,y)}c<p&&h===0&&(c=f)}return c+1}const n={data:`
`,type:"whitespace"},o=l=>l<t.length&&/[^\r\n]$/.test(t[l].data);let a=s(t);o(a-1)&&t.splice(a++,0,n);for(const l of e)t.splice(a++,0,l);o(a-1)&&o(a)&&t.splice(a,0,n)}function JEt(t,e,i,r="lowp"){IPe(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function KEt(t,e,i,r,s="lowp"){IPe(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function QEt(t,e){let i,r,s=-1;for(let n=e;n<t.length;n++){const o=t[n];if(o.type==="operator"&&(o.data==="["&&(i=n),o.data==="]")){r=n;break}o.type==="integer"&&(s=parseInt(o.data,10))}return i&&r&&t.splice(i,r-i+1),s}function Ope(t,e){const i=eCt();if(v(i))return i;const r=WEt(t);if(YEt(r,"100","300 es")==="300 es")return t;let s=null,n=null;const o={},a={};for(let l=0;l<r.length;++l){const c=r[l];switch(c.type){case"keyword":e===ku.VERTEX_SHADER&&c.data==="attribute"?c.data="in":c.data==="varying"&&(c.data=e===ku.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(c.data.trim())&&(c.data=c.data.replace(/(2D|Cube|EXT)/g,"")),e===ku.FRAGMENT_SHADER&&c.data==="gl_FragColor"&&(s||(s=mM(r,o,"fragColor"),JEt(r,s,"vec4")),c.data=s),e===ku.FRAGMENT_SHADER&&c.data==="gl_FragData"){const h=QEt(r,l+1),p=mM(r,o,"fragData");KEt(r,p,"vec4",h,"mediump"),c.data=p}else e===ku.FRAGMENT_SHADER&&c.data==="gl_FragDepthEXT"&&(n||(n=mM(r,o,"gl_FragDepth")),c.data=n);break;case"ident":if(LEt.includes(c.data)){if(e===ku.VERTEX_SHADER&&ZEt(r,l))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");c.data in a||(a[c.data]=mM(r,o,c.data)),c.data=a[c.data]}}}for(let l=r.length-1;l>=0;--l){const c=r[l];if(c.type==="preprocessor"){const h=c.data.match(/\#extension\s+(.*)\:/);if(h&&h[1]&&yz.includes(h[1].trim())){const m=r[l+1];r.splice(l,m&&m.type==="whitespace"?2:1)}const p=c.data.match(/\#ifdef\s+(.*)/);p&&p[1]&&yz.includes(p[1].trim())&&(c.data="#if 1");const f=c.data.match(/\#ifndef\s+(.*)/);f&&f[1]&&yz.includes(f[1].trim())&&(c.data="#if 0")}}return tCt(t,XEt(r))}function eCt(t){return null}function tCt(t,e){return e}const iCt=4294967295;let rCt=class{constructor(e,i,r,s,n=new Map){this._context=e,this._locations=s,this._uniformBlockBindings=n,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),i.length===0&&console.error("Shaders source should not be empty!"),this._context.type===Mt.WEBGL2&&(i=Ope(i,ku.VERTEX_SHADER),r=Ope(r,ku.FRAGMENT_SHADER)),this._vShader=Rpe(this._context,ku.VERTEX_SHADER,i),this._fShader=Rpe(this._context,ku.FRAGMENT_SHADER,r),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(Wn.Shader,this),$q()&&(this.vertexShader=i,this.fragmentShader=r);const o=this._context.gl,a=o.createProgram();if(o.attachShader(a,this._vShader),o.attachShader(a,this._fShader),this._locations.forEach((l,c)=>o.bindAttribLocation(a,l,c)),o.linkProgram(a),$q()&&!o.getProgramParameter(a,o.LINK_STATUS)&&console.error(`Could not link shader
validated: ${o.getProgramParameter(a,o.VALIDATE_STATUS)}, gl error ${o.getError()}, vertex: ${o.getShaderParameter(this._vShader,o.COMPILE_STATUS)}, fragment: ${o.getShaderParameter(this._fShader,o.COMPILE_STATUS)}, info log: ${o.getProgramInfoLog(a)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===Mt.WEBGL2){const l=o;for(const[c,h]of this._uniformBlockBindings){const p=l.getUniformBlockIndex(a,c);p<iCt&&l.uniformBlockBinding(a,p,h)}}this._glName=a,this._context.instanceCounter.increment(Wn.Program,this)}get glName(){return this._glName}get hasGLName(){return v(this._glName)}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return e==null||C(this.glName)?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl;this._vShader&&(e.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(Wn.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(Wn.Program,this))}ref(){++this._refCount}_getUniformLocation(e){return this._nameToUniformLocation[e]===void 0&&v(this.glName)&&(this._nameToUniformLocation[e]=this._context.gl.getUniformLocation(this.glName,e)),this._nameToUniformLocation[e]}hasUniform(e){return this._getUniformLocation(e)!==null}setUniform1i(e,i){const r=this._nameToUniform1[e];r!==void 0&&i===r||(this._context.gl.uniform1i(this._getUniformLocation(e),i),this._nameToUniform1[e]=i)}setUniform1iv(e,i){Pf(this._nameToUniform1v,e,i)&&this._context.gl.uniform1iv(this._getUniformLocation(e),i)}setUniform2iv(e,i){Pf(this._nameToUniform2,e,i)&&this._context.gl.uniform2iv(this._getUniformLocation(e),i)}setUniform3iv(e,i){Pf(this._nameToUniform3,e,i)&&this._context.gl.uniform3iv(this._getUniformLocation(e),i)}setUniform4iv(e,i){Pf(this._nameToUniform4,e,i)&&this._context.gl.uniform4iv(this._getUniformLocation(e),i)}setUniform1f(e,i){const r=this._nameToUniform1[e];r!==void 0&&i===r||(this._context.gl.uniform1f(this._getUniformLocation(e),i),this._nameToUniform1[e]=i)}setUniform1fv(e,i){Pf(this._nameToUniform1v,e,i)&&this._context.gl.uniform1fv(this._getUniformLocation(e),i)}setUniform2f(e,i,r){const s=this._nameToUniform2.get(e);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),this._nameToUniform2.set(e,[i,r])):i===s[0]&&r===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),s[0]=i,s[1]=r)}setUniform2fv(e,i){Pf(this._nameToUniform2,e,i)&&this._context.gl.uniform2fv(this._getUniformLocation(e),i)}setUniform3f(e,i,r,s){const n=this._nameToUniform3.get(e);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,s),this._nameToUniform3[e]=[i,r,s]):i===n[0]&&r===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,s),n[0]=i,n[1]=r,n[2]=s)}setUniform3fv(e,i){Pf(this._nameToUniform3,e,i)&&this._context.gl.uniform3fv(this._getUniformLocation(e),i)}setUniform4f(e,i,r,s,n){const o=this._nameToUniform4.get(e);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,s,n),this._nameToUniform4.set(e,[i,r,s,n])):o!==void 0&&i===o[0]&&r===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,s,n),o[0]=i,o[1]=r,o[2]=s,o[3]=n)}setUniform4fv(e,i){Pf(this._nameToUniform4,e,i)&&this._context.gl.uniform4fv(this._getUniformLocation(e),i)}setUniformMatrix3fv(e,i,r=!1){Pf(this._nameToUniformMatrix3,e,i)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(e),r,i)}setUniformMatrix4fv(e,i,r=!1){Pf(this._nameToUniformMatrix4,e,i)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(e),r,i)}stop(){}};function Rpe(t,e,i){const r=t.gl,s=r.createShader(e);return r.shaderSource(s,i),r.compileShader(s),$q()&&!r.getShaderParameter(s,r.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===ku.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(r.getShaderInfoLog(s)),console.error(sCt(i))),s}function sCt(t){let e=2;return t.replace(/\n/g,()=>`
`+nCt(e++)+":")}function nCt(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function Pf(t,e,i){const r=t.get(e);return r?AY(r,i):(t.set(e,Array.from(i)),!0)}let oCt=class{constructor(e){this._rctx=e,this._store=new _A}dispose(){this._store.forEach(e=>e.forEach(i=>i.dispose())),this._store.clear()}acquire(e,i,r,s){const n=this._store.get(e,i);if(v(n))return n.ref(),n;const o=new rCt(this._rctx,e,i,r,s);return o.ref(),this._store.set(e,i,o),o}get test(){let e=0;return this._store.forEach(i=>i.forEach(r=>e+=r.hasGLName?2:1)),{cachedWebGLObjects:e}}},BI=class{constructor(){this._result=!1}dispose(){this._program=ft(this._program)}get result(){return v(this._program)&&(this._result=this._test(this._program),this.dispose()),this._result}},aCt=class extends BI{constructor(e){super(),this._rctx=e,this._dummyProgram=null,this._rctx.type===Mt.WEBGL2&&de("mac")&&de("chrome")&&(this._program=this._prepareProgram(),this._dummyProgram=this._prepareDummyProgram())}dispose(){var e;super.dispose(),(e=this._dummyProgram)==null||e.dispose(),this._dummyProgram=null}_test(e){const i=this._rctx;i.resetState();const r=new Bs(i,{colorTarget:gs.TEXTURE,depthStencilTarget:Di.NONE},{target:Pt.TEXTURE_2D,wrapMode:kt.CLAMP_TO_EDGE,pixelFormat:it.RGBA,dataType:Ht.UNSIGNED_BYTE,samplingMode:gt.NEAREST,width:1,height:1}),s=Yi.createIndex(this._rctx,Fi.STATIC_DRAW,new Uint8Array([0]));i.bindFramebuffer(r),i.setViewport(0,0,1,1),i.useProgram(this._dummyProgram),i.bindBuffer(s,Bt.ELEMENT_ARRAY_BUFFER),i.drawElements(jt.POINTS,1,wt.UNSIGNED_BYTE,0),i.useProgram(e),i.bindVAO(null),i.drawArrays(jt.TRIANGLES,0,258);const n=new Uint8Array(4);return r.readPixels(0,0,1,1,it.RGBA,Ht.UNSIGNED_BYTE,n),r.dispose(),s.dispose(),n[0]===255}_prepareProgram(){const i=`
    precision highp float;

    varying float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${x.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,r=`
    precision highp float;

    varying float triangleId;

    void main(void) {
      gl_FragColor = triangleId == ${x.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(i,r,new Map([]))}_prepareDummyProgram(){const e=`
    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,i=`
    void main(void) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`;return this._rctx.programCache.acquire(e,i,new Map([]))}},lCt=class extends BI{constructor(e){super(),this._rctx=e,this._program=Mpe(this._rctx,!1),this._obfuscated=Mpe(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=ft(this._obfuscated)}_test(e){if(de("force-double-precision-obfuscation"))return!0;if(C(this._obfuscated))return!1;const i=this._runProgram(e),r=this._runProgram(this._obfuscated);return i!==0&&(r===0||i/r>5)}_runProgram(e){const i=this._rctx;i.resetState();const r=new Bs(i,{colorTarget:gs.TEXTURE,depthStencilTarget:Di.NONE},{target:Pt.TEXTURE_2D,wrapMode:kt.CLAMP_TO_EDGE,pixelFormat:it.RGBA,dataType:Ht.UNSIGNED_BYTE,samplingMode:gt.NEAREST,width:1,height:1}),s=Yi.createVertex(i,Fi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),n=new vd(i,new Map([["position",0]]),{geometry:[new jo("position",2,wt.UNSIGNED_SHORT,0,4)]},{geometry:s}),o=Xe(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),a=Xe(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),l=new Float32Array(6);xW(o,l,3);const c=new Float32Array(6);xW(a,c,3),i.useProgram(e),e.setUniform3f("u_highA",l[0],l[2],l[4]),e.setUniform3f("u_lowA",l[1],l[3],l[5]),e.setUniform3f("u_highB",c[0],c[2],c[4]),e.setUniform3f("u_lowB",c[1],c[3],c[5]),i.bindFramebuffer(r),i.setViewport(0,0,1,1),i.bindVAO(n),i.drawArrays(jt.TRIANGLE_STRIP,0,4);const h=new Uint8Array(4);r.readPixels(0,0,1,1,it.RGBA,Ht.UNSIGNED_BYTE,h),n.dispose(!1),s.dispose(),r.dispose();const p=(o[2]-a[2])/25,f=iee(h);return Math.abs(p-f)}};function Mpe(t,e){const i=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,r=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `;return t.programCache.acquire(i,r,new Map([["position",0]]))}var Ppe,Ipe,YX={},cCt={get exports(){return YX},set exports(t){YX=t}};Ppe=cCt,(Ipe=function(){var t=function(_){window.console&&window.console.log&&window.console.log(_)},e=function(_){window.console&&window.console.error?window.console.error(_):t(_)},i={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},r=null,s=null;function n(_){if(r==null)for(var b in r={},s={},_)typeof _[b]=="number"&&(r[_[b]]=b,s[b]=_[b])}function o(){if(r==null)throw"WebGLDebugUtils.init(ctx) not called"}function a(_){return o(),r[_]!==void 0}function l(_){o();var b=r[_];return b!==void 0?"gl."+b:"/*UNKNOWN WebGL ENUM*/ 0x"+_.toString(16)}function c(_,b,w,S){var T;if((T=i[_])!==void 0&&(T=T[b])!==void 0&&T[w]){if(typeof T[w]=="object"&&T[w].enumBitwiseOr!==void 0){for(var E=T[w].enumBitwiseOr,O=0,R=[],L=0;L<E.length;++L){var P=s[E[L]];S&P&&(O|=P,R.push(l(P)))}return O===S?R.join(" | "):l(S)}return l(S)}return S===null?"null":S===void 0?"undefined":S.toString()}function h(_,b){for(var w="",S=b.length,T=0;T<S;++T)w+=(T==0?"":", ")+c(_,S,T,b[T]);return w}function p(_,b,w){_.__defineGetter__(w,function(){return b[w]}),_.__defineSetter__(w,function(S){b[w]=S})}function f(_,b,w,S){S=S||_,n(_),b=b||function(P,F,V){for(var B="",G=V.length,te=0;te<G;++te)B+=(te==0?"":", ")+c(F,G,te,V[te]);e("WebGL error "+l(P)+" in "+F+"("+B+")")};var T={};function E(P,F){return function(){w&&w(F,arguments);var V=P[F].apply(P,arguments),B=S.getError();return B!=0&&(T[B]=!0,b(B,F,arguments)),V}}var O={};for(var R in _)if(typeof _[R]=="function")if(R!="getExtension")O[R]=E(_,R);else{var L=E(_,R);O[R]=function(){return f(L.apply(_,arguments),b,w,S)}}else p(O,_,R);return O.getError=function(){for(var P in T)if(T.hasOwnProperty(P)&&T[P])return T[P]=!1,P;return _.NO_ERROR},O}function m(_){var b=_.getParameter(_.MAX_VERTEX_ATTRIBS),w=_.createBuffer();_.bindBuffer(_.ARRAY_BUFFER,w);for(var S=0;S<b;++S)_.disableVertexAttribArray(S),_.vertexAttribPointer(S,4,_.FLOAT,!1,0,0),_.vertexAttrib1f(S,0);_.deleteBuffer(w);var T=_.getParameter(_.MAX_TEXTURE_IMAGE_UNITS);for(S=0;S<T;++S)_.activeTexture(_.TEXTURE0+S),_.bindTexture(_.TEXTURE_CUBE_MAP,null),_.bindTexture(_.TEXTURE_2D,null);for(_.activeTexture(_.TEXTURE0),_.useProgram(null),_.bindBuffer(_.ARRAY_BUFFER,null),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,null),_.bindFramebuffer(_.FRAMEBUFFER,null),_.bindRenderbuffer(_.RENDERBUFFER,null),_.disable(_.BLEND),_.disable(_.CULL_FACE),_.disable(_.DEPTH_TEST),_.disable(_.DITHER),_.disable(_.SCISSOR_TEST),_.blendColor(0,0,0,0),_.blendEquation(_.FUNC_ADD),_.blendFunc(_.ONE,_.ZERO),_.clearColor(0,0,0,0),_.clearDepth(1),_.clearStencil(-1),_.colorMask(!0,!0,!0,!0),_.cullFace(_.BACK),_.depthFunc(_.LESS),_.depthMask(!0),_.depthRange(0,1),_.frontFace(_.CCW),_.hint(_.GENERATE_MIPMAP_HINT,_.DONT_CARE),_.lineWidth(1),_.pixelStorei(_.PACK_ALIGNMENT,4),_.pixelStorei(_.UNPACK_ALIGNMENT,4),_.pixelStorei(_.UNPACK_FLIP_Y_WEBGL,!1),_.pixelStorei(_.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),_.UNPACK_COLORSPACE_CONVERSION_WEBGL&&_.pixelStorei(_.UNPACK_COLORSPACE_CONVERSION_WEBGL,_.BROWSER_DEFAULT_WEBGL),_.polygonOffset(0,0),_.sampleCoverage(1,!1),_.scissor(0,0,_.canvas.width,_.canvas.height),_.stencilFunc(_.ALWAYS,0,4294967295),_.stencilMask(4294967295),_.stencilOp(_.KEEP,_.KEEP,_.KEEP),_.viewport(0,0,_.canvas.width,_.canvas.height),_.clear(_.COLOR_BUFFER_BIT|_.DEPTH_BUFFER_BIT|_.STENCIL_BUFFER_BIT);_.getError(););}function y(_){var b,w,S=[],T=[],E={},O=1,R=!1,L=[],P=0,F=0,V=!1,B=0,G={};function te(X){return typeof X=="function"?X:function(pe){X.handleEvent(pe)}}_.getContext=(w=_.getContext,function(){var X=w.apply(_,arguments);if(X instanceof WebGLRenderingContext){if(X!=b){if(b)throw"got different context";E=Q(b=X)}return E}return X});var se=function(X){S.push(te(X))},ie=function(X){T.push(te(X))};function H(X){var pe=X.addEventListener;X.addEventListener=function(ye,xe,De){switch(ye){case"webglcontextlost":se(xe);break;case"webglcontextrestored":ie(xe);break;default:pe.apply(X,arguments)}}}function $(){for(var X=Object.keys(G),pe=0;pe<X.length;++pe)delete G[X]}function N(){++F,R||P==F&&_.loseContext()}function U(X,pe){var ye=X[pe];return function(){if(N(),!R)return ye.apply(X,arguments)}}function q(){for(var X=0;X<L.length;++X){var pe=L[X];pe instanceof WebGLBuffer?b.deleteBuffer(pe):pe instanceof WebGLFramebuffer?b.deleteFramebuffer(pe):pe instanceof WebGLProgram?b.deleteProgram(pe):pe instanceof WebGLRenderbuffer?b.deleteRenderbuffer(pe):pe instanceof WebGLShader?b.deleteShader(pe):pe instanceof WebGLTexture&&b.deleteTexture(pe)}}function Y(X){return{statusMessage:X,preventDefault:function(){V=!0}}}return H(_),_.loseContext=function(){if(!R){for(R=!0,P=0,++O;b.getError(););$(),G[b.CONTEXT_LOST_WEBGL]=!0;var X=Y("context lost"),pe=S.slice();setTimeout(function(){for(var ye=0;ye<pe.length;++ye)pe[ye](X);B>=0&&setTimeout(function(){_.restoreContext()},B)},0)}},_.restoreContext=function(){R&&T.length&&setTimeout(function(){if(!V)throw"can not restore. webglcontestlost listener did not call event.preventDefault";q(),m(b),R=!1,F=0,V=!1;for(var X=T.slice(),pe=Y("context restored"),ye=0;ye<X.length;++ye)X[ye](pe)},0)},_.loseContextInNCalls=function(X){if(R)throw"You can not ask a lost contet to be lost";P=F+X},_.getNumCalls=function(){return F},_.setRestoreTimeout=function(X){B=X},_;function Q(X){for(var pe in X)typeof X[pe]=="function"?E[pe]=U(X,pe):p(E,X,pe);E.getError=function(){if(N(),!R)for(;Pe=b.getError();)G[Pe]=!0;for(var Pe in G)if(G[Pe])return delete G[Pe],Pe;return E.NO_ERROR};for(var ye=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],xe=0;xe<ye.length;++xe){var De=ye[xe];E[De]=function(Pe){return function(){if(N(),R)return null;var Ye=Pe.apply(X,arguments);return Ye.__webglDebugContextLostId__=O,L.push(Ye),Ye}}(X[De])}var rt=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(xe=0;xe<rt.length;++xe)De=rt[xe],E[De]=function(Pe){return function(){return N(),R?null:Pe.apply(X,arguments)}}(E[De]);var qe=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(xe=0;xe<qe.length;++xe)De=qe[xe],E[De]=function(Pe){return function(){return N(),!R&&Pe.apply(X,arguments)}}(E[De]);return E.checkFramebufferStatus=function(Pe){return function(){return N(),R?E.FRAMEBUFFER_UNSUPPORTED:Pe.apply(X,arguments)}}(E.checkFramebufferStatus),E.getAttribLocation=function(Pe){return function(){return N(),R?-1:Pe.apply(X,arguments)}}(E.getAttribLocation),E.getVertexAttribOffset=function(Pe){return function(){return N(),R?0:Pe.apply(X,arguments)}}(E.getVertexAttribOffset),E.isContextLost=function(){return R},E}}return{init:n,mightBeEnum:a,glEnumToString:l,glFunctionArgToString:c,glFunctionArgsToString:h,makeDebugContext:f,makeLostContextSimulatingCanvas:y,resetToInitialState:m}}())!==void 0&&(Ppe.exports=Ipe);let uCt=class extends BI{constructor(e){var s,n,o,a,l;if(super(),this._rctx=e,!e.gl)return;if(e.type===Mt.WEBGL1)return void(this._result=!(!((s=e.capabilities.textureFloat)!=null&&s.textureFloat)||!((n=e.capabilities.colorBufferFloat)!=null&&n.textureFloat)));if(!((o=e.capabilities.textureFloat)!=null&&o.textureFloat&&((a=e.capabilities.colorBufferFloat)!=null&&a.textureFloat)&&((l=e.capabilities.colorBufferFloat)!=null&&l.floatBlend)))return;const i=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}_test(e){const i=this._rctx,r=new Bs(i,{colorTarget:gs.TEXTURE,depthStencilTarget:Di.NONE},{target:Pt.TEXTURE_2D,wrapMode:kt.CLAMP_TO_EDGE,pixelFormat:it.RGBA,dataType:Ht.FLOAT,internalFormat:Lt.RGBA32F,samplingMode:gt.NEAREST,width:1,height:1}),s=Yi.createVertex(i,Fi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),n=new vd(i,new Map([["a_pos",0]]),{geometry:[new jo("a_pos",2,wt.UNSIGNED_SHORT,0,4)]},{geometry:s});i.useProgram(e);const o=i.getBoundFramebufferObject(),{x:a,y:l,width:c,height:h}=i.getViewport();i.bindFramebuffer(r),i.setViewport(0,0,1,1),i.bindVAO(n),i.drawArrays(jt.TRIANGLE_STRIP,0,4);const p=Qt({blending:iAe});i.setPipelineState(p),i.drawArrays(jt.TRIANGLE_STRIP,0,4),YX.init(i);const f=i.gl.getError();return i.setViewport(a,l,c,h),i.bindFramebuffer(o),n.dispose(!1),s.dispose(),r.dispose(),f!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}},hCt=class extends BI{constructor(e){super(),this._rctx=e;const i=`
      precision highp float;
      attribute vec2 a_pos;
      uniform highp sampler2D u_texture;
      varying vec4 v_color;

      float getBit(in float bitset, in int bitIndex) {
        float offset = pow(2.0, float(bitIndex));
        return mod(floor(bitset / offset), 2.0);
      }

      void main() {
        vec4 value = texture2D(u_texture, vec2(0.0));
        float bit = getBit(value.x * 255.0, 1);

        v_color = bit * vec4(1.0);
        gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
      }
      `,r=`
      precision highp float;
      varying vec4 v_color;

      void main() {
        gl_FragColor = v_color;
      }
      `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}_test(e){const i=this._rctx,r=new Bs(i,{colorTarget:gs.TEXTURE,depthStencilTarget:Di.NONE},{target:Pt.TEXTURE_2D,wrapMode:kt.CLAMP_TO_EDGE,pixelFormat:it.RGBA,dataType:Ht.UNSIGNED_BYTE,samplingMode:gt.NEAREST,width:1,height:1}),s=new Uint8Array(4),n=Yi.createVertex(i,Fi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new vd(i,new Map([["a_position",0]]),{geometry:[new jo("a_position",2,wt.SHORT,0,4)]},{geometry:n});i.useProgram(e);const a=new xt(i,{target:Pt.TEXTURE_2D,wrapMode:kt.CLAMP_TO_EDGE,pixelFormat:it.RGBA,dataType:Ht.UNSIGNED_BYTE,samplingMode:gt.NEAREST,width:1,height:1},new Uint8Array([2,255,0,0]));e.setUniform1i("u_texture",0),i.bindTexture(a,0);const l=i.getBoundFramebufferObject();i.bindFramebuffer(r),i.useProgram(e);const{x:c,y:h,width:p,height:f}=i.getViewport();i.setViewport(0,0,1,1),i.bindVAO(o),i.drawArrays(jt.TRIANGLE_STRIP,0,4),i.setViewport(c,h,p,f),r.readPixels(0,0,1,1,it.RGBA,Ht.UNSIGNED_BYTE,s),o.dispose(!1),n.dispose(),r.dispose();const m=s[0]!==255||s[1]!==255||s[2]!==255||s[3]!==255;return m&&oe.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${s[0]}.${s[1]}.${s[2]}.${s[3]}]`),i.bindFramebuffer(l),m}};const DBt={geometry:[new jo("a_pos",2,wt.BYTE,0,2)]},NBt={geometry:[new jo("a_pos",2,wt.BYTE,0,4),new jo("a_tex",2,wt.BYTE,2,4)]},dCt={geometry:[new jo("a_pos",2,wt.UNSIGNED_SHORT,0,4)]};let pCt=class extends BI{constructor(e){super(),this._rctx=e,this._image=new Image,this._image.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",this._image.width=5,this._image.height=5,this._image.decode();const i=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
    precision highp float;

    varying vec2 v_uv;
    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}dispose(){super.dispose(),this._image.src=""}_test(e){const i=this._rctx;if(!i.gl)return e.dispose(),!0;const r=new Bs(i,{colorTarget:gs.TEXTURE,depthStencilTarget:Di.NONE},{target:Pt.TEXTURE_2D,wrapMode:kt.CLAMP_TO_EDGE,pixelFormat:it.RGBA,dataType:Ht.UNSIGNED_BYTE,samplingMode:gt.NEAREST,width:1,height:1}),s=Yi.createVertex(i,Fi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),n=new vd(i,new Map([["a_pos",0]]),dCt,{geometry:s}),o=new xt(i,{dataType:Ht.UNSIGNED_BYTE,pixelFormat:it.RGBA,preMultiplyAlpha:!1,wrapMode:kt.CLAMP_TO_EDGE,samplingMode:gt.LINEAR},this._image);i.useProgram(e),i.bindTexture(o,0),e.setUniform1i("u_texture",0);const a=i.getBoundFramebufferObject(),{x:l,y:c,width:h,height:p}=i.getViewport();i.bindFramebuffer(r),i.setViewport(0,0,1,1),i.setClearColor(0,0,0,0),i.setBlendingEnabled(!1),i.clearSafe(Vr.COLOR_BUFFER_BIT),i.bindVAO(n),i.drawArrays(jt.TRIANGLE_STRIP,0,4);const f=new Uint8Array(4);return r.readPixels(0,0,1,1,it.RGBA,Ht.UNSIGNED_BYTE,f),n.dispose(!1),s.dispose(),r.dispose(),o.dispose(),i.setViewport(l,c,h,p),i.bindFramebuffer(a),f[0]!==255}},fCt=class{constructor(e){this.rctx=e,this.floatBufferBlend=new uCt(e),this.svgPremultipliesAlpha=new pCt(e),this.doublePrecisionRequiresObfuscation=new lCt(e),this.ignoresSamplerPrecision=new hCt(e),this.drawArraysRequiresIndicesTypeReset=new aCt(e)}dispose(){this.ignoresSamplerPrecision.dispose(),this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function mCt(t,e){if(e.disjointTimerQuery)return null;if(lg(t))return{drawBuffers:t.drawBuffers.bind(t),MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS};if(e.drawBuffers)return null;const i=t.getExtension("WEBGL_draw_buffers");return i?{drawBuffers:i.drawBuffersWEBGL.bind(i),MAX_DRAW_BUFFERS:i.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:i.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function gCt(t){if(lg(t))return t;const e=t.getExtension("ANGLE_instanced_arrays");return e?{drawArraysInstanced:e.drawArraysInstancedANGLE.bind(e),drawElementsInstanced:e.drawElementsInstancedANGLE.bind(e),vertexAttribDivisor:e.vertexAttribDivisorANGLE.bind(e)}:null}function yCt(t,e){if(e.compressedTextureETC)return null;const i=t.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function _Ct(t,e){if(e.compressedTextureS3TC)return null;const i=t.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function vCt(t,e){if(lg(t))return{MIN:t.MIN,MAX:t.MAX};if(e.blendMinMax)return null;{const i=t.getExtension("EXT_blend_minmax");return i?{MIN:i.MIN_EXT,MAX:i.MAX_EXT}:null}}function bCt(t,e){if(e.textureFilterAnisotropic)return null;const i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}function wCt(t,e){if(lg(t))return{textureFloat:!0,textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:t.HALF_FLOAT,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F};if(t instanceof WebGLRenderingContext){const i=!e.textureHalfFloat&&t.getExtension("OES_texture_half_float");return{textureFloat:!e.textureFloat&&!!t.getExtension("OES_texture_float"),textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!!i,textureHalfFloatLinear:!e.textureHalfFloatLinear&&!!t.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:i?i.HALF_FLOAT_OES:void 0}}return null}function xCt(t,e){if(lg(t)){const i=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),r=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}if(t instanceof WebGLRenderingContext){const i=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float"),r=!e.colorBufferFloat&&t.getExtension("WEBGL_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,RGBA16F:i?i.RGBA16F_EXT:void 0,RGB16F:i?i.RGB16F_EXT:void 0,RGBA32F:r?r.RGBA32F_EXT:void 0}:null}return null}function VO(t,e,i,r,s){if(r&&lg(t))return!0;if(e[i])return!1;for(const n of s)if(t.getExtension(n))return!0;return!1}function TCt(t,e){if(!lg(t)||e.textureNorm16)return null;const i=t.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}function SCt(t,e){const i=e.loseContext&&t.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}function ECt(t,e){if(lg(t))return{createVertexArray:t.createVertexArray.bind(t),deleteVertexArray:t.deleteVertexArray.bind(t),bindVertexArray:t.bindVertexArray.bind(t)};if(e.vao)return null;const i=t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object");return i?{createVertexArray:i.createVertexArrayOES.bind(i),deleteVertexArray:i.deleteVertexArrayOES.bind(i),bindVertexArray:i.bindVertexArrayOES.bind(i)}:null}let CCt=class{constructor(e,i){this._gl=e,this._instancing=null,this._vertexArrayObject=null,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._textureFloat=null,this._colorBufferFloat=null,this._minMaxBlending=null,this._loseContext=null,this._drawBuffers=null,this._textureNorm16=null,this._depthTexture=null,this._standardDerivatives=null,this._shaderTextureLOD=null,this._fragDepth=null,this._textureFloatLinear=null,this._disabledExtensions=i.disabledExtensions||{},this._debugWebGLExtensions=i.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=mCt(this._gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=gCt(this._gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=ECt(this._gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=yCt(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=_Ct(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=bCt(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=AEt(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=wCt(this._gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=xCt(this._gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=vCt(this._gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=VO(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get standardDerivatives(){return this._standardDerivatives===null&&(this._standardDerivatives=VO(this._gl,this._disabledExtensions,"standardDerivatives",!0,["OES_standard_derivatives"])),this._standardDerivatives}get shaderTextureLOD(){return this._shaderTextureLOD===null&&(this._shaderTextureLOD=VO(this._gl,this._disabledExtensions,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),this._shaderTextureLOD}get fragDepth(){return this._fragDepth===null&&(this._fragDepth=VO(this._gl,this._disabledExtensions,"fragDepth",!0,["EXT_frag_depth"])),this._fragDepth}get loseContext(){return this._loseContext||(this._loseContext=SCt(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=TCt(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=VO(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(e){return this[e]}},ACt=class{constructor(e,i){this.gl=e,this.instanceCounter=new $Et,this.programCache=new oCt(this),this._state=new _pe,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=lg(e)?Mt.WEBGL2:Mt.WEBGL1,this._loadExtensions(),this.configure(i)}get gl2(){return this.type===Mt.WEBGL1?null:this.gl}configure(e){this._capabilities=new CCt(this.gl,e),this._parameters=this._loadParameters(e);const i=this.gl.getParameter(this.gl.VIEWPORT);this._state=new _pe,this._state.viewport={x:i[0],y:i[1],width:i[2],height:i[3]},this._stateTracker=new Ftt({setBlending:r=>{if(r){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(r.opRgb,r.opAlpha),this.setBlendFunctionSeparate(r.srcRgb,r.dstRgb,r.srcAlpha,r.dstAlpha);const s=r.color;this.setBlendColor(s.r,s.g,s.b,s.a)}else this.setBlendingEnabled(!1)},setCulling:r=>{r?(this.setFaceCullingEnabled(!0),this.setCullFace(r.face),this.setFrontFace(r.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:r=>{r?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(r.factor,r.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:r=>{r?(this.setDepthTestEnabled(!0),this.setDepthFunction(r.func)):this.setDepthTestEnabled(!1)},setStencilTest:r=>{if(r){this.setStencilTestEnabled(!0);const s=r.function;this.setStencilFunction(s.func,s.ref,s.mask);const n=r.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:r=>{r?(this.setDepthWriteEnabled(!0),this.setDepthRange(r.zNear,r.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:r=>{r?this.setColorMask(r.r,r.g,r.b,r.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:r=>{r?this.setStencilWriteMask(r.mask):this.setStencilWriteMask(0)}}),this.enforceState(),ft(this._driverTest),this._driverTest=new fCt(this)}dispose(){ft(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(Bt.ARRAY_BUFFER),this.unbindBuffer(Bt.ELEMENT_ARRAY_BUFFER),this.type===Mt.WEBGL2&&(this.unbindBuffer(Bt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Bt.PIXEL_PACK_BUFFER),this.unbindBuffer(Bt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Bt.COPY_READ_BUFFER),this.unbindBuffer(Bt.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,$u()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var e;(e=this._state.program)==null||e.stop(),this._state.program=null}externalTextureUnitUpdate(e,i){for(let r=0;r<e.length;++r)this._state.textureUnitMap[e[r]]=null;i>=0&&(this._state.activeTexture=i)}externalVertexArrayObjectUpdate(){const e=this.capabilities.vao;e&&(e.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,i,r,s){e===this._state.blendColor.r&&i===this._state.blendColor.g&&r===this._state.blendColor.b&&s===this._state.blendColor.a||(this.gl.blendColor(e,i,r,s),this._state.blendColor.r=e,this._state.blendColor.g=i,this._state.blendColor.b=r,this._state.blendColor.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(e,i){e===this._state.blendFunction.srcRGB&&i===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,i),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=i,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,i,r,s){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===r&&this._state.blendFunction.dstRGB===i&&this._state.blendFunction.dstAlpha===s||(this.gl.blendFuncSeparate(e,i,r,s),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,i){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===i||(this.gl.blendEquationSeparate(e,i),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=i,this._stateTracker.invalidateBlending())}setColorMask(e,i,r,s){this._state.colorMask.r===e&&this._state.colorMask.g===i&&this._state.colorMask.b===r&&this._state.colorMask.a===s||(this.gl.colorMask(e,i,r,s),this._state.colorMask.r=e,this._state.colorMask.g=i,this._state.colorMask.b=r,this._state.colorMask.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(e,i,r,s){this._state.clearColor.r===e&&this._state.clearColor.g===i&&this._state.clearColor.b===r&&this._state.clearColor.a===s||(this.gl.clearColor(e,i,r,s),this._state.clearColor.r=e,this._state.clearColor.g=i,this._state.clearColor.b=r,this._state.clearColor.a=s)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,i){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===i||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=i,this.gl.polygonOffset(e,i),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,i,r,s){this._state.scissorRect.x===e&&this._state.scissorRect.y===i&&this._state.scissorRect.width===r&&this._state.scissorRect.height===s||(this.gl.scissor(e,i,r,s),this._state.scissorRect.x=e,this._state.scissorRect.y=i,this._state.scissorRect.width=r,this._state.scissorRect.height=s)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,i){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===i||(this.gl.depthRange(e,i),this._state.depthRange.zNear=e,this._state.depthRange.zFar=i,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,i,r){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===r||(this.gl.stencilFunc(e,i,r),this._state.stencilFunction.face=Dp.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,i,r,s){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===i&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===s||(this.gl.stencilFuncSeparate(e,i,r,s),this._state.stencilFunction.face=e,this._state.stencilFunction.func=i,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,i,r){this._state.stencilOperation.face===Dp.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===r||(this.gl.stencilOp(e,i,r),this._state.stencilOperation.face=Dp.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,i,r,s){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===i&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===s||(this.gl.stencilOpSeparate(e,i,r,s),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=i,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,i=!1){const r=this._state.activeTexture;return e>=0&&(i||e!==this._state.activeTexture)&&(this.gl.activeTexture(t9+e),this._state.activeTexture=e),r}clear(e){e&&this.gl.clear(e)}clearSafe(e,i=255){e&&(e&Vr.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),e&Vr.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&Vr.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(i),this.gl.clear(e))}drawArrays(e,i,r){if($u()&&(this._numOfDrawCalls++,this._numOfTriangles+=$pe(e,r)),this.gl.drawArrays(e,i,r),$u()){const s=dae(this);s&&console.error("drawArrays:",s)}}drawElements(e,i,r,s){if($u()&&(this._numOfDrawCalls++,this._numOfTriangles+=$pe(e,i)),this.gl.drawElements(e,i,r,s),$u()){const n=dae(this);if(n){const o=this.getBoundVAO(),a=o==null?void 0:o.indexBuffer,l=o==null?void 0:o.vertexBuffers,c={indexBuffer:a,vertexBuffers:l},h={mode:e,count:i,type:r,offset:s},p=go(a,y=>y.size)??0,f=s+i,m=p<f?`. Buffer is too small. Attempted to draw index ${f} of ${p}`:"";console.error(`drawElements: ${n}${m}`,{args:h,vao:c})}}}logInfo(){$u()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){$u()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,i,r,s){r=Math.max(Math.round(r),1),s=Math.max(Math.round(s),1);const n=this._state.viewport;n.x===e&&n.y===i&&n.width===r&&n.height===s||(n.x=e,n.y=i,n.width=r,n.height=s,this.gl.viewport(e,i,r,s))}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){var i;this._state.program!==e&&((i=this._state.program)==null||i.stop(),this._state.program=e,this.gl.useProgram((e==null?void 0:e.glName)??null))}bindTexture(e,i,r=!1){(i>=this.parameters.maxTextureImageUnits||i<0)&&console.error("Input texture unit is out of range of available units!");const s=this._state.textureUnitMap[i];return C(e)||e.glName==null?(v(s)&&(this.setActiveTexture(i,r),this.gl.bindTexture(s.descriptor.target,null)),this._state.textureUnitMap[i]=null,s):r||s!==e?(this.setActiveTexture(i,r),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[i]=e,s):(e.isDirty&&(this.setActiveTexture(i,r),e.applyChanges()),s)}unbindTexture(e){if(!C(e))for(let i=0;i<this.parameters.maxTextureImageUnits;i++)this._state.textureUnitMap[i]===e&&(this.bindTexture(null,i),this._state.textureUnitMap[i]=null)}bindFramebuffer(e,i=!1){if(i||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(C(e))return this.gl.bindFramebuffer(oo.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);e.initializeAndBind(oo.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,i,r=!1){const s=i===oo.READ_FRAMEBUFFER,n=s?this._state.readFramebuffer:this._state.drawFramebuffer;(r||n!==e)&&(C(e)?this.gl.bindFramebuffer(i,null):e.initializeAndBind(i),s?this._state.readFramebuffer=Gt(e,null):this._state.drawFramebuffer=Gt(e,null))}blitFramebuffer(e,i,r=0,s=0,n=e.width,o=e.height,a=0,l=0,c=i.width,h=i.height,p=Vr.COLOR_BUFFER_BIT,f=gt.NEAREST){this.bindFramebufferSeparate(e,oo.READ_FRAMEBUFFER),this.bindFramebufferSeparate(i,oo.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(r,s,n,o,a,l,c,h,p,f)}bindBuffer(e,i){if(e)switch(i??(i=e.bufferType),i){case Bt.ARRAY_BUFFER:this._state.vertexBuffer=bc(this.gl,e,i,this._state.vertexBuffer);break;case Bt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=bc(this.gl,e,i,this._state.indexBuffer);break;case Bt.UNIFORM_BUFFER:this._state.uniformBuffer=bc(this.gl,e,i,this._state.uniformBuffer);break;case Bt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=bc(this.gl,e,i,this._state.pixelPackBuffer);break;case Bt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=bc(this.gl,e,i,this._state.pixelUnpackBuffer);break;case Bt.COPY_READ_BUFFER:this._state.copyReadBuffer=bc(this.gl,e,i,this._state.copyReadBuffer);break;case Bt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=bc(this.gl,e,i,this._state.copyWriteBuffer)}}bindRenderbuffer(e){const i=this.gl;e||(i.bindRenderbuffer(i.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(i.bindRenderbuffer(i.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,i){if(i>=this.parameters.maxUniformBufferBindings||i<0)return console.error("Uniform buffer binding point is out of range!"),null;const r=this._state.uniformBufferBindingPoints;let s=r[i];return C(s)&&(s={buffer:null,offset:0,size:0},r[i]=s),s}bindBufferBase(e,i,r){const s=this._getBufferBinding(e,i);C(s)||s.buffer===r&&s.offset===0&&s.size===0||(this.gl.bindBufferBase(e,i,r?r.glName:null),s.buffer=r,s.offset=0,s.size=0)}bindBufferRange(e,i,r,s,n){const o=this._getBufferBinding(e,i);if(!C(o)&&!(o.buffer===r&&o.offset===s&&o.size===n)){if(s%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(e,i,r.glName,s,n),o.buffer=r,o.offset=s,o.size=n}}bindUBO(e,i,r,s){C(i)?this.bindBufferBase(Bt.UNIFORM_BUFFER,e,null):($u()&&(s??i.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),i.initialize(),r!==void 0&&s!==void 0?this.bindBufferRange(Bt.UNIFORM_BUFFER,e,i.buffer,r,s):this.bindBufferBase(Bt.UNIFORM_BUFFER,e,i.buffer))}unbindUBO(e){for(let i=0,r=this._state.uniformBufferBindingPoints.length;i<r;i++){const s=this._state.uniformBufferBindingPoints[i];v(s)&&s.buffer===e.buffer&&this.bindBufferBase(Bt.UNIFORM_BUFFER,i,null)}}unbindBuffer(e){switch(e){case Bt.ARRAY_BUFFER:this._state.vertexBuffer=bc(this.gl,null,e,this._state.vertexBuffer);break;case Bt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=bc(this.gl,null,e,this._state.indexBuffer);break;case Bt.UNIFORM_BUFFER:this._state.uniformBuffer=bc(this.gl,null,e,this._state.uniformBuffer);break;case Bt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=bc(this.gl,null,e,this._state.pixelPackBuffer);break;case Bt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=bc(this.gl,null,e,this._state.pixelUnpackBuffer);break;case Bt.COPY_READ_BUFFER:this._state.copyReadBuffer=bc(this.gl,null,e,this._state.copyReadBuffer);break;case Bt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=bc(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){C(e)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e)}async clientWaitAsync(e=10){const i=this.gl,r=i.fenceSync(Iq.SYNC_GPU_COMMANDS_COMPLETE,0);if(!r)throw new Error("Client wait failed, could not create sync object");let s;this.instanceCounter.increment(Wn.Sync,r),i.flush();do await _x(e),s=i.clientWaitSync(r,0,0);while(s===y5.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(Wn.Sync,r),i.deleteSync(r),s===y5.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=oo.FRAMEBUFFER){return e===oo.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(Bt.ARRAY_BUFFER),this.unbindBuffer(Bt.ELEMENT_ARRAY_BUFFER),this.type===Mt.WEBGL2&&(this.unbindBuffer(Bt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Bt.PIXEL_PACK_BUFFER),this.unbindBuffer(Bt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Bt.COPY_READ_BUFFER),this.unbindBuffer(Bt.COPY_WRITE_BUFFER));for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(Ve.ONE,Ve.ZERO),this.setBlendEquation(qm.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(Dp.BACK),this.setFrontFace(CC.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(Dr.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(Dr.ALWAYS,0,0),this.setStencilOp(ks.KEEP,ks.KEEP,ks.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var n,o,a;const e=this.capabilities.vao;e&&e.bindVertexArray(null);const{gl:i,gl2:r}=this;for(let l=0;l<this.parameters.maxVertexAttributes;l++)i.disableVertexAttribArray(l);if(this._state.vertexBuffer?i.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):i.bindBuffer(Bt.ARRAY_BUFFER,null),this._state.indexBuffer?i.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):i.bindBuffer(Bt.ELEMENT_ARRAY_BUFFER,null),v(r)){this._state.uniformBuffer?r.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):r.bindBuffer(Bt.UNIFORM_BUFFER,null);for(let l=0;l<this._parameters.maxUniformBufferBindings;l++){const c=this._state.uniformBufferBindingPoints[l];if(v(c)){const{buffer:h,offset:p,size:f}=c;h!==null?p===0&&f===0?r.bindBufferBase(Bt.UNIFORM_BUFFER,l,h.glName):r.bindBufferRange(Bt.UNIFORM_BUFFER,l,h.glName,p,f):r.bindBufferBase(Bt.UNIFORM_BUFFER,l,null)}}this._state.pixelPackBuffer?r.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):r.bindBuffer(Bt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?r.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):r.bindBuffer(Bt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?r.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):r.bindBuffer(Bt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?r.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):r.bindBuffer(Bt.COPY_WRITE_BUFFER,null),r.bindFramebuffer(oo.READ_FRAMEBUFFER,null),r.readBuffer(r.BACK),this._state.readFramebuffer&&(r.bindFramebuffer(oo.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),r.readBuffer(Mu.COLOR_ATTACHMENT0)),r.bindFramebuffer(oo.DRAW_FRAMEBUFFER,((n=this._state.drawFramebuffer)==null?void 0:n.glName)??null)}else this._state.readFramebuffer=this._state.drawFramebuffer,i.bindFramebuffer(oo.FRAMEBUFFER,((o=this._state.drawFramebuffer)==null?void 0:o.glName)??null);if(e&&this._state.vertexArrayObject){const l=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(l)}i.useProgram(((a=this._state.program)==null?void 0:a.glName)??null),i.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),i.bindRenderbuffer(i.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?i.enable(this.gl.BLEND):i.disable(this.gl.BLEND),i.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),i.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),i.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),i.clearDepth(this._state.clearDepth),i.clearStencil(this._state.clearStencil),i.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),i.cullFace(this._state.cullFace),i.depthFunc(this._state.depthFunction),i.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),i.depthMask(this._state.depthWrite),i.frontFace(this._state.frontFace),i.lineWidth(1),this._state.faceCulling===!0?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE),i.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?i.enable(i.POLYGON_OFFSET_FILL):i.disable(i.POLYGON_OFFSET_FILL),i.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?i.enable(i.SCISSOR_TEST):i.disable(i.SCISSOR_TEST),i.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),i.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),i.stencilMask(this._state.stencilWriteMask);for(let l=0;l<this.parameters.maxTextureImageUnits;l++){i.activeTexture(t9+l),i.bindTexture(Pt.TEXTURE_2D,null),i.bindTexture(Pt.TEXTURE_CUBE_MAP,null),this.type===Mt.WEBGL2&&(i.bindTexture(Pt.TEXTURE_3D,null),i.bindTexture(Pt.TEXTURE_2D_ARRAY,null));const c=this._state.textureUnitMap[l];v(c)&&i.bindTexture(c.descriptor.target,c.glName)}i.activeTexture(t9+this._state.activeTexture);const s=this._state.viewport;i.viewport(s.x,s.y,s.width,s.height),this.resetInfo()}_loadExtensions(){this.type===Mt.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}_loadParameters(e){const i=this.capabilities.textureFilterAnisotropic,r=e.maxAnisotropy??1/0,s=this.type===Mt.WEBGL2,n=this.gl,o={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:i?Math.min(this.gl.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY),r):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:s?n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:s?n.getParameter(n.MAX_VERTEX_UNIFORM_BLOCKS):0,maxFragmentUniformBlocks:s?n.getParameter(n.MAX_FRAGMENT_UNIFORM_BLOCKS):0,maxUniformBlockSize:s?n.getParameter(n.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:s?n.getParameter(n.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:s?n.getParameter(n.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:s?n.getParameter(n.MAX_SAMPLES):1};return xt.TEXTURE_UNIT_FOR_UPDATES=o.maxTextureImageUnits-1,o}};function bc(t,e,i,r){return e?r!==e&&t.bindBuffer(i,e.glName):t.bindBuffer(i,null),e}function $pe(t,e){switch(t){case jt.POINTS:return 2*e;case jt.TRIANGLES:return e/3;case jt.TRIANGLE_STRIP:case jt.TRIANGLE_FAN:return e-2;default:return 0}}let OCt=class extends ACt{constructor(e,i,r){super(e,i),this.newCache=r,this._refCount=1}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}bindTechnique(e,i,r,s){return this.useProgram(e.program),e.bindPipelineState(this,r==null?void 0:r.slot,!!s),e.program.bindPass(i,r),e.program}get test(){return this.programCache.test}},IS=class extends $e{constructor(e,i,r){super({}),this._stage=e,this._techniqueRepository=i,this._rctx=r,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new As,this._frameTask=e.view.resourceController.scheduler.registerTask(Rt.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(Vs.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return C(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(Ree,new Mee)),this._textureTechnique}acquire(e){const i=this._textures.get(e);return i?(i.ref(),Gt(i.loadingPromise,i)):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(i=>{const r=i.texture.frameUpdate(this._rctx,this.textureTechnique,i.previousToken);r>=0&&r!==i.previousToken&&(i.previousToken=r,e=!0)}),e&&this.events.emit("changed",Fs.BACKGROUND)}_createNewRef(e){const i=this._stage.getObject(e);if(C(i))return Ct(i!==void 0),null;const r=i.events.on("unloaded",()=>{r.remove(),this._onTextureUnloaded(e)}),s=new RCt(e,()=>{this._frameTask.schedule(()=>{s.isUnreferenced&&i.unload()})});return this._textures.set(e,s),s.ref(),v(i.glTexture)?(this._updateGLTexture(s,i.glTexture),i.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:i,previousToken:-1}),s):(this._loadingCount++,s.loadingPromise=this._stage.schedule(()=>{const n=i.load(this._rctx,()=>this.textureTechnique),o=l=>(this._loadingCount--,s.loadingPromise=null,this._updateGLTexture(s,l),i.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:i,previousToken:-1}),s),a=l=>(this._loadingCount--,s.loadingPromise=null,ln(l)||oe.getLogger(this.declaredClass).error(l),null);return su(n)?n.then(o,a):o(n)}),s.loadingPromise)}_updateGLTexture(e,i){e.glTexture=i,this.events.emit("changed",Fs.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};u([d()],IS.prototype,"_loadingCount",void 0),u([d()],IS.prototype,"_frameTask",void 0),u([d()],IS.prototype,"updating",null),IS=u([I("esri.views.3d.webgl-engine.lib.TextureRepository")],IS);class RCt{constructor(e,i){this.id=e,this._release=i,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(oe.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}}let gM=class extends $e{constructor(){super(...arguments),this._passParameters=new MCt,this._loading=0}get passParameters(){return this._passParameters}destroy(){this._passParameters.waveNormal=ft(this._passParameters.waveNormal),this._passParameters.wavePertubation=ft(this._passParameters.wavePertubation)}get updating(){return this._loading>0}ensureResources(e){if(this._loading>0)return Ry.LOADING;if(v(this._passParameters.waveNormal)&&v(this._passParameters.wavePertubation))return Ry.LOADED;const i={target:Pt.TEXTURE_2D,pixelFormat:it.RGBA,dataType:Ht.UNSIGNED_BYTE,wrapMode:kt.REPEAT,samplingMode:gt.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,maxAnisotropy:8};return++this._loading,Ky(ir("esri/images/materials/water/normals.jpg")).then(r=>this._passParameters.waveNormal=new xt(e,{...i,width:r.width,height:r.height},r)).catch(r=>oe.getLogger(this.declaredClass).error("Failed to load water material normal texture.",r)).finally(()=>--this._loading),++this._loading,Ky(ir("esri/images/materials/water/perturbation.jpg")).then(r=>this._passParameters.wavePertubation=new xt(e,{...i,width:r.width,height:r.height},r)).catch(r=>oe.getLogger(this.declaredClass).error("Failed to load water material pertubation texture.",r)).finally(()=>--this._loading),Ry.LOADING}};u([d()],gM.prototype,"_loading",void 0),u([d({type:Boolean,readOnly:!0})],gM.prototype,"updating",null),gM=u([I("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],gM);let MCt=class extends yr{};const Lpe=2048,PCt=1.5,ICt=8;function $Ct(t,e){const{format:i,quality:r,rotation:s,disableDecorations:n}=t||{},o=pte(t,e.padding),a=zCt(t,{width:e.width-o.left-o.right,height:e.height-o.top-o.bottom}),{width:l,height:c}=BCt(t,a),h=DPe(i),p=NPe[h];return{format:h,quality:we(r??p,0,100),area:a,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!(!t||!t.ignoreBackground),ignorePadding:!(!t||!t.ignorePadding)}}function LCt(t,e){const i=$Ct(t,e),r=i.area,s=i.width/r.width,n=pte(i,e.padding),o=n.left+n.right,a=n.top+n.bottom,l=e.width-o,c=e.height-a,h=Math.floor(l*s+o),p=Math.floor(c*s+a),f=t&&t.layers?t.layers:[],m=i.ignoreBackground,y=i.ignorePadding;return{framebufferWidth:h,framebufferHeight:p,region:{x:Math.floor(r.x*s)+n.left,y:Math.floor(r.y*s)+n.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:s,layers:f,disableDecorations:i.disableDecorations,ignoreBackground:m,ignorePadding:y,objectAndLayerIdColor:!1}}function HF(t,e,i){const{ctx:r,canvas:s}=$Pe(t,i),n=r.getImageData(0,0,t.width,t.height),o=NCt(s,e);return LPe(s),{dataUrl:o,data:n}}function qF(t,e){const{ctx:i,canvas:r}=$Pe(t,e),s=i.getImageData(0,0,t.width,t.height);return LPe(r),s}function $Pe(t,e){const i=DCt();e.premultipliedAlpha&&qCt(t),i.width=t.width,i.height=t.height;const r=i.getContext("2d",{willReadFrequently:!0});return r.putImageData(t,0,0),e.flipY&&HCt(r),{ctx:r,canvas:i}}function LPe(t){t.width=0,t.height=0}function DCt(){return C(_z)&&(_z=document.createElement("canvas")),_z}let _z=null;function NCt(t,e){const i=WCt[e.format],r=e.quality/100;return t.toDataURL(i,r)}function FCt(t,e){const i=DPe(t),r=NPe[i];return{format:i,quality:we(e??r,0,100)}}function UCt(t,e){return e/Math.max(t[0],t[1])}function VCt(t,e,i,r=0,s=0,n=t.width-r,o=t.height-s,a=!1){const{data:l}=t,{width:c,height:h,data:p}=e,f=n/c,m=o/h,y=Math.ceil(f/2),_=Math.ceil(m/2),b=t.width;for(let w=0;w<h;w++)for(let S=0;S<c;S++){const T=4*(S+(a?h-w-1:w)*c);let E=0,O=0,R=0,L=0,P=0,F=0;const V=(w+.5)*m;for(let B=Math.floor(w*m);B<(w+1)*m;B++){const G=Math.abs(V-(B+.5))/_,te=(S+.5)*f,se=G*G;for(let ie=Math.floor(S*f);ie<(S+1)*f;ie++){const H=Math.abs(te-(ie+.5))/y,$=Math.sqrt(se+H*H);if($>=1)continue;let N=2*$*$*$-3*$*$+1;const U=4*(r+ie+(s+B)*b);F+=N*l[U+3],O+=N,!i&&l[U+3]<255&&(N=N*l[U+3]/255),R+=N*l[U],L+=N*l[U+1],P+=N*l[U+2],E+=N}}p[T]=R/E,p[T+1]=L/E,p[T+2]=P/E,p[T+3]=F/O}return e}function kCt(t,e,i){if(!e)return t;const{framebufferWidth:r,framebufferHeight:s,pixelRatio:n,region:o}=t,a=pte(t,i),l=a.left+a.right,c=a.top+a.bottom,h=r-l,p=s-c,f=Math.min(ICt,Math.min((Lpe-l)/h,(Lpe-c)/p));return f<PCt?t:{...t,framebufferWidth:Math.round(h*f)+l,framebufferHeight:Math.round(p*f)+c,pixelRatio:n*f,resample:{region:{x:Math.round((o.x-a.left)*f)+a.left,y:Math.round((o.y-a.top)*f)+a.top,width:Math.round(o.width*f),height:Math.round(o.height*f)},width:r,height:s}}}function BCt(t,e){if(!t)return e;const i=t.width,r=t.height;if(i!=null&&r!=null)return{width:Math.floor(i),height:Math.floor(r)};if(i==null&&r==null)return e;const s=e.width/e.height;return r==null?{width:Math.floor(i),height:Math.floor(i/s)}:{width:Math.floor(r*s),height:Math.floor(r)}}function zCt(t,e){const i={x:0,y:0,width:e.width,height:e.height};if(t&&t.area){t.area.x!=null&&(i.x=Math.floor(t.area.x)),t.area.y!=null&&(i.y=Math.floor(t.area.y));const r=t.area.width!=null?Math.floor(t.area.width):null,s=t.area.height!=null?Math.floor(t.area.height):null;if(i.width=e.width-i.x,i.height=e.height-i.y,r!=null&&s!=null)i.width=Math.min(i.width,r),i.height=Math.min(i.height,s);else if(r==null&&s!=null){const n=Math.min(i.width,r);i.height=n/i.width*i.height,i.width=n}else if(r!=null&&s==null){const n=Math.min(i.height,s);i.width=n/i.height*i.width,i.height=n}}return GCt(jCt(i,t),e)}function GCt(t,e){const i=Math.floor(Math.max(t.x,0)),r=Math.floor(Math.max(t.y,0)),s={x:i,y:r,width:Math.floor(Math.min(t.width,e.width-i)),height:Math.floor(Math.min(t.height,e.height-r))},n=s.width/s.height,o=t.width/t.height;if(o===n)return s;if(o>n){const c=Math.floor(s.width/o),h=s.height-c;return{x:s.x,y:Math.floor(s.y+h/2),width:s.width,height:c}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}function jCt(t,e){if(!e||e.width==null||e.height==null)return t;const i=e.width/e.height,r=t.width/t.height;if(r===i)return t;if(r<i){const n=Math.floor(t.height*i);return t.x-=(n-t.width)/2,t.width=n,t}const s=Math.floor(t.width/i);return t.y-=(s-t.height)/2,t.height=s,t}function pte(t,e){return!e||t&&t.ignorePadding?YCt:e}function DPe(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return XCt}}function HCt(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function qCt(t){const e=t.data,i=e.length;for(let r=0;r<i;r+=4){const s=e[r+3];if(s!==255&&s>0){const n=255/s;e[r+0]=e[r+0]*n,e[r+1]=e[r+1]*n,e[r+2]=e[r+2]*n}}}const WCt={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},Dpe=98,XCt="png",NPe={png:100,jpg:Dpe,jpeg:Dpe},YCt={top:0,right:0,bottom:0,left:0};let ZCt=class{constructor(e,i){this.viewCamera=e,this.frameHasDecorations=i}},JCt=class{constructor(e,i,r,s){this._rctx=e,this._renderFunctions=i,this._forceCameraHook=r,this._disposeOffscreenBuffers=s,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(Fs.BACKGROUND);const i=qv();return this._screenshotQueue.push({settings:e,resolver:i}),i.promise}update(e,i){for(const r of this._screenshotQueue){if(this._rctx==null){r.resolver.reject();continue}const s={...r.settings,pixelRatio:r.settings.pixelRatio*e.viewCamera.pixelRatio},n=this._renderScreenshot(e,s,i);r.resolver(n)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,i,r){e.width=i.width,e.height=i.height;const s=e.getContext("2d"),n=r.pixelRatio;return s.save(),s.translate(0,i.height),s.scale(1,-1),r.region&&s.translate(-r.region.x,-r.region.y),s.scale(n,n),i=this._renderFunctions.renderOverlay(e,i),s.restore(),i}_readbackScreenshot(e,i){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},i):this._readbackScreenshotImmediate(e,i)}_readbackScreenshotResampled(e,i){const{framebufferWidth:r,framebufferHeight:s,region:n,resample:o}=e,a=this._ensureScreenshotEncodeCanvas();let l=bB(r,s,a);this._rctx.gl.readPixels(0,0,r,s,it.RGBA,wt.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),i(),l=this._renderScreenshotOverlay(a,l,{...e,region:void 0});const c=bB(n.width,n.height,a);return VCt(l,c,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(e,i){const{framebufferHeight:r,region:s}=e,n=this._ensureScreenshotEncodeCanvas(),o=bB(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,r-(s.y+s.height),s.width,s.height,it.RGBA,wt.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),i(),this._renderScreenshotOverlay(n,o,e)}_renderScreenshot(e,i,r){let s=null,n=null;const o=e.viewCamera,{framebufferWidth:a,framebufferHeight:l}=i;let c=!1;const h=i.disableDecorations&&e.frameHasDecorations,p=a!==o.fullWidth||l!==o.fullHeight,f=i.ignorePadding&&o.pixelRatio!==i.pixelRatio,m=p||h||f||i.objectAndLayerIdColor;if(i.objectAndLayerIdColor&&(n=new Bs(this._rctx,{width:a,height:l,colorTarget:gs.TEXTURE,depthStencilTarget:Di.DEPTH_STENCIL_RENDER_BUFFER})),m){const w=o.clone();if(i.ignorePadding){const E=sI(w.padding);for(let O=0;O<4;O++)E[O]=Math.round(E[O]/w.pixelRatio*i.pixelRatio);w.padding=E}w.fullWidth=a,w.fullHeight=l,w.pixelRatio=i.pixelRatio;const S=o.fovX-w.fovX,T=o.fovY-w.fovY;S<0&&S<T?w.fovX=o.fovX:T<0&&T<S&&(w.fovY=o.fovY),this._forceCameraHook(w),c=!0,s=new Bs(this._rctx,{width:w.fullWidth,height:w.fullHeight,colorTarget:gs.TEXTURE,depthStencilTarget:Di.DEPTH_STENCIL_RENDER_BUFFER}),this._renderFunctions.renderScene(s,n,w,i.disableDecorations?zx.OFF:zx.ON,r),this._disposeOffscreenBuffers()}const y=()=>{this._rctx.bindFramebuffer(null),ft(s)},_=this._readbackScreenshot(i,y);y();let b=null;if(i.objectAndLayerIdColor){const w=()=>{this._rctx.bindFramebuffer(null),ft(n)};this._rctx.bindFramebuffer(n),b=this._readbackScreenshot(i,w),this._rctx.bindFramebuffer(null),w()}if(m&&!this._rctx.contextAttributes.alpha)for(let w=3;w<_.data.length;w+=4)_.data[w]=255;if(b&&!this._rctx.contextAttributes.alpha)for(let w=3;w<b.data.length;w+=4)b.data[w]=255;return c&&this._forceCameraHook(o),[_,b]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}},Lo=class extends $e{constructor(e){super({}),this.events=new As,this.waterTextureRepository=new gM,this._magnifierHelper=new PS,this.objectAndLayerIdRenderHelper=de("enable-feature:objectAndLayerId-rendering")?new H2t:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),re(()=>{var r;return(r=this.waterTextureRepository)==null?void 0:r.updating},()=>this.requestRender(),Zt),this._magnifierHelper.events.on("request-render",()=>this.requestRender()),this._stippleTextureRepository=new oOe(this._rctx),this._shaderTechniqueRepository=new eOe({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),this._textureRepository=new IS(e,this._shaderTechniqueRepository,this._rctx),this._textureRepository.events.on("changed",r=>this.requestRender(r)),this._materialRepository=new tOe(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new T2t(this._rctx,this._shaderTechniqueRepository),this.renderer=new Cu(e,this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,r=>this.requestRender(r));const i={renderScene:(r,s,n,o,a)=>this.renderer.render(r,s,{camera:n,contentCamera:n,mode:Mi.IDLE},o,a),requestRenderScene:r=>this.requestRender(r),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(r,s)=>e.options.screenshot.renderOverlay(r,s)};this._screenshotManager=new JCt(this._rctx,i,r=>this.events.emit("force-camera-for-screenshot",r),()=>this.renderer.disposeOffscreenBuffers()),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=Rr(this._frameTask),this._shaderTechniqueRepository=Je(this._shaderTechniqueRepository)}get performanceInfo(){const e=this._rctx.gl;return{renderer:this.renderer.performanceInfo,textureMemory:e.getUsedTextureMemory!==void 0?e.getUsedTextureMemory():void 0,renderbufferMemory:e.getUsedRenderbufferMemory!==void 0?e.getUsedRenderbufferMemory():void 0,VBOMemory:e.getUsedVBOMemory!==void 0?e.getUsedVBOMemory():void 0}}requestRender(e=Fs.UPDATE){this._needsRender=!0,e===Fs.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(i=>i[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,i,r,s,n,o=n){const a=s.constrainWindowSize(i,r,n*s.pixelRatio,o*s.pixelRatio),l=this._ensureDepthBuffer(a);this.renderer.readDepthPixels(s,a,l);let c=Number.MAX_VALUE;for(let h=0;h<a[2]*a[3];h++){const p=O2t(4*h,l,s.nearFar);c>p&&p!==s.nearFar[0]&&p!==s.nearFar[1]&&(c=p)}if(v(e)){const h=e.pickDepth(i*s.pixelRatio,r*s.pixelRatio,s);v(h)&&c>h&&h!==s.nearFar[0]&&h!==s.nearFar[1]&&(c=h)}return c===Number.MAX_VALUE?void 0:c}_ensureDepthBuffer(e){const i=4*e[2]*e[3];return(C(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<i)&&(this._tmpDepthBuffer=new Uint8Array(i)),this._tmpDepthBuffer}async reloadShaders(){RMe(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}_registerFrameTask(e){const i=e.view.state;let r=!1,s=Fs.BACKGROUND,n=!1;const o={preRender:({time:a})=>{r=this.updating,s=this._needsUpdate?Fs.UPDATE:Fs.BACKGROUND,e.commitSyncLayers();const l=a-this._lastAnimationUpdate;if(l>this.renderer.animationTimestep||v(i.forcedAnimationTime)||r||this._needsRender){const c=l/this.renderer.animationTimeDilation,h=new LCe(i.camera,c,i.forcedAnimationTime);this.renderer.updateAnimation(h)&&this.requestRender(Fs.BACKGROUND),this._lastAnimationUpdate=a}},render:({time:a})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&i.camera.fullWidth>0&&i.camera.fullHeight>0){const l=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(null,null,i,zx.ON,a),n=!0,l&&this.renderer.hasWaterReflection&&(this.requestRender(Fs.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:a})=>{const l=new ZCt(i.camera,this.renderer.hasSlicePlane||this._magnifierHelper.enabled);this._textureRepository.update(),this._screenshotManager.update(l,a)},finish:()=>{n&&(this.renderer.finish(i.mode===Mi.IDLE?s:Fs.UPDATE),n=!1)}};this._frameTask=By(o)}_initializeContext(e){const i=e.options;this._canvas=i.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const r={alpha:i.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:i.stencil==null||i.stencil,powerPreference:"high-performance",preserveDrawingBuffer:i.preserveDrawingBuffer??!1},s=ktt("3d",this._canvas,r);if(C(s)){const n=de("esri-force-webgl");oe.getLogger(this.declaredClass).error(n)}else this._rctx=this._newRenderingContext(s,e),this._loadShaderOnlyExtensions(),!i.alpha&&this._rctx.contextAttributes.alpha&&oe.getLogger(this.declaredClass).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&de("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)}_newRenderingContext(e,i){const r={disabledExtensions:i.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:i.options.debugWebGLExtensions||{},maxAnisotropy:8},s=(n,o)=>i.view.resourceController.memoryController.newCache(n,o);return new OCt(e,r,s)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("standardDerivatives"),this._rctx.capabilities.enable("shaderTextureLOD"),this._rctx.capabilities.enable("textureFloat")}getObjectAndLayerIdColor(e){return v(this.objectAndLayerIdRenderHelper)?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e):null}get componentObjectCollection(){return C(this._componentObjectCollection)&&(this._componentObjectCollection=new p2t(this.renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};u([d({type:Boolean,readOnly:!0})],Lo.prototype,"updating",null),u([d({autoDestroy:!0})],Lo.prototype,"_rctx",void 0),u([d({autoDestroy:!0})],Lo.prototype,"_container",void 0),u([d({autoDestroy:!0})],Lo.prototype,"_canvas",void 0),u([d({autoDestroy:!0})],Lo.prototype,"_stippleTextureRepository",void 0),u([d({autoDestroy:!0})],Lo.prototype,"waterTextureRepository",void 0),u([d({autoDestroy:!0})],Lo.prototype,"_magnifierHelper",void 0),u([d({readOnly:!0})],Lo.prototype,"objectAndLayerIdRenderHelper",void 0),u([d({autoDestroy:!0})],Lo.prototype,"_textureRepository",void 0),u([d({autoDestroy:!0})],Lo.prototype,"_compositingHelper",void 0),u([d({autoDestroy:!0,readOnly:!0})],Lo.prototype,"renderer",void 0),u([d({autoDestroy:!0})],Lo.prototype,"_screenshotManager",void 0),u([d()],Lo.prototype,"componentObjectCollection",null),u([d({autoDestroy:!0})],Lo.prototype,"_componentObjectCollection",void 0),u([d()],Lo.prototype,"_needsUpdate",void 0),u([d()],Lo.prototype,"_needsWaterReflectionUpdate",void 0),Lo=u([I("esri.views.3d.webgl-engine.parts.RenderView")],Lo);let Mc=class extends $e{constructor(e){super(e),this._handles=new Ki,this._model=new kF,this._layers=new li,this._asyncChangeSet=new rX,this._syncChangeSet=new rX,this._layerSyncSet=new Set}initialize(){this._set("renderView",new Lo(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(Rt.STAGE,this),this._handles.add(this._frameTask)}destroy(){this._handles.destroy()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){var e;return(e=this.renderView)==null?void 0:e.renderer}add(e){this._model.add(e),Z5(e)&&(e.attachStage(this),this._addLayer(e)),this.renderView.requestRender()}remove(e){C(e)||(this.renderView.requestRender(),this._model.remove(e),Z5(e)&&(this._removeLayer(e),e.detachStage()))}addMany(e){v(e)&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){v(e)&&(this._model.removeMany(e),this.renderView.requestRender())}async load(e,i){C(e)||(Array.isArray(e)||(e=[e]),await Promise.all(e.filter(r=>C(r.glTexture)).map(r=>this.schedule(()=>this._model.has(r)?r.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique):null),i)))}loadImmediate(e){return e.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique)}forEachOfType(e,i){this._model.forEachOfType(e,i)}handleEvent(e,i){this.destroyed||(this._model.dirtySet[e](i),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){this._frameTask.processQueue(e),this._commit(e)}_commit(e){const i=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{if(e.done)return;const s=this._layerSyncSet.has(r.id)||r.updatePolicy===kv.SYNC,n=s?this._syncChangeSet:this._asyncChangeSet;i.commitLayer(r.id,n),this._layerSyncSet.delete(r.id),n.empty||(this.renderer.modify(n,s?ll:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,ll),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{e.done||this._layerSyncSet.has(r.id)||r.updatePolicy!==kv.ASYNC||(i.commitLayer(r.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(i=>{(this._layerSyncSet.has(i.id)||i.updatePolicy===kv.SYNC)&&(e.commitLayer(i.id,this._syncChangeSet),this._layerSyncSet.delete(i.id))});for(const i of this._layerSyncSet)e.commitLayer(i,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,ll),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,ll),this.renderView.requestRender())}schedule(e,i){return this._frameTask.schedule(e,i)}reschedule(e,i){return this._frameTask.reschedule(e,i)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,ll))}addRenderPlugin(e,i,r){const s=this.renderer.renderPlugins.add(e,i,r),n=()=>{whe(i)&&this.view.sceneIntersectionHelper.addIntersectionHandler(i)};if(su(s))return s.then(n);n()}removeRenderPlugin(e){whe(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.renderPlugins.remove(e)}get performanceInfo(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:i=>e._model.test.content.filter(r=>r.type===i).length,model:e._model}}};Mc.DebugSettings={endFrameContentValidation:!1},u([d({constructOnly:!0})],Mc.prototype,"view",void 0),u([d({constructOnly:!0})],Mc.prototype,"options",void 0),u([d({readOnly:!0})],Mc.prototype,"viewingMode",null),u([d({constructOnly:!0})],Mc.prototype,"container",void 0),u([d({constructOnly:!0})],Mc.prototype,"_handles",void 0),u([d({readOnly:!0})],Mc.prototype,"updating",null),u([d({constructOnly:!0})],Mc.prototype,"_model",void 0),u([d({autoDestroy:!0})],Mc.prototype,"renderView",void 0),u([d({readOnly:!0})],Mc.prototype,"renderer",null),u([d({readOnly:!0})],Mc.prototype,"running",null),Mc=u([I("esri.views.3d.webgl-engine.Stage")],Mc);let YBt=class extends p8{constructor(e,i,r,s){super(i,r),this.point=e,this.createGraphic=s}};function FPe(t){return lf(t)&&t.intersector===as.PCL&&!!t.target}let JBt=class extends QSe{constructor(e,i,r,s,n){super(e),this.layerUid=e,this.sublayerUid=i,this.nodeIndex=r,this.componentIndex=s,this.triangleNr=n}},QBt=class extends p8{constructor(e,i,r){super(i,null),this.point=e,this.createVoxelGraphic=r}};function rV(t){return lf(t)&&t.intersector===as.I3S&&!!t.target}function UPe(t){return lf(t)&&t.intersector===as.VOXEL&&!!t.target}function Npe(t,e){var i,r;return f8(t)||m8(t)?VP((i=t.target)==null?void 0:i.object.metadata,e):Bpt(t)?(r=e.map)==null?void 0:r.ground:FPe(t)||rV(t)||xOe(t)||UPe(t)?VP(t.target,e):null}function tzt(t,e){const i=ZX(t,e);return v(i)&&i.type==="graphic"?i.graphic:null}function ZX(t,e){var i;if(C(t))return null;if(f8(t)||m8(t))return Fpe((i=t.target)==null?void 0:i.object.metadata,e);if(FPe(t)){const r=t.target.createGraphic();return{type:"graphic",graphic:r,layer:r.layer}}if(UPe(t)){const r=t.target.createVoxelGraphic();return{type:"graphic",graphic:r,layer:r.layer}}return xOe(t)||Fee(t)?Fpe(t.target,e):rV(t)?KCt(t.target,e):null}function Fpe(t,e){if(C(t)||C(t.graphicUid))return null;const i=VP(t,e);if(C(i))return null;if(i===e.graphics)return C(e.graphicsView)||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid);const r=e.allLayerViews.find(s=>s.layer===i);return!r||r.suspended||C(t.graphicUid)?null:"getHit"in r?r.getHit(t.graphicUid):null}function KCt(t,e){const i=VP(t,e);if(C(i))return null;const r=e.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getGraphicFromIntersectorTarget"in r?eAt(r.getGraphicFromIntersectorTarget(t)):null}function QCt(t,e){const i=VP(t,e);if(C(i))return null;const r=e.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getAABBFromIntersectorTarget"in r?r.getAABBFromIntersectorTarget(t):null}function eAt(t){return v(t)?{type:"graphic",graphic:t,layer:t.layer}:null}function VP(t,e){return!t||C(t.layerUid)?null:v(e.graphicsView)&&t.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.findLayerByUid(t.layerUid)}function izt(t,e){if(f8(t)||m8(t))return Cy(t.target.object.boundingVolumeWorldSpace.bounds);if(Fee(t)){h_e(kD,t.transformation);const i=Math.max(kD[0],kD[1],kD[2]);return t.target.baseBoundingSphere.radius*i}return rV(t)?go(QCt(t.target,e),i=>.5*Jye(i)):null}function rzt(t){return!f8(t)&&!m8(t)&&(Fee(t)?t.target.numLodLevels>1:!!rV(t))}const kD=M();async function tAt(t,e){if(t.type==="2d")return t.hitTest(e);const i=await t.hitTest(e);if(i.results.length===0)return i;const r=i.results[0],s=(r.distance??0)*(1+iAt),n=i.results.findIndex(o=>(o.distance??0)>s);return n!==-1&&(i.results=i.results.slice(0,n)),i}const iAt=.05;let vz,bz;function rAt(t){const e=A2e(t);for(;e.length>1;){const i=Upe(e.shift());if(i.available)return i}return Upe(e.shift())}function Upe(t){switch(t){case Mt.WEBGL1:return sAt();case Mt.WEBGL2:return nAt()}}function sAt(){return vz||(vz=lAt()),vz}function nAt(){return bz||(bz=cAt()),bz}let VPe=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}},oAt=class extends VPe{constructor(){super(...arguments),this.type=Mt.WEBGL1}};class aAt extends VPe{constructor(){super(...arguments),this.type=Mt.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}}function kPe(t,e){var n;if(t===Mt.WEBGL1&&typeof WebGLRenderingContext>"u"||t===Mt.WEBGL2&&typeof WebGL2RenderingContext>"u")return null;const i=document.createElement("canvas");if(!i)return null;let r=_5(i,t,{failIfMajorPerformanceCaveat:!0});if(C(r)&&(r=_5(i,t),v(r)&&(e.majorPerformanceCaveat=!0)),C(r))return r;if(t===Mt.WEBGL1){const o=(n=r.getParameter(r.VERSION))==null?void 0:n.match(/^WebGL\s+([\d.]*)/);if(o){const a=parseFloat(o[1]);e.available=a>=.94}}else e.available=!0;e.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),e.supportsVertexShaderSamplers=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const s=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);return s&&(e.supportsHighPrecisionFragment=s.precision>0),r}function lAt(){const t=new oAt,e=kPe(Mt.WEBGL1,t);return C(e)||(t.supportsElementIndexUint=e.getExtension("OES_element_index_uint")!==null,t.supportsStandardDerivatives=e.getExtension("OES_standard_derivatives")!==null,t.supportsInstancedArrays=e.getExtension("ANGLE_instanced_arrays")!==null,t.supportsTextureFloat=e.getExtension("OES_texture_float")!==null,t.supportsTextureHalfFloat=e.getExtension("OES_texture_half_float")!==null,t.supportsColorBufferFloat=e.getExtension("WEBGL_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=e.getExtension("EXT_color_buffer_half_float")!==null),t}function cAt(){const t=new aAt,e=kPe(Mt.WEBGL2,t);return C(e)||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null),t}function BPe(t){const e=rAt(t);if(!e.available)return new W("webgl:required","WebGL is required but not supported.");if(t==="3d"&&e.majorPerformanceCaveat)return new W("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!e.supportsHighPrecisionFragment)return new W("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!e.supportsVertexShaderSamplers)return new W("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(e.type===Mt.WEBGL1){if(!e.supportsElementIndexUint)return new W("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!e.supportsStandardDerivatives)return new W("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!e.supportsInstancedArrays)return new W("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function uAt(t){return t&&"nodeType"in t}function hAt(t){return t&&typeof t.render=="function"}const Vpe={component:"esri-component"};let mw=class extends $e{constructor(){super(...arguments),this.widget=null}destroy(){this.widget&&this.widget.destroy(),this.node=null}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const i=this._get("node");e!==i&&(e&&e.classList.add(Vpe.component),i&&i.classList.remove(Vpe.component),this._set("node",e))}castNode(e){return e?typeof e=="string"||uAt(e)?(this._set("widget",null),pU(e)):(hAt(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};u([d({dependsOn:[]})],mw.prototype,"id",null),u([d()],mw.prototype,"node",null),u([wi("node")],mw.prototype,"castNode",null),u([d({readOnly:!0})],mw.prototype,"widget",void 0),mw=u([I("esri.views.ui.Component")],mw);const WF=mw,dAt={left:0,top:0,bottom:0,right:0},zPe={bottom:30,top:15,right:15,left:15},wz="manual",Ig="esri-ui",Ll={ui:Ig,corner:`${Ig}-corner`,innerContainer:`${Ig}-inner-container`,manualContainer:`${Ig}-manual-container`,cornerContainer:`${Ig}-corner-container`,topLeft:`${Ig}-top-left`,topRight:`${Ig}-top-right`,bottomLeft:`${Ig}-bottom-left`,bottomRight:`${Ig}-bottom-right`};function pAt(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function xz(t){const e=t,i=typeof e=="object"&&e!==null&&Object.getPrototypeOf(e);return(i===null||i===Object.prototype)&&("component"in e||"index"in e||"position"in e)?t:null}function Tz(t,{top:e,bottom:i,left:r,right:s}){t.style.top=e,t.style.bottom=i,t.style.left=r,t.style.right=s}let em=class extends As.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentToKey=new Map,this._locale=od(),this.view=null,this._applyViewPadding=()=>{const i=this.container;i&&Tz(i,this._toPxPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const i=this._innerContainer;i&&Tz(i,this._toPxPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([re(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,Zt),re(()=>this.padding,this._applyUIPadding,Zt),re(()=>[this.container,this._locale],([e,i])=>{e&&e.setAttribute("lang",i)},Zt),xye(e=>{this._locale=e})])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentToKey.clear()}set container(e){const i=this._get("container");e!==i&&(e&&(e.classList.add(Ll.ui),H7e(e),this._attachContainers(e)),i&&(i.classList.remove(Ll.ui),Tz(i,{top:"",bottom:"",left:"",right:""}),Z0e(i)),this._set("container",e))}get height(){const e=this.get("view.height")||0;if(e===0)return e;const i=this._getViewPadding(),r=i.top+i.bottom;return Math.max(e-r,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...zPe,...e}}get width(){const e=this.get("view.width")||0;if(e===0)return e;const i=this._getViewPadding(),r=i.left+i.right;return Math.max(e-r,0)}add(e,i){let r,s;if(Array.isArray(e))return void e.forEach(o=>this.add(o,i));const n=xz(e);n&&({index:r,position:i,component:e,key:s}=n),i&&typeof i=="object"&&({index:r,key:s,position:i}=i),!e||i&&!this._isValidPosition(i)||this._add(e,i,r,s)}remove(e,i){if(!e)return;if(Array.isArray(e))return e.map(s=>this.remove(s,i));const r=this._find(e);if(r){const s=this._componentToKey;if(s.has(e)&&s.get(e)!==i)return;const n=this._components.indexOf(r);return r.node.parentNode&&r.node.parentNode.removeChild(r.node),this._componentToKey.delete(e),this._components.splice(n,1)[0]}}empty(e){return Array.isArray(e)?e.map(i=>this.empty(i)).reduce((i,r)=>i.concat(r)):(e=e||wz)===wz?Array.prototype.slice.call(this._manualContainer.children).filter(i=>!i.classList.contains(Ll.corner)).map(i=>this.remove(i)):this._isValidPosition(e)?Array.prototype.slice.call(this._cornerNameToContainerLookup[e].children).map(this.remove,this):null}move(e,i){if(Array.isArray(e)&&e.forEach(o=>this.move(o,i)),!e)return;let r;const s=xz(e)||xz(i);if(s&&(r=s.index,i=s.position,e=s.component||e),i&&!this._isValidPosition(i))return;const n=this.remove(e);n&&this.add(n,{position:i,index:r})}find(e){if(!e)return null;const i=this._findById(e);return i&&(i.widget||i.node)}getPosition(e){for(const i in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[i].contains(e))return i;return null}_add(e,i,r,s){e instanceof WF||(e=new WF({node:e})),this._place({component:e,position:i,index:r}),this._components.push(e),s&&this._componentToKey.set(e,s)}_find(e){return e?e instanceof WF?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.get("view.padding")||dAt}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(Ll.innerContainer),e.classList.add(Ll.cornerContainer);const i=document.createElement("div");i.classList.add(Ll.innerContainer),i.classList.add(Ll.manualContainer);const r=document.createElement("div");r.classList.add(Ll.topLeft),r.classList.add(Ll.corner),e.appendChild(r);const s=document.createElement("div");s.classList.add(Ll.topRight),s.classList.add(Ll.corner),e.appendChild(s);const n=document.createElement("div");n.classList.add(Ll.bottomLeft),n.classList.add(Ll.corner),e.appendChild(n);const o=document.createElement("div");o.classList.add(Ll.bottomRight),o.classList.add(Ll.corner),e.appendChild(o),this._innerContainer=e,this._manualContainer=i;const a=bm();this._cornerNameToContainerLookup={"top-left":r,"top-right":s,"bottom-left":n,"bottom-right":o,"top-leading":a?s:r,"top-trailing":a?r:s,"bottom-leading":a?o:n,"bottom-trailing":a?n:o},this._positionNameToContainerLookup={manual:i,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const i=e.component,r=e.position||wz,s=e.index,n=this._positionNameToContainerLookup[r],o=s!=null&&s>-1;if(pAt(i.widget)&&i.widget.startup(),!o)return void n.appendChild(i.node);const a=Array.prototype.slice.call(n.children);if(s===0)return void(n.firstChild?Zie(i.node,n.firstChild):n.appendChild(i.node));s>=a.length?n.appendChild(i.node):Zie(i.node,a[s])}_toPxPosition(e){return{top:this._toPxUnit(e.top),left:this._toPxUnit(e.left),right:this._toPxUnit(e.right),bottom:this._toPxUnit(e.bottom)}}_toPxUnit(e){return e===0?"0":e+"px"}_findByComponent(e){let i,r=null;return this._components.some(s=>(i=s===e,i&&(r=s),i)),r}_findById(e){let i,r=null;return this._components.some(s=>(i=s.id===e,i&&(r=s),i)),r}_findByNode(e){let i,r=null;return this._components.some(s=>(i=s.node===e,i&&(r=s),i)),r}};u([d()],em.prototype,"_locale",void 0),u([d()],em.prototype,"container",null),u([d()],em.prototype,"height",null),u([d({value:zPe})],em.prototype,"padding",null),u([wi("padding")],em.prototype,"castPadding",null),u([d()],em.prototype,"view",void 0),u([d()],em.prototype,"width",null),em=u([I("esri.views.ui.UI")],em);const fAt=em;function kpe(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function mAt(t,e){return t.length!==e.length||t.some((i,r)=>i.text!==e[r].text)}function BD(t,e,i){!i||!e||t.find(r=>r.layerView===e&&r.text===i)||t.push({text:i,layerView:e})}function gAt(t){return t.type==="bing-maps"}const c_=[];let $S=class extends j3{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new Nt,this.view=null,this._allLayerViewsChange=i=>{this.handles.remove("suspension");const r=this.get("view.allLayerViews");r&&this.handles.add(r.map(s=>re(()=>{var n;return[s.suspended,(n=s.layer)==null?void 0:n.attributionVisible]},()=>this._updateAttributionItems())),"suspension"),i&&i.removed&&i.removed.forEach(s=>{this._pendingAttributions.delete(s),this._fetchedAttributionData.delete(s)}),this._updateAttributionItems()},this.handles.add([pn(()=>{var i;return(i=this.view)==null?void 0:i.allLayerViews},"change",i=>this._allLayerViewsChange(i),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),qo(()=>{var i;return((i=this.view)==null?void 0:i.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.view,i=e==null?void 0:e.allLayerViews;c_.length=0,e&&i?(i.forEach(r=>{var o;if(r.suspended||!((o=r.layer)!=null&&o.attributionVisible))return;const s=r.layer;if(kpe(s,"user"))return void BD(c_,r,s.copyright);if(s.hasAttributionData){if(this._fetchedAttributionData.has(r)){const a=this._fetchedAttributionData.get(r);return void(a?BD(c_,r,this._getDynamicAttribution(a,e,s)):kpe(s)&&BD(c_,r,s.copyright))}return void this._fetchAttributionData(r)}const n=s.get("portalItem.accessInformation");BD(c_,r,n||s.copyright)}),mAt(this.items,c_)&&(this.items.removeAll(),this.items.addMany(c_)),c_.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const i=await Kp(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const r=i.ok?this._createContributionIndex(i.value,gAt(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,r)}this._updateAttributionItems()}_createContributionIndex(e,i){const r=e.contributors,s={};if(!r)return s;for(let n=0;n<r.length;n++){const o=r[n],a=o.coverageAreas;if(!a)return;for(const l of a){const c=l.bbox,h=l.zoomMin-(i&&l.zoomMin?1:0),p=l.zoomMax-(i&&l.zoomMax?1:0),f={xmin:c[1],ymin:c[0],xmax:c[3],ymax:c[2],spatialReference:mt.WGS84},m={extent:Ey(f),attribution:o.attribution||"",score:l.score!=null?l.score:100,id:n};for(let y=h;y<=p;y++)s[y]=s[y]||[],s[y].push(m)}}return s.maxKey=Math.max.apply(null,Object.keys(s)),s}_getDynamicAttribution(e,i,r){var h;const{extent:s,scale:n}=i;let o=((h=r.tileInfo)==null?void 0:h.scaleToZoom(n))??0;if(o=Math.min(e.maxKey??0,Math.round(o)),!s||o==null||o<=-1)return"";const a=e[o],l=sT(s.center.clone().normalize(),i.spatialReference),c={};return a?a.filter(p=>{const f=p.id,m=!c[f]&&l&&p.extent&&j6(p.extent,l);return m&&(c[f]=!0),m}).sort((p,f)=>f.score-p.score||p.objectId-f.objectId).map(p=>p.attribution).join(", "):""}};u([d({readOnly:!0,type:Nt})],$S.prototype,"items",void 0),u([d({readOnly:!0})],$S.prototype,"state",null),u([d()],$S.prototype,"view",void 0),$S=u([I("esri.widgets.Attribution.AttributionViewModel")],$S);const GPe=$S,R2="esri-attribution",u_={base:`${R2} esri-widget`,poweredBy:`${R2}__powered-by`,sources:`${R2}__sources`,open:`${R2}--open`,sourcesOpen:`${R2}__sources--open`,link:`${R2}__link`,widgetIcon:"esri-icon-description",interactive:"esri-interactive"};let ql=class extends bl{constructor(e,i){super(e,i),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(r=>r.forEach(({target:s})=>this._checkSourceTextOverflow(s))),this.iconClass=u_.widgetIcon,this.itemDelimiter=" | ",this.messages=null,this.viewModel=new GPe}initialize(){this.addHandles(pn(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,i)=>(e.includes(i.text)||e.push(i.text),e),[]).join(this.itemDelimiter)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[u_.open]:this._isOpen};return le("div",{bind:this,class:this.classes(u_.base,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return le("div",{class:u_.poweredBy},"Powered by"," ",le("a",{class:u_.link,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,i=this._isInteractive,r=i?"0":"",{attributionText:s}=this,n={[u_.sourcesOpen]:e,[u_.interactive]:i};return le("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(u_.sources,n),innerHTML:s,tabindex:r})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let i=!1;const{clientHeight:r,clientWidth:s,scrollWidth:n}=e,o=n>s,a=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,a&&(i=!0),this._isOpen){const l=r<this._prevSourceNodeHeight;this._prevSourceNodeHeight=r,l&&(this._isOpen=!1,i=!0)}i&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};u([d()],ql.prototype,"_isOpen",void 0),u([d()],ql.prototype,"_isInteractive",null),u([d()],ql.prototype,"_attributionTextOverflowed",void 0),u([d()],ql.prototype,"_prevSourceNodeHeight",void 0),u([d({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],ql.prototype,"attributionText",null),u([d()],ql.prototype,"iconClass",void 0),u([d()],ql.prototype,"itemDelimiter",void 0),u([d()],ql.prototype,"label",null),u([d(),dl("esri/widgets/Attribution/t9n/Attribution")],ql.prototype,"messages",void 0),u([d()],ql.prototype,"view",null),u([d({type:GPe})],ql.prototype,"viewModel",void 0),u([Fh()],ql.prototype,"_toggleState",null),ql=u([I("esri.widgets.Attribution")],ql);const yAt=ql,_At="esri.widgets.CompassViewModel";let gw=class extends ATe($e){constructor(e){super(e),this._handles=new Ki,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(re(()=>this.view,this._updateRotationWatcher,Zt))}destroy(){Rr(this._handles),this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){var i;if(!this.get("view.ready"))return;const e={};((i=this.view)==null?void 0:i.type)==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const i=-e.heading;this.orientation={x:0,y:0,z:i}}_updateRotationWatcher(e){this._handles.removeAll(),e&&this._handles.add(e.type==="2d"?re(()=>e==null?void 0:e.rotation,this._updateForRotation,Zt):re(()=>e==null?void 0:e.camera,this._updateForCamera,Zt))}};u([d({readOnly:!0})],gw.prototype,"canShowNorth",null),u([d()],gw.prototype,"orientation",void 0),u([d({readOnly:!0})],gw.prototype,"state",null),u([d()],gw.prototype,"view",void 0),gw=u([I(_At)],gw);const jPe=gw,h_={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};let tm=class extends bl{constructor(e,i){super(e,i),this.iconClass=h_.widgetIcon,this.messages=null,this.viewModel=new jPe}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:i}=this.viewModel,r=i==="disabled",s=(i==="rotation"?"rotation":"compass")=="compass",n=r?-1:0,o={[h_.disabled]:r,[h_.interactive]:!r},a={[h_.northIcon]:s,[h_.rotationIcon]:!s},{messages:l}=this;return le("div",{bind:this,class:this.classes(h_.base,o),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:n,"aria-label":l.reset,title:l.reset},le("span",{"aria-hidden":"true",class:this.classes(h_.icon,a),styles:this._toRotationTransform(e)}),le("span",{class:h_.text},l.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};u([d()],tm.prototype,"goToOverride",null),u([d()],tm.prototype,"iconClass",void 0),u([d()],tm.prototype,"label",null),u([d(),dl("esri/widgets/Compass/t9n/Compass")],tm.prototype,"messages",void 0),u([d()],tm.prototype,"view",null),u([d({type:jPe})],tm.prototype,"viewModel",void 0),u([Fh()],tm.prototype,"_reset",null),tm=u([I("esri.widgets.Compass")],tm);const vAt=tm,M2="esri-navigation-toggle",bh={base:`${M2} esri-widget`,button:`${M2}__button esri-widget--button`,activeButton:`${M2}__button--active`,panButton:`${M2}__button--pan`,rotateButton:`${M2}__button--rotate`,isLayoutHorizontal:`${M2}--horizontal`,rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};let LS=class extends $e{constructor(e){super(e),this.navigationMode="pan",this.view=null}initialize(){this.own(qo(()=>{var e;return(e=this.view)==null?void 0:e.inputManager},()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){var e;return this.get("view.ready")&&((e=this.view)==null?void 0:e.type)==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction=this.navigationMode==="pan"?"pan":"rotate"}};u([d({readOnly:!0})],LS.prototype,"state",null),u([d()],LS.prototype,"navigationMode",void 0),u([d()],LS.prototype,"view",void 0),LS=u([I("esri.widgets.NavigationToggleViewModel")],LS);const HPe=LS;let im=class extends bl{constructor(e,i){super(e,i),this.iconClass=bh.widgetIcon,this.messages=null,this.viewModel=new HPe}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}toggle(){return this.viewModel.toggle()}render(){const e=this.get("viewModel.state")==="disabled",i=this.get("viewModel.navigationMode")==="pan",r={[bh.disabled]:e,[bh.isLayoutHorizontal]:this.layout==="horizontal"},s={[bh.activeButton]:i},n={[bh.activeButton]:!i},o=e?-1:0,a=this.messages.toggle;return le("div",{bind:this,class:this.classes(bh.base,r),onclick:this._toggle,onkeydown:this._toggle,tabIndex:o,"aria-label":a,title:a},le("div",{class:this.classes(bh.button,bh.panButton,s)},le("span",{class:bh.panIcon})),le("div",{class:this.classes(bh.button,bh.rotateButton,n)},le("span",{class:bh.rotationIcon})))}_toggle(){this.toggle()}};u([d()],im.prototype,"iconClass",void 0),u([d()],im.prototype,"label",null),u([d({value:"vertical"})],im.prototype,"layout",null),u([d(),dl("esri/widgets/NavigationToggle/t9n/NavigationToggle")],im.prototype,"messages",void 0),u([d()],im.prototype,"view",null),u([d({type:HPe})],im.prototype,"viewModel",void 0),u([Fh()],im.prototype,"_toggle",null),im=u([I("esri.widgets.NavigationToggle")],im);const bAt=im,kO={button:"esri-widget--button esri-widget",disabled:"esri-disabled",interactive:"esri-interactive",iconText:"esri-icon-font-fallback-text",icon:"esri-icon"};let j_=class extends bl{constructor(){super(...arguments),this.enabled=!0,this.iconClass="",this.title=""}render(){const e=this.enabled?0:-1,i={[kO.disabled]:!this.enabled,[kO.interactive]:this.enabled},r={[this.iconClass]:!!this.iconClass};return le("div",{bind:this,class:this.classes(kO.button,i),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},le("span",{"aria-hidden":"true",role:"presentation",class:this.classes(kO.icon,r)}),le("span",{class:kO.iconText},this.title))}_triggerAction(){this.action.call(this)}};u([d()],j_.prototype,"action",void 0),u([d()],j_.prototype,"enabled",void 0),u([d()],j_.prototype,"iconClass",void 0),u([d()],j_.prototype,"title",void 0),u([Fh()],j_.prototype,"_triggerAction",null),j_=u([I("esri.widgets.IconButton")],j_);const Bpe=j_;let DS=class extends $e{get canZoomIn(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),i=this.get("view.constraints.effectiveMaxScale");return i===0||e>i}get canZoomOut(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),i=this.get("view.constraints.effectiveMinScale");return i===0||e<i}};u([d({readOnly:!0})],DS.prototype,"canZoomIn",null),u([d({readOnly:!0})],DS.prototype,"canZoomOut",null),u([d()],DS.prototype,"view",void 0),DS=u([I("esri.widgets.Zoom.ZoomConditions2D")],DS);const wAt=DS;let NS=class extends $e{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};u([d({readOnly:!0})],NS.prototype,"canZoomIn",null),u([d({readOnly:!0})],NS.prototype,"canZoomOut",null),u([d()],NS.prototype,"view",void 0),NS=u([I("esri.widgets.Zoom.ZoomConditions3D")],NS);const xAt=NS;let H_=class extends $e{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return v(this._zoomConditions)&&this._zoomConditions.canZoomIn}get canZoomOut(){var e;return v(this._zoomConditions)&&((e=this._zoomConditions)==null?void 0:e.canZoomOut)}get state(){var e;return(e=this.view)!=null&&e.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new wAt({view:e}):e.type==="3d"&&(this._zoomConditions=new xAt({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():dE(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():dE(e.goTo({zoomFactor:.5}))}};u([d()],H_.prototype,"_zoomConditions",void 0),u([d()],H_.prototype,"canZoomIn",null),u([d()],H_.prototype,"canZoomOut",null),u([d({readOnly:!0})],H_.prototype,"state",null),u([d()],H_.prototype,"view",null),H_=u([I("esri.widgets.Zoom.ZoomViewModel")],H_);const qPe=H_,BO={base:"esri-zoom esri-widget",horizontalLayout:"esri-zoom--horizontal",zoomInIcon:"esri-icon-plus",zoomOutIcon:"esri-icon-minus",widgetIcon:"esri-icon-zoom-in-magnifying-glass"};let iy=class extends bl{constructor(e,i){super(e,i),this.iconClass=BO.widgetIcon,this.messages=null,this.viewModel=new qPe}initialize(){this._zoomInButton=new Bpe({action:this.zoomIn.bind(this),iconClass:BO.zoomInIcon}),this._zoomOutButton=new Bpe({action:this.zoomOut.bind(this),iconClass:BO.zoomOutIcon})}destroy(){this._zoomInButton=Je(this._zoomInButton),this._zoomOutButton=Je(this._zoomOutButton)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e=this.viewModel,i={[BO.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:r,canZoomOut:s}=e;this._zoomInButton.enabled=r,this._zoomOutButton.enabled=s;const{zoomIn:n,zoomOut:o}=this.messages;return this._zoomInButton.title=n,this._zoomOutButton.title=o,le("div",{class:this.classes(BO.base,i)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};u([d()],iy.prototype,"iconClass",void 0),u([d()],iy.prototype,"label",null),u([d({value:"vertical"})],iy.prototype,"layout",null),u([d(),dl("esri/widgets/Zoom/t9n/Zoom")],iy.prototype,"messages",void 0),u([d()],iy.prototype,"view",null),u([d({type:qPe})],iy.prototype,"viewModel",void 0),iy=u([I("esri.widgets.Zoom")],iy);const TAt=iy;function SAt(t){return t&&t.view!==void 0}let XF=class extends fAt{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[]}initialize(){this.addHandles([re(()=>this.components,this._componentsWatcher.bind(this),Zt),re(()=>this.view,this._updateViewAwareWidgets.bind(this),Zt)])}_add(e,i,r,s){let n=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;n=this._createComponent(e)}super._add(n,i,r,s)}_removeComponents(e){e.forEach(i=>{const r=this._find(i);r&&(this.remove(r),r.destroy())})}_updateViewAwareWidgets(e){this.components.forEach(i=>{const r=this._find(i),s=r&&r.widget;SAt(s)&&(s.view=e)})}_componentsWatcher(e,i){this._removeComponents(i),this._addComponents(e),this._adjustPadding(e)}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:i}=this.padding;this.padding=i}}_addComponents(e){this.constructed&&e.forEach(i=>this.add(this._createComponent(i),this._defaultPositionLookup[i]))}_createComponent(e){const i=this._createWidget(e);if(i)return new WF({id:e,node:i})}_createWidget(e){return e==="attribution"?this._createAttribution():e==="compass"?this._createCompass():e==="navigation-toggle"?this._createNavigationToggle():e==="zoom"?this._createZoom():void 0}_createAttribution(){return new yAt({view:this.view})}_createCompass(){return new vAt({view:this.view})}_createNavigationToggle(){return new bAt({view:this.view})}_createZoom(){return new TAt({view:this.view})}};u([d()],XF.prototype,"components",void 0),XF=u([I("esri.views.ui.DefaultUI")],XF);const WPe=XF;let YF=class extends WPe{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};u([d()],YF.prototype,"components",void 0),YF=u([I("esri.views.ui.3d.DefaultUI3D")],YF);const XPe=YF;let bt=class extends Gve(RTe(DTe(KTe))){constructor(t){super(t),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._lostWebGLContextHandle=null,this._resolveWhenReady=[],this._propertiesPool=new Xy({slicePlane:Tve},this),this._resourceController=r1t(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new XW({view:this}),this.labeler=new lw({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new mC,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new $w,this.environmentManager=new sp,this.floors=new Nt,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new Tet({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new Tvt,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new XPe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new _X,this.voxelWasm=null,this.voxelWasmPromise=null,s_e(),t&&t.environment||(this._defaults.environment=new _S,this.environment=this._defaults.environment);const e=(i=null)=>{v(i)&&i.type===_r.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async r=>{try{await r.when()}catch{}this._updatingChanged()}))};this.handles.add([pn(()=>{var i;return(i=this.map)==null?void 0:i.allLayers},"after-changes",i=>e(i),{onListenerAdd:()=>e(),onListenerRemove:()=>e(),sync:!0}),this.allLayerViews.on("after-changes",i=>this._updateUpdatingMonitors(i)),re(()=>this.map,i=>{i&&"load"in i&&i.load&&i.load().catch(()=>{})})]),this.inputManager=new Tct({view:this}),this.stateManager=new bn({view:this})}initialize(){this.groundView=new RQe({view:this}),this._updateUpdatingMonitors();const t=()=>this._updateDefaultToMapOptions();this.handles.add(pn(()=>{var e;return(e=this.map)==null?void 0:e.allLayers},"after-changes",t,{onListenerAdd:t,onListenerRemove:t})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},Zt),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},Zt),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>qDe(e>0?1e3/Math.ceil(e):0),Zt),this.updatingHandles.add(()=>{var e;return(e=this.map)==null?void 0:e.ground},t,Br),this.updatingHandles.add(()=>{var e,i;return(i=(e=this.map)==null?void 0:e.ground)==null?void 0:i.opacity},()=>this._updateDefaultHitTestOptions(),Br),this.handles.add(re(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),Wi))}destroy(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=Je(this.sharedSymbolResources),this._set("labeler",Je(this.labeler)),this._set("deconflictor",Je(this.deconflictor)),this._resourceController=Je(this._resourceController),this._set("stateManager",Je(this.stateManager)),this._set("inputManager",Je(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this._set("environmentManager",Je(this.environmentManager)),this.groundView=Je(this.groundView))}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var t;return(t=this.basemapTerrain)==null?void 0:t.spatialReference}get animation(){var t;return(t=this.state)==null?void 0:t.animation}get camera(){var t;return(t=this.stateManager)==null?void 0:t.camera}set camera(t){this.stateManager&&(this.stateManager.camera=t)}get contentCamera(){var t;return(t=this.stateManager)==null?void 0:t.contentCamera}set contentCamera(t){this.stateManager&&(this.stateManager.contentCamera=t)}installContentCameraReset(t={sticky:!1}){return this.stateManager.installContentCameraReset(t)}get center(){var t;return(t=this.stateManager)==null?void 0:t.center}set center(t){this.stateManager&&(this.stateManager.center=t)}get clippingArea(){var e;if(this.viewingMode==="global")return null;let t=this._userClippingArea||("clippingArea"in this.map?(e=this.map)==null?void 0:e.clippingArea:void 0);return!(this._userClippingArea||this.get("map.clippingEnabled"))||C(t)?(this._clippingArea=null,null):t instanceof Pi?this.spatialReference&&(t=zD(t,this.spatialReference),C(t))?(oe.getLogger(this.declaredClass).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(t=t.clone(),C(t.intersection(this._groundAndLayersExtent))&&(t.xmin=t.xmax,t.ymin=t.ymax),t.zmin=void 0,t.zmax=void 0,t.equals(this._clippingArea)||(this._clippingArea=t),this._clippingArea):(oe.getLogger(this.declaredClass).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(t){this.ready&&this.viewingMode==="global"&&v(t)?oe.getLogger(this.declaredClass).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=t}get renderDataExtent(){if(this.state.viewingMode===st.Global)return null;const t=this.renderSpatialReference,e=this.dataExtent;return C(e)||C(t)||e.spatialReference.equals(t)?e:zD(e,t)}get dataExtent(){let t=this._groundAndLayersExtent;const e=this.spatialReference||mt.WGS84,i=zD(this.clippingArea,e);v(i)&&(t=v(t)?t.intersection(i):i);const r=this._get("dataExtent");return v(t)&&t.equals(r)?r:t}get _groundAndLayersExtent(){const t=this.spatialReference||mt.WGS84;let e;const i=n=>{const o=zD(n,t);C(o)||(v(e)?e.union(o):e=o.clone())},r=this.basemapTerrain;if(r!=null&&r.spatialReference){const n=r.groundExtent;i(new Pi({xmin:n[0],ymin:n[1],zmin:0,xmax:n[2],ymax:n[3],zmax:0,spatialReference:r.spatialReference}))}if(this.map){const n=o=>{!v(o.fullExtent)||o.type==="graphics"&&o.internal||i(o.fullExtent)};this.map.allLayers.forEach(o=>n(o))}if(C(e))return null;e.hasZ?(e.zmin=Math.min(0,e.zmin??0),e.zmax=Math.max(0,e.zmax??0)):(e.zmin=0,e.zmax=0);const s=this._get("_groundAndLayersExtent");return e.equals(s)?s:e}set environment(t){t!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",t)}castEnvironment(t){return t?t instanceof _S?t:t instanceof r2e?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(t):_S.fromWebsceneEnvironment(t):mn(_S,t):new _S}get extent(){var t;return(t=this.stateManager)==null?void 0:t.extent}set extent(t){this.stateManager&&(this.stateManager.extent=t)}get screenCenter(){var t;return(t=this.stateManager)==null?void 0:t.screenCenter}get frustum(){var t;return(t=this.stateManager)==null?void 0:t.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||v(this.activeTool)&&this.activeTool.visible}get stationary(){return!this.animation&&!this.resizing&&(C(this.state)||this.state.stationary)}get navigating(){var t;return((t=this.state)==null?void 0:t.navigating)??!1}get padding(){var t;return(t=this.stateManager)==null?void 0:t.padding}set padding(t){this.stateManager&&(this.stateManager.padding=t)}set qualityProfile(t){IF.isValidProfile(t)&&(IF.apply(t,this.qualitySettings),this._set("qualityProfile",t))}get qualityProfile(){return this._get("qualityProfile")||IF.getDefaultProfile()}set slicePlane(t){if(v(this._stage)&&this._stage.renderer.setParameters({slicePlane:t}),C(t))return void this._set("slicePlane",null);const e=this._propertiesPool.get("slicePlane");dT(t,e),this._set("slicePlane",e)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?Jke(this.scale,this.spatialReference):0}get scale(){var t;return(t=this.stateManager)==null?void 0:t.scale}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get heightModelInfo(){const t=this.getDefaultHeightModelInfo();return t!=null?iA.deriveUnitFromSR(t,this.spatialReference):null}get updating(){var s,n,o;if(this.destroyed)return!1;let t=0,e=this.layerViewManager.updating,i=e?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(a=>{if(a.isFulfilled()){if(a.updating){if(e=!0,a.suspended||$P(a))return;++i,t+=a.updatingProgress}}else++i});for(const a of[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager])v(a)&&a.updating&&(i+=.1,t+=.5*.1);for(const a of[this.deconflictor,this.labeler,this.basemapTerrain])v(a)&&a.updating&&(++i,t+=a.updatingProgress);const r=this.stateManager.test.updatingIgnoreRenderState?Mi.IDLE:this.state.mode;if(e=!!(e||i>0||this.updatingHandles.updating||!this.ready||!this.stationary||r!==Mi.IDLE||this._createGraphicsViewController||(s=this.inputManager)!=null&&s.hasPendingInputs||(o=(n=this.map)==null?void 0:n.allLayers)!=null&&o.some(a=>!a.isFulfilled())),e?(this._numUpdating=Math.max(i,this._numUpdating),t+=this._numUpdating-i):this._numUpdating=0,this._numUpdating>0?t/=this._numUpdating:t=e?0:1,this._get("updatingProgress")!==t){const a=performance.now();if(t<1){const l=Math.min((a-this._lastUpdateTime)/2e3,1);t=this.updatingProgress*(1-l)+t*l}this._set("updatingProgress",t),this._lastUpdateTime=e&&t<1?a:0}return e}get viewingMode(){var i;const t=this._predeterminedViewingMode;if(v(t))return Yk(t);const e=this.spatialReference;return e?v((i=this.defaultsFromMap)==null?void 0:i.viewingMode)&&e.equals(this.defaultsFromMap.spatialReference)?Yk(this.defaultsFromMap.viewingMode):U5(e,st.Global)?"global":"local":"global"}set viewingMode(t){this.ready?oe.getLogger(this.declaredClass).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",t)}get viewpoint(){var t;return(t=this.stateManager)==null?void 0:t.viewpoint}set viewpoint(t){this.stateManager&&(this.stateManager.viewpoint=t)}get zoom(){return this.stateManager.zoom}set zoom(t){this.stateManager&&(this.stateManager.zoom=t)}get resourceController(){return this._resourceController}get performanceInfo(){return new R1t(this)}on(t,e,i,r){return this.viewEvents.on(t,e,i,r)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}toMap(t,e){if(!this.ready)return oe.getLogger(this.declaredClass).error("#toMap()","Scene view cannot be used before it is ready"),null;const i=e?this.externalToInternalIntersectOptions(e):this._defaultToMapOptions,r=v(i.graphics)&&(v(i.graphics.include)||v(i.graphics.exclude)),s=m5(t)?f5(this,t):t,n=pm(s);i.enableDraped=i.include&&!i.include.has(av)||i.exclude&&i.exclude.has(av);const o=this.sceneIntersectionHelper,a=xd(this.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=r?Ho.ALL:Ho.MIN,o.intersectIntersectorScreen(n,a,i),r){for(const l of a.results.all){const c=ZX(l,this);if(C(c))return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(i.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(a.results.min)}toScreen(t){if(!this.ready)return oe.getLogger(this.declaredClass).error("#toScreen()","Scene view cannot be used before it is ready"),null;const e=Gt(t.z==null?wm(this.elevationProvider,t):null,0);return da(t,P2,this.renderSpatialReference,e),this.state.camera.projectToScreen(P2,Sz),Ra(Sz[0],Sz[1])}pixelSizeAt(t){return this.ready?t?(da(t,P2,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(P2)):0:(oe.getLogger(this.declaredClass).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(t){const e=this.basemapTerrain.overlayManager;return e?e.overlayPixelSizeInMapUnits(t):1}hitTest(t,e){if(!this.ready)return oe.getLogger(this.declaredClass).error("#hitTest()","Scene view cannot be used before it is ready"),null;const i=m5(t)?f5(this,t):t,r=ms(i.x,i.y),s=e?this.externalToInternalIntersectOptions(e):this._defaultHitTestOptions;s.requiresGroundFeedback=!0,s.enableDraped=!0;const n=xd(this.state.viewingMode);n.options.selectionMode=!0,n.options.store=Ho.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(r,n,s);const o=this._intersectResultsToHits(n.results.all,s.graphics),a=n.results.ground,l=Npe(a,this),c=v(l)&&"type"in l&&l.type==="integrated-mesh"?l:null,h={screenPoint:i,results:o,ground:{mapPoint:this._intersectResultToMapPoint(a),distance:lf(a)?a.distanceInRenderSpace:0,layer:c}};return Ji.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(h.intersector=n),Promise.resolve(h)}async popupHitTest(t){const{results:e,ground:i}=await tAt(this,t);let r=null;return!(e.length===0||Math.abs(Gt(e[0].distance,0)-i.distance)<1e-5)||i.layer&&i.layer.type==="integrated-mesh"||(r=i.mapPoint),{results:e,screenPoint:t,mapPoint:r}}goTo(t,e){return this.updatingHandles.addPromise(this.stateManager.goTo(t,e))}async whenAnalysisView(t){if(C(t.parent))throw new W("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:t});switch(t.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(t.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(t)}}whenLayerView(t){return super.whenLayerView(t)}async takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(e);return HF(i,e,this._pixelFormat())}async _takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(e);return qF(i,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshotWithOID(e);return[qF(i[0],this._pixelFormat()),qF(i[1],this._pixelFormat())]}_completeSettings(t){const e=LCt(t,this);return e.pixelRatio/=this.state.pixelRatio,kCt(e,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:t=>this._takeScreenshot(t),takeScreenshotWithObjectAndLayerId:t=>this._takeScreenshotWithObjectAndLayerId(t)}}async takeScreenshotWithObjectAndLayerId(t){if(!de("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshotWithOID(e),r=HF(i[0],e,this._pixelFormat()),s=this._completeSettings(t);return s.format="png",[r,HF(i[1],s,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(C(this._stage.renderView.objectAndLayerIdRenderHelper))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(t){return this.updatingHandles.addPromise(t)}importLayerView(t){return eae.importLayerView(t)}hasLayerViewModule(t){return eae.hasLayerViewModule(t)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var t,e,i,r;return this.map&&"initialViewProperties"in this.map&&((e=(t=this.map)==null?void 0:t.initialViewProperties)==null?void 0:e.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.ready)&&this._initialDefaultSpatialReference||null}async validate(){let t=BPe(this.type);const e=de("safari");if(e&&e<9&&(t=new W("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:e})),v(t))throw oe.getLogger(this.declaredClass).warn("#validate()",t.message),t}get _predeterminedViewingMode(){var e;const t=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?(e=this.map.initialViewProperties)==null?void 0:e.viewingMode:null)??null;return v(t)?Joe(t):null}getSpatialReferenceSupport({spatialReference:t,layer:e}){const i=this._predeterminedViewingMode;if(v(i))return this._validateSpatialReferenceForViewingMode(t,e,i)?{constraints:this._makeSpatialReferenceConstraints(t,e,i)}:null;const r=this._validateSpatialReferenceForViewingMode(t,e,st.Local),s=this._validateSpatialReferenceForViewingMode(t,e,st.Global);return r||s?r&&s?{constraints:this._makeSpatialReferenceConstraints(t,e,null)}:r?{constraints:this._makeSpatialReferenceConstraints(t,e,st.Local)}:{constraints:this._makeSpatialReferenceConstraints(t,e,st.Global)}:null}_validateSpatialReferenceForViewingMode(t,e,i){return!!U5(t,i)&&(!!C(e)||!!Ore(e)||(!FM(e)||!C(X8(e,t,i)))&&(!Are(e)||i!==st.Global))}_makeSpatialReferenceConstraints(t,e,i){if(C(e))return[{spatialReference:t,viewingMode:i}];const r=t.isWebMercator,s=t.isWGS84;return Ore(e)&&(r||s)?!s||i===st.Local||Wee(e.tileInfo,e.fullExtent,t,st.Global)===null?[{spatialReference:t,viewingMode:i},{spatialReference:mt.WebMercator,viewingMode:i}]:[{spatialReference:r?mt.WGS84:mt.WebMercator,viewingMode:i}]:FM(e)||Are(e)||!r&&!s?FM(e)&&r&&i!==st.Global?[{spatialReference:t,viewingMode:i},{spatialReference:mt.WGS84,viewingMode:st.Local}]:[{spatialReference:t,viewingMode:i}]:[{spatialReference:t,viewingMode:i},{spatialReference:r?mt.WGS84:mt.WebMercator,viewingMode:i}]}_validateSpatialReference(t){const e=v(this.getSpatialReferenceSupport({spatialReference:t})),i=this._predeterminedViewingMode;return e||(v(i)?oe.getLogger(this.declaredClass).warnOnce(`Spatial reference defined on view not supported in ${Yk(i)} viewing mode.`):t.isGeographic&&oe.getLogger(this.declaredClass).warnOnce("Spatial reference is geographic but not supported.")),e}whenReady(){return new Promise(t=>{this.ready?t(this):this._resolveWhenReady.push(t)})}computeMapPointFromVec3d(t,e){let i=this.spatialReference||mt.WGS84;return _o(t,this.renderSpatialReference,t,i)||(i=mt.WGS84,_o(t,this.renderSpatialReference,t,i)),e?(e.x=t[0],e.y=t[1],e.z=t[2],e.spatialReference=i):e=new pt(t,i),e}trackGraphicState(t){if(!t.graphic)return oe.getLogger(this.declaredClass).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const e=this.getViewForGraphic(t.graphic);let i=null,r=!1;const s=n=>{var o;!r&&v(n)&&"processor"in n&&((o=n.processor)==null?void 0:o.type)==="graphics-3d"&&n.processor.graphicsCore&&(i=n.processor.graphicsCore.trackGraphicState(t))};return v(e)?s(e):this.whenViewForGraphic(t.graphic,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{r=!0,v(i)&&(i.remove(),i=null)}}}highlight(t){if(Array.isArray(t))return qE(t.map(i=>this.highlight(i)));if(Nt.isCollection(t))return qE(t.toArray().map(i=>this.highlight(i)));const e=this.getViewForGraphic(t);return e&&"highlight"in e?e.highlight(t):Wp()}maskOccludee(t){if(!t)return oe.getLogger(this.declaredClass).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const e=this.getViewForGraphic(t);let i=null,r=!1;const s=n=>{!r&&v(n)&&aQe(n)&&(i=n.maskOccludee(t))};return v(e)?s(e):this.whenViewForGraphic(t,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{r=!0,v(i)&&(i.remove(),i=null)}}}getViewForGraphic(t){return t.layer===this.graphics?this.graphicsView:t.layer?this.allLayerViews.find(e=>e.layer===t.layer):null}graphicChanged(t){v(this.graphicsView)&&this.graphicsView.graphicChanged(t)}async whenViewForGraphic(t,e){if(t.layer===this)return await aC(()=>this.graphicsView),this.graphicsView;if(!t.layer||!this.map)throw new W("no-view-for-graphic");return e&&e.waitForLayer&&!this.map.allLayers.includes(t.layer)?new Promise((i,r)=>{const s=this.map.allLayers.on("change",n=>{n.added.includes(t.layer)&&(s.remove(),this.whenLayerView(t.layer).then(i,r))})}):this.whenLayerView(t.layer)}externalToInternalIntersectOptions(t){const e=this._externalToInternalRenderItems(t.include,b3.INCLUDE),i=this._externalToInternalRenderItems(t.exclude,b3.EXCLUDE);return{include:e.layerUids,exclude:i.layerUids,graphics:{include:e.graphicUids,exclude:i.graphicUids}}}_intersectResultToMapPoint(t,e){return t.getIntersectionPoint(P2)?(e=this.computeMapPointFromVec3d(P2,e),t.intersector===as.TERRAIN&&this.basemapTerrain&&(e.z=Gt(wm(this.basemapTerrain,e),0)),e):null}_intersectResultsToHits(t,e){const i=new Array;let r=null;for(let s=0;s<t.length;s++){const n=t[s],o=Npe(n,this);if(v(o)&&(o===this.map.ground||"type"in o&&o.type==="integrated-mesh"))break;const a=ZX(n,this);if(C(a))continue;if(a.type==="graphic"){if(C(r)&&s!==t.length-1&&(r=new Set),v(r)){const h=this._getGraphicFilterUid(a.graphic);if(r.has(h))continue;r.add(h)}if(!this._testGraphicUidFilter(e,a.graphic))continue}const l=this._intersectResultToMapPoint(n),c=n.distanceInRenderSpace;i.push({...a,mapPoint:l,distance:c})}return i}_getGraphicFilterUid(t){var s;const e=t.sourceLayer,i=t.layer,r=e&&"objectIdField"in e?e:i&&"objectIdField"in i?i:e;if(r){const n=r.objectIdField??Uve,o=(s=t.attributes)==null?void 0:s[n];if(o)return`o-${r.id}-${o}`}return`u-${t.uid}`}_testGraphicUidFilter(t,e){const i=this._getGraphicFilterUid(e);return C(t)||(C(t.include)||t.include.has(i))&&(C(t.exclude)||!t.exclude.has(i))}_externalToInternalRenderItems(t,e,i={layerUids:void 0,graphicUids:void 0}){if(!t)return i;if(t instanceof ha)EAt(i,this._getGraphicFilterUid(t)),e===b3.INCLUDE&&(v(this.graphicsView)&&t.layer===this?zO(i,this.graphicsView.processor.layer.id):t.layer&&zO(i,t.layer.uid));else if(C3(t))for(const r of t)r===this.graphics&&v(this.graphicsView)?zO(i,this.graphicsView.processor.layer.id):r===this.map.ground?zO(i,av):this._externalToInternalRenderItems(r,e,i);else"uid"in t&&zO(i,t.uid);return i}_initBasemapTerrain(){this._set("basemapTerrain",new jxt({view:this})),this._set("elevationProvider",new aM({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new Wl({view:this})),this._set("featureTiles",new Do({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const t=()=>{var i;const e=(i=this.basemapTerrain)==null?void 0:i.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const r=v(this.basemapTerrain.extent)&&v(this.basemapTerrain.spatialReference)?tg(eU(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;v(this.clippingArea)?this.featureTiles.filterExtent=this.clippingArea.intersection(r):this.featureTiles.filterExtent=r}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(()=>Ji.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(ee(()=>import("./FeatureTileTree3DDebugger-01d6379f.js"),["./FeatureTileTree3DDebugger-01d6379f.js","./TileTreeDebugger-44eb22f0.js"],import.meta.url)).then(({FeatureTileTree3DDebugger:i})=>{!this._featureTreeDebugger&&Ji.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new i({view:this}))}):e||!this._featureTreeDebugger||Ji.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},Br),this.updatingHandles.add(()=>this.clippingArea,t,Br),this.updatingHandles.add(()=>this.basemapTerrain.extent,t,Br)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const t=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(t)||this._set("mapCoordsHelper",new Vvt(this.map,t));const e=this.state.isGlobal,i=Fve(e,t);i!==this.renderSpatialReference&&(this._set("renderCoordsHelper",Gvt.create(this.state.viewingMode,i)),e||this.handles.add(re(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.extent},r=>{const s=this.renderCoordsHelper.spatialReference;v(r)&&(r[0]!==0||r[1]!==0||r[2]!==0||r[3]!==0)&&vU(r,this.basemapTerrain.spatialReference,zpe,s)&&(this.renderCoordsHelper.extent=zpe)},Wi),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(IC/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(t=null){v(t)&&t.type===_r.MOVE||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(e=>{e.destroyed||(this.handles.add(re(()=>[e.updating,e.updatingProgress],()=>this._updatingChanged(),Wi),"updatingMonitors"),e.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(t,e){if(!this.overlay||!this.overlay.hasVisibleItems)return e;const i=t.getContext("2d");return i.putImageData(e,0,0),this.overlay.renderCanvas(t),i.getImageData(0,0,e.width,e.height)}_initStage(){const t={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(s,n)=>this._renderScreenshotOverlay(s,n)}},e=new Svt(this.state.viewingMode,s=>this._stage.layers.forAll(s),this);this._set("sceneIntersectionHelper",e);const i=pU(this.surface);this._stage=new Mc({view:this,options:t,container:i}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this._lostWebGLContextHandle=HP(this._stage.renderView.canvas,"webglcontextlost",()=>this.fatalError=new W("webgl-context-lost")),this.handles.add([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderer.setParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),Zt),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,s=>this._stage.renderer.setParameters({highQualityTransparency:s}),Zt),re(()=>this.magnifier,s=>this._stage.renderView.magnifier=s,Br),this.on("pointer-move",()=>{var s;return(s=this._stage)==null?void 0:s.renderer.resetAnimation()})],"stage");const r=()=>{this._stage.renderer.setParameters({defaultHighlightOptions:_X.toEngineOptions(this.highlightOptions)})};this.handles.add(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],r),"stage"),r(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(IC/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=Je(this._stage),this._lostWebGLContextHandle=Rr(this._lostWebGLContextHandle),this.handles.remove("stage"),this._set("canvas",null)}_initSurface(t){this._exitSurface(),this.state.init(t,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new I1t({view:this,viewingMode:t,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.handles.remove("graphics-view"),this._createGraphicsViewController=new AbortController;const t=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(t,t),this._updatingChanged()}async _createGraphicsViewAsync(t){const e=(await ee(()=>import("./GraphicsView3D-12a0cb28.js"),["./GraphicsView3D-12a0cb28.js","./GraphicsProcessor-b227957b.js","./Graphics3DObjectStates-135fd699.js","./optimizedFeatureQueryEngineAdapter-dc9b72d8.js","./centroid-d1553553.js","./PooledRBush-83d0be85.js","./GraphicsView-bef23e3b.js"],import.meta.url)).default;gi(t),await aC(()=>{var i;return(i=this.basemapTerrain)==null?void 0:i.ready},t),this._set("graphicsView",new e({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.handles.remove("graphics-view"),v(this.graphicsView)&&(this.handles.remove(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const t=Joe(this.viewingMode);if(t===st.Global&&(this._clippingArea=null),this._initSurface(t),this._set("ready",!0),this.handles.add(pn(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const i=this.get("map.initialViewProperties.environment");i&&(this.environment=i)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const e=this._resolveWhenReady;this._resolveWhenReady=[],e.forEach(i=>i(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.handles.remove("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(av);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(t.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(av);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&t.opacity<1&&this._defaultHitTestOptions.exclude.add(t.uid)}}addVoxelLayerViewToWasm(t){return C(this.voxelWasm)?(C(this.voxelWasmPromise)&&(this.voxelWasmPromise=ee(()=>import("./VoxelWasmPerSceneView-6df81438.js"),[],import.meta.url).then(e=>(this.voxelWasm=new e.default(this),this.voxelWasm))),this.voxelWasmPromise.then(e=>e.addVoxelLayer(t))):this.voxelWasm.addVoxelLayer(t)}removeVoxelLayerViewFromWasm(t){v(this.voxelWasm)&&this.voxelWasm.removeVoxelLayer(t)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null)}};function zO(t,e){t.layerUids||(t.layerUids=new Set),t.layerUids.add(e)}function EAt(t,e){t.graphicUids||(t.graphicUids=new Set),t.graphicUids.add(e)}function zD(t,e){return v(t)&&jm(t.spatialReference,e)?tg(t,e):null}var b3;bt.type="3d",u([d()],bt.prototype,"_userClippingArea",void 0),u([d()],bt.prototype,"_resourceController",void 0),u([d()],bt.prototype,"_stage",void 0),u([d({readOnly:!0})],bt.prototype,"deconflictor",void 0),u([d({readOnly:!0})],bt.prototype,"labeler",void 0),u([d(HG(mC,"analyses"))],bt.prototype,"analyses",void 0),u([d({type:Yy,readOnly:!0})],bt.prototype,"animation",null),u([d({readOnly:!0})],bt.prototype,"basemapTerrain",void 0),u([d({readOnly:!0})],bt.prototype,"elevationProvider",void 0),u([d()],bt.prototype,"camera",null),u([d({type:fd})],bt.prototype,"contentCamera",null),u([d({readOnly:!0})],bt.prototype,"canvas",void 0),u([d({type:pt})],bt.prototype,"center",null),u([d({type:Pi})],bt.prototype,"clippingArea",null),u([d({type:$w})],bt.prototype,"constraints",void 0),u([d({type:Pi,readOnly:!0})],bt.prototype,"renderDataExtent",null),u([d({type:Pi,readOnly:!0})],bt.prototype,"dataExtent",null),u([d({type:Pi,readOnly:!0})],bt.prototype,"_groundAndLayersExtent",null),u([d({value:null,type:_S})],bt.prototype,"environment",null),u([wi("environment")],bt.prototype,"castEnvironment",null),u([d({readOnly:!0})],bt.prototype,"environmentManager",void 0),u([d({type:Pi})],bt.prototype,"extent",null),u([d()],bt.prototype,"floors",void 0),u([d()],bt.prototype,"screenCenter",null),u([d()],bt.prototype,"frustum",null),u([d({type:Number,readOnly:!0})],bt.prototype,"fullOpacity",void 0),u([d({readOnly:!0})],bt.prototype,"graphicsView",void 0),u([d({readOnly:!0})],bt.prototype,"analysisViewManager",void 0),u([d()],bt.prototype,"groundView",void 0),u([d({type:Boolean})],bt.prototype,"initialExtentRequired",null),u([d()],bt.prototype,"_defaultsFromMapSettings",null),u([d()],bt.prototype,"interacting",null),u([d()],bt.prototype,"stationary",null),u([d()],bt.prototype,"navigating",null),u([d()],bt.prototype,"map",void 0),u([d({readOnly:!0})],bt.prototype,"mapCoordsHelper",void 0),u([d()],bt.prototype,"padding",null),u([d({type:Wl,readOnly:!0})],bt.prototype,"pointsOfInterest",void 0),u([d({type:Do,readOnly:!0})],bt.prototype,"featureTiles",void 0),u([d()],bt.prototype,"_featureTreeDebugger",void 0),u([d({type:Boolean})],bt.prototype,"screenSizePerspectiveEnabled",void 0),u([d({constructOnly:!0})],bt.prototype,"deactivatedWebGLExtensions",void 0),u([d({constructOnly:!0})],bt.prototype,"debugWebGLExtensions",void 0),u([d({constructOnly:!0})],bt.prototype,"renderCanvas",void 0),u([d({constructOnly:!0})],bt.prototype,"state",void 0),u([d({readOnly:!0})],bt.prototype,"inputManager",void 0),u([d({readOnly:!0})],bt.prototype,"stateManager",void 0),u([d({type:["low","medium","high"]})],bt.prototype,"qualityProfile",null),u([d({type:Rhe,get(){let t=this._get("qualitySettings");return t||(t=new Rhe,IF.apply(this.qualityProfile,t)),t}})],bt.prototype,"qualitySettings",void 0),u([d()],bt.prototype,"slicePlane",null),u([d({readOnly:!0})],bt.prototype,"typeSpecificPreconditionsReady",null),u([d({readOnly:!0})],bt.prototype,"renderCoordsHelper",void 0),u([d({readOnly:!0})],bt.prototype,"sceneIntersectionHelper",void 0),u([d({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],bt.prototype,"resolution",null),u([d({type:Number})],bt.prototype,"scale",null),u([d()],bt.prototype,"heightModelInfo",null),u([d()],bt.prototype,"spatialReference",void 0),u([d({type:Boolean,constructOnly:!0})],bt.prototype,"alphaCompositingEnabled",void 0),u([d({constructOnly:!0})],bt.prototype,"preserveDrawingBufferEnabled",void 0),u([d({type:Boolean})],bt.prototype,"supersampleScreenshotsEnabled",void 0),u([d({readOnly:!0})],bt.prototype,"type",void 0),u([d({type:XPe})],bt.prototype,"ui",void 0),u([d({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.hasPendingInputs","toolViewManager.updating","analysisViewManager.updating","state.mode"]})],bt.prototype,"updating",null),u([d({type:Number,readOnly:!0,dependsOn:["updating"]})],bt.prototype,"updatingProgress",void 0),u([d({type:["global","local"]})],bt.prototype,"viewingMode",null),u([d({type:zo})],bt.prototype,"viewpoint",null),u([d({type:Number})],bt.prototype,"zoom",null),u([d({type:_X})],bt.prototype,"highlightOptions",void 0),bt=u([I("esri.views.SceneView")],bt),function(t){t[t.INCLUDE=0]="INCLUDE",t[t.EXCLUDE=1]="EXCLUDE"}(b3||(b3={}));const P2=M(),Sz=ms(),zpe=ci(),CAt=bt;function kw(t,e,i,r){const s=3*t,n=3*(i-t)-s,o=1-s-n,a=3*e,l=3*(r-e)-a,c=1-a-l;function h(y){return((o*y+n)*y+s)*y}function p(y){return((c*y+l)*y+a)*y}function f(y){return(3*o*y+2*n)*y+s}function m(y,_){let b,w,S,T,E,O;for(S=y,O=0;O<8;O++){if(T=h(S)-y,Math.abs(T)<_)return S;if(E=f(S),Math.abs(E)<1e-6)break;S-=T/E}if(b=0,w=1,S=y,S<b)return b;if(S>w)return w;for(;b<w;){if(T=h(S),Math.abs(T-y)<_)return S;y>T?b=S:w=S,S=.5*(w-b)+b}return S}return function(y,_=1e-6){return p(m(y,_))}}const AAt=/^cubic-bezier\((.*)\)/,Bh={};function OAt(t){let e=Bh[t]||null;if(!e){const i=AAt.exec(t);if(i){const r=i[1].split(",").map(s=>parseFloat(s.trim()));r.length!==4||r.some(s=>isNaN(s))||(e=kw.apply(kw,r))}}return e}Bh.ease=kw(.25,.1,.25,1),Bh.linear=kw(0,0,1,1),Bh.easeIn=Bh["ease-in"]=kw(.42,0,1,1),Bh.easeOut=Bh["ease-out"]=kw(0,0,.58,1),Bh.easeInOut=Bh["ease-in-out"]=kw(.42,0,.58,1);let RAt=class{constructor(e,i,r,s){const n=e.targetGeometry,o=i.targetGeometry;s?typeof s=="string"&&(s=OAt(s)||Bh.ease):s=Bh.ease,this.easing=s,this.duration=r,this.sCenterX=n.x,this.sCenterY=n.y,this.sScale=e.scale,this.sRotation=e.rotation,this.tCenterX=o.x,this.tCenterY=o.y,this.tScale=i.scale,this.tRotation=i.rotation,this.dCenterX=this.tCenterX-this.sCenterX,this.dCenterY=this.tCenterY-this.sCenterY,this.dScale=this.tScale-this.sScale,this.dRotation=this.tRotation-this.sRotation,this.dRotation>180?this.dRotation-=360:this.dRotation<-180&&(this.dRotation+=360)}applyRatio(e,i){const r=this.easing(i);let s,n,o,a;i>=1?(s=this.tCenterX,n=this.tCenterY,o=this.tRotation,a=this.tScale):(s=this.sCenterX+r*this.dCenterX,n=this.sCenterY+r*this.dCenterY,o=this.sRotation+r*this.dRotation,a=this.sScale+r*this.dScale),e.targetGeometry.x=s,e.targetGeometry.y=n,e.scale=a,e.rotation=o}},ry=class extends $e{constructor(e){super(e),this.updateFunction=null,this.animation=null,this.duration=200,this.transition=null,this.easing=Bh.ease,this.view=null,this.viewpoint=new zo({targetGeometry:new pt,scale:0,rotation:0}),this._updateTask=By({postRender:this._postRender.bind(this)}),this._updateTask.pause()}destroy(){this._updateTask=Rr(this._updateTask)}animate(e,i,r){this.stop();const s=this.viewpoint;uf(s,i),this.transition=new RAt(this.viewpoint,e.target,r&&r.duration||this.duration,r&&r.easing||this.easing);const n=()=>{var o,a;this.animation===e&&this._updateTask&&(e.state==="finished"&&((o=this.transition)==null||o.applyRatio(this.viewpoint,1),(a=this.view)!=null&&a.state&&(this.view.state.viewpoint=this.viewpoint.clone())),this.animation=null,this.updateFunction=null)};return e.when(n,n),this._startTime=performance.now(),this._updateTask.resume(),this.animation=e,e}animateContinous(e,i){this.stop(),this.updateFunction=i,this.viewpoint=e;const r=new Yy({target:e.clone()}),s=()=>{this.animation===r&&this._updateTask&&(this.animation=null,this.updateFunction=null)};return r.when(s,s),this._startTime=performance.now(),this._updateTask.resume(),this.animation=r,r}stop(){this.animation&&(this.animation.stop(),this.animation=null,this.updateFunction=null)}_postRender(e){var r,s;const i=this.animation;if(i&&i.state!==Yy.State.STOPPED){if(this.updateFunction)this.updateFunction(this.viewpoint,e.deltaTime);else{const n=this.transition,o=(performance.now()-this._startTime)/n.duration,a=o>=1;n.applyRatio(this.viewpoint,o),a&&((r=this.animation)==null||r.finish())}(s=this.view)!=null&&s.state&&(this.view.state.viewpoint=this.viewpoint.clone())}else this._updateTask.pause()}};u([d()],ry.prototype,"animation",void 0),u([d()],ry.prototype,"duration",void 0),u([d()],ry.prototype,"transition",void 0),u([d()],ry.prototype,"easing",void 0),u([d()],ry.prototype,"view",void 0),u([d()],ry.prototype,"viewpoint",void 0),ry=u([I("esri.views.2d.AnimationManager")],ry);const MAt=ry;let PAt=class{constructor(e){this.view=e,this._stationaryHandle=null,this._frameTaskHandle=null,this._updateParameters=null,this._updateRequested=!1,this.stationary=!0,this.animationInProgress=!1,this.prepare=()=>{this._updateParameters&&(this._updateParameters.state=this.view.state,this._updateParameters.stationary=this.view.stationary,this._updateParameters.pixelRatio=window.devicePixelRatio,this._updateParameters.renderingOptions=this.view.renderingOptions)},this.update=()=>{var a;this._updateRequested=!1;const{basemapView:i,graphicsView:r,labelManager:s,layerViews:n,state:{id:o}}=this.view;i==null||i.baseLayerViews.forEach(this._updateLayerView,this),n.forEach(this._updateLayerView,this),i==null||i.referenceLayerViews.forEach(this._updateLayerView,this),v(s)&&(s.lastUpdateId!==o&&(s.viewChange(),s.lastUpdateId=o),s.updateRequested&&s.processUpdate(this._updateParameters)),v(r)&&(r.lastUpdateId!==o&&(r.viewChange(),r.lastUpdateId=o),r.updateRequested&&r.processUpdate(this._updateParameters)),this.view.graphicsTileStore.setViewState(this._updateParameters.state),this.animationInProgress||this._updateRequested||((a=this._frameTaskHandle)==null||a.pause())}}destroy(){this.stop()}start(){if(this._frameTaskHandle)return;const e=this.view;this.stationary=e.stationary,this._updateParameters={state:e.state,pixelRatio:window.devicePixelRatio,stationary:this.stationary,renderingOptions:e.renderingOptions},this._stationaryHandle=re(()=>e.stationary,i=>{this.stationary=i,this.requestFrame()}),this._frameTaskHandle=By(this),this.requestUpdate()}stop(){var e;this._frameTaskHandle&&(this._updateRequested=!1,(e=this._stationaryHandle)==null||e.remove(),this._frameTaskHandle.remove(),this._updateParameters=this._stationaryHandle=this._frameTaskHandle=null,this.stationary=!0,this.animationInProgress=!1)}requestUpdate(){this._updateRequested||(this._updateRequested=!0,this.requestFrame())}requestFrame(){this._frameTaskHandle&&this._frameTaskHandle.resume()}_updateLayerView(e){if(!e.attached)return void this.requestUpdate();const i=this.view.state,r=e.lastUpdateId;r!=null&&(this.stationary||e.moving)||(e.moving=!0,e.moveStart()),r!==i.id&&e.viewChange(),this.stationary&&e.moving&&(e.moving=!1,e.moveEnd()),e.lastUpdateId=i.id,e.updateRequested&&e.processUpdate(this._updateParameters),"layerViews"in e&&e.layerViews.forEach(this._updateLayerView,this)}};function Tn(){return Promise.all([ee(()=>import("./webglDeps-821075ed.js"),["./webglDeps-821075ed.js","./ShaderCompiler-77d0dcb6.js","./programUtils-f035fe8a.js","./ProgramTemplate-e0452ecc.js"],import.meta.url),ee(()=>import("./mapViewDeps-953b0be5.js"),["./mapViewDeps-953b0be5.js","./CIMResourceManager-95d877f0.js","./Rasterizer-2a7f140e.js","./_commonjsHelpers-2f3e7994.js","./cimAnalyzer-02b73f26.js","./BidiEngine-836b7ef6.js","./GeometryUtils-53652037.js","./enums-4b2a86a0.js","./alignmentUtils-ae955d28.js","./definitions-19bfb61c.js","./number-b10bd8f5.js","./Rect-ea14f53a.js","./rasterizingUtils-ea810fad.js","./imageutils-96926fa1.js","./Container-2d36bc3e.js","./BufferPool-0122daa7.js","./enums-b1d611e3.js","./WGLContainer-576ad576.js","./WGLBrushVTLSymbol-b759c30b.js","./StyleDefinition-7d58136b.js","./GeometryUtils-dd03fc25.js","./color-803f68ad.js","./ShaderCompiler-77d0dcb6.js","./ProgramTemplate-e0452ecc.js","./MaterialKey-d0fce869.js","./utils-f5f1a968.js","./heatmapTextureUtils-0aa3a2bc.js","./VTLMaterialManager-241b1acb.js","./programUtils-f035fe8a.js","./MagnifierPrograms-fa51fd51.js","./Matcher-c4e44d26.js","./visualVariablesUtils-2780c14d.js","./visualVariablesUtils-6ff5fadd.js","./tileUtils-c2f19f52.js","./TurboLine-24df9e47.js","./ExpandedCIM-0010872c.js","./CircularArray-c86c79de.js","./ComputedAttributeStorage-167c4551.js","./arcadeTimeUtils-999b74fd.js","./executionError-fb3f283a.js","./centroid-d1553553.js","./MaterialPrograms-4b9f49a6.js","./GraphicsView2D-1264803b.js","./normalizeUtilsSync-e634818e.js","./projectionSupport-23b402d8.js","./json-48e3ea08.js","./AttributeStoreView-f7f49a44.js","./schemaUtils-5a41d104.js","./util-2bf6e249.js","./GraphicsView-bef23e3b.js","./GraphicContainer-acd65922.js","./BaseGraphicContainer-55978f65.js","./FeatureContainer-83da4bfd.js","./TileContainer-931ccd0f.js"],import.meta.url)])}const GO=()=>Tn().then(()=>ee(()=>import("./TileLayerView2D-8095b348.js"),["./TileLayerView2D-8095b348.js","./Rasterizer-2a7f140e.js","./_commonjsHelpers-2f3e7994.js","./cimAnalyzer-02b73f26.js","./BidiEngine-836b7ef6.js","./GeometryUtils-53652037.js","./enums-4b2a86a0.js","./alignmentUtils-ae955d28.js","./definitions-19bfb61c.js","./number-b10bd8f5.js","./Rect-ea14f53a.js","./rasterizingUtils-ea810fad.js","./Container-2d36bc3e.js","./BufferPool-0122daa7.js","./enums-b1d611e3.js","./WGLContainer-576ad576.js","./WGLBrushVTLSymbol-b759c30b.js","./StyleDefinition-7d58136b.js","./GeometryUtils-dd03fc25.js","./color-803f68ad.js","./ShaderCompiler-77d0dcb6.js","./ProgramTemplate-e0452ecc.js","./MaterialKey-d0fce869.js","./utils-f5f1a968.js","./heatmapTextureUtils-0aa3a2bc.js","./MagnifierPrograms-fa51fd51.js","./imageutils-96926fa1.js","./Matcher-c4e44d26.js","./visualVariablesUtils-2780c14d.js","./visualVariablesUtils-6ff5fadd.js","./tileUtils-c2f19f52.js","./TurboLine-24df9e47.js","./ExpandedCIM-0010872c.js","./CircularArray-c86c79de.js","./ComputedAttributeStorage-167c4551.js","./arcadeTimeUtils-999b74fd.js","./executionError-fb3f283a.js","./centroid-d1553553.js","./GraphicsView2D-1264803b.js","./normalizeUtilsSync-e634818e.js","./projectionSupport-23b402d8.js","./json-48e3ea08.js","./AttributeStoreView-f7f49a44.js","./schemaUtils-5a41d104.js","./util-2bf6e249.js","./GraphicsView-bef23e3b.js","./imageUtils-a68d09e3.js","./BitmapTileContainer-bb073189.js","./Bitmap-2a86165d.js","./TileContainer-931ccd0f.js","./LayerView2D-eda09360.js","./HighlightGraphicContainer-7bca2fe8.js","./BaseGraphicContainer-55978f65.js","./FeatureContainer-83da4bfd.js","./LayerView-7b372130.js","./RefreshableLayerView-cb757f22.js","./MapServiceLayerViewHelper-540289c1.js","./floorFilterUtils-080a7cd2.js","./sublayerUtils-01edef31.js","./popupUtils-8b1a1adb.js","./drapedUtils-11ce819c.js"],import.meta.url)),I2=()=>Tn().then(()=>ee(()=>import("./FeatureLayerView2D-8a595d6c.js"),["./FeatureLayerView2D-8a595d6c.js","./Container-2d36bc3e.js","./definitions-19bfb61c.js","./LayerView2D-eda09360.js","./schemaUtils-5a41d104.js","./enums-b1d611e3.js","./color-803f68ad.js","./enums-4b2a86a0.js","./number-b10bd8f5.js","./utils-f5f1a968.js","./MaterialKey-d0fce869.js","./alignmentUtils-ae955d28.js","./visualVariablesUtils-6ff5fadd.js","./cimAnalyzer-02b73f26.js","./BidiEngine-836b7ef6.js","./GeometryUtils-53652037.js","./Rect-ea14f53a.js","./ExpandedCIM-0010872c.js","./util-2bf6e249.js","./FeatureLayerView-2dcca551.js","./floorFilterUtils-080a7cd2.js","./popupUtils-8b1a1adb.js","./LayerView-7b372130.js","./RefreshableLayerView-cb757f22.js"],import.meta.url)),Gpe={"base-dynamic":()=>Tn().then(()=>ee(()=>import("./BaseDynamicLayerView2D-123e9445.js"),["./BaseDynamicLayerView2D-123e9445.js","./BitmapContainer-11eb2efa.js","./WGLContainer-576ad576.js","./definitions-19bfb61c.js","./WGLBrushVTLSymbol-b759c30b.js","./enums-b1d611e3.js","./number-b10bd8f5.js","./StyleDefinition-7d58136b.js","./enums-4b2a86a0.js","./GeometryUtils-dd03fc25.js","./color-803f68ad.js","./ShaderCompiler-77d0dcb6.js","./ProgramTemplate-e0452ecc.js","./MaterialKey-d0fce869.js","./alignmentUtils-ae955d28.js","./utils-f5f1a968.js","./heatmapTextureUtils-0aa3a2bc.js","./Container-2d36bc3e.js","./LayerView2D-eda09360.js","./ExportStrategy-db7a3a18.js","./Bitmap-2a86165d.js","./LayerView-7b372130.js","./RefreshableLayerView-cb757f22.js"],import.meta.url)),"base-tile":GO,"bing-maps":GO,csv:I2,"geo-rss":()=>Tn().then(()=>ee(()=>import("./GeoRSSLayerView2D-7cca87c4.js"),["./GeoRSSLayerView2D-7cca87c4.js","./LayerView2D-eda09360.js","./Container-2d36bc3e.js","./definitions-19bfb61c.js","./GraphicContainer-acd65922.js","./enums-b1d611e3.js","./BaseGraphicContainer-55978f65.js","./FeatureContainer-83da4bfd.js","./AttributeStoreView-f7f49a44.js","./visualVariablesUtils-2780c14d.js","./color-803f68ad.js","./enums-4b2a86a0.js","./number-b10bd8f5.js","./visualVariablesUtils-6ff5fadd.js","./TileContainer-931ccd0f.js","./WGLContainer-576ad576.js","./WGLBrushVTLSymbol-b759c30b.js","./StyleDefinition-7d58136b.js","./GeometryUtils-dd03fc25.js","./ShaderCompiler-77d0dcb6.js","./ProgramTemplate-e0452ecc.js","./MaterialKey-d0fce869.js","./alignmentUtils-ae955d28.js","./utils-f5f1a968.js","./heatmapTextureUtils-0aa3a2bc.js","./GraphicsView2D-1264803b.js","./cimAnalyzer-02b73f26.js","./BidiEngine-836b7ef6.js","./GeometryUtils-53652037.js","./Rect-ea14f53a.js","./normalizeUtilsSync-e634818e.js","./projectionSupport-23b402d8.js","./json-48e3ea08.js","./Matcher-c4e44d26.js","./tileUtils-c2f19f52.js","./TurboLine-24df9e47.js","./ExpandedCIM-0010872c.js","./schemaUtils-5a41d104.js","./util-2bf6e249.js","./ComputedAttributeStorage-167c4551.js","./arcadeTimeUtils-999b74fd.js","./executionError-fb3f283a.js","./centroid-d1553553.js","./GraphicsView-bef23e3b.js","./LayerView-7b372130.js"],import.meta.url)),feature:I2,geojson:I2,graphics:()=>Tn().then(()=>ee(()=>import("./GraphicsLayerView2D-9fe602eb.js"),["./GraphicsLayerView2D-9fe602eb.js","./LayerView2D-eda09360.js","./Container-2d36bc3e.js","./definitions-19bfb61c.js","./GraphicContainer-acd65922.js","./enums-b1d611e3.js","./BaseGraphicContainer-55978f65.js","./FeatureContainer-83da4bfd.js","./AttributeStoreView-f7f49a44.js","./visualVariablesUtils-2780c14d.js","./color-803f68ad.js","./enums-4b2a86a0.js","./number-b10bd8f5.js","./visualVariablesUtils-6ff5fadd.js","./TileContainer-931ccd0f.js","./WGLContainer-576ad576.js","./WGLBrushVTLSymbol-b759c30b.js","./StyleDefinition-7d58136b.js","./GeometryUtils-dd03fc25.js","./ShaderCompiler-77d0dcb6.js","./ProgramTemplate-e0452ecc.js","./MaterialKey-d0fce869.js","./alignmentUtils-ae955d28.js","./utils-f5f1a968.js","./heatmapTextureUtils-0aa3a2bc.js","./GraphicsView2D-1264803b.js","./cimAnalyzer-02b73f26.js","./BidiEngine-836b7ef6.js","./GeometryUtils-53652037.js","./Rect-ea14f53a.js","./normalizeUtilsSync-e634818e.js","./projectionSupport-23b402d8.js","./json-48e3ea08.js","./Matcher-c4e44d26.js","./tileUtils-c2f19f52.js","./TurboLine-24df9e47.js","./ExpandedCIM-0010872c.js","./schemaUtils-5a41d104.js","./util-2bf6e249.js","./ComputedAttributeStorage-167c4551.js","./arcadeTimeUtils-999b74fd.js","./executionError-fb3f283a.js","./centroid-d1553553.js","./GraphicsView-bef23e3b.js","./LayerView-7b372130.js"],import.meta.url)),group:()=>Tn().then(()=>ee(()=>import("./GroupLayerView2D-47355150.js"),["./GroupLayerView2D-47355150.js","./GroupContainer-ae387ee9.js","./WGLContainer-576ad576.js","./definitions-19bfb61c.js","./WGLBrushVTLSymbol-b759c30b.js","./enums-b1d611e3.js","./number-b10bd8f5.js","./StyleDefinition-7d58136b.js","./enums-4b2a86a0.js","./GeometryUtils-dd03fc25.js","./color-803f68ad.js","./ShaderCompiler-77d0dcb6.js","./ProgramTemplate-e0452ecc.js","./MaterialKey-d0fce869.js","./alignmentUtils-ae955d28.js","./utils-f5f1a968.js","./heatmapTextureUtils-0aa3a2bc.js","./Container-2d36bc3e.js","./LayerView2D-eda09360.js","./GroupLayerView-a68bc498.js","./LayerView-7b372130.js"],import.meta.url)),imagery:()=>Tn().then(()=>ee(()=>import("./ImageryLayerView2D-42b34a28.js"),["./ImageryLayerView2D-42b34a28.js","./RasterVFDisplayObject-92ec042c.js","./dataUtils-aa03c744.js","./WGLBrushVTLSymbol-b759c30b.js","./definitions-19bfb61c.js","./enums-b1d611e3.js","./number-b10bd8f5.js","./StyleDefinition-7d58136b.js","./enums-4b2a86a0.js","./GeometryUtils-dd03fc25.js","./WGLContainer-576ad576.js","./color-803f68ad.js","./ShaderCompiler-77d0dcb6.js","./ProgramTemplate-e0452ecc.js","./MaterialKey-d0fce869.js","./alignmentUtils-ae955d28.js","./utils-f5f1a968.js","./heatmapTextureUtils-0aa3a2bc.js","./Container-2d36bc3e.js","./LayerView2D-eda09360.js","./GraphicsView2D-1264803b.js","./cimAnalyzer-02b73f26.js","./BidiEngine-836b7ef6.js","./GeometryUtils-53652037.js","./Rect-ea14f53a.js","./normalizeUtilsSync-e634818e.js","./projectionSupport-23b402d8.js","./json-48e3ea08.js","./AttributeStoreView-f7f49a44.js","./visualVariablesUtils-2780c14d.js","./visualVariablesUtils-6ff5fadd.js","./Matcher-c4e44d26.js","./tileUtils-c2f19f52.js","./TurboLine-24df9e47.js","./ExpandedCIM-0010872c.js","./schemaUtils-5a41d104.js","./util-2bf6e249.js","./ComputedAttributeStorage-167c4551.js","./arcadeTimeUtils-999b74fd.js","./executionError-fb3f283a.js","./centroid-d1553553.js","./GraphicsView-bef23e3b.js","./HighlightGraphicContainer-7bca2fe8.js","./BaseGraphicContainer-55978f65.js","./FeatureContainer-83da4bfd.js","./TileContainer-931ccd0f.js","./BitmapContainer-11eb2efa.js","./Bitmap-2a86165d.js","./ExportStrategy-db7a3a18.js","./rasterProjectionHelper-2a66ec39.js","./ImageryLayerView-1596f988.js","./popupUtils-8b1a1adb.js","./LayerView-7b372130.js","./RefreshableLayerView-cb757f22.js"],import.meta.url)),"imagery-tile":()=>Tn().then(()=>ee(()=>import("./ImageryTileLayerView2D-9dba9983.js"),["./ImageryTileLayerView2D-9dba9983.js","./multidimensionalUtils-c3a0d565.js","./RasterVFDisplayObject-92ec042c.js","./dataUtils-aa03c744.js","./WGLBrushVTLSymbol-b759c30b.js","./definitions-19bfb61c.js","./enums-b1d611e3.js","./number-b10bd8f5.js","./StyleDefinition-7d58136b.js","./enums-4b2a86a0.js","./GeometryUtils-dd03fc25.js","./WGLContainer-576ad576.js","./color-803f68ad.js","./ShaderCompiler-77d0dcb6.js","./ProgramTemplate-e0452ecc.js","./MaterialKey-d0fce869.js","./alignmentUtils-ae955d28.js","./utils-f5f1a968.js","./heatmapTextureUtils-0aa3a2bc.js","./Container-2d36bc3e.js","./LayerView2D-eda09360.js","./TileContainer-931ccd0f.js","./RawBlockCache-62e1fd20.js","./rasterProjectionHelper-2a66ec39.js","./util-2bf6e249.js","./ImageryTileLayerView-0f75a8ab.js","./popupUtils-8b1a1adb.js","./LayerView-7b372130.js","./RefreshableLayerView-cb757f22.js"],import.meta.url)),kml:()=>Tn().then(()=>ee(()=>import("./KMLLayerView2D-ac4bca4a.js"),["./KMLLayerView2D-ac4bca4a.js","./kmlUtils-05d9f96b.js","./Bitmap-2a86165d.js","./BitmapContainer-11eb2efa.js","./WGLContainer-576ad576.js","./definitions-19bfb61c.js","./WGLBrushVTLSymbol-b759c30b.js","./enums-b1d611e3.js","./number-b10bd8f5.js","./StyleDefinition-7d58136b.js","./enums-4b2a86a0.js","./GeometryUtils-dd03fc25.js","./color-803f68ad.js","./ShaderCompiler-77d0dcb6.js","./ProgramTemplate-e0452ecc.js","./MaterialKey-d0fce869.js","./alignmentUtils-ae955d28.js","./utils-f5f1a968.js","./heatmapTextureUtils-0aa3a2bc.js","./Container-2d36bc3e.js","./LayerView2D-eda09360.js","./GraphicContainer-acd65922.js","./BaseGraphicContainer-55978f65.js","./FeatureContainer-83da4bfd.js","./AttributeStoreView-f7f49a44.js","./visualVariablesUtils-2780c14d.js","./visualVariablesUtils-6ff5fadd.js","./TileContainer-931ccd0f.js","./GraphicsView2D-1264803b.js","./cimAnalyzer-02b73f26.js","./BidiEngine-836b7ef6.js","./GeometryUtils-53652037.js","./Rect-ea14f53a.js","./normalizeUtilsSync-e634818e.js","./projectionSupport-23b402d8.js","./json-48e3ea08.js","./Matcher-c4e44d26.js","./tileUtils-c2f19f52.js","./TurboLine-24df9e47.js","./ExpandedCIM-0010872c.js","./schemaUtils-5a41d104.js","./util-2bf6e249.js","./ComputedAttributeStorage-167c4551.js","./arcadeTimeUtils-999b74fd.js","./executionError-fb3f283a.js","./centroid-d1553553.js","./GraphicsView-bef23e3b.js","./LayerView-7b372130.js","./rasterProjectionHelper-2a66ec39.js","./MaterialPrograms-4b9f49a6.js","./programUtils-f035fe8a.js"],import.meta.url)),"knowledge-graph":()=>Tn().then(()=>ee(()=>import("./KnowledgeGraphLayerView2D-29a47564.js"),["./KnowledgeGraphLayerView2D-29a47564.js","./LayerView2D-eda09360.js","./Container-2d36bc3e.js","./definitions-19bfb61c.js","./LayerView-7b372130.js"],import.meta.url)),"link-chart":()=>Tn().then(()=>ee(()=>import("./KnowledgeGraphLayerView2D-29a47564.js"),["./KnowledgeGraphLayerView2D-29a47564.js","./LayerView2D-eda09360.js","./Container-2d36bc3e.js","./definitions-19bfb61c.js","./LayerView-7b372130.js"],import.meta.url)),"knowledge-graph-sublayer":I2,"map-image":()=>Tn().then(()=>ee(()=>import("./MapImageLayerView2D-517fd836.js"),["./MapImageLayerView2D-517fd836.js","./BitmapContainer-11eb2efa.js","./WGLContainer-576ad576.js","./definitions-19bfb61c.js","./WGLBrushVTLSymbol-b759c30b.js","./enums-b1d611e3.js","./number-b10bd8f5.js","./StyleDefinition-7d58136b.js","./enums-4b2a86a0.js","./GeometryUtils-dd03fc25.js","./color-803f68ad.js","./ShaderCompiler-77d0dcb6.js","./ProgramTemplate-e0452ecc.js","./MaterialKey-d0fce869.js","./alignmentUtils-ae955d28.js","./utils-f5f1a968.js","./heatmapTextureUtils-0aa3a2bc.js","./Container-2d36bc3e.js","./LayerView2D-eda09360.js","./GraphicsView2D-1264803b.js","./cimAnalyzer-02b73f26.js","./BidiEngine-836b7ef6.js","./GeometryUtils-53652037.js","./Rect-ea14f53a.js","./normalizeUtilsSync-e634818e.js","./projectionSupport-23b402d8.js","./json-48e3ea08.js","./AttributeStoreView-f7f49a44.js","./visualVariablesUtils-2780c14d.js","./visualVariablesUtils-6ff5fadd.js","./Matcher-c4e44d26.js","./tileUtils-c2f19f52.js","./TurboLine-24df9e47.js","./ExpandedCIM-0010872c.js","./schemaUtils-5a41d104.js","./util-2bf6e249.js","./ComputedAttributeStorage-167c4551.js","./arcadeTimeUtils-999b74fd.js","./executionError-fb3f283a.js","./centroid-d1553553.js","./GraphicsView-bef23e3b.js","./HighlightGraphicContainer-7bca2fe8.js","./BaseGraphicContainer-55978f65.js","./FeatureContainer-83da4bfd.js","./TileContainer-931ccd0f.js","./ExportStrategy-db7a3a18.js","./Bitmap-2a86165d.js","./LayerView-7b372130.js","./MapImageLayerView-bc836ece.js","./ExportImageParameters-d7cdd086.js","./floorFilterUtils-080a7cd2.js","./sublayerUtils-01edef31.js","./RefreshableLayerView-cb757f22.js","./MapServiceLayerViewHelper-540289c1.js","./popupUtils-8b1a1adb.js","./drapedUtils-11ce819c.js"],import.meta.url)),"map-notes":()=>Tn().then(()=>ee(()=>import("./MapNotesLayerView2D-f544313b.js"),["./MapNotesLayerView2D-f544313b.js","./Container-2d36bc3e.js","./definitions-19bfb61c.js","./GroupContainer-ae387ee9.js","./WGLContainer-576ad576.js","./WGLBrushVTLSymbol-b759c30b.js","./enums-b1d611e3.js","./number-b10bd8f5.js","./StyleDefinition-7d58136b.js","./enums-4b2a86a0.js","./GeometryUtils-dd03fc25.js","./color-803f68ad.js","./ShaderCompiler-77d0dcb6.js","./ProgramTemplate-e0452ecc.js","./MaterialKey-d0fce869.js","./alignmentUtils-ae955d28.js","./utils-f5f1a968.js","./heatmapTextureUtils-0aa3a2bc.js","./LayerView2D-eda09360.js","./GraphicContainer-acd65922.js","./BaseGraphicContainer-55978f65.js","./FeatureContainer-83da4bfd.js","./AttributeStoreView-f7f49a44.js","./visualVariablesUtils-2780c14d.js","./visualVariablesUtils-6ff5fadd.js","./TileContainer-931ccd0f.js","./GraphicsView2D-1264803b.js","./cimAnalyzer-02b73f26.js","./BidiEngine-836b7ef6.js","./GeometryUtils-53652037.js","./Rect-ea14f53a.js","./normalizeUtilsSync-e634818e.js","./projectionSupport-23b402d8.js","./json-48e3ea08.js","./Matcher-c4e44d26.js","./tileUtils-c2f19f52.js","./TurboLine-24df9e47.js","./ExpandedCIM-0010872c.js","./schemaUtils-5a41d104.js","./util-2bf6e249.js","./ComputedAttributeStorage-167c4551.js","./arcadeTimeUtils-999b74fd.js","./executionError-fb3f283a.js","./centroid-d1553553.js","./GraphicsView-bef23e3b.js","./LayerView-7b372130.js"],import.meta.url)),media:()=>Tn().then(()=>ee(()=>import("./MediaLayerView2D-6626332b.js"),["./MediaLayerView2D-6626332b.js","./MediaElementView-c88dc21d.js","./normalizeUtilsSync-e634818e.js","./Rasterizer-2a7f140e.js","./_commonjsHelpers-2f3e7994.js","./cimAnalyzer-02b73f26.js","./BidiEngine-836b7ef6.js","./GeometryUtils-53652037.js","./enums-4b2a86a0.js","./alignmentUtils-ae955d28.js","./definitions-19bfb61c.js","./number-b10bd8f5.js","./Rect-ea14f53a.js","./rasterizingUtils-ea810fad.js","./Container-2d36bc3e.js","./BufferPool-0122daa7.js","./enums-b1d611e3.js","./WGLContainer-576ad576.js","./WGLBrushVTLSymbol-b759c30b.js","./StyleDefinition-7d58136b.js","./GeometryUtils-dd03fc25.js","./color-803f68ad.js","./ShaderCompiler-77d0dcb6.js","./ProgramTemplate-e0452ecc.js","./MaterialKey-d0fce869.js","./utils-f5f1a968.js","./heatmapTextureUtils-0aa3a2bc.js","./MagnifierPrograms-fa51fd51.js","./imageutils-96926fa1.js","./Matcher-c4e44d26.js","./visualVariablesUtils-2780c14d.js","./visualVariablesUtils-6ff5fadd.js","./tileUtils-c2f19f52.js","./TurboLine-24df9e47.js","./ExpandedCIM-0010872c.js","./CircularArray-c86c79de.js","./ComputedAttributeStorage-167c4551.js","./arcadeTimeUtils-999b74fd.js","./executionError-fb3f283a.js","./centroid-d1553553.js","./GraphicsView2D-1264803b.js","./projectionSupport-23b402d8.js","./json-48e3ea08.js","./AttributeStoreView-f7f49a44.js","./schemaUtils-5a41d104.js","./util-2bf6e249.js","./GraphicsView-bef23e3b.js","./perspectiveUtils-9d980892.js","./LayerView2D-eda09360.js","./LayerView-7b372130.js"],import.meta.url)),"ogc-feature":()=>Tn().then(()=>ee(()=>import("./OGCFeatureLayerView2D-4b3ca2b8.js"),["./OGCFeatureLayerView2D-4b3ca2b8.js","./FeatureLayerView2D-8a595d6c.js","./Container-2d36bc3e.js","./definitions-19bfb61c.js","./LayerView2D-eda09360.js","./schemaUtils-5a41d104.js","./enums-b1d611e3.js","./color-803f68ad.js","./enums-4b2a86a0.js","./number-b10bd8f5.js","./utils-f5f1a968.js","./MaterialKey-d0fce869.js","./alignmentUtils-ae955d28.js","./visualVariablesUtils-6ff5fadd.js","./cimAnalyzer-02b73f26.js","./BidiEngine-836b7ef6.js","./GeometryUtils-53652037.js","./Rect-ea14f53a.js","./ExpandedCIM-0010872c.js","./util-2bf6e249.js","./FeatureLayerView-2dcca551.js","./floorFilterUtils-080a7cd2.js","./popupUtils-8b1a1adb.js","./LayerView-7b372130.js","./RefreshableLayerView-cb757f22.js","./OGCFeatureLayerView-4babf317.js"],import.meta.url)),"open-street-map":GO,"oriented-imagery":I2,route:()=>Tn().then(()=>ee(()=>import("./RouteLayerView2D-3b38bc4d.js"),["./RouteLayerView2D-3b38bc4d.js","./Stop-96691457.js","./LayerView2D-eda09360.js","./Container-2d36bc3e.js","./definitions-19bfb61c.js","./GraphicContainer-acd65922.js","./enums-b1d611e3.js","./BaseGraphicContainer-55978f65.js","./FeatureContainer-83da4bfd.js","./AttributeStoreView-f7f49a44.js","./visualVariablesUtils-2780c14d.js","./color-803f68ad.js","./enums-4b2a86a0.js","./number-b10bd8f5.js","./visualVariablesUtils-6ff5fadd.js","./TileContainer-931ccd0f.js","./WGLContainer-576ad576.js","./WGLBrushVTLSymbol-b759c30b.js","./StyleDefinition-7d58136b.js","./GeometryUtils-dd03fc25.js","./ShaderCompiler-77d0dcb6.js","./ProgramTemplate-e0452ecc.js","./MaterialKey-d0fce869.js","./alignmentUtils-ae955d28.js","./utils-f5f1a968.js","./heatmapTextureUtils-0aa3a2bc.js","./GraphicsView2D-1264803b.js","./cimAnalyzer-02b73f26.js","./BidiEngine-836b7ef6.js","./GeometryUtils-53652037.js","./Rect-ea14f53a.js","./normalizeUtilsSync-e634818e.js","./projectionSupport-23b402d8.js","./json-48e3ea08.js","./Matcher-c4e44d26.js","./tileUtils-c2f19f52.js","./TurboLine-24df9e47.js","./ExpandedCIM-0010872c.js","./schemaUtils-5a41d104.js","./util-2bf6e249.js","./ComputedAttributeStorage-167c4551.js","./arcadeTimeUtils-999b74fd.js","./executionError-fb3f283a.js","./centroid-d1553553.js","./GraphicsView-bef23e3b.js","./LayerView-7b372130.js"],import.meta.url)),stream:()=>Tn().then(()=>ee(()=>import("./StreamLayerView2D-6e05d63e.js"),["./StreamLayerView2D-6e05d63e.js","./FeatureLayerView2D-8a595d6c.js","./Container-2d36bc3e.js","./definitions-19bfb61c.js","./LayerView2D-eda09360.js","./schemaUtils-5a41d104.js","./enums-b1d611e3.js","./color-803f68ad.js","./enums-4b2a86a0.js","./number-b10bd8f5.js","./utils-f5f1a968.js","./MaterialKey-d0fce869.js","./alignmentUtils-ae955d28.js","./visualVariablesUtils-6ff5fadd.js","./cimAnalyzer-02b73f26.js","./BidiEngine-836b7ef6.js","./GeometryUtils-53652037.js","./Rect-ea14f53a.js","./ExpandedCIM-0010872c.js","./util-2bf6e249.js","./FeatureLayerView-2dcca551.js","./floorFilterUtils-080a7cd2.js","./popupUtils-8b1a1adb.js","./LayerView-7b372130.js","./RefreshableLayerView-cb757f22.js"],import.meta.url)),"subtype-group":()=>Tn().then(()=>ee(()=>import("./SubtypeGroupLayerView2D-139759ad.js"),["./SubtypeGroupLayerView2D-139759ad.js","./FeatureLayerView2D-8a595d6c.js","./Container-2d36bc3e.js","./definitions-19bfb61c.js","./LayerView2D-eda09360.js","./schemaUtils-5a41d104.js","./enums-b1d611e3.js","./color-803f68ad.js","./enums-4b2a86a0.js","./number-b10bd8f5.js","./utils-f5f1a968.js","./MaterialKey-d0fce869.js","./alignmentUtils-ae955d28.js","./visualVariablesUtils-6ff5fadd.js","./cimAnalyzer-02b73f26.js","./BidiEngine-836b7ef6.js","./GeometryUtils-53652037.js","./Rect-ea14f53a.js","./ExpandedCIM-0010872c.js","./util-2bf6e249.js","./FeatureLayerView-2dcca551.js","./floorFilterUtils-080a7cd2.js","./popupUtils-8b1a1adb.js","./LayerView-7b372130.js","./RefreshableLayerView-cb757f22.js"],import.meta.url)),tile:GO,"vector-tile":()=>Tn().then(()=>ee(()=>import("./VectorTileLayerView2D-1fbf6511.js"),["./VectorTileLayerView2D-1fbf6511.js","./TileInfoViewPOT-ede78d65.js","./Rect-ea14f53a.js","./rasterizingUtils-ea810fad.js","./StyleDefinition-7d58136b.js","./enums-4b2a86a0.js","./enums-b1d611e3.js","./TileContainer-931ccd0f.js","./WGLContainer-576ad576.js","./definitions-19bfb61c.js","./WGLBrushVTLSymbol-b759c30b.js","./number-b10bd8f5.js","./GeometryUtils-dd03fc25.js","./color-803f68ad.js","./ShaderCompiler-77d0dcb6.js","./ProgramTemplate-e0452ecc.js","./MaterialKey-d0fce869.js","./alignmentUtils-ae955d28.js","./utils-f5f1a968.js","./heatmapTextureUtils-0aa3a2bc.js","./Container-2d36bc3e.js","./StyleRepository-063ad8a0.js","./colorUtils-c0f43caf.js","./GeometryUtils-53652037.js","./LayerView2D-eda09360.js","./LayerView-7b372130.js"],import.meta.url)),wcs:()=>Tn().then(()=>ee(()=>import("./ImageryTileLayerView2D-9dba9983.js"),["./ImageryTileLayerView2D-9dba9983.js","./multidimensionalUtils-c3a0d565.js","./RasterVFDisplayObject-92ec042c.js","./dataUtils-aa03c744.js","./WGLBrushVTLSymbol-b759c30b.js","./definitions-19bfb61c.js","./enums-b1d611e3.js","./number-b10bd8f5.js","./StyleDefinition-7d58136b.js","./enums-4b2a86a0.js","./GeometryUtils-dd03fc25.js","./WGLContainer-576ad576.js","./color-803f68ad.js","./ShaderCompiler-77d0dcb6.js","./ProgramTemplate-e0452ecc.js","./MaterialKey-d0fce869.js","./alignmentUtils-ae955d28.js","./utils-f5f1a968.js","./heatmapTextureUtils-0aa3a2bc.js","./Container-2d36bc3e.js","./LayerView2D-eda09360.js","./TileContainer-931ccd0f.js","./RawBlockCache-62e1fd20.js","./rasterProjectionHelper-2a66ec39.js","./util-2bf6e249.js","./ImageryTileLayerView-0f75a8ab.js","./popupUtils-8b1a1adb.js","./LayerView-7b372130.js","./RefreshableLayerView-cb757f22.js"],import.meta.url)),"web-tile":GO,wfs:I2,wms:()=>Tn().then(()=>ee(()=>import("./WMSLayerView2D-40c96c05.js"),["./WMSLayerView2D-40c96c05.js","./BitmapContainer-11eb2efa.js","./WGLContainer-576ad576.js","./definitions-19bfb61c.js","./WGLBrushVTLSymbol-b759c30b.js","./enums-b1d611e3.js","./number-b10bd8f5.js","./StyleDefinition-7d58136b.js","./enums-4b2a86a0.js","./GeometryUtils-dd03fc25.js","./color-803f68ad.js","./ShaderCompiler-77d0dcb6.js","./ProgramTemplate-e0452ecc.js","./MaterialKey-d0fce869.js","./alignmentUtils-ae955d28.js","./utils-f5f1a968.js","./heatmapTextureUtils-0aa3a2bc.js","./Container-2d36bc3e.js","./LayerView2D-eda09360.js","./ExportStrategy-db7a3a18.js","./Bitmap-2a86165d.js","./LayerView-7b372130.js","./RefreshableLayerView-cb757f22.js","./WMSLayerView-cef0556a.js","./ExportWMSImageParameters-b50dd82c.js"],import.meta.url)),wmts:()=>Tn().then(()=>ee(()=>import("./WMTSLayerView2D-dd2f47a7.js"),["./WMTSLayerView2D-dd2f47a7.js","./imageUtils-a68d09e3.js","./BitmapTileContainer-bb073189.js","./Bitmap-2a86165d.js","./WGLContainer-576ad576.js","./definitions-19bfb61c.js","./WGLBrushVTLSymbol-b759c30b.js","./enums-b1d611e3.js","./number-b10bd8f5.js","./StyleDefinition-7d58136b.js","./enums-4b2a86a0.js","./GeometryUtils-dd03fc25.js","./color-803f68ad.js","./ShaderCompiler-77d0dcb6.js","./ProgramTemplate-e0452ecc.js","./MaterialKey-d0fce869.js","./alignmentUtils-ae955d28.js","./utils-f5f1a968.js","./heatmapTextureUtils-0aa3a2bc.js","./Container-2d36bc3e.js","./TileContainer-931ccd0f.js","./LayerView2D-eda09360.js","./LayerView-7b372130.js","./RefreshableLayerView-cb757f22.js"],import.meta.url)),"line-of-sight":null,"base-elevation":null,"building-scene":null,dimension:null,elevation:null,"integrated-mesh":null,"point-cloud":null,voxel:null,scene:null,unknown:null,unsupported:null};function IAt(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",i=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new W(`${i}:view-not-supported`,`${e} is not supported in 2D`)}const jpe={hasLayerViewModule:t=>v(Gpe[t.type]),importLayerView:t=>{const e=Gpe[t.type];if(C(e))throw IAt(t);return e(t)}};function $At(t,e){const{spatialReference:i}=e,r=[e.x,e.y];let s=Number.POSITIVE_INFINITY,n=0,o=0;const a=[0,0],l=t.type==="extent"?[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]:t.rings;for(const c of l)for(let h=0;h<c.length-1;h++){P4e(a,r,c,h);const p=Hm(r,a);p<s&&(s=p,n=a[0],o=a[1])}return{coordinate:new pt({x:n,y:o,spatialReference:i}),distance:s}}var JX;let Bw=JX=class extends SZ($e){constructor(t){super(t),this.geometry=null,this.spatialReference=null}get normalizedGeometry(){if(C(this.geometry)||!this.spatialReference)return null;if(!this.spatialReference.equals(this.geometry.spatialReference))try{return tg(this.geometry,this.spatialReference)}catch(t){return oe.getLogger(this.declaredClass).error("#constraints.geometry","could not project the geometry to the view's spatial reference",{geometry:this.geometry,spatialReference:this.spatialReference,error:t}),null}return this.geometry}constrain(t,e){if(C(this.normalizedGeometry))return t;const i=t.targetGeometry;if(this.normalizedGeometry.type==="extent"?j6(this.normalizedGeometry,i):Bge(this.normalizedGeometry,i))return t;const{coordinate:r}=$At(this.normalizedGeometry,i);return r&&(t.targetGeometry=r),t}clone(){var t,e;return new JX({geometry:(t=this.geometry)==null?void 0:t.clone(),spatialReference:(e=this.spatialReference)==null?void 0:e.clone()})}};u([d({constructOnly:!0})],Bw.prototype,"geometry",void 0),u([d({readOnly:!0})],Bw.prototype,"normalizedGeometry",null),u([d({constructOnly:!0})],Bw.prototype,"spatialReference",void 0),Bw=JX=u([I("esri.views.2d.constraints.GeometryConstraint")],Bw);var KX;let yM=KX=class extends SZ($e){constructor(){super(...arguments),this.enabled=!0,this.rotationEnabled=!0}constrain(t,e){return this.enabled&&e&&(this.rotationEnabled||(t.rotation=e.rotation)),t}clone(){return new KX({enabled:this.enabled,rotationEnabled:this.rotationEnabled})}};u([d()],yM.prototype,"enabled",void 0),u([d()],yM.prototype,"rotationEnabled",void 0),yM=KX=u([I("esri.views.2d.constraints.RotationConstraint")],yM);const YPe=yM;var QX;let Pc=QX=class extends SZ($e){constructor(t){super(t),this._lodByScale={},this._scales=[],this.effectiveLODs=null,this.effectiveMinZoom=-1,this.effectiveMaxZoom=-1,this.effectiveMinScale=0,this.effectiveMaxScale=0,this.lods=null,this.minZoom=-1,this.maxZoom=-1,this.minScale=0,this.maxScale=0,this.snapToZoom=!0}initialize(){let t,{lods:e,minScale:i,maxScale:r,minZoom:s,maxZoom:n}=this,o=-1,a=-1,l=!1,c=!1;if(i!==0&&r!==0&&i<r&&([i,r]=[r,i]),!e||!e.length)return this._set("effectiveMinScale",i),void this._set("effectiveMaxScale",r);e=e.map(h=>h.clone()),e.sort((h,p)=>p.scale-h.scale),e.forEach((h,p)=>h.level=p);for(const h of e)!l&&i>0&&i>=h.scale&&(o=h.level,l=!0),!c&&r>0&&r>=h.scale&&(a=t?t.level:-1,c=!0),t=h;s===-1&&(s=i===0?0:o),n===-1&&(n=r===0?e.length-1:a),s=Math.max(s,0),s=Math.min(s,e.length-1),n=Math.max(n,0),n=Math.min(n,e.length-1),s>n&&([s,n]=[n,s]),i=e[s].scale,r=e[n].scale,e.splice(0,s),e.splice(n-s+1,e.length),e.forEach((h,p)=>{this._lodByScale[h.scale]=h,this._scales[p]=h.scale}),this._set("effectiveLODs",e),this._set("effectiveMinZoom",s),this._set("effectiveMaxZoom",n),this._set("effectiveMinScale",i),this._set("effectiveMaxScale",r)}constrain(t,e){if(e&&t.scale===e.scale)return t;const i=this.effectiveMinScale,r=this.effectiveMaxScale,s=t.targetGeometry,n=e&&e.targetGeometry,o=r!==0&&t.scale<r,a=i!==0&&t.scale>i;if(o||a){const l=a?i:r;if(e&&n){const c=(l-e.scale)/(t.scale-e.scale);s.x=n.x+(s.x-n.x)*c,s.y=n.y+(s.y-n.y)*c}t.scale=l}return this.snapToZoom&&this.effectiveLODs&&(t.scale=this._getClosestScale(t.scale)),t}fit(t){if(!this.effectiveLODs||!this.snapToZoom)return this.constrain(t,null);const e=this.scaleToZoom(t.scale),i=Math.abs(e-Math.floor(e));return t.scale=this.zoomToScale(i>.99?Math.round(e):Math.floor(e)),t}zoomToScale(t){if(!this.effectiveLODs)return 0;t-=this.effectiveMinZoom,t=Math.max(0,t);const e=this._scales;if(t<=0)return e[0];if(t>=e.length)return e[e.length-1];const i=Math.round(t-.5),r=Math.round(t);return e[r]+(r-t)*(e[i]-e[r])}scaleToZoom(t){if(!this.effectiveLODs)return-1;const e=this._scales;let i,r;if(t>=e[0])return this.effectiveMinZoom;if(t<=e[e.length-1])return this.effectiveMaxZoom;for(let s=0;s<e.length-1;s++){if(i=e[s],r=e[s+1],r===t)return s+this.effectiveMinZoom+1;if(i>t&&r<t)return s+this.effectiveMinZoom+1-(t-r)/(i-r)}return-1}snapToClosestScale(t){if(!this.effectiveLODs)return t;const e=this.scaleToZoom(t);return this.zoomToScale(Math.round(e))}snapToNextScale(t,e=.5){if(!this.effectiveLODs)return t*e;const i=Math.round(this.scaleToZoom(t));return this.zoomToScale(i+1)}snapToPreviousScale(t,e=2){if(!this.effectiveLODs)return t*e;const i=Math.round(this.scaleToZoom(t));return this.zoomToScale(i-1)}clone(){return new QX({lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})}_getClosestScale(t){return this._lodByScale[t]||(t=this._scales.reduce((e,i)=>Math.abs(i-t)<=Math.abs(e-t)?i:e,this._scales[0])),this._lodByScale[t].scale}};u([d({readOnly:!0})],Pc.prototype,"effectiveLODs",void 0),u([d({readOnly:!0})],Pc.prototype,"effectiveMinZoom",void 0),u([d({readOnly:!0})],Pc.prototype,"effectiveMaxZoom",void 0),u([d({readOnly:!0})],Pc.prototype,"effectiveMinScale",void 0),u([d({readOnly:!0})],Pc.prototype,"effectiveMaxScale",void 0),u([d()],Pc.prototype,"lods",void 0),u([d()],Pc.prototype,"minZoom",void 0),u([d()],Pc.prototype,"maxZoom",void 0),u([d()],Pc.prototype,"minScale",void 0),u([d()],Pc.prototype,"maxScale",void 0),u([d()],Pc.prototype,"snapToZoom",void 0),Pc=QX=u([I("esri.views.2d.constraints.ZoomConstraint")],Pc);const ZPe=Pc,LAt={base:null,key:"type",typeMap:{extent:Pi,polygon:md}};let xn=class extends $e{constructor(e){super(e),this.lods=null,this.minScale=0,this.maxScale=0,this.minZoom=-1,this.maxZoom=-1,this.rotationEnabled=!0,this.snapToZoom=!0}destroy(){this.view=null}get effectiveLODs(){return this._zoom.effectiveLODs}get effectiveMinScale(){return this._zoom.effectiveMinScale}get effectiveMaxScale(){return this._zoom.effectiveMaxScale}get effectiveMinZoom(){return this._zoom.effectiveMinZoom}get effectiveMaxZoom(){return this._zoom.effectiveMaxZoom}set geometry(e){e?this._set("geometry",e):this._set("geometry",null)}get version(){var e,i,r;return`${(e=this._zoom)==null?void 0:e.uid}/${(i=this._rotation)==null?void 0:i.uid}/${(r=this._geometry)==null?void 0:r.uid}`}get _defaultLODs(){var r,s,n;const e=(s=(r=this.view)==null?void 0:r.defaultsFromMap)==null?void 0:s.tileInfo,i=(n=this.view)==null?void 0:n.spatialReference;return e&&i&&e.spatialReference.equals(i)?e.lods:null}get _geometry(){var e;return new Bw({geometry:this.geometry,spatialReference:(e=this.view)==null?void 0:e.spatialReference})}get _rotation(){return new YPe({rotationEnabled:this.rotationEnabled})}get _zoom(){const e=this._get("_zoom"),i=this.lods||this._defaultLODs,r=this.minZoom,s=this.maxZoom,n=this.minScale,o=this.maxScale,a=this.snapToZoom;return e&&e.lods===i&&e.minZoom===r&&e.maxZoom===s&&e.minScale===n&&e.maxScale===o&&e.snapToZoom===a?e:new ZPe({lods:i,minZoom:r,maxZoom:s,minScale:n,maxScale:o,snapToZoom:a})}canZoomInTo(e){const i=this.effectiveMaxScale;return i===0||e>=i}canZoomOutTo(e){const i=this.effectiveMinScale;return i===0||e<=i}constrain(e,i){return this._zoom.constrain(e,i),this._rotation.constrain(e,i),this._geometry.constrain(e,i),e}constrainByGeometry(e){return this._geometry.constrain(e)}fit(e){return this._zoom.fit(e)}zoomToScale(e){return this._zoom.zoomToScale(e)}scaleToZoom(e){return this._zoom.scaleToZoom(e)}snapScale(e){return this._zoom.snapToClosestScale(e)}snapToNextScale(e){return this._zoom.snapToNextScale(e)}snapToPreviousScale(e){return this._zoom.snapToPreviousScale(e)}};u([d({readOnly:!0})],xn.prototype,"effectiveLODs",null),u([d({readOnly:!0})],xn.prototype,"effectiveMinScale",null),u([d({readOnly:!0})],xn.prototype,"effectiveMaxScale",null),u([d({readOnly:!0})],xn.prototype,"effectiveMinZoom",null),u([d({readOnly:!0})],xn.prototype,"effectiveMaxZoom",null),u([d({types:LAt,value:null})],xn.prototype,"geometry",null),u([d({type:[Wh]})],xn.prototype,"lods",void 0),u([d()],xn.prototype,"minScale",void 0),u([d()],xn.prototype,"maxScale",void 0),u([d()],xn.prototype,"minZoom",void 0),u([d()],xn.prototype,"maxZoom",void 0),u([d()],xn.prototype,"rotationEnabled",void 0),u([d()],xn.prototype,"snapToZoom",void 0),u([d()],xn.prototype,"view",void 0),u([d({readOnly:!0})],xn.prototype,"version",null),u([d()],xn.prototype,"_defaultLODs",null),u([d({type:Bw})],xn.prototype,"_geometry",null),u([d({type:YPe})],xn.prototype,"_rotation",null),u([d({readOnly:!0,type:ZPe})],xn.prototype,"_zoom",null),xn=u([I("esri.views.2d.MapViewConstraints")],xn);const JPe=xn;var eY,tY;let py=eY=class extends $e{constructor(){super(...arguments),this.left=0,this.top=0,this.right=0,this.bottom=0}clone(){return new eY({left:this.left,top:this.top,right:this.right,bottom:this.bottom})}};u([d()],py.prototype,"left",void 0),u([d()],py.prototype,"top",void 0),u([d()],py.prototype,"right",void 0),u([d()],py.prototype,"bottom",void 0),py=eY=u([I("esri.views.2d.PaddedViewState.Padding")],py);let FS=tY=class extends IX{constructor(...t){super(...t),this.paddedViewState=new IX,this._updateContent=(()=>{const e=et();return()=>{const i=this._get("size"),r=this._get("padding");if(!i||!r)return;const s=this.paddedViewState;It(e,r.left+r.right,r.top+r.bottom),ju(e,i,e),Fn(s.size,e);const n=s.viewpoint;n&&(this.viewpoint=n)}})(),this.addHandles(re(()=>[this.size,this.padding],()=>this._updateContent(),Wi)),this.padding=new py,this.size=[0,0]}set padding(t){this._set("padding",t||new py)}set viewpoint(t){if(t){const e=t.clone();this.paddedViewState.viewpoint=t,yxt(e,t,this._get("size"),this._get("padding"));const i=this._viewpoint2D,r=e.targetGeometry;i.center[0]=r.x,i.center[1]=r.y,i.rotation=e.rotation,i.scale=e.scale,i.spatialReference=r.spatialReference,this._update()}}clone(){return new tY({padding:this.padding.clone(),size:this.size.slice(),viewpoint:this.paddedViewState.viewpoint.clone(),pixelRatio:this.pixelRatio})}};u([d()],FS.prototype,"paddedViewState",void 0),u([d({type:py})],FS.prototype,"padding",null),u([d()],FS.prototype,"viewpoint",null),FS=tY=u([I("esri.views.2d.PaddedViewState")],FS);const DAt=FS;let NAt=class{constructor(e,i){this.item=e,this.controller=i,this.promise=null}},KPe=class{constructor(e){this._deferreds=new Map,this._controllers=new Map,this._processingItems=new Map,this._isPaused=!1,this._schedule=null,this._task=null,this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new P4(e.peeker),this.process=e.process;const i=e.scheduler;e.priority&&v(i)&&(this._task=i.registerTask(e.priority,this))}destroy(){this.clear(),this._schedule&&(this._schedule.remove(),this._schedule=null),this._task&&(this._task.remove(),this._task=null)}get length(){return this._processingItems.size+this._queue.length}abort(e){const i=this._controllers.get(e);i&&i.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(i=>e.push(i)),this._controllers.clear(),e.forEach(i=>i.abort()),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach((i,r)=>e(r))}get(e){const i=this._deferreds.get(e);return i?i.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._isPaused||(this._isPaused=!0,this._cancelNext())}push(e,i){const r=this.get(e);if(r)return r;const s=new AbortController;let n=null;i&&(n=ca(i,()=>s.abort()));const o=()=>{const h=this._processingItems.get(e);h&&h.controller.abort(),a(),c.reject(Bi())},a=()=>{l.remove(),v(n)&&n.remove(),this._deferreds.delete(e),this._controllers.delete(e),this._queue.remove(e),this._processingItems.delete(e),this._scheduleNext()},l=F6(s.signal,o),c=ky();return this._deferreds.set(e,c),this._controllers.set(e,s),c.promise.then(a,a),this._queue.push(e),this._scheduleNext(),c.promise}last(){return this._queue.last()}peek(){return this._queue.peek()}popLast(){return this._queue.popLast()}reset(){const e=[];this._processingItems.forEach(i=>e.push(i)),this._processingItems.clear();for(const i of e)this._queue.push(i.item),i.controller.abort();this._scheduleNext()}resume(){this._isPaused&&(this._isPaused=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}get running(){return!this._isPaused&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_scheduleNext(){this._task||this._isPaused||this._schedule||(this._schedule=rT(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(i))}_processError(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(i))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(C(e))return;let i;const r=new AbortController,s=new NAt(e,r);this._processingItems.set(e,s);try{i=this.process(e,r.signal)}catch(n){this._processError(s,n)}su(i)?(s.promise=i,i.then(n=>this._processResult(s,n),n=>this._processError(s,n))):this._processResult(s,i)}get test(){return{update:e=>this.runTask(e)}}};function FAt(t,e){return t.length=0,e.forEach(i=>t.push(i)),t}const Ez=new Set,GD=[],$2=new Map,Hpe=[0,0];let d_=class extends $e{constructor(e){super(e),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null}initialize(){const{concurrency:e,process:i}=this;this._queue=new KPe({concurrency:e,process:(r,s)=>{const n=this._keyToItem.get(r);return i(n,{signal:s})},peeker:r=>r.values().next().value})}destroy(){this.clear(),this._queue=Je(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}get updating(){return this.length>0||this.onGoingCount>0}abort(e){const i=typeof e=="string"?e:e.id;this._queue.abort(i)}clear(){this._queue.clear(),this._keyToItem.clear(),this.notifyChange("updating")}has(e){return typeof e=="string"?this._keyToItem.has(e):this._keyToItem.has(e.id)}isOngoing(e){const i=typeof e=="string"?e:e.id;return this.has(i)&&this._queue.isOngoing(i)}pause(){this._queue.pause()}push(e,i){const r=e.key.id+"-"+i;if(this.has(r))return this.get(r);const s=this._queue.push(r),n=()=>{this._keyToItem.delete(r),this.notifyChange("updating")};return this._keyToItem.set(r,e),s.then(n,n),this.notifyChange("updating"),s}reset(){this._queue.reset(),this.notifyChange("updating")}resume(){this._queue.resume()}_peekByScaleFirst(e){if(!this.state)return e.values().next().value;const i=this.tileInfoView;let r=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY;e.forEach(h=>{const p=this._keyToItem.get(h),f=this.tileInfoView.getTileScale(p.key);$2.has(f)||($2.set(f,[]),r=Math.max(f,r),s=Math.min(f,s)),$2.get(f).push(p.key),Ez.add(f)});let n=this.state.scale;$2.has(n)||(FAt(GD,Ez),GD.sort((h,p)=>h-p),n=GD.reduce((h,p)=>Math.abs(p-n)<Math.abs(h-n)?p:h,GD[0])),n=Math.min(n,r),n=Math.max(n,s);const o=$2.get(n),a=i.getClosestInfoForScale(n),l=a.getColumnForX(this.state.center[0]),c=a.getRowForY(this.state.center[1]);return o.sort((h,p)=>{const f=a.denormalizeCol(h.col,h.world),m=a.denormalizeCol(p.col,p.world);return Math.sqrt((l-f)*(l-f)+(c-h.row)*(c-h.row))-Math.sqrt((l-m)*(l-m)+(c-p.row)*(c-p.row))}),Ez.clear(),$2.clear(),o[0].id}_peekByCenterFirst(e){if(!this.state)return e.values().next().value;const i=this.tileInfoView,r=this.state.center;let s,n=Number.POSITIVE_INFINITY;return e.forEach(o=>{const a=this._keyToItem.get(o);i.getTileCoords(Hpe,a.key);const l=Hm(Hpe,r);l<n&&(n=l,s=a.key)}),s.id}};u([d({constructOnly:!0})],d_.prototype,"concurrency",void 0),u([d({constructOnly:!0})],d_.prototype,"process",void 0),u([d()],d_.prototype,"state",void 0),u([d({constructOnly:!0})],d_.prototype,"strategy",void 0),u([d({constructOnly:!0})],d_.prototype,"tileInfoView",void 0),u([d({readOnly:!0})],d_.prototype,"updating",null),d_=u([I("esri.views.2d.tiling.PagedTileQueue")],d_);function p_(t,e){return[t,e]}function pb(t,e,i){return t[0]=e,t[1]=i,t}function UAt(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}const Gd=new p1("0/0/0/0");let VAt=class QPe{static create(e,i,r=null){const s=Bp(e.spatialReference),n=i.origin||p_(e.origin.x,e.origin.y),o=p_(e.size[0]*i.resolution,e.size[1]*i.resolution),a=p_(-1/0,-1/0),l=p_(1/0,1/0),c=p_(1/0,1/0);v(r)&&(pb(a,Math.max(0,Math.floor((r.xmin-n[0])/o[0])),Math.max(0,Math.floor((n[1]-r.ymax)/o[1]))),pb(l,Math.max(0,Math.floor((r.xmax-n[0])/o[0])),Math.max(0,Math.floor((n[1]-r.ymin)/o[1]))),pb(c,l[0]-a[0]+1,l[1]-a[1]+1));const{cols:h,rows:p}=i;let f,m,y,_;return!r&&h&&p&&(pb(a,h[0],p[0]),pb(l,h[1],p[1]),pb(c,h[1]-h[0]+1,p[1]-p[0]+1)),e.isWrappable?(f=p_(Math.ceil(Math.round((s.valid[1]-s.valid[0])/i.resolution)/e.size[0]),c[1]),m=p_(Math.floor((s.origin[0]-n[0])/o[0]),a[1]),y=p_(f[0]+m[0]-1,l[1]),_=!0):(m=a,y=l,f=c,_=!1),new QPe(i.level,i.resolution,i.scale,n,a,l,c,o,m,y,f,_)}constructor(e,i,r,s,n,o,a,l,c,h,p,f){this.level=e,this.resolution=i,this.scale=r,this.origin=s,this.first=n,this.last=o,this.size=a,this.norm=l,this.worldStart=c,this.worldEnd=h,this.worldSize=p,this.wrap=f}normalizeCol(e){if(!this.wrap)return e;const i=this.worldSize[0];return e<0?i-1-Math.abs((e+1)%i):e%i}denormalizeCol(e,i){return this.wrap?this.worldSize[0]*i+e:e}getWorldForColumn(e){return this.wrap?Math.floor(e/this.worldSize[0]):0}getFirstColumnForWorld(e){return e*this.worldSize[0]+this.first[0]}getLastColumnForWorld(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(e){return(e-this.origin[0])/this.norm[0]}getXForColumn(e){return this.origin[0]+e*this.norm[0]}getRowForY(e){return(this.origin[1]-e)/this.norm[1]}getYForRow(e){return this.origin[1]-e*this.norm[1]}getTileBounds(e,i,r=!1){Gd.set(i);const s=r?Gd.col:this.denormalizeCol(Gd.col,Gd.world),n=Gd.row;return UAt(e,this.getXForColumn(s),this.getYForRow(n+1),this.getXForColumn(s+1),this.getYForRow(n)),e}getTileCoords(e,i,r=!1){Gd.set(i);const s=r?Gd.col:this.denormalizeCol(Gd.col,Gd.world);return Array.isArray(e)?pb(e,this.getXForColumn(s),this.getYForRow(Gd.row)):(e.x=this.getXForColumn(s),e.y=this.getYForRow(Gd.row)),e}},jC=class{constructor(){this.spans=[]}acquire(e){this.lodInfo=e}release(){this.lodInfo=null,this.spans.length=0}forEach(e,i){const{spans:r,lodInfo:s}=this,{level:n}=s;if(r.length!==0)for(const{row:o,colFrom:a,colTo:l}of r)for(let c=a;c<=l;c++)e.call(i,n,o,s.normalizeCol(c),s.getWorldForColumn(c))}};jC.pool=new yo(jC);let Cz=class{constructor(e,i,r){this.row=e,this.colFrom=i,this.colTo=r}};const Gs=new p1("0/0/0/0");let kAt=class eIe{static create(e,i){e[1]>i[1]&&([e,i]=[i,e]);const[r,s]=e,[n,o]=i,a=n-r,l=o-s,c=l!==0?a/l:0,h=(Math.ceil(s)-s)*c,p=(Math.floor(s)-s)*c;return new eIe(r,Math.floor(s),Math.ceil(o),c,a<0?h:p,a<0?p:h,a<0?n:r,a<0?r:n)}constructor(e,i,r,s,n,o,a,l){this.x=e,this.ymin=i,this.ymax=r,this.invM=s,this.leftAdjust=n,this.rightAdjust=o,this.leftBound=a,this.rightBound=l}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}};const _u=[[0,0],[0,0],[0,0],[0,0]],BAt=1e-6;let zAt=class{constructor(e,i=null){this.tileInfo=e,this.fullExtent=i,this.scales=[],this._infoByScale={},this._infoByLevel={};const r=e.lods.slice();r.sort((n,o)=>o.scale-n.scale);const s=this._lodInfos=r.map(n=>VAt.create(e,n,i));r.forEach((n,o)=>{this._infoByLevel[n.level]=s[o],this._infoByScale[n.scale]=s[o],this.scales[o]=n.scale},this),this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel[typeof e=="number"?e:e.level]}getTileBounds(e,i,r=!1){Gs.set(i);const s=this._infoByLevel[Gs.level];return s?s.getTileBounds(e,Gs,r):e}getTileCoords(e,i,r=!1){Gs.set(i);const s=this._infoByLevel[Gs.level];return s?s.getTileCoords(e,Gs,r):e}getTileCoverage(e,i=192,r="closest"){const s=r==="closest"?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),n=jC.pool.acquire(s),o=this._wrap;let a,l,c,h=1/0,p=-1/0;const f=n.spans;_u[0][0]=_u[0][1]=_u[1][1]=_u[3][0]=-i,_u[1][0]=_u[2][0]=e.size[0]+i,_u[2][1]=_u[3][1]=e.size[1]+i;for(const b of _u)e.toMap(b,b),b[0]=s.getColumnForX(b[0]),b[1]=s.getRowForY(b[1]);const m=[];let y=3;for(let b=0;b<4;b++){if(_u[b][1]===_u[y][1]){y=b;continue}const w=kAt.create(_u[b],_u[y]);h=Math.min(w.ymin,h),p=Math.max(w.ymax,p),m[w.ymin]===void 0&&(m[w.ymin]=[]),m[w.ymin].push(w),y=b}if(h==null||p==null||p-h>100)return null;let _=[];for(a=h;a<p;){m[a]!=null&&(_=_.concat(m[a])),l=1/0,c=-1/0;for(let b=_.length-1;b>=0;b--){const w=_[b];l=Math.min(l,w.getLeftCol()),c=Math.max(c,w.getRightCol())}if(l=Math.floor(l),c=Math.floor(c),a>=s.first[1]&&a<=s.last[1])if(o)if(s.size[0]<s.worldSize[0]){const b=Math.floor(c/s.worldSize[0]);for(let w=Math.floor(l/s.worldSize[0]);w<=b;w++)f.push(new Cz(a,Math.max(s.getFirstColumnForWorld(w),l),Math.min(s.getLastColumnForWorld(w),c)))}else f.push(new Cz(a,l,c));else l>s.last[0]||c<s.first[0]||(l=Math.max(l,s.first[0]),c=Math.min(c,s.last[0]),f.push(new Cz(a,l,c)));a+=1;for(let b=_.length-1;b>=0;b--){const w=_[b];w.ymax>=a?w.incrRow():_.splice(b,1)}}return n}getTileParentId(e){Gs.set(e);const i=this._infoByLevel[Gs.level],r=this._lodInfos.indexOf(i)-1;return r<0?null:(this._getTileIdAtLOD(Gs,this._lodInfos[r],Gs),Gs.id)}getTileResolution(e){const i=this._infoByLevel[typeof e=="object"?e.level:e];return i?i.resolution:-1}getTileScale(e){const i=this._infoByLevel[e.level];return i?i.scale:-1}intersects(e,i){Gs.set(i);const r=this._infoByLevel[Gs.level],s=e.lodInfo;if(s.resolution>r.resolution){this._getTileIdAtLOD(Gs,s,Gs);const o=s.denormalizeCol(Gs.col,Gs.world);for(const a of e.spans)if(a.row===Gs.row&&a.colFrom<=o&&a.colTo>=o)return!0}if(s.resolution<r.resolution){const[o,a,l,c]=e.spans.reduce((_,b)=>(_[0]=Math.min(_[0],b.row),_[1]=Math.max(_[1],b.row),_[2]=Math.min(_[2],b.colFrom),_[3]=Math.max(_[3],b.colTo),_),[1/0,-1/0,1/0,-1/0]),h=r.denormalizeCol(Gs.col,Gs.world),p=s.getColumnForX(r.getXForColumn(h)),f=s.getRowForY(r.getYForRow(Gs.row)),m=s.getColumnForX(r.getXForColumn(h+1))-1,y=s.getRowForY(r.getYForRow(Gs.row+1))-1;return!(p>c||m<l||f>a||y<o)}const n=s.denormalizeCol(Gs.col,Gs.world);return e.spans.some(o=>o.row===Gs.row&&o.colFrom<=n&&o.colTo>=n)}normalizeBounds(e,i,r){if(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],this._wrap){const s=Bp(this.tileInfo.spatialReference),n=-r*(s.valid[1]-s.valid[0]);e[0]+=n,e[2]+=n}return e}getSmallestInfoForScale(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>i[0])return this._infoByScale[i[0]];for(let r=1;r<i.length-1;r++)if(e>i[r]+BAt)return this._infoByScale[i[r-1]];return this._infoByScale[i[i.length-1]]}getClosestInfoForScale(e){const i=this.scales;return this._infoByScale[e]||(e=i.reduce((r,s)=>Math.abs(s-e)<Math.abs(r-e)?s:r,i[0])),this._infoByScale[e]}scaleToLevel(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let r=i.length-1;r>=0;r--)if(e<i[r])return r===i.length-1?this._infoByScale[i[i.length-1]].level:this._infoByScale[i[r]].level+(i[r]-e)/(i[r]-i[r+1]);return this._infoByScale[i[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}_getTileIdAtLOD(e,i,r){const s=this._infoByLevel[r.level];return e.set(r),i.resolution<s.resolution?null:(i.resolution===s.resolution||(e.level=i.level,e.col=Math.floor(r.col*s.resolution/i.resolution+.01),e.row=Math.floor(r.row*s.resolution/i.resolution+.01)),e)}};function GAt(t,e){return t.length=0,e.forEach(i=>t.push(i)),t}const Az=new Set,jD=[],L2=new Map,qpe=[0,0];let sy=class extends $e{constructor(e){super(e),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null}initialize(){const{concurrency:e,process:i,strategy:r}=this;this._queue=new KPe({concurrency:e,process:(s,n)=>{const o=this._keyToItem.get(s);return i(o,{signal:n})},peeker:r==="scale-first"?s=>this._peekByScaleFirst(s):s=>this._peekByCenterFirst(s)})}destroy(){this.clear(),this._queue=Je(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}get updating(){return this.length>0||this.onGoingCount>0}abort(e){const i=typeof e=="string"?e:e.id;this._queue.abort(i)}clear(){this._queue.clear(),this._keyToItem.clear(),this.notifyChange("updating")}has(e){return typeof e=="string"?this._keyToItem.has(e):this._keyToItem.has(e.id)}isOngoing(e){const i=typeof e=="string"?e:e.id;return this.has(i)&&this._queue.isOngoing(i)}pause(){this._queue.pause()}push(e){const i=e.key.id;if(this._queue.has(i))return this._queue.get(i);const r=this._queue.push(i),s=()=>{this._keyToItem.delete(i),this.notifyChange("updating")};return this._keyToItem.set(i,e),r.then(s,s),this.notifyChange("updating"),r}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(e){if(!this.state)return e.values().next().value;const i=this.tileInfoView;let r=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY;e.forEach(h=>{const p=this._keyToItem.get(h),f=this.tileInfoView.getTileScale(p.key);L2.has(f)||(L2.set(f,[]),r=Math.max(f,r),s=Math.min(f,s)),L2.get(f).push(p.key),Az.add(f)});let n=this.state.scale;L2.has(n)||(GAt(jD,Az),jD.sort((h,p)=>h-p),n=jD.reduce((h,p)=>Math.abs(p-n)<Math.abs(h-n)?p:h,jD[0])),n=Math.min(n,r),n=Math.max(n,s);const o=L2.get(n),a=i.getClosestInfoForScale(n),l=a.getColumnForX(this.state.center[0]),c=a.getRowForY(this.state.center[1]);return o.sort((h,p)=>{const f=a.denormalizeCol(h.col,h.world),m=a.denormalizeCol(p.col,p.world);return Math.sqrt((l-f)*(l-f)+(c-h.row)*(c-h.row))-Math.sqrt((l-m)*(l-m)+(c-p.row)*(c-p.row))}),Az.clear(),L2.clear(),o[0].id}_peekByCenterFirst(e){if(!this.state)return e.values().next().value;const i=this.tileInfoView,r=this.state.center;let s,n=Number.POSITIVE_INFINITY;return e.forEach(o=>{const a=this._keyToItem.get(o);i.getTileCoords(qpe,a.key);const l=Hm(qpe,r);l<n&&(n=l,s=a.key)}),s.id}};u([d({constructOnly:!0})],sy.prototype,"concurrency",void 0),u([d({constructOnly:!0})],sy.prototype,"process",void 0),u([d()],sy.prototype,"state",void 0),u([d({constructOnly:!0})],sy.prototype,"strategy",void 0),u([d({constructOnly:!0})],sy.prototype,"tileInfoView",void 0),u([d({readOnly:!0})],sy.prototype,"updating",null),sy=u([I("esri.views.2d.tiling.TileQueue")],sy);const Izt=sy;let jAt=class{constructor(e,i,r){this.maxSize=e,this._tileInfoView=i,this._removedFunc=r,this._tilePerId=new Map,this._tileKeysPerLevel=[]}has(e){return this._tilePerId.has(e)}get(e){return this._tilePerId.get(e)}pop(e){const i=this._tilePerId.get(e);if(!i)return;const r=i.key.level,s=this._tileKeysPerLevel[r];Wpe(this._tilePerId,e);for(let n=0;n<s.length;n++)if(s[n].id===e){s.splice(n,1);break}return i.visible=!0,i}add(e){e.visible=!1;const i=e.key,r=i.id;if(this._tilePerId.has(r))return;this._tilePerId.set(r,e);const s=i.level;this._tileKeysPerLevel[s]||(this._tileKeysPerLevel[s]=[]),this._tileKeysPerLevel[s].push(i)}prune(e,i,r){let s=this._tilePerId.size;if(s<=this.maxSize)return;let n=this._tileKeysPerLevel.length-1;for(;s>this.maxSize&&n>=0;)n!==e&&(s=this._pruneAroundCenterTile(s,i,r,n)),n--;s>this.maxSize&&(s=this._pruneAroundCenterTile(s,i,r,e))}_pruneAroundCenterTile(e,i,r,s){const n=this._tileKeysPerLevel[s];if(!n||n.length===0)return e;const{size:o,origin:a}=this._tileInfoView.tileInfo,l=r*o[0],c=r*o[1],h=[0,0],p=[0,0];for(n.sort((f,m)=>(h[0]=a.x+l*(f.col+.5),h[1]=a.y-c*(f.row+.5),p[0]=a.x+l*(m.col+.5),p[1]=a.y-c*(m.row+.5),EC(h,i)-EC(p,i)));n.length>0;){const f=n.pop();if(this._removeTile(f.id),--e===this.maxSize)break}return e}_removeTile(e){const i=this._tilePerId.get(e);this._removedFunc&&i&&this._removedFunc(i),Wpe(this._tilePerId,e)}};function Wpe(t,e){t.delete(e)}const fb=new p1(0,0,0,0),wh=new Map,D2=[],HD=[];let Lzt=class{constructor(e){this._previousScale=Number.POSITIVE_INFINITY,this.cachePolicy="keep",this.coveragePolicy="closest",this.resampling=!0,this.tileIndex=new Map,this.tiles=[],this.buffer=192,this.acquireTile=e.acquireTile,this.releaseTile=e.releaseTile,this.tileInfoView=e.tileInfoView,this.resampling=e.resampling==null||!!e.resampling,e.cachePolicy&&(this.cachePolicy=e.cachePolicy),e.coveragePolicy&&(this.coveragePolicy=e.coveragePolicy),e.buffer!=null&&(this.buffer=e.buffer),e.cacheSize&&(this._tileCache=new jAt(e.cacheSize,this.tileInfoView,i=>{this.releaseTile(i)}))}destroy(){this.tileIndex.clear()}update(e){const{resampling:i,tileIndex:r}=this,s=this.tileInfoView.getTileCoverage(e.state,this.buffer,this.coveragePolicy);if(HD.length=0,D2.length=0,wh.clear(),!s)return;const{minScale:n,maxScale:o}=this.tileInfoView.tileInfo,{spans:a,lodInfo:l}=s,{level:c}=l,{scale:h,center:p,resolution:f}=e.state,m=!e.stationary&&h>this._previousScale;if(this._previousScale=h,this.tiles.length=0,!i&&(h>n||h<o))return this.tiles.length=0,wh.clear(),r.forEach(w=>{this.releaseTile(w)}),r.clear(),HD.length=0,D2.length=0,wh.clear(),jC.pool.release(s),!0;r.forEach(w=>w.visible=!0);let y=0,_=0;if(a.length>0)for(const{row:w,colFrom:S,colTo:T}of a)for(let E=S;E<=T;E++){y++;const O=fb.set(c,w,l.normalizeCol(E),l.getWorldForColumn(E)).id;if(r.has(O)){const R=r.get(O);R.isReady?(wh.set(O,R),_++):m||this._addParentTile(O,wh)}else{let R;if(this._tileCache&&this._tileCache.has(O)){if(R=this._tileCache.pop(O),this.tileIndex.set(O,R),R.isReady){wh.set(O,R),_++;continue}}else R=this.acquireTile(fb),this.tileIndex.set(O,R);m||this._addParentTile(O,wh)}}const b=_===y;r.forEach((w,S)=>{if(fb.set(S),wh.has(S))return;const T=this.tileInfoView.intersects(s,fb),E=this.cachePolicy==="purge"?fb.level!==c:fb.level>c;!T||!m&&b?!E&&T||D2.push(S):w.isReady?E&&this.cachePolicy==="purge"&&this._hasReadyAncestor(fb,c)?D2.push(S):HD.push(S):E&&D2.push(S)});for(const w of HD){const S=r.get(w);S&&S.isReady&&wh.set(w,S)}for(const w of D2){const S=r.get(w);this._tileCache?this._tileCache.add(S):this.releaseTile(S),r.delete(w)}return wh.forEach(w=>this.tiles.push(w)),r.forEach(w=>{wh.has(w.key.id)||(w.visible=!1)}),this._tileCache&&this._tileCache.prune(c,p,f),jC.pool.release(s),wh.clear(),b}clear(e=!0){const{tileIndex:i}=this;e&&i.forEach(r=>{this.releaseTile(r)}),i.clear()}updateCacheSize(e){this._tileCache&&(this._tileCache.maxSize=e)}_addParentTile(e,i){let r=e,s=null;for(;r=this.tileInfoView.getTileParentId(r),r;)if(this.tileIndex.has(r)){if(s=this.tileIndex.get(r),s&&s.isReady){i.has(s.key.id)||i.set(s.key.id,s);break}}else if(this._tileCache&&this._tileCache.has(r)&&(s=this._tileCache.pop(r),this.tileIndex.set(r,s),s&&s.isReady)){i.has(s.key.id)||i.set(s.key.id,s);break}}_hasReadyAncestor(e,i){const r=ci();this.tileInfoView.getTileBounds(r,e,!0);for(const s of this.tileIndex.values())if(s.isReady&&s.key.level>=i&&s.key.level<e.level){const n=ci();if(this.tileInfoView.getTileBounds(n,s.key,!0),nG(n,r))return!0}return!1}},Xpe=class extends Kr{constructor(e,i){super(!0),this._view=e,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r,i))}_handleDoubleClick(e,i){w8(e.data,"primary")&&(e.stopPropagation(),i?this._view.mapViewNavigation.zoomOut([e.data.x,e.data.y]):this._view.mapViewNavigation.zoomIn([e.data.x,e.data.y]))}},HAt=class extends Kr{constructor(e,i,r){super(!0),this.view=e,this.pointerType=i,this.registerIncoming("double-tap-drag",r,s=>this._handleDoubleTapDrag(s))}_handleDoubleTapDrag(e){const{data:i}=e,{pointerType:r}=i;if(r!==this.pointerType)return;e.stopPropagation();const{action:s,delta:n}=i,{view:o}=this,{mapViewNavigation:a}=o;switch(s){case"begin":{const{scale:l}=o;this._startScale=l,this._currentScale=l,this._previousDelta=n,a.begin();break}case"update":{if(this._previousDelta.y===n.y)return;this._previousDelta=n;const l=1.015**n.y,c=this._startScale*l,h=c/this._currentScale;a.setViewpointImmediate(h),this._currentScale=c;break}case"end":{const{constraints:l}=o,{effectiveLODs:c,snapToZoom:h}=l;if(!h||!c)return void a.end();const p=l.snapScale(this._currentScale),f=(n.y>0?Math.max(p,l.snapToPreviousScale(this._startScale)):Math.min(p,l.snapToNextScale(this._startScale)))/this._currentScale;a.zoom(f);break}}}},qAt=class extends Kr{constructor(e,i,r){super(!0),this.view=e,this.pointerAction=i,this.registerIncoming("drag",r,s=>this._handleDrag(s)),this.registerIncoming("pointer-down",()=>this.stopMomentumNavigation())}onInstall(e){super.onInstall(e),this._dragEventSeparator=new RI({start:(i,r)=>{this.view.mapViewNavigation.pan.begin(this.view,r.data),r.stopPropagation()},update:(i,r)=>{this.view.mapViewNavigation.pan.update(this.view,r.data),r.stopPropagation()},end:(i,r)=>{this.view.mapViewNavigation.pan.end(this.view,r.data),r.stopPropagation()},condition:(i,r)=>i===1&&w8(r.data,this.pointerAction)})}_handleDrag(e){const i=this.view.mapViewNavigation;i.pinch.zoomMomentum||i.pinch.rotateMomentum?this.stopMomentumNavigation():this._dragEventSeparator.handle(e)}stopMomentumNavigation(){this.view.mapViewNavigation.pan.stopMomentumNavigation()}},WAt=class extends Kr{constructor(e,i,r){super(!0),this._view=e,this.pointerAction=i;const s=this._view.mapViewNavigation;this._dragEventSeparator=new RI({start:(n,o)=>{s.rotate.begin(this._view,o.data),o.stopPropagation()},update:(n,o)=>{s.rotate.update(this._view,o.data),o.stopPropagation()},end:(n,o)=>{s.rotate.end(),o.stopPropagation()},condition:(n,o)=>n===1&&w8(o.data,this.pointerAction)}),this.registerIncoming("drag",r,n=>this._dragEventSeparator.handle(n))}},XAt=class extends Kr{constructor(e){super(!0),this._view=e,this._frameTask=null,this._watchHandles=new Ki,this._currentDevice=null,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._handle=this.registerIncoming("gamepad",i=>this._handleGamePadEvent(i)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([re(()=>{var i;return(i=this._view.navigation.gamepad)==null?void 0:i.enabled},i=>{i?(this._handle.resume(),this._frameTask||(this._frameTask=By({update:r=>this._frameUpdate(r.deltaTime)}))):(this._handle.pause(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null))},Zt)])}onUninstall(){this._watchHandles.removeAll(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null),super.onUninstall()}_handleGamePadEvent(e){const i=this._view.navigation.gamepad.device;i&&e.data.device!==i||this._currentDevice&&this._currentDevice!==e.data.device||(e.data.action==="end"?(this._currentDevice=null,Hlt(this._transformation)):(this._currentDevice=e.data.device,kW(e.data,this._view.navigation.gamepad,this._transformation)))}_frameUpdate(e){const i=this._transformation;if(TF(i))return;const r=this._view.viewpoint.clone(),s=this._view.navigation.gamepad.velocityFactor,n=ZAt*s*e;Q8(r,r,[i.translation[0]*n,-i.translation[1]*n]);const o=1+i.translation[2]*JAt*e,a=this._view.constraints.rotationEnabled?-i.heading*YAt*e:0,l=this._view.size,c=[l[0]/2,l[1]];f3e(r,r,o,a,c,l);const h=this._view.constraints.constrain(r,this._view.viewpoint);this._view.viewpoint=h}};const YAt=.06,ZAt=.7,JAt=6e-4;let KAt=class extends Kr{constructor(e,i,r){super(!0),this.view=e,this.keys=i,this._pressed=!1,this._keyMap={[i.left]:"left",[i.right]:"right",[i.up]:"up",[i.down]:"down"},this.registerIncoming("key-down",r,s=>this._handleKeyDown(s)),this.registerIncoming("key-up",r,s=>this._handleKeyUp(s)),this.registerIncoming("blur",r,()=>this._handleBlur())}_handleKeyDown(e){e.data.repeat||this._handleKey(e,!0)}_handleKeyUp(e){this._handleKey(e,!1)}_handleBlur(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}_handleKey(e,i){const r=this._keyMap[e.data.key];if(this._pressed=r!=null,this._pressed){if(i)switch(this.view.mapViewNavigation.begin(),r){case"left":this.view.mapViewNavigation.continousPanLeft();break;case"right":this.view.mapViewNavigation.continousPanRight();break;case"up":this.view.mapViewNavigation.continousPanUp();break;case"down":this.view.mapViewNavigation.continousPanDown()}else this._pressed=!1,this.view.mapViewNavigation.stop();e.stopPropagation()}}},QAt=class extends Kr{constructor(e,i,r){super(!0),this.view=e,this.keys=i,this._pressed=!1,this._keyToDirection={[i.clockwiseOption1]:"clockwise",[i.clockwiseOption2]:"clockwise",[i.counterClockwiseOption1]:"counterClockwise",[i.counterClockwiseOption2]:"counterClockwise",[i.resetOption1]:"reset",[i.resetOption2]:"reset"},this.registerIncoming("key-down",r,s=>this._handleKeyDown(s)),this.registerIncoming("key-up",r,s=>this._handleKeyUp(s)),this.registerIncoming("blur",r,()=>this._handleBlur())}_handleKeyDown(e){e.data.repeat||this._handleKey(e,!0)}_handleKeyUp(e){this._handleKey(e,!1)}_handleBlur(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}_handleKey(e,i){const r=e.modifiers;if(r.size>0&&!r.has("Shift")||!this.view.constraints.rotationEnabled)return;const s=this._keyToDirection[e.data.key];if(this._pressed=s!=null,this._pressed){if(i)switch(this.view.mapViewNavigation.begin(),s){case"clockwise":this.view.mapViewNavigation.continousRotateClockwise();break;case"counterClockwise":this.view.mapViewNavigation.continousRotateCounterclockwise();break;case"reset":this.view.mapViewNavigation.resetRotation()}else this._pressed=!1,this.view.mapViewNavigation.stop();e.stopPropagation()}}};var lE;(function(t){t[t.IN=0]="IN",t[t.OUT=1]="OUT"})(lE||(lE={}));let eOt=class extends Kr{constructor(e,i,r){super(!0),this.view=e,this.keys=i,this._keysToZoomAction={},this.registerIncoming("key-down",r,s=>this._handleKeyDown(s)),i.zoomIn.forEach(s=>this._keysToZoomAction[s]=lE.IN),i.zoomOut.forEach(s=>this._keysToZoomAction[s]=lE.OUT)}_handleKeyDown(e){this._handleKey(e)}_handleKey(e){const i=e.modifiers;if(i.size>0&&!i.has("Shift"))return;const{key:r}=e.data;if(!(r in this._keysToZoomAction))return;const s=this._keysToZoomAction[r],{mapViewNavigation:n}=this.view;let o=null;switch(s){case lE.IN:o=n.zoomIn();break;case lE.OUT:o=n.zoomOut();break;default:return}n.begin(),o.then(()=>n.end()),e.stopPropagation()}};const tOt=.6;let iOt=class extends Kr{constructor(e,i){super(!0),this._view=e,this._canZoom=!0,this.registerIncoming("mouse-wheel",i,r=>this._handleMouseWheel(r))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled||(e.preventDefault(),e.stopPropagation(),!this._canZoom))return;const i=this._view.mapViewNavigation,{x:r,y:s,deltaY:n}=e.data,o=1/tOt**(1/60*n),a=i.zoom(o,[r,s]);a&&(this._canZoom=!1,a.catch(()=>{}).then(()=>{this._canZoom=!0,i.end()}))}},rOt=class extends Kr{constructor(e){super(!0),this.view=e,this.registerIncoming("drag",r=>this._handleDrag(r)),this.registerIncoming("pointer-down",()=>this._stopMomentumNavigation());const i=this.view.mapViewNavigation;this._dragEventSeparator=new RI({start:(r,s)=>{i.pinch.begin(this.view,s.data),s.stopPropagation()},update:(r,s)=>{i.pinch.update(this.view,s.data),s.stopPropagation()},end:(r,s)=>{i.pinch.end(this.view),s.stopPropagation()},condition:r=>r>=2})}_handleDrag(e){this._dragEventSeparator.handle(e)}_stopMomentumNavigation(){this.view.mapViewNavigation.pinch.stopMomentumNavigation()}},sOt=class extends Kr{constructor(e=sd.maximumDoubleClickDelay,i=sd.maximumDoubleClickDistance,r=sd.maximumDoubleTouchDelay,s=sd.maximumDoubleTouchDistance,n=jP){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=n,this._doubleTapDragReady=!1,this._doubleTapDragActive=!1,this._dragStartCenter=Ra(0,0),this._pointerState=new Map,this._doubleTapDrag=this.registerOutgoing("double-tap-drag"),this._dragEventSeparator=new RI({start:(o,a)=>this._dragStart(o,a),update:(o,a)=>this._dragUpdate(a),end:(o,a)=>this._dragEnd(a)}),this.registerIncoming("drag",o=>this._dragEventSeparator.handle(o)),this.registerIncoming("pointer-down",o=>this._handlePointerDown(o)),this.registerIncoming("pointer-up",()=>this._handlePointerUp())}onUninstall(){this._pointerState.forEach(e=>{e.doubleTapTimeout=Rr(e.doubleTapTimeout)})}get hasPendingInputs(){return Vo(this._pointerState,e=>e.doubleTapTimeout!=null)}_clearPointerDown(e){const i=this._pointerState.get(e);i&&(i.doubleTapTimeout=Rr(i.doubleTapTimeout),this._pointerState.delete(e),this.refreshHasPendingInputs())}_createDoubleTapDragData(e,i,r){const{button:s,buttons:n,pointer:o,pointers:a,pointerType:l,timestamp:c}=r;return{action:e,delta:i,button:s,buttons:n,pointer:o,pointers:a,pointerType:l,timestamp:c}}_dragStart(e,i){if(!this._doubleTapDragReady||e!==1)return;this._doubleTapDragReady=!1,this._doubleTapDragActive=!0;const{data:r,modifiers:s}=i,{center:n}=r;this._dragStartCenter=n;const o=this._createDoubleTapDragData("begin",Ra(0,0),r);this._doubleTapDrag.emit(o,void 0,s),i.stopPropagation()}_dragUpdate(e){if(!this._doubleTapDragActive)return;const{data:i,modifiers:r}=e,{center:s}=i,n=Ra(s.x-this._dragStartCenter.x,s.y-this._dragStartCenter.y),o=this._createDoubleTapDragData("update",n,i);this._doubleTapDrag.emit(o,void 0,r),e.stopPropagation()}_dragEnd(e){if(!this._doubleTapDragActive)return;const{data:i,modifiers:r}=e,{center:s}=i,n=Ra(s.x-this._dragStartCenter.x,s.y-this._dragStartCenter.y),o=this._createDoubleTapDragData("end",n,i);this._doubleTapDrag.emit(o,void 0,r),this._doubleTapDragActive=!1,e.stopPropagation()}_handlePointerDown(e){const{data:i}=e,r=dx(i),s=this._pointerState.get(r),{pointerType:n}=i.native;if(s){const o=n==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;this._clearPointerDown(r),XQ(s.event.data,i)>o?this._storePointerDown(e):this._doubleTapDragReady=!0}else this._storePointerDown(e)}_handlePointerUp(){this._doubleTapDragReady=!1}_storePointerDown(e){const{data:i}=e,{pointerType:r}=i.native,s=dx(i),n=r==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._clearPointerDown(s),n);this._pointerState.set(s,{event:e,doubleTapTimeout:o}),this.refreshHasPendingInputs()}};const qD={counter:"Ctrl",pan:{left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown"},zoom:{zoomIn:["=","+"],zoomOut:["-","_"]},rotate:{clockwiseOption1:"a",clockwiseOption2:"A",counterClockwiseOption1:"d",counterClockwiseOption2:"D",resetOption1:"n",resetOption2:"N"}};let yw=class extends $e{constructor(){super(...arguments),this._handles=new Ki}initialize(){const t=()=>{var e;return(e=this.view)==null?void 0:e.ready};this._handles.add([qo(()=>!t(),()=>this._disconnect()),qo(t,()=>this._connect())])}destroy(){this._handles=Je(this._handles),this._disconnect()}get latestPointerType(){var t;return(t=this._inputManager)==null?void 0:t.latestPointerType}get latestPointerLocation(){var t;return(t=this._inputManager)==null?void 0:t.latestPointerLocation}get multiTouchActive(){var t;return((t=this._inputManager)==null?void 0:t.multiTouchActive)??!1}_disconnect(){this.view.viewEvents.disconnect(),this._inputManager=Je(this._inputManager)}_connect(){const t=this.view.surface,e=new WQ(t,this.view.input),i=[new uCe,new hCe,new cCe,new aCe(this.view.navigation),new sOt],r=new hp({eventSource:e,recognizers:i});r.installHandlers("prevent-context-menu",[new oCe],Pm.INTERNAL),r.installHandlers("navigation",[new rOt(this.view),new XAt(this.view),new iOt(this.view),new Xpe(this.view),new Xpe(this.view,[qD.counter]),new qAt(this.view,"primary"),new KAt(this.view,qD.pan),new eOt(this.view,qD.zoom),new QAt(this.view,qD.rotate),new WAt(this.view,"secondary"),new HAt(this.view,"touch")],Pm.INTERNAL),this.view.viewEvents.connect(r),this._source=e,this._inputManager=r,re(()=>{var s,n;return(n=(s=this.view)==null?void 0:s.navigation)==null?void 0:n.browserTouchPanEnabled},s=>{this._source&&(this._source.browserTouchPanningEnabled=!s)},Zt)}get test(){return{inputManager:this._inputManager}}};u([d()],yw.prototype,"view",void 0),u([d()],yw.prototype,"latestPointerType",null),u([d()],yw.prototype,"latestPointerLocation",null),u([d()],yw.prototype,"multiTouchActive",null),yw=u([I("esri.views.2d.input.MapViewInputManager")],yw);const nOt=yw;var Ype,Zpe,Jpe,iY={},oOt={get exports(){return iY},set exports(t){iY=t}};Ype=oOt,Zpe=function(){function t(s,n,o,a,l){e(s,n,o||0,a||s.length-1,l||r)}function e(s,n,o,a,l){for(;a>o;){if(a-o>600){var c=a-o+1,h=n-o+1,p=Math.log(c),f=.5*Math.exp(2*p/3),m=.5*Math.sqrt(p*f*(c-f)/c)*(h-c/2<0?-1:1);e(s,n,Math.max(o,Math.floor(n-h*f/c+m)),Math.min(a,Math.floor(n+(c-h)*f/c+m)),l)}var y=s[n],_=o,b=a;for(i(s,o,n),l(s[a],y)>0&&i(s,o,a);_<b;){for(i(s,_,b),_++,b--;l(s[_],y)<0;)_++;for(;l(s[b],y)>0;)b--}l(s[o],y)===0?i(s,o,b):i(s,++b,a),b<=n&&(o=b+1),n<=b&&(a=b-1)}}function i(s,n,o){var a=s[n];s[n]=s[o],s[o]=a}function r(s,n){return s<n?-1:s>n?1:0}return t},(Jpe=Zpe())!==void 0&&(Ype.exports=Jpe);const aOt=iY;function b6(t,e){if(!(this instanceof b6))return new b6(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&(typeof e=="function"?this.toBBox=e:this._initFormat(e)),this.clear()}function lOt(t,e,i){if(!i)return e.indexOf(t);for(var r=0;r<e.length;r++)if(i(t,e[r]))return r;return-1}function N2(t,e){_M(t,0,t.children.length,e,t)}function _M(t,e,i,r,s){s||(s=US(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(var n,o=e;o<i;o++)n=t.children[o],vM(s,t.leaf?r(n):n);return s}function vM(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function Kpe(t,e){return t.minX-e.minX}function Qpe(t,e){return t.minY-e.minY}function Oz(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function WD(t){return t.maxX-t.minX+(t.maxY-t.minY)}function cOt(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function uOt(t,e){var i=Math.max(t.minX,e.minX),r=Math.max(t.minY,e.minY),s=Math.min(t.maxX,e.maxX),n=Math.min(t.maxY,e.maxY);return Math.max(0,s-i)*Math.max(0,n-r)}function Rz(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function XD(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function US(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function efe(t,e,i,r,s){for(var n,o=[e,i];o.length;)(i=o.pop())-(e=o.pop())<=r||(n=e+Math.ceil((i-e)/r/2)*r,aOt(t,n,e,i,s),o.push(e,n,n,i))}b6.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,i=[],r=this.toBBox;if(!XD(t,e))return i;for(var s,n,o,a,l=[];e;){for(s=0,n=e.children.length;s<n;s++)o=e.children[s],XD(t,a=e.leaf?r(o):o)&&(e.leaf?i.push(o):Rz(t,a)?this._all(o,i):l.push(o));e=l.pop()}return i},collides:function(t){var e=this.data,i=this.toBBox;if(!XD(t,e))return!1;for(var r,s,n,o,a=[];e;){for(r=0,s=e.children.length;r<s;r++)if(n=e.children[r],XD(t,o=e.leaf?i(n):n)){if(e.leaf||Rz(t,o))return!0;a.push(n)}e=a.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,i=t.length;e<i;e++)this.insert(t[e]);return this}var r=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var s=this.data;this.data=r,r=s}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=US([]),this},remove:function(t,e){if(!t)return this;for(var i,r,s,n,o=this.data,a=this.toBBox(t),l=[],c=[];o||l.length;){if(o||(o=l.pop(),r=l[l.length-1],i=c.pop(),n=!0),o.leaf&&(s=lOt(t,o.children,e))!==-1)return o.children.splice(s,1),l.push(o),this._condense(l),this;n||o.leaf||!Rz(o,a)?r?(i++,o=r.children[i],n=!1):o=null:(l.push(o),c.push(i),i=0,r=o,o=o.children[0])}return this},toBBox:function(t){return t},compareMinX:Kpe,compareMinY:Qpe,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},_build:function(t,e,i,r){var s,n=i-e+1,o=this._maxEntries;if(n<=o)return N2(s=US(t.slice(e,i+1)),this.toBBox),s;r||(r=Math.ceil(Math.log(n)/Math.log(o)),o=Math.ceil(n/Math.pow(o,r-1))),(s=US([])).leaf=!1,s.height=r;var a,l,c,h,p=Math.ceil(n/o),f=p*Math.ceil(Math.sqrt(o));for(efe(t,e,i,f,this.compareMinX),a=e;a<=i;a+=f)for(efe(t,a,c=Math.min(a+f-1,i),p,this.compareMinY),l=a;l<=c;l+=p)h=Math.min(l+p-1,c),s.children.push(this._build(t,l,h,r-1));return N2(s,this.toBBox),s},_chooseSubtree:function(t,e,i,r){for(var s,n,o,a,l,c,h,p;r.push(e),!e.leaf&&r.length-1!==i;){for(h=p=1/0,s=0,n=e.children.length;s<n;s++)l=Oz(o=e.children[s]),(c=cOt(t,o)-l)<p?(p=c,h=l<h?l:h,a=o):c===p&&l<h&&(h=l,a=o);e=a||e.children[0]}return e},_insert:function(t,e,i){var r=this.toBBox,s=i?t:r(t),n=[],o=this._chooseSubtree(s,this.data,e,n);for(o.children.push(t),vM(o,s);e>=0&&n[e].children.length>this._maxEntries;)this._split(n,e),e--;this._adjustParentBBoxes(s,n,e)},_split:function(t,e){var i=t[e],r=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,r);var n=this._chooseSplitIndex(i,s,r),o=US(i.children.splice(n,i.children.length-n));o.height=i.height,o.leaf=i.leaf,N2(i,this.toBBox),N2(o,this.toBBox),e?t[e-1].children.push(o):this._splitRoot(i,o)},_splitRoot:function(t,e){this.data=US([t,e]),this.data.height=t.height+1,this.data.leaf=!1,N2(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,i){var r,s,n,o,a,l,c,h;for(l=c=1/0,r=e;r<=i-e;r++)o=uOt(s=_M(t,0,r,this.toBBox),n=_M(t,r,i,this.toBBox)),a=Oz(s)+Oz(n),o<l?(l=o,h=r,c=a<c?a:c):o===l&&a<c&&(c=a,h=r);return h},_chooseSplitAxis:function(t,e,i){var r=t.leaf?this.compareMinX:Kpe,s=t.leaf?this.compareMinY:Qpe;this._allDistMargin(t,e,i,r)<this._allDistMargin(t,e,i,s)&&t.children.sort(r)},_allDistMargin:function(t,e,i,r){t.children.sort(r);var s,n,o=this.toBBox,a=_M(t,0,e,o),l=_M(t,i-e,i,o),c=WD(a)+WD(l);for(s=e;s<i-e;s++)n=t.children[s],vM(a,t.leaf?o(n):n),c+=WD(a);for(s=i-e-1;s>=e;s--)n=t.children[s],vM(l,t.leaf?o(n):n),c+=WD(l);return c},_adjustParentBBoxes:function(t,e,i){for(var r=i;r>=0;r--)vM(e[r],t)},_condense:function(t){for(var e,i=t.length-1;i>=0;i--)t[i].children.length===0?i>0?(e=t[i-1].children).splice(e.indexOf(t[i]),1):this.clear():N2(t[i],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};let tfe=class tIe{constructor(e,i){this.key=new p1(0,0,0,0),this.bounds=ci(),this.objectIds=new Set,this.key.set(i);const r=e.getLODInfoAt(this.key);this.tileInfoView=e,this.tileInfoView.getTileBounds(this.bounds,this.key,!0),this.resolution=r.resolution,this.scale=r.scale,this.level=r.level}get id(){return this.key.id}get extent(){return Pi.fromBounds(this.bounds,this.tileInfoView.tileInfo.spatialReference)}get transform(){return{originPosition:"upperLeft",scale:[this.resolution,this.resolution],translate:[this.bounds[0],this.bounds[3]]}}createChildTiles(){const e=this.key.getChildKeys(),i=tc.acquire();for(let r=0;r<e.length;r++)i[r]=new tIe(this.tileInfoView,e[r]);return i}getQuantizationParameters(){return Nbe.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})}};const mb={added:[],removed:[]},Mz=new Set,hOt=new p1(0,0,0,0);let dOt=class extends As{constructor(e){super(),this._tiles=new Map,this._index=b6(9,de("esri-csp-restrictions")?i=>({minX:i.bounds[0],minY:i.bounds[1],maxX:i.bounds[2],maxY:i.bounds[3]}):[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this.tiles=[],this.tileScheme=e}destroy(){this.clear()}clear(){this.tiles.length=0,this._tiles.clear(),this._index.clear()}has(e){return this._tiles.has(e)}get(e){return this._tiles.get(e)}boundsIntersections(e){return this._index.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]})}updateTiles(e){const i={added:[],removed:[]};for(const r of e.added)if(!this.has(r)){const s=new tfe(this.tileScheme,r);this._tiles.set(r,s),this._index.insert(s),i.added.push(s)}for(const r of e.removed)if(this.has(r)){const s=this.get(r);this._tiles.delete(r),this._index.remove(s),i.removed.push(s)}this.tiles.length=0,this._tiles.forEach(r=>this.tiles.push(r)),(i.added.length||i.removed.length)&&this.emit("update",i)}setViewState(e){const i=this.tileScheme.getTileCoverage(e,0);if(!i)return;const{spans:r,lodInfo:s}=i,{level:n}=s;if(r.length>0)for(const{row:o,colFrom:a,colTo:l}of r)for(let c=a;c<=l;c++){const h=hOt.set(n,o,s.normalizeCol(c),s.getWorldForColumn(c)).id;if(Mz.add(h),!this.has(h)){const p=new tfe(this.tileScheme,h);this._tiles.set(h,p),this._index.insert(p),this.tiles.push(p),mb.added.push(p)}}for(let o=this.tiles.length-1;o>=0;o--){const a=this.tiles[o];Mz.has(a.id)||(this._tiles.delete(a.id),this.tiles.splice(o,1),this._index.remove(a),mb.removed.push(a))}(mb.added.length||mb.removed.length)&&this.emit("update",mb),jC.pool.release(i),Mz.clear(),mb.added.length=0,mb.removed.length=0}},_w=class extends $e{constructor(){super(...arguments),this.color=new ot([0,255,255]),this.haloOpacity=1,this.fillOpacity=.25}equals(t){return this.color.equals(t.color)&&(this.haloColor||this.color).equals(t.haloColor||t.color)&&this.haloOpacity===t.haloOpacity&&this.fillOpacity===t.fillOpacity}};u([d({type:ot})],_w.prototype,"color",void 0),u([d({type:ot})],_w.prototype,"haloColor",void 0),u([d()],_w.prototype,"haloOpacity",void 0),u([d()],_w.prototype,"fillOpacity",void 0),_w=u([I("esri.views.2d.support.HighlightOptions")],_w);const iIe=_w,pOt=t=>t.includes("Brush");let rIe=class{constructor(){this._names=new Map}begin(e){this._names.has(e)||(this._names.set(e,!1),pOt(e)&&this.record("Esri.FirstDraw"),performance.mark(`Esri.${e}.Start`))}end(e){this._names.has(e)&&!this._names.get(e)&&(this._names.set(e,!0),performance.mark(`Esri.${e}.End`))}record(e){this._names.has(e)||(this._names.set(e,!0),performance.mark(`Esri.${e}`))}};function fOt(t,e,i,r,s,n,o,a){t.ignorePadding&&(r={left:0,right:0,top:0,bottom:0});let l=null;t.width!=null&&t.height!=null?l=[t.width,t.height]:t.width==null&&t.height!=null?l=[t.height,t.height]:t.width!=null&&t.height==null?l=[t.width,t.width]:t.width==null&&t.height==null&&(l=null);const c=i[0]-(r.left+r.right),h=i[1]-(r.top+r.bottom);let p,f,m=t.area||{x:0,y:0,width:c,height:h};if(l){const y=c/h,_=l[0]/l[1];if(_>y){const b=m.width/_;m={x:m.x,y:Math.round(m.y+(m.height-b)/2),width:m.width,height:Math.round(b)}}else{const b=m.height*_;m={x:Math.round(m.x+(m.width-b)/2),y:m.y,width:Math.round(b),height:m.height}}}else l=[m.width,m.height];return l[0]>m.width?(p=Math.min(l[0]/m.width,e),f=l[0]/m.width/p):(p=1,f=l[0]/m.width),{resolutionScale:p,cropArea:{x:Math.round((m.x+r.left)*p),y:Math.round((m.y+r.top)*p),width:Math.round(m.width*p),height:Math.round(m.height*p)},outputScale:f,format:s,quality:n,children:o,rotation:a}}let ZF=class extends WPe{constructor(t){super(t),this.components=["attribution","zoom"]}};u([d()],ZF.prototype,"components",void 0),ZF=u([I("esri.views.ui.2d.DefaultUI2D")],ZF);const sIe=ZF;var rY;let JF=rY=class extends Ie{constructor(t){super(t),this.color=new ot([0,0,0,1])}clone(){return new rY(ae({color:this.color}))}};u([d({type:ot,json:{write:!0}})],JF.prototype,"color",void 0),JF=rY=u([I("esri.webmap.background.ColorBackground")],JF);const mOt=JF;let nIe,oIe,aIe,lIe,cIe,uIe;async function gOt(){const[,{GraphicsView2D:t,GraphicContainer:e,LabelManager:i,MapViewNavigation:r,MagnifierView2D:s,Stage:n}]=await Promise.all([ee(()=>import("./webglDeps-821075ed.js"),["./webglDeps-821075ed.js","./ShaderCompiler-77d0dcb6.js","./programUtils-f035fe8a.js","./ProgramTemplate-e0452ecc.js"],import.meta.url),ee(()=>import("./mapViewDeps-953b0be5.js"),["./mapViewDeps-953b0be5.js","./CIMResourceManager-95d877f0.js","./Rasterizer-2a7f140e.js","./_commonjsHelpers-2f3e7994.js","./cimAnalyzer-02b73f26.js","./BidiEngine-836b7ef6.js","./GeometryUtils-53652037.js","./enums-4b2a86a0.js","./alignmentUtils-ae955d28.js","./definitions-19bfb61c.js","./number-b10bd8f5.js","./Rect-ea14f53a.js","./rasterizingUtils-ea810fad.js","./imageutils-96926fa1.js","./Container-2d36bc3e.js","./BufferPool-0122daa7.js","./enums-b1d611e3.js","./WGLContainer-576ad576.js","./WGLBrushVTLSymbol-b759c30b.js","./StyleDefinition-7d58136b.js","./GeometryUtils-dd03fc25.js","./color-803f68ad.js","./ShaderCompiler-77d0dcb6.js","./ProgramTemplate-e0452ecc.js","./MaterialKey-d0fce869.js","./utils-f5f1a968.js","./heatmapTextureUtils-0aa3a2bc.js","./VTLMaterialManager-241b1acb.js","./programUtils-f035fe8a.js","./MagnifierPrograms-fa51fd51.js","./Matcher-c4e44d26.js","./visualVariablesUtils-2780c14d.js","./visualVariablesUtils-6ff5fadd.js","./tileUtils-c2f19f52.js","./TurboLine-24df9e47.js","./ExpandedCIM-0010872c.js","./CircularArray-c86c79de.js","./ComputedAttributeStorage-167c4551.js","./arcadeTimeUtils-999b74fd.js","./executionError-fb3f283a.js","./centroid-d1553553.js","./MaterialPrograms-4b9f49a6.js","./GraphicsView2D-1264803b.js","./normalizeUtilsSync-e634818e.js","./projectionSupport-23b402d8.js","./json-48e3ea08.js","./AttributeStoreView-f7f49a44.js","./schemaUtils-5a41d104.js","./util-2bf6e249.js","./GraphicsView-bef23e3b.js","./GraphicContainer-acd65922.js","./BaseGraphicContainer-55978f65.js","./FeatureContainer-83da4bfd.js","./TileContainer-931ccd0f.js"],import.meta.url)]);oIe=t,aIe=e,lIe=i,cIe=r,uIe=s,nIe=n}const ife=160;function yOt(t){return t&&t.declaredClass==="esri.Viewpoint"}let vi=class extends Gve(RTe(DTe(KTe))){constructor(t){super(t),this._magnifierView=null,this._stage=null,this._resolveWhenReady=[],this.rootLayerViews=new TC({getCollections:()=>{var e,i;return[(e=this.basemapView)==null?void 0:e.baseLayerViews,this.layerViews,(i=this.basemapView)==null?void 0:i.referenceLayerViews]},getChildrenFunction:()=>null}),this.featuresTilingScheme=null,this.fullOpacity=1,this.graphicsView=null,this.labelManager=null,this.mapViewNavigation=null,this.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!0,labelsAnimationTime:125,labelCollisionsEnabled:!0},this.rendering=!1,this.supersampleScreenshotsEnabled=!0,this.supportsGround=!1,this._stationaryTimer=null,this._gotoTask=null,this.frameTask=new PAt(this),this._pePromise=null,this.floors=new Nt,this.highlightOptions=new iIe,this.inputManager=new nOt({view:this}),this.map=null,this.resizeAlign="center",this.spatialReferenceLocked=!1,this.timeline=new rIe,this.type="2d",this.ui=new sIe,this._pixelFormat={flipY:!0,premultipliedAlpha:!0},this.constraints=new JPe,this.padding={top:0,right:0,bottom:0,left:0},this.handles.add([re(()=>this.viewpoint,()=>{this._lastStationaryEventTimestamp=performance.now(),this._flipStationary(ife)},Wi),this.on("resize",e=>this._resizeHandler(e)),re(()=>{var e;return(e=this.animationManager)==null?void 0:e.animation},e=>{this.animation=e})]),s_e()}destroy(){this._set("preconditionsReady",!1),this._gotoTask=this.frameTask=null,this.rootLayerViews.destroy(),this.inputManager.destroy(),this._set("inputManager",null)}get graphicsTileStore(){return new dOt(this.featuresTilingScheme)}get initialExtentRequired(){var o;const{scale:t,constraints:e,center:i,viewpoint:r,extent:s}=this;let n=this.zoom;return!(this.map&&"initialViewProperties"in this.map&&((o=this.map.initialViewProperties)!=null&&o.viewpoint))&&!s&&(e!=null&&e.effectiveLODs||(n=-1),(!i||t===0&&n===-1)&&(!r||!v(r.targetGeometry)||r.targetGeometry.type!=="extent"&&!r.scale))}get resourceManager(){return this._stage.resourceManager}get textureManager(){return this._stage.painter.textureManager}get _defaultsFromMapSettings(){return{required:{tileInfo:!0,heightModelInfo:!1,extent:!1},requiresExtentInSpatialReference:this.spatialReferenceLocked}}get _projectionEngineLoaded(){return!!Mx()||(this._pePromise||(this._pePromise=Px().finally(()=>{this._pePromise=null})),!1)}get typeSpecificPreconditionsReady(){const t=this._getDefaultViewpoint();if(!t)return!1;const e=this.spatialReference,i=t.targetGeometry;return!!jm(i.spatialReference,e)||this._projectionEngineLoaded}set animation(t){const e=this._get("animation");if(t===e)return;if(e&&e.stop(),!t||t.isFulfilled())return void this._set("animation",null);this._set("animation",t),this.frameTask.animationInProgress=!0;const i=()=>{var r;t===this._get("animation")&&(this._set("animation",null),(r=this.frameTask)==null||r.requestFrame()),this.frameTask&&(this.frameTask.animationInProgress=!1)};t.when(i,i)}get background(){return _Ot(this.map)?this.map.initialViewProperties.background:null}set background(t){this._override("background",t)}get center(){if(!this.ready)return this._get("center");const{center:t,spatialReference:e}=this.state.paddedViewState;return new pt({x:t[0],y:t[1],spatialReference:e})}set center(t){if(t==null)return;if(!this.ready)return this._set("center",t),void this.notifyChange("initialExtentRequired");let e;try{e=this._project(t,this.spatialReference)}catch(r){return void oe.getLogger(this.declaredClass).error(new W("mapview:invalid-center","could not project the value in the view's spatial reference",{input:t,error:r}))}const i=this.viewpoint;MX(i,i,e),this.viewpoint=i}set constraints(t){const e=this._get("constraints");e&&(this.handles.remove("map-view-constraints"),e.destroy()),this._set("constraints",t),t&&(t.view=this,this.ready&&(this.state.viewpoint=t.fit(this.state.paddedViewState.viewpoint)),this.handles.add(re(()=>t.version,()=>{this.ready&&this.state&&(this.state.viewpoint=t.fit(this.state.paddedViewState.viewpoint))},Wi),"map-view-constraints"))}get extent(){return this.ready?this.state.paddedViewState.extent.clone():this._get("extent")}set extent(t){if(t==null)return;if(!t.width||!t.height)return void oe.getLogger(this.declaredClass).error(new W("mapview:invalid-extent","invalid extent size"));if(!this.ready)return this._set("extent",t),this._set("center",null),this._set("viewpoint",null),this._set("scale",0),this._set("zoom",-1),void this.notifyChange("initialExtentRequired");let e;try{e=this._project(t,this.spatialReference)}catch(r){return void oe.getLogger(this.declaredClass).error(new W("mapview:invalid-extent","could not project the value in the view's spatial reference",{error:r}))}const i=this.viewpoint;axt(i,i,e,this.size,{constraints:this.constraints}),this.viewpoint=i}get padding(){return this.ready?this.state.padding:this._get("padding")}set padding(t){this.ready?(this.state.padding=t,this._set("padding",this.state.padding)):this._set("padding",t)}get resolution(){return this.state?this.state.resolution:0}get rotation(){return this.ready?this.state.rotation:this._get("rotation")}set rotation(t){if(isNaN(t))return;if(!this.ready)return void this._set("rotation",t);const e=this.viewpoint;vxt(e,e,t),this.viewpoint=e}get scale(){return this.ready?this.state.scale:this._get("scale")}set scale(t){if(!t||isNaN(t))return;if(!this.ready){this._set("scale",t),this._set("zoom",-1);const i=this._get("extent");return i&&(this._set("extent",null),this._set("center",i.center)),void this.notifyChange("initialExtentRequired")}const e=this.viewpoint;lde(e,e,t),this.viewpoint=e}get stationary(){return!(this.animation||this.navigating||this.resizing||this._stationaryTimer)}get updating(){var e,i,r;const t=!this.destroyed&&(!this.layerViewManager||!this.labelManager||!this.graphicsView||this.layerViewManager.updating===!0||this.labelManager.updating===!0||this.graphicsView.updating===!0||this.allLayerViews.some(s=>!s.destroyed&&!("layerViews"in s)&&s.updating===!0));if(de("esri-2d-log-updating")){const s=this.allLayerViews.reduce((n,o)=>({...n,[o.layer.id]:!o.destroyed&&!("layerViews"in o)&&o.updating}),{});console.log(`Updating MapView: ${t}
-> Null LayerViewManager: ${!this.layerViewManager}
-> Null LabelManager: ${!this.labelManager}
-> Null GraphicsView: ${!this.graphicsView}
-> layerViewManager.updating: ${(e=this.layerViewManager)==null?void 0:e.updating}
-> labelManager.updating: ${(i=this.labelManager)==null?void 0:i.updating}
-> graphicsView.updating: ${(r=this.graphicsView)==null?void 0:r.updating}
-> allLayerViews: ${JSON.stringify(s)}
`)}return t}get viewpoint(){if(!this.ready)return this._get("viewpoint");const t=this.state.paddedViewState;return t&&t.viewpoint.clone()}set viewpoint(t){if(t==null)return;if(!this.ready)return this._set("viewpoint",t),this._set("extent",null),this._set("center",null),this._set("zoom",-1),this._set("scale",0),void this.notifyChange("initialExtentRequired");let e,i;try{e=this._project(t,this.spatialReference),!t.scale||isNaN(t.scale)?i=new W("mapview:invalid-viewpoint",`invalid scale value of ${t.scale}`):C(t.targetGeometry)&&(i=new W("mapview:invalid-viewpoint","geometry not defined"))}catch(s){i=new W("mapview:invalid-viewpoint","could not project the value in the view's spatial reference",{error:s})}if(i)return void oe.getLogger(this.declaredClass).error(i);this._scaleBeforeChangingSpatialReference=null;const r=new zo({targetGeometry:new pt,scale:0,rotation:0});uf(r,e),this.constraints.constrain(r,this.state.paddedViewState.viewpoint),this.state.viewpoint=r,this.frameTask.requestFrame(),this._set("viewpoint",r)}get zoom(){return this.ready?this.constraints.scaleToZoom(this.scale):this._get("zoom")}set zoom(t){if(t==null)return;if(!this.ready){this._set("zoom",t),this._set("scale",0);const i=this._get("extent");return i&&(this._set("extent",null),this._set("center",i.center)),void this.notifyChange("initialExtentRequired")}if(!this.constraints.effectiveLODs)return void this._set("zoom",-1);const e=this.viewpoint;lde(e,e,this.constraints.zoomToScale(t)),this.viewpoint=e,this._set("zoom",this.constraints.scaleToZoom(this.scale))}get navigating(){return!(!this.mapViewNavigation||!this.mapViewNavigation.interacting)}goTo(t,e){if(t)return this.animation&&(this.animation=null),this._createAnimation(),aC(()=>this.ready,e).then(()=>{var s;const i={animate:!0,...e},r=sxt(t,this);return(s=this.animation)==null||s.update(r),this._gotoTask={},i.animate?this._gotoAnimated(r,i):this._gotoImmediate(r,i)});oe.getLogger(this.declaredClass).error("#goTo()","target cannot be null or undefined")}async hitTest(t,e){const i=m5(t)?f5(this,t):t;if(!this.ready||isNaN(i.x)||isNaN(i.y))return{screenPoint:i,results:[]};let r=new Set,s=!1,n=null,o=null;e!=null&&e.include?sfe(e.include,rfe(this,h=>r.add(h),h=>{n||(n=new Set),n.add(h)},h=>r.add(h),()=>s=!0)):(s=!0,r=new Set(this.allLayerViews)),e!=null&&e.exclude&&sfe(e.exclude,rfe(this,h=>r.delete(h),h=>{o||(o=new Set),o.add(h)}));const a=this.allLayerViews.filter(h=>!h.suspended&&r.has(h)).reverse(),l=this.toMap(i);let c=[...s?this.graphicsView.hitTest(l).map(h=>({type:"graphic",graphic:h,layer:null,mapPoint:l})):[],...await Promise.all(a.map(h=>h.hitTest(l,i)).toArray())].filter(v).flat().filter(v);return n&&(c=c.filter(h=>!("graphic"in h)||!h.graphic||(n==null?void 0:n.has(sY(h.graphic))))),o&&(c=c.filter(h=>!("graphic"in h)||!h.graphic||(o==null?void 0:o.has(sY(h.graphic))))),{screenPoint:i,results:c}}async takeScreenshot(t){const e=this._createScreenshotPlan(t),i=await this._stage.takeScreenshot(e);return HF(i,{format:e.format,quality:e.quality,rotation:0,disableDecorations:!1},this._pixelFormat)}async _takeScreenshot(t){const e=this._createScreenshotPlan(t),i=await this._stage.takeScreenshot(e);return qF(i,this._pixelFormat)}_createScreenshotPlan(t){t=t??{};const e=this.supersampleScreenshotsEnabled?Math.min(4,UCt(this.size,Math.min(4096,this._stage.context.parameters.maxTextureSize))):1;let i;t.layers?(i=[],t.layers.forEach(n=>{const o=this.allLayerViews.find(a=>a.layer.id===n.id);o&&"container"in o&&o.container&&i.push(o.container)})):i=this._stage.children;const{format:r,quality:s}=FCt(t.format,t.quality);return fOt(t,e,this.size,this.padding,r,s,i,t.rotation)}get test(){return{takeScreenshot:t=>this._takeScreenshot(t)}}toMap(t){if(!this.ready)return null;const e=m5(t)?f5(this,t):t,i=[0,0],[r,s]=this.state.toMap(i,[e.x,e.y]),n=this.spatialReference;return new pt({x:r,y:s,spatialReference:n})}toScreen(t){if(!this.ready)return null;const e=this._project(t,this.spatialReference),i=[e.x,e.y];return this.state.toScreen(i,i),Ra(i[0],i[1])}on(t,e,i,r){return this.inputManager&&this.viewEvents.on(t,e,i,r)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}whenLayerView(t){return super.whenLayerView(t)}graphicChanged(t){this.graphicsView&&this.graphicsView.graphicUpdateHandler(t)}whenReady(){return new Promise(t=>{this.ready?t(this):this._resolveWhenReady.push(t)})}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var t,e,i;return this.map&&"initialViewProperties"in this.map&&((e=(t=this.map)==null?void 0:t.initialViewProperties)==null?void 0:e.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.spatialReference)||null}hasLayerViewModule(t){return jpe.hasLayerViewModule(t)}importLayerView(t){return jpe.importLayerView(t)}pixelSizeAt(){return this.ready?this.state.resolution:(oe.getLogger(this.declaredClass).error("#pixelSizeAt()","Map view cannot be used before it is ready"),null)}popupHitTest(t){return this.hitTest(t).then(e=>({...e,mapPoint:this.toMap(t)}))}requestUpdate(){this.ready&&this.frameTask.requestUpdate()}validate(){let t=BPe(this.type);return de("safari")&&de("safari")<9&&(t=new W("mapview:browser-not-supported","This browser is not supported by MapView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:de("safari")})),v(t)?(oe.getLogger(this.declaredClass).warn("#validate()",t.message),Promise.reject(t)):gOt()}_createAnimation(){return this.animation&&!this.animation.done||(this.animation=new Yy),this.animation}_cancellableGoTo(t,e,i){const r=()=>t===this._gotoTask,s=i.then(()=>{r()&&(this.animation=null)}).catch(o=>{throw r()&&(e&&!e.done&&(e.stop(),this.frameTask.animationInProgress=!1),this.animation=null),o}),n=new Promise(o=>o(s));return e.when().catch(()=>{r()&&n.cancel&&n.cancel()}),n}_gotoImmediate(t,e){const i=this._gotoTask,r=this.animation,s=t.then(n=>{if(gi(e),i!==this._gotoTask)throw new W("view:goto-interrupted","Goto was interrupted");this.viewpoint=r.target=n,r.finish()});return this._cancellableGoTo(i,r,s)}_flipStationary(t){return this._stationaryTimer!==null||(this._stationaryTimer=setTimeout(()=>{this._stationaryTimer=null;const e=performance.now()-this._lastStationaryEventTimestamp;e<ife&&(this._stationaryTimer=this._flipStationary(e))},t)),this._stationaryTimer}_getDefaultViewpoint(){var b,w,S,T;const{constraints:t,initialExtent:e,map:i,padding:r,size:s}=this;if(!t)return null;const n=i&&"initialViewProperties"in i?i.initialViewProperties:void 0,o={zoom:this._get("zoom"),scale:this._get("scale"),center:this._get("center"),extent:this._get("extent"),rotation:this._get("rotation"),viewpoint:this._get("viewpoint"),spatialReference:this._userSpatialReference};t.effectiveLODs?o.zoom!==-1&&(o.scale=t.zoomToScale(o.zoom)):o.zoom=-1;let a=null,l=null,c=0;const h=o.viewpoint&&o.viewpoint.rotation,p=o.viewpoint&&o.viewpoint.targetGeometry;v(p)&&(p.type==="extent"?a=p:p.type==="point"&&(l=p,c=o.viewpoint.scale));const f=o.extent||a||((w=(b=n==null?void 0:n.viewpoint)==null?void 0:b.targetGeometry)==null?void 0:w.extent)||e,m=o.center||l||(f==null?void 0:f.center),y=o.scale||c||((S=n==null?void 0:n.viewpoint)==null?void 0:S.scale)||f&&y3(f,[s[0]-r.left-r.right,s[1]-r.top-r.bottom]),_=o.rotation||h||((T=n==null?void 0:n.viewpoint)==null?void 0:T.rotation)||0;return m&&y?new zo({targetGeometry:m,scale:y,rotation:_}):null}_gotoAnimated(t,e){const i=this._gotoTask,r=this.animation;if(!r)return Promise.resolve();const s=t.then(n=>{if(gi(e),i!==this._gotoTask)throw new W("view:goto-interrupted","Goto was interrupted");return r.update(n),this.animationManager.animate(r,this.viewpoint,e),r.when().then(()=>{},()=>{})});return this._cancellableGoTo(i,r,s)}_project(t,e){var s;const i=t&&t.targetGeometry||t;if(!e)return t;if(!i)return null;if(e.imageCoordinateSystem||(s=i.spatialReference)!=null&&s.imageCoordinateSystem||rn(e,i.spatialReference))return t;const r=tg(i,e);if(!r)throw new W("mapview:projection-not-possible","projecting input geometry to target spatial reference returned a null value",{geometry:i,spatialReference:e});return yOt(t)?(t.targetGeometry=r,t):r}_resizeHandler(t){if(!this.ready)return;const e=this.state;let i=this.state.paddedViewState.viewpoint;const r=this.state.paddedViewState.size.concat();e.size=[t.width,t.height],_xt(i,i,r,this.state.paddedViewState.size,this.resizeAlign),i=this.constraints.constrain(i,void 0),this.state.viewpoint=i}_startup(){var a,l;this.timeline.begin("MapView Startup");const t=this._getDefaultViewpoint(),e=t.targetGeometry;try{this._project(t,this.spatialReference)}catch(c){oe.getLogger(this.declaredClass).warn(new dd("mapview:startup-projection-error","projection of initial viewpoint to the view's spatial reference, defaulting to the initial viewpoint.",{center:e.toJSON(),spatialReference:this.spatialReference,error:c})),t.targetGeometry=((a=this.defaultsFromMap.extent)==null?void 0:a.center)||new pt({x:0,y:0,spatialReference:this.spatialReference})}(l=this.constraints)==null||l.fit(t),this._set("state",new DAt({padding:this._get("padding"),size:this.size,viewpoint:t})),this.graphics.owner=this;const i=new nIe(this.surface,{canvas:this.renderCanvas,supersampleScreenshots:this.supersampleScreenshotsEnabled,contextOptions:{disabledExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions},renderingOptions:this.renderingOptions,timeline:this.timeline});this._stage=i,this._magnifierView=new uIe,this._magnifierView.magnifier=this.magnifier;const r=new lIe({view:this});this._set("labelManager",r);const s=new MAt({view:this});this._set("animationManager",s);const n=new cIe({view:this,animationManager:s});this._set("mapViewNavigation",n),this._setupSpatialReferenceDependentProperties(),this.handles.add([this.rootLayerViews.on("change",()=>this._updateStageChildren()),i.on("post-render",()=>this._set("rendering",i.renderRequested)),i.on("will-render",()=>this._set("rendering",i.renderRequested)),i.on("webgl-error",c=>this.fatalError=c.error),re(()=>this.stationary,c=>i.stationary=c,Br),re(()=>this.background,c=>{i.background=c,this._magnifierView.background=c},Br),re(()=>this.magnifier,c=>this._magnifierView.magnifier=c,Br),re(()=>this.renderingOptions,c=>i.renderingOptions=c,Br),re(()=>this.highlightOptions,c=>i.highlightOptions=c,Br),re(()=>this.state.id,()=>i.state=this.state,Br)],"map-view"),this._updateStageChildren();const o=this._resolveWhenReady;this._resolveWhenReady=[],o.forEach(c=>c(this)),this.timeline.end("MapView Startup"),this.frameTask&&this.frameTask.start(),this._set("ready",!0)}_teardown(){this._destroySpatialReferenceDependentProperties(),this.handles.remove("map-view"),this.mapViewNavigation.destroy(),this._set("mapViewNavigation",null),this.animationManager.destroy(),this._set("animationManager",null),this.layerViewManager.clear(),this.labelManager.destroy(),this._magnifierView.destroy(),this._stage.destroy(),this._stage=null,this._set("graphicsView",null),this._magnifierView=null,this._set("labelManager",null),this._set("mapViewNavigation",null),this.graphics.owner=null,this.frameTask&&this.frameTask.stop(),this._stationaryTimer&&(clearTimeout(this._stationaryTimer),this._stationaryTimer=null),this._set("ready",!1);const{center:[t,e],spatialReference:i,rotation:r,scale:s}=this.state.paddedViewState,n=new pt({x:t,y:e,spatialReference:i});this._set("viewpoint",null),this._set("extent",null),this._set("center",n),this._set("zoom",-1),this._set("rotation",r),this._set("scale",s),this._set("spatialReference",i),this._set("state",null),this.animation=null}_updateStageChildren(){this._stage.removeAllChildren(),this.rootLayerViews.forEach(e=>{this._stage.addChild(e.container)});const t=this.graphicsView;this._stage.addChild(t.container),this._stage.addChild(this._magnifierView)}_setupSpatialReferenceDependentProperties(){const t=new zAt(ZM.create({spatialReference:this.spatialReference,size:512,numLODs:36}));this._set("featuresTilingScheme",t);const e=new oIe({view:this,graphics:this.graphics,requestUpdateCallback:()=>this.requestUpdate(),container:new aIe(t)});this.frameTask.graphicsView=e,this._set("graphicsView",e)}_destroySpatialReferenceDependentProperties(){const t=this.graphicsView;this._set("graphicsView",null),this.frameTask.graphicsView=null,t.destroy(),this._set("featuresTilingScheme",null)}_spatialReferenceChanged(t){if(!this.ready)return;this.frameTask.stop();for(const a of this.allLayerViews)a.processDetach();this._destroySpatialReferenceDependentProperties();const e=this.state.paddedViewState.clone();if(C(this._scaleBeforeChangingSpatialReference))this._scaleBeforeChangingSpatialReference=e.scale;else{const a=e.viewpoint.clone();a.scale=this._scaleBeforeChangingSpatialReference,e.viewpoint=a}const i=e.clone(),[r,s]=e.center;let n=null;try{n=this._project(new pt({x:r,y:s,spatialReference:e.spatialReference}),t)}catch(a){Mx()||oe.getLogger(this.declaredClass).warn(new dd("mapview:spatial-reference-change","could not project the view's center to the new spatial reference",{center:n==null?void 0:n.toJSON(),spatialReference:t,error:a}))}n||(n=new pt({x:0,y:0,spatialReference:t}));const o=MX(new zo({targetGeometry:new pt,scale:0,rotation:0}),e.viewpoint,n);i.viewpoint=o;try{const l=[e.size[0]/2,e.size[1]/2],c=[l[0]+20,l[1]],h=e.toMap([0,0],c),{x:p,y:f}=this._project(new pt({x:h[0],y:h[1],spatialReference:e.spatialReference}),t);h[0]=p,h[1]=f,i.toScreen(h,h);const m=gxt(l,h,c),y=Math.hypot(h[0]-l[0],h[1]-l[1])/20;!Number.isFinite(y)||Math.abs(y)>4?(o.rotation=0,o.targetGeometry=new pt({x:0,y:0,spatialReference:t})):(o.scale*=y,o.scale>de("mapview-srswitch-adjust-rotation-scale-threshold")?o.rotation=0:o.rotation+=Number.isFinite(m)?m:0)}catch{}this._get("constraints").constrain(o,void 0),this._get("state").viewpoint=o,this._stage.state=this.state,this._setupSpatialReferenceDependentProperties();for(const a of this.allLayerViews)a.processAttach();this.frameTask.requestFrame(),this.frameTask.start(),this._updateStageChildren()}};vi.type="2d",u([d({readOnly:!0})],vi.prototype,"animationManager",void 0),u([d({constructOnly:!0})],vi.prototype,"deactivatedWebGLExtensions",void 0),u([d({constructOnly:!0})],vi.prototype,"debugWebGLExtensions",void 0),u([d({readOnly:!0})],vi.prototype,"featuresTilingScheme",void 0),u([d({readOnly:!0})],vi.prototype,"fullOpacity",void 0),u([d({readOnly:!0})],vi.prototype,"graphicsTileStore",null),u([d()],vi.prototype,"graphicsView",void 0),u([d({readOnly:!0})],vi.prototype,"state",void 0),u([d()],vi.prototype,"initialExtentRequired",null),u([d()],vi.prototype,"labelManager",void 0),u([d({readOnly:!0})],vi.prototype,"resourceManager",null),u([d({readOnly:!0})],vi.prototype,"textureManager",null),u([d({readOnly:!0})],vi.prototype,"mapViewNavigation",void 0),u([d({constructOnly:!0})],vi.prototype,"renderCanvas",void 0),u([d()],vi.prototype,"renderingOptions",void 0),u([d({readOnly:!0})],vi.prototype,"rendering",void 0),u([d({constructOnly:!0})],vi.prototype,"supersampleScreenshotsEnabled",void 0),u([d({readOnly:!0})],vi.prototype,"supportsGround",void 0),u([d()],vi.prototype,"_stationaryTimer",void 0),u([d()],vi.prototype,"_defaultsFromMapSettings",null),u([d()],vi.prototype,"_pePromise",void 0),u([d({readOnly:!0})],vi.prototype,"typeSpecificPreconditionsReady",null),u([d()],vi.prototype,"animation",null),u([d({type:mOt})],vi.prototype,"background",null),u([d({value:null,type:pt,dependsOn:["state.id","ready"]})],vi.prototype,"center",null),u([d({type:JPe})],vi.prototype,"constraints",null),u([d({value:null,type:Pi,dependsOn:["state.id","ready"]})],vi.prototype,"extent",null),u([d()],vi.prototype,"floors",void 0),u([d({type:iIe})],vi.prototype,"highlightOptions",void 0),u([d({readOnly:!0})],vi.prototype,"inputManager",void 0),u([d()],vi.prototype,"map",void 0),u([d({value:{top:0,right:0,bottom:0,left:0},cast:t=>({top:0,right:0,bottom:0,left:0,...t})})],vi.prototype,"padding",null),u([d()],vi.prototype,"resizeAlign",void 0),u([d({readOnly:!0,dependsOn:["state.id"]})],vi.prototype,"resolution",null),u([d({value:0,type:Number,dependsOn:["state.id","ready"]})],vi.prototype,"rotation",null),u([d({value:0,type:Number,dependsOn:["state.id","ready"]})],vi.prototype,"scale",null),u([d({constructOnly:!0})],vi.prototype,"spatialReferenceLocked",void 0),u([d()],vi.prototype,"stationary",null),u([d({type:rIe,readOnly:!0})],vi.prototype,"timeline",void 0),u([d({readOnly:!0})],vi.prototype,"type",void 0),u([d({readOnly:!0})],vi.prototype,"updating",null),u([d({value:null,type:zo,dependsOn:["state.id","ready"]})],vi.prototype,"viewpoint",null),u([d({value:-1,dependsOn:["state.id","ready"]})],vi.prototype,"zoom",null),u([d({readOnly:!0})],vi.prototype,"navigating",null),u([d({type:sIe})],vi.prototype,"ui",void 0),vi=u([I("esri.views.MapView")],vi);function sY(t){var i,r;const e=t.getObjectId();return e?`${((i=t.layer)==null?void 0:i.uid)??((r=t.sourceLayer)==null?void 0:r.uid)??"MapView"}/${e}`:`"MapView/${t.uid}`}function rfe(t,e,i,r,s){return n=>{if(n instanceof ha){if(n.layer===t)s==null||s();else{const o=t.allLayerViews.find(a=>a.layer===n.layer);o&&(r==null||r(o))}i(sY(n))}else{const o=t.allLayerViews.find(a=>a.layer===n);o&&e(o)}}}function sfe(t,e){if(t)if(C3(t))for(const i of t)if(C3(i))for(const r of i)e(r);else e(i);else e(t)}function _Ot(t){return(t==null?void 0:t.declaredClass)==="esri.WebMap"}const vOt=(t,e)=>{const i=t.__vccOpts||t;for(const[r,s]of e)i[r]=s;return i},bOt=t=>(y$e("data-v-1c8e77eb"),t=t(),_$e(),t),wOt=bOt(()=>I6("div",{id:"viewDiv"},null,-1)),xOt={__name:"HelloWorld",setup(t){function e(){const i=new UTe({basemap:"topo-vector",ground:"world-elevation"});new CAt({container:"viewDiv",map:i,scale:5e7,center:[-101.17,21.78]})}return(i,r)=>(Kfe(),oLe(bp,null,[I6("div",{onClick:e},"一切正常"),wOt],64))}},TOt=vOt(xOt,[["__scopeId","data-v-1c8e77eb"]]),SOt={__name:"App",setup(t){return(e,i)=>(Kfe(),aLe(TOt))}};qLe(SOt).mount("#app");export{Fi as $,Rr as A,C as B,Ar as C,Ho as D,Fe as E,Fve as F,EQ as G,ha as H,Dr as I,M as J,QBt as K,Yi as L,Bs as M,Dp as N,ks as O,rCt as P,oCt as Q,wS as R,xt as S,vd as T,zr as U,ktt as V,ft as W,Ve as X,jt as Y,NBt as Z,ee as _,Je as a,jm as a$,qv as a0,gi as a1,F6 as a2,ac as a3,fe as a4,dit as a5,QK as a6,KK as a7,b5 as a8,Ni as a9,f0e as aA,j2t as aB,Gi as aC,Hy as aD,Rme as aE,pWe as aF,Pi as aG,ig as aH,Lwe as aI,Ax as aJ,gl as aK,mt as aL,Gy as aM,tI as aN,Cr as aO,TJ as aP,KIt as aQ,KLe as aR,aTe as aS,lc as aT,WM as aU,uc as aV,hA as aW,e$t as aX,QIt as aY,t$t as aZ,M3t as a_,k6 as aa,gt as ab,jo as ac,wt as ad,yx as ae,Pt as af,it as ag,Ht as ah,kt as ai,gs as aj,Di as ak,ko as al,QLe as am,sl as an,ACt as ao,rIe as ap,By as aq,HP as ar,W as as,VCt as at,bB as au,nbt as av,hd as aw,we as ax,uI as ay,dCt as az,I as b,g7 as b$,oU as b0,uT as b1,KP as b2,As as b3,udt as b4,Rn as b5,sI as b6,pye as b7,BRt as b8,L5e as b9,Pee as bA,_T as bB,Fv as bC,EMe as bD,Ae as bE,Wkt as bF,Nn as bG,Ykt as bH,vMt as bI,x6e as bJ,pw as bK,Hkt as bL,E5 as bM,Zy as bN,yr as bO,TMt as bP,s4t as bQ,Ui as bR,en as bS,xCe as bT,Ts as bU,gU as bV,Jr as bW,aP as bX,It as bY,zi as bZ,Ku as b_,Mm as ba,Rt as bb,MWe as bc,Nt as bd,Br as be,VOt as bf,Kz as bg,qE as bh,lbt as bi,Bi as bj,qn as bk,qo as bl,kv as bm,QW as bn,a3 as bo,Wp as bp,pn as bq,eU as br,ds as bs,LOt as bt,su as bu,fn as bv,A as bw,ht as bx,VC as by,Gn as bz,Cm as c,zm as c$,Hx as c0,n8 as c1,x as c2,ou as c3,g0 as c4,We as c5,et as c6,Vi as c7,ji as c8,ki as c9,eet as cA,h8t as cB,wx as cC,NWe as cD,Gt as cE,_0 as cF,ym as cG,Wi as cH,I$t as cI,vU as cJ,Zye as cK,Kp as cL,Tbe as cM,vR as cN,bve as cO,$$t as cP,OOt as cQ,he as cR,v5 as cS,ZI as cT,PA as cU,ci as cV,DU as cW,P$t as cX,rn as cY,$r as cZ,_o as c_,Li as ca,Qt as cb,pc as cc,ui as cd,Ym as ce,S1 as cf,z as cg,uo as ch,li as ci,qi as cj,be as ck,je as cl,ue as cm,Pa as cn,nr as co,Kye as cp,Zkt as cq,Jkt as cr,Qkt as cs,PZ as ct,Ea as cu,KVe as cv,rU as cw,xMt as cx,af as cy,YBt as cz,COt as d,xde as d$,Et as d0,Oe as d1,TC as d2,j3 as d3,Fqe as d4,i5t as d5,r5t as d6,i5 as d7,Mht as d8,P4t as d9,ru as dA,Es as dB,Nie as dC,Wu as dD,t0e as dE,Vo as dF,yv as dG,Jl as dH,A3 as dI,yd as dJ,xd as dK,Q8e as dL,ut as dM,oot as dN,JBt as dO,dC as dP,ca as dQ,M3e as dR,ot as dS,Ji as dT,hD as dU,go as dV,VCe as dW,au as dX,NTt as dY,BVe as dZ,o3t as d_,R6t as da,yIt as db,aC as dc,xrt as dd,c3t as de,G6 as df,sT as dg,Px as dh,tg as di,OZ as dj,PV as dk,Lv as dl,Hz as dm,I3 as dn,bx as dp,Oi as dq,sme as dr,qc as ds,ve as dt,XJ as du,Uve as dv,Qp as dw,iU as dx,IZ as dy,fi as dz,u as e,k_e as e$,GE as e0,hC as e1,Y8e as e2,bd as e3,u3t as e4,si as e5,Ks as e6,fMe as e7,Um as e8,eA as e9,QOt as eA,cP as eB,tZ as eC,tr as eD,cf as eE,L4t as eF,N4t as eG,K2e as eH,Op as eI,Vht as eJ,dTt as eK,Kkt as eL,Cv as eM,ike as eN,Bo as eO,AU as eP,Joe as eQ,Die as eR,Hvt as eS,ll as eT,gIt as eU,OY as eV,FY as eW,DOt as eX,fPt as eY,km as eZ,V_e as e_,pi as ea,owe as eb,awe as ec,I4t as ed,rT as ee,w_e as ef,Xkt as eg,y4e as eh,S4t as ei,iDe as ej,ae as ek,U6 as el,Vy as em,WRt as en,jRt as eo,Mx as ep,cJ as eq,gy as er,rDt as es,Or as et,q5 as eu,Yp as ev,fr as ew,h9t as ex,mPt as ey,Gu as ez,$e as f,KPe as f$,In as f0,zve as f1,lye as f2,y1 as f3,lT as f4,tA as f5,Yt as f6,_qe as f7,WA as f8,GIt as f9,ua as fA,lRt as fB,ky as fC,Mp as fD,pt as fE,Uu as fF,L$ as fG,C4t as fH,fre as fI,b4t as fJ,idt as fK,aU as fL,cT as fM,G_t as fN,lee as fO,mI as fP,$n as fQ,jy as fR,Yye as fS,nG as fT,cvt as fU,IOt as fV,aOt as fW,Jz as fX,Bj as fY,_P as fZ,eRt as f_,lU as fa,jIt as fb,rI as fc,HIt as fd,cU as fe,eI as ff,zxe as fg,o6e as fh,zIt as fi,A4t as fj,wVe as fk,e1 as fl,z_t as fm,$dt as fn,Pdt as fo,wMt as fp,j4t as fq,G4t as fr,Xy as fs,SC as ft,jc as fu,Fo as fv,y8t as fw,Tee as fx,D4t as fy,sOe as fz,ir as g,IRt as g$,ar as g0,dRt as g1,yee as g2,AEt as g3,No as g4,_C as g5,vE as g6,Pm as g7,Ra as g8,eCe as g9,b6 as gA,xPt as gB,fMt as gC,NRt as gD,rAt as gE,zu as gF,Zp as gG,zc as gH,$6 as gI,W6 as gJ,fZ as gK,$Rt as gL,q6 as gM,H6 as gN,WIt as gO,XIt as gP,qIt as gQ,vbe as gR,mGe as gS,gGe as gT,TM as gU,Xge as gV,hZ as gW,F4e as gX,P4e as gY,v7 as gZ,uZ as g_,zo as ga,Q8 as gb,ms as gc,Xe as gd,iCe as ge,rCe as gf,p3e as gg,Gh as gh,f3e as gi,nxt as gj,Ekt as gk,gxt as gl,Fn as gm,Ckt as gn,Bp as go,YC as gp,DPt as gq,$v as gr,N4e as gs,wht as gt,g6e as gu,y4t as gv,qbe as gw,BPt as gx,$se as gy,jbe as gz,Zt as h,DBt as h$,DRt as h0,Xh as h1,gTe as h2,vTe as h3,_Te as h4,$Ke as h5,hm as h6,tP as h7,JU as h8,gd as h9,QC as hA,vIt as hB,v$t as hC,WKe as hD,qZe as hE,WZe as hF,XZe as hG,bqe as hH,Kqe as hI,l$t as hJ,YIt as hK,cJe as hL,_He as hM,Zbe as hN,UPt as hO,NPt as hP,Mje as hQ,jPt as hR,Lse as hS,ROt as hT,MOt as hU,FJe as hV,JK as hW,OC as hX,er as hY,sf as hZ,Vr as h_,yo as ha,RZ as hb,n5e as hc,ymt as hd,DY as he,yZ as hf,C$ as hg,Abe as hh,D4e as hi,Xw as hj,kS as hk,CM as hl,bVe as hm,sa as hn,Iv as ho,pre as hp,p1 as hq,HPt as hr,yHe as hs,mr as ht,IK as hu,zqe as hv,bIt as hw,Gqe as hx,_It as hy,vl as hz,k as i,He as i$,gHe as i0,Ybe as i1,u1 as i2,Bhe as i3,obt as i4,ZK as i5,NKe as i6,Vu as i7,nIt as i8,_l as i9,Wee as iA,O3t as iB,nT as iC,Ie as iD,XE as iE,Qe as iF,lt as iG,Rie as iH,Mbe as iI,vje as iJ,_je as iK,_1 as iL,VY as iM,Jke as iN,qRt as iO,Xi as iP,iNt as iQ,Qs as iR,sx as iS,os as iT,oG as iU,Fvt as iV,Kc as iW,nc as iX,eve as iY,sh as iZ,zt as i_,P4 as ia,Qm as ib,Ghe as ic,Wy as id,$i as ie,gI as ig,ul as ih,WYe as ii,Lt as ij,zZe as ik,GZe as il,jZe as im,WJ as io,MPt as ip,APt as iq,_p as ir,nHe as is,RPt as it,OPt as iu,Rp as iv,ZP as iw,vet as ix,dLt as iy,xVt as iz,as as j,oa as j$,sg as j0,$t as j1,of as j2,y0 as j3,i8 as j4,T1 as j5,R8 as j6,d1 as j7,I8 as j8,Eee as j9,VWe as jA,Wqe as jB,hK as jC,QP as jD,At as jE,UJe as jF,kOt as jG,a3t as jH,fve as jI,Aht as jJ,Xye as jK,yMt as jL,UOt as jM,UVt as jN,Nbe as jO,E4t as jP,Gc as jQ,Fbe as jR,KOt as jS,ZHe as jT,KPt as jU,Ad as jV,kft as jW,Qu as jX,Au as jY,ka as jZ,Wr as j_,M8 as ja,AA as jb,Xpt as jc,qK as jd,TA as je,dd as jf,MQe as jg,Jp as jh,hdt as ji,Yxt as jj,lDe as jk,cDe as jl,bQ as jm,eQ as jn,e9t as jo,vQ as jp,qx as jq,po as jr,kp as js,Fft as jt,ls as ju,Go as jv,Yr as jw,IIt as jx,lne as jy,WJe as jz,ln as k,$5e as k$,qm as k0,cs as k1,x1 as k2,EC as k3,w1 as k4,C8 as k5,i4t as k6,B_e as k7,d3t as k8,X6 as k9,URt as kA,LRt as kB,w4e as kC,O4e as kD,j6 as kE,PRt as kF,Age as kG,WFe as kH,GPt as kI,IPt as kJ,Wbe as kK,Bbe as kL,UU as kM,Nm as kN,pI as kO,Zje as kP,T4t as kQ,yAe as kR,_r as kS,rN as kT,PWe as kU,$It as kV,zRt as kW,GRt as kX,HRt as kY,L3 as kZ,Xu as k_,$Pt as ka,da as kb,Vs as kc,bPt as kd,HJ as ke,VGe as kf,rC as kg,Hme as kh,L6 as ki,GZ as kj,Ox as kk,B3 as kl,pv as km,Zu as kn,fUe as ko,nC as kp,mUe as kq,_Be as kr,PMt as ks,IMt as kt,kGe as ku,Pce as kv,kdt as kw,XRt as kx,g4t as ky,oye as kz,re as l,$ge as l$,CA as l0,$I as l1,zPt as l2,w0e as l3,Rx as l4,n3t as l5,Ua as l6,TE as l7,Q7e as l8,Cs as l9,T3t as lA,EVe as lB,CVe as lC,$x as lD,Xc as lE,l3t as lF,b3t as lG,w3t as lH,Hm as lI,RE as lJ,Pae as lK,ii as lL,wm as lM,Vke as lN,A3t as lO,vVe as lP,Si as lQ,Yn as lR,ps as lS,mE as lT,k6t as lU,xye as lV,pRt as lW,An as lX,ERt as lY,SRt as lZ,Dge as l_,nx as la,LV as lb,_x as lc,twt as ld,WG as le,Ws as lf,qG as lg,YG as lh,N4 as li,_Ve as lj,hVt as lk,oVt as ll,HB as lm,LN as ln,OF as lo,T1t as lp,S1t as lq,kw as lr,n_e as ls,cVt as lt,_Vt as lu,rRe as lv,lVt as lw,zAt as lx,ZM as ly,Qke as lz,vt as m,_d as m$,t_e as m0,i3t as m1,s3t as m2,r3t as m3,ju as m4,kx as m5,na as m6,Xn as m7,v0 as m8,rE as m9,Uy as mA,Get as mB,dn as mC,o2e as mD,i0 as mE,pJ as mF,nI as mG,Er as mH,NM as mI,TU as mJ,xve as mK,E3t as mL,S3t as mM,Xet as mN,Jet as mO,CRt as mP,TRt as mQ,xRt as mR,eh as mS,zw as mT,$ht as mU,WY as mV,qoe as mW,sNt as mX,Hoe as mY,QY as mZ,cl as m_,Ma as ma,D6t as mb,cX as mc,ARt as md,y7 as me,IU as mf,tPt as mg,iPt as mh,rPt as mi,sPt as mj,Ca as mk,NK as ml,nP as mm,Vye as mn,tn as mo,at as mp,xs as mq,x3t as mr,pke as ms,vS as mt,X_e as mu,c2e as mv,Kl as mw,Wv as mx,z6 as my,JY as mz,Sr as n,p3t as n$,fU as n0,vpt as n1,yl as n2,r8 as n3,nf as n4,fo as n5,Ovt as n6,AOt as n7,ax as n8,Vit as n9,hEe as nA,hT as nB,dJ as nC,oMt as nD,_3t as nE,gMt as nF,eg as nG,sJ as nH,O_e as nI,rf as nJ,DC as nK,ni as nL,la as nM,P8 as nN,ACe as nO,UCe as nP,Ct as nQ,Lr as nR,bMt as nS,hJ as nT,Rue as nU,ehe as nV,rP as nW,YP as nX,wi as nY,Hh as nZ,mie as n_,TDt as na,wDt as nb,xDt as nc,y3t as nd,lMt as ne,Y5 as nf,SAe as ng,tNt as nh,FK as ni,mR as nj,gE as nk,m7 as nl,Fa as nm,WE as nn,dE as no,$Y as np,sLt as nq,jP as nr,agt as ns,wpt as nt,Zx as nu,Am as nv,Ut as nw,LY as nx,O4t as ny,pm as nz,Iie as o,M4 as o$,av as o0,rh as o1,V8 as o2,hc as o3,Va as o4,qu as o5,gn as o6,ICe as o7,m3t as o8,Bct as o9,gJ as oA,c_e as oB,lC as oC,hve as oD,o0 as oE,$ke as oF,qy as oG,EU as oH,qst as oI,f3t as oJ,$ae as oK,rNt as oL,dT as oM,H8e as oN,jJe as oO,TJe as oP,R3t as oQ,RIt as oR,cbt as oS,U$t as oT,bQe as oU,JM as oV,Izt as oW,Lzt as oX,r0 as oY,iIe as oZ,hit as o_,ih as oa,ZVe as ob,jCe as oc,FC as od,YE as oe,EW as of,nee as og,fRt as oh,JLe as oi,v3t as oj,rV as ok,U4 as ol,Bpt as om,tzt as on,rzt as oo,izt as op,XP as oq,mMt as or,yb as os,joe as ot,qf as ou,q3 as ov,mJ as ow,cC as ox,aMt as oy,Tat as oz,st as p,S9t as p$,jC as p0,Yxe as p1,Zxe as p2,hJe as p3,wIt as p4,vC as p5,Ybt as p6,Xbt as p7,Zhe as p8,JVt as p9,B4 as pA,obe as pB,ome as pC,sC as pD,yE as pE,AMt as pF,U6e as pG,zp as pH,nU as pI,GP as pJ,$Mt as pK,bWe as pL,MMt as pM,PIt as pN,OWe as pO,i9e as pP,qFe as pQ,lIt as pR,Mqe as pS,d5e as pT,w5e as pU,od as pV,o2t as pW,a2t as pX,QTt as pY,mBt as pZ,f6 as p_,ZVt as pa,Jbt as pb,Qbt as pc,Kbt as pd,dc as pe,Zbt as pf,YVt as pg,XVt as ph,fxt as pi,uRt as pj,Mu as pk,S0e as pl,l0e as pm,k3 as pn,FRt as po,zge as pp,S4e as pq,wd as pr,cit as ps,vVt as pt,zhe as pu,Nqe as pv,dl as pw,bl as px,le as py,rm as pz,cv as q,Bc as q$,c2t as q0,CI as q1,A5 as q2,Zae as q3,_Nt as q4,J8e as q5,Da as q6,LI as q7,QZ as q8,th as q9,Bje as qA,Tse as qB,Jje as qC,kPt as qD,g8e as qE,dIt as qF,ck as qG,uk as qH,TPt as qI,POt as qJ,dOt as qK,T6e as qL,FPt as qM,$be as qN,qr as qO,ej as qP,HHe as qQ,qHe as qR,rke as qS,Np as qT,g3t as qU,uke as qV,EOt as qW,iUe as qX,zZ as qY,ZLe as qZ,yVt as q_,H8 as qa,g_e as qb,Cd as qc,RC as qd,G6t as qe,h1 as qf,B6t as qg,j6t as qh,z6t as qi,Sgt as qj,Ogt as qk,Egt as ql,Cgt as qm,Agt as qn,EPt as qo,VPt as qp,fje as qq,LPt as qr,ZRt as qs,JRt as qt,YRt as qu,AFe as qv,w4t as qw,_4t as qx,Zc as qy,Wje as qz,Mt as r,ree as r$,tc as r0,N3t as r1,U3t as r2,y1e as r3,W3t as r4,Oze as r5,Cze as r6,k3t as r7,B3t as r8,z3t as r9,eIt as rA,oC as rB,IM as rC,IG as rD,Z3t as rE,Y3t as rF,zMe as rG,bwt as rH,j3t as rI,V3t as rJ,K3t as rK,QM as rL,ftt as rM,sit as rN,j2e as rO,G2e as rP,Rit as rQ,rQ as rR,crt as rS,pSe as rT,oQ as rU,frt as rV,tst as rW,bst as rX,Lut as rY,W5 as rZ,Tdt as r_,L3t as ra,J3t as rb,D3t as rc,X3t as rd,H3t as re,RBe as rf,Q3t as rg,F3t as rh,G3t as ri,q3t as rj,Rze as rk,$3t as rl,EWe as rm,mJe as rn,SJe as ro,Swe as rp,Z1t as rq,Y1t as rr,iA as rs,BWe as rt,NOt as ru,sRt as rv,cZ as rw,u0e as rx,Sv as ry,aUe as rz,oe as s,zj as s$,Zct as s0,tT as s1,Xwt as s2,jTt as s3,cte as s4,j3e as s5,m2t as s6,W3e as s7,y2t as s8,Z3e as s9,iV as sA,bSt as sB,RSt as sC,kSt as sD,zSt as sE,jSt as sF,sft as sG,dPe as sH,TSt as sI,aEt as sJ,ngt as sK,Igt as sL,q0t as sM,p_t as sN,a_t as sO,VZ as sP,Tgt as sQ,dh as sR,yNt as sS,gNt as sT,n5t as sU,Pbe as sV,yC as sW,CMt as sX,LMt as sY,Qze as sZ,A$ as s_,v2t as sa,Q3e as sb,w2t as sc,o$ as sd,$V as se,R6e as sf,W2e as sg,Iit as sh,GS as si,Xft as sj,Qft as sk,bft as sl,Sft as sm,Oee as sn,zbt as so,Bbt as sp,Z8 as sq,Gbt as sr,J5 as ss,xpt as st,tSt as su,nPe as sv,sSt as sw,lPe as sx,oSt as sy,hPe as sz,Ki as t,jM as t$,Eve as t0,Rke as t1,wa as t2,Wh as t3,tet as t4,u5 as t5,yEt as t6,CWe as t7,$Je as t8,IJe as t9,EK as tA,sTe as tB,nu as tC,Ed as tD,uU as tE,YQe as tF,XQe as tG,qQe as tH,Ioe as tI,ml as tJ,BU as tK,d4e as tL,h4e as tM,ORt as tN,lk as tO,bNe as tP,GJe as tQ,lA as tR,rK as tS,rwe as tT,eje as tU,hqe as tV,tje as tW,lwe as tX,fwe as tY,t5 as tZ,Qbe as t_,kye as ta,yWe as tb,NTe as tc,LIt as td,GWe as te,HWe as tf,wWe as tg,uK as th,TWe as ti,SWe as tj,Zv as tk,yVe as tl,_Je as tm,AWe as tn,pJe as to,IWe as tp,DJe as tq,Mie as tr,dye as ts,dK as tt,XU as tu,uoe as tv,zWe as tw,zH as tx,zU as ty,kWe as tz,v as u,UFe as u$,xWe as u0,mn as u1,BOt as u2,Cx as u3,_Mt as u4,xC as u5,kC as u6,kxe as u7,kY as u8,K2 as u9,a0 as uA,OZe as uB,dZe as uC,pZe as uD,JYe as uE,KYe as uF,QYe as uG,eZe as uH,tZe as uI,iZe as uJ,rZe as uK,sZe as uL,nZe as uM,oZe as uN,aZe as uO,lZe as uP,rTe as uQ,aDe as uR,Gp as uS,EMt as uT,Fie as uU,v0e as uV,jNe as uW,g4 as uX,B6 as uY,jWe as uZ,MIt as u_,wj as ua,mZe as ub,s4 as uc,HG as ud,lG as ue,VVe as uf,mT as ug,SZ as uh,OMt as ui,Gm as uj,Fm as uk,$ye as ul,p0e as um,Hte as un,Q3 as uo,RWe as up,Nv as uq,toe as ur,V3 as us,WWe as ut,qWe as uu,f1 as uv,dU as uw,qJ as ux,cZe as uy,uWe as uz,md as v,nie as v0,D as v1,wRt as v2,aIt as v3,oIt as v4,Xxe as v5,MT as v6,jst as v7,zVe as v8,kVe as v9,Vdt as vA,Tyt as vB,xyt as vC,wyt as vD,m0 as vE,QDt as vF,o2 as vG,FUe as vH,qPt as vI,oK as vJ,rIt as vK,u$t as vL,R4t as vM,sUt as vN,_m as va,wRe as vb,mx as vc,Lst as vd,RMt as ve,$Re as vf,DRe as vg,Nw as vh,d3 as vi,mRt as vj,_ee as vk,Qgt as vl,ORe as vm,Wgt as vn,IRe as vo,MRe as vp,Kgt as vq,iu as vr,dX as vs,Na as vt,PRe as vu,SI as vv,Xgt as vw,hP as vx,JW as vy,c8 as vz,de as w,Gvt as x,d as y,Xs as z};
