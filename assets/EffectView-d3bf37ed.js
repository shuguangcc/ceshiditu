import{s as Ct,i as Pt}from"./mat3-3fc68e72.js";import{n as Ft}from"./Evented-515b9d9c.js";import{h as ct,y as b}from"./string-cdf077e6.js";import{t as ft,r as G,x as kt}from"./typedArrayUtil-a8b5b3e9.js";import{D as Y}from"./promiseUtils-6684e352.js";import{e as It}from"./TileKey-0750ad58.js";import{f as Z}from"./vec2f64-30dc1443.js";import{r as O}from"./context-util-1e3c8cfc.js";import{G as $,M as j,P as U,U as ht,L as C,D as X,o as g,H as x,t as A,C as P}from"./enums-64ab819c.js";import{E as H,c as N}from"./Texture-e79b14e7.js";import{t as F}from"./VertexElementDescriptor-2925c6af.js";import{e as v,y as M,n as Vt,m as Bt}from"./cast-7928d7aa.js";import{s as Gt}from"./Error-653283ae.js";import"./ensureType-cf29afa9.js";import{d as Nt,n as jt,e as Xt}from"./parser-2b40deea.js";function ut(){return new Float32Array(4)}function Ht(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function R(e,t,i,r){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function zt(e,t){return new Float32Array(e,t,4)}function mt(){return ut()}function _t(){return R(1,1,1,1)}function dt(){return R(1,0,0,0)}function gt(){return R(0,1,0,0)}function pt(){return R(0,0,1,0)}function xt(){return R(0,0,0,1)}const qt=mt(),Yt=_t(),Zt=dt(),Wt=gt(),Kt=pt(),Qt=xt();Object.freeze(Object.defineProperty({__proto__:null,create:ut,clone:Ht,fromValues:R,createView:zt,zeros:mt,ones:_t,unitX:dt,unitY:gt,unitZ:pt,unitW:xt,ZEROS:qt,ONES:Yt,UNIT_X:Zt,UNIT_Y:Wt,UNIT_Z:Kt,UNIT_W:Qt},Symbol.toStringTag,{value:"Module"}));const Jt=1/ct("mapview-transitions-duration");let te=class extends Ft{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(t){this._clips=t,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(t){this._opacity!==t&&(this._opacity=Math.min(1,Math.max(t,0)),this.requestRender())}get stage(){return this._stage}set stage(t){if(this._stage===t)return;const i=this._stage;this._stage=t,t?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):i.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return ft(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(t){this._visible!==t&&(this._visible=t,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=Y(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=Y(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){var t,i;(t=this._fadeInResolver)==null||t.call(this),this._fadeInResolver=null,(i=this._fadeOutResolver)==null||i.call(this),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(t){this.updateTransitionProperties(t.deltaTime,t.state.scale)}afterRender(t){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t){}processRender(t){this.stage&&this.computedVisible&&this.doRender(t)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(t,i){if(this.fadeTransitionEnabled){const r=this._fadeOutResolver||!this.visible?0:this.opacity,s=this.computedOpacity;if(s===r)this.computedVisible=this.visible;else{const n=t*Jt;this.computedOpacity=s>r?Math.max(r,s-n):Math.min(r,s+n),this.computedVisible=this.computedOpacity>0;const a=r===this.computedOpacity;this.inFadeTransition=!a,a||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(t){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},je=class extends te{constructor(t,i,r,s,n,a,c=n,o=a){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new It(t),this.resolution=i,this.x=r,this.y=s,this.width=n,this.height=a,this.rangeX=c,this.rangeY=o}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(t){const i=this.resolution/(t.resolution*t.pixelRatio),r=this.transforms.tileMat3,[s,n]=t.toScreenNoRotation([0,0],[this.x,this.y]),a=this.width/this.rangeX*i,c=this.height/this.rangeY*i;Ct(r,a,0,0,0,c,0,s,n,1),Pt(this.transforms.dvs,t.displayViewMat3,r)}};function He(e,t,i="nearest",r=!1){var l;const s=!(r&&t.pixelType==="u8"),n=s?$.FLOAT:$.UNSIGNED_BYTE,a=t.pixels==null||t.pixels.length===0?null:s?t.getAsRGBAFloat():t.getAsRGBA(),c=(l=e.capabilities.textureFloat)==null?void 0:l.textureFloatLinear,o={width:t.width,height:t.height,target:j.TEXTURE_2D,pixelFormat:U.RGBA,internalFormat:e.type===O.WEBGL2&&s?ht.RGBA32F:U.RGBA,samplingMode:!c||i!=="bilinear"&&i!=="cubic"?C.NEAREST:C.LINEAR,dataType:n,wrapMode:X.CLAMP_TO_EDGE,flipped:!1};return new H(e,o,a)}function ze(e,t){const{spacing:i,offsets:r,coefficients:s,size:[n,a]}=t,c=i[0]>1,o={width:c?4*n:n,height:a,target:j.TEXTURE_2D,pixelFormat:U.RGBA,internalFormat:e.type===O.WEBGL2?ht.RGBA32F:U.RGBA,dataType:$.FLOAT,samplingMode:C.NEAREST,wrapMode:X.CLAMP_TO_EDGE,flipped:!1},l=new Float32Array(c?n*a*16:2*r.length);if(c)for(let f=0,h=0;f<s.length;f++)l[h++]=s[f],f%3==2&&(l[h++]=1);else for(let f=0;f<a;f++)for(let h=0;h<n;h++){const _=4*(f*n+h),u=2*(h*a+f);l[_]=r[u],l[_+1]=r[u+1],l[_+3]=r[u]===-1?0:1}return new H(e,o,l)}function qe(e,t){const i={width:t.length/4,height:1,target:j.TEXTURE_2D,pixelFormat:U.RGBA,internalFormat:U.RGBA,dataType:$.UNSIGNED_BYTE,samplingMode:C.NEAREST,wrapMode:X.CLAMP_TO_EDGE,flipped:!1};return new H(e,i,t)}function Ye(e,t,i,r=1,s=!0){return{u_flipY:s,u_applyTransform:!!e,u_opacity:r,u_transformSpacing:e?e.spacing:Z,u_transformGridSize:e?e.size:Z,u_targetImageSize:t,u_srcImageSize:i}}function Ze(e,t){return{u_colormapOffset:t||0,u_colormapMaxIndex:e?e.length/4-1:0}}function We(e,t){return{u_scale:e,u_offset:t}}function Ke(e){return{u_bandCount:e.bandCount,u_minOutput:e.outMin,u_maxOutput:e.outMax,u_minCutOff:e.minCutOff,u_maxCutOff:e.maxCutOff,u_factor:e.factor,u_useGamma:e.useGamma,u_gamma:e.gamma,u_gammaCorrection:e.gammaCorrection}}function Qe(e){return{u_hillshadeType:e.hillshadeType,u_sinZcosAs:e.sinZcosAs,u_sinZsinAs:e.sinZsinAs,u_cosZs:e.cosZs,u_weights:e.weights,u_factor:e.factor,u_minValue:e.minValue,u_maxValue:e.maxValue}}function Je(e,t){const i=e.gl,r=t.glName,s=i.getProgramParameter(r,i.ACTIVE_UNIFORMS),n=new Map;let a;for(let c=0;c<s;c++)a=i.getActiveUniform(r,c),a&&n.set(a.name,{location:i.getUniformLocation(r,a.name),info:a});return n}function tr(e,t,i){Object.keys(i).forEach(r=>{const s=t.get(r)||t.get(r+"[0]");s&&ee(e,r,i[r],s)})}function er(e,t,i,r){i.length===r.length&&(r.some(s=>s==null)||i.some(s=>s==null)||i.forEach((s,n)=>{t.setUniform1i(s,n),e.bindTexture(r[n],n)}))}function ee(e,t,i,r){if(r===null||i==null)return!1;const{info:s}=r;switch(s.type){case g.FLOAT:s.size>1?e.setUniform1fv(t,i):e.setUniform1f(t,i);break;case g.FLOAT_VEC2:e.setUniform2fv(t,i);break;case g.FLOAT_VEC3:e.setUniform3fv(t,i);break;case g.FLOAT_VEC4:e.setUniform4fv(t,i);break;case g.FLOAT_MAT3:e.setUniformMatrix3fv(t,i);break;case g.FLOAT_MAT4:e.setUniformMatrix4fv(t,i);break;case g.INT:s.size>1?e.setUniform1iv(t,i):e.setUniform1i(t,i);break;case g.BOOL:e.setUniform1i(t,i?1:0);break;case g.INT_VEC2:case g.BOOL_VEC2:e.setUniform2iv(t,i);break;case g.INT_VEC3:case g.BOOL_VEC3:e.setUniform3iv(t,i);break;case g.INT_VEC4:case g.BOOL_VEC4:e.setUniform4iv(t,i);break;default:return!1}return!0}const re=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var W,Tt={exports:{}};(W=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(Tt.exports=W);const ie=Tt.exports;var K,yt={exports:{}};K=yt,function(e){var t=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];t!==void 0&&(K.exports=t)}();const Q=yt.exports;var vt={exports:{}};(function(e){(function(t){var i=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();i!==void 0&&(e.exports=i)})()})(vt);const se=vt.exports;var p=999,J=9999,I=0,V=1,tt=2,et=3,rt=4,L=5,ae=6,ne=7,oe=8,it=9,le=10,st=11,ce=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function fe(){var e,t,i,r=0,s=0,n=p,a=[],c=[],o=1,l=0,f=0,h=!1,_=!1,u="";return function(m){return c=[],m!==null?Mt(m.replace?m.replace(/\r\n/g,`
`):m):Ut()};function d(m){m.length&&c.push({type:ce[n],data:m,position:f,line:o,column:l})}function Mt(m){var E;for(r=0,i=(u+=m).length;e=u[r],r<i;){switch(E=r,n){case I:r=Dt();break;case V:r=wt();break;case tt:r=z();break;case et:r=bt();break;case rt:r=Lt();break;case st:r=At();break;case L:r=Ot();break;case J:r=$t();break;case it:r=St();break;case p:r=Rt()}E!==r&&(u[E]===`
`?(l=0,++o):++l)}return s+=r,u=u.slice(r),c}function Ut(m){return a.length&&d(a.join("")),n=le,d("(eof)"),c}function Rt(){return a=a.length?[]:a,t==="/"&&e==="*"?(f=s+r-1,n=I,t=e,r+1):t==="/"&&e==="/"?(f=s+r-1,n=V,t=e,r+1):e==="#"?(n=tt,f=s+r,r):/\s/.test(e)?(n=it,f=s+r,r):(h=/\d/.test(e),_=/[^\w_]/.test(e),f=s+r,n=h?rt:_?et:J,r)}function St(){return/[^\s]/g.test(e)?(d(a.join("")),n=p,r):(a.push(e),t=e,r+1)}function z(){return e!=="\r"&&e!==`
`||t==="\\"?(a.push(e),t=e,r+1):(d(a.join("")),n=p,r)}function wt(){return z()}function Dt(){return e==="/"&&t==="*"?(a.push(e),d(a.join("")),n=p,r+1):(a.push(e),t=e,r+1)}function bt(){if(t==="."&&/\d/.test(e))return n=L,r;if(t==="/"&&e==="*")return n=I,r;if(t==="/"&&e==="/")return n=V,r;if(e==="."&&a.length){for(;k(a););return n=L,r}if(e===";"||e===")"||e==="("){if(a.length)for(;k(a););return d(e),n=p,r+1}var m=a.length===2&&e!=="=";if(/[\w_\d\s]/.test(e)||m){for(;k(a););return n=p,r}return a.push(e),t=e,r+1}function k(m){for(var E,S,q=0;;){if(E=Q.indexOf(m.slice(0,m.length+q).join("")),S=Q[E],E===-1){if(q--+m.length>0)continue;S=m.slice(0,1).join("")}return d(S),f+=S.length,(a=a.slice(S.length)).length}}function At(){return/[^a-fA-F0-9]/.test(e)?(d(a.join("")),n=p,r):(a.push(e),t=e,r+1)}function Lt(){return e==="."||/[eE]/.test(e)?(a.push(e),n=L,t=e,r+1):e==="x"&&a.length===1&&a[0]==="0"?(n=st,a.push(e),t=e,r+1):/[^\d]/.test(e)?(d(a.join("")),n=p,r):(a.push(e),t=e,r+1)}function Ot(){return e==="f"&&(a.push(e),t=e,r+=1),/[eE]/.test(e)||e==="-"&&/[eE]/.test(t)?(a.push(e),t=e,r+1):/[^\d]/.test(e)?(d(a.join("")),n=p,r):(a.push(e),t=e,r+1)}function $t(){if(/[^\d\w_]/.test(e)){var m=a.join("");return n=ie.indexOf(m)>-1?oe:se.indexOf(m)>-1?ne:ae,d(a.join("")),n=p,r}return a.push(e),t=e,r+1}}function he(e){var t=fe(),i=[];return i=(i=i.concat(t(e))).concat(t(null))}function ue(e){return he(e)}function me(e){return e.map(t=>t.type!=="eof"?t.data:"").join("")}const B=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function _e(e,t="100",i="300 es"){const r=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of e)if(s.type==="preprocessor"){const n=r.exec(s.data);if(n){const a=n[1].replace(/\s\s+/g," ");if(a===i)return a;if(a===t)return s.data="#version "+i,t;throw new Error("unknown glsl version: "+a)}}return e.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:`
`}),null}function de(e,t){for(let i=t-1;i>=0;i--){const r=e[i];if(r.type!=="whitespace"&&r.type!=="block-comment"){if(r.type!=="keyword")break;if(r.data==="attribute"||r.data==="in")return!0}}return!1}function w(e,t,i,r){r=r||i;for(const s of e)if(s.type==="ident"&&s.data===i)return r in t?t[r]++:t[r]=0,w(e,t,r+"_"+t[r],r);return i}function Et(e,t,i="afterVersion"){function r(o,l){for(let f=l;f<o.length;f++){const h=o[f];if(h.type==="operator"&&h.data===";")return f}return null}function s(o){let l=-1,f=0,h=-1;for(let _=0;_<o.length;_++){const u=o[_];if(u.type==="preprocessor"&&(u.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++f:u.data.match(/\#endif\s*.*/)&&--f),i!=="afterVersion"&&i!=="afterPrecision"||u.type==="preprocessor"&&/^#version/.test(u.data)&&(h=Math.max(h,_)),i==="afterPrecision"&&u.type==="keyword"&&u.data==="precision"){const d=r(o,_);if(d===null)throw new Error("precision statement not followed by any semicolons!");h=Math.max(h,d)}l<h&&f===0&&(l=_)}return l+1}const n={data:`
`,type:"whitespace"},a=o=>o<e.length&&/[^\r\n]$/.test(e[o].data);let c=s(e);a(c-1)&&e.splice(c++,0,n);for(const o of t)e.splice(c++,0,o);a(c-1)&&a(c)&&e.splice(c,0,n)}function ge(e,t,i,r="lowp"){Et(e,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function pe(e,t,i,r,s="lowp"){Et(e,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function xe(e,t){let i,r,s=-1;for(let n=t;n<e.length;n++){const a=e[n];if(a.type==="operator"&&(a.data==="["&&(i=n),a.data==="]")){r=n;break}a.type==="integer"&&(s=parseInt(a.data,10))}return i&&r&&e.splice(i,r-i+1),s}function at(e,t){const i=Te();if(G(i))return i;const r=ue(e);if(_e(r,"100","300 es")==="300 es")return e;let s=null,n=null;const a={},c={};for(let o=0;o<r.length;++o){const l=r[o];switch(l.type){case"keyword":t===x.VERTEX_SHADER&&l.data==="attribute"?l.data="in":l.data==="varying"&&(l.data=t===x.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(l.data.trim())&&(l.data=l.data.replace(/(2D|Cube|EXT)/g,"")),t===x.FRAGMENT_SHADER&&l.data==="gl_FragColor"&&(s||(s=w(r,a,"fragColor"),ge(r,s,"vec4")),l.data=s),t===x.FRAGMENT_SHADER&&l.data==="gl_FragData"){const f=xe(r,o+1),h=w(r,a,"fragData");pe(r,h,"vec4",f,"mediump"),l.data=h}else t===x.FRAGMENT_SHADER&&l.data==="gl_FragDepthEXT"&&(n||(n=w(r,a,"gl_FragDepth")),l.data=n);break;case"ident":if(re.includes(l.data)){if(t===x.VERTEX_SHADER&&de(r,o))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");l.data in c||(c[l.data]=w(r,a,l.data)),l.data=c[l.data]}}}for(let o=r.length-1;o>=0;--o){const l=r[o];if(l.type==="preprocessor"){const f=l.data.match(/\#extension\s+(.*)\:/);if(f&&f[1]&&B.includes(f[1].trim())){const u=r[o+1];r.splice(o,u&&u.type==="whitespace"?2:1)}const h=l.data.match(/\#ifdef\s+(.*)/);h&&h[1]&&B.includes(h[1].trim())&&(l.data="#if 1");const _=l.data.match(/\#ifndef\s+(.*)/);_&&_[1]&&B.includes(_[1].trim())&&(l.data="#if 0")}}return ye(e,me(r))}function Te(e){return null}function ye(e,t){return t}const ve=4294967295;let rr=class{constructor(t,i,r,s,n=new Map){this._context=t,this._locations=s,this._uniformBlockBindings=n,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,t||console.error("RenderingContext isn't initialized!"),i.length===0&&console.error("Shaders source should not be empty!"),this._context.type===O.WEBGL2&&(i=at(i,x.VERTEX_SHADER),r=at(r,x.FRAGMENT_SHADER)),this._vShader=nt(this._context,x.VERTEX_SHADER,i),this._fShader=nt(this._context,x.FRAGMENT_SHADER,r),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(A.Shader,this),N()&&(this.vertexShader=i,this.fragmentShader=r)}get glName(){if(G(this._glName))return this._glName;if(ft(this._vShader))return null;const t=this._context.gl,i=t.createProgram();if(t.attachShader(i,this._vShader),t.attachShader(i,this._fShader),this._locations.forEach((r,s)=>t.bindAttribLocation(i,r,s)),t.linkProgram(i),N()&&!t.getProgramParameter(i,t.LINK_STATUS)&&console.error(`Could not link shader
validated: ${t.getProgramParameter(i,t.VALIDATE_STATUS)}, gl error ${t.getError()}, vertex: ${t.getShaderParameter(this._vShader,t.COMPILE_STATUS)}, fragment: ${t.getShaderParameter(this._fShader,t.COMPILE_STATUS)}, info log: ${t.getProgramInfoLog(i)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===O.WEBGL2){const r=t;for(const[s,n]of this._uniformBlockBindings){const a=r.getUniformBlockIndex(i,s);a<ve&&r.uniformBlockBinding(i,a,n)}}return this._glName=i,this._context.instanceCounter.increment(A.Program,this),i}get hasGLName(){return G(this._glName)}get isCompiled(){if(this._compiled)return!0;const t=this._context.gl.getExtension("KHR_parallel_shader_compile");return t==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,t.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const t=this._context.gl;this._vShader&&(t.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(A.Shader,this)),this._fShader&&(t.deleteShader(this._fShader),this._fShader=null),this._glName&&(t.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(A.Program,this))}ref(){++this._refCount}_getUniformLocation(t){return this._nameToUniformLocation[t]===void 0&&(this._nameToUniformLocation[t]=this._context.gl.getUniformLocation(this.glName,t)),this._nameToUniformLocation[t]}hasUniform(t){return this._getUniformLocation(t)!==null}setUniform1i(t,i){const r=this._nameToUniform1[t];r!==void 0&&i===r||(this._context.gl.uniform1i(this._getUniformLocation(t),i),this._nameToUniform1[t]=i)}setUniform1iv(t,i){T(this._nameToUniform1v,t,i)&&this._context.gl.uniform1iv(this._getUniformLocation(t),i)}setUniform2iv(t,i){T(this._nameToUniform2,t,i)&&this._context.gl.uniform2iv(this._getUniformLocation(t),i)}setUniform3iv(t,i){T(this._nameToUniform3,t,i)&&this._context.gl.uniform3iv(this._getUniformLocation(t),i)}setUniform4iv(t,i){T(this._nameToUniform4,t,i)&&this._context.gl.uniform4iv(this._getUniformLocation(t),i)}setUniform1f(t,i){const r=this._nameToUniform1[t];r!==void 0&&i===r||(this._context.gl.uniform1f(this._getUniformLocation(t),i),this._nameToUniform1[t]=i)}setUniform1fv(t,i){T(this._nameToUniform1v,t,i)&&this._context.gl.uniform1fv(this._getUniformLocation(t),i)}setUniform2f(t,i,r){const s=this._nameToUniform2.get(t);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(t),i,r),this._nameToUniform2.set(t,[i,r])):i===s[0]&&r===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(t),i,r),s[0]=i,s[1]=r)}setUniform2fv(t,i){T(this._nameToUniform2,t,i)&&this._context.gl.uniform2fv(this._getUniformLocation(t),i)}setUniform3f(t,i,r,s){const n=this._nameToUniform3.get(t);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(t),i,r,s),this._nameToUniform3[t]=[i,r,s]):i===n[0]&&r===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(t),i,r,s),n[0]=i,n[1]=r,n[2]=s)}setUniform3fv(t,i){T(this._nameToUniform3,t,i)&&this._context.gl.uniform3fv(this._getUniformLocation(t),i)}setUniform4f(t,i,r,s,n){const a=this._nameToUniform4.get(t);a===void 0?(this._context.gl.uniform4f(this._getUniformLocation(t),i,r,s,n),this._nameToUniform4.set(t,[i,r,s,n])):a!==void 0&&i===a[0]&&r===a[1]&&s===a[2]&&n===a[3]||(this._context.gl.uniform4f(this._getUniformLocation(t),i,r,s,n),a[0]=i,a[1]=r,a[2]=s,a[3]=n)}setUniform4fv(t,i){T(this._nameToUniform4,t,i)&&this._context.gl.uniform4fv(this._getUniformLocation(t),i)}setUniformMatrix3fv(t,i,r=!1){T(this._nameToUniformMatrix3,t,i)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(t),r,i)}setUniformMatrix4fv(t,i,r=!1){T(this._nameToUniformMatrix4,t,i)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(t),r,i)}stop(){}};function nt(e,t,i){const r=e.gl,s=r.createShader(t);return r.shaderSource(s,i),r.compileShader(s),N()&&!r.getShaderParameter(s,r.COMPILE_STATUS)&&(console.error("Compile error in ".concat(t===x.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(r.getShaderInfoLog(s)),console.error(Ee(i))),s}function Ee(e){let t=2;return e.replace(/\n/g,()=>`
`+Me(t++)+":")}function Me(e){return e>=1e3?e.toString():("  "+e).slice(-3)}function T(e,t,i){const r=e.get(t);return r?kt(r,i):(e.set(t,Array.from(i)),!0)}const sr={geometry:[new F("a_pos",2,P.BYTE,0,2)]},ar={geometry:[new F("a_pos",2,P.BYTE,0,4),new F("a_tex",2,P.BYTE,2,4)]},nr={geometry:[new F("a_pos",2,P.UNSIGNED_SHORT,0,4)]},D=-1;let y=class extends Bt{constructor(e){super(e),this._from=null,this._to=null,this._final=null,this._current=[],this._time=0,this.duration=ct("mapview-transitions-duration"),this.effects=[]}set effect(e){if(this._get("effect")!==(e=e||"")){this._set("effect",e);try{this._transitionTo(ot(e))}catch(t){this._transitionTo([]),Gt.getLogger(this.declaredClass).warn("Invalid Effect",{effect:e,error:t})}}}get hasEffects(){return this.transitioning||!!this.effects.length}set scale(e){this._updateForScale(e)}get transitioning(){return this._to!==null}canTransitionTo(e){try{return this.scale>0&&lt(this._current,ot(e),this.scale)}catch{return!1}}transitionStep(e,t){this._applyTimeTransition(e),this._updateForScale(t)}endTransitions(){this._applyTimeTransition(this.duration)}_transitionTo(e){this.scale>0&&lt(this._current,e,this.scale)?(this._final=e,this._to=b(e),Ue(this._current,this._to,this.scale),this._from=b(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=e),this._set("effects",this._current[0]?b(this._current[0].effects):[])}_applyTimeTransition(e){if(!(this._to&&this._from&&this._current&&this._final))return;this._time+=e;const t=Math.min(1,this._time/this.duration);for(let i=0;i<this._current.length;i++){const r=this._current[i],s=this._from[i],n=this._to[i];r.scale=Re(s.scale,n.scale,t);for(let a=0;a<r.effects.length;a++){const c=r.effects[a],o=s.effects[a],l=n.effects[a];c.interpolate(o,l,t)}}t===1&&(this._current=this._final,this._set("effects",this._current[0]?b(this._current[0].effects):[]),this._from=this._to=this._final=null)}_updateForScale(e){if(this._set("scale",e),this._current.length===0)return;const t=this._current,i=this._current.length-1;let r,s,n=1;if(t.length===1||e>=t[0].scale)s=r=t[0].effects;else if(e<=t[i].scale)s=r=t[i].effects;else for(let a=0;a<i;a++){const c=t[a],o=t[a+1];if(c.scale>=e&&o.scale<=e){n=(e-c.scale)/(o.scale-c.scale),r=c.effects,s=o.effects;break}}for(let a=0;a<this.effects.length;a++)this.effects[a].interpolate(r[a],s[a],n)}};function ot(e){const t=Nt(e)||[];return Se(t)?[{scale:D,effects:t}]:t}function lt(e,t,i){var r,s,n,a;return!((r=e[0])!=null&&r.effects)||!((s=t[0])!=null&&s.effects)?!0:!((((n=e[0])==null?void 0:n.scale)===D||((a=t[0])==null?void 0:a.scale)===D)&&(e.length>1||t.length>1)&&i<=0)&&jt(e[0].effects,t[0].effects)}function Ue(e,t,i){const r=e.length>t.length?e:t,s=e.length>t.length?t:e,n=s[s.length-1],a=(n==null?void 0:n.scale)??i,c=(n==null?void 0:n.effects)??[];for(let o=s.length;o<r.length;o++)s.push({scale:a,effects:[...c]});for(let o=0;o<r.length;o++)s[o].scale=s[o].scale===D?i:s[o].scale,r[o].scale=r[o].scale===D?i:r[o].scale,Xt(s[o].effects,r[o].effects)}function Re(e,t,i){return e+(t-e)*i}function Se(e){const t=e[0];return!!t&&"type"in t}v([M()],y.prototype,"_to",void 0),v([M()],y.prototype,"duration",void 0),v([M({value:""})],y.prototype,"effect",null),v([M({readOnly:!0})],y.prototype,"effects",void 0),v([M({readOnly:!0})],y.prototype,"hasEffects",null),v([M({value:0})],y.prototype,"scale",null),v([M({readOnly:!0})],y.prototype,"transitioning",null),y=v([Vt("esri.layers.effects.EffectView")],y);export{Je as A,Qe as E,er as O,Ke as T,Ye as _,je as a,nr as b,ze as c,y as d,te as e,tr as f,We as g,rr as h,sr as i,Ht as j,qe as l,He as m,ut as n,Ze as p,R as r,ar as t};
