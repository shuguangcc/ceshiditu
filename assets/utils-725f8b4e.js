import{_ as S}from"./preload-helper-41c905a7.js";import{l as f}from"./Color-a42a8267.js";import{e as h,x as d,w as _}from"./symbols-fa594797.js";import{c as E}from"./asyncUtils-62e8a185.js";import{h as O}from"./string-cdf077e6.js";import{t as b,r as a,f as R,e as g,q as C}from"./typedArrayUtil-a8b5b3e9.js";import{u,e as I}from"./screenUtils-410d12c0.js";import{l as U}from"./vec3f64-2f9cef06.js";import{i as q}from"./BlendLayer-d8293c8d.js";import{a as A}from"./assets-0b172f07.js";import{U as D}from"./request-d3e98716.js";import{e as P}from"./ItemCache-ee28c7ba.js";import{C as J}from"./cimSymbolUtils-2e4dde89.js";const k="picture-fill",L="simple-fill",N="simple-line",x="simple-marker",T="text",B="cim",w=new P(1e3);function bt(t){const o=t.style;let r=null;if(t)switch(t.type){case x:o!=="cross"&&o!=="x"&&(r=t.color);break;case L:o==="solid"?r=t.color:o!=="none"&&(r={type:"pattern",x:0,y:0,src:A(`esri/symbols/patterns/${o}.png`),width:5,height:5});break;case k:r={type:"pattern",src:t.url,width:u(t.width)*t.xscale,height:u(t.height)*t.yscale,x:u(t.xoffset),y:u(t.yoffset)};break;case T:r=t.color;break;case B:r=J(t)}return r}function dt(t,o){const r=t+"-"+o;return w.get(r)!==void 0?Promise.resolve(w.get(r)):D(t,{responseType:"image"}).then(e=>{const l=e.data,n=l.naturalWidth,s=l.naturalHeight,c=document.createElement("canvas");c.width=n,c.height=s;const i=c.getContext("2d");i.fillStyle=o,i.fillRect(0,0,n,s),i.globalCompositeOperation="destination-in",i.drawImage(l,0,0);const m=c.toDataURL();return w.put(r,m),m})}function v(t){if(!t)return null;let o=null;switch(t.type){case L:case k:case x:o=v(t.outline);break;case N:{const r=u(t.width);t.style!=null&&t.style!=="none"&&r!==0&&(o={color:t.color,style:H(t.style),width:r,cap:t.cap,join:t.join==="miter"?u(t.miterLimit):t.join});break}default:o=null}return o}const H=(()=>{const t={};return o=>{if(t[o])return t[o];const r=o.replace(/-/g,"");return t[o]=r,r}})(),wt=new f([128,128,128]),$=/\/resource\/(.*?)\.svg$/,M=new f("white");function V(t){const o=t.symbolLayers&&t.symbolLayers.length;if(!o)return;const r=t.symbolLayers.getItemAt(o-1);return"outline"in r?C(r,"outline","size"):void 0}function gt(t){var o;if(!t)return 0;if(h(t)){const r=V(t);return a(r)?r:0}return I((o=v(t))==null?void 0:o.width)}function $t(t){if(b(t)||!("symbolLayers"in t)||b(t.symbolLayers))return!1;switch(t.type){case"point-3d":return t.symbolLayers.some(o=>o.type==="object");case"line-3d":return t.symbolLayers.some(o=>o.type==="path");case"polygon-3d":return t.symbolLayers.some(o=>o.type==="object"||o.type==="extrude");default:return!1}}function kt(t,o){const r=R(o.resource).href;return!O("esri-canvas-svg-support")&&t.styleOrigin&&$.test(r)?r.replace($,"/resource/png/$1.png"):r}function Lt(t,o){if(!t)return null;let r=null;return h(t)?r=W(t):d(t)&&(r=t.color?new f(t.color):null),r?y(r,o):null}function W(t){const o=t.symbolLayers;if(!o)return null;let r=null;return o.forEach(e=>{var l;e.type==="object"&&((l=e.resource)==null?void 0:l.href)!=null||(r=e.type==="water"?g(e.color):a(e.material)?g(e.material.color):null)}),r?new f(r):null}function y(t,o){if(o==null||t==null)return t;const r=t.toRgba();return r[3]=r[3]*o,new f(r)}function F(t,o,r){const e=t.symbolLayers;if(!e)return;const l=n=>{const s=a(n)?n:null;return y(o=o??s??(r!=null?M:null),r)};e.forEach(n=>{var s;if(n.type!=="object"||((s=n.resource)==null?void 0:s.href)==null||o)if(n.type==="water")n.color=l(n.color);else{const c=a(n.material)?n.material.color:null,i=l(c);b(n.material)?n.material=new _({color:i}):n.material.color=i,r!=null&&"outline"in n&&a(n.outline)&&a(n.outline.color)&&(n.outline.color=y(n.outline.color,r))}})}function G(t,o,r){(o=o??t.color)&&(t.color=y(o,r)),r!=null&&"outline"in t&&t.outline&&t.outline.color&&(t.outline.color=y(t.outline.color,r))}function xt(t,o,r){t&&(o||r!=null)&&(o&&(o=new f(o)),h(t)?F(t,o,r):d(t)&&G(t,o,r))}async function K(t,o){const r=t.symbolLayers;r&&await E(r,async e=>Q(e,o))}async function Q(t,o){switch(t.type){case"extrude":Y(t,o);break;case"icon":case"line":case"text":X(t,o);break;case"path":tt(t,o);break;case"object":await Z(t,o)}}function X(t,o){const r=j(o);a(r)&&(t.size=r)}function j(t){for(const o of t)if(typeof o=="number")return o;return null}function Y(t,o){t.size=typeof o[2]=="number"?o[2]:0}async function Z(t,o){const{resourceSize:r,symbolSize:e}=await ot(t),l=z(o,r,e);t.width=p(o[0],e[0],r[0],l),t.depth=p(o[1],e[1],r[1],l),t.height=p(o[2],e[2],r[2],l)}function tt(t,o){const r=z(o,U,[t.width,void 0,t.height]);t.width=p(o[0],t.width,1,r),t.height=p(o[2],t.height,1,r)}function z(t,o,r){for(let e=0;e<3;e++){const l=t[e];switch(l){case"symbol-value":{const n=r[e];return n!=null?n/o[e]:1}case"proportional":break;default:if(l&&o[e])return l/o[e]}}return 1}async function ot(t){const o=await S(()=>import("./symbolLayerUtils-1bc2c213.js"),["./symbolLayerUtils-1bc2c213.js","./preload-helper-41c905a7.js","./request-d3e98716.js","./Error-653283ae.js","./string-cdf077e6.js","./typedArrayUtil-a8b5b3e9.js","./promiseUtils-6684e352.js","./ItemCache-ee28c7ba.js","./MemCache-4b976a8b.js","./cast-7928d7aa.js","./ensureType-cf29afa9.js","./nextTick-3ee5a785.js","./aaBoundingBox-fc742a4e.js","./Extent-69509002.js","./Ellipsoid-89682c5e.js","./aaBoundingRect-4a760199.js","./mathUtils-2519596a.js","./vec3-a020a6f6.js","./vec3f64-2f9cef06.js","./common-c186b691.js","./vec4-790471c0.js","./symbolLayerUtils3D-1f8d4478.js"],import.meta.url),r=await o.computeObjectLayerResourceSize(t,10),{width:e,height:l,depth:n}=t,s=[e,n,l];let c=1;for(let i=0;i<3;i++){const m=s[i];if(m!=null){c=m/r[i];break}}for(let i=0;i<3;i++)s[i]==null&&(s[i]=r[i]*c);return{resourceSize:r,symbolSize:s}}function p(t,o,r,e){switch(t){case"proportional":return r*e;case"symbol-value":return o??r;default:return t}}function rt(t,o){const r=j(o);if(!b(r))switch(t.type){case"simple-marker":t.size=r;break;case"picture-marker":{const e=t.width/t.height;e>1?(t.width=r,t.height=r*e):(t.width=r*e,t.height=r);break}case"simple-line":t.width=r;break;case"text":t.font.size=r}}async function vt(t,o){if(t&&o)return h(t)?K(t,o):void(d(t)&&rt(t,o))}function jt(t,o,r){if(t&&o!=null)if(h(t)){const e=t.symbolLayers;e&&e.forEach(l=>{if(l&&l.type==="object")switch(r){case"tilt":l.tilt=o;break;case"roll":l.roll=o;break;default:l.heading=o}})}else d(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle=o))}function zt(t){if(!t)return null;const o=t.effects.filter(r=>r.type!=="bloom").map(r=>r.toJSON());return q(o)}function St(t){return a(t)&&t.type==="polygon-3d"&&t.symbolLayers.some(o=>o.type==="extrude")}export{St as B,vt as M,jt as N,wt as a,H as b,$t as d,bt as f,kt as g,dt as h,Lt as j,zt as q,gt as w,xt as x,v as y};
